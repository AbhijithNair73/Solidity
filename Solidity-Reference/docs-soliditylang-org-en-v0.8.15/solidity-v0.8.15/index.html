<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Solidity 0.8.15 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/a4_railroad_diagram.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/toggle.css" type="text/css" />
    <link rel="canonical" href="https://docs.soliditylang.org/en/v0.8.15/index.html" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/js/toggle.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #65afff" >
            <a href="#">
            <img src="_static/logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                v0.8.15
              </div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
    
              <p class="caption" role="heading"><span class="caption-text">Basics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-introduction-to-smart-contracts">Introduction to Smart Contracts</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-installing-solidity">Installing the Solidity Compiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-solidity-by-example">Solidity by Example</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Language Description</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-layout-of-source-files">Layout of a Solidity Source File</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-structure-of-a-contract">Structure of a Contract</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-types">Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-units-and-global-variables">Units and Globally Available Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-control-structures">Expressions and Control Structures</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-contracts">Contracts</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-assembly">Inline Assembly</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-cheatsheet">Cheatsheet</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-grammar">Language Grammar</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Compiler</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-using-the-compiler">Using the Compiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-analysing-compilation-output">Analysing the Compiler Output</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-ir-breaking-changes">Solidity IR-based Codegen Changes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Internals</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-internals/layout_in_storage">Layout of State Variables in Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-internals/layout_in_memory">Layout in Memory</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-internals/layout_in_calldata">Layout of Call Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-internals/variable_cleanup">Cleaning Up Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-internals/source_mappings">Source Mappings</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-internals/optimizer">The Optimizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-metadata">Contract Metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-abi-spec">Contract ABI Specification</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Additional Material</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-050-breaking-changes">Solidity v0.5.0 Breaking Changes</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-060-breaking-changes">Solidity v0.6.0 Breaking Changes</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-070-breaking-changes">Solidity v0.7.0 Breaking Changes</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-080-breaking-changes">Solidity v0.8.0 Breaking Changes</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-natspec-format">NatSpec Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-security-considerations">Security Considerations</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-smtchecker">SMTChecker and Formal Verification</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-resources">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-path-resolution">Import Path Resolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-yul">Yul</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-style-guide">Style Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-common-patterns">Common Patterns</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-bugs">List of Known Bugs</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-contributing">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-brand-guide">Solidity Brand Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-language-influences">Language Influences</a></li>
</ul>

    <ul>
        <li>
            <a href="genindex.html">Keyword Index</a>
        </li>
    </ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #65afff" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">Solidity</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="#" class="icon icon-home"></a> &raquo;</li>
      <li>Solidity 0.8.15 documentation</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/ethereum/solidity/blob/v0.8.15/docs/index" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="solidity">
<h1>Solidity<a class="headerlink" href="#solidity" title="Permalink to this heading">ÔÉÅ</a></h1>
<p>Solidity is an object-oriented, high-level language for implementing smart
contracts. Smart contracts are programs which govern the behaviour of accounts
within the Ethereum state.</p>
<p>Solidity is a <a class="reference external" href="https://en.wikipedia.org/wiki/List_of_programming_languages_by_type#Curly-bracket_languages">curly-bracket language</a> designed to target the Ethereum Virtual Machine (EVM).
It is influenced by C++, Python and JavaScript. You can find more details about which languages Solidity has been inspired by in the <a class="reference internal" href="index.html#document-language-influences"><span class="doc">language influences</span></a> section.</p>
<p>Solidity is statically typed, supports inheritance, libraries and complex
user-defined types among other features.</p>
<p>With Solidity you can create contracts for uses such as voting, crowdfunding, blind auctions,
and multi-signature wallets.</p>
<p>When deploying contracts, you should use the latest released
version of Solidity. Apart from exceptional cases, only the latest version receives
<a class="reference external" href="https://github.com/ethereum/solidity/security/policy#supported-versions">security fixes</a>.
Furthermore, breaking changes as well as
new features are introduced regularly. We currently use
a 0.y.z version number <a class="reference external" href="https://semver.org/#spec-item-4">to indicate this fast pace of change</a>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Solidity recently released the 0.8.x version that introduced a lot of breaking
changes. Make sure you read <a class="reference internal" href="index.html#document-080-breaking-changes"><span class="doc">the full list</span></a>.</p>
</div>
<p>Ideas for improving Solidity or this documentation are always welcome,
read our <a class="reference internal" href="index.html#document-contributing"><span class="doc">contributors guide</span></a> for more details.</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>You can download this documentation as PDF, HTML or Epub by clicking on the versions
flyout menu in the bottom-left corner and selecting the preferred download format.</p>
</div>
<section id="getting-started">
<h2>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this heading">ÔÉÅ</a></h2>
<p><strong>1. Understand the Smart Contract Basics</strong></p>
<p>If you are new to the concept of smart contracts we recommend you to get started by digging
into the ‚ÄúIntroduction to Smart Contracts‚Äù section, which covers:</p>
<ul class="simple">
<li><p><a class="reference internal" href="index.html#simple-smart-contract"><span class="std std-ref">A simple example smart contract</span></a> written in Solidity.</p></li>
<li><p><a class="reference internal" href="index.html#blockchain-basics"><span class="std std-ref">Blockchain Basics</span></a>.</p></li>
<li><p><a class="reference internal" href="index.html#the-ethereum-virtual-machine"><span class="std std-ref">The Ethereum Virtual Machine</span></a>.</p></li>
</ul>
<p><strong>2. Get to Know Solidity</strong></p>
<p>Once you are accustomed to the basics, we recommend you read the <a class="reference internal" href="index.html#document-solidity-by-example"><span class="doc">‚ÄúSolidity by Example‚Äù</span></a>
and ‚ÄúLanguage Description‚Äù sections to understand the core concepts of the language.</p>
<p><strong>3. Install the Solidity Compiler</strong></p>
<p>There are various ways to install the Solidity compiler,
simply choose your preferred option and follow the steps outlined on the <a class="reference internal" href="index.html#installing-solidity"><span class="std std-ref">installation page</span></a>.</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>You can try out code examples directly in your browser with the
<a class="reference external" href="https://remix.ethereum.org">Remix IDE</a>. Remix is a web browser based IDE
that allows you to write, deploy and administer Solidity smart contracts, without
the need to install Solidity locally.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>As humans write software, it can have bugs. You should follow established
software development best-practices when writing your smart contracts. This
includes code review, testing, audits, and correctness proofs. Smart contract
users are sometimes more confident with code than their authors, and
blockchains and smart contracts have their own unique issues to
watch out for, so before working on production code, make sure you read the
<a class="reference internal" href="index.html#security-considerations"><span class="std std-ref">Security Considerations</span></a> section.</p>
</div>
<p><strong>4. Learn More</strong></p>
<p>If you want to learn more about building decentralized applications on Ethereum, the
<a class="reference external" href="https://ethereum.org/en/developers/">Ethereum Developer Resources</a>
can help you with further general documentation around Ethereum, and a wide selection of tutorials,
tools and development frameworks.</p>
<p>If you have any questions, you can try searching for answers or asking on the
<a class="reference external" href="https://ethereum.stackexchange.com/">Ethereum StackExchange</a>, or
our <a class="reference external" href="https://gitter.im/ethereum/solidity/">Gitter channel</a>.</p>
</section>
<section id="translations">
<span id="id1"></span><h2>Translations<a class="headerlink" href="#translations" title="Permalink to this heading">ÔÉÅ</a></h2>
<p>Community contributors help translate this documentation into several languages.
Note that they have varying degrees of completeness and up-to-dateness. The English
version stands as a reference.</p>
<p>You can switch between languages by clicking on the flyout menu in the bottom-left corner
and selecting the preferred language.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.soliditylang.org/fr/latest/">French</a></p></li>
<li><p><a class="reference external" href="https://github.com/solidity-docs/id-indonesian">Indonesian</a></p></li>
<li><p><a class="reference external" href="https://github.com/solidity-docs/fa-persian">Persian</a></p></li>
<li><p><a class="reference external" href="https://github.com/solidity-docs/ja-japanese">Japanese</a></p></li>
<li><p><a class="reference external" href="https://github.com/solidity-docs/ko-korean">Korean</a></p></li>
<li><p><a class="reference external" href="https://github.com/solidity-docs/zh-cn-chinese/">Chinese</a></p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We recently set up a new GitHub organization and translation workflow to help streamline the
community efforts. Please refer to the <a class="reference external" href="https://github.com/solidity-docs/translation-guide">translation guide</a>
for information on how to start a new language or contribute to the community translations.</p>
</div>
</section>
</section>
<section id="contents">
<h1>Contents<a class="headerlink" href="#contents" title="Permalink to this heading">ÔÉÅ</a></h1>
<p><a class="reference internal" href="genindex.html"><span class="std std-ref">Keyword Index</span></a>, <a class="reference internal" href="search.html"><span class="std std-ref">Search Page</span></a></p>
<div class="toctree-wrapper compound">
<span id="document-introduction-to-smart-contracts"></span><section id="introduction-to-smart-contracts">
<h2>Introduction to Smart Contracts<a class="headerlink" href="#introduction-to-smart-contracts" title="Permalink to this heading">ÔÉÅ</a></h2>
<section id="a-simple-smart-contract">
<span id="simple-smart-contract"></span><h3>A Simple Smart Contract<a class="headerlink" href="#a-simple-smart-contract" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Let us begin with a basic example that sets the value of a variable and exposes
it for other contracts to access. It is fine if you do not understand
everything right now, we will go into more details later.</p>
<section id="storage-example">
<h4>Storage Example<a class="headerlink" href="#storage-example" title="Permalink to this heading">ÔÉÅ</a></h4>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC40LjE2IDwwLjkuMDsKCmNvbnRyYWN0IFNpbXBsZVN0b3JhZ2UgewogICAgdWludCBzdG9yZWREYXRhOwoKICAgIGZ1bmN0aW9uIHNldCh1aW50IHgpIHB1YmxpYyB7CiAgICAgICAgc3RvcmVkRGF0YSA9IHg7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBzdG9yZWREYXRhOwogICAgfQp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.4.16</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">SimpleStorage</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="nv">storedData</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">set</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">x</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>storedData<span class="w"> </span><span class="o">=</span><span class="w"> </span>x<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">get</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>storedData<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>The first line tells you that the source code is licensed under the
GPL version 3.0. Machine-readable license specifiers are important
in a setting where publishing the source code is the default.</p>
<p>The next line specifies that the source code is written for
Solidity version 0.4.16, or a newer version of the language up to, but not including version 0.9.0.
This is to ensure that the contract is not compilable with a new (breaking) compiler version, where it could behave differently.
<a class="reference internal" href="index.html#pragma"><span class="std std-ref">Pragmas</span></a> are common instructions for compilers about how to treat the
source code (e.g. <a class="reference external" href="https://en.wikipedia.org/wiki/Pragma_once">pragma once</a>).</p>
<p>A contract in the sense of Solidity is a collection of code (its <em>functions</em>) and
data (its <em>state</em>) that resides at a specific address on the Ethereum
blockchain. The line <code class="docutils literal notranslate"><span class="pre">uint</span> <span class="pre">storedData;</span></code> declares a state variable called <code class="docutils literal notranslate"><span class="pre">storedData</span></code> of
type <code class="docutils literal notranslate"><span class="pre">uint</span></code> (<em>u</em>nsigned <em>int</em>eger of <em>256</em> bits). You can think of it as a single slot
in a database that you can query and alter by calling functions of the
code that manages the database. In this example, the contract defines the
functions <code class="docutils literal notranslate"><span class="pre">set</span></code> and <code class="docutils literal notranslate"><span class="pre">get</span></code> that can be used to modify
or retrieve the value of the variable.</p>
<p>To access a member (like a state variable) of the current contract, you do not typically add the <code class="docutils literal notranslate"><span class="pre">this.</span></code> prefix,
you just access it directly via its name.
Unlike in some other languages, omitting it is not just a matter of style,
it results in a completely different way to access the member, but more on this later.</p>
<p>This contract does not do much yet apart from (due to the infrastructure
built by Ethereum) allowing anyone to store a single number that is accessible by
anyone in the world without a (feasible) way to prevent you from publishing
this number. Anyone could call <code class="docutils literal notranslate"><span class="pre">set</span></code> again with a different value
and overwrite your number, but the number is still stored in the history
of the blockchain. Later, you will see how you can impose access restrictions
so that only you can alter the number.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Be careful with using Unicode text, as similar looking (or even identical) characters can
have different code points and as such are encoded as a different byte array.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All identifiers (contract names, function names and variable names) are restricted to
the ASCII character set. It is possible to store UTF-8 encoded data in string variables.</p>
</div>
</section>
<section id="subcurrency-example">
<span id="index-0"></span><h4>Subcurrency Example<a class="headerlink" href="#subcurrency-example" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>The following contract implements the simplest form of a
cryptocurrency. The contract allows only its creator to create new coins (different issuance schemes are possible).
Anyone can send coins to each other without a need for
registering with a username and password, all you need is an Ethereum keypair.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5IF4wLjguNDsKCmNvbnRyYWN0IENvaW4gewogICAgLy8gVGhlIGtleXdvcmQgInB1YmxpYyIgbWFrZXMgdmFyaWFibGVzCiAgICAvLyBhY2Nlc3NpYmxlIGZyb20gb3RoZXIgY29udHJhY3RzCiAgICBhZGRyZXNzIHB1YmxpYyBtaW50ZXI7CiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQpIHB1YmxpYyBiYWxhbmNlczsKCiAgICAvLyBFdmVudHMgYWxsb3cgY2xpZW50cyB0byByZWFjdCB0byBzcGVjaWZpYwogICAgLy8gY29udHJhY3QgY2hhbmdlcyB5b3UgZGVjbGFyZQogICAgZXZlbnQgU2VudChhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQgYW1vdW50KTsKCiAgICAvLyBDb25zdHJ1Y3RvciBjb2RlIGlzIG9ubHkgcnVuIHdoZW4gdGhlIGNvbnRyYWN0CiAgICAvLyBpcyBjcmVhdGVkCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgICBtaW50ZXIgPSBtc2cuc2VuZGVyOwogICAgfQoKICAgIC8vIFNlbmRzIGFuIGFtb3VudCBvZiBuZXdseSBjcmVhdGVkIGNvaW5zIHRvIGFuIGFkZHJlc3MKICAgIC8vIENhbiBvbmx5IGJlIGNhbGxlZCBieSB0aGUgY29udHJhY3QgY3JlYXRvcgogICAgZnVuY3Rpb24gbWludChhZGRyZXNzIHJlY2VpdmVyLCB1aW50IGFtb3VudCkgcHVibGljIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gbWludGVyKTsKICAgICAgICBiYWxhbmNlc1tyZWNlaXZlcl0gKz0gYW1vdW50OwogICAgfQoKICAgIC8vIEVycm9ycyBhbGxvdyB5b3UgdG8gcHJvdmlkZSBpbmZvcm1hdGlvbiBhYm91dAogICAgLy8gd2h5IGFuIG9wZXJhdGlvbiBmYWlsZWQuIFRoZXkgYXJlIHJldHVybmVkCiAgICAvLyB0byB0aGUgY2FsbGVyIG9mIHRoZSBmdW5jdGlvbi4KICAgIGVycm9yIEluc3VmZmljaWVudEJhbGFuY2UodWludCByZXF1ZXN0ZWQsIHVpbnQgYXZhaWxhYmxlKTsKCiAgICAvLyBTZW5kcyBhbiBhbW91bnQgb2YgZXhpc3RpbmcgY29pbnMKICAgIC8vIGZyb20gYW55IGNhbGxlciB0byBhbiBhZGRyZXNzCiAgICBmdW5jdGlvbiBzZW5kKGFkZHJlc3MgcmVjZWl2ZXIsIHVpbnQgYW1vdW50KSBwdWJsaWMgewogICAgICAgIGlmIChhbW91bnQgPiBiYWxhbmNlc1ttc2cuc2VuZGVyXSkKICAgICAgICAgICAgcmV2ZXJ0IEluc3VmZmljaWVudEJhbGFuY2UoewogICAgICAgICAgICAgICAgcmVxdWVzdGVkOiBhbW91bnQsCiAgICAgICAgICAgICAgICBhdmFpbGFibGU6IGJhbGFuY2VzW21zZy5zZW5kZXJdCiAgICAgICAgICAgIH0pOwoKICAgICAgICBiYWxhbmNlc1ttc2cuc2VuZGVyXSAtPSBhbW91bnQ7CiAgICAgICAgYmFsYW5jZXNbcmVjZWl2ZXJdICs9IGFtb3VudDsKICAgICAgICBlbWl0IFNlbnQobXNnLnNlbmRlciwgcmVjZWl2ZXIsIGFtb3VudCk7CiAgICB9Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.8.4</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Coin</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// The keyword &quot;public&quot; makes variables</span>
<span class="w">    </span><span class="c1">// accessible from other contracts</span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="k">public </span><span class="nv">minter</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">mapping</span><span class="w"> </span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>balances<span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Events allow clients to react to specific</span>
<span class="w">    </span><span class="c1">// contract changes you declare</span>
<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">Sent</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">from</span><span class="p">,</span><span class="w"> </span><span class="kt">address</span><span class="w"> </span><span class="nv">to</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">amount</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Constructor code is only run when the contract</span>
<span class="w">    </span><span class="c1">// is created</span>
<span class="w">    </span><span class="kt">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>minter<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">msg.sender</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Sends an amount of newly created coins to an address</span>
<span class="w">    </span><span class="c1">// Can only be called by the contract creator</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">mint</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">receiver</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">amount</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span><span class="k">msg.sender</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>minter<span class="p">);</span><span class="w"></span>
<span class="w">        </span>balances<span class="p">[</span>receiver<span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span>amount<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Errors allow you to provide information about</span>
<span class="w">    </span><span class="c1">// why an operation failed. They are returned</span>
<span class="w">    </span><span class="c1">// to the caller of the function.</span>
<span class="w">    </span>error<span class="w"> </span>InsufficientBalance<span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">requested</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">available</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Sends an amount of existing coins</span>
<span class="w">    </span><span class="c1">// from any caller to an address</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">send</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">receiver</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">amount</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>amount<span class="w"> </span><span class="o">&gt;</span><span class="w"> </span>balances<span class="p">[</span><span class="k">msg.sender</span><span class="p">])</span><span class="w"></span>
<span class="w">            </span>revert<span class="w"> </span>InsufficientBalance<span class="p">({</span><span class="w"></span>
<span class="w">                </span>requested<span class="p">:</span><span class="w"> </span>amount<span class="p">,</span><span class="w"></span>
<span class="w">                </span>available<span class="p">:</span><span class="w"> </span>balances<span class="p">[</span><span class="k">msg.sender</span><span class="p">]</span><span class="w"></span>
<span class="w">            </span><span class="p">});</span><span class="w"></span>

<span class="w">        </span>balances<span class="p">[</span><span class="k">msg.sender</span><span class="p">]</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span>amount<span class="p">;</span><span class="w"></span>
<span class="w">        </span>balances<span class="p">[</span>receiver<span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span>amount<span class="p">;</span><span class="w"></span>
<span class="w">        </span>emit<span class="w"> </span>Sent<span class="p">(</span><span class="k">msg.sender</span><span class="p">,</span><span class="w"> </span>receiver<span class="p">,</span><span class="w"> </span>amount<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>This contract introduces some new concepts, let us go through them one by one.</p>
<p>The line <code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">public</span> <span class="pre">minter;</span></code> declares a state variable of type <a class="reference internal" href="index.html#address"><span class="std std-ref">address</span></a>.
The <code class="docutils literal notranslate"><span class="pre">address</span></code> type is a 160-bit value that does not allow any arithmetic operations.
It is suitable for storing addresses of contracts, or a hash of the public half
of a keypair belonging to <a class="reference internal" href="#accounts"><span class="std std-ref">external accounts</span></a>.</p>
<p>The keyword <code class="docutils literal notranslate"><span class="pre">public</span></code> automatically generates a function that allows you to access the current value of the state
variable from outside of the contract. Without this keyword, other contracts have no way to access the variable.
The code of the function generated by the compiler is equivalent
to the following (ignore <code class="docutils literal notranslate"><span class="pre">external</span></code> and <code class="docutils literal notranslate"><span class="pre">view</span></code> for now):</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=ZnVuY3Rpb24gbWludGVyKCkgZXh0ZXJuYWwgdmlldyByZXR1cm5zIChhZGRyZXNzKSB7IHJldHVybiBtaW50ZXI7IH0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">function</span><span class="w"> </span><span class="nv">minter</span><span class="p">()</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">address</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kt">return</span><span class="w"> </span>minter<span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>You could add a function like the above yourself, but you would have a function and state variable with the same name.
You do not need to do this, the compiler figures it out for you.</p>
<p id="index-1">The next line, <code class="docutils literal notranslate"><span class="pre">mapping</span> <span class="pre">(address</span> <span class="pre">=&gt;</span> <span class="pre">uint)</span> <span class="pre">public</span> <span class="pre">balances;</span></code> also
creates a public state variable, but it is a more complex datatype.
The <a class="reference internal" href="index.html#mapping-types"><span class="std std-ref">mapping</span></a> type maps addresses to <a class="reference internal" href="index.html#integers"><span class="std std-ref">unsigned integers</span></a>.</p>
<p>Mappings can be seen as <a class="reference external" href="https://en.wikipedia.org/wiki/Hash_table">hash tables</a> which are
virtually initialised such that every possible key exists from the start and is mapped to a
value whose byte-representation is all zeros. However, it is neither possible to obtain a list of all keys of
a mapping, nor a list of all values. Record what you
added to the mapping, or use it in a context where this is not needed. Or
even better, keep a list, or use a more suitable data type.</p>
<p>The <a class="reference internal" href="index.html#getter-functions"><span class="std std-ref">getter function</span></a> created by the <code class="docutils literal notranslate"><span class="pre">public</span></code> keyword
is more complex in the case of a mapping. It looks like the
following:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=ZnVuY3Rpb24gYmFsYW5jZXMoYWRkcmVzcyBhY2NvdW50KSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQpIHsKICAgIHJldHVybiBiYWxhbmNlc1thY2NvdW50XTsKfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">function</span><span class="w"> </span><span class="nv">balances</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">account</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">return</span><span class="w"> </span>balances<span class="p">[</span>account<span class="p">];</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>You can use this function to query the balance of a single account.</p>
<p id="index-2">The line <code class="docutils literal notranslate"><span class="pre">event</span> <span class="pre">Sent(address</span> <span class="pre">from,</span> <span class="pre">address</span> <span class="pre">to,</span> <span class="pre">uint</span> <span class="pre">amount);</span></code> declares
an <a class="reference internal" href="index.html#events"><span class="std std-ref">‚Äúevent‚Äù</span></a>, which is emitted in the last line of the function
<code class="docutils literal notranslate"><span class="pre">send</span></code>. Ethereum clients such as web applications can
listen for these events emitted on the blockchain without much
cost. As soon as it is emitted, the listener receives the
arguments <code class="docutils literal notranslate"><span class="pre">from</span></code>, <code class="docutils literal notranslate"><span class="pre">to</span></code> and <code class="docutils literal notranslate"><span class="pre">amount</span></code>, which makes it possible to track
transactions.</p>
<p>To listen for this event, you could use the following
JavaScript code, which uses <a class="reference external" href="https://github.com/ethereum/web3.js/">web3.js</a> to create the <code class="docutils literal notranslate"><span class="pre">Coin</span></code> contract object,
and any user interface calls the automatically generated <code class="docutils literal notranslate"><span class="pre">balances</span></code> function from above:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Q29pbi5TZW50KCkud2F0Y2goe30sICcnLCBmdW5jdGlvbihlcnJvciwgcmVzdWx0KSB7CiAgICBpZiAoIWVycm9yKSB7CiAgICAgICAgY29uc29sZS5sb2coIkNvaW4gdHJhbnNmZXI6ICIgKyByZXN1bHQuYXJncy5hbW91bnQgKwogICAgICAgICAgICAiIGNvaW5zIHdlcmUgc2VudCBmcm9tICIgKyByZXN1bHQuYXJncy5mcm9tICsKICAgICAgICAgICAgIiB0byAiICsgcmVzdWx0LmFyZ3MudG8gKyAiLiIpOwogICAgICAgIGNvbnNvbGUubG9nKCJCYWxhbmNlcyBub3c6XG4iICsKICAgICAgICAgICAgIlNlbmRlcjogIiArIENvaW4uYmFsYW5jZXMuY2FsbChyZXN1bHQuYXJncy5mcm9tKSArCiAgICAgICAgICAgICJSZWNlaXZlcjogIiArIENvaW4uYmFsYW5jZXMuY2FsbChyZXN1bHQuYXJncy50bykpOwogICAgfQp9KQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="n">Coin</span><span class="p">.</span><span class="n">Sent</span><span class="p">().</span><span class="n">watch</span><span class="p">({},</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">console</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="s">&quot;Coin transfer: &quot;</span> <span class="o">+</span> <span class="n">result</span><span class="p">.</span><span class="n">args</span><span class="p">.</span><span class="n">amount</span> <span class="o">+</span>
            <span class="s">&quot; coins were sent from &quot;</span> <span class="o">+</span> <span class="n">result</span><span class="p">.</span><span class="n">args</span><span class="p">.</span><span class="k">from</span> <span class="o">+</span>
            <span class="s">&quot; to &quot;</span> <span class="o">+</span> <span class="n">result</span><span class="p">.</span><span class="n">args</span><span class="p">.</span><span class="n">to</span> <span class="o">+</span> <span class="s">&quot;.&quot;</span><span class="p">);</span>
        <span class="n">console</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="s">&quot;Balances now:</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">+</span>
            <span class="s">&quot;Sender: &quot;</span> <span class="o">+</span> <span class="n">Coin</span><span class="p">.</span><span class="n">balances</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">args</span><span class="p">.</span><span class="k">from</span><span class="p">)</span> <span class="o">+</span>
            <span class="s">&quot;Receiver: &quot;</span> <span class="o">+</span> <span class="n">Coin</span><span class="p">.</span><span class="n">balances</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">args</span><span class="p">.</span><span class="n">to</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">})</span>
</pre></div>
</div>
<p id="index-3">The <a class="reference internal" href="index.html#constructor"><span class="std std-ref">constructor</span></a> is a special function that is executed during the creation of the contract and
cannot be called afterwards. In this case, it permanently stores the address of the person creating the
contract. The <code class="docutils literal notranslate"><span class="pre">msg</span></code> variable (together with <code class="docutils literal notranslate"><span class="pre">tx</span></code> and <code class="docutils literal notranslate"><span class="pre">block</span></code>) is a
<a class="reference internal" href="index.html#special-variables-functions"><span class="std std-ref">special global variable</span></a> that
contains properties which allow access to the blockchain. <code class="docutils literal notranslate"><span class="pre">msg.sender</span></code> is
always the address where the current (external) function call came from.</p>
<p>The functions that make up the contract, and that users and contracts can call are <code class="docutils literal notranslate"><span class="pre">mint</span></code> and <code class="docutils literal notranslate"><span class="pre">send</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">mint</span></code> function sends an amount of newly created coins to another address. The <a class="reference internal" href="index.html#assert-and-require"><span class="std std-ref">require</span></a> function call defines conditions that reverts all changes if not met. In this
example, <code class="docutils literal notranslate"><span class="pre">require(msg.sender</span> <span class="pre">==</span> <span class="pre">minter);</span></code> ensures that only the creator of the contract can call
<code class="docutils literal notranslate"><span class="pre">mint</span></code>. In general, the creator can mint as many tokens as they like, but at some point, this will
lead to a phenomenon called ‚Äúoverflow‚Äù. Note that because of the default <a class="reference internal" href="index.html#unchecked"><span class="std std-ref">Checked arithmetic</span></a>, the transaction would revert if the expression <code class="docutils literal notranslate"><span class="pre">balances[receiver]</span> <span class="pre">+=</span> <span class="pre">amount;</span></code>
overflows, i.e., when <code class="docutils literal notranslate"><span class="pre">balances[receiver]</span> <span class="pre">+</span> <span class="pre">amount</span></code> in arbitrary precision arithmetic is larger
than the maximum value of <code class="docutils literal notranslate"><span class="pre">uint</span></code> (<code class="docutils literal notranslate"><span class="pre">2**256</span> <span class="pre">-</span> <span class="pre">1</span></code>). This is also true for the statement
<code class="docutils literal notranslate"><span class="pre">balances[receiver]</span> <span class="pre">+=</span> <span class="pre">amount;</span></code> in the function <code class="docutils literal notranslate"><span class="pre">send</span></code>.</p>
<p><a class="reference internal" href="index.html#errors"><span class="std std-ref">Errors</span></a> allow you to provide more information to the caller about
why a condition or operation failed. Errors are used together with the
<a class="reference internal" href="index.html#revert-statement"><span class="std std-ref">revert statement</span></a>. The <code class="docutils literal notranslate"><span class="pre">revert</span></code> statement unconditionally
aborts and reverts all changes similar to the <code class="docutils literal notranslate"><span class="pre">require</span></code> function, but it also
allows you to provide the name of an error and additional data which will be supplied to the caller
(and eventually to the front-end application or block explorer) so that
a failure can more easily be debugged or reacted upon.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">send</span></code> function can be used by anyone (who already
has some of these coins) to send coins to anyone else. If the sender does not have
enough coins to send, the <code class="docutils literal notranslate"><span class="pre">if</span></code> condition evaluates to true. As a result, the <code class="docutils literal notranslate"><span class="pre">revert</span></code> will cause the operation to fail
while providing the sender with error details using the <code class="docutils literal notranslate"><span class="pre">InsufficientBalance</span></code> error.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you use
this contract to send coins to an address, you will not see anything when you
look at that address on a blockchain explorer, because the record that you sent
coins and the changed balances are only stored in the data storage of this
particular coin contract. By using events, you can create
a ‚Äúblockchain explorer‚Äù that tracks transactions and balances of your new coin,
but you have to inspect the coin contract address and not the addresses of the
coin owners.</p>
</div>
</section>
</section>
<section id="blockchain-basics">
<span id="id1"></span><h3>Blockchain Basics<a class="headerlink" href="#blockchain-basics" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Blockchains as a concept are not too hard to understand for programmers. The reason is that
most of the complications (mining, <a class="reference external" href="https://en.wikipedia.org/wiki/Cryptographic_hash_function">hashing</a>,
<a class="reference external" href="https://en.wikipedia.org/wiki/Elliptic_curve_cryptography">elliptic-curve cryptography</a>,
<a class="reference external" href="https://en.wikipedia.org/wiki/Peer-to-peer">peer-to-peer networks</a>, etc.)
are just there to provide a certain set of features and promises for the platform. Once you accept these
features as given, you do not have to worry about the underlying technology - or do you have
to know how Amazon‚Äôs AWS works internally in order to use it?</p>
<section id="transactions">
<span id="index-4"></span><h4>Transactions<a class="headerlink" href="#transactions" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>A blockchain is a globally shared, transactional database.
This means that everyone can read entries in the database just by participating in the network.
If you want to change something in the database, you have to create a so-called transaction
which has to be accepted by all others.
The word transaction implies that the change you want to make (assume you want to change
two values at the same time) is either not done at all or completely applied. Furthermore,
while your transaction is being applied to the database, no other transaction can alter it.</p>
<p>As an example, imagine a table that lists the balances of all accounts in an
electronic currency. If a transfer from one account to another is requested,
the transactional nature of the database ensures that if the amount is
subtracted from one account, it is always added to the other account. If due
to whatever reason, adding the amount to the target account is not possible,
the source account is also not modified.</p>
<p>Furthermore, a transaction is always cryptographically signed by the sender (creator).
This makes it straightforward to guard access to specific modifications of the
database. In the example of the electronic currency, a simple check ensures that
only the person holding the keys to the account can transfer money from it.</p>
</section>
<section id="blocks">
<span id="index-5"></span><h4>Blocks<a class="headerlink" href="#blocks" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>One major obstacle to overcome is what (in Bitcoin terms) is called a ‚Äúdouble-spend attack‚Äù:
What happens if two transactions exist in the network that both want to empty an account?
Only one of the transactions can be valid, typically the one that is accepted first.
The problem is that ‚Äúfirst‚Äù is not an objective term in a peer-to-peer network.</p>
<p>The abstract answer to this is that you do not have to care. A globally accepted order of the transactions
will be selected for you, solving the conflict. The transactions will be bundled into what is called a ‚Äúblock‚Äù
and then they will be executed and distributed among all participating nodes.
If two transactions contradict each other, the one that ends up being second will
be rejected and not become part of the block.</p>
<p>These blocks form a linear sequence in time and that is where the word ‚Äúblockchain‚Äù
derives from. Blocks are added to the chain in rather regular intervals - for
Ethereum this is roughly every 17 seconds.</p>
<p>As part of the ‚Äúorder selection mechanism‚Äù (which is called ‚Äúmining‚Äù) it may happen that
blocks are reverted from time to time, but only at the ‚Äútip‚Äù of the chain. The more
blocks are added on top of a particular block, the less likely this block will be reverted. So it might be that your transactions
are reverted and even removed from the blockchain, but the longer you wait, the less
likely it will be.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Transactions are not guaranteed to be included in the next block or any specific future block,
since it is not up to the submitter of a transaction, but up to the miners to determine in which block the transaction is included.</p>
<p>If you want to schedule future calls of your contract, you can use
a smart contract automation tool or an oracle service.</p>
</div>
<span class="target" id="the-ethereum-virtual-machine"></span></section>
</section>
<section id="index-6">
<span id="id2"></span><h3>The Ethereum Virtual Machine<a class="headerlink" href="#index-6" title="Permalink to this heading">ÔÉÅ</a></h3>
<section id="overview">
<h4>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>The Ethereum Virtual Machine or EVM is the runtime environment
for smart contracts in Ethereum. It is not only sandboxed but
actually completely isolated, which means that code running
inside the EVM has no access to network, filesystem or other processes.
Smart contracts even have limited access to other smart contracts.</p>
</section>
<section id="accounts">
<span id="index-7"></span><span id="id3"></span><h4>Accounts<a class="headerlink" href="#accounts" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>There are two kinds of accounts in Ethereum which share the same
address space: <strong>External accounts</strong> that are controlled by
public-private key pairs (i.e. humans) and <strong>contract accounts</strong> which are
controlled by the code stored together with the account.</p>
<p>The address of an external account is determined from
the public key while the address of a contract is
determined at the time the contract is created
(it is derived from the creator address and the number
of transactions sent from that address, the so-called ‚Äúnonce‚Äù).</p>
<p>Regardless of whether or not the account stores code, the two types are
treated equally by the EVM.</p>
<p>Every account has a persistent key-value store mapping 256-bit words to 256-bit
words called <strong>storage</strong>.</p>
<p>Furthermore, every account has a <strong>balance</strong> in
Ether (in ‚ÄúWei‚Äù to be exact, <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">ether</span></code> is <code class="docutils literal notranslate"><span class="pre">10**18</span> <span class="pre">wei</span></code>) which can be modified by sending transactions that
include Ether.</p>
</section>
<section id="index-8">
<span id="id4"></span><h4>Transactions<a class="headerlink" href="#index-8" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>A transaction is a message that is sent from one account to another
account (which might be the same or empty, see below).
It can include binary data (which is called ‚Äúpayload‚Äù) and Ether.</p>
<p>If the target account contains code, that code is executed and
the payload is provided as input data.</p>
<p>If the target account is not set (the transaction does not have
a recipient or the recipient is set to <code class="docutils literal notranslate"><span class="pre">null</span></code>), the transaction
creates a <strong>new contract</strong>.
As already mentioned, the address of that contract is not
the zero address but an address derived from the sender and
its number of transactions sent (the ‚Äúnonce‚Äù). The payload
of such a contract creation transaction is taken to be
EVM bytecode and executed. The output data of this execution is
permanently stored as the code of the contract.
This means that in order to create a contract, you do not
send the actual code of the contract, but in fact code that
returns that code when executed.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>While a contract is being created, its code is still empty.
Because of that, you should not call back into the
contract under construction until its constructor has
finished executing.</p>
</div>
</section>
<section id="gas">
<span id="index-9"></span><h4>Gas<a class="headerlink" href="#gas" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Upon creation, each transaction is charged with a certain amount of <strong>gas</strong>
that has to be paid for by the originator of the transaction (<code class="docutils literal notranslate"><span class="pre">tx.origin</span></code>).
While the EVM executes the
transaction, the gas is gradually depleted according to specific rules.
If the gas is used up at any point (i.e. it would be negative),
an out-of-gas exception is triggered, which ends execution and reverts all modifications
made to the state in the current call frame.</p>
<p>This mechanism incentivizes economical use of EVM execution time
and also compensates EVM executors (i.e. miners / stakers) for their work.
Since each block has a maximum amount of gas, it also limits the amount
of work needed to validate a block.</p>
<p>The <strong>gas price</strong> is a value set by the originator of the transaction, who
has to pay <code class="docutils literal notranslate"><span class="pre">gas_price</span> <span class="pre">*</span> <span class="pre">gas</span></code> up front to the EVM executor.
If some gas is left after execution, it is refunded to the transaction originator.
In case of an exception that reverts changes, already used up gas is not refunded.</p>
<p>Since EVM executors can choose to include a transaction or not,
transaction senders cannot abuse the system by setting a low gas price.</p>
</section>
<section id="storage-memory-and-the-stack">
<span id="index-10"></span><h4>Storage, Memory and the Stack<a class="headerlink" href="#storage-memory-and-the-stack" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>The Ethereum Virtual Machine has three areas where it can store data:
storage, memory and the stack.</p>
<p>Each account has a data area called <strong>storage</strong>, which is persistent between function calls
and transactions.
Storage is a key-value store that maps 256-bit words to 256-bit words.
It is not possible to enumerate storage from within a contract, it is
comparatively costly to read, and even more to initialise and modify storage. Because of this cost,
you should minimize what you store in persistent storage to what the contract needs to run.
Store data like derived calculations, caching, and aggregates outside of the contract.
A contract can neither read nor write to any storage apart from its own.</p>
<p>The second data area is called <strong>memory</strong>, of which a contract obtains
a freshly cleared instance for each message call. Memory is linear and can be
addressed at byte level, but reads are limited to a width of 256 bits, while writes
can be either 8 bits or 256 bits wide. Memory is expanded by a word (256-bit), when
accessing (either reading or writing) a previously untouched memory word (i.e. any offset
within a word). At the time of expansion, the cost in gas must be paid. Memory is more
costly the larger it grows (it scales quadratically).</p>
<p>The EVM is not a register machine but a stack machine, so all
computations are performed on a data area called the <strong>stack</strong>. It has a maximum size of
1024 elements and contains words of 256 bits. Access to the stack is
limited to the top end in the following way:
It is possible to copy one of
the topmost 16 elements to the top of the stack or swap the
topmost element with one of the 16 elements below it.
All other operations take the topmost two (or one, or more, depending on
the operation) elements from the stack and push the result onto the stack.
Of course it is possible to move stack elements to storage or memory
in order to get deeper access to the stack,
but it is not possible to just access arbitrary elements deeper in the stack
without first removing the top of the stack.</p>
</section>
<section id="instruction-set">
<span id="index-11"></span><h4>Instruction Set<a class="headerlink" href="#instruction-set" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>The instruction set of the EVM is kept minimal in order to avoid
incorrect or inconsistent implementations which could cause consensus problems.
All instructions operate on the basic data type, 256-bit words or on slices of memory
(or other byte arrays).
The usual arithmetic, bit, logical and comparison operations are present.
Conditional and unconditional jumps are possible. Furthermore,
contracts can access relevant properties of the current block
like its number and timestamp.</p>
<p>For a complete list, please see the <a class="reference internal" href="index.html#opcodes"><span class="std std-ref">list of opcodes</span></a> as part of the inline
assembly documentation.</p>
</section>
<section id="message-calls">
<span id="index-12"></span><h4>Message Calls<a class="headerlink" href="#message-calls" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Contracts can call other contracts or send Ether to non-contract
accounts by the means of message calls. Message calls are similar
to transactions, in that they have a source, a target, data payload,
Ether, gas and return data. In fact, every transaction consists of
a top-level message call which in turn can create further message calls.</p>
<p>A contract can decide how much of its remaining <strong>gas</strong> should be sent
with the inner message call and how much it wants to retain.
If an out-of-gas exception happens in the inner call (or any
other exception), this will be signaled by an error value put onto the stack.
In this case, only the gas sent together with the call is used up.
In Solidity, the calling contract causes a manual exception by default in
such situations, so that exceptions ‚Äúbubble up‚Äù the call stack.</p>
<p>As already said, the called contract (which can be the same as the caller)
will receive a freshly cleared instance of memory and has access to the
call payload - which will be provided in a separate area called the <strong>calldata</strong>.
After it has finished execution, it can return data which will be stored at
a location in the caller‚Äôs memory preallocated by the caller.
All such calls are fully synchronous.</p>
<p>Calls are <strong>limited</strong> to a depth of 1024, which means that for more complex
operations, loops should be preferred over recursive calls. Furthermore,
only 63/64th of the gas can be forwarded in a message call, which causes a
depth limit of a little less than 1000 in practice.</p>
</section>
<section id="delegatecall-callcode-and-libraries">
<span id="index-13"></span><h4>Delegatecall / Callcode and Libraries<a class="headerlink" href="#delegatecall-callcode-and-libraries" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>There exists a special variant of a message call, named <strong>delegatecall</strong>
which is identical to a message call apart from the fact that
the code at the target address is executed in the context (i.e. at the address) of the calling
contract and <code class="docutils literal notranslate"><span class="pre">msg.sender</span></code> and <code class="docutils literal notranslate"><span class="pre">msg.value</span></code> do not change their values.</p>
<p>This means that a contract can dynamically load code from a different
address at runtime. Storage, current address and balance still
refer to the calling contract, only the code is taken from the called address.</p>
<p>This makes it possible to implement the ‚Äúlibrary‚Äù feature in Solidity:
Reusable library code that can be applied to a contract‚Äôs storage, e.g. in
order to implement a complex data structure.</p>
</section>
<section id="logs">
<span id="index-14"></span><h4>Logs<a class="headerlink" href="#logs" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>It is possible to store data in a specially indexed data structure
that maps all the way up to the block level. This feature called <strong>logs</strong>
is used by Solidity in order to implement <a class="reference internal" href="index.html#events"><span class="std std-ref">events</span></a>.
Contracts cannot access log data after it has been created, but they
can be efficiently accessed from outside the blockchain.
Since some part of the log data is stored in <a class="reference external" href="https://en.wikipedia.org/wiki/Bloom_filter">bloom filters</a>, it is
possible to search for this data in an efficient and cryptographically
secure way, so network peers that do not download the whole blockchain
(so-called ‚Äúlight clients‚Äù) can still find these logs.</p>
</section>
<section id="create">
<span id="index-15"></span><h4>Create<a class="headerlink" href="#create" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Contracts can even create other contracts using a special opcode (i.e.
they do not simply call the zero address as a transaction would). The only difference between
these <strong>create calls</strong> and normal message calls is that the payload data is
executed and the result stored as code and the caller / creator
receives the address of the new contract on the stack.</p>
</section>
<section id="deactivate-and-self-destruct">
<span id="index-16"></span><h4>Deactivate and Self-destruct<a class="headerlink" href="#deactivate-and-self-destruct" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>The only way to remove code from the blockchain is when a contract at that
address performs the <code class="docutils literal notranslate"><span class="pre">selfdestruct</span></code> operation. The remaining Ether stored
at that address is sent to a designated target and then the storage and code
is removed from the state. Removing the contract in theory sounds like a good
idea, but it is potentially dangerous, as if someone sends Ether to removed
contracts, the Ether is forever lost.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Even if a contract is removed by <code class="docutils literal notranslate"><span class="pre">selfdestruct</span></code>, it is still part of the
history of the blockchain and probably retained by most Ethereum nodes.
So using <code class="docutils literal notranslate"><span class="pre">selfdestruct</span></code> is not the same as deleting data from a hard disk.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Even if a contract‚Äôs code does not contain a call to <code class="docutils literal notranslate"><span class="pre">selfdestruct</span></code>,
it can still perform that operation using <code class="docutils literal notranslate"><span class="pre">delegatecall</span></code> or <code class="docutils literal notranslate"><span class="pre">callcode</span></code>.</p>
</div>
<p>If you want to deactivate your contracts, you should instead <strong>disable</strong> them
by changing some internal state which causes all functions to revert. This
makes it impossible to use the contract, as it returns Ether immediately.</p>
</section>
<section id="precompiled-contracts">
<span id="precompiledcontracts"></span><span id="index-17"></span><h4>Precompiled Contracts<a class="headerlink" href="#precompiled-contracts" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>There is a small set of contract addresses that are special:
The address range between <code class="docutils literal notranslate"><span class="pre">1</span></code> and (including) <code class="docutils literal notranslate"><span class="pre">8</span></code> contains
‚Äúprecompiled contracts‚Äù that can be called as any other contract
but their behaviour (and their gas consumption) is not defined
by EVM code stored at that address (they do not contain code)
but instead is implemented in the EVM execution environment itself.</p>
<p>Different EVM-compatible chains might use a different set of
precompiled contracts. It might also be possible that new
precompiled contracts are added to the Ethereum main chain in the future,
but you can reasonably expect them to always be in the range between
<code class="docutils literal notranslate"><span class="pre">1</span></code> and <code class="docutils literal notranslate"><span class="pre">0xffff</span></code> (inclusive).</p>
</section>
</section>
</section>
<span id="document-installing-solidity"></span><section id="installing-the-solidity-compiler">
<span id="installing-solidity"></span><span id="index-0"></span><h2>Installing the Solidity Compiler<a class="headerlink" href="#installing-the-solidity-compiler" title="Permalink to this heading">ÔÉÅ</a></h2>
<section id="versioning">
<h3>Versioning<a class="headerlink" href="#versioning" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Solidity versions follow <a class="reference external" href="https://semver.org">Semantic Versioning</a>. In
addition, patch level releases with major release 0 (i.e. 0.x.y) will not
contain breaking changes. That means code that compiles with version 0.x.y
can be expected to compile with 0.x.z where z &gt; y.</p>
<p>In addition to releases, we provide <strong>nightly development builds</strong> with the
intention of making it easy for developers to try out upcoming features and
provide early feedback. Note, however, that while the nightly builds are usually
very stable, they contain bleeding-edge code from the development branch and are
not guaranteed to be always working. Despite our best efforts, they might
contain undocumented and/or broken changes that will not become a part of an
actual release. They are not meant for production use.</p>
<p>When deploying contracts, you should use the latest released version of Solidity. This
is because breaking changes, as well as new features and bug fixes are introduced regularly.
We currently use a 0.x version number <a class="reference external" href="https://semver.org/#spec-item-4">to indicate this fast pace of change</a>.</p>
</section>
<section id="remix">
<h3>Remix<a class="headerlink" href="#remix" title="Permalink to this heading">ÔÉÅ</a></h3>
<p><em>We recommend Remix for small contracts and for quickly learning Solidity.</em></p>
<p><a class="reference external" href="https://remix.ethereum.org/">Access Remix online</a>, you do not need to install anything.
If you want to use it without connection to the Internet, go to
<a class="reference external" href="https://github.com/ethereum/remix-live/tree/gh-pages">https://github.com/ethereum/remix-live/tree/gh-pages</a> and download the <code class="docutils literal notranslate"><span class="pre">.zip</span></code> file as
explained on that page. Remix is also a convenient option for testing nightly builds
without installing multiple Solidity versions.</p>
<p>Further options on this page detail installing commandline Solidity compiler software
on your computer. Choose a commandline compiler if you are working on a larger contract
or if you require more compilation options.</p>
</section>
<section id="npm-node-js">
<span id="solcjs"></span><h3>npm / Node.js<a class="headerlink" href="#npm-node-js" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Use <code class="docutils literal notranslate"><span class="pre">npm</span></code> for a convenient and portable way to install <code class="docutils literal notranslate"><span class="pre">solcjs</span></code>, a Solidity compiler. The
<cite>solcjs</cite> program has fewer features than the ways to access the compiler described
further down this page. The
<a class="reference internal" href="index.html#commandline-compiler"><span class="std std-ref">Using the Commandline Compiler</span></a> documentation assumes you are using
the full-featured compiler, <code class="docutils literal notranslate"><span class="pre">solc</span></code>. The usage of <code class="docutils literal notranslate"><span class="pre">solcjs</span></code> is documented inside its own
<a class="reference external" href="https://github.com/ethereum/solc-js">repository</a>.</p>
<p>Note: The solc-js project is derived from the C++
<cite>solc</cite> by using Emscripten which means that both use the same compiler source code.
<cite>solc-js</cite> can be used in JavaScript projects directly (such as Remix).
Please refer to the solc-js repository for instructions.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>npm install -g solc
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The commandline executable is named <code class="docutils literal notranslate"><span class="pre">solcjs</span></code>.</p>
<p>The commandline options of <code class="docutils literal notranslate"><span class="pre">solcjs</span></code> are not compatible with <code class="docutils literal notranslate"><span class="pre">solc</span></code> and tools (such as <code class="docutils literal notranslate"><span class="pre">geth</span></code>)
expecting the behaviour of <code class="docutils literal notranslate"><span class="pre">solc</span></code> will not work with <code class="docutils literal notranslate"><span class="pre">solcjs</span></code>.</p>
</div>
</section>
<section id="docker">
<h3>Docker<a class="headerlink" href="#docker" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Docker images of Solidity builds are available using the <code class="docutils literal notranslate"><span class="pre">solc</span></code> image from the <code class="docutils literal notranslate"><span class="pre">ethereum</span></code> organisation.
Use the <code class="docutils literal notranslate"><span class="pre">stable</span></code> tag for the latest released version, and <code class="docutils literal notranslate"><span class="pre">nightly</span></code> for potentially unstable changes in the develop branch.</p>
<p>The Docker image runs the compiler executable, so you can pass all compiler arguments to it.
For example, the command below pulls the stable version of the <code class="docutils literal notranslate"><span class="pre">solc</span></code> image (if you do not have it already),
and runs it in a new container, passing the <code class="docutils literal notranslate"><span class="pre">--help</span></code> argument.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker run ethereum/solc:stable --help
</pre></div>
</div>
<p>You can also specify release build versions in the tag, for example, for the 0.5.4 release.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker run ethereum/solc:0.5.4 --help
</pre></div>
</div>
<p>To use the Docker image to compile Solidity files on the host machine mount a
local folder for input and output, and specify the contract to compile. For example.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker run -v /local/path:/sources ethereum/solc:stable -o /sources/output --abi --bin /sources/Contract.sol
</pre></div>
</div>
<p>You can also use the standard JSON interface (which is recommended when using the compiler with tooling).
When using this interface it is not necessary to mount any directories as long as the JSON input is
self-contained (i.e. it does not refer to any external files that would have to be
<a class="reference internal" href="index.html#initial-vfs-content-standard-json-with-import-callback"><span class="std std-ref">loaded by the import callback</span></a>).</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker run ethereum/solc:stable --standard-json &lt; input.json &gt; output.json
</pre></div>
</div>
</section>
<section id="linux-packages">
<h3>Linux Packages<a class="headerlink" href="#linux-packages" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Binary packages of Solidity are available at
<a class="reference external" href="https://github.com/ethereum/solidity/releases">solidity/releases</a>.</p>
<p>We also have PPAs for Ubuntu, you can get the latest stable
version using the following commands:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo add-apt-repository ppa:ethereum/ethereum
sudo apt-get update
sudo apt-get install solc
</pre></div>
</div>
<p>The nightly version can be installed using these commands:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo add-apt-repository ppa:ethereum/ethereum
sudo add-apt-repository ppa:ethereum/ethereum-dev
sudo apt-get update
sudo apt-get install solc
</pre></div>
</div>
<p>Furthermore, some Linux distributions provide their own packages. These packages are not directly
maintained by us, but usually kept up-to-date by the respective package maintainers.</p>
<p>For example, Arch Linux has packages for the latest development version:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pacman -S solidity
</pre></div>
</div>
<p>There is also a <a class="reference external" href="https://snapcraft.io/solc">snap package</a>, however, it is <strong>currently unmaintained</strong>.
It is installable in all the <a class="reference external" href="https://snapcraft.io/docs/core/install">supported Linux distros</a>. To
install the latest stable version of solc:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo snap install solc
</pre></div>
</div>
<p>If you want to help testing the latest development version of Solidity
with the most recent changes, please use the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo snap install solc --edge
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">solc</span></code> snap uses strict confinement. This is the most secure mode for snap packages
but it comes with limitations, like accessing only the files in your <code class="docutils literal notranslate"><span class="pre">/home</span></code> and <code class="docutils literal notranslate"><span class="pre">/media</span></code> directories.
For more information, go to <a class="reference external" href="https://snapcraft.io/blog/demystifying-snap-confinement">Demystifying Snap Confinement</a>.</p>
</div>
</section>
<section id="macos-packages">
<h3>macOS Packages<a class="headerlink" href="#macos-packages" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>We distribute the Solidity compiler through Homebrew
as a build-from-source version. Pre-built bottles are
currently not supported.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>brew update
brew upgrade
brew tap ethereum/ethereum
brew install solidity
</pre></div>
</div>
<p>To install the most recent 0.4.x / 0.5.x version of Solidity you can also use <code class="docutils literal notranslate"><span class="pre">brew</span> <span class="pre">install</span> <span class="pre">solidity&#64;4</span></code>
and <code class="docutils literal notranslate"><span class="pre">brew</span> <span class="pre">install</span> <span class="pre">solidity&#64;5</span></code>, respectively.</p>
<p>If you need a specific version of Solidity you can install a
Homebrew formula directly from Github.</p>
<p>View
<a class="reference external" href="https://github.com/ethereum/homebrew-ethereum/commits/master/solidity.rb">solidity.rb commits on Github</a>.</p>
<p>Copy the commit hash of the version you want and check it out on your machine.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git clone https://github.com/ethereum/homebrew-ethereum.git
<span class="nb">cd</span> homebrew-ethereum
git checkout &lt;your-hash-goes-here&gt;
</pre></div>
</div>
<p>Install it using <code class="docutils literal notranslate"><span class="pre">brew</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>brew unlink solidity
<span class="c1"># eg. Install 0.4.8</span>
brew install solidity.rb
</pre></div>
</div>
</section>
<section id="static-binaries">
<h3>Static Binaries<a class="headerlink" href="#static-binaries" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>We maintain a repository containing static builds of past and current compiler versions for all
supported platforms at <a class="reference external" href="https://github.com/ethereum/solc-bin/">solc-bin</a>. This is also the location where you can find the nightly builds.</p>
<p>The repository is not only a quick and easy way for end users to get binaries ready to be used
out-of-the-box but it is also meant to be friendly to third-party tools:</p>
<ul class="simple">
<li><p>The content is mirrored to <a class="reference external" href="https://binaries.soliditylang.org">https://binaries.soliditylang.org</a> where it can be easily downloaded over
HTTPS without any authentication, rate limiting or the need to use git.</p></li>
<li><p>Content is served with correct <cite>Content-Type</cite> headers and lenient CORS configuration so that it
can be directly loaded by tools running in the browser.</p></li>
<li><p>Binaries do not require installation or unpacking (with the exception of older Windows builds
bundled with necessary DLLs).</p></li>
<li><p>We strive for a high level of backwards-compatibility. Files, once added, are not removed or moved
without providing a symlink/redirect at the old location. They are also never modified
in place and should always match the original checksum. The only exception would be broken or
unusable files with a potential to cause more harm than good if left as is.</p></li>
<li><p>Files are served over both HTTP and HTTPS. As long as you obtain the file list in a secure way
(via git, HTTPS, IPFS or just have it cached locally) and verify hashes of the binaries
after downloading them, you do not have to use HTTPS for the binaries themselves.</p></li>
</ul>
<p>The same binaries are in most cases available on the <a class="reference external" href="https://github.com/ethereum/solidity/releases">Solidity release page on Github</a>. The
difference is that we do not generally update old releases on the Github release page. This means
that we do not rename them if the naming convention changes and we do not add builds for platforms
that were not supported at the time of release. This only happens in <code class="docutils literal notranslate"><span class="pre">solc-bin</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">solc-bin</span></code> repository contains several top-level directories, each representing a single platform.
Each one contains a <code class="docutils literal notranslate"><span class="pre">list.json</span></code> file listing the available binaries. For example in
<code class="docutils literal notranslate"><span class="pre">emscripten-wasm32/list.json</span></code> you will find the following information about version 0.7.4:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;solc-emscripten-wasm32-v0.7.4+commit.3f05b770.js&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0.7.4&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;build&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;commit.3f05b770&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;longVersion&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0.7.4+commit.3f05b770&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;keccak256&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0x300330ecd127756b824aa13e843cb1f43c473cb22eaf3750d5fb9c99279af8c3&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;sha256&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0x2b55ed5fec4d9625b6c7b3ab1abd2b7fb7dd2a9c68543bf0323db2c7e2d55af2&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;urls&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">    </span><span class="s2">&quot;bzzr://16c5f09109c793db99fe35f037c6092b061bd39260ee7a677c8a97f18c955ab1&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="s2">&quot;dweb:/ipfs/QmTLs5MuLEWXQkths41HiACoXDiH8zxyqBHGFDRSzVE5CS&quot;</span><span class="w"></span>
<span class="w">  </span><span class="p">]</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>This means that:</p>
<ul class="simple">
<li><p>You can find the binary in the same directory under the name
<a class="reference external" href="https://github.com/ethereum/solc-bin/blob/gh-pages/emscripten-wasm32/solc-emscripten-wasm32-v0.7.4+commit.3f05b770.js">solc-emscripten-wasm32-v0.7.4+commit.3f05b770.js</a>.
Note that the file might be a symlink, and you will need to resolve it yourself if you are not using
git to download it or your file system does not support symlinks.</p></li>
<li><p>The binary is also mirrored at <a class="reference external" href="https://binaries.soliditylang.org/emscripten-wasm32/solc-emscripten-wasm32-v0.7.4+commit.3f05b770.js">https://binaries.soliditylang.org/emscripten-wasm32/solc-emscripten-wasm32-v0.7.4+commit.3f05b770.js</a>.
In this case git is not necessary and symlinks are resolved transparently, either by serving a copy
of the file or returning a HTTP redirect.</p></li>
<li><p>The file is also available on IPFS at <a class="reference external" href="https://gateway.ipfs.io/ipfs/QmTLs5MuLEWXQkths41HiACoXDiH8zxyqBHGFDRSzVE5CS">QmTLs5MuLEWXQkths41HiACoXDiH8zxyqBHGFDRSzVE5CS</a>.</p></li>
<li><p>The file might in future be available on Swarm at <a class="reference external" href="https://swarm-gateways.net/bzz:/16c5f09109c793db99fe35f037c6092b061bd39260ee7a677c8a97f18c955ab1/">16c5f09109c793db99fe35f037c6092b061bd39260ee7a677c8a97f18c955ab1</a>.</p></li>
<li><p>You can verify the integrity of the binary by comparing its keccak256 hash to
<code class="docutils literal notranslate"><span class="pre">0x300330ecd127756b824aa13e843cb1f43c473cb22eaf3750d5fb9c99279af8c3</span></code>.  The hash can be computed
on the command line using <code class="docutils literal notranslate"><span class="pre">keccak256sum</span></code> utility provided by <a class="reference external" href="https://github.com/maandree/sha3sum">sha3sum</a> or <a class="reference external" href="https://github.com/ethereumjs/ethereumjs-util/blob/master/docs/modules/_hash_.md#const-keccak256">keccak256() function
from ethereumjs-util</a> in JavaScript.</p></li>
<li><p>You can also verify the integrity of the binary by comparing its sha256 hash to
<code class="docutils literal notranslate"><span class="pre">0x2b55ed5fec4d9625b6c7b3ab1abd2b7fb7dd2a9c68543bf0323db2c7e2d55af2</span></code>.</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Due to the strong backwards compatibility requirement the repository contains some legacy elements
but you should avoid using them when writing new tools:</p>
<ul class="simple">
<li><p>Use <code class="docutils literal notranslate"><span class="pre">emscripten-wasm32/</span></code> (with a fallback to <code class="docutils literal notranslate"><span class="pre">emscripten-asmjs/</span></code>) instead of <code class="docutils literal notranslate"><span class="pre">bin/</span></code> if
you want the best performance. Until version 0.6.1 we only provided asm.js binaries.
Starting with 0.6.2 we switched to <a class="reference external" href="https://emscripten.org/docs/compiling/WebAssembly.html">WebAssembly builds</a> with much better performance. We have
rebuilt the older versions for wasm but the original asm.js files remain in <code class="docutils literal notranslate"><span class="pre">bin/</span></code>.
The new ones had to be placed in a separate directory to avoid name clashes.</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">emscripten-asmjs/</span></code> and <code class="docutils literal notranslate"><span class="pre">emscripten-wasm32/</span></code> instead of <code class="docutils literal notranslate"><span class="pre">bin/</span></code> and <code class="docutils literal notranslate"><span class="pre">wasm/</span></code> directories
if you want to be sure whether you are downloading a wasm or an asm.js binary.</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">list.json</span></code> instead of <code class="docutils literal notranslate"><span class="pre">list.js</span></code> and <code class="docutils literal notranslate"><span class="pre">list.txt</span></code>. The JSON list format contains all
the information from the old ones and more.</p></li>
<li><p>Use <a class="reference external" href="https://binaries.soliditylang.org">https://binaries.soliditylang.org</a> instead of <a class="reference external" href="https://solc-bin.ethereum.org">https://solc-bin.ethereum.org</a>. To keep things
simple we moved almost everything related to the compiler under the new <code class="docutils literal notranslate"><span class="pre">soliditylang.org</span></code>
domain and this applies to <code class="docutils literal notranslate"><span class="pre">solc-bin</span></code> too. While the new domain is recommended, the old one
is still fully supported and guaranteed to point at the same location.</p></li>
</ul>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The binaries are also available at <a class="reference external" href="https://ethereum.github.io/solc-bin/">https://ethereum.github.io/solc-bin/</a> but this page
stopped being updated just after the release of version 0.7.2, will not receive any new releases
or nightly builds for any platform and does not serve the new directory structure, including
non-emscripten builds.</p>
<p>If you are using it, please switch to <a class="reference external" href="https://binaries.soliditylang.org">https://binaries.soliditylang.org</a>, which is a drop-in
replacement. This allows us to make changes to the underlying hosting in a transparent way and
minimize disruption. Unlike the <code class="docutils literal notranslate"><span class="pre">ethereum.github.io</span></code> domain, which we do not have any control
over, <code class="docutils literal notranslate"><span class="pre">binaries.soliditylang.org</span></code> is guaranteed to work and maintain the same URL structure
in the long-term.</p>
</div>
</section>
<section id="building-from-source">
<span id="id1"></span><h3>Building from Source<a class="headerlink" href="#building-from-source" title="Permalink to this heading">ÔÉÅ</a></h3>
<section id="prerequisites-all-operating-systems">
<h4>Prerequisites - All Operating Systems<a class="headerlink" href="#prerequisites-all-operating-systems" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>The following are dependencies for all builds of Solidity:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 39%" />
<col style="width: 61%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Software</p></th>
<th class="head"><p>Notes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference external" href="https://cmake.org/download/">CMake</a> (version 3.13+)</p></td>
<td><p>Cross-platform build file generator.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="https://www.boost.org">Boost</a> (version 1.77+ on
Windows, 1.65+ otherwise)</p></td>
<td><p>C++ libraries.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference external" href="https://git-scm.com/download">Git</a></p></td>
<td><p>Command-line tool for retrieving source code.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="https://github.com/Z3Prover/z3">z3</a> (version 4.8+, Optional)</p></td>
<td><p>For use with SMT checker.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference external" href="https://cvc4.cs.stanford.edu/web/">cvc4</a> (Optional)</p></td>
<td><p>For use with SMT checker.</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Solidity versions prior to 0.5.10 can fail to correctly link against Boost versions 1.70+.
A possible workaround is to temporarily rename <code class="docutils literal notranslate"><span class="pre">&lt;Boost</span> <span class="pre">install</span> <span class="pre">path&gt;/lib/cmake/Boost-1.70.0</span></code>
prior to running the cmake command to configure solidity.</p>
<p>Starting from 0.5.10 linking against Boost 1.70+ should work without manual intervention.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The default build configuration requires a specific Z3 version (the latest one at the time the
code was last updated). Changes introduced between Z3 releases often result in slightly different
(but still valid) results being returned. Our SMT tests do not account for these differences and
will likely fail with a different version than the one they were written for. This does not mean
that a build using a different version is faulty. If you pass <code class="docutils literal notranslate"><span class="pre">-DSTRICT_Z3_VERSION=OFF</span></code> option
to CMake, you can build with any version that satisfies the requirement given in the table above.
If you do this, however, please remember to pass the <code class="docutils literal notranslate"><span class="pre">--no-smt</span></code> option to <code class="docutils literal notranslate"><span class="pre">scripts/tests.sh</span></code>
to skip the SMT tests.</p>
</div>
<section id="minimum-compiler-versions">
<h5>Minimum Compiler Versions<a class="headerlink" href="#minimum-compiler-versions" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>The following C++ compilers and their minimum versions can build the Solidity codebase:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://gcc.gnu.org">GCC</a>, version 8+</p></li>
<li><p><a class="reference external" href="https://clang.llvm.org/">Clang</a>, version 7+</p></li>
<li><p><a class="reference external" href="https://visualstudio.microsoft.com/vs/">MSVC</a>, version 2019+</p></li>
</ul>
</section>
</section>
<section id="prerequisites-macos">
<h4>Prerequisites - macOS<a class="headerlink" href="#prerequisites-macos" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>For macOS builds, ensure that you have the latest version of
<a class="reference external" href="https://developer.apple.com/xcode/download/">Xcode installed</a>.
This contains the <a class="reference external" href="https://en.wikipedia.org/wiki/Clang">Clang C++ compiler</a>, the
<a class="reference external" href="https://en.wikipedia.org/wiki/Xcode">Xcode IDE</a> and other Apple development
tools that are required for building C++ applications on OS X.
If you are installing Xcode for the first time, or have just installed a new
version then you will need to agree to the license before you can do
command-line builds:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo xcodebuild -license accept
</pre></div>
</div>
<p>Our OS X build script uses <a class="reference external" href="https://brew.sh">the Homebrew</a>
package manager for installing external dependencies.
Here‚Äôs how to <a class="reference external" href="https://docs.brew.sh/FAQ#how-do-i-uninstall-homebrew">uninstall Homebrew</a>,
if you ever want to start again from scratch.</p>
</section>
<section id="prerequisites-windows">
<h4>Prerequisites - Windows<a class="headerlink" href="#prerequisites-windows" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>You need to install the following dependencies for Windows builds of Solidity:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 39%" />
<col style="width: 61%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Software</p></th>
<th class="head"><p>Notes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference external" href="https://www.visualstudio.com/downloads/#build-tools-for-visual-studio-2019">Visual Studio 2019 Build Tools</a></p></td>
<td><p>C++ compiler</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="https://www.visualstudio.com/vs/">Visual Studio 2019</a>  (Optional)</p></td>
<td><p>C++ compiler and dev environment.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference external" href="https://www.boost.org">Boost</a> (version 1.77+)</p></td>
<td><p>C++ libraries.</p></td>
</tr>
</tbody>
</table>
<p>If you already have one IDE and only need the compiler and libraries,
you could install Visual Studio 2019 Build Tools.</p>
<p>Visual Studio 2019 provides both IDE and necessary compiler and libraries.
So if you have not got an IDE and prefer to develop Solidity, Visual Studio 2019
may be a choice for you to get everything setup easily.</p>
<p>Here is the list of components that should be installed
in Visual Studio 2019 Build Tools or Visual Studio 2019:</p>
<ul class="simple">
<li><p>Visual Studio C++ core features</p></li>
<li><p>VC++ 2019 v141 toolset (x86,x64)</p></li>
<li><p>Windows Universal CRT SDK</p></li>
<li><p>Windows 8.1 SDK</p></li>
<li><p>C++/CLI support</p></li>
</ul>
<p>We have a helper script which you can use to install all required external dependencies:</p>
<div class="highlight-bat notranslate"><div class="highlight"><pre><span></span>scripts\install_deps.ps1
</pre></div>
</div>
<p>This will install <code class="docutils literal notranslate"><span class="pre">boost</span></code> and <code class="docutils literal notranslate"><span class="pre">cmake</span></code> to the <code class="docutils literal notranslate"><span class="pre">deps</span></code> subdirectory.</p>
</section>
<section id="clone-the-repository">
<h4>Clone the Repository<a class="headerlink" href="#clone-the-repository" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>To clone the source code, execute the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git clone --recursive https://github.com/ethereum/solidity.git
<span class="nb">cd</span> solidity
</pre></div>
</div>
<p>If you want to help developing Solidity,
you should fork Solidity and add your personal fork as a second remote:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git remote add personal git@github.com:<span class="o">[</span>username<span class="o">]</span>/solidity.git
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This method will result in a prerelease build leading to e.g. a flag
being set in each bytecode produced by such a compiler.
If you want to re-build a released Solidity compiler, then
please use the source tarball on the github release page:</p>
<p><a class="reference external" href="https://github.com/ethereum/solidity/releases/download/v0.X.Y/solidity_0.X.Y.tar.gz">https://github.com/ethereum/solidity/releases/download/v0.X.Y/solidity_0.X.Y.tar.gz</a></p>
<p>(not the ‚ÄúSource code‚Äù provided by github).</p>
</div>
</section>
<section id="command-line-build">
<h4>Command-Line Build<a class="headerlink" href="#command-line-build" title="Permalink to this heading">ÔÉÅ</a></h4>
<p><strong>Be sure to install External Dependencies (see above) before build.</strong></p>
<p>Solidity project uses CMake to configure the build.
You might want to install <a class="reference external" href="https://ccache.dev/">ccache</a> to speed up repeated builds.
CMake will pick it up automatically.
Building Solidity is quite similar on Linux, macOS and other Unices:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir build
<span class="nb">cd</span> build
cmake .. <span class="o">&amp;&amp;</span> make
</pre></div>
</div>
<p>or even easier on Linux and macOS, you can run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">#note: this will install binaries solc and soltest at usr/local/bin</span>
./scripts/build.sh
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>BSD builds should work, but are untested by the Solidity team.</p>
</div>
<p>And for Windows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir build
<span class="nb">cd</span> build
cmake -G <span class="s2">&quot;Visual Studio 16 2019&quot;</span> ..
</pre></div>
</div>
<p>In case you want to use the version of boost installed by <code class="docutils literal notranslate"><span class="pre">scripts\install_deps.ps1</span></code>, you will
additionally need to pass <code class="docutils literal notranslate"><span class="pre">-DBoost_DIR=&quot;deps\boost\lib\cmake\Boost-*&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">-DCMAKE_MSVC_RUNTIME_LIBRARY=MultiThreaded</span></code>
as arguments to the call to <code class="docutils literal notranslate"><span class="pre">cmake</span></code>.</p>
<p>This should result in the creation of <strong>solidity.sln</strong> in that build directory.
Double-clicking on that file should result in Visual Studio firing up.  We suggest building
<strong>Release</strong> configuration, but all others work.</p>
<p>Alternatively, you can build for Windows on the command-line, like so:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cmake --build . --config Release
</pre></div>
</div>
</section>
</section>
<section id="cmake-options">
<h3>CMake Options<a class="headerlink" href="#cmake-options" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>If you are interested what CMake options are available run <code class="docutils literal notranslate"><span class="pre">cmake</span> <span class="pre">..</span> <span class="pre">-LH</span></code>.</p>
<section id="smt-solvers">
<span id="smt-solvers-build"></span><h4>SMT Solvers<a class="headerlink" href="#smt-solvers" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Solidity can be built against SMT solvers and will do so by default if
they are found in the system. Each solver can be disabled by a <cite>cmake</cite> option.</p>
<p><em>Note: In some cases, this can also be a potential workaround for build failures.</em></p>
<p>Inside the build folder you can disable them, since they are enabled by default:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># disables only Z3 SMT Solver.</span>
cmake .. -DUSE_Z3<span class="o">=</span>OFF

<span class="c1"># disables only CVC4 SMT Solver.</span>
cmake .. -DUSE_CVC4<span class="o">=</span>OFF

<span class="c1"># disables both Z3 and CVC4</span>
cmake .. -DUSE_CVC4<span class="o">=</span>OFF -DUSE_Z3<span class="o">=</span>OFF
</pre></div>
</div>
</section>
</section>
<section id="the-version-string-in-detail">
<h3>The Version String in Detail<a class="headerlink" href="#the-version-string-in-detail" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>The Solidity version string contains four parts:</p>
<ul class="simple">
<li><p>the version number</p></li>
<li><p>pre-release tag, usually set to <code class="docutils literal notranslate"><span class="pre">develop.YYYY.MM.DD</span></code> or <code class="docutils literal notranslate"><span class="pre">nightly.YYYY.MM.DD</span></code></p></li>
<li><p>commit in the format of <code class="docutils literal notranslate"><span class="pre">commit.GITHASH</span></code></p></li>
<li><p>platform, which has an arbitrary number of items, containing details about the platform and compiler</p></li>
</ul>
<p>If there are local modifications, the commit will be postfixed with <code class="docutils literal notranslate"><span class="pre">.mod</span></code>.</p>
<p>These parts are combined as required by SemVer, where the Solidity pre-release tag equals to the SemVer pre-release
and the Solidity commit and platform combined make up the SemVer build metadata.</p>
<p>A release example: <code class="docutils literal notranslate"><span class="pre">0.4.8+commit.60cc1668.Emscripten.clang</span></code>.</p>
<p>A pre-release example: <code class="docutils literal notranslate"><span class="pre">0.4.9-nightly.2017.1.17+commit.6ecb4aa3.Emscripten.clang</span></code></p>
</section>
<section id="important-information-about-versioning">
<h3>Important Information About Versioning<a class="headerlink" href="#important-information-about-versioning" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>After a release is made, the patch version level is bumped, because we assume that only
patch level changes follow. When changes are merged, the version should be bumped according
to SemVer and the severity of the change. Finally, a release is always made with the version
of the current nightly build, but without the <code class="docutils literal notranslate"><span class="pre">prerelease</span></code> specifier.</p>
<p>Example:</p>
<ol class="arabic simple">
<li><p>The 0.4.0 release is made.</p></li>
<li><p>The nightly build has a version of 0.4.1 from now on.</p></li>
<li><p>Non-breaking changes are introduced ‚Äì&gt; no change in version.</p></li>
<li><p>A breaking change is introduced ‚Äì&gt; version is bumped to 0.5.0.</p></li>
<li><p>The 0.5.0 release is made.</p></li>
</ol>
<p>This behaviour works well with the  <a class="reference internal" href="index.html#version-pragma"><span class="std std-ref">version pragma</span></a>.</p>
</section>
</section>
<span id="document-solidity-by-example"></span><section id="solidity-by-example">
<h2>Solidity by Example<a class="headerlink" href="#solidity-by-example" title="Permalink to this heading">ÔÉÅ</a></h2>
<section id="voting">
<span id="index-0"></span><span id="id1"></span><h3>Voting<a class="headerlink" href="#voting" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>The following contract is quite complex, but showcases
a lot of Solidity‚Äôs features. It implements a voting
contract. Of course, the main problems of electronic
voting is how to assign voting rights to the correct
persons and how to prevent manipulation. We will not
solve all problems here, but at least we will show
how delegated voting can be done so that vote counting
is <strong>automatic and completely transparent</strong> at the
same time.</p>
<p>The idea is to create one contract per ballot,
providing a short name for each option.
Then the creator of the contract who serves as
chairperson will give the right to vote to each
address individually.</p>
<p>The persons behind the addresses can then choose
to either vote themselves or to delegate their
vote to a person they trust.</p>
<p>At the end of the voting time, <code class="docutils literal notranslate"><span class="pre">winningProposal()</span></code>
will return the proposal with the largest number
of votes.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC43LjAgPDAuOS4wOwovLy8gQHRpdGxlIFZvdGluZyB3aXRoIGRlbGVnYXRpb24uCmNvbnRyYWN0IEJhbGxvdCB7CiAgICAvLyBUaGlzIGRlY2xhcmVzIGEgbmV3IGNvbXBsZXggdHlwZSB3aGljaCB3aWxsCiAgICAvLyBiZSB1c2VkIGZvciB2YXJpYWJsZXMgbGF0ZXIuCiAgICAvLyBJdCB3aWxsIHJlcHJlc2VudCBhIHNpbmdsZSB2b3Rlci4KICAgIHN0cnVjdCBWb3RlciB7CiAgICAgICAgdWludCB3ZWlnaHQ7IC8vIHdlaWdodCBpcyBhY2N1bXVsYXRlZCBieSBkZWxlZ2F0aW9uCiAgICAgICAgYm9vbCB2b3RlZDsgIC8vIGlmIHRydWUsIHRoYXQgcGVyc29uIGFscmVhZHkgdm90ZWQKICAgICAgICBhZGRyZXNzIGRlbGVnYXRlOyAvLyBwZXJzb24gZGVsZWdhdGVkIHRvCiAgICAgICAgdWludCB2b3RlOyAgIC8vIGluZGV4IG9mIHRoZSB2b3RlZCBwcm9wb3NhbAogICAgfQoKICAgIC8vIFRoaXMgaXMgYSB0eXBlIGZvciBhIHNpbmdsZSBwcm9wb3NhbC4KICAgIHN0cnVjdCBQcm9wb3NhbCB7CiAgICAgICAgYnl0ZXMzMiBuYW1lOyAgIC8vIHNob3J0IG5hbWUgKHVwIHRvIDMyIGJ5dGVzKQogICAgICAgIHVpbnQgdm90ZUNvdW50OyAvLyBudW1iZXIgb2YgYWNjdW11bGF0ZWQgdm90ZXMKICAgIH0KCiAgICBhZGRyZXNzIHB1YmxpYyBjaGFpcnBlcnNvbjsKCiAgICAvLyBUaGlzIGRlY2xhcmVzIGEgc3RhdGUgdmFyaWFibGUgdGhhdAogICAgLy8gc3RvcmVzIGEgYFZvdGVyYCBzdHJ1Y3QgZm9yIGVhY2ggcG9zc2libGUgYWRkcmVzcy4KICAgIG1hcHBpbmcoYWRkcmVzcyA9PiBWb3RlcikgcHVibGljIHZvdGVyczsKCiAgICAvLyBBIGR5bmFtaWNhbGx5LXNpemVkIGFycmF5IG9mIGBQcm9wb3NhbGAgc3RydWN0cy4KICAgIFByb3Bvc2FsW10gcHVibGljIHByb3Bvc2FsczsKCiAgICAvLy8gQ3JlYXRlIGEgbmV3IGJhbGxvdCB0byBjaG9vc2Ugb25lIG9mIGBwcm9wb3NhbE5hbWVzYC4KICAgIGNvbnN0cnVjdG9yKGJ5dGVzMzJbXSBtZW1vcnkgcHJvcG9zYWxOYW1lcykgewogICAgICAgIGNoYWlycGVyc29uID0gbXNnLnNlbmRlcjsKICAgICAgICB2b3RlcnNbY2hhaXJwZXJzb25dLndlaWdodCA9IDE7CgogICAgICAgIC8vIEZvciBlYWNoIG9mIHRoZSBwcm92aWRlZCBwcm9wb3NhbCBuYW1lcywKICAgICAgICAvLyBjcmVhdGUgYSBuZXcgcHJvcG9zYWwgb2JqZWN0IGFuZCBhZGQgaXQKICAgICAgICAvLyB0byB0aGUgZW5kIG9mIHRoZSBhcnJheS4KICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBwcm9wb3NhbE5hbWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIC8vIGBQcm9wb3NhbCh7Li4ufSlgIGNyZWF0ZXMgYSB0ZW1wb3JhcnkKICAgICAgICAgICAgLy8gUHJvcG9zYWwgb2JqZWN0IGFuZCBgcHJvcG9zYWxzLnB1c2goLi4uKWAKICAgICAgICAgICAgLy8gYXBwZW5kcyBpdCB0byB0aGUgZW5kIG9mIGBwcm9wb3NhbHNgLgogICAgICAgICAgICBwcm9wb3NhbHMucHVzaChQcm9wb3NhbCh7CiAgICAgICAgICAgICAgICBuYW1lOiBwcm9wb3NhbE5hbWVzW2ldLAogICAgICAgICAgICAgICAgdm90ZUNvdW50OiAwCiAgICAgICAgICAgIH0pKTsKICAgICAgICB9CiAgICB9CgogICAgLy8gR2l2ZSBgdm90ZXJgIHRoZSByaWdodCB0byB2b3RlIG9uIHRoaXMgYmFsbG90LgogICAgLy8gTWF5IG9ubHkgYmUgY2FsbGVkIGJ5IGBjaGFpcnBlcnNvbmAuCiAgICBmdW5jdGlvbiBnaXZlUmlnaHRUb1ZvdGUoYWRkcmVzcyB2b3RlcikgZXh0ZXJuYWwgewogICAgICAgIC8vIElmIHRoZSBmaXJzdCBhcmd1bWVudCBvZiBgcmVxdWlyZWAgZXZhbHVhdGVzCiAgICAgICAgLy8gdG8gYGZhbHNlYCwgZXhlY3V0aW9uIHRlcm1pbmF0ZXMgYW5kIGFsbAogICAgICAgIC8vIGNoYW5nZXMgdG8gdGhlIHN0YXRlIGFuZCB0byBFdGhlciBiYWxhbmNlcwogICAgICAgIC8vIGFyZSByZXZlcnRlZC4KICAgICAgICAvLyBUaGlzIHVzZWQgdG8gY29uc3VtZSBhbGwgZ2FzIGluIG9sZCBFVk0gdmVyc2lvbnMsIGJ1dAogICAgICAgIC8vIG5vdCBhbnltb3JlLgogICAgICAgIC8vIEl0IGlzIG9mdGVuIGEgZ29vZCBpZGVhIHRvIHVzZSBgcmVxdWlyZWAgdG8gY2hlY2sgaWYKICAgICAgICAvLyBmdW5jdGlvbnMgYXJlIGNhbGxlZCBjb3JyZWN0bHkuCiAgICAgICAgLy8gQXMgYSBzZWNvbmQgYXJndW1lbnQsIHlvdSBjYW4gYWxzbyBwcm92aWRlIGFuCiAgICAgICAgLy8gZXhwbGFuYXRpb24gYWJvdXQgd2hhdCB3ZW50IHdyb25nLgogICAgICAgIHJlcXVpcmUoCiAgICAgICAgICAgIG1zZy5zZW5kZXIgPT0gY2hhaXJwZXJzb24sCiAgICAgICAgICAgICJPbmx5IGNoYWlycGVyc29uIGNhbiBnaXZlIHJpZ2h0IHRvIHZvdGUuIgogICAgICAgICk7CiAgICAgICAgcmVxdWlyZSgKICAgICAgICAgICAgIXZvdGVyc1t2b3Rlcl0udm90ZWQsCiAgICAgICAgICAgICJUaGUgdm90ZXIgYWxyZWFkeSB2b3RlZC4iCiAgICAgICAgKTsKICAgICAgICByZXF1aXJlKHZvdGVyc1t2b3Rlcl0ud2VpZ2h0ID09IDApOwogICAgICAgIHZvdGVyc1t2b3Rlcl0ud2VpZ2h0ID0gMTsKICAgIH0KCiAgICAvLy8gRGVsZWdhdGUgeW91ciB2b3RlIHRvIHRoZSB2b3RlciBgdG9gLgogICAgZnVuY3Rpb24gZGVsZWdhdGUoYWRkcmVzcyB0bykgZXh0ZXJuYWwgewogICAgICAgIC8vIGFzc2lnbnMgcmVmZXJlbmNlCiAgICAgICAgVm90ZXIgc3RvcmFnZSBzZW5kZXIgPSB2b3RlcnNbbXNnLnNlbmRlcl07CiAgICAgICAgcmVxdWlyZShzZW5kZXIud2VpZ2h0ICE9IDAsICJZb3UgaGF2ZSBubyByaWdodCB0byB2b3RlIik7CiAgICAgICAgcmVxdWlyZSghc2VuZGVyLnZvdGVkLCAiWW91IGFscmVhZHkgdm90ZWQuIik7CgogICAgICAgIHJlcXVpcmUodG8gIT0gbXNnLnNlbmRlciwgIlNlbGYtZGVsZWdhdGlvbiBpcyBkaXNhbGxvd2VkLiIpOwoKICAgICAgICAvLyBGb3J3YXJkIHRoZSBkZWxlZ2F0aW9uIGFzIGxvbmcgYXMKICAgICAgICAvLyBgdG9gIGFsc28gZGVsZWdhdGVkLgogICAgICAgIC8vIEluIGdlbmVyYWwsIHN1Y2ggbG9vcHMgYXJlIHZlcnkgZGFuZ2Vyb3VzLAogICAgICAgIC8vIGJlY2F1c2UgaWYgdGhleSBydW4gdG9vIGxvbmcsIHRoZXkgbWlnaHQKICAgICAgICAvLyBuZWVkIG1vcmUgZ2FzIHRoYW4gaXMgYXZhaWxhYmxlIGluIGEgYmxvY2suCiAgICAgICAgLy8gSW4gdGhpcyBjYXNlLCB0aGUgZGVsZWdhdGlvbiB3aWxsIG5vdCBiZSBleGVjdXRlZCwKICAgICAgICAvLyBidXQgaW4gb3RoZXIgc2l0dWF0aW9ucywgc3VjaCBsb29wcyBtaWdodAogICAgICAgIC8vIGNhdXNlIGEgY29udHJhY3QgdG8gZ2V0ICJzdHVjayIgY29tcGxldGVseS4KICAgICAgICB3aGlsZSAodm90ZXJzW3RvXS5kZWxlZ2F0ZSAhPSBhZGRyZXNzKDApKSB7CiAgICAgICAgICAgIHRvID0gdm90ZXJzW3RvXS5kZWxlZ2F0ZTsKCiAgICAgICAgICAgIC8vIFdlIGZvdW5kIGEgbG9vcCBpbiB0aGUgZGVsZWdhdGlvbiwgbm90IGFsbG93ZWQuCiAgICAgICAgICAgIHJlcXVpcmUodG8gIT0gbXNnLnNlbmRlciwgIkZvdW5kIGxvb3AgaW4gZGVsZWdhdGlvbi4iKTsKICAgICAgICB9CgogICAgICAgIFZvdGVyIHN0b3JhZ2UgZGVsZWdhdGVfID0gdm90ZXJzW3RvXTsKCiAgICAgICAgLy8gVm90ZXJzIGNhbm5vdCBkZWxlZ2F0ZSB0byBhY2NvdW50cyB0aGF0IGNhbm5vdCB2b3RlLgogICAgICAgIHJlcXVpcmUoZGVsZWdhdGVfLndlaWdodCA+PSAxKTsKCiAgICAgICAgLy8gU2luY2UgYHNlbmRlcmAgaXMgYSByZWZlcmVuY2UsIHRoaXMKICAgICAgICAvLyBtb2RpZmllcyBgdm90ZXJzW21zZy5zZW5kZXJdYC4KICAgICAgICBzZW5kZXIudm90ZWQgPSB0cnVlOwogICAgICAgIHNlbmRlci5kZWxlZ2F0ZSA9IHRvOwoKICAgICAgICBpZiAoZGVsZWdhdGVfLnZvdGVkKSB7CiAgICAgICAgICAgIC8vIElmIHRoZSBkZWxlZ2F0ZSBhbHJlYWR5IHZvdGVkLAogICAgICAgICAgICAvLyBkaXJlY3RseSBhZGQgdG8gdGhlIG51bWJlciBvZiB2b3RlcwogICAgICAgICAgICBwcm9wb3NhbHNbZGVsZWdhdGVfLnZvdGVdLnZvdGVDb3VudCArPSBzZW5kZXIud2VpZ2h0OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIElmIHRoZSBkZWxlZ2F0ZSBkaWQgbm90IHZvdGUgeWV0LAogICAgICAgICAgICAvLyBhZGQgdG8gaGVyIHdlaWdodC4KICAgICAgICAgICAgZGVsZWdhdGVfLndlaWdodCArPSBzZW5kZXIud2VpZ2h0OwogICAgICAgIH0KICAgIH0KCiAgICAvLy8gR2l2ZSB5b3VyIHZvdGUgKGluY2x1ZGluZyB2b3RlcyBkZWxlZ2F0ZWQgdG8geW91KQogICAgLy8vIHRvIHByb3Bvc2FsIGBwcm9wb3NhbHNbcHJvcG9zYWxdLm5hbWVgLgogICAgZnVuY3Rpb24gdm90ZSh1aW50IHByb3Bvc2FsKSBleHRlcm5hbCB7CiAgICAgICAgVm90ZXIgc3RvcmFnZSBzZW5kZXIgPSB2b3RlcnNbbXNnLnNlbmRlcl07CiAgICAgICAgcmVxdWlyZShzZW5kZXIud2VpZ2h0ICE9IDAsICJIYXMgbm8gcmlnaHQgdG8gdm90ZSIpOwogICAgICAgIHJlcXVpcmUoIXNlbmRlci52b3RlZCwgIkFscmVhZHkgdm90ZWQuIik7CiAgICAgICAgc2VuZGVyLnZvdGVkID0gdHJ1ZTsKICAgICAgICBzZW5kZXIudm90ZSA9IHByb3Bvc2FsOwoKICAgICAgICAvLyBJZiBgcHJvcG9zYWxgIGlzIG91dCBvZiB0aGUgcmFuZ2Ugb2YgdGhlIGFycmF5LAogICAgICAgIC8vIHRoaXMgd2lsbCB0aHJvdyBhdXRvbWF0aWNhbGx5IGFuZCByZXZlcnQgYWxsCiAgICAgICAgLy8gY2hhbmdlcy4KICAgICAgICBwcm9wb3NhbHNbcHJvcG9zYWxdLnZvdGVDb3VudCArPSBzZW5kZXIud2VpZ2h0OwogICAgfQoKICAgIC8vLyBAZGV2IENvbXB1dGVzIHRoZSB3aW5uaW5nIHByb3Bvc2FsIHRha2luZyBhbGwKICAgIC8vLyBwcmV2aW91cyB2b3RlcyBpbnRvIGFjY291bnQuCiAgICBmdW5jdGlvbiB3aW5uaW5nUHJvcG9zYWwoKSBwdWJsaWMgdmlldwogICAgICAgICAgICByZXR1cm5zICh1aW50IHdpbm5pbmdQcm9wb3NhbF8pCiAgICB7CiAgICAgICAgdWludCB3aW5uaW5nVm90ZUNvdW50ID0gMDsKICAgICAgICBmb3IgKHVpbnQgcCA9IDA7IHAgPCBwcm9wb3NhbHMubGVuZ3RoOyBwKyspIHsKICAgICAgICAgICAgaWYgKHByb3Bvc2Fsc1twXS52b3RlQ291bnQgPiB3aW5uaW5nVm90ZUNvdW50KSB7CiAgICAgICAgICAgICAgICB3aW5uaW5nVm90ZUNvdW50ID0gcHJvcG9zYWxzW3BdLnZvdGVDb3VudDsKICAgICAgICAgICAgICAgIHdpbm5pbmdQcm9wb3NhbF8gPSBwOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8vIENhbGxzIHdpbm5pbmdQcm9wb3NhbCgpIGZ1bmN0aW9uIHRvIGdldCB0aGUgaW5kZXgKICAgIC8vIG9mIHRoZSB3aW5uZXIgY29udGFpbmVkIGluIHRoZSBwcm9wb3NhbHMgYXJyYXkgYW5kIHRoZW4KICAgIC8vIHJldHVybnMgdGhlIG5hbWUgb2YgdGhlIHdpbm5lcgogICAgZnVuY3Rpb24gd2lubmVyTmFtZSgpIGV4dGVybmFsIHZpZXcKICAgICAgICAgICAgcmV0dXJucyAoYnl0ZXMzMiB3aW5uZXJOYW1lXykKICAgIHsKICAgICAgICB3aW5uZXJOYW1lXyA9IHByb3Bvc2Fsc1t3aW5uaW5nUHJvcG9zYWwoKV0ubmFtZTsKICAgIH0KfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.7.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>
<span class="c1">/// @title Voting with delegation.</span>
<span class="k">contract</span><span class="w"> </span><span class="ni">Ballot</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// This declares a new complex type which will</span>
<span class="w">    </span><span class="c1">// be used for variables later.</span>
<span class="w">    </span><span class="c1">// It will represent a single voter.</span>
<span class="w">    </span><span class="kt">struct</span><span class="w"> </span><span class="nv">Voter</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="w"> </span><span class="nv">weight</span><span class="p">;</span><span class="w"> </span><span class="c1">// weight is accumulated by delegation</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="nv">voted</span><span class="p">;</span><span class="w">  </span><span class="c1">// if true, that person already voted</span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">delegate</span><span class="p">;</span><span class="w"> </span><span class="c1">// person delegated to</span>
<span class="w">        </span><span class="kt">uint</span><span class="w"> </span><span class="nv">vote</span><span class="p">;</span><span class="w">   </span><span class="c1">// index of the voted proposal</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">// This is a type for a single proposal.</span>
<span class="w">    </span><span class="kt">struct</span><span class="w"> </span><span class="nv">Proposal</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">name</span><span class="p">;</span><span class="w">   </span><span class="c1">// short name (up to 32 bytes)</span>
<span class="w">        </span><span class="kt">uint</span><span class="w"> </span><span class="nv">voteCount</span><span class="p">;</span><span class="w"> </span><span class="c1">// number of accumulated votes</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="k">public </span><span class="nv">chairperson</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// This declares a state variable that</span>
<span class="w">    </span><span class="c1">// stores a `Voter` struct for each possible address.</span>
<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span>Voter<span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>voters<span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// A dynamically-sized array of `Proposal` structs.</span>
<span class="w">    </span>Proposal<span class="p">[]</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>proposals<span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// Create a new ballot to choose one of `proposalNames`.</span>
<span class="w">    </span><span class="kt">constructor</span><span class="p">(</span><span class="kt">bytes32</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>proposalNames<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>chairperson<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">msg.sender</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span>voters<span class="p">[</span>chairperson<span class="p">].</span>weight<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="c1">// For each of the provided proposal names,</span>
<span class="w">        </span><span class="c1">// create a new proposal object and add it</span>
<span class="w">        </span><span class="c1">// to the end of the array.</span>
<span class="w">        </span><span class="kt">for</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span><span class="w"> </span>i<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>proposalNames<span class="p">.</span>length<span class="p">;</span><span class="w"> </span>i<span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="c1">// `Proposal({...})` creates a temporary</span>
<span class="w">            </span><span class="c1">// Proposal object and `proposals.push(...)`</span>
<span class="w">            </span><span class="c1">// appends it to the end of `proposals`.</span>
<span class="w">            </span>proposals<span class="p">.</span>push<span class="p">(</span>Proposal<span class="p">({</span><span class="w"></span>
<span class="w">                </span>name<span class="p">:</span><span class="w"> </span>proposalNames<span class="p">[</span>i<span class="p">],</span><span class="w"></span>
<span class="w">                </span>voteCount<span class="p">:</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="w"></span>
<span class="w">            </span><span class="p">}));</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Give `voter` the right to vote on this ballot.</span>
<span class="w">    </span><span class="c1">// May only be called by `chairperson`.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">giveRightToVote</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">voter</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// If the first argument of `require` evaluates</span>
<span class="w">        </span><span class="c1">// to `false`, execution terminates and all</span>
<span class="w">        </span><span class="c1">// changes to the state and to Ether balances</span>
<span class="w">        </span><span class="c1">// are reverted.</span>
<span class="w">        </span><span class="c1">// This used to consume all gas in old EVM versions, but</span>
<span class="w">        </span><span class="c1">// not anymore.</span>
<span class="w">        </span><span class="c1">// It is often a good idea to use `require` to check if</span>
<span class="w">        </span><span class="c1">// functions are called correctly.</span>
<span class="w">        </span><span class="c1">// As a second argument, you can also provide an</span>
<span class="w">        </span><span class="c1">// explanation about what went wrong.</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span><span class="w"></span>
<span class="w">            </span><span class="k">msg.sender</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>chairperson<span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="s2">&quot;Only chairperson can give right to vote.&quot;</span><span class="w"></span>
<span class="w">        </span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span><span class="w"></span>
<span class="w">            </span><span class="o">!</span>voters<span class="p">[</span>voter<span class="p">].</span>voted<span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="s2">&quot;The voter already voted.&quot;</span><span class="w"></span>
<span class="w">        </span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>voters<span class="p">[</span>voter<span class="p">].</span>weight<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span>voters<span class="p">[</span>voter<span class="p">].</span>weight<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// Delegate your vote to the voter `to`.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">delegate</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">to</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// assigns reference</span>
<span class="w">        </span>Voter<span class="w"> </span>storage<span class="w"> </span>sender<span class="w"> </span><span class="o">=</span><span class="w"> </span>voters<span class="p">[</span><span class="k">msg.sender</span><span class="p">];</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>sender<span class="p">.</span>weight<span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;You have no right to vote&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span><span class="o">!</span>sender<span class="p">.</span>voted<span class="p">,</span><span class="w"> </span><span class="s2">&quot;You already voted.&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="kt">require</span><span class="p">(</span>to<span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">msg.sender</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Self-delegation is disallowed.&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="c1">// Forward the delegation as long as</span>
<span class="w">        </span><span class="c1">// `to` also delegated.</span>
<span class="w">        </span><span class="c1">// In general, such loops are very dangerous,</span>
<span class="w">        </span><span class="c1">// because if they run too long, they might</span>
<span class="w">        </span><span class="c1">// need more gas than is available in a block.</span>
<span class="w">        </span><span class="c1">// In this case, the delegation will not be executed,</span>
<span class="w">        </span><span class="c1">// but in other situations, such loops might</span>
<span class="w">        </span><span class="c1">// cause a contract to get &quot;stuck&quot; completely.</span>
<span class="w">        </span><span class="kt">while</span><span class="w"> </span><span class="p">(</span>voters<span class="p">[</span>to<span class="p">].</span>delegate<span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kt">address</span><span class="p">(</span><span class="m m-Decimal">0</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span>to<span class="w"> </span><span class="o">=</span><span class="w"> </span>voters<span class="p">[</span>to<span class="p">].</span>delegate<span class="p">;</span><span class="w"></span>

<span class="w">            </span><span class="c1">// We found a loop in the delegation, not allowed.</span>
<span class="w">            </span><span class="kt">require</span><span class="p">(</span>to<span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">msg.sender</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Found loop in delegation.&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span>Voter<span class="w"> </span>storage<span class="w"> </span>delegate_<span class="w"> </span><span class="o">=</span><span class="w"> </span>voters<span class="p">[</span>to<span class="p">];</span><span class="w"></span>

<span class="w">        </span><span class="c1">// Voters cannot delegate to accounts that cannot vote.</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>delegate_<span class="p">.</span>weight<span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="c1">// Since `sender` is a reference, this</span>
<span class="w">        </span><span class="c1">// modifies `voters[msg.sender]`.</span>
<span class="w">        </span>sender<span class="p">.</span>voted<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span>sender<span class="p">.</span>delegate<span class="w"> </span><span class="o">=</span><span class="w"> </span>to<span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>delegate_<span class="p">.</span>voted<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="c1">// If the delegate already voted,</span>
<span class="w">            </span><span class="c1">// directly add to the number of votes</span>
<span class="w">            </span>proposals<span class="p">[</span>delegate_<span class="p">.</span>vote<span class="p">].</span>voteCount<span class="w"> </span><span class="o">+=</span><span class="w"> </span>sender<span class="p">.</span>weight<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="kt">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="c1">// If the delegate did not vote yet,</span>
<span class="w">            </span><span class="c1">// add to her weight.</span>
<span class="w">            </span>delegate_<span class="p">.</span>weight<span class="w"> </span><span class="o">+=</span><span class="w"> </span>sender<span class="p">.</span>weight<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// Give your vote (including votes delegated to you)</span>
<span class="w">    </span><span class="c1">/// to proposal `proposals[proposal].name`.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">vote</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">proposal</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>Voter<span class="w"> </span>storage<span class="w"> </span>sender<span class="w"> </span><span class="o">=</span><span class="w"> </span>voters<span class="p">[</span><span class="k">msg.sender</span><span class="p">];</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>sender<span class="p">.</span>weight<span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Has no right to vote&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span><span class="o">!</span>sender<span class="p">.</span>voted<span class="p">,</span><span class="w"> </span><span class="s2">&quot;Already voted.&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span>sender<span class="p">.</span>voted<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span>sender<span class="p">.</span>vote<span class="w"> </span><span class="o">=</span><span class="w"> </span>proposal<span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="c1">// If `proposal` is out of the range of the array,</span>
<span class="w">        </span><span class="c1">// this will throw automatically and revert all</span>
<span class="w">        </span><span class="c1">// changes.</span>
<span class="w">        </span>proposals<span class="p">[</span>proposal<span class="p">].</span>voteCount<span class="w"> </span><span class="o">+=</span><span class="w"> </span>sender<span class="p">.</span>weight<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// @dev Computes the winning proposal taking all</span>
<span class="w">    </span><span class="c1">/// previous votes into account.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">winningProposal</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>view<span class="w"></span>
<span class="w">            </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">winningProposal_</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="w"> </span><span class="nv">winningVoteCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">for</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span><span class="w"> </span>p<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>proposals<span class="p">.</span>length<span class="p">;</span><span class="w"> </span>p<span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>proposals<span class="p">[</span>p<span class="p">].</span>voteCount<span class="w"> </span><span class="o">&gt;</span><span class="w"> </span>winningVoteCount<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span>winningVoteCount<span class="w"> </span><span class="o">=</span><span class="w"> </span>proposals<span class="p">[</span>p<span class="p">].</span>voteCount<span class="p">;</span><span class="w"></span>
<span class="w">                </span>winningProposal_<span class="w"> </span><span class="o">=</span><span class="w"> </span>p<span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Calls winningProposal() function to get the index</span>
<span class="w">    </span><span class="c1">// of the winner contained in the proposals array and then</span>
<span class="w">    </span><span class="c1">// returns the name of the winner</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">winnerName</span><span class="p">()</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>view<span class="w"></span>
<span class="w">            </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">winnerName_</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>winnerName_<span class="w"> </span><span class="o">=</span><span class="w"> </span>proposals<span class="p">[</span>winningProposal<span class="p">()].</span>name<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<section id="possible-improvements">
<h4>Possible Improvements<a class="headerlink" href="#possible-improvements" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Currently, many transactions are needed to assign the rights
to vote to all participants. Can you think of a better way?</p>
</section>
</section>
<section id="blind-auction">
<span id="index-1"></span><h3>Blind Auction<a class="headerlink" href="#blind-auction" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>In this section, we will show how easy it is to create a completely blind
auction contract on Ethereum.  We will start with an open auction where
everyone can see the bids that are made and then extend this contract into a
blind auction where it is not possible to see the actual bid until the bidding
period ends.</p>
<section id="simple-open-auction">
<span id="simple-auction"></span><h4>Simple Open Auction<a class="headerlink" href="#simple-open-auction" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>The general idea of the following simple auction contract is that everyone can
send their bids during a bidding period. The bids already include sending money
/ Ether in order to bind the bidders to their bid. If the highest bid is
raised, the previous highest bidder gets their money back.  After the end of
the bidding period, the contract has to be called manually for the beneficiary
to receive their money - contracts cannot activate themselves.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5IF4wLjguNDsKY29udHJhY3QgU2ltcGxlQXVjdGlvbiB7CiAgICAvLyBQYXJhbWV0ZXJzIG9mIHRoZSBhdWN0aW9uLiBUaW1lcyBhcmUgZWl0aGVyCiAgICAvLyBhYnNvbHV0ZSB1bml4IHRpbWVzdGFtcHMgKHNlY29uZHMgc2luY2UgMTk3MC0wMS0wMSkKICAgIC8vIG9yIHRpbWUgcGVyaW9kcyBpbiBzZWNvbmRzLgogICAgYWRkcmVzcyBwYXlhYmxlIHB1YmxpYyBiZW5lZmljaWFyeTsKICAgIHVpbnQgcHVibGljIGF1Y3Rpb25FbmRUaW1lOwoKICAgIC8vIEN1cnJlbnQgc3RhdGUgb2YgdGhlIGF1Y3Rpb24uCiAgICBhZGRyZXNzIHB1YmxpYyBoaWdoZXN0QmlkZGVyOwogICAgdWludCBwdWJsaWMgaGlnaGVzdEJpZDsKCiAgICAvLyBBbGxvd2VkIHdpdGhkcmF3YWxzIG9mIHByZXZpb3VzIGJpZHMKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSBwZW5kaW5nUmV0dXJuczsKCiAgICAvLyBTZXQgdG8gdHJ1ZSBhdCB0aGUgZW5kLCBkaXNhbGxvd3MgYW55IGNoYW5nZS4KICAgIC8vIEJ5IGRlZmF1bHQgaW5pdGlhbGl6ZWQgdG8gYGZhbHNlYC4KICAgIGJvb2wgZW5kZWQ7CgogICAgLy8gRXZlbnRzIHRoYXQgd2lsbCBiZSBlbWl0dGVkIG9uIGNoYW5nZXMuCiAgICBldmVudCBIaWdoZXN0QmlkSW5jcmVhc2VkKGFkZHJlc3MgYmlkZGVyLCB1aW50IGFtb3VudCk7CiAgICBldmVudCBBdWN0aW9uRW5kZWQoYWRkcmVzcyB3aW5uZXIsIHVpbnQgYW1vdW50KTsKCiAgICAvLyBFcnJvcnMgdGhhdCBkZXNjcmliZSBmYWlsdXJlcy4KCiAgICAvLyBUaGUgdHJpcGxlLXNsYXNoIGNvbW1lbnRzIGFyZSBzby1jYWxsZWQgbmF0c3BlYwogICAgLy8gY29tbWVudHMuIFRoZXkgd2lsbCBiZSBzaG93biB3aGVuIHRoZSB1c2VyCiAgICAvLyBpcyBhc2tlZCB0byBjb25maXJtIGEgdHJhbnNhY3Rpb24gb3IKICAgIC8vIHdoZW4gYW4gZXJyb3IgaXMgZGlzcGxheWVkLgoKICAgIC8vLyBUaGUgYXVjdGlvbiBoYXMgYWxyZWFkeSBlbmRlZC4KICAgIGVycm9yIEF1Y3Rpb25BbHJlYWR5RW5kZWQoKTsKICAgIC8vLyBUaGVyZSBpcyBhbHJlYWR5IGEgaGlnaGVyIG9yIGVxdWFsIGJpZC4KICAgIGVycm9yIEJpZE5vdEhpZ2hFbm91Z2godWludCBoaWdoZXN0QmlkKTsKICAgIC8vLyBUaGUgYXVjdGlvbiBoYXMgbm90IGVuZGVkIHlldC4KICAgIGVycm9yIEF1Y3Rpb25Ob3RZZXRFbmRlZCgpOwogICAgLy8vIFRoZSBmdW5jdGlvbiBhdWN0aW9uRW5kIGhhcyBhbHJlYWR5IGJlZW4gY2FsbGVkLgogICAgZXJyb3IgQXVjdGlvbkVuZEFscmVhZHlDYWxsZWQoKTsKCiAgICAvLy8gQ3JlYXRlIGEgc2ltcGxlIGF1Y3Rpb24gd2l0aCBgYmlkZGluZ1RpbWVgCiAgICAvLy8gc2Vjb25kcyBiaWRkaW5nIHRpbWUgb24gYmVoYWxmIG9mIHRoZQogICAgLy8vIGJlbmVmaWNpYXJ5IGFkZHJlc3MgYGJlbmVmaWNpYXJ5QWRkcmVzc2AuCiAgICBjb25zdHJ1Y3RvcigKICAgICAgICB1aW50IGJpZGRpbmdUaW1lLAogICAgICAgIGFkZHJlc3MgcGF5YWJsZSBiZW5lZmljaWFyeUFkZHJlc3MKICAgICkgewogICAgICAgIGJlbmVmaWNpYXJ5ID0gYmVuZWZpY2lhcnlBZGRyZXNzOwogICAgICAgIGF1Y3Rpb25FbmRUaW1lID0gYmxvY2sudGltZXN0YW1wICsgYmlkZGluZ1RpbWU7CiAgICB9CgogICAgLy8vIEJpZCBvbiB0aGUgYXVjdGlvbiB3aXRoIHRoZSB2YWx1ZSBzZW50CiAgICAvLy8gdG9nZXRoZXIgd2l0aCB0aGlzIHRyYW5zYWN0aW9uLgogICAgLy8vIFRoZSB2YWx1ZSB3aWxsIG9ubHkgYmUgcmVmdW5kZWQgaWYgdGhlCiAgICAvLy8gYXVjdGlvbiBpcyBub3Qgd29uLgogICAgZnVuY3Rpb24gYmlkKCkgZXh0ZXJuYWwgcGF5YWJsZSB7CiAgICAgICAgLy8gTm8gYXJndW1lbnRzIGFyZSBuZWNlc3NhcnksIGFsbAogICAgICAgIC8vIGluZm9ybWF0aW9uIGlzIGFscmVhZHkgcGFydCBvZgogICAgICAgIC8vIHRoZSB0cmFuc2FjdGlvbi4gVGhlIGtleXdvcmQgcGF5YWJsZQogICAgICAgIC8vIGlzIHJlcXVpcmVkIGZvciB0aGUgZnVuY3Rpb24gdG8KICAgICAgICAvLyBiZSBhYmxlIHRvIHJlY2VpdmUgRXRoZXIuCgogICAgICAgIC8vIFJldmVydCB0aGUgY2FsbCBpZiB0aGUgYmlkZGluZwogICAgICAgIC8vIHBlcmlvZCBpcyBvdmVyLgogICAgICAgIGlmIChibG9jay50aW1lc3RhbXAgPiBhdWN0aW9uRW5kVGltZSkKICAgICAgICAgICAgcmV2ZXJ0IEF1Y3Rpb25BbHJlYWR5RW5kZWQoKTsKCiAgICAgICAgLy8gSWYgdGhlIGJpZCBpcyBub3QgaGlnaGVyLCBzZW5kIHRoZQogICAgICAgIC8vIG1vbmV5IGJhY2sgKHRoZSByZXZlcnQgc3RhdGVtZW50CiAgICAgICAgLy8gd2lsbCByZXZlcnQgYWxsIGNoYW5nZXMgaW4gdGhpcwogICAgICAgIC8vIGZ1bmN0aW9uIGV4ZWN1dGlvbiBpbmNsdWRpbmcKICAgICAgICAvLyBpdCBoYXZpbmcgcmVjZWl2ZWQgdGhlIG1vbmV5KS4KICAgICAgICBpZiAobXNnLnZhbHVlIDw9IGhpZ2hlc3RCaWQpCiAgICAgICAgICAgIHJldmVydCBCaWROb3RIaWdoRW5vdWdoKGhpZ2hlc3RCaWQpOwoKICAgICAgICBpZiAoaGlnaGVzdEJpZCAhPSAwKSB7CiAgICAgICAgICAgIC8vIFNlbmRpbmcgYmFjayB0aGUgbW9uZXkgYnkgc2ltcGx5IHVzaW5nCiAgICAgICAgICAgIC8vIGhpZ2hlc3RCaWRkZXIuc2VuZChoaWdoZXN0QmlkKSBpcyBhIHNlY3VyaXR5IHJpc2sKICAgICAgICAgICAgLy8gYmVjYXVzZSBpdCBjb3VsZCBleGVjdXRlIGFuIHVudHJ1c3RlZCBjb250cmFjdC4KICAgICAgICAgICAgLy8gSXQgaXMgYWx3YXlzIHNhZmVyIHRvIGxldCB0aGUgcmVjaXBpZW50cwogICAgICAgICAgICAvLyB3aXRoZHJhdyB0aGVpciBtb25leSB0aGVtc2VsdmVzLgogICAgICAgICAgICBwZW5kaW5nUmV0dXJuc1toaWdoZXN0QmlkZGVyXSArPSBoaWdoZXN0QmlkOwogICAgICAgIH0KICAgICAgICBoaWdoZXN0QmlkZGVyID0gbXNnLnNlbmRlcjsKICAgICAgICBoaWdoZXN0QmlkID0gbXNnLnZhbHVlOwogICAgICAgIGVtaXQgSGlnaGVzdEJpZEluY3JlYXNlZChtc2cuc2VuZGVyLCBtc2cudmFsdWUpOwogICAgfQoKICAgIC8vLyBXaXRoZHJhdyBhIGJpZCB0aGF0IHdhcyBvdmVyYmlkLgogICAgZnVuY3Rpb24gd2l0aGRyYXcoKSBleHRlcm5hbCByZXR1cm5zIChib29sKSB7CiAgICAgICAgdWludCBhbW91bnQgPSBwZW5kaW5nUmV0dXJuc1ttc2cuc2VuZGVyXTsKICAgICAgICBpZiAoYW1vdW50ID4gMCkgewogICAgICAgICAgICAvLyBJdCBpcyBpbXBvcnRhbnQgdG8gc2V0IHRoaXMgdG8gemVybyBiZWNhdXNlIHRoZSByZWNpcGllbnQKICAgICAgICAgICAgLy8gY2FuIGNhbGwgdGhpcyBmdW5jdGlvbiBhZ2FpbiBhcyBwYXJ0IG9mIHRoZSByZWNlaXZpbmcgY2FsbAogICAgICAgICAgICAvLyBiZWZvcmUgYHNlbmRgIHJldHVybnMuCiAgICAgICAgICAgIHBlbmRpbmdSZXR1cm5zW21zZy5zZW5kZXJdID0gMDsKCiAgICAgICAgICAgIC8vIG1zZy5zZW5kZXIgaXMgbm90IG9mIHR5cGUgYGFkZHJlc3MgcGF5YWJsZWAgYW5kIG11c3QgYmUKICAgICAgICAgICAgLy8gZXhwbGljaXRseSBjb252ZXJ0ZWQgdXNpbmcgYHBheWFibGUobXNnLnNlbmRlcilgIGluIG9yZGVyCiAgICAgICAgICAgIC8vIHVzZSB0aGUgbWVtYmVyIGZ1bmN0aW9uIGBzZW5kKClgLgogICAgICAgICAgICBpZiAoIXBheWFibGUobXNnLnNlbmRlcikuc2VuZChhbW91bnQpKSB7CiAgICAgICAgICAgICAgICAvLyBObyBuZWVkIHRvIGNhbGwgdGhyb3cgaGVyZSwganVzdCByZXNldCB0aGUgYW1vdW50IG93aW5nCiAgICAgICAgICAgICAgICBwZW5kaW5nUmV0dXJuc1ttc2cuc2VuZGVyXSA9IGFtb3VudDsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvLy8gRW5kIHRoZSBhdWN0aW9uIGFuZCBzZW5kIHRoZSBoaWdoZXN0IGJpZAogICAgLy8vIHRvIHRoZSBiZW5lZmljaWFyeS4KICAgIGZ1bmN0aW9uIGF1Y3Rpb25FbmQoKSBleHRlcm5hbCB7CiAgICAgICAgLy8gSXQgaXMgYSBnb29kIGd1aWRlbGluZSB0byBzdHJ1Y3R1cmUgZnVuY3Rpb25zIHRoYXQgaW50ZXJhY3QKICAgICAgICAvLyB3aXRoIG90aGVyIGNvbnRyYWN0cyAoaS5lLiB0aGV5IGNhbGwgZnVuY3Rpb25zIG9yIHNlbmQgRXRoZXIpCiAgICAgICAgLy8gaW50byB0aHJlZSBwaGFzZXM6CiAgICAgICAgLy8gMS4gY2hlY2tpbmcgY29uZGl0aW9ucwogICAgICAgIC8vIDIuIHBlcmZvcm1pbmcgYWN0aW9ucyAocG90ZW50aWFsbHkgY2hhbmdpbmcgY29uZGl0aW9ucykKICAgICAgICAvLyAzLiBpbnRlcmFjdGluZyB3aXRoIG90aGVyIGNvbnRyYWN0cwogICAgICAgIC8vIElmIHRoZXNlIHBoYXNlcyBhcmUgbWl4ZWQgdXAsIHRoZSBvdGhlciBjb250cmFjdCBjb3VsZCBjYWxsCiAgICAgICAgLy8gYmFjayBpbnRvIHRoZSBjdXJyZW50IGNvbnRyYWN0IGFuZCBtb2RpZnkgdGhlIHN0YXRlIG9yIGNhdXNlCiAgICAgICAgLy8gZWZmZWN0cyAoZXRoZXIgcGF5b3V0KSB0byBiZSBwZXJmb3JtZWQgbXVsdGlwbGUgdGltZXMuCiAgICAgICAgLy8gSWYgZnVuY3Rpb25zIGNhbGxlZCBpbnRlcm5hbGx5IGluY2x1ZGUgaW50ZXJhY3Rpb24gd2l0aCBleHRlcm5hbAogICAgICAgIC8vIGNvbnRyYWN0cywgdGhleSBhbHNvIGhhdmUgdG8gYmUgY29uc2lkZXJlZCBpbnRlcmFjdGlvbiB3aXRoCiAgICAgICAgLy8gZXh0ZXJuYWwgY29udHJhY3RzLgoKICAgICAgICAvLyAxLiBDb25kaXRpb25zCiAgICAgICAgaWYgKGJsb2NrLnRpbWVzdGFtcCA8IGF1Y3Rpb25FbmRUaW1lKQogICAgICAgICAgICByZXZlcnQgQXVjdGlvbk5vdFlldEVuZGVkKCk7CiAgICAgICAgaWYgKGVuZGVkKQogICAgICAgICAgICByZXZlcnQgQXVjdGlvbkVuZEFscmVhZHlDYWxsZWQoKTsKCiAgICAgICAgLy8gMi4gRWZmZWN0cwogICAgICAgIGVuZGVkID0gdHJ1ZTsKICAgICAgICBlbWl0IEF1Y3Rpb25FbmRlZChoaWdoZXN0QmlkZGVyLCBoaWdoZXN0QmlkKTsKCiAgICAgICAgLy8gMy4gSW50ZXJhY3Rpb24KICAgICAgICBiZW5lZmljaWFyeS50cmFuc2ZlcihoaWdoZXN0QmlkKTsKICAgIH0KfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.8.4</span><span class="p">;</span><span class="w"></span>
<span class="k">contract</span><span class="w"> </span><span class="ni">SimpleAuction</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Parameters of the auction. Times are either</span>
<span class="w">    </span><span class="c1">// absolute unix timestamps (seconds since 1970-01-01)</span>
<span class="w">    </span><span class="c1">// or time periods in seconds.</span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">payable</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>beneficiary<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="k">public </span><span class="nv">auctionEndTime</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Current state of the auction.</span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="k">public </span><span class="nv">highestBidder</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="k">public </span><span class="nv">highestBid</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Allowed withdrawals of previous bids</span>
<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span>pendingReturns<span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Set to true at the end, disallows any change.</span>
<span class="w">    </span><span class="c1">// By default initialized to `false`.</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="nv">ended</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Events that will be emitted on changes.</span>
<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">HighestBidIncreased</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">bidder</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">amount</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">AuctionEnded</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">winner</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">amount</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Errors that describe failures.</span>

<span class="w">    </span><span class="c1">// The triple-slash comments are so-called natspec</span>
<span class="w">    </span><span class="c1">// comments. They will be shown when the user</span>
<span class="w">    </span><span class="c1">// is asked to confirm a transaction or</span>
<span class="w">    </span><span class="c1">// when an error is displayed.</span>

<span class="w">    </span><span class="c1">/// The auction has already ended.</span>
<span class="w">    </span>error<span class="w"> </span>AuctionAlreadyEnded<span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="c1">/// There is already a higher or equal bid.</span>
<span class="w">    </span>error<span class="w"> </span>BidNotHighEnough<span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">highestBid</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="c1">/// The auction has not ended yet.</span>
<span class="w">    </span>error<span class="w"> </span>AuctionNotYetEnded<span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="c1">/// The function auctionEnd has already been called.</span>
<span class="w">    </span>error<span class="w"> </span>AuctionEndAlreadyCalled<span class="p">();</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// Create a simple auction with `biddingTime`</span>
<span class="w">    </span><span class="c1">/// seconds bidding time on behalf of the</span>
<span class="w">    </span><span class="c1">/// beneficiary address `beneficiaryAddress`.</span>
<span class="w">    </span><span class="kt">constructor</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="w"> </span><span class="nv">biddingTime</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">payable</span><span class="w"> </span>beneficiaryAddress<span class="w"></span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>beneficiary<span class="w"> </span><span class="o">=</span><span class="w"> </span>beneficiaryAddress<span class="p">;</span><span class="w"></span>
<span class="w">        </span>auctionEndTime<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">block.timestamp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>biddingTime<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// Bid on the auction with the value sent</span>
<span class="w">    </span><span class="c1">/// together with this transaction.</span>
<span class="w">    </span><span class="c1">/// The value will only be refunded if the</span>
<span class="w">    </span><span class="c1">/// auction is not won.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">bid</span><span class="p">()</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// No arguments are necessary, all</span>
<span class="w">        </span><span class="c1">// information is already part of</span>
<span class="w">        </span><span class="c1">// the transaction. The keyword payable</span>
<span class="w">        </span><span class="c1">// is required for the function to</span>
<span class="w">        </span><span class="c1">// be able to receive Ether.</span>

<span class="w">        </span><span class="c1">// Revert the call if the bidding</span>
<span class="w">        </span><span class="c1">// period is over.</span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span><span class="k">block.timestamp</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span>auctionEndTime<span class="p">)</span><span class="w"></span>
<span class="w">            </span>revert<span class="w"> </span>AuctionAlreadyEnded<span class="p">();</span><span class="w"></span>

<span class="w">        </span><span class="c1">// If the bid is not higher, send the</span>
<span class="w">        </span><span class="c1">// money back (the revert statement</span>
<span class="w">        </span><span class="c1">// will revert all changes in this</span>
<span class="w">        </span><span class="c1">// function execution including</span>
<span class="w">        </span><span class="c1">// it having received the money).</span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span><span class="k">msg.value</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span>highestBid<span class="p">)</span><span class="w"></span>
<span class="w">            </span>revert<span class="w"> </span>BidNotHighEnough<span class="p">(</span>highestBid<span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>highestBid<span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="c1">// Sending back the money by simply using</span>
<span class="w">            </span><span class="c1">// highestBidder.send(highestBid) is a security risk</span>
<span class="w">            </span><span class="c1">// because it could execute an untrusted contract.</span>
<span class="w">            </span><span class="c1">// It is always safer to let the recipients</span>
<span class="w">            </span><span class="c1">// withdraw their money themselves.</span>
<span class="w">            </span>pendingReturns<span class="p">[</span>highestBidder<span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span>highestBid<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span>highestBidder<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">msg.sender</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span>highestBid<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">msg.value</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span>emit<span class="w"> </span>HighestBidIncreased<span class="p">(</span><span class="k">msg.sender</span><span class="p">,</span><span class="w"> </span><span class="k">msg.value</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// Withdraw a bid that was overbid.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">withdraw</span><span class="p">()</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="w"> </span><span class="nv">amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>pendingReturns<span class="p">[</span><span class="k">msg.sender</span><span class="p">];</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>amount<span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="c1">// It is important to set this to zero because the recipient</span>
<span class="w">            </span><span class="c1">// can call this function again as part of the receiving call</span>
<span class="w">            </span><span class="c1">// before `send` returns.</span>
<span class="w">            </span>pendingReturns<span class="p">[</span><span class="k">msg.sender</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span><span class="w"></span>

<span class="w">            </span><span class="c1">// msg.sender is not of type `address payable` and must be</span>
<span class="w">            </span><span class="c1">// explicitly converted using `payable(msg.sender)` in order</span>
<span class="w">            </span><span class="c1">// use the member function `send()`.</span>
<span class="w">            </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="kt">payable</span><span class="p">(</span><span class="k">msg.sender</span><span class="p">).</span>send<span class="p">(</span>amount<span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="c1">// No need to call throw here, just reset the amount owing</span>
<span class="w">                </span>pendingReturns<span class="p">[</span><span class="k">msg.sender</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>amount<span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="kt">return</span><span class="w"> </span><span class="kt">false</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// End the auction and send the highest bid</span>
<span class="w">    </span><span class="c1">/// to the beneficiary.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">auctionEnd</span><span class="p">()</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// It is a good guideline to structure functions that interact</span>
<span class="w">        </span><span class="c1">// with other contracts (i.e. they call functions or send Ether)</span>
<span class="w">        </span><span class="c1">// into three phases:</span>
<span class="w">        </span><span class="c1">// 1. checking conditions</span>
<span class="w">        </span><span class="c1">// 2. performing actions (potentially changing conditions)</span>
<span class="w">        </span><span class="c1">// 3. interacting with other contracts</span>
<span class="w">        </span><span class="c1">// If these phases are mixed up, the other contract could call</span>
<span class="w">        </span><span class="c1">// back into the current contract and modify the state or cause</span>
<span class="w">        </span><span class="c1">// effects (ether payout) to be performed multiple times.</span>
<span class="w">        </span><span class="c1">// If functions called internally include interaction with external</span>
<span class="w">        </span><span class="c1">// contracts, they also have to be considered interaction with</span>
<span class="w">        </span><span class="c1">// external contracts.</span>

<span class="w">        </span><span class="c1">// 1. Conditions</span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span><span class="k">block.timestamp</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>auctionEndTime<span class="p">)</span><span class="w"></span>
<span class="w">            </span>revert<span class="w"> </span>AuctionNotYetEnded<span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>ended<span class="p">)</span><span class="w"></span>
<span class="w">            </span>revert<span class="w"> </span>AuctionEndAlreadyCalled<span class="p">();</span><span class="w"></span>

<span class="w">        </span><span class="c1">// 2. Effects</span>
<span class="w">        </span>ended<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span>emit<span class="w"> </span>AuctionEnded<span class="p">(</span>highestBidder<span class="p">,</span><span class="w"> </span>highestBid<span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="c1">// 3. Interaction</span>
<span class="w">        </span>beneficiary<span class="p">.</span>transfer<span class="p">(</span>highestBid<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="id2">
<h4>Blind Auction<a class="headerlink" href="#id2" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>The previous open auction is extended to a blind auction in the following. The
advantage of a blind auction is that there is no time pressure towards the end
of the bidding period. Creating a blind auction on a transparent computing
platform might sound like a contradiction, but cryptography comes to the
rescue.</p>
<p>During the <strong>bidding period</strong>, a bidder does not actually send their bid, but
only a hashed version of it.  Since it is currently considered practically
impossible to find two (sufficiently long) values whose hash values are equal,
the bidder commits to the bid by that.  After the end of the bidding period,
the bidders have to reveal their bids: They send their values unencrypted and
the contract checks that the hash value is the same as the one provided during
the bidding period.</p>
<p>Another challenge is how to make the auction <strong>binding and blind</strong> at the same
time: The only way to prevent the bidder from just not sending the money after
they won the auction is to make them send it together with the bid. Since value
transfers cannot be blinded in Ethereum, anyone can see the value.</p>
<p>The following contract solves this problem by accepting any value that is
larger than the highest bid. Since this can of course only be checked during
the reveal phase, some bids might be <strong>invalid</strong>, and this is on purpose (it
even provides an explicit flag to place invalid bids with high value
transfers): Bidders can confuse competition by placing several high or low
invalid bids.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5IF4wLjguNDsKY29udHJhY3QgQmxpbmRBdWN0aW9uIHsKICAgIHN0cnVjdCBCaWQgewogICAgICAgIGJ5dGVzMzIgYmxpbmRlZEJpZDsKICAgICAgICB1aW50IGRlcG9zaXQ7CiAgICB9CgogICAgYWRkcmVzcyBwYXlhYmxlIHB1YmxpYyBiZW5lZmljaWFyeTsKICAgIHVpbnQgcHVibGljIGJpZGRpbmdFbmQ7CiAgICB1aW50IHB1YmxpYyByZXZlYWxFbmQ7CiAgICBib29sIHB1YmxpYyBlbmRlZDsKCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gQmlkW10pIHB1YmxpYyBiaWRzOwoKICAgIGFkZHJlc3MgcHVibGljIGhpZ2hlc3RCaWRkZXI7CiAgICB1aW50IHB1YmxpYyBoaWdoZXN0QmlkOwoKICAgIC8vIEFsbG93ZWQgd2l0aGRyYXdhbHMgb2YgcHJldmlvdXMgYmlkcwogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQpIHBlbmRpbmdSZXR1cm5zOwoKICAgIGV2ZW50IEF1Y3Rpb25FbmRlZChhZGRyZXNzIHdpbm5lciwgdWludCBoaWdoZXN0QmlkKTsKCiAgICAvLyBFcnJvcnMgdGhhdCBkZXNjcmliZSBmYWlsdXJlcy4KCiAgICAvLy8gVGhlIGZ1bmN0aW9uIGhhcyBiZWVuIGNhbGxlZCB0b28gZWFybHkuCiAgICAvLy8gVHJ5IGFnYWluIGF0IGB0aW1lYC4KICAgIGVycm9yIFRvb0Vhcmx5KHVpbnQgdGltZSk7CiAgICAvLy8gVGhlIGZ1bmN0aW9uIGhhcyBiZWVuIGNhbGxlZCB0b28gbGF0ZS4KICAgIC8vLyBJdCBjYW5ub3QgYmUgY2FsbGVkIGFmdGVyIGB0aW1lYC4KICAgIGVycm9yIFRvb0xhdGUodWludCB0aW1lKTsKICAgIC8vLyBUaGUgZnVuY3Rpb24gYXVjdGlvbkVuZCBoYXMgYWxyZWFkeSBiZWVuIGNhbGxlZC4KICAgIGVycm9yIEF1Y3Rpb25FbmRBbHJlYWR5Q2FsbGVkKCk7CgogICAgLy8gTW9kaWZpZXJzIGFyZSBhIGNvbnZlbmllbnQgd2F5IHRvIHZhbGlkYXRlIGlucHV0cyB0bwogICAgLy8gZnVuY3Rpb25zLiBgb25seUJlZm9yZWAgaXMgYXBwbGllZCB0byBgYmlkYCBiZWxvdzoKICAgIC8vIFRoZSBuZXcgZnVuY3Rpb24gYm9keSBpcyB0aGUgbW9kaWZpZXIncyBib2R5IHdoZXJlCiAgICAvLyBgX2AgaXMgcmVwbGFjZWQgYnkgdGhlIG9sZCBmdW5jdGlvbiBib2R5LgogICAgbW9kaWZpZXIgb25seUJlZm9yZSh1aW50IHRpbWUpIHsKICAgICAgICBpZiAoYmxvY2sudGltZXN0YW1wID49IHRpbWUpIHJldmVydCBUb29MYXRlKHRpbWUpOwogICAgICAgIF87CiAgICB9CiAgICBtb2RpZmllciBvbmx5QWZ0ZXIodWludCB0aW1lKSB7CiAgICAgICAgaWYgKGJsb2NrLnRpbWVzdGFtcCA8PSB0aW1lKSByZXZlcnQgVG9vRWFybHkodGltZSk7CiAgICAgICAgXzsKICAgIH0KCiAgICBjb25zdHJ1Y3RvcigKICAgICAgICB1aW50IGJpZGRpbmdUaW1lLAogICAgICAgIHVpbnQgcmV2ZWFsVGltZSwKICAgICAgICBhZGRyZXNzIHBheWFibGUgYmVuZWZpY2lhcnlBZGRyZXNzCiAgICApIHsKICAgICAgICBiZW5lZmljaWFyeSA9IGJlbmVmaWNpYXJ5QWRkcmVzczsKICAgICAgICBiaWRkaW5nRW5kID0gYmxvY2sudGltZXN0YW1wICsgYmlkZGluZ1RpbWU7CiAgICAgICAgcmV2ZWFsRW5kID0gYmlkZGluZ0VuZCArIHJldmVhbFRpbWU7CiAgICB9CgogICAgLy8vIFBsYWNlIGEgYmxpbmRlZCBiaWQgd2l0aCBgYmxpbmRlZEJpZGAgPQogICAgLy8vIGtlY2NhazI1NihhYmkuZW5jb2RlUGFja2VkKHZhbHVlLCBmYWtlLCBzZWNyZXQpKS4KICAgIC8vLyBUaGUgc2VudCBldGhlciBpcyBvbmx5IHJlZnVuZGVkIGlmIHRoZSBiaWQgaXMgY29ycmVjdGx5CiAgICAvLy8gcmV2ZWFsZWQgaW4gdGhlIHJldmVhbGluZyBwaGFzZS4gVGhlIGJpZCBpcyB2YWxpZCBpZiB0aGUKICAgIC8vLyBldGhlciBzZW50IHRvZ2V0aGVyIHdpdGggdGhlIGJpZCBpcyBhdCBsZWFzdCAidmFsdWUiIGFuZAogICAgLy8vICJmYWtlIiBpcyBub3QgdHJ1ZS4gU2V0dGluZyAiZmFrZSIgdG8gdHJ1ZSBhbmQgc2VuZGluZwogICAgLy8vIG5vdCB0aGUgZXhhY3QgYW1vdW50IGFyZSB3YXlzIHRvIGhpZGUgdGhlIHJlYWwgYmlkIGJ1dAogICAgLy8vIHN0aWxsIG1ha2UgdGhlIHJlcXVpcmVkIGRlcG9zaXQuIFRoZSBzYW1lIGFkZHJlc3MgY2FuCiAgICAvLy8gcGxhY2UgbXVsdGlwbGUgYmlkcy4KICAgIGZ1bmN0aW9uIGJpZChieXRlczMyIGJsaW5kZWRCaWQpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBwYXlhYmxlCiAgICAgICAgb25seUJlZm9yZShiaWRkaW5nRW5kKQogICAgewogICAgICAgIGJpZHNbbXNnLnNlbmRlcl0ucHVzaChCaWQoewogICAgICAgICAgICBibGluZGVkQmlkOiBibGluZGVkQmlkLAogICAgICAgICAgICBkZXBvc2l0OiBtc2cudmFsdWUKICAgICAgICB9KSk7CiAgICB9CgogICAgLy8vIFJldmVhbCB5b3VyIGJsaW5kZWQgYmlkcy4gWW91IHdpbGwgZ2V0IGEgcmVmdW5kIGZvciBhbGwKICAgIC8vLyBjb3JyZWN0bHkgYmxpbmRlZCBpbnZhbGlkIGJpZHMgYW5kIGZvciBhbGwgYmlkcyBleGNlcHQgZm9yCiAgICAvLy8gdGhlIHRvdGFsbHkgaGlnaGVzdC4KICAgIGZ1bmN0aW9uIHJldmVhbCgKICAgICAgICB1aW50W10gY2FsbGRhdGEgdmFsdWVzLAogICAgICAgIGJvb2xbXSBjYWxsZGF0YSBmYWtlcywKICAgICAgICBieXRlczMyW10gY2FsbGRhdGEgc2VjcmV0cwogICAgKQogICAgICAgIGV4dGVybmFsCiAgICAgICAgb25seUFmdGVyKGJpZGRpbmdFbmQpCiAgICAgICAgb25seUJlZm9yZShyZXZlYWxFbmQpCiAgICB7CiAgICAgICAgdWludCBsZW5ndGggPSBiaWRzW21zZy5zZW5kZXJdLmxlbmd0aDsKICAgICAgICByZXF1aXJlKHZhbHVlcy5sZW5ndGggPT0gbGVuZ3RoKTsKICAgICAgICByZXF1aXJlKGZha2VzLmxlbmd0aCA9PSBsZW5ndGgpOwogICAgICAgIHJlcXVpcmUoc2VjcmV0cy5sZW5ndGggPT0gbGVuZ3RoKTsKCiAgICAgICAgdWludCByZWZ1bmQ7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgQmlkIHN0b3JhZ2UgYmlkVG9DaGVjayA9IGJpZHNbbXNnLnNlbmRlcl1baV07CiAgICAgICAgICAgICh1aW50IHZhbHVlLCBib29sIGZha2UsIGJ5dGVzMzIgc2VjcmV0KSA9CiAgICAgICAgICAgICAgICAgICAgKHZhbHVlc1tpXSwgZmFrZXNbaV0sIHNlY3JldHNbaV0pOwogICAgICAgICAgICBpZiAoYmlkVG9DaGVjay5ibGluZGVkQmlkICE9IGtlY2NhazI1NihhYmkuZW5jb2RlUGFja2VkKHZhbHVlLCBmYWtlLCBzZWNyZXQpKSkgewogICAgICAgICAgICAgICAgLy8gQmlkIHdhcyBub3QgYWN0dWFsbHkgcmV2ZWFsZWQuCiAgICAgICAgICAgICAgICAvLyBEbyBub3QgcmVmdW5kIGRlcG9zaXQuCiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZWZ1bmQgKz0gYmlkVG9DaGVjay5kZXBvc2l0OwogICAgICAgICAgICBpZiAoIWZha2UgJiYgYmlkVG9DaGVjay5kZXBvc2l0ID49IHZhbHVlKSB7CiAgICAgICAgICAgICAgICBpZiAocGxhY2VCaWQobXNnLnNlbmRlciwgdmFsdWUpKQogICAgICAgICAgICAgICAgICAgIHJlZnVuZCAtPSB2YWx1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBNYWtlIGl0IGltcG9zc2libGUgZm9yIHRoZSBzZW5kZXIgdG8gcmUtY2xhaW0KICAgICAgICAgICAgLy8gdGhlIHNhbWUgZGVwb3NpdC4KICAgICAgICAgICAgYmlkVG9DaGVjay5ibGluZGVkQmlkID0gYnl0ZXMzMigwKTsKICAgICAgICB9CiAgICAgICAgcGF5YWJsZShtc2cuc2VuZGVyKS50cmFuc2ZlcihyZWZ1bmQpOwogICAgfQoKICAgIC8vLyBXaXRoZHJhdyBhIGJpZCB0aGF0IHdhcyBvdmVyYmlkLgogICAgZnVuY3Rpb24gd2l0aGRyYXcoKSBleHRlcm5hbCB7CiAgICAgICAgdWludCBhbW91bnQgPSBwZW5kaW5nUmV0dXJuc1ttc2cuc2VuZGVyXTsKICAgICAgICBpZiAoYW1vdW50ID4gMCkgewogICAgICAgICAgICAvLyBJdCBpcyBpbXBvcnRhbnQgdG8gc2V0IHRoaXMgdG8gemVybyBiZWNhdXNlIHRoZSByZWNpcGllbnQKICAgICAgICAgICAgLy8gY2FuIGNhbGwgdGhpcyBmdW5jdGlvbiBhZ2FpbiBhcyBwYXJ0IG9mIHRoZSByZWNlaXZpbmcgY2FsbAogICAgICAgICAgICAvLyBiZWZvcmUgYHRyYW5zZmVyYCByZXR1cm5zIChzZWUgdGhlIHJlbWFyayBhYm92ZSBhYm91dAogICAgICAgICAgICAvLyBjb25kaXRpb25zIC0+IGVmZmVjdHMgLT4gaW50ZXJhY3Rpb24pLgogICAgICAgICAgICBwZW5kaW5nUmV0dXJuc1ttc2cuc2VuZGVyXSA9IDA7CgogICAgICAgICAgICBwYXlhYmxlKG1zZy5zZW5kZXIpLnRyYW5zZmVyKGFtb3VudCk7CiAgICAgICAgfQogICAgfQoKICAgIC8vLyBFbmQgdGhlIGF1Y3Rpb24gYW5kIHNlbmQgdGhlIGhpZ2hlc3QgYmlkCiAgICAvLy8gdG8gdGhlIGJlbmVmaWNpYXJ5LgogICAgZnVuY3Rpb24gYXVjdGlvbkVuZCgpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBvbmx5QWZ0ZXIocmV2ZWFsRW5kKQogICAgewogICAgICAgIGlmIChlbmRlZCkgcmV2ZXJ0IEF1Y3Rpb25FbmRBbHJlYWR5Q2FsbGVkKCk7CiAgICAgICAgZW1pdCBBdWN0aW9uRW5kZWQoaGlnaGVzdEJpZGRlciwgaGlnaGVzdEJpZCk7CiAgICAgICAgZW5kZWQgPSB0cnVlOwogICAgICAgIGJlbmVmaWNpYXJ5LnRyYW5zZmVyKGhpZ2hlc3RCaWQpOwogICAgfQoKICAgIC8vIFRoaXMgaXMgYW4gImludGVybmFsIiBmdW5jdGlvbiB3aGljaCBtZWFucyB0aGF0IGl0CiAgICAvLyBjYW4gb25seSBiZSBjYWxsZWQgZnJvbSB0aGUgY29udHJhY3QgaXRzZWxmIChvciBmcm9tCiAgICAvLyBkZXJpdmVkIGNvbnRyYWN0cykuCiAgICBmdW5jdGlvbiBwbGFjZUJpZChhZGRyZXNzIGJpZGRlciwgdWludCB2YWx1ZSkgaW50ZXJuYWwKICAgICAgICAgICAgcmV0dXJucyAoYm9vbCBzdWNjZXNzKQogICAgewogICAgICAgIGlmICh2YWx1ZSA8PSBoaWdoZXN0QmlkKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYgKGhpZ2hlc3RCaWRkZXIgIT0gYWRkcmVzcygwKSkgewogICAgICAgICAgICAvLyBSZWZ1bmQgdGhlIHByZXZpb3VzbHkgaGlnaGVzdCBiaWRkZXIuCiAgICAgICAgICAgIHBlbmRpbmdSZXR1cm5zW2hpZ2hlc3RCaWRkZXJdICs9IGhpZ2hlc3RCaWQ7CiAgICAgICAgfQogICAgICAgIGhpZ2hlc3RCaWQgPSB2YWx1ZTsKICAgICAgICBoaWdoZXN0QmlkZGVyID0gYmlkZGVyOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.8.4</span><span class="p">;</span><span class="w"></span>
<span class="k">contract</span><span class="w"> </span><span class="ni">BlindAuction</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">struct</span><span class="w"> </span><span class="nv">Bid</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">blindedBid</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="w"> </span><span class="nv">deposit</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">payable</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>beneficiary<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="k">public </span><span class="nv">biddingEnd</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="k">public </span><span class="nv">revealEnd</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="k">public </span><span class="nv">ended</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span>Bid<span class="p">[])</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>bids<span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="k">public </span><span class="nv">highestBidder</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="k">public </span><span class="nv">highestBid</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Allowed withdrawals of previous bids</span>
<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span>pendingReturns<span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">AuctionEnded</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">winner</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">highestBid</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Errors that describe failures.</span>

<span class="w">    </span><span class="c1">/// The function has been called too early.</span>
<span class="w">    </span><span class="c1">/// Try again at `time`.</span>
<span class="w">    </span>error<span class="w"> </span>TooEarly<span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">time</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="c1">/// The function has been called too late.</span>
<span class="w">    </span><span class="c1">/// It cannot be called after `time`.</span>
<span class="w">    </span>error<span class="w"> </span>TooLate<span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">time</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="c1">/// The function auctionEnd has already been called.</span>
<span class="w">    </span>error<span class="w"> </span>AuctionEndAlreadyCalled<span class="p">();</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Modifiers are a convenient way to validate inputs to</span>
<span class="w">    </span><span class="c1">// functions. `onlyBefore` is applied to `bid` below:</span>
<span class="w">    </span><span class="c1">// The new function body is the modifier&#39;s body where</span>
<span class="w">    </span><span class="c1">// `_` is replaced by the old function body.</span>
<span class="w">    </span><span class="kt">modifier</span><span class="w"> </span>onlyBefore<span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">time</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span><span class="k">block.timestamp</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span>time<span class="p">)</span><span class="w"> </span>revert<span class="w"> </span>TooLate<span class="p">(</span>time<span class="p">);</span><span class="w"></span>
<span class="w">        </span>_<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="kt">modifier</span><span class="w"> </span>onlyAfter<span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">time</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span><span class="k">block.timestamp</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span>time<span class="p">)</span><span class="w"> </span>revert<span class="w"> </span>TooEarly<span class="p">(</span>time<span class="p">);</span><span class="w"></span>
<span class="w">        </span>_<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">constructor</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="w"> </span><span class="nv">biddingTime</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="w"> </span><span class="nv">revealTime</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">payable</span><span class="w"> </span>beneficiaryAddress<span class="w"></span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>beneficiary<span class="w"> </span><span class="o">=</span><span class="w"> </span>beneficiaryAddress<span class="p">;</span><span class="w"></span>
<span class="w">        </span>biddingEnd<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">block.timestamp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>biddingTime<span class="p">;</span><span class="w"></span>
<span class="w">        </span>revealEnd<span class="w"> </span><span class="o">=</span><span class="w"> </span>biddingEnd<span class="w"> </span><span class="o">+</span><span class="w"> </span>revealTime<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// Place a blinded bid with `blindedBid` =</span>
<span class="w">    </span><span class="c1">/// keccak256(abi.encodePacked(value, fake, secret)).</span>
<span class="w">    </span><span class="c1">/// The sent ether is only refunded if the bid is correctly</span>
<span class="w">    </span><span class="c1">/// revealed in the revealing phase. The bid is valid if the</span>
<span class="w">    </span><span class="c1">/// ether sent together with the bid is at least &quot;value&quot; and</span>
<span class="w">    </span><span class="c1">/// &quot;fake&quot; is not true. Setting &quot;fake&quot; to true and sending</span>
<span class="w">    </span><span class="c1">/// not the exact amount are ways to hide the real bid but</span>
<span class="w">    </span><span class="c1">/// still make the required deposit. The same address can</span>
<span class="w">    </span><span class="c1">/// place multiple bids.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">bid</span><span class="p">(</span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">blindedBid</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="kt">external</span><span class="w"></span>
<span class="w">        </span><span class="kt">payable</span><span class="w"></span>
<span class="w">        </span>onlyBefore<span class="p">(</span>biddingEnd<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>bids<span class="p">[</span><span class="k">msg.sender</span><span class="p">].</span>push<span class="p">(</span>Bid<span class="p">({</span><span class="w"></span>
<span class="w">            </span>blindedBid<span class="p">:</span><span class="w"> </span>blindedBid<span class="p">,</span><span class="w"></span>
<span class="w">            </span>deposit<span class="p">:</span><span class="w"> </span><span class="k">msg.value</span><span class="w"></span>
<span class="w">        </span><span class="p">}));</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// Reveal your blinded bids. You will get a refund for all</span>
<span class="w">    </span><span class="c1">/// correctly blinded invalid bids and for all bids except for</span>
<span class="w">    </span><span class="c1">/// the totally highest.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">reveal</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="p">[]</span><span class="w"> </span>calldata<span class="w"> </span>values<span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">bool</span><span class="p">[]</span><span class="w"> </span>calldata<span class="w"> </span>fakes<span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">bytes32</span><span class="p">[]</span><span class="w"> </span>calldata<span class="w"> </span>secrets<span class="w"></span>
<span class="w">    </span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="kt">external</span><span class="w"></span>
<span class="w">        </span>onlyAfter<span class="p">(</span>biddingEnd<span class="p">)</span><span class="w"></span>
<span class="w">        </span>onlyBefore<span class="p">(</span>revealEnd<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="w"> </span><span class="nv">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>bids<span class="p">[</span><span class="k">msg.sender</span><span class="p">].</span>length<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>values<span class="p">.</span>length<span class="w"> </span><span class="o">==</span><span class="w"> </span>length<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>fakes<span class="p">.</span>length<span class="w"> </span><span class="o">==</span><span class="w"> </span>length<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>secrets<span class="p">.</span>length<span class="w"> </span><span class="o">==</span><span class="w"> </span>length<span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="kt">uint</span><span class="w"> </span><span class="nv">refund</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">for</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span><span class="w"> </span>i<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>length<span class="p">;</span><span class="w"> </span>i<span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span>Bid<span class="w"> </span>storage<span class="w"> </span>bidToCheck<span class="w"> </span><span class="o">=</span><span class="w"> </span>bids<span class="p">[</span><span class="k">msg.sender</span><span class="p">][</span>i<span class="p">];</span><span class="w"></span>
<span class="w">            </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">value</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nv">fake</span><span class="p">,</span><span class="w"> </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">secret</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">                    </span><span class="p">(</span>values<span class="p">[</span>i<span class="p">],</span><span class="w"> </span>fakes<span class="p">[</span>i<span class="p">],</span><span class="w"> </span>secrets<span class="p">[</span>i<span class="p">]);</span><span class="w"></span>
<span class="w">            </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>bidToCheck<span class="p">.</span>blindedBid<span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">keccak256</span><span class="p">(</span>abi<span class="p">.</span>encodePacked<span class="p">(</span>value<span class="p">,</span><span class="w"> </span>fake<span class="p">,</span><span class="w"> </span>secret<span class="p">)))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="c1">// Bid was not actually revealed.</span>
<span class="w">                </span><span class="c1">// Do not refund deposit.</span>
<span class="w">                </span><span class="kt">continue</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span>refund<span class="w"> </span><span class="o">+=</span><span class="w"> </span>bidToCheck<span class="p">.</span>deposit<span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span>fake<span class="w"> </span><span class="err">&amp;&amp;</span><span class="w"> </span>bidToCheck<span class="p">.</span>deposit<span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span>value<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>placeBid<span class="p">(</span><span class="k">msg.sender</span><span class="p">,</span><span class="w"> </span>value<span class="p">))</span><span class="w"></span>
<span class="w">                    </span>refund<span class="w"> </span><span class="o">-=</span><span class="w"> </span>value<span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="c1">// Make it impossible for the sender to re-claim</span>
<span class="w">            </span><span class="c1">// the same deposit.</span>
<span class="w">            </span>bidToCheck<span class="p">.</span>blindedBid<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">bytes32</span><span class="p">(</span><span class="m m-Decimal">0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="kt">payable</span><span class="p">(</span><span class="k">msg.sender</span><span class="p">).</span>transfer<span class="p">(</span>refund<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// Withdraw a bid that was overbid.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">withdraw</span><span class="p">()</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="w"> </span><span class="nv">amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>pendingReturns<span class="p">[</span><span class="k">msg.sender</span><span class="p">];</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>amount<span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="c1">// It is important to set this to zero because the recipient</span>
<span class="w">            </span><span class="c1">// can call this function again as part of the receiving call</span>
<span class="w">            </span><span class="c1">// before `transfer` returns (see the remark above about</span>
<span class="w">            </span><span class="c1">// conditions -&gt; effects -&gt; interaction).</span>
<span class="w">            </span>pendingReturns<span class="p">[</span><span class="k">msg.sender</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span><span class="w"></span>

<span class="w">            </span><span class="kt">payable</span><span class="p">(</span><span class="k">msg.sender</span><span class="p">).</span>transfer<span class="p">(</span>amount<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// End the auction and send the highest bid</span>
<span class="w">    </span><span class="c1">/// to the beneficiary.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">auctionEnd</span><span class="p">()</span><span class="w"></span>
<span class="w">        </span><span class="kt">external</span><span class="w"></span>
<span class="w">        </span>onlyAfter<span class="p">(</span>revealEnd<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>ended<span class="p">)</span><span class="w"> </span>revert<span class="w"> </span>AuctionEndAlreadyCalled<span class="p">();</span><span class="w"></span>
<span class="w">        </span>emit<span class="w"> </span>AuctionEnded<span class="p">(</span>highestBidder<span class="p">,</span><span class="w"> </span>highestBid<span class="p">);</span><span class="w"></span>
<span class="w">        </span>ended<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span>beneficiary<span class="p">.</span>transfer<span class="p">(</span>highestBid<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">// This is an &quot;internal&quot; function which means that it</span>
<span class="w">    </span><span class="c1">// can only be called from the contract itself (or from</span>
<span class="w">    </span><span class="c1">// derived contracts).</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">placeBid</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">bidder</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"></span>
<span class="w">            </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="nv">success</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>value<span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span>highestBid<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="kt">return</span><span class="w"> </span><span class="kt">false</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>highestBidder<span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kt">address</span><span class="p">(</span><span class="m m-Decimal">0</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="c1">// Refund the previously highest bidder.</span>
<span class="w">            </span>pendingReturns<span class="p">[</span>highestBidder<span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span>highestBid<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span>highestBid<span class="w"> </span><span class="o">=</span><span class="w"> </span>value<span class="p">;</span><span class="w"></span>
<span class="w">        </span>highestBidder<span class="w"> </span><span class="o">=</span><span class="w"> </span>bidder<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
<section id="safe-remote-purchase">
<span id="index-2"></span><h3>Safe Remote Purchase<a class="headerlink" href="#safe-remote-purchase" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Purchasing goods remotely currently requires multiple parties that need to trust each other.
The simplest configuration involves a seller and a buyer. The buyer would like to receive
an item from the seller and the seller would like to get money (or an equivalent)
in return. The problematic part is the shipment here: There is no way to determine for
sure that the item arrived at the buyer.</p>
<p>There are multiple ways to solve this problem, but all fall short in one or the other way.
In the following example, both parties have to put twice the value of the item into the
contract as escrow. As soon as this happened, the money will stay locked inside
the contract until the buyer confirms that they received the item. After that,
the buyer is returned the value (half of their deposit) and the seller gets three
times the value (their deposit plus the value). The idea behind
this is that both parties have an incentive to resolve the situation or otherwise
their money is locked forever.</p>
<p>This contract of course does not solve the problem, but gives an overview of how
you can use state machine-like constructs inside a contract.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5IF4wLjguNDsKY29udHJhY3QgUHVyY2hhc2UgewogICAgdWludCBwdWJsaWMgdmFsdWU7CiAgICBhZGRyZXNzIHBheWFibGUgcHVibGljIHNlbGxlcjsKICAgIGFkZHJlc3MgcGF5YWJsZSBwdWJsaWMgYnV5ZXI7CgogICAgZW51bSBTdGF0ZSB7IENyZWF0ZWQsIExvY2tlZCwgUmVsZWFzZSwgSW5hY3RpdmUgfQogICAgLy8gVGhlIHN0YXRlIHZhcmlhYmxlIGhhcyBhIGRlZmF1bHQgdmFsdWUgb2YgdGhlIGZpcnN0IG1lbWJlciwgYFN0YXRlLmNyZWF0ZWRgCiAgICBTdGF0ZSBwdWJsaWMgc3RhdGU7CgogICAgbW9kaWZpZXIgY29uZGl0aW9uKGJvb2wgY29uZGl0aW9uXykgewogICAgICAgIHJlcXVpcmUoY29uZGl0aW9uXyk7CiAgICAgICAgXzsKICAgIH0KCiAgICAvLy8gT25seSB0aGUgYnV5ZXIgY2FuIGNhbGwgdGhpcyBmdW5jdGlvbi4KICAgIGVycm9yIE9ubHlCdXllcigpOwogICAgLy8vIE9ubHkgdGhlIHNlbGxlciBjYW4gY2FsbCB0aGlzIGZ1bmN0aW9uLgogICAgZXJyb3IgT25seVNlbGxlcigpOwogICAgLy8vIFRoZSBmdW5jdGlvbiBjYW5ub3QgYmUgY2FsbGVkIGF0IHRoZSBjdXJyZW50IHN0YXRlLgogICAgZXJyb3IgSW52YWxpZFN0YXRlKCk7CiAgICAvLy8gVGhlIHByb3ZpZGVkIHZhbHVlIGhhcyB0byBiZSBldmVuLgogICAgZXJyb3IgVmFsdWVOb3RFdmVuKCk7CgogICAgbW9kaWZpZXIgb25seUJ1eWVyKCkgewogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IGJ1eWVyKQogICAgICAgICAgICByZXZlcnQgT25seUJ1eWVyKCk7CiAgICAgICAgXzsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5U2VsbGVyKCkgewogICAgICAgIGlmIChtc2cuc2VuZGVyICE9IHNlbGxlcikKICAgICAgICAgICAgcmV2ZXJ0IE9ubHlTZWxsZXIoKTsKICAgICAgICBfOwogICAgfQoKICAgIG1vZGlmaWVyIGluU3RhdGUoU3RhdGUgc3RhdGVfKSB7CiAgICAgICAgaWYgKHN0YXRlICE9IHN0YXRlXykKICAgICAgICAgICAgcmV2ZXJ0IEludmFsaWRTdGF0ZSgpOwogICAgICAgIF87CiAgICB9CgogICAgZXZlbnQgQWJvcnRlZCgpOwogICAgZXZlbnQgUHVyY2hhc2VDb25maXJtZWQoKTsKICAgIGV2ZW50IEl0ZW1SZWNlaXZlZCgpOwogICAgZXZlbnQgU2VsbGVyUmVmdW5kZWQoKTsKCiAgICAvLyBFbnN1cmUgdGhhdCBgbXNnLnZhbHVlYCBpcyBhbiBldmVuIG51bWJlci4KICAgIC8vIERpdmlzaW9uIHdpbGwgdHJ1bmNhdGUgaWYgaXQgaXMgYW4gb2RkIG51bWJlci4KICAgIC8vIENoZWNrIHZpYSBtdWx0aXBsaWNhdGlvbiB0aGF0IGl0IHdhc24ndCBhbiBvZGQgbnVtYmVyLgogICAgY29uc3RydWN0b3IoKSBwYXlhYmxlIHsKICAgICAgICBzZWxsZXIgPSBwYXlhYmxlKG1zZy5zZW5kZXIpOwogICAgICAgIHZhbHVlID0gbXNnLnZhbHVlIC8gMjsKICAgICAgICBpZiAoKDIgKiB2YWx1ZSkgIT0gbXNnLnZhbHVlKQogICAgICAgICAgICByZXZlcnQgVmFsdWVOb3RFdmVuKCk7CiAgICB9CgogICAgLy8vIEFib3J0IHRoZSBwdXJjaGFzZSBhbmQgcmVjbGFpbSB0aGUgZXRoZXIuCiAgICAvLy8gQ2FuIG9ubHkgYmUgY2FsbGVkIGJ5IHRoZSBzZWxsZXIgYmVmb3JlCiAgICAvLy8gdGhlIGNvbnRyYWN0IGlzIGxvY2tlZC4KICAgIGZ1bmN0aW9uIGFib3J0KCkKICAgICAgICBleHRlcm5hbAogICAgICAgIG9ubHlTZWxsZXIKICAgICAgICBpblN0YXRlKFN0YXRlLkNyZWF0ZWQpCiAgICB7CiAgICAgICAgZW1pdCBBYm9ydGVkKCk7CiAgICAgICAgc3RhdGUgPSBTdGF0ZS5JbmFjdGl2ZTsKICAgICAgICAvLyBXZSB1c2UgdHJhbnNmZXIgaGVyZSBkaXJlY3RseS4gSXQgaXMKICAgICAgICAvLyByZWVudHJhbmN5LXNhZmUsIGJlY2F1c2UgaXQgaXMgdGhlCiAgICAgICAgLy8gbGFzdCBjYWxsIGluIHRoaXMgZnVuY3Rpb24gYW5kIHdlCiAgICAgICAgLy8gYWxyZWFkeSBjaGFuZ2VkIHRoZSBzdGF0ZS4KICAgICAgICBzZWxsZXIudHJhbnNmZXIoYWRkcmVzcyh0aGlzKS5iYWxhbmNlKTsKICAgIH0KCiAgICAvLy8gQ29uZmlybSB0aGUgcHVyY2hhc2UgYXMgYnV5ZXIuCiAgICAvLy8gVHJhbnNhY3Rpb24gaGFzIHRvIGluY2x1ZGUgYDIgKiB2YWx1ZWAgZXRoZXIuCiAgICAvLy8gVGhlIGV0aGVyIHdpbGwgYmUgbG9ja2VkIHVudGlsIGNvbmZpcm1SZWNlaXZlZAogICAgLy8vIGlzIGNhbGxlZC4KICAgIGZ1bmN0aW9uIGNvbmZpcm1QdXJjaGFzZSgpCiAgICAgICAgZXh0ZXJuYWwKICAgICAgICBpblN0YXRlKFN0YXRlLkNyZWF0ZWQpCiAgICAgICAgY29uZGl0aW9uKG1zZy52YWx1ZSA9PSAoMiAqIHZhbHVlKSkKICAgICAgICBwYXlhYmxlCiAgICB7CiAgICAgICAgZW1pdCBQdXJjaGFzZUNvbmZpcm1lZCgpOwogICAgICAgIGJ1eWVyID0gcGF5YWJsZShtc2cuc2VuZGVyKTsKICAgICAgICBzdGF0ZSA9IFN0YXRlLkxvY2tlZDsKICAgIH0KCiAgICAvLy8gQ29uZmlybSB0aGF0IHlvdSAodGhlIGJ1eWVyKSByZWNlaXZlZCB0aGUgaXRlbS4KICAgIC8vLyBUaGlzIHdpbGwgcmVsZWFzZSB0aGUgbG9ja2VkIGV0aGVyLgogICAgZnVuY3Rpb24gY29uZmlybVJlY2VpdmVkKCkKICAgICAgICBleHRlcm5hbAogICAgICAgIG9ubHlCdXllcgogICAgICAgIGluU3RhdGUoU3RhdGUuTG9ja2VkKQogICAgewogICAgICAgIGVtaXQgSXRlbVJlY2VpdmVkKCk7CiAgICAgICAgLy8gSXQgaXMgaW1wb3J0YW50IHRvIGNoYW5nZSB0aGUgc3RhdGUgZmlyc3QgYmVjYXVzZQogICAgICAgIC8vIG90aGVyd2lzZSwgdGhlIGNvbnRyYWN0cyBjYWxsZWQgdXNpbmcgYHNlbmRgIGJlbG93CiAgICAgICAgLy8gY2FuIGNhbGwgaW4gYWdhaW4gaGVyZS4KICAgICAgICBzdGF0ZSA9IFN0YXRlLlJlbGVhc2U7CgogICAgICAgIGJ1eWVyLnRyYW5zZmVyKHZhbHVlKTsKICAgIH0KCiAgICAvLy8gVGhpcyBmdW5jdGlvbiByZWZ1bmRzIHRoZSBzZWxsZXIsIGkuZS4KICAgIC8vLyBwYXlzIGJhY2sgdGhlIGxvY2tlZCBmdW5kcyBvZiB0aGUgc2VsbGVyLgogICAgZnVuY3Rpb24gcmVmdW5kU2VsbGVyKCkKICAgICAgICBleHRlcm5hbAogICAgICAgIG9ubHlTZWxsZXIKICAgICAgICBpblN0YXRlKFN0YXRlLlJlbGVhc2UpCiAgICB7CiAgICAgICAgZW1pdCBTZWxsZXJSZWZ1bmRlZCgpOwogICAgICAgIC8vIEl0IGlzIGltcG9ydGFudCB0byBjaGFuZ2UgdGhlIHN0YXRlIGZpcnN0IGJlY2F1c2UKICAgICAgICAvLyBvdGhlcndpc2UsIHRoZSBjb250cmFjdHMgY2FsbGVkIHVzaW5nIGBzZW5kYCBiZWxvdwogICAgICAgIC8vIGNhbiBjYWxsIGluIGFnYWluIGhlcmUuCiAgICAgICAgc3RhdGUgPSBTdGF0ZS5JbmFjdGl2ZTsKCiAgICAgICAgc2VsbGVyLnRyYW5zZmVyKDMgKiB2YWx1ZSk7CiAgICB9Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.8.4</span><span class="p">;</span><span class="w"></span>
<span class="k">contract</span><span class="w"> </span><span class="ni">Purchase</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="k">public </span><span class="nv">value</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">payable</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>seller<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">payable</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>buyer<span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kt">enum</span><span class="w"> </span><span class="nv">State</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>Created<span class="p">,</span><span class="w"> </span>Locked<span class="p">,</span><span class="w"> </span>Release<span class="p">,</span><span class="w"> </span>Inactive<span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="c1">// The state variable has a default value of the first member, `State.created`</span>
<span class="w">    </span>State<span class="w"> </span><span class="kt">public</span><span class="w"> </span>state<span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kt">modifier</span><span class="w"> </span>condition<span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="nv">condition_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>condition_<span class="p">);</span><span class="w"></span>
<span class="w">        </span>_<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// Only the buyer can call this function.</span>
<span class="w">    </span>error<span class="w"> </span>OnlyBuyer<span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="c1">/// Only the seller can call this function.</span>
<span class="w">    </span>error<span class="w"> </span>OnlySeller<span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="c1">/// The function cannot be called at the current state.</span>
<span class="w">    </span>error<span class="w"> </span>InvalidState<span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="c1">/// The provided value has to be even.</span>
<span class="w">    </span>error<span class="w"> </span>ValueNotEven<span class="p">();</span><span class="w"></span>

<span class="w">    </span><span class="kt">modifier</span><span class="w"> </span>onlyBuyer<span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span><span class="k">msg.sender</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span>buyer<span class="p">)</span><span class="w"></span>
<span class="w">            </span>revert<span class="w"> </span>OnlyBuyer<span class="p">();</span><span class="w"></span>
<span class="w">        </span>_<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">modifier</span><span class="w"> </span>onlySeller<span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span><span class="k">msg.sender</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span>seller<span class="p">)</span><span class="w"></span>
<span class="w">            </span>revert<span class="w"> </span>OnlySeller<span class="p">();</span><span class="w"></span>
<span class="w">        </span>_<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">modifier</span><span class="w"> </span>inState<span class="p">(</span>State<span class="w"> </span>state_<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>state<span class="w"> </span><span class="o">!=</span><span class="w"> </span>state_<span class="p">)</span><span class="w"></span>
<span class="w">            </span>revert<span class="w"> </span>InvalidState<span class="p">();</span><span class="w"></span>
<span class="w">        </span>_<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">Aborted</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">PurchaseConfirmed</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">ItemReceived</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">SellerRefunded</span><span class="p">();</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Ensure that `msg.value` is an even number.</span>
<span class="w">    </span><span class="c1">// Division will truncate if it is an odd number.</span>
<span class="w">    </span><span class="c1">// Check via multiplication that it wasn&#39;t an odd number.</span>
<span class="w">    </span><span class="kt">constructor</span><span class="p">()</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>seller<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">payable</span><span class="p">(</span><span class="k">msg.sender</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span>value<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">msg.value</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m m-Decimal">2</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">((</span><span class="m m-Decimal">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span>value<span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">msg.value</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span>revert<span class="w"> </span>ValueNotEven<span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// Abort the purchase and reclaim the ether.</span>
<span class="w">    </span><span class="c1">/// Can only be called by the seller before</span>
<span class="w">    </span><span class="c1">/// the contract is locked.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">abort</span><span class="p">()</span><span class="w"></span>
<span class="w">        </span><span class="kt">external</span><span class="w"></span>
<span class="w">        </span>onlySeller<span class="w"></span>
<span class="w">        </span>inState<span class="p">(</span>State<span class="p">.</span>Created<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>emit<span class="w"> </span>Aborted<span class="p">();</span><span class="w"></span>
<span class="w">        </span>state<span class="w"> </span><span class="o">=</span><span class="w"> </span>State<span class="p">.</span>Inactive<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="c1">// We use transfer here directly. It is</span>
<span class="w">        </span><span class="c1">// reentrancy-safe, because it is the</span>
<span class="w">        </span><span class="c1">// last call in this function and we</span>
<span class="w">        </span><span class="c1">// already changed the state.</span>
<span class="w">        </span>seller<span class="p">.</span>transfer<span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="kt">this</span><span class="p">).</span>balance<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// Confirm the purchase as buyer.</span>
<span class="w">    </span><span class="c1">/// Transaction has to include `2 * value` ether.</span>
<span class="w">    </span><span class="c1">/// The ether will be locked until confirmReceived</span>
<span class="w">    </span><span class="c1">/// is called.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">confirmPurchase</span><span class="p">()</span><span class="w"></span>
<span class="w">        </span><span class="kt">external</span><span class="w"></span>
<span class="w">        </span>inState<span class="p">(</span>State<span class="p">.</span>Created<span class="p">)</span><span class="w"></span>
<span class="w">        </span>condition<span class="p">(</span><span class="k">msg.value</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="p">(</span><span class="m m-Decimal">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span>value<span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="kt">payable</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>emit<span class="w"> </span>PurchaseConfirmed<span class="p">();</span><span class="w"></span>
<span class="w">        </span>buyer<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">payable</span><span class="p">(</span><span class="k">msg.sender</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span>state<span class="w"> </span><span class="o">=</span><span class="w"> </span>State<span class="p">.</span>Locked<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// Confirm that you (the buyer) received the item.</span>
<span class="w">    </span><span class="c1">/// This will release the locked ether.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">confirmReceived</span><span class="p">()</span><span class="w"></span>
<span class="w">        </span><span class="kt">external</span><span class="w"></span>
<span class="w">        </span>onlyBuyer<span class="w"></span>
<span class="w">        </span>inState<span class="p">(</span>State<span class="p">.</span>Locked<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>emit<span class="w"> </span>ItemReceived<span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="c1">// It is important to change the state first because</span>
<span class="w">        </span><span class="c1">// otherwise, the contracts called using `send` below</span>
<span class="w">        </span><span class="c1">// can call in again here.</span>
<span class="w">        </span>state<span class="w"> </span><span class="o">=</span><span class="w"> </span>State<span class="p">.</span>Release<span class="p">;</span><span class="w"></span>

<span class="w">        </span>buyer<span class="p">.</span>transfer<span class="p">(</span>value<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// This function refunds the seller, i.e.</span>
<span class="w">    </span><span class="c1">/// pays back the locked funds of the seller.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">refundSeller</span><span class="p">()</span><span class="w"></span>
<span class="w">        </span><span class="kt">external</span><span class="w"></span>
<span class="w">        </span>onlySeller<span class="w"></span>
<span class="w">        </span>inState<span class="p">(</span>State<span class="p">.</span>Release<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>emit<span class="w"> </span>SellerRefunded<span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="c1">// It is important to change the state first because</span>
<span class="w">        </span><span class="c1">// otherwise, the contracts called using `send` below</span>
<span class="w">        </span><span class="c1">// can call in again here.</span>
<span class="w">        </span>state<span class="w"> </span><span class="o">=</span><span class="w"> </span>State<span class="p">.</span>Inactive<span class="p">;</span><span class="w"></span>

<span class="w">        </span>seller<span class="p">.</span>transfer<span class="p">(</span><span class="m m-Decimal">3</span><span class="w"> </span><span class="o">*</span><span class="w"> </span>value<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="micropayment-channel">
<h3>Micropayment Channel<a class="headerlink" href="#micropayment-channel" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>In this section we will learn how to build an example implementation
of a payment channel. It uses cryptographic signatures to make
repeated transfers of Ether between the same parties secure, instantaneous, and
without transaction fees. For the example, we need to understand how to
sign and verify signatures, and setup the payment channel.</p>
<section id="creating-and-verifying-signatures">
<h4>Creating and verifying signatures<a class="headerlink" href="#creating-and-verifying-signatures" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Imagine Alice wants to send some Ether to Bob, i.e.
Alice is the sender and Bob is the recipient.</p>
<p>Alice only needs to send cryptographically signed messages off-chain
(e.g. via email) to Bob and it is similar to writing checks.</p>
<p>Alice and Bob use signatures to authorise transactions, which is possible with smart contracts on Ethereum.
Alice will build a simple smart contract that lets her transmit Ether, but instead of calling a function herself
to initiate a payment, she will let Bob do that, and therefore pay the transaction fee.</p>
<p>The contract will work as follows:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Alice deploys the <code class="docutils literal notranslate"><span class="pre">ReceiverPays</span></code> contract, attaching enough Ether to cover the payments that will be made.</p></li>
<li><p>Alice authorises a payment by signing a message with her private key.</p></li>
<li><p>Alice sends the cryptographically signed message to Bob. The message does not need to be kept secret
(explained later), and the mechanism for sending it does not matter.</p></li>
<li><p>Bob claims his payment by presenting the signed message to the smart contract, it verifies the
authenticity of the message and then releases the funds.</p></li>
</ol>
</div></blockquote>
<section id="creating-the-signature">
<h5>Creating the signature<a class="headerlink" href="#creating-the-signature" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>Alice does not need to interact with the Ethereum network
to sign the transaction, the process is completely offline.
In this tutorial, we will sign messages in the browser
using <a class="reference external" href="https://github.com/ethereum/web3.js">web3.js</a> and
<a class="reference external" href="https://metamask.io">MetaMask</a>, using the method described in <a class="reference external" href="https://github.com/ethereum/EIPs/pull/712">EIP-712</a>,
as it provides a number of other security benefits.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">/// Hashing first makes things easier</span><span class="w"></span>
<span class="kd">var</span><span class="w"> </span><span class="nx">hash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">web3</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">sha3</span><span class="p">(</span><span class="s2">&quot;message to sign&quot;</span><span class="p">);</span><span class="w"></span>
<span class="nx">web3</span><span class="p">.</span><span class="nx">eth</span><span class="p">.</span><span class="nx">personal</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">hash</span><span class="p">,</span><span class="w"> </span><span class="nx">web3</span><span class="p">.</span><span class="nx">eth</span><span class="p">.</span><span class="nx">defaultAccount</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Signed&quot;</span><span class="p">);</span><span class="w"> </span><span class="p">});</span><span class="w"></span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">web3.eth.personal.sign</span></code> prepends the length of the
message to the signed data. Since we hash first, the message
will always be exactly 32 bytes long, and thus this length
prefix is always the same.</p>
</div>
</section>
<section id="what-to-sign">
<h5>What to Sign<a class="headerlink" href="#what-to-sign" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>For a contract that fulfils payments, the signed message must include:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>The recipient‚Äôs address.</p></li>
<li><p>The amount to be transferred.</p></li>
<li><p>Protection against replay attacks.</p></li>
</ol>
</div></blockquote>
<p>A replay attack is when a signed message is reused to claim
authorization for a second action. To avoid replay attacks
we use the same technique as in Ethereum transactions themselves,
a so-called nonce, which is the number of transactions sent by
an account. The smart contract checks if a nonce is used multiple times.</p>
<p>Another type of replay attack can occur when the owner
deploys a <code class="docutils literal notranslate"><span class="pre">ReceiverPays</span></code> smart contract, makes some
payments, and then destroys the contract. Later, they decide
to deploy the <code class="docutils literal notranslate"><span class="pre">RecipientPays</span></code> smart contract again, but the
new contract does not know the nonces used in the previous
deployment, so the attacker can use the old messages again.</p>
<p>Alice can protect against this attack by including the
contract‚Äôs address in the message, and only messages containing
the contract‚Äôs address itself will be accepted. You can find
an example of this in the first two lines of the <code class="docutils literal notranslate"><span class="pre">claimPayment()</span></code>
function of the full contract at the end of this section.</p>
</section>
<section id="packing-arguments">
<h5>Packing arguments<a class="headerlink" href="#packing-arguments" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>Now that we have identified what information to include in the signed message,
we are ready to put the message together, hash it, and sign it. For simplicity,
we concatenate the data. The <a class="reference external" href="https://github.com/ethereumjs/ethereumjs-abi">ethereumjs-abi</a>
library provides a function called <code class="docutils literal notranslate"><span class="pre">soliditySHA3</span></code> that mimics the behaviour of
Solidity‚Äôs <code class="docutils literal notranslate"><span class="pre">keccak256</span></code> function applied to arguments encoded using <code class="docutils literal notranslate"><span class="pre">abi.encodePacked</span></code>.
Here is a JavaScript function that creates the proper signature for the <code class="docutils literal notranslate"><span class="pre">ReceiverPays</span></code> example:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// recipient is the address that should be paid.</span><span class="w"></span>
<span class="c1">// amount, in wei, specifies how much ether should be sent.</span><span class="w"></span>
<span class="c1">// nonce can be any unique number to prevent replay attacks</span><span class="w"></span>
<span class="c1">// contractAddress is used to prevent cross-contract replay attacks</span><span class="w"></span>
<span class="kd">function</span><span class="w"> </span><span class="nx">signPayment</span><span class="p">(</span><span class="nx">recipient</span><span class="p">,</span><span class="w"> </span><span class="nx">amount</span><span class="p">,</span><span class="w"> </span><span class="nx">nonce</span><span class="p">,</span><span class="w"> </span><span class="nx">contractAddress</span><span class="p">,</span><span class="w"> </span><span class="nx">callback</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">hash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;0x&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">abi</span><span class="p">.</span><span class="nx">soliditySHA3</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;uint256&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;uint256&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;address&quot;</span><span class="p">],</span><span class="w"></span>
<span class="w">        </span><span class="p">[</span><span class="nx">recipient</span><span class="p">,</span><span class="w"> </span><span class="nx">amount</span><span class="p">,</span><span class="w"> </span><span class="nx">nonce</span><span class="p">,</span><span class="w"> </span><span class="nx">contractAddress</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="p">).</span><span class="nx">toString</span><span class="p">(</span><span class="s2">&quot;hex&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="nx">web3</span><span class="p">.</span><span class="nx">eth</span><span class="p">.</span><span class="nx">personal</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">hash</span><span class="p">,</span><span class="w"> </span><span class="nx">web3</span><span class="p">.</span><span class="nx">eth</span><span class="p">.</span><span class="nx">defaultAccount</span><span class="p">,</span><span class="w"> </span><span class="nx">callback</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="recovering-the-message-signer-in-solidity">
<h5>Recovering the Message Signer in Solidity<a class="headerlink" href="#recovering-the-message-signer-in-solidity" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>In general, ECDSA signatures consist of two parameters,
<code class="docutils literal notranslate"><span class="pre">r</span></code> and <code class="docutils literal notranslate"><span class="pre">s</span></code>. Signatures in Ethereum include a third
parameter called <code class="docutils literal notranslate"><span class="pre">v</span></code>, that you can use to verify which
account‚Äôs private key was used to sign the message, and
the transaction‚Äôs sender. Solidity provides a built-in
function <a class="reference internal" href="index.html#mathematical-and-cryptographic-functions"><span class="std std-ref">ecrecover</span></a> that
accepts a message along with the <code class="docutils literal notranslate"><span class="pre">r</span></code>, <code class="docutils literal notranslate"><span class="pre">s</span></code> and <code class="docutils literal notranslate"><span class="pre">v</span></code> parameters
and returns the address that was used to sign the message.</p>
</section>
<section id="extracting-the-signature-parameters">
<h5>Extracting the Signature Parameters<a class="headerlink" href="#extracting-the-signature-parameters" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>Signatures produced by web3.js are the concatenation of <code class="docutils literal notranslate"><span class="pre">r</span></code>,
<code class="docutils literal notranslate"><span class="pre">s</span></code> and <code class="docutils literal notranslate"><span class="pre">v</span></code>, so the first step is to split these parameters
apart. You can do this on the client-side, but doing it inside
the smart contract means you only need to send one signature
parameter rather than three. Splitting apart a byte array into
its constituent parts is a mess, so we use
<a class="reference internal" href="index.html#document-assembly"><span class="doc">inline assembly</span></a> to do the job in the <code class="docutils literal notranslate"><span class="pre">splitSignature</span></code>
function (the third function in the full contract at the end of this section).</p>
</section>
<section id="computing-the-message-hash">
<h5>Computing the Message Hash<a class="headerlink" href="#computing-the-message-hash" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>The smart contract needs to know exactly what parameters were signed, and so it
must recreate the message from the parameters and use that for signature verification.
The functions <code class="docutils literal notranslate"><span class="pre">prefixed</span></code> and <code class="docutils literal notranslate"><span class="pre">recoverSigner</span></code> do this in the <code class="docutils literal notranslate"><span class="pre">claimPayment</span></code> function.</p>
</section>
<section id="the-full-contract">
<h5>The full contract<a class="headerlink" href="#the-full-contract" title="Permalink to this heading">ÔÉÅ</a></h5>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC43LjAgPDAuOS4wOwpjb250cmFjdCBSZWNlaXZlclBheXMgewogICAgYWRkcmVzcyBvd25lciA9IG1zZy5zZW5kZXI7CgogICAgbWFwcGluZyh1aW50MjU2ID0+IGJvb2wpIHVzZWROb25jZXM7CgogICAgY29uc3RydWN0b3IoKSBwYXlhYmxlIHt9CgogICAgZnVuY3Rpb24gY2xhaW1QYXltZW50KHVpbnQyNTYgYW1vdW50LCB1aW50MjU2IG5vbmNlLCBieXRlcyBtZW1vcnkgc2lnbmF0dXJlKSBleHRlcm5hbCB7CiAgICAgICAgcmVxdWlyZSghdXNlZE5vbmNlc1tub25jZV0pOwogICAgICAgIHVzZWROb25jZXNbbm9uY2VdID0gdHJ1ZTsKCiAgICAgICAgLy8gdGhpcyByZWNyZWF0ZXMgdGhlIG1lc3NhZ2UgdGhhdCB3YXMgc2lnbmVkIG9uIHRoZSBjbGllbnQKICAgICAgICBieXRlczMyIG1lc3NhZ2UgPSBwcmVmaXhlZChrZWNjYWsyNTYoYWJpLmVuY29kZVBhY2tlZChtc2cuc2VuZGVyLCBhbW91bnQsIG5vbmNlLCB0aGlzKSkpOwoKICAgICAgICByZXF1aXJlKHJlY292ZXJTaWduZXIobWVzc2FnZSwgc2lnbmF0dXJlKSA9PSBvd25lcik7CgogICAgICAgIHBheWFibGUobXNnLnNlbmRlcikudHJhbnNmZXIoYW1vdW50KTsKICAgIH0KCiAgICAvLy8gZGVzdHJveSB0aGUgY29udHJhY3QgYW5kIHJlY2xhaW0gdGhlIGxlZnRvdmVyIGZ1bmRzLgogICAgZnVuY3Rpb24gc2h1dGRvd24oKSBleHRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IG93bmVyKTsKICAgICAgICBzZWxmZGVzdHJ1Y3QocGF5YWJsZShtc2cuc2VuZGVyKSk7CiAgICB9CgogICAgLy8vIHNpZ25hdHVyZSBtZXRob2RzLgogICAgZnVuY3Rpb24gc3BsaXRTaWduYXR1cmUoYnl0ZXMgbWVtb3J5IHNpZykKICAgICAgICBpbnRlcm5hbAogICAgICAgIHB1cmUKICAgICAgICByZXR1cm5zICh1aW50OCB2LCBieXRlczMyIHIsIGJ5dGVzMzIgcykKICAgIHsKICAgICAgICByZXF1aXJlKHNpZy5sZW5ndGggPT0gNjUpOwoKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIC8vIGZpcnN0IDMyIGJ5dGVzLCBhZnRlciB0aGUgbGVuZ3RoIHByZWZpeC4KICAgICAgICAgICAgciA6PSBtbG9hZChhZGQoc2lnLCAzMikpCiAgICAgICAgICAgIC8vIHNlY29uZCAzMiBieXRlcy4KICAgICAgICAgICAgcyA6PSBtbG9hZChhZGQoc2lnLCA2NCkpCiAgICAgICAgICAgIC8vIGZpbmFsIGJ5dGUgKGZpcnN0IGJ5dGUgb2YgdGhlIG5leHQgMzIgYnl0ZXMpLgogICAgICAgICAgICB2IDo9IGJ5dGUoMCwgbWxvYWQoYWRkKHNpZywgOTYpKSkKICAgICAgICB9CgogICAgICAgIHJldHVybiAodiwgciwgcyk7CiAgICB9CgogICAgZnVuY3Rpb24gcmVjb3ZlclNpZ25lcihieXRlczMyIG1lc3NhZ2UsIGJ5dGVzIG1lbW9yeSBzaWcpCiAgICAgICAgaW50ZXJuYWwKICAgICAgICBwdXJlCiAgICAgICAgcmV0dXJucyAoYWRkcmVzcykKICAgIHsKICAgICAgICAodWludDggdiwgYnl0ZXMzMiByLCBieXRlczMyIHMpID0gc3BsaXRTaWduYXR1cmUoc2lnKTsKCiAgICAgICAgcmV0dXJuIGVjcmVjb3ZlcihtZXNzYWdlLCB2LCByLCBzKTsKICAgIH0KCiAgICAvLy8gYnVpbGRzIGEgcHJlZml4ZWQgaGFzaCB0byBtaW1pYyB0aGUgYmVoYXZpb3Igb2YgZXRoX3NpZ24uCiAgICBmdW5jdGlvbiBwcmVmaXhlZChieXRlczMyIGhhc2gpIGludGVybmFsIHB1cmUgcmV0dXJucyAoYnl0ZXMzMikgewogICAgICAgIHJldHVybiBrZWNjYWsyNTYoYWJpLmVuY29kZVBhY2tlZCgiXHgxOUV0aGVyZXVtIFNpZ25lZCBNZXNzYWdlOlxuMzIiLCBoYXNoKSk7CiAgICB9Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.7.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>
<span class="k">contract</span><span class="w"> </span><span class="ni">ReceiverPays</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">msg.sender</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span>usedNonces<span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kt">constructor</span><span class="p">()</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">claimPayment</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amount</span><span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">nonce</span><span class="p">,</span><span class="w"> </span><span class="kt">bytes</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>signature<span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span><span class="o">!</span>usedNonces<span class="p">[</span>nonce<span class="p">]);</span><span class="w"></span>
<span class="w">        </span>usedNonces<span class="p">[</span>nonce<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="c1">// this recreates the message that was signed on the client</span>
<span class="w">        </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>prefixed<span class="p">(</span><span class="nb">keccak256</span><span class="p">(</span>abi<span class="p">.</span>encodePacked<span class="p">(</span><span class="k">msg.sender</span><span class="p">,</span><span class="w"> </span>amount<span class="p">,</span><span class="w"> </span>nonce<span class="p">,</span><span class="w"> </span><span class="kt">this</span><span class="p">)));</span><span class="w"></span>

<span class="w">        </span><span class="kt">require</span><span class="p">(</span>recoverSigner<span class="p">(</span>message<span class="p">,</span><span class="w"> </span>signature<span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>owner<span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="kt">payable</span><span class="p">(</span><span class="k">msg.sender</span><span class="p">).</span>transfer<span class="p">(</span>amount<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// destroy the contract and reclaim the leftover funds.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">shutdown</span><span class="p">()</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span><span class="k">msg.sender</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>owner<span class="p">);</span><span class="w"></span>
<span class="w">        </span>selfdestruct<span class="p">(</span><span class="kt">payable</span><span class="p">(</span><span class="k">msg.sender</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// signature methods.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">splitSignature</span><span class="p">(</span><span class="kt">bytes</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>sig<span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="kt">internal</span><span class="w"></span>
<span class="w">        </span>pure<span class="w"></span>
<span class="w">        </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint8</span><span class="w"> </span><span class="nv">v</span><span class="p">,</span><span class="w"> </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">r</span><span class="p">,</span><span class="w"> </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">s</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>sig<span class="p">.</span>length<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m m-Decimal">65</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span>assembly<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="c1">// first 32 bytes, after the length prefix.</span>
<span class="w">            </span>r<span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span>mload<span class="p">(</span>add<span class="p">(</span>sig<span class="p">,</span><span class="w"> </span><span class="m m-Decimal">32</span><span class="p">))</span><span class="w"></span>
<span class="w">            </span><span class="c1">// second 32 bytes.</span>
<span class="w">            </span>s<span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span>mload<span class="p">(</span>add<span class="p">(</span>sig<span class="p">,</span><span class="w"> </span><span class="m m-Decimal">64</span><span class="p">))</span><span class="w"></span>
<span class="w">            </span><span class="c1">// final byte (first byte of the next 32 bytes).</span>
<span class="w">            </span>v<span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span>byte<span class="p">(</span><span class="m m-Decimal">0</span><span class="p">,</span><span class="w"> </span>mload<span class="p">(</span>add<span class="p">(</span>sig<span class="p">,</span><span class="w"> </span><span class="m m-Decimal">96</span><span class="p">)))</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="kt">return</span><span class="w"> </span><span class="p">(</span>v<span class="p">,</span><span class="w"> </span>r<span class="p">,</span><span class="w"> </span>s<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">recoverSigner</span><span class="p">(</span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">message</span><span class="p">,</span><span class="w"> </span><span class="kt">bytes</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>sig<span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="kt">internal</span><span class="w"></span>
<span class="w">        </span>pure<span class="w"></span>
<span class="w">        </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">address</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="p">(</span><span class="kt">uint8</span><span class="w"> </span><span class="nv">v</span><span class="p">,</span><span class="w"> </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">r</span><span class="p">,</span><span class="w"> </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">s</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>splitSignature<span class="p">(</span>sig<span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="kt">return</span><span class="w"> </span>ecrecover<span class="p">(</span>message<span class="p">,</span><span class="w"> </span>v<span class="p">,</span><span class="w"> </span>r<span class="p">,</span><span class="w"> </span>s<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// builds a prefixed hash to mimic the behavior of eth_sign.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">prefixed</span><span class="p">(</span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">hash</span><span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bytes32</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span><span class="nb">keccak256</span><span class="p">(</span>abi<span class="p">.</span>encodePacked<span class="p">(</span><span class="s2">&quot;\x19Ethereum Signed Message:\n32&quot;</span><span class="p">,</span><span class="w"> </span><span class="kt">hash</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
<section id="writing-a-simple-payment-channel">
<h4>Writing a Simple Payment Channel<a class="headerlink" href="#writing-a-simple-payment-channel" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Alice now builds a simple but complete implementation of a payment
channel. Payment channels use cryptographic signatures to make
repeated transfers of Ether securely, instantaneously, and without transaction fees.</p>
<section id="what-is-a-payment-channel">
<h5>What is a Payment Channel?<a class="headerlink" href="#what-is-a-payment-channel" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>Payment channels allow participants to make repeated transfers of Ether
without using transactions. This means that you can avoid the delays and
fees associated with transactions. We are going to explore a simple
unidirectional payment channel between two parties (Alice and Bob). It involves three steps:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Alice funds a smart contract with Ether. This ‚Äúopens‚Äù the payment channel.</p></li>
<li><p>Alice signs messages that specify how much of that Ether is owed to the recipient. This step is repeated for each payment.</p></li>
<li><p>Bob ‚Äúcloses‚Äù the payment channel, withdrawing his portion of the Ether and sending the remainder back to the sender.</p></li>
</ol>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Only steps 1 and 3 require Ethereum transactions, step 2 means that the sender
transmits a cryptographically signed message to the recipient via off chain
methods (e.g. email). This means only two transactions are required to support
any number of transfers.</p>
</div>
<p>Bob is guaranteed to receive his funds because the smart contract escrows the
Ether and honours a valid signed message. The smart contract also enforces a
timeout, so Alice is guaranteed to eventually recover her funds even if the
recipient refuses to close the channel. It is up to the participants in a payment
channel to decide how long to keep it open. For a short-lived transaction,
such as paying an internet caf√© for each minute of network access, the payment
channel may be kept open for a limited duration. On the other hand, for a
recurring payment, such as paying an employee an hourly wage, the payment channel
may be kept open for several months or years.</p>
</section>
<section id="opening-the-payment-channel">
<h5>Opening the Payment Channel<a class="headerlink" href="#opening-the-payment-channel" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>To open the payment channel, Alice deploys the smart contract, attaching
the Ether to be escrowed and specifying the intended recipient and a
maximum duration for the channel to exist. This is the function
<code class="docutils literal notranslate"><span class="pre">SimplePaymentChannel</span></code> in the contract, at the end of this section.</p>
</section>
<section id="making-payments">
<h5>Making Payments<a class="headerlink" href="#making-payments" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>Alice makes payments by sending signed messages to Bob.
This step is performed entirely outside of the Ethereum network.
Messages are cryptographically signed by the sender and then transmitted directly to the recipient.</p>
<p>Each message includes the following information:</p>
<blockquote>
<div><ul class="simple">
<li><p>The smart contract‚Äôs address, used to prevent cross-contract replay attacks.</p></li>
<li><p>The total amount of Ether that is owed the recipient so far.</p></li>
</ul>
</div></blockquote>
<p>A payment channel is closed just once, at the end of a series of transfers.
Because of this, only one of the messages sent is redeemed. This is why
each message specifies a cumulative total amount of Ether owed, rather than the
amount of the individual micropayment. The recipient will naturally choose to
redeem the most recent message because that is the one with the highest total.
The nonce per-message is not needed anymore, because the smart contract only
honours a single message. The address of the smart contract is still used
to prevent a message intended for one payment channel from being used for a different channel.</p>
<p>Here is the modified JavaScript code to cryptographically sign a message from the previous section:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span><span class="w"> </span><span class="nx">constructPaymentMessage</span><span class="p">(</span><span class="nx">contractAddress</span><span class="p">,</span><span class="w"> </span><span class="nx">amount</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">abi</span><span class="p">.</span><span class="nx">soliditySHA3</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;uint256&quot;</span><span class="p">],</span><span class="w"></span>
<span class="w">        </span><span class="p">[</span><span class="nx">contractAddress</span><span class="p">,</span><span class="w"> </span><span class="nx">amount</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kd">function</span><span class="w"> </span><span class="nx">signMessage</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span><span class="w"> </span><span class="nx">callback</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nx">web3</span><span class="p">.</span><span class="nx">eth</span><span class="p">.</span><span class="nx">personal</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;0x&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">message</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="s2">&quot;hex&quot;</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="nx">web3</span><span class="p">.</span><span class="nx">eth</span><span class="p">.</span><span class="nx">defaultAccount</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="nx">callback</span><span class="w"></span>
<span class="w">    </span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// contractAddress is used to prevent cross-contract replay attacks.</span><span class="w"></span>
<span class="c1">// amount, in wei, specifies how much Ether should be sent.</span><span class="w"></span>

<span class="kd">function</span><span class="w"> </span><span class="nx">signPayment</span><span class="p">(</span><span class="nx">contractAddress</span><span class="p">,</span><span class="w"> </span><span class="nx">amount</span><span class="p">,</span><span class="w"> </span><span class="nx">callback</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">constructPaymentMessage</span><span class="p">(</span><span class="nx">contractAddress</span><span class="p">,</span><span class="w"> </span><span class="nx">amount</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="nx">signMessage</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span><span class="w"> </span><span class="nx">callback</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="closing-the-payment-channel">
<h5>Closing the Payment Channel<a class="headerlink" href="#closing-the-payment-channel" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>When Bob is ready to receive his funds, it is time to
close the payment channel by calling a <code class="docutils literal notranslate"><span class="pre">close</span></code> function on the smart contract.
Closing the channel pays the recipient the Ether they are owed and
destroys the contract, sending any remaining Ether back to Alice. To
close the channel, Bob needs to provide a message signed by Alice.</p>
<p>The smart contract must verify that the message contains a valid signature from the sender.
The process for doing this verification is the same as the process the recipient uses.
The Solidity functions <code class="docutils literal notranslate"><span class="pre">isValidSignature</span></code> and <code class="docutils literal notranslate"><span class="pre">recoverSigner</span></code> work just like their
JavaScript counterparts in the previous section, with the latter function borrowed from the <code class="docutils literal notranslate"><span class="pre">ReceiverPays</span></code> contract.</p>
<p>Only the payment channel recipient can call the <code class="docutils literal notranslate"><span class="pre">close</span></code> function,
who naturally passes the most recent payment message because that message
carries the highest total owed. If the sender were allowed to call this function,
they could provide a message with a lower amount and cheat the recipient out of what they are owed.</p>
<p>The function verifies the signed message matches the given parameters.
If everything checks out, the recipient is sent their portion of the Ether,
and the sender is sent the rest via a <code class="docutils literal notranslate"><span class="pre">selfdestruct</span></code>.
You can see the <code class="docutils literal notranslate"><span class="pre">close</span></code> function in the full contract.</p>
</section>
<section id="channel-expiration">
<h5>Channel Expiration<a class="headerlink" href="#channel-expiration" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>Bob can close the payment channel at any time, but if they fail to do so,
Alice needs a way to recover her escrowed funds. An <em>expiration</em> time was set
at the time of contract deployment. Once that time is reached, Alice can call
<code class="docutils literal notranslate"><span class="pre">claimTimeout</span></code> to recover her funds. You can see the <code class="docutils literal notranslate"><span class="pre">claimTimeout</span></code> function in the full contract.</p>
<p>After this function is called, Bob can no longer receive any Ether,
so it is important that Bob closes the channel before the expiration is reached.</p>
</section>
<section id="id3">
<h5>The full contract<a class="headerlink" href="#id3" title="Permalink to this heading">ÔÉÅ</a></h5>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC43LjAgPDAuOS4wOwpjb250cmFjdCBTaW1wbGVQYXltZW50Q2hhbm5lbCB7CiAgICBhZGRyZXNzIHBheWFibGUgcHVibGljIHNlbmRlcjsgICAgICAvLyBUaGUgYWNjb3VudCBzZW5kaW5nIHBheW1lbnRzLgogICAgYWRkcmVzcyBwYXlhYmxlIHB1YmxpYyByZWNpcGllbnQ7ICAgLy8gVGhlIGFjY291bnQgcmVjZWl2aW5nIHRoZSBwYXltZW50cy4KICAgIHVpbnQyNTYgcHVibGljIGV4cGlyYXRpb247ICAvLyBUaW1lb3V0IGluIGNhc2UgdGhlIHJlY2lwaWVudCBuZXZlciBjbG9zZXMuCgogICAgY29uc3RydWN0b3IgKGFkZHJlc3MgcGF5YWJsZSByZWNpcGllbnRBZGRyZXNzLCB1aW50MjU2IGR1cmF0aW9uKQogICAgICAgIHBheWFibGUKICAgIHsKICAgICAgICBzZW5kZXIgPSBwYXlhYmxlKG1zZy5zZW5kZXIpOwogICAgICAgIHJlY2lwaWVudCA9IHJlY2lwaWVudEFkZHJlc3M7CiAgICAgICAgZXhwaXJhdGlvbiA9IGJsb2NrLnRpbWVzdGFtcCArIGR1cmF0aW9uOwogICAgfQoKICAgIC8vLyB0aGUgcmVjaXBpZW50IGNhbiBjbG9zZSB0aGUgY2hhbm5lbCBhdCBhbnkgdGltZSBieSBwcmVzZW50aW5nIGEKICAgIC8vLyBzaWduZWQgYW1vdW50IGZyb20gdGhlIHNlbmRlci4gdGhlIHJlY2lwaWVudCB3aWxsIGJlIHNlbnQgdGhhdCBhbW91bnQsCiAgICAvLy8gYW5kIHRoZSByZW1haW5kZXIgd2lsbCBnbyBiYWNrIHRvIHRoZSBzZW5kZXIKICAgIGZ1bmN0aW9uIGNsb3NlKHVpbnQyNTYgYW1vdW50LCBieXRlcyBtZW1vcnkgc2lnbmF0dXJlKSBleHRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShtc2cuc2VuZGVyID09IHJlY2lwaWVudCk7CiAgICAgICAgcmVxdWlyZShpc1ZhbGlkU2lnbmF0dXJlKGFtb3VudCwgc2lnbmF0dXJlKSk7CgogICAgICAgIHJlY2lwaWVudC50cmFuc2ZlcihhbW91bnQpOwogICAgICAgIHNlbGZkZXN0cnVjdChzZW5kZXIpOwogICAgfQoKICAgIC8vLyB0aGUgc2VuZGVyIGNhbiBleHRlbmQgdGhlIGV4cGlyYXRpb24gYXQgYW55IHRpbWUKICAgIGZ1bmN0aW9uIGV4dGVuZCh1aW50MjU2IG5ld0V4cGlyYXRpb24pIGV4dGVybmFsIHsKICAgICAgICByZXF1aXJlKG1zZy5zZW5kZXIgPT0gc2VuZGVyKTsKICAgICAgICByZXF1aXJlKG5ld0V4cGlyYXRpb24gPiBleHBpcmF0aW9uKTsKCiAgICAgICAgZXhwaXJhdGlvbiA9IG5ld0V4cGlyYXRpb247CiAgICB9CgogICAgLy8vIGlmIHRoZSB0aW1lb3V0IGlzIHJlYWNoZWQgd2l0aG91dCB0aGUgcmVjaXBpZW50IGNsb3NpbmcgdGhlIGNoYW5uZWwsCiAgICAvLy8gdGhlbiB0aGUgRXRoZXIgaXMgcmVsZWFzZWQgYmFjayB0byB0aGUgc2VuZGVyLgogICAgZnVuY3Rpb24gY2xhaW1UaW1lb3V0KCkgZXh0ZXJuYWwgewogICAgICAgIHJlcXVpcmUoYmxvY2sudGltZXN0YW1wID49IGV4cGlyYXRpb24pOwogICAgICAgIHNlbGZkZXN0cnVjdChzZW5kZXIpOwogICAgfQoKICAgIGZ1bmN0aW9uIGlzVmFsaWRTaWduYXR1cmUodWludDI1NiBhbW91bnQsIGJ5dGVzIG1lbW9yeSBzaWduYXR1cmUpCiAgICAgICAgaW50ZXJuYWwKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICBieXRlczMyIG1lc3NhZ2UgPSBwcmVmaXhlZChrZWNjYWsyNTYoYWJpLmVuY29kZVBhY2tlZCh0aGlzLCBhbW91bnQpKSk7CgogICAgICAgIC8vIGNoZWNrIHRoYXQgdGhlIHNpZ25hdHVyZSBpcyBmcm9tIHRoZSBwYXltZW50IHNlbmRlcgogICAgICAgIHJldHVybiByZWNvdmVyU2lnbmVyKG1lc3NhZ2UsIHNpZ25hdHVyZSkgPT0gc2VuZGVyOwogICAgfQoKICAgIC8vLyBBbGwgZnVuY3Rpb25zIGJlbG93IHRoaXMgYXJlIGp1c3QgdGFrZW4gZnJvbSB0aGUgY2hhcHRlcgogICAgLy8vICdjcmVhdGluZyBhbmQgdmVyaWZ5aW5nIHNpZ25hdHVyZXMnIGNoYXB0ZXIuCgogICAgZnVuY3Rpb24gc3BsaXRTaWduYXR1cmUoYnl0ZXMgbWVtb3J5IHNpZykKICAgICAgICBpbnRlcm5hbAogICAgICAgIHB1cmUKICAgICAgICByZXR1cm5zICh1aW50OCB2LCBieXRlczMyIHIsIGJ5dGVzMzIgcykKICAgIHsKICAgICAgICByZXF1aXJlKHNpZy5sZW5ndGggPT0gNjUpOwoKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIC8vIGZpcnN0IDMyIGJ5dGVzLCBhZnRlciB0aGUgbGVuZ3RoIHByZWZpeAogICAgICAgICAgICByIDo9IG1sb2FkKGFkZChzaWcsIDMyKSkKICAgICAgICAgICAgLy8gc2Vjb25kIDMyIGJ5dGVzCiAgICAgICAgICAgIHMgOj0gbWxvYWQoYWRkKHNpZywgNjQpKQogICAgICAgICAgICAvLyBmaW5hbCBieXRlIChmaXJzdCBieXRlIG9mIHRoZSBuZXh0IDMyIGJ5dGVzKQogICAgICAgICAgICB2IDo9IGJ5dGUoMCwgbWxvYWQoYWRkKHNpZywgOTYpKSkKICAgICAgICB9CgogICAgICAgIHJldHVybiAodiwgciwgcyk7CiAgICB9CgogICAgZnVuY3Rpb24gcmVjb3ZlclNpZ25lcihieXRlczMyIG1lc3NhZ2UsIGJ5dGVzIG1lbW9yeSBzaWcpCiAgICAgICAgaW50ZXJuYWwKICAgICAgICBwdXJlCiAgICAgICAgcmV0dXJucyAoYWRkcmVzcykKICAgIHsKICAgICAgICAodWludDggdiwgYnl0ZXMzMiByLCBieXRlczMyIHMpID0gc3BsaXRTaWduYXR1cmUoc2lnKTsKCiAgICAgICAgcmV0dXJuIGVjcmVjb3ZlcihtZXNzYWdlLCB2LCByLCBzKTsKICAgIH0KCiAgICAvLy8gYnVpbGRzIGEgcHJlZml4ZWQgaGFzaCB0byBtaW1pYyB0aGUgYmVoYXZpb3Igb2YgZXRoX3NpZ24uCiAgICBmdW5jdGlvbiBwcmVmaXhlZChieXRlczMyIGhhc2gpIGludGVybmFsIHB1cmUgcmV0dXJucyAoYnl0ZXMzMikgewogICAgICAgIHJldHVybiBrZWNjYWsyNTYoYWJpLmVuY29kZVBhY2tlZCgiXHgxOUV0aGVyZXVtIFNpZ25lZCBNZXNzYWdlOlxuMzIiLCBoYXNoKSk7CiAgICB9Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.7.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>
<span class="k">contract</span><span class="w"> </span><span class="ni">SimplePaymentChannel</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">payable</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>sender<span class="p">;</span><span class="w">      </span><span class="c1">// The account sending payments.</span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">payable</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>recipient<span class="p">;</span><span class="w">   </span><span class="c1">// The account receiving the payments.</span>
<span class="w">    </span><span class="kt">uint256</span><span class="w"> </span><span class="k">public </span><span class="nv">expiration</span><span class="p">;</span><span class="w">  </span><span class="c1">// Timeout in case the recipient never closes.</span>

<span class="w">    </span><span class="kt">constructor</span><span class="w"> </span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">payable</span><span class="w"> </span>recipientAddress<span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">duration</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="kt">payable</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>sender<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">payable</span><span class="p">(</span><span class="k">msg.sender</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span>recipient<span class="w"> </span><span class="o">=</span><span class="w"> </span>recipientAddress<span class="p">;</span><span class="w"></span>
<span class="w">        </span>expiration<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">block.timestamp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>duration<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// the recipient can close the channel at any time by presenting a</span>
<span class="w">    </span><span class="c1">/// signed amount from the sender. the recipient will be sent that amount,</span>
<span class="w">    </span><span class="c1">/// and the remainder will go back to the sender</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">close</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amount</span><span class="p">,</span><span class="w"> </span><span class="kt">bytes</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>signature<span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span><span class="k">msg.sender</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>recipient<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>isValidSignature<span class="p">(</span>amount<span class="p">,</span><span class="w"> </span>signature<span class="p">));</span><span class="w"></span>

<span class="w">        </span>recipient<span class="p">.</span>transfer<span class="p">(</span>amount<span class="p">);</span><span class="w"></span>
<span class="w">        </span>selfdestruct<span class="p">(</span>sender<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// the sender can extend the expiration at any time</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">extend</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">newExpiration</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span><span class="k">msg.sender</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>sender<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>newExpiration<span class="w"> </span><span class="o">&gt;</span><span class="w"> </span>expiration<span class="p">);</span><span class="w"></span>

<span class="w">        </span>expiration<span class="w"> </span><span class="o">=</span><span class="w"> </span>newExpiration<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// if the timeout is reached without the recipient closing the channel,</span>
<span class="w">    </span><span class="c1">/// then the Ether is released back to the sender.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">claimTimeout</span><span class="p">()</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span><span class="k">block.timestamp</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span>expiration<span class="p">);</span><span class="w"></span>
<span class="w">        </span>selfdestruct<span class="p">(</span>sender<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">isValidSignature</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amount</span><span class="p">,</span><span class="w"> </span><span class="kt">bytes</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>signature<span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="kt">internal</span><span class="w"></span>
<span class="w">        </span>view<span class="w"></span>
<span class="w">        </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>prefixed<span class="p">(</span><span class="nb">keccak256</span><span class="p">(</span>abi<span class="p">.</span>encodePacked<span class="p">(</span><span class="kt">this</span><span class="p">,</span><span class="w"> </span>amount<span class="p">)));</span><span class="w"></span>

<span class="w">        </span><span class="c1">// check that the signature is from the payment sender</span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>recoverSigner<span class="p">(</span>message<span class="p">,</span><span class="w"> </span>signature<span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>sender<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// All functions below this are just taken from the chapter</span>
<span class="w">    </span><span class="c1">/// &#39;creating and verifying signatures&#39; chapter.</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">splitSignature</span><span class="p">(</span><span class="kt">bytes</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>sig<span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="kt">internal</span><span class="w"></span>
<span class="w">        </span>pure<span class="w"></span>
<span class="w">        </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint8</span><span class="w"> </span><span class="nv">v</span><span class="p">,</span><span class="w"> </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">r</span><span class="p">,</span><span class="w"> </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">s</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>sig<span class="p">.</span>length<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m m-Decimal">65</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span>assembly<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="c1">// first 32 bytes, after the length prefix</span>
<span class="w">            </span>r<span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span>mload<span class="p">(</span>add<span class="p">(</span>sig<span class="p">,</span><span class="w"> </span><span class="m m-Decimal">32</span><span class="p">))</span><span class="w"></span>
<span class="w">            </span><span class="c1">// second 32 bytes</span>
<span class="w">            </span>s<span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span>mload<span class="p">(</span>add<span class="p">(</span>sig<span class="p">,</span><span class="w"> </span><span class="m m-Decimal">64</span><span class="p">))</span><span class="w"></span>
<span class="w">            </span><span class="c1">// final byte (first byte of the next 32 bytes)</span>
<span class="w">            </span>v<span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span>byte<span class="p">(</span><span class="m m-Decimal">0</span><span class="p">,</span><span class="w"> </span>mload<span class="p">(</span>add<span class="p">(</span>sig<span class="p">,</span><span class="w"> </span><span class="m m-Decimal">96</span><span class="p">)))</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="kt">return</span><span class="w"> </span><span class="p">(</span>v<span class="p">,</span><span class="w"> </span>r<span class="p">,</span><span class="w"> </span>s<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">recoverSigner</span><span class="p">(</span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">message</span><span class="p">,</span><span class="w"> </span><span class="kt">bytes</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>sig<span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="kt">internal</span><span class="w"></span>
<span class="w">        </span>pure<span class="w"></span>
<span class="w">        </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">address</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="p">(</span><span class="kt">uint8</span><span class="w"> </span><span class="nv">v</span><span class="p">,</span><span class="w"> </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">r</span><span class="p">,</span><span class="w"> </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">s</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>splitSignature<span class="p">(</span>sig<span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="kt">return</span><span class="w"> </span>ecrecover<span class="p">(</span>message<span class="p">,</span><span class="w"> </span>v<span class="p">,</span><span class="w"> </span>r<span class="p">,</span><span class="w"> </span>s<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// builds a prefixed hash to mimic the behavior of eth_sign.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">prefixed</span><span class="p">(</span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">hash</span><span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bytes32</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span><span class="nb">keccak256</span><span class="p">(</span>abi<span class="p">.</span>encodePacked<span class="p">(</span><span class="s2">&quot;\x19Ethereum Signed Message:\n32&quot;</span><span class="p">,</span><span class="w"> </span><span class="kt">hash</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The function <code class="docutils literal notranslate"><span class="pre">splitSignature</span></code> does not use all security
checks. A real implementation should use a more rigorously tested library,
such as openzepplin‚Äôs <a class="reference external" href="https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/utils/cryptography/ECDSA.sol">version</a> of this code.</p>
</div>
</section>
<section id="verifying-payments">
<h5>Verifying Payments<a class="headerlink" href="#verifying-payments" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>Unlike in the previous section, messages in a payment channel aren‚Äôt
redeemed right away. The recipient keeps track of the latest message and
redeems it when it‚Äôs time to close the payment channel. This means it‚Äôs
critical that the recipient perform their own verification of each message.
Otherwise there is no guarantee that the recipient will be able to get paid
in the end.</p>
<p>The recipient should verify each message using the following process:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Verify that the contract address in the message matches the payment channel.</p></li>
<li><p>Verify that the new total is the expected amount.</p></li>
<li><p>Verify that the new total does not exceed the amount of Ether escrowed.</p></li>
<li><p>Verify that the signature is valid and comes from the payment channel sender.</p></li>
</ol>
</div></blockquote>
<p>We‚Äôll use the <a class="reference external" href="https://github.com/ethereumjs/ethereumjs-util">ethereumjs-util</a>
library to write this verification. The final step can be done a number of ways,
and we use JavaScript. The following code borrows the <code class="docutils literal notranslate"><span class="pre">constructPaymentMessage</span></code> function from the signing <strong>JavaScript code</strong> above:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// this mimics the prefixing behavior of the eth_sign JSON-RPC method.</span><span class="w"></span>
<span class="kd">function</span><span class="w"> </span><span class="nx">prefixed</span><span class="p">(</span><span class="nx">hash</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">ethereumjs</span><span class="p">.</span><span class="nx">ABI</span><span class="p">.</span><span class="nx">soliditySHA3</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="p">[</span><span class="s2">&quot;string&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;bytes32&quot;</span><span class="p">],</span><span class="w"></span>
<span class="w">        </span><span class="p">[</span><span class="s2">&quot;\x19Ethereum Signed Message:\n32&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">hash</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kd">function</span><span class="w"> </span><span class="nx">recoverSigner</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span><span class="w"> </span><span class="nx">signature</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">split</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ethereumjs</span><span class="p">.</span><span class="nx">Util</span><span class="p">.</span><span class="nx">fromRpcSig</span><span class="p">(</span><span class="nx">signature</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">publicKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ethereumjs</span><span class="p">.</span><span class="nx">Util</span><span class="p">.</span><span class="nx">ecrecover</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span><span class="w"> </span><span class="nx">split</span><span class="p">.</span><span class="nx">v</span><span class="p">,</span><span class="w"> </span><span class="nx">split</span><span class="p">.</span><span class="nx">r</span><span class="p">,</span><span class="w"> </span><span class="nx">split</span><span class="p">.</span><span class="nx">s</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">signer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ethereumjs</span><span class="p">.</span><span class="nx">Util</span><span class="p">.</span><span class="nx">pubToAddress</span><span class="p">(</span><span class="nx">publicKey</span><span class="p">).</span><span class="nx">toString</span><span class="p">(</span><span class="s2">&quot;hex&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">signer</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kd">function</span><span class="w"> </span><span class="nx">isValidSignature</span><span class="p">(</span><span class="nx">contractAddress</span><span class="p">,</span><span class="w"> </span><span class="nx">amount</span><span class="p">,</span><span class="w"> </span><span class="nx">signature</span><span class="p">,</span><span class="w"> </span><span class="nx">expectedSigner</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">prefixed</span><span class="p">(</span><span class="nx">constructPaymentMessage</span><span class="p">(</span><span class="nx">contractAddress</span><span class="p">,</span><span class="w"> </span><span class="nx">amount</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">signer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">recoverSigner</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span><span class="w"> </span><span class="nx">signature</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">signer</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"></span>
<span class="w">        </span><span class="nx">ethereumjs</span><span class="p">.</span><span class="nx">Util</span><span class="p">.</span><span class="nx">stripHexPrefix</span><span class="p">(</span><span class="nx">expectedSigner</span><span class="p">).</span><span class="nx">toLowerCase</span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="modular-contracts">
<span id="index-3"></span><h3>Modular Contracts<a class="headerlink" href="#modular-contracts" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>A modular approach to building your contracts helps you reduce the complexity
and improve the readability which will help to identify bugs and vulnerabilities
during development and code review.
If you specify and control the behaviour or each module in isolation, the
interactions you have to consider are only those between the module specifications
and not every other moving part of the contract.
In the example below, the contract uses the <code class="docutils literal notranslate"><span class="pre">move</span></code> method
of the <code class="docutils literal notranslate"><span class="pre">Balances</span></code> <a class="reference internal" href="index.html#libraries"><span class="std std-ref">library</span></a> to check that balances sent between
addresses match what you expect. In this way, the <code class="docutils literal notranslate"><span class="pre">Balances</span></code> library
provides an isolated component that properly tracks balances of accounts.
It is easy to verify that the <code class="docutils literal notranslate"><span class="pre">Balances</span></code> library never produces negative balances or overflows
and the sum of all balances is an invariant across the lifetime of the contract.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC41LjAgPDAuOS4wOwoKbGlicmFyeSBCYWxhbmNlcyB7CiAgICBmdW5jdGlvbiBtb3ZlKG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBzdG9yYWdlIGJhbGFuY2VzLCBhZGRyZXNzIGZyb20sIGFkZHJlc3MgdG8sIHVpbnQgYW1vdW50KSBpbnRlcm5hbCB7CiAgICAgICAgcmVxdWlyZShiYWxhbmNlc1tmcm9tXSA+PSBhbW91bnQpOwogICAgICAgIHJlcXVpcmUoYmFsYW5jZXNbdG9dICsgYW1vdW50ID49IGJhbGFuY2VzW3RvXSk7CiAgICAgICAgYmFsYW5jZXNbZnJvbV0gLT0gYW1vdW50OwogICAgICAgIGJhbGFuY2VzW3RvXSArPSBhbW91bnQ7CiAgICB9Cn0KCmNvbnRyYWN0IFRva2VuIHsKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50MjU2KSBiYWxhbmNlczsKICAgIHVzaW5nIEJhbGFuY2VzIGZvciAqOwogICAgbWFwcGluZyhhZGRyZXNzID0+IG1hcHBpbmcgKGFkZHJlc3MgPT4gdWludDI1NikpIGFsbG93ZWQ7CgogICAgZXZlbnQgVHJhbnNmZXIoYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50IGFtb3VudCk7CiAgICBldmVudCBBcHByb3ZhbChhZGRyZXNzIG93bmVyLCBhZGRyZXNzIHNwZW5kZXIsIHVpbnQgYW1vdW50KTsKCiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHRvLCB1aW50IGFtb3VudCkgZXh0ZXJuYWwgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgYmFsYW5jZXMubW92ZShtc2cuc2VuZGVyLCB0bywgYW1vdW50KTsKICAgICAgICBlbWl0IFRyYW5zZmVyKG1zZy5zZW5kZXIsIHRvLCBhbW91bnQpOwogICAgICAgIHJldHVybiB0cnVlOwoKICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2ZlckZyb20oYWRkcmVzcyBmcm9tLCBhZGRyZXNzIHRvLCB1aW50IGFtb3VudCkgZXh0ZXJuYWwgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgcmVxdWlyZShhbGxvd2VkW2Zyb21dW21zZy5zZW5kZXJdID49IGFtb3VudCk7CiAgICAgICAgYWxsb3dlZFtmcm9tXVttc2cuc2VuZGVyXSAtPSBhbW91bnQ7CiAgICAgICAgYmFsYW5jZXMubW92ZShmcm9tLCB0bywgYW1vdW50KTsKICAgICAgICBlbWl0IFRyYW5zZmVyKGZyb20sIHRvLCBhbW91bnQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGFwcHJvdmUoYWRkcmVzcyBzcGVuZGVyLCB1aW50IHRva2VucykgZXh0ZXJuYWwgcmV0dXJucyAoYm9vbCBzdWNjZXNzKSB7CiAgICAgICAgcmVxdWlyZShhbGxvd2VkW21zZy5zZW5kZXJdW3NwZW5kZXJdID09IDAsICIiKTsKICAgICAgICBhbGxvd2VkW21zZy5zZW5kZXJdW3NwZW5kZXJdID0gdG9rZW5zOwogICAgICAgIGVtaXQgQXBwcm92YWwobXNnLnNlbmRlciwgc3BlbmRlciwgdG9rZW5zKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWRkcmVzcyB0b2tlbk93bmVyKSBleHRlcm5hbCB2aWV3IHJldHVybnMgKHVpbnQgYmFsYW5jZSkgewogICAgICAgIHJldHVybiBiYWxhbmNlc1t0b2tlbk93bmVyXTsKICAgIH0KfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.5.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="kt">library</span><span class="w"> </span>Balances<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">move</span><span class="p">(</span><span class="kt">mapping</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">uint256</span><span class="p">)</span><span class="w"> </span>storage<span class="w"> </span>balances<span class="p">,</span><span class="w"> </span><span class="kt">address</span><span class="w"> </span><span class="nv">from</span><span class="p">,</span><span class="w"> </span><span class="kt">address</span><span class="w"> </span><span class="nv">to</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">amount</span><span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>balances<span class="p">[</span>from<span class="p">]</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span>amount<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>balances<span class="p">[</span>to<span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>amount<span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span>balances<span class="p">[</span>to<span class="p">]);</span><span class="w"></span>
<span class="w">        </span>balances<span class="p">[</span>from<span class="p">]</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span>amount<span class="p">;</span><span class="w"></span>
<span class="w">        </span>balances<span class="p">[</span>to<span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span>amount<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Token</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">uint256</span><span class="p">)</span><span class="w"> </span>balances<span class="p">;</span><span class="w"></span>
<span class="w">    </span>using<span class="w"> </span>Balances<span class="w"> </span><span class="kt">for</span><span class="w"> </span><span class="o">*</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">mapping</span><span class="w"> </span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">uint256</span><span class="p">))</span><span class="w"> </span>allowed<span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">Transfer</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">from</span><span class="p">,</span><span class="w"> </span><span class="kt">address</span><span class="w"> </span><span class="nv">to</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">amount</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">Approval</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">owner</span><span class="p">,</span><span class="w"> </span><span class="kt">address</span><span class="w"> </span><span class="nv">spender</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">amount</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">transfer</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">to</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">amount</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="nv">success</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>balances<span class="p">.</span>move<span class="p">(</span><span class="k">msg.sender</span><span class="p">,</span><span class="w"> </span>to<span class="p">,</span><span class="w"> </span>amount<span class="p">);</span><span class="w"></span>
<span class="w">        </span>emit<span class="w"> </span>Transfer<span class="p">(</span><span class="k">msg.sender</span><span class="p">,</span><span class="w"> </span>to<span class="p">,</span><span class="w"> </span>amount<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">transferFrom</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">from</span><span class="p">,</span><span class="w"> </span><span class="kt">address</span><span class="w"> </span><span class="nv">to</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">amount</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="nv">success</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>allowed<span class="p">[</span>from<span class="p">][</span><span class="k">msg.sender</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span>amount<span class="p">);</span><span class="w"></span>
<span class="w">        </span>allowed<span class="p">[</span>from<span class="p">][</span><span class="k">msg.sender</span><span class="p">]</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span>amount<span class="p">;</span><span class="w"></span>
<span class="w">        </span>balances<span class="p">.</span>move<span class="p">(</span>from<span class="p">,</span><span class="w"> </span>to<span class="p">,</span><span class="w"> </span>amount<span class="p">);</span><span class="w"></span>
<span class="w">        </span>emit<span class="w"> </span>Transfer<span class="p">(</span>from<span class="p">,</span><span class="w"> </span>to<span class="p">,</span><span class="w"> </span>amount<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">approve</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">spender</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">tokens</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="nv">success</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>allowed<span class="p">[</span><span class="k">msg.sender</span><span class="p">][</span>spender<span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span>allowed<span class="p">[</span><span class="k">msg.sender</span><span class="p">][</span>spender<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>tokens<span class="p">;</span><span class="w"></span>
<span class="w">        </span>emit<span class="w"> </span>Approval<span class="p">(</span><span class="k">msg.sender</span><span class="p">,</span><span class="w"> </span>spender<span class="p">,</span><span class="w"> </span>tokens<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">balanceOf</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">tokenOwner</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">balance</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>balances<span class="p">[</span>tokenOwner<span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
</div>
<div class="toctree-wrapper compound">
<span id="document-layout-of-source-files"></span><section id="layout-of-a-solidity-source-file">
<h2>Layout of a Solidity Source File<a class="headerlink" href="#layout-of-a-solidity-source-file" title="Permalink to this heading">ÔÉÅ</a></h2>
<p>Source files can contain an arbitrary number of
<a class="reference internal" href="index.html#contract-structure"><span class="std std-ref">contract definitions</span></a>, <a class="reference internal" href="#import">import</a> ,
<a class="reference internal" href="#pragma"><span class="std std-ref">pragma</span></a> and <a class="reference internal" href="index.html#using-for"><span class="std std-ref">using for</span></a> directives and
<a class="reference internal" href="index.html#structs"><span class="std std-ref">struct</span></a>, <a class="reference internal" href="index.html#enums"><span class="std std-ref">enum</span></a>, <a class="reference internal" href="index.html#functions"><span class="std std-ref">function</span></a>, <a class="reference internal" href="index.html#errors"><span class="std std-ref">error</span></a>
and <a class="reference internal" href="index.html#constants"><span class="std std-ref">constant variable</span></a> definitions.</p>
<section id="spdx-license-identifier">
<span id="index-0"></span><h3>SPDX License Identifier<a class="headerlink" href="#spdx-license-identifier" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Trust in smart contracts can be better established if their source code
is available. Since making source code available always touches on legal problems
with regards to copyright, the Solidity compiler encourages the use
of machine-readable <a class="reference external" href="https://spdx.org">SPDX license identifiers</a>.
Every source file should start with a comment indicating its license:</p>
<p><code class="docutils literal notranslate"><span class="pre">//</span> <span class="pre">SPDX-License-Identifier:</span> <span class="pre">MIT</span></code></p>
<p>The compiler does not validate that the license is part of the
<a class="reference external" href="https://spdx.org/licenses/">list allowed by SPDX</a>, but
it does include the supplied string in the <a class="reference internal" href="index.html#metadata"><span class="std std-ref">bytecode metadata</span></a>.</p>
<p>If you do not want to specify a license or if the source code is
not open-source, please use the special value <code class="docutils literal notranslate"><span class="pre">UNLICENSED</span></code>.
Note that <code class="docutils literal notranslate"><span class="pre">UNLICENSED</span></code> (no usage allowed, not present in SPDX license list)
is different from <code class="docutils literal notranslate"><span class="pre">UNLICENSE</span></code> (grants all rights to everyone).
Solidity follows <a class="reference external" href="https://docs.npmjs.com/cli/v7/configuring-npm/package-json#license">the npm recommendation</a>.</p>
<p>Supplying this comment of course does not free you from other
obligations related to licensing like having to mention
a specific license header in each source file or the
original copyright holder.</p>
<p>The comment is recognized by the compiler anywhere in the file at the
file level, but it is recommended to put it at the top of the file.</p>
<p>More information about how to use SPDX license identifiers
can be found at the <a class="reference external" href="https://spdx.org/ids-how">SPDX website</a>.</p>
</section>
<section id="pragmas">
<span id="pragma"></span><span id="index-1"></span><h3>Pragmas<a class="headerlink" href="#pragmas" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">pragma</span></code> keyword is used to enable certain compiler features
or checks. A pragma directive is always local to a source file, so
you have to add the pragma to all your files if you want to enable it
in your whole project. If you <a class="reference internal" href="#import"><span class="std std-ref">import</span></a> another file, the pragma
from that file does <em>not</em> automatically apply to the importing file.</p>
<section id="version-pragma">
<span id="index-2"></span><span id="id1"></span><h4>Version Pragma<a class="headerlink" href="#version-pragma" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Source files can (and should) be annotated with a version pragma to reject
compilation with future compiler versions that might introduce incompatible
changes. We try to keep these to an absolute minimum and
introduce them in a way that changes in semantics also require changes
in the syntax, but this is not always possible. Because of this, it is always
a good idea to read through the changelog at least for releases that contain
breaking changes. These releases always have versions of the form
<code class="docutils literal notranslate"><span class="pre">0.x.0</span></code> or <code class="docutils literal notranslate"><span class="pre">x.0.0</span></code>.</p>
<p>The version pragma is used as follows: <code class="docutils literal notranslate"><span class="pre">pragma</span> <span class="pre">solidity</span> <span class="pre">^0.5.2;</span></code></p>
<p>A source file with the line above does not compile with a compiler earlier than version 0.5.2,
and it also does not work on a compiler starting from version 0.6.0 (this
second condition is added by using <code class="docutils literal notranslate"><span class="pre">^</span></code>). Because
there will be no breaking changes until version <code class="docutils literal notranslate"><span class="pre">0.6.0</span></code>, you can
be sure that your code compiles the way you intended. The exact version of the
compiler is not fixed, so that bugfix releases are still possible.</p>
<p>It is possible to specify more complex rules for the compiler version,
these follow the same syntax used by <a class="reference external" href="https://docs.npmjs.com/cli/v6/using-npm/semver">npm</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Using the version pragma <em>does not</em> change the version of the compiler.
It also <em>does not</em> enable or disable features of the compiler. It just
instructs the compiler to check whether its version matches the one
required by the pragma. If it does not match, the compiler issues
an error.</p>
</div>
</section>
<section id="abi-coder-pragma">
<h4>ABI Coder Pragma<a class="headerlink" href="#abi-coder-pragma" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>By using <code class="docutils literal notranslate"><span class="pre">pragma</span> <span class="pre">abicoder</span> <span class="pre">v1</span></code> or <code class="docutils literal notranslate"><span class="pre">pragma</span> <span class="pre">abicoder</span> <span class="pre">v2</span></code> you can
select between the two implementations of the ABI encoder and decoder.</p>
<p>The new ABI coder (v2) is able to encode and decode arbitrarily nested
arrays and structs. It might produce less optimal code and has not
received as much testing as the old encoder, but is considered
non-experimental as of Solidity 0.6.0. You still have to explicitly
activate it using <code class="docutils literal notranslate"><span class="pre">pragma</span> <span class="pre">abicoder</span> <span class="pre">v2;</span></code>. Since it will be
activated by default starting from Solidity 0.8.0, there is the option to select
the old coder using <code class="docutils literal notranslate"><span class="pre">pragma</span> <span class="pre">abicoder</span> <span class="pre">v1;</span></code>.</p>
<p>The set of types supported by the new encoder is a strict superset of
the ones supported by the old one. Contracts that use it can interact with ones
that do not without limitations. The reverse is possible only as long as the
non-<code class="docutils literal notranslate"><span class="pre">abicoder</span> <span class="pre">v2</span></code> contract does not try to make calls that would require
decoding types only supported by the new encoder. The compiler can detect this
and will issue an error. Simply enabling <code class="docutils literal notranslate"><span class="pre">abicoder</span> <span class="pre">v2</span></code> for your contract is
enough to make the error go away.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This pragma applies to all the code defined in the file where it is activated,
regardless of where that code ends up eventually. This means that a contract
whose source file is selected to compile with ABI coder v1
can still contain code that uses the new encoder
by inheriting it from another contract. This is allowed if the new types are only
used internally and not in external function signatures.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Up to Solidity 0.7.4, it was possible to select the ABI coder v2
by using <code class="docutils literal notranslate"><span class="pre">pragma</span> <span class="pre">experimental</span> <span class="pre">ABIEncoderV2</span></code>, but it was not possible
to explicitly select coder v1 because it was the default.</p>
</div>
</section>
<section id="experimental-pragma">
<span id="index-3"></span><span id="id2"></span><h4>Experimental Pragma<a class="headerlink" href="#experimental-pragma" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>The second pragma is the experimental pragma. It can be used to enable
features of the compiler or language that are not yet enabled by default.
The following experimental pragmas are currently supported:</p>
<section id="abiencoderv2">
<h5>ABIEncoderV2<a class="headerlink" href="#abiencoderv2" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>Because the ABI coder v2 is not considered experimental anymore,
it can be selected via <code class="docutils literal notranslate"><span class="pre">pragma</span> <span class="pre">abicoder</span> <span class="pre">v2</span></code> (please see above)
since Solidity 0.7.4.</p>
</section>
<section id="smtchecker">
<span id="smt-checker"></span><h5>SMTChecker<a class="headerlink" href="#smtchecker" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>This component has to be enabled when the Solidity compiler is built
and therefore it is not available in all Solidity binaries.
The <a class="reference internal" href="index.html#smt-solvers-build"><span class="std std-ref">build instructions</span></a> explain how to activate this option.
It is activated for the Ubuntu PPA releases in most versions,
but not for the Docker images, Windows binaries or the
statically-built Linux binaries. It can be activated for solc-js via the
<a class="reference external" href="https://github.com/ethereum/solc-js#example-usage-with-smtsolver-callback">smtCallback</a> if you have an SMT solver
installed locally and run solc-js via node (not via the browser).</p>
<p>If you use <code class="docutils literal notranslate"><span class="pre">pragma</span> <span class="pre">experimental</span> <span class="pre">SMTChecker;</span></code>, then you get additional
<a class="reference internal" href="index.html#formal-verification"><span class="std std-ref">safety warnings</span></a> which are obtained by querying an
SMT solver.
The component does not yet support all features of the Solidity language and
likely outputs many warnings. In case it reports unsupported features, the
analysis may not be fully sound.</p>
</section>
</section>
</section>
<section id="importing-other-source-files">
<span id="import"></span><span id="index-4"></span><h3>Importing other Source Files<a class="headerlink" href="#importing-other-source-files" title="Permalink to this heading">ÔÉÅ</a></h3>
<section id="syntax-and-semantics">
<h4>Syntax and Semantics<a class="headerlink" href="#syntax-and-semantics" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Solidity supports import statements to help modularise your code that
are similar to those available in JavaScript
(from ES6 on). However, Solidity does not support the concept of
a <a class="reference external" href="https://developer.mozilla.org/en-US/docs/web/javascript/reference/statements/export#Description">default export</a>.</p>
<p>At a global level, you can use import statements of the following form:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=aW1wb3J0ICJmaWxlbmFtZSI7"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">import</span><span class="w"> </span><span class="s2">&quot;filename&quot;</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">filename</span></code> part is called an <em>import path</em>.
This statement imports all global symbols from ‚Äúfilename‚Äù (and symbols imported there) into the
current global scope (different than in ES6 but backwards-compatible for Solidity).
This form is not recommended for use, because it unpredictably pollutes the namespace.
If you add new top-level items inside ‚Äúfilename‚Äù, they automatically
appear in all files that import like this from ‚Äúfilename‚Äù. It is better to import specific
symbols explicitly.</p>
<p>The following example creates a new global symbol <code class="docutils literal notranslate"><span class="pre">symbolName</span></code> whose members are all
the global symbols from <code class="docutils literal notranslate"><span class="pre">&quot;filename&quot;</span></code>:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=aW1wb3J0ICogYXMgc3ltYm9sTmFtZSBmcm9tICJmaWxlbmFtZSI7"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span>as<span class="w"> </span>symbolName<span class="w"> </span>from<span class="w"> </span><span class="s2">&quot;filename&quot;</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>which results in all global symbols being available in the format <code class="docutils literal notranslate"><span class="pre">symbolName.symbol</span></code>.</p>
<p>A variant of this syntax that is not part of ES6, but possibly useful is:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=aW1wb3J0ICJmaWxlbmFtZSIgYXMgc3ltYm9sTmFtZTs="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">import</span><span class="w"> </span><span class="s2">&quot;filename&quot;</span><span class="w"> </span>as<span class="w"> </span>symbolName<span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>which is equivalent to <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">*</span> <span class="pre">as</span> <span class="pre">symbolName</span> <span class="pre">from</span> <span class="pre">&quot;filename&quot;;</span></code>.</p>
<p>If there is a naming collision, you can rename symbols while importing. For example,
the code below creates new global symbols <code class="docutils literal notranslate"><span class="pre">alias</span></code> and <code class="docutils literal notranslate"><span class="pre">symbol2</span></code> which reference
<code class="docutils literal notranslate"><span class="pre">symbol1</span></code> and <code class="docutils literal notranslate"><span class="pre">symbol2</span></code> from inside <code class="docutils literal notranslate"><span class="pre">&quot;filename&quot;</span></code>, respectively.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=aW1wb3J0IHtzeW1ib2wxIGFzIGFsaWFzLCBzeW1ib2wyfSBmcm9tICJmaWxlbmFtZSI7"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">import</span><span class="w"> </span><span class="p">{</span>symbol1<span class="w"> </span>as<span class="w"> </span>alias<span class="p">,</span><span class="w"> </span>symbol2<span class="p">}</span><span class="w"> </span>from<span class="w"> </span><span class="s2">&quot;filename&quot;</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="import-paths">
<span id="index-5"></span><h4>Import Paths<a class="headerlink" href="#import-paths" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>In order to be able to support reproducible builds on all platforms, the Solidity compiler has to
abstract away the details of the filesystem where source files are stored.
For this reason import paths do not refer directly to files in the host filesystem.
Instead the compiler maintains an internal database (<em>virtual filesystem</em> or <em>VFS</em> for short) where
each source unit is assigned a unique <em>source unit name</em> which is an opaque and unstructured identifier.
The import path specified in an import statement is translated into a source unit name and used to
find the corresponding source unit in this database.</p>
<p>Using the <a class="reference internal" href="index.html#compiler-api"><span class="std std-ref">Standard JSON</span></a> API it is possible to directly provide the names and
content of all the source files as a part of the compiler input.
In this case source unit names are truly arbitrary.
If, however, you want the compiler to automatically find and load source code into the VFS, your
source unit names need to be structured in a way that makes it possible for an <a class="reference internal" href="index.html#import-callback"><span class="std std-ref">import callback</span></a> to locate them.
When using the command-line compiler the default import callback supports only loading source code
from the host filesystem, which means that your source unit names must be paths.
Some environments provide custom callbacks that are more versatile.
For example the <a class="reference external" href="https://remix.ethereum.org/">Remix IDE</a> provides one that
lets you <a class="reference external" href="https://remix-ide.readthedocs.io/en/latest/import.html">import files from HTTP, IPFS and Swarm URLs or refer directly to packages in NPM registry</a>.</p>
<p>For a complete description of the virtual filesystem and the path resolution logic used by the
compiler see <a class="reference internal" href="index.html#path-resolution"><span class="std std-ref">Path Resolution</span></a>.</p>
</section>
</section>
<section id="comments">
<span id="index-6"></span><h3>Comments<a class="headerlink" href="#comments" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Single-line comments (<code class="docutils literal notranslate"><span class="pre">//</span></code>) and multi-line comments (<code class="docutils literal notranslate"><span class="pre">/*...*/</span></code>) are possible.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gVGhpcyBpcyBhIHNpbmdsZS1saW5lIGNvbW1lbnQuCgovKgpUaGlzIGlzIGEKbXVsdGktbGluZSBjb21tZW50LgoqLw=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// This is a single-line comment.</span>

<span class="cm">/*</span>
<span class="cm">This is a</span>
<span class="cm">multi-line comment.</span>
<span class="cm">*/</span><span class="w"></span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A single-line comment is terminated by any unicode line terminator
(LF, VF, FF, CR, NEL, LS or PS) in UTF-8 encoding. The terminator is still part of
the source code after the comment, so if it is not an ASCII symbol
(these are NEL, LS and PS), it will lead to a parser error.</p>
</div>
<p>Additionally, there is another type of comment called a NatSpec comment,
which is detailed in the <a class="reference internal" href="index.html#style-guide-natspec"><span class="std std-ref">style guide</span></a>. They are written with a
triple slash (<code class="docutils literal notranslate"><span class="pre">///</span></code>) or a double asterisk block (<code class="docutils literal notranslate"><span class="pre">/**</span> <span class="pre">...</span> <span class="pre">*/</span></code>) and
they should be used directly above function declarations or statements.</p>
</section>
</section>
<span id="document-structure-of-a-contract"></span><section id="structure-of-a-contract">
<span id="contract-structure"></span><span id="index-0"></span><h2>Structure of a Contract<a class="headerlink" href="#structure-of-a-contract" title="Permalink to this heading">ÔÉÅ</a></h2>
<p>Contracts in Solidity are similar to classes in object-oriented languages.
Each contract can contain declarations of <a class="reference internal" href="#structure-state-variables"><span class="std std-ref">State Variables</span></a>, <a class="reference internal" href="#structure-functions"><span class="std std-ref">Functions</span></a>,
<a class="reference internal" href="#structure-function-modifiers"><span class="std std-ref">Function Modifiers</span></a>, <a class="reference internal" href="#structure-events"><span class="std std-ref">Events</span></a>, <a class="reference internal" href="#structure-errors"><span class="std std-ref">Errors</span></a>, <a class="reference internal" href="#structure-struct-types"><span class="std std-ref">Struct Types</span></a> and <a class="reference internal" href="#structure-enum-types"><span class="std std-ref">Enum Types</span></a>.
Furthermore, contracts can inherit from other contracts.</p>
<p>There are also special kinds of contracts called <a class="reference internal" href="index.html#libraries"><span class="std std-ref">libraries</span></a> and <a class="reference internal" href="index.html#interfaces"><span class="std std-ref">interfaces</span></a>.</p>
<p>The section about <a class="reference internal" href="index.html#contracts"><span class="std std-ref">contracts</span></a> contains more details than this section,
which serves to provide a quick overview.</p>
<section id="state-variables">
<span id="structure-state-variables"></span><h3>State Variables<a class="headerlink" href="#state-variables" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>State variables are variables whose values are permanently stored in contract
storage.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC40LjAgPDAuOS4wOwoKY29udHJhY3QgU2ltcGxlU3RvcmFnZSB7CiAgICB1aW50IHN0b3JlZERhdGE7IC8vIFN0YXRlIHZhcmlhYmxlCiAgICAvLyAuLi4KfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.4.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">SimpleStorage</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="nv">storedData</span><span class="p">;</span><span class="w"> </span><span class="c1">// State variable</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>See the <a class="reference internal" href="index.html#types"><span class="std std-ref">Types</span></a> section for valid state variable types and
<a class="reference internal" href="index.html#visibility-and-getters"><span class="std std-ref">Visibility and Getters</span></a> for possible choices for
visibility.</p>
</section>
<section id="functions">
<span id="structure-functions"></span><h3>Functions<a class="headerlink" href="#functions" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Functions are the executable units of code. Functions are usually
defined inside a contract, but they can also be defined outside of
contracts.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC43LjEgPDAuOS4wOwoKY29udHJhY3QgU2ltcGxlQXVjdGlvbiB7CiAgICBmdW5jdGlvbiBiaWQoKSBwdWJsaWMgcGF5YWJsZSB7IC8vIEZ1bmN0aW9uCiAgICAgICAgLy8gLi4uCiAgICB9Cn0KCi8vIEhlbHBlciBmdW5jdGlvbiBkZWZpbmVkIG91dHNpZGUgb2YgYSBjb250cmFjdApmdW5jdGlvbiBoZWxwZXIodWludCB4KSBwdXJlIHJldHVybnMgKHVpbnQpIHsKICAgIHJldHVybiB4ICogMjsKfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.7.1</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">SimpleAuction</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">bid</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// Function</span>
<span class="w">        </span><span class="c1">// ...</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// Helper function defined outside of a contract</span>
<span class="kt">function</span><span class="w"> </span><span class="nv">helper</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">x</span><span class="p">)</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">return</span><span class="w"> </span>x<span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m m-Decimal">2</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p><a class="reference internal" href="index.html#function-calls"><span class="std std-ref">Function Calls</span></a> can happen internally or externally
and have different levels of <a class="reference internal" href="index.html#visibility-and-getters"><span class="std std-ref">visibility</span></a>
towards other contracts. <a class="reference internal" href="index.html#functions"><span class="std std-ref">Functions</span></a> accept <a class="reference internal" href="index.html#function-parameters-return-variables"><span class="std std-ref">parameters and return variables</span></a> to pass parameters
and values between them.</p>
</section>
<section id="function-modifiers">
<span id="structure-function-modifiers"></span><h3>Function Modifiers<a class="headerlink" href="#function-modifiers" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Function modifiers can be used to amend the semantics of functions in a declarative way
(see <a class="reference internal" href="index.html#modifiers"><span class="std std-ref">Function Modifiers</span></a> in the contracts section).</p>
<p>Overloading, that is, having the same modifier name with different parameters,
is not possible.</p>
<p>Like functions, modifiers can be <a class="reference internal" href="index.html#modifier-overriding"><span class="std std-ref">overridden</span></a>.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC40LjIyIDwwLjkuMDsKCmNvbnRyYWN0IFB1cmNoYXNlIHsKICAgIGFkZHJlc3MgcHVibGljIHNlbGxlcjsKCiAgICBtb2RpZmllciBvbmx5U2VsbGVyKCkgeyAvLyBNb2RpZmllcgogICAgICAgIHJlcXVpcmUoCiAgICAgICAgICAgIG1zZy5zZW5kZXIgPT0gc2VsbGVyLAogICAgICAgICAgICAiT25seSBzZWxsZXIgY2FuIGNhbGwgdGhpcy4iCiAgICAgICAgKTsKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIGFib3J0KCkgcHVibGljIHZpZXcgb25seVNlbGxlciB7IC8vIE1vZGlmaWVyIHVzYWdlCiAgICAgICAgLy8gLi4uCiAgICB9Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.4.22</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Purchase</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="k">public </span><span class="nv">seller</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kt">modifier</span><span class="w"> </span>onlySeller<span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// Modifier</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span><span class="w"></span>
<span class="w">            </span><span class="k">msg.sender</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>seller<span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="s2">&quot;Only seller can call this.&quot;</span><span class="w"></span>
<span class="w">        </span><span class="p">);</span><span class="w"></span>
<span class="w">        </span>_<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">abort</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>view<span class="w"> </span>onlySeller<span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// Modifier usage</span>
<span class="w">        </span><span class="c1">// ...</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="events">
<span id="structure-events"></span><h3>Events<a class="headerlink" href="#events" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Events are convenience interfaces with the EVM logging facilities.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC40LjIxIDwwLjkuMDsKCmNvbnRyYWN0IFNpbXBsZUF1Y3Rpb24gewogICAgZXZlbnQgSGlnaGVzdEJpZEluY3JlYXNlZChhZGRyZXNzIGJpZGRlciwgdWludCBhbW91bnQpOyAvLyBFdmVudAoKICAgIGZ1bmN0aW9uIGJpZCgpIHB1YmxpYyBwYXlhYmxlIHsKICAgICAgICAvLyAuLi4KICAgICAgICBlbWl0IEhpZ2hlc3RCaWRJbmNyZWFzZWQobXNnLnNlbmRlciwgbXNnLnZhbHVlKTsgLy8gVHJpZ2dlcmluZyBldmVudAogICAgfQp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.4.21</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">SimpleAuction</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">HighestBidIncreased</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">bidder</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">amount</span><span class="p">);</span><span class="w"> </span><span class="c1">// Event</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">bid</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// ...</span>
<span class="w">        </span>emit<span class="w"> </span>HighestBidIncreased<span class="p">(</span><span class="k">msg.sender</span><span class="p">,</span><span class="w"> </span><span class="k">msg.value</span><span class="p">);</span><span class="w"> </span><span class="c1">// Triggering event</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>See <a class="reference internal" href="index.html#events"><span class="std std-ref">Events</span></a> in contracts section for information on how events are declared
and can be used from within a dapp.</p>
</section>
<section id="errors">
<span id="structure-errors"></span><h3>Errors<a class="headerlink" href="#errors" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Errors allow you to define descriptive names and data for failure situations.
Errors can be used in <a class="reference internal" href="index.html#revert-statement"><span class="std std-ref">revert statements</span></a>.
In comparison to string descriptions, errors are much cheaper and allow you
to encode additional data. You can use NatSpec to describe the error to
the user.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5IF4wLjguNDsKCi8vLyBOb3QgZW5vdWdoIGZ1bmRzIGZvciB0cmFuc2Zlci4gUmVxdWVzdGVkIGByZXF1ZXN0ZWRgLAovLy8gYnV0IG9ubHkgYGF2YWlsYWJsZWAgYXZhaWxhYmxlLgplcnJvciBOb3RFbm91Z2hGdW5kcyh1aW50IHJlcXVlc3RlZCwgdWludCBhdmFpbGFibGUpOwoKY29udHJhY3QgVG9rZW4gewogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQpIGJhbGFuY2VzOwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludCBhbW91bnQpIHB1YmxpYyB7CiAgICAgICAgdWludCBiYWxhbmNlID0gYmFsYW5jZXNbbXNnLnNlbmRlcl07CiAgICAgICAgaWYgKGJhbGFuY2UgPCBhbW91bnQpCiAgICAgICAgICAgIHJldmVydCBOb3RFbm91Z2hGdW5kcyhhbW91bnQsIGJhbGFuY2UpOwogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdIC09IGFtb3VudDsKICAgICAgICBiYWxhbmNlc1t0b10gKz0gYW1vdW50OwogICAgICAgIC8vIC4uLgogICAgfQp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.8.4</span><span class="p">;</span><span class="w"></span>

<span class="c1">/// Not enough funds for transfer. Requested `requested`,</span>
<span class="c1">/// but only `available` available.</span>
error<span class="w"> </span>NotEnoughFunds<span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">requested</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">available</span><span class="p">);</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Token</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span>balances<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">transfer</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">to</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">amount</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="w"> </span><span class="nv">balance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>balances<span class="p">[</span><span class="k">msg.sender</span><span class="p">];</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>balance<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>amount<span class="p">)</span><span class="w"></span>
<span class="w">            </span>revert<span class="w"> </span>NotEnoughFunds<span class="p">(</span>amount<span class="p">,</span><span class="w"> </span>balance<span class="p">);</span><span class="w"></span>
<span class="w">        </span>balances<span class="p">[</span><span class="k">msg.sender</span><span class="p">]</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span>amount<span class="p">;</span><span class="w"></span>
<span class="w">        </span>balances<span class="p">[</span>to<span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span>amount<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="c1">// ...</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>See <a class="reference internal" href="index.html#errors"><span class="std std-ref">Errors and the Revert Statement</span></a> in the contracts section for more information.</p>
</section>
<section id="struct-types">
<span id="structure-struct-types"></span><h3>Struct Types<a class="headerlink" href="#struct-types" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Structs are custom defined types that can group several variables (see
<a class="reference internal" href="index.html#structs"><span class="std std-ref">Structs</span></a> in types section).</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC40LjAgPDAuOS4wOwoKY29udHJhY3QgQmFsbG90IHsKICAgIHN0cnVjdCBWb3RlciB7IC8vIFN0cnVjdAogICAgICAgIHVpbnQgd2VpZ2h0OwogICAgICAgIGJvb2wgdm90ZWQ7CiAgICAgICAgYWRkcmVzcyBkZWxlZ2F0ZTsKICAgICAgICB1aW50IHZvdGU7CiAgICB9Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.4.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Ballot</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">struct</span><span class="w"> </span><span class="nv">Voter</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// Struct</span>
<span class="w">        </span><span class="kt">uint</span><span class="w"> </span><span class="nv">weight</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="nv">voted</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">delegate</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="w"> </span><span class="nv">vote</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="enum-types">
<span id="structure-enum-types"></span><h3>Enum Types<a class="headerlink" href="#enum-types" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Enums can be used to create custom types with a finite set of ‚Äòconstant values‚Äô (see
<a class="reference internal" href="index.html#enums"><span class="std std-ref">Enums</span></a> in types section).</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC40LjAgPDAuOS4wOwoKY29udHJhY3QgUHVyY2hhc2UgewogICAgZW51bSBTdGF0ZSB7IENyZWF0ZWQsIExvY2tlZCwgSW5hY3RpdmUgfSAvLyBFbnVtCn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.4.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Purchase</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">enum</span><span class="w"> </span><span class="nv">State</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>Created<span class="p">,</span><span class="w"> </span>Locked<span class="p">,</span><span class="w"> </span>Inactive<span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="c1">// Enum</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
<span id="document-types"></span><section id="types">
<span id="index-0"></span><span id="id1"></span><h2>Types<a class="headerlink" href="#types" title="Permalink to this heading">ÔÉÅ</a></h2>
<p>Solidity is a statically typed language, which means that the type of each
variable (state and local) needs to be specified.
Solidity provides several elementary types which can be combined to form complex types.</p>
<p>In addition, types can interact with each other in expressions containing
operators. For a quick reference of the various operators, see <a class="reference internal" href="#order"><span class="std std-ref">Order of Precedence of Operators</span></a>.</p>
<p>The concept of ‚Äúundefined‚Äù or ‚Äúnull‚Äù values does not exist in Solidity, but newly
declared variables always have a <a class="reference internal" href="index.html#default-value"><span class="std std-ref">default value</span></a> dependent
on its type. To handle any unexpected values, you should use the <a class="reference internal" href="index.html#assert-and-require"><span class="std std-ref">revert function</span></a> to revert the whole transaction, or return a
tuple with a second <code class="docutils literal notranslate"><span class="pre">bool</span></code> value denoting success.</p>
<section id="value-types">
<span id="index-1"></span><span id="id2"></span><h3>Value Types<a class="headerlink" href="#value-types" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>The following types are also called value types because variables of these
types will always be passed by value, i.e. they are always copied when they
are used as function arguments or in assignments.</p>
<section id="booleans">
<span id="index-2"></span><h4>Booleans<a class="headerlink" href="#booleans" title="Permalink to this heading">ÔÉÅ</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">bool</span></code>: The possible values are constants <code class="docutils literal notranslate"><span class="pre">true</span></code> and <code class="docutils literal notranslate"><span class="pre">false</span></code>.</p>
<p>Operators:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">!</span></code> (logical negation)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code> (logical conjunction, ‚Äúand‚Äù)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">||</span></code> (logical disjunction, ‚Äúor‚Äù)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">==</span></code> (equality)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">!=</span></code> (inequality)</p></li>
</ul>
<p>The operators <code class="docutils literal notranslate"><span class="pre">||</span></code> and <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code> apply the common short-circuiting rules. This means that in the expression <code class="docutils literal notranslate"><span class="pre">f(x)</span> <span class="pre">||</span> <span class="pre">g(y)</span></code>, if <code class="docutils literal notranslate"><span class="pre">f(x)</span></code> evaluates to <code class="docutils literal notranslate"><span class="pre">true</span></code>, <code class="docutils literal notranslate"><span class="pre">g(y)</span></code> will not be evaluated even if it may have side-effects.</p>
</section>
<section id="integers">
<span id="index-3"></span><span id="id3"></span><h4>Integers<a class="headerlink" href="#integers" title="Permalink to this heading">ÔÉÅ</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">int</span></code> / <code class="docutils literal notranslate"><span class="pre">uint</span></code>: Signed and unsigned integers of various sizes. Keywords <code class="docutils literal notranslate"><span class="pre">uint8</span></code> to <code class="docutils literal notranslate"><span class="pre">uint256</span></code> in steps of <code class="docutils literal notranslate"><span class="pre">8</span></code> (unsigned of 8 up to 256 bits) and <code class="docutils literal notranslate"><span class="pre">int8</span></code> to <code class="docutils literal notranslate"><span class="pre">int256</span></code>. <code class="docutils literal notranslate"><span class="pre">uint</span></code> and <code class="docutils literal notranslate"><span class="pre">int</span></code> are aliases for <code class="docutils literal notranslate"><span class="pre">uint256</span></code> and <code class="docutils literal notranslate"><span class="pre">int256</span></code>, respectively.</p>
<p>Operators:</p>
<ul class="simple">
<li><p>Comparisons: <code class="docutils literal notranslate"><span class="pre">&lt;=</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;</span></code>, <code class="docutils literal notranslate"><span class="pre">==</span></code>, <code class="docutils literal notranslate"><span class="pre">!=</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;=</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> (evaluate to <code class="docutils literal notranslate"><span class="pre">bool</span></code>)</p></li>
<li><p>Bit operators: <code class="docutils literal notranslate"><span class="pre">&amp;</span></code>, <code class="docutils literal notranslate"><span class="pre">|</span></code>, <code class="docutils literal notranslate"><span class="pre">^</span></code> (bitwise exclusive or), <code class="docutils literal notranslate"><span class="pre">~</span></code> (bitwise negation)</p></li>
<li><p>Shift operators: <code class="docutils literal notranslate"><span class="pre">&lt;&lt;</span></code> (left shift), <code class="docutils literal notranslate"><span class="pre">&gt;&gt;</span></code> (right shift)</p></li>
<li><p>Arithmetic operators: <code class="docutils literal notranslate"><span class="pre">+</span></code>, <code class="docutils literal notranslate"><span class="pre">-</span></code>, unary <code class="docutils literal notranslate"><span class="pre">-</span></code> (only for signed integers), <code class="docutils literal notranslate"><span class="pre">*</span></code>, <code class="docutils literal notranslate"><span class="pre">/</span></code>, <code class="docutils literal notranslate"><span class="pre">%</span></code> (modulo), <code class="docutils literal notranslate"><span class="pre">**</span></code> (exponentiation)</p></li>
</ul>
<p>For an integer type <code class="docutils literal notranslate"><span class="pre">X</span></code>, you can use <code class="docutils literal notranslate"><span class="pre">type(X).min</span></code> and <code class="docutils literal notranslate"><span class="pre">type(X).max</span></code> to
access the minimum and maximum value representable by the type.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Integers in Solidity are restricted to a certain range. For example, with <code class="docutils literal notranslate"><span class="pre">uint32</span></code>, this is <code class="docutils literal notranslate"><span class="pre">0</span></code> up to <code class="docutils literal notranslate"><span class="pre">2**32</span> <span class="pre">-</span> <span class="pre">1</span></code>.
There are two modes in which arithmetic is performed on these types: The ‚Äúwrapping‚Äù or ‚Äúunchecked‚Äù mode and the ‚Äúchecked‚Äù mode.
By default, arithmetic is always ‚Äúchecked‚Äù, which mean that if the result of an operation falls outside the value range
of the type, the call is reverted through a <a class="reference internal" href="index.html#assert-and-require"><span class="std std-ref">failing assertion</span></a>. You can switch to ‚Äúunchecked‚Äù mode
using <code class="docutils literal notranslate"><span class="pre">unchecked</span> <span class="pre">{</span> <span class="pre">...</span> <span class="pre">}</span></code>. More details can be found in the section about <a class="reference internal" href="index.html#unchecked"><span class="std std-ref">unchecked</span></a>.</p>
</div>
<section id="comparisons">
<h5>Comparisons<a class="headerlink" href="#comparisons" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>The value of a comparison is the one obtained by comparing the integer value.</p>
</section>
<section id="bit-operations">
<h5>Bit operations<a class="headerlink" href="#bit-operations" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>Bit operations are performed on the two‚Äôs complement representation of the number.
This means that, for example <code class="docutils literal notranslate"><span class="pre">~int256(0)</span> <span class="pre">==</span> <span class="pre">int256(-1)</span></code>.</p>
</section>
<section id="shifts">
<h5>Shifts<a class="headerlink" href="#shifts" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>The result of a shift operation has the type of the left operand, truncating the result to match the type.
The right operand must be of unsigned type, trying to shift by a signed type will produce a compilation error.</p>
<p>Shifts can be ‚Äúsimulated‚Äù using multiplication by powers of two in the following way. Note that the truncation
to the type of the left operand is always performed at the end, but not mentioned explicitly.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">&lt;&lt;</span> <span class="pre">y</span></code> is equivalent to the mathematical expression <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">*</span> <span class="pre">2**y</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">&gt;&gt;</span> <span class="pre">y</span></code> is equivalent to the mathematical expression <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">/</span> <span class="pre">2**y</span></code>, rounded towards negative infinity.</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Before version <code class="docutils literal notranslate"><span class="pre">0.5.0</span></code> a right shift <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">&gt;&gt;</span> <span class="pre">y</span></code> for negative <code class="docutils literal notranslate"><span class="pre">x</span></code> was equivalent to
the mathematical expression <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">/</span> <span class="pre">2**y</span></code> rounded towards zero,
i.e., right shifts used rounding up (towards zero) instead of rounding down (towards negative infinity).</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Overflow checks are never performed for shift operations as they are done for arithmetic operations.
Instead, the result is always truncated.</p>
</div>
</section>
<section id="addition-subtraction-and-multiplication">
<h5>Addition, Subtraction and Multiplication<a class="headerlink" href="#addition-subtraction-and-multiplication" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>Addition, subtraction and multiplication have the usual semantics, with two different
modes in regard to over- and underflow:</p>
<p>By default, all arithmetic is checked for under- or overflow, but this can be disabled
using the <a class="reference internal" href="index.html#unchecked"><span class="std std-ref">unchecked block</span></a>, resulting in wrapping arithmetic. More details
can be found in that section.</p>
<p>The expression <code class="docutils literal notranslate"><span class="pre">-x</span></code> is equivalent to <code class="docutils literal notranslate"><span class="pre">(T(0)</span> <span class="pre">-</span> <span class="pre">x)</span></code> where
<code class="docutils literal notranslate"><span class="pre">T</span></code> is the type of <code class="docutils literal notranslate"><span class="pre">x</span></code>. It can only be applied to signed types.
The value of <code class="docutils literal notranslate"><span class="pre">-x</span></code> can be
positive if <code class="docutils literal notranslate"><span class="pre">x</span></code> is negative. There is another caveat also resulting
from two‚Äôs complement representation:</p>
<p>If you have <code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">x</span> <span class="pre">=</span> <span class="pre">type(int).min;</span></code>, then <code class="docutils literal notranslate"><span class="pre">-x</span></code> does not fit the positive range.
This means that <code class="docutils literal notranslate"><span class="pre">unchecked</span> <span class="pre">{</span> <span class="pre">assert(-x</span> <span class="pre">==</span> <span class="pre">x);</span> <span class="pre">}</span></code> works, and the expression <code class="docutils literal notranslate"><span class="pre">-x</span></code>
when used in checked mode will result in a failing assertion.</p>
</section>
<section id="division">
<h5>Division<a class="headerlink" href="#division" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>Since the type of the result of an operation is always the type of one of
the operands, division on integers always results in an integer.
In Solidity, division rounds towards zero. This means that <code class="docutils literal notranslate"><span class="pre">int256(-5)</span> <span class="pre">/</span> <span class="pre">int256(2)</span> <span class="pre">==</span> <span class="pre">int256(-2)</span></code>.</p>
<p>Note that in contrast, division on <a class="reference internal" href="#rational-literals"><span class="std std-ref">literals</span></a> results in fractional values
of arbitrary precision.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Division by zero causes a <a class="reference internal" href="index.html#assert-and-require"><span class="std std-ref">Panic error</span></a>. This check can <strong>not</strong> be disabled through <code class="docutils literal notranslate"><span class="pre">unchecked</span> <span class="pre">{</span> <span class="pre">...</span> <span class="pre">}</span></code>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The expression <code class="docutils literal notranslate"><span class="pre">type(int).min</span> <span class="pre">/</span> <span class="pre">(-1)</span></code> is the only case where division causes an overflow.
In checked arithmetic mode, this will cause a failing assertion, while in wrapping
mode, the value will be <code class="docutils literal notranslate"><span class="pre">type(int).min</span></code>.</p>
</div>
</section>
<section id="modulo">
<h5>Modulo<a class="headerlink" href="#modulo" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>The modulo operation <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">%</span> <span class="pre">n</span></code> yields the remainder <code class="docutils literal notranslate"><span class="pre">r</span></code> after the division of the operand <code class="docutils literal notranslate"><span class="pre">a</span></code>
by the operand <code class="docutils literal notranslate"><span class="pre">n</span></code>, where <code class="docutils literal notranslate"><span class="pre">q</span> <span class="pre">=</span> <span class="pre">int(a</span> <span class="pre">/</span> <span class="pre">n)</span></code> and <code class="docutils literal notranslate"><span class="pre">r</span> <span class="pre">=</span> <span class="pre">a</span> <span class="pre">-</span> <span class="pre">(n</span> <span class="pre">*</span> <span class="pre">q)</span></code>. This means that modulo
results in the same sign as its left operand (or zero) and <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">%</span> <span class="pre">n</span> <span class="pre">==</span> <span class="pre">-(-a</span> <span class="pre">%</span> <span class="pre">n)</span></code> holds for negative <code class="docutils literal notranslate"><span class="pre">a</span></code>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">int256(5)</span> <span class="pre">%</span> <span class="pre">int256(2)</span> <span class="pre">==</span> <span class="pre">int256(1)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">int256(5)</span> <span class="pre">%</span> <span class="pre">int256(-2)</span> <span class="pre">==</span> <span class="pre">int256(1)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">int256(-5)</span> <span class="pre">%</span> <span class="pre">int256(2)</span> <span class="pre">==</span> <span class="pre">int256(-1)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">int256(-5)</span> <span class="pre">%</span> <span class="pre">int256(-2)</span> <span class="pre">==</span> <span class="pre">int256(-1)</span></code></p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Modulo with zero causes a <a class="reference internal" href="index.html#assert-and-require"><span class="std std-ref">Panic error</span></a>. This check can <strong>not</strong> be disabled through <code class="docutils literal notranslate"><span class="pre">unchecked</span> <span class="pre">{</span> <span class="pre">...</span> <span class="pre">}</span></code>.</p>
</div>
</section>
<section id="exponentiation">
<h5>Exponentiation<a class="headerlink" href="#exponentiation" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>Exponentiation is only available for unsigned types in the exponent. The resulting type
of an exponentiation is always equal to the type of the base. Please take care that it is
large enough to hold the result and prepare for potential assertion failures or wrapping behaviour.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In checked mode, exponentiation only uses the comparatively cheap <code class="docutils literal notranslate"><span class="pre">exp</span></code> opcode for small bases.
For the cases of <code class="docutils literal notranslate"><span class="pre">x**3</span></code>, the expression <code class="docutils literal notranslate"><span class="pre">x*x*x</span></code> might be cheaper.
In any case, gas cost tests and the use of the optimizer are advisable.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note that <code class="docutils literal notranslate"><span class="pre">0**0</span></code> is defined by the EVM as <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p>
</div>
</section>
</section>
<section id="fixed-point-numbers">
<span id="index-4"></span><h4>Fixed Point Numbers<a class="headerlink" href="#fixed-point-numbers" title="Permalink to this heading">ÔÉÅ</a></h4>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Fixed point numbers are not fully supported by Solidity yet. They can be declared, but
cannot be assigned to or from.</p>
</div>
<p><code class="docutils literal notranslate"><span class="pre">fixed</span></code> / <code class="docutils literal notranslate"><span class="pre">ufixed</span></code>: Signed and unsigned fixed point number of various sizes. Keywords <code class="docutils literal notranslate"><span class="pre">ufixedMxN</span></code> and <code class="docutils literal notranslate"><span class="pre">fixedMxN</span></code>, where <code class="docutils literal notranslate"><span class="pre">M</span></code> represents the number of bits taken by
the type and <code class="docutils literal notranslate"><span class="pre">N</span></code> represents how many decimal points are available. <code class="docutils literal notranslate"><span class="pre">M</span></code> must be divisible by 8 and goes from 8 to 256 bits. <code class="docutils literal notranslate"><span class="pre">N</span></code> must be between 0 and 80, inclusive.
<code class="docutils literal notranslate"><span class="pre">ufixed</span></code> and <code class="docutils literal notranslate"><span class="pre">fixed</span></code> are aliases for <code class="docutils literal notranslate"><span class="pre">ufixed128x18</span></code> and <code class="docutils literal notranslate"><span class="pre">fixed128x18</span></code>, respectively.</p>
<p>Operators:</p>
<ul class="simple">
<li><p>Comparisons: <code class="docutils literal notranslate"><span class="pre">&lt;=</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;</span></code>, <code class="docutils literal notranslate"><span class="pre">==</span></code>, <code class="docutils literal notranslate"><span class="pre">!=</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;=</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> (evaluate to <code class="docutils literal notranslate"><span class="pre">bool</span></code>)</p></li>
<li><p>Arithmetic operators: <code class="docutils literal notranslate"><span class="pre">+</span></code>, <code class="docutils literal notranslate"><span class="pre">-</span></code>, unary <code class="docutils literal notranslate"><span class="pre">-</span></code>, <code class="docutils literal notranslate"><span class="pre">*</span></code>, <code class="docutils literal notranslate"><span class="pre">/</span></code>, <code class="docutils literal notranslate"><span class="pre">%</span></code> (modulo)</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The main difference between floating point (<code class="docutils literal notranslate"><span class="pre">float</span></code> and <code class="docutils literal notranslate"><span class="pre">double</span></code> in many languages, more precisely IEEE 754 numbers) and fixed point numbers is
that the number of bits used for the integer and the fractional part (the part after the decimal dot) is flexible in the former, while it is strictly
defined in the latter. Generally, in floating point almost the entire space is used to represent the number, while only a small number of bits define
where the decimal point is.</p>
</div>
</section>
<section id="address">
<span id="index-5"></span><span id="id4"></span><h4>Address<a class="headerlink" href="#address" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>The address type comes in two flavours, which are largely identical:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">address</span></code>: Holds a 20 byte value (size of an Ethereum address).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code>: Same as <code class="docutils literal notranslate"><span class="pre">address</span></code>, but with the additional members <code class="docutils literal notranslate"><span class="pre">transfer</span></code> and <code class="docutils literal notranslate"><span class="pre">send</span></code>.</p></li>
</ul>
<p>The idea behind this distinction is that <code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code> is an address you can send Ether to,
while you are not supposed to send Ether to a plain <code class="docutils literal notranslate"><span class="pre">address</span></code>, for example because it might be a smart contract
that was not built to accept Ether.</p>
<p>Type conversions:</p>
<p>Implicit conversions from <code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code> to <code class="docutils literal notranslate"><span class="pre">address</span></code> are allowed, whereas conversions from <code class="docutils literal notranslate"><span class="pre">address</span></code> to <code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code>
must be explicit via <code class="docutils literal notranslate"><span class="pre">payable(&lt;address&gt;)</span></code>.</p>
<p>Explicit conversions to and from <code class="docutils literal notranslate"><span class="pre">address</span></code> are allowed for <code class="docutils literal notranslate"><span class="pre">uint160</span></code>, integer literals,
<code class="docutils literal notranslate"><span class="pre">bytes20</span></code> and contract types.</p>
<p>Only expressions of type <code class="docutils literal notranslate"><span class="pre">address</span></code> and contract-type can be converted to the type <code class="docutils literal notranslate"><span class="pre">address</span>
<span class="pre">payable</span></code> via the explicit conversion <code class="docutils literal notranslate"><span class="pre">payable(...)</span></code>. For contract-type, this conversion is only
allowed if the contract can receive Ether, i.e., the contract either has a <a class="reference internal" href="index.html#receive-ether-function"><span class="std std-ref">receive</span></a> or a payable fallback function. Note that <code class="docutils literal notranslate"><span class="pre">payable(0)</span></code> is valid and is
an exception to this rule.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you need a variable of type <code class="docutils literal notranslate"><span class="pre">address</span></code> and plan to send Ether to it, then
declare its type as <code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code> to make this requirement visible. Also,
try to make this distinction or conversion as early as possible.</p>
</div>
<p>Operators:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;=</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;</span></code>, <code class="docutils literal notranslate"><span class="pre">==</span></code>, <code class="docutils literal notranslate"><span class="pre">!=</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;=</span></code> and <code class="docutils literal notranslate"><span class="pre">&gt;</span></code></p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If you convert a type that uses a larger byte size to an <code class="docutils literal notranslate"><span class="pre">address</span></code>, for example <code class="docutils literal notranslate"><span class="pre">bytes32</span></code>, then the <code class="docutils literal notranslate"><span class="pre">address</span></code> is truncated.
To reduce conversion ambiguity version 0.4.24 and higher of the compiler force you make the truncation explicit in the conversion.
Take for example the 32-byte value <code class="docutils literal notranslate"><span class="pre">0x111122223333444455556666777788889999AAAABBBBCCCCDDDDEEEEFFFFCCCC</span></code>.</p>
<p>You can use <code class="docutils literal notranslate"><span class="pre">address(uint160(bytes20(b)))</span></code>, which results in <code class="docutils literal notranslate"><span class="pre">0x111122223333444455556666777788889999aAaa</span></code>,
or you can use <code class="docutils literal notranslate"><span class="pre">address(uint160(uint256(b)))</span></code>, which results in <code class="docutils literal notranslate"><span class="pre">0x777788889999AaAAbBbbCcccddDdeeeEfFFfCcCc</span></code>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The distinction between <code class="docutils literal notranslate"><span class="pre">address</span></code> and <code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code> was introduced with version 0.5.0.
Also starting from that version, contracts do not derive from the address type, but can still be explicitly converted to
<code class="docutils literal notranslate"><span class="pre">address</span></code> or to <code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code>, if they have a receive or payable fallback function.</p>
</div>
<section id="members-of-addresses">
<span id="id5"></span><h5>Members of Addresses<a class="headerlink" href="#members-of-addresses" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>For a quick reference of all members of address, see <a class="reference internal" href="index.html#address-related"><span class="std std-ref">Members of Address Types</span></a>.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">balance</span></code> and <code class="docutils literal notranslate"><span class="pre">transfer</span></code></p></li>
</ul>
<p>It is possible to query the balance of an address using the property <code class="docutils literal notranslate"><span class="pre">balance</span></code>
and to send Ether (in units of wei) to a payable address using the <code class="docutils literal notranslate"><span class="pre">transfer</span></code> function:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=YWRkcmVzcyBwYXlhYmxlIHggPSBwYXlhYmxlKDB4MTIzKTsKYWRkcmVzcyBteUFkZHJlc3MgPSBhZGRyZXNzKHRoaXMpOwppZiAoeC5iYWxhbmNlIDwgMTAgJiYgbXlBZGRyZXNzLmJhbGFuY2UgPj0gMTApIHgudHJhbnNmZXIoMTApOw=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">address</span><span class="w"> </span><span class="nv">payable</span><span class="w"> </span>x<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">payable</span><span class="p">(</span><span class="mh">0x123</span><span class="p">);</span><span class="w"></span>
<span class="kt">address</span><span class="w"> </span><span class="nv">myAddress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">address</span><span class="p">(</span><span class="kt">this</span><span class="p">);</span><span class="w"></span>
<span class="kt">if</span><span class="w"> </span><span class="p">(</span>x<span class="p">.</span>balance<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m m-Decimal">10</span><span class="w"> </span><span class="err">&amp;&amp;</span><span class="w"> </span>myAddress<span class="p">.</span>balance<span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="m m-Decimal">10</span><span class="p">)</span><span class="w"> </span>x<span class="p">.</span>transfer<span class="p">(</span><span class="m m-Decimal">10</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">transfer</span></code> function fails if the balance of the current contract is not large enough
or if the Ether transfer is rejected by the receiving account. The <code class="docutils literal notranslate"><span class="pre">transfer</span></code> function
reverts on failure.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If <code class="docutils literal notranslate"><span class="pre">x</span></code> is a contract address, its code (more specifically: its <a class="reference internal" href="index.html#receive-ether-function"><span class="std std-ref">Receive Ether Function</span></a>, if present, or otherwise its <a class="reference internal" href="index.html#fallback-function"><span class="std std-ref">Fallback Function</span></a>, if present) will be executed together with the <code class="docutils literal notranslate"><span class="pre">transfer</span></code> call (this is a feature of the EVM and cannot be prevented). If that execution runs out of gas or fails in any way, the Ether transfer will be reverted and the current contract will stop with an exception.</p>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">send</span></code></p></li>
</ul>
<p>Send is the low-level counterpart of <code class="docutils literal notranslate"><span class="pre">transfer</span></code>. If the execution fails, the current contract will not stop with an exception, but <code class="docutils literal notranslate"><span class="pre">send</span></code> will return <code class="docutils literal notranslate"><span class="pre">false</span></code>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>There are some dangers in using <code class="docutils literal notranslate"><span class="pre">send</span></code>: The transfer fails if the call stack depth is at 1024
(this can always be forced by the caller) and it also fails if the recipient runs out of gas. So in order
to make safe Ether transfers, always check the return value of <code class="docutils literal notranslate"><span class="pre">send</span></code>, use <code class="docutils literal notranslate"><span class="pre">transfer</span></code> or even better:
use a pattern where the recipient withdraws the money.</p>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">call</span></code>, <code class="docutils literal notranslate"><span class="pre">delegatecall</span></code> and <code class="docutils literal notranslate"><span class="pre">staticcall</span></code></p></li>
</ul>
<p>In order to interface with contracts that do not adhere to the ABI,
or to get more direct control over the encoding,
the functions <code class="docutils literal notranslate"><span class="pre">call</span></code>, <code class="docutils literal notranslate"><span class="pre">delegatecall</span></code> and <code class="docutils literal notranslate"><span class="pre">staticcall</span></code> are provided.
They all take a single <code class="docutils literal notranslate"><span class="pre">bytes</span> <span class="pre">memory</span></code> parameter and
return the success condition (as a <code class="docutils literal notranslate"><span class="pre">bool</span></code>) and the returned data
(<code class="docutils literal notranslate"><span class="pre">bytes</span> <span class="pre">memory</span></code>).
The functions <code class="docutils literal notranslate"><span class="pre">abi.encode</span></code>, <code class="docutils literal notranslate"><span class="pre">abi.encodePacked</span></code>, <code class="docutils literal notranslate"><span class="pre">abi.encodeWithSelector</span></code>
and <code class="docutils literal notranslate"><span class="pre">abi.encodeWithSignature</span></code> can be used to encode structured data.</p>
<p>Example:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ynl0ZXMgbWVtb3J5IHBheWxvYWQgPSBhYmkuZW5jb2RlV2l0aFNpZ25hdHVyZSgicmVnaXN0ZXIoc3RyaW5nKSIsICJNeU5hbWUiKTsKKGJvb2wgc3VjY2VzcywgYnl0ZXMgbWVtb3J5IHJldHVybkRhdGEpID0gYWRkcmVzcyhuYW1lUmVnKS5jYWxsKHBheWxvYWQpOwpyZXF1aXJlKHN1Y2Nlc3MpOw=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">bytes</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>payload<span class="w"> </span><span class="o">=</span><span class="w"> </span>abi<span class="p">.</span>encodeWithSignature<span class="p">(</span><span class="s2">&quot;register(string)&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyName&quot;</span><span class="p">);</span><span class="w"></span>
<span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="nv">success</span><span class="p">,</span><span class="w"> </span><span class="kt">bytes</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>returnData<span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">address</span><span class="p">(</span>nameReg<span class="p">).</span>call<span class="p">(</span>payload<span class="p">);</span><span class="w"></span>
<span class="kt">require</span><span class="p">(</span>success<span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>All these functions are low-level functions and should be used with care.
Specifically, any unknown contract might be malicious and if you call it, you
hand over control to that contract which could in turn call back into
your contract, so be prepared for changes to your state variables
when the call returns. The regular way to interact with other contracts
is to call a function on a contract object (<code class="docutils literal notranslate"><span class="pre">x.f()</span></code>).</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Previous versions of Solidity allowed these functions to receive
arbitrary arguments and would also handle a first argument of type
<code class="docutils literal notranslate"><span class="pre">bytes4</span></code> differently. These edge cases were removed in version 0.5.0.</p>
</div>
<p>It is possible to adjust the supplied gas with the <code class="docutils literal notranslate"><span class="pre">gas</span></code> modifier:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=YWRkcmVzcyhuYW1lUmVnKS5jYWxse2dhczogMTAwMDAwMH0oYWJpLmVuY29kZVdpdGhTaWduYXR1cmUoInJlZ2lzdGVyKHN0cmluZykiLCAiTXlOYW1lIikpOw=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">address</span><span class="p">(</span>nameReg<span class="p">).</span>call<span class="p">{</span>gas<span class="p">:</span><span class="w"> </span><span class="m m-Decimal">1000000</span><span class="p">}(</span>abi<span class="p">.</span>encodeWithSignature<span class="p">(</span><span class="s2">&quot;register(string)&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyName&quot;</span><span class="p">));</span><span class="w"></span>
</pre></div>
</div>
<p>Similarly, the supplied Ether value can be controlled too:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=YWRkcmVzcyhuYW1lUmVnKS5jYWxse3ZhbHVlOiAxIGV0aGVyfShhYmkuZW5jb2RlV2l0aFNpZ25hdHVyZSgicmVnaXN0ZXIoc3RyaW5nKSIsICJNeU5hbWUiKSk7"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">address</span><span class="p">(</span>nameReg<span class="p">).</span>call<span class="p">{</span>value<span class="p">:</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="w"> </span>ether<span class="p">}(</span>abi<span class="p">.</span>encodeWithSignature<span class="p">(</span><span class="s2">&quot;register(string)&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyName&quot;</span><span class="p">));</span><span class="w"></span>
</pre></div>
</div>
<p>Lastly, these modifiers can be combined. Their order does not matter:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=YWRkcmVzcyhuYW1lUmVnKS5jYWxse2dhczogMTAwMDAwMCwgdmFsdWU6IDEgZXRoZXJ9KGFiaS5lbmNvZGVXaXRoU2lnbmF0dXJlKCJyZWdpc3RlcihzdHJpbmcpIiwgIk15TmFtZSIpKTs="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">address</span><span class="p">(</span>nameReg<span class="p">).</span>call<span class="p">{</span>gas<span class="p">:</span><span class="w"> </span><span class="m m-Decimal">1000000</span><span class="p">,</span><span class="w"> </span>value<span class="p">:</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="w"> </span>ether<span class="p">}(</span>abi<span class="p">.</span>encodeWithSignature<span class="p">(</span><span class="s2">&quot;register(string)&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MyName&quot;</span><span class="p">));</span><span class="w"></span>
</pre></div>
</div>
<p>In a similar way, the function <code class="docutils literal notranslate"><span class="pre">delegatecall</span></code> can be used: the difference is that only the code of the given address is used, all other aspects (storage, balance, ‚Ä¶) are taken from the current contract. The purpose of <code class="docutils literal notranslate"><span class="pre">delegatecall</span></code> is to use library code which is stored in another contract. The user has to ensure that the layout of storage in both contracts is suitable for delegatecall to be used.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Prior to homestead, only a limited variant called <code class="docutils literal notranslate"><span class="pre">callcode</span></code> was available that did not provide access to the original <code class="docutils literal notranslate"><span class="pre">msg.sender</span></code> and <code class="docutils literal notranslate"><span class="pre">msg.value</span></code> values. This function was removed in version 0.5.0.</p>
</div>
<p>Since byzantium <code class="docutils literal notranslate"><span class="pre">staticcall</span></code> can be used as well. This is basically the same as <code class="docutils literal notranslate"><span class="pre">call</span></code>, but will revert if the called function modifies the state in any way.</p>
<p>All three functions <code class="docutils literal notranslate"><span class="pre">call</span></code>, <code class="docutils literal notranslate"><span class="pre">delegatecall</span></code> and <code class="docutils literal notranslate"><span class="pre">staticcall</span></code> are very low-level functions and should only be used as a <em>last resort</em> as they break the type-safety of Solidity.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">gas</span></code> option is available on all three methods, while the <code class="docutils literal notranslate"><span class="pre">value</span></code> option is only available
on <code class="docutils literal notranslate"><span class="pre">call</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is best to avoid relying on hardcoded gas values in your smart contract code,
regardless of whether state is read from or written to, as this can have many pitfalls.
Also, access to gas might change in the future.</p>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">code</span></code> and <code class="docutils literal notranslate"><span class="pre">codehash</span></code></p></li>
</ul>
<p>You can query the deployed code for any smart contract. Use <code class="docutils literal notranslate"><span class="pre">.code</span></code> to get the EVM bytecode as a
<code class="docutils literal notranslate"><span class="pre">bytes</span> <span class="pre">memory</span></code>, which might be empty. Use <code class="docutils literal notranslate"><span class="pre">.codehash</span></code> get the Keccak-256 hash of that code
(as a <code class="docutils literal notranslate"><span class="pre">bytes32</span></code>). Note that <code class="docutils literal notranslate"><span class="pre">addr.codehash</span></code> is cheaper than using <code class="docutils literal notranslate"><span class="pre">keccak256(addr.code)</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All contracts can be converted to <code class="docutils literal notranslate"><span class="pre">address</span></code> type, so it is possible to query the balance of the
current contract using <code class="docutils literal notranslate"><span class="pre">address(this).balance</span></code>.</p>
</div>
</section>
</section>
<section id="contract-types">
<span id="index-6"></span><span id="id6"></span><h4>Contract Types<a class="headerlink" href="#contract-types" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Every <a class="reference internal" href="index.html#contracts"><span class="std std-ref">contract</span></a> defines its own type.
You can implicitly convert contracts to contracts they inherit from.
Contracts can be explicitly converted to and from the <code class="docutils literal notranslate"><span class="pre">address</span></code> type.</p>
<p>Explicit conversion to and from the <code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code> type is only possible
if the contract type has a receive or payable fallback function.  The conversion is still
performed using <code class="docutils literal notranslate"><span class="pre">address(x)</span></code>. If the contract type does not have a receive or payable
fallback function, the conversion to <code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code> can be done using
<code class="docutils literal notranslate"><span class="pre">payable(address(x))</span></code>.
You can find more information in the section about
the <a class="reference internal" href="#address"><span class="std std-ref">address type</span></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Before version 0.5.0, contracts directly derived from the address type
and there was no distinction between <code class="docutils literal notranslate"><span class="pre">address</span></code> and <code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code>.</p>
</div>
<p>If you declare a local variable of contract type (<code class="docutils literal notranslate"><span class="pre">MyContract</span> <span class="pre">c</span></code>), you can call
functions on that contract. Take care to assign it from somewhere that is the
same contract type.</p>
<p>You can also instantiate contracts (which means they are newly created). You
can find more details in the <a class="reference internal" href="index.html#creating-contracts"><span class="std std-ref">‚ÄòContracts via new‚Äô</span></a>
section.</p>
<p>The data representation of a contract is identical to that of the <code class="docutils literal notranslate"><span class="pre">address</span></code>
type and this type is also used in the <a class="reference internal" href="index.html#abi"><span class="std std-ref">ABI</span></a>.</p>
<p>Contracts do not support any operators.</p>
<p>The members of contract types are the external functions of the contract
including any state variables marked as <code class="docutils literal notranslate"><span class="pre">public</span></code>.</p>
<p>For a contract <code class="docutils literal notranslate"><span class="pre">C</span></code> you can use <code class="docutils literal notranslate"><span class="pre">type(C)</span></code> to access
<a class="reference internal" href="index.html#meta-type"><span class="std std-ref">type information</span></a> about the contract.</p>
</section>
<section id="fixed-size-byte-arrays">
<span id="index-7"></span><h4>Fixed-size byte arrays<a class="headerlink" href="#fixed-size-byte-arrays" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>The value types <code class="docutils literal notranslate"><span class="pre">bytes1</span></code>, <code class="docutils literal notranslate"><span class="pre">bytes2</span></code>, <code class="docutils literal notranslate"><span class="pre">bytes3</span></code>, ‚Ä¶, <code class="docutils literal notranslate"><span class="pre">bytes32</span></code>
hold a sequence of bytes from one to up to 32.</p>
<p>Operators:</p>
<ul class="simple">
<li><p>Comparisons: <code class="docutils literal notranslate"><span class="pre">&lt;=</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;</span></code>, <code class="docutils literal notranslate"><span class="pre">==</span></code>, <code class="docutils literal notranslate"><span class="pre">!=</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;=</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> (evaluate to <code class="docutils literal notranslate"><span class="pre">bool</span></code>)</p></li>
<li><p>Bit operators: <code class="docutils literal notranslate"><span class="pre">&amp;</span></code>, <code class="docutils literal notranslate"><span class="pre">|</span></code>, <code class="docutils literal notranslate"><span class="pre">^</span></code> (bitwise exclusive or), <code class="docutils literal notranslate"><span class="pre">~</span></code> (bitwise negation)</p></li>
<li><p>Shift operators: <code class="docutils literal notranslate"><span class="pre">&lt;&lt;</span></code> (left shift), <code class="docutils literal notranslate"><span class="pre">&gt;&gt;</span></code> (right shift)</p></li>
<li><p>Index access: If <code class="docutils literal notranslate"><span class="pre">x</span></code> is of type <code class="docutils literal notranslate"><span class="pre">bytesI</span></code>, then <code class="docutils literal notranslate"><span class="pre">x[k]</span></code> for <code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">&lt;=</span> <span class="pre">k</span> <span class="pre">&lt;</span> <span class="pre">I</span></code> returns the <code class="docutils literal notranslate"><span class="pre">k</span></code> th byte (read-only).</p></li>
</ul>
<p>The shifting operator works with unsigned integer type as right operand (but
returns the type of the left operand), which denotes the number of bits to shift by.
Shifting by a signed type will produce a compilation error.</p>
<p>Members:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">.length</span></code> yields the fixed length of the byte array (read-only).</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The type <code class="docutils literal notranslate"><span class="pre">bytes1[]</span></code> is an array of bytes, but due to padding rules, it wastes
31 bytes of space for each element (except in storage). It is better to use the <code class="docutils literal notranslate"><span class="pre">bytes</span></code>
type instead.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Prior to version 0.8.0, <code class="docutils literal notranslate"><span class="pre">byte</span></code> used to be an alias for <code class="docutils literal notranslate"><span class="pre">bytes1</span></code>.</p>
</div>
</section>
<section id="dynamically-sized-byte-array">
<h4>Dynamically-sized byte array<a class="headerlink" href="#dynamically-sized-byte-array" title="Permalink to this heading">ÔÉÅ</a></h4>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">bytes</span></code>:</dt><dd><p>Dynamically-sized byte array, see <a class="reference internal" href="#arrays"><span class="std std-ref">Arrays</span></a>. Not a value-type!</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">string</span></code>:</dt><dd><p>Dynamically-sized UTF-8-encoded string, see <a class="reference internal" href="#arrays"><span class="std std-ref">Arrays</span></a>. Not a value-type!</p>
</dd>
</dl>
</section>
<section id="address-literals">
<span id="index-8"></span><span id="id7"></span><h4>Address Literals<a class="headerlink" href="#address-literals" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Hexadecimal literals that pass the address checksum test, for example
<code class="docutils literal notranslate"><span class="pre">0xdCad3a6d3569DF655070DEd06cb7A1b2Ccd1D3AF</span></code> are of <code class="docutils literal notranslate"><span class="pre">address</span></code> type.
Hexadecimal literals that are between 39 and 41 digits
long and do not pass the checksum test produce
an error. You can prepend (for integer types) or append (for bytesNN types) zeros to remove the error.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The mixed-case address checksum format is defined in <a class="reference external" href="https://github.com/ethereum/EIPs/blob/master/EIPS/eip-55.md">EIP-55</a>.</p>
</div>
</section>
<section id="rational-and-integer-literals">
<span id="rational-literals"></span><span id="index-9"></span><h4>Rational and Integer Literals<a class="headerlink" href="#rational-and-integer-literals" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Integer literals are formed from a sequence of digits in the range 0-9.
They are interpreted as decimals. For example, <code class="docutils literal notranslate"><span class="pre">69</span></code> means sixty nine.
Octal literals do not exist in Solidity and leading zeros are invalid.</p>
<p>Decimal fractional literals are formed by a <code class="docutils literal notranslate"><span class="pre">.</span></code> with at least one number on
one side.  Examples include <code class="docutils literal notranslate"><span class="pre">1.</span></code>, <code class="docutils literal notranslate"><span class="pre">.1</span></code> and <code class="docutils literal notranslate"><span class="pre">1.3</span></code>.</p>
<p>Scientific notation in the form of <code class="docutils literal notranslate"><span class="pre">2e10</span></code> is also supported, where the
mantissa can be fractional but the exponent has to be an integer.
The literal <code class="docutils literal notranslate"><span class="pre">MeE</span></code> is equivalent to <code class="docutils literal notranslate"><span class="pre">M</span> <span class="pre">*</span> <span class="pre">10**E</span></code>.
Examples include <code class="docutils literal notranslate"><span class="pre">2e10</span></code>, <code class="docutils literal notranslate"><span class="pre">-2e10</span></code>, <code class="docutils literal notranslate"><span class="pre">2e-10</span></code>, <code class="docutils literal notranslate"><span class="pre">2.5e1</span></code>.</p>
<p>Underscores can be used to separate the digits of a numeric literal to aid readability.
For example, decimal <code class="docutils literal notranslate"><span class="pre">123_000</span></code>, hexadecimal <code class="docutils literal notranslate"><span class="pre">0x2eff_abde</span></code>, scientific decimal notation <code class="docutils literal notranslate"><span class="pre">1_2e345_678</span></code> are all valid.
Underscores are only allowed between two digits and only one consecutive underscore is allowed.
There is no additional semantic meaning added to a number literal containing underscores,
the underscores are ignored.</p>
<p>Number literal expressions retain arbitrary precision until they are converted to a non-literal type (i.e. by
using them together with anything other than a number literal expression (like boolean literals) or by explicit conversion).
This means that computations do not overflow and divisions do not truncate
in number literal expressions.</p>
<p>For example, <code class="docutils literal notranslate"><span class="pre">(2**800</span> <span class="pre">+</span> <span class="pre">1)</span> <span class="pre">-</span> <span class="pre">2**800</span></code> results in the constant <code class="docutils literal notranslate"><span class="pre">1</span></code> (of type <code class="docutils literal notranslate"><span class="pre">uint8</span></code>)
although intermediate results would not even fit the machine word size. Furthermore, <code class="docutils literal notranslate"><span class="pre">.5</span> <span class="pre">*</span> <span class="pre">8</span></code> results
in the integer <code class="docutils literal notranslate"><span class="pre">4</span></code> (although non-integers were used in between).</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>While most operators produce a literal expression when applied to literals, there are certain operators that do not follow this pattern:</p>
<ul class="simple">
<li><p>Ternary operator (<code class="docutils literal notranslate"><span class="pre">...</span> <span class="pre">?</span> <span class="pre">...</span> <span class="pre">:</span> <span class="pre">...</span></code>),</p></li>
<li><p>Array subscript (<code class="docutils literal notranslate"><span class="pre">&lt;array&gt;[&lt;index&gt;]</span></code>).</p></li>
</ul>
<p>You might expect expressions like <code class="docutils literal notranslate"><span class="pre">255</span> <span class="pre">+</span> <span class="pre">(true</span> <span class="pre">?</span> <span class="pre">1</span> <span class="pre">:</span> <span class="pre">0)</span></code> or <code class="docutils literal notranslate"><span class="pre">255</span> <span class="pre">+</span> <span class="pre">[1,</span> <span class="pre">2,</span> <span class="pre">3][0]</span></code> to be equivalent to using the literal 256
directly, but in fact they are computed within the type <code class="docutils literal notranslate"><span class="pre">uint8</span></code> and can overflow.</p>
</div>
<p>Any operator that can be applied to integers can also be applied to number literal expressions as
long as the operands are integers. If any of the two is fractional, bit operations are disallowed
and exponentiation is disallowed if the exponent is fractional (because that might result in
a non-rational number).</p>
<p>Shifts and exponentiation with literal numbers as left (or base) operand and integer types
as the right (exponent) operand are always performed
in the <code class="docutils literal notranslate"><span class="pre">uint256</span></code> (for non-negative literals) or <code class="docutils literal notranslate"><span class="pre">int256</span></code> (for a negative literals) type,
regardless of the type of the right (exponent) operand.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Division on integer literals used to truncate in Solidity prior to version 0.4.0, but it now converts into a rational number, i.e. <code class="docutils literal notranslate"><span class="pre">5</span> <span class="pre">/</span> <span class="pre">2</span></code> is not equal to <code class="docutils literal notranslate"><span class="pre">2</span></code>, but to <code class="docutils literal notranslate"><span class="pre">2.5</span></code>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Solidity has a number literal type for each rational number.
Integer literals and rational number literals belong to number literal types.
Moreover, all number literal expressions (i.e. the expressions that
contain only number literals and operators) belong to number literal
types.  So the number literal expressions <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">+</span> <span class="pre">2</span></code> and <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">+</span> <span class="pre">1</span></code> both
belong to the same number literal type for the rational number three.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Number literal expressions are converted into a non-literal type as soon as they are used with non-literal
expressions. Disregarding types, the value of the expression assigned to <code class="docutils literal notranslate"><span class="pre">b</span></code>
below evaluates to an integer. Because <code class="docutils literal notranslate"><span class="pre">a</span></code> is of type <code class="docutils literal notranslate"><span class="pre">uint128</span></code>, the
expression <code class="docutils literal notranslate"><span class="pre">2.5</span> <span class="pre">+</span> <span class="pre">a</span></code> has to have a proper type, though. Since there is no common type
for the type of <code class="docutils literal notranslate"><span class="pre">2.5</span></code> and <code class="docutils literal notranslate"><span class="pre">uint128</span></code>, the Solidity compiler does not accept
this code.</p>
</div>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=dWludDEyOCBhID0gMTsKdWludDEyOCBiID0gMi41ICsgYSArIDAuNTs="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">uint128</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">;</span><span class="w"></span>
<span class="kt">uint128</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">2</span><span class="p">.</span><span class="m m-Decimal">5</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>a<span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">.</span><span class="m m-Decimal">5</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="string-literals-and-types">
<span id="string-literals"></span><span id="index-10"></span><h4>String Literals and Types<a class="headerlink" href="#string-literals-and-types" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>String literals are written with either double or single-quotes (<code class="docutils literal notranslate"><span class="pre">&quot;foo&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">'bar'</span></code>), and they can also be split into multiple consecutive parts (<code class="docutils literal notranslate"><span class="pre">&quot;foo&quot;</span> <span class="pre">&quot;bar&quot;</span></code> is equivalent to <code class="docutils literal notranslate"><span class="pre">&quot;foobar&quot;</span></code>) which can be helpful when dealing with long strings.  They do not imply trailing zeroes as in C; <code class="docutils literal notranslate"><span class="pre">&quot;foo&quot;</span></code> represents three bytes, not four.  As with integer literals, their type can vary, but they are implicitly convertible to <code class="docutils literal notranslate"><span class="pre">bytes1</span></code>, ‚Ä¶, <code class="docutils literal notranslate"><span class="pre">bytes32</span></code>, if they fit, to <code class="docutils literal notranslate"><span class="pre">bytes</span></code> and to <code class="docutils literal notranslate"><span class="pre">string</span></code>.</p>
<p>For example, with <code class="docutils literal notranslate"><span class="pre">bytes32</span> <span class="pre">samevar</span> <span class="pre">=</span> <span class="pre">&quot;stringliteral&quot;</span></code> the string literal is interpreted in its raw byte form when assigned to a <code class="docutils literal notranslate"><span class="pre">bytes32</span></code> type.</p>
<p>String literals can only contain printable ASCII characters, which means the characters between and including 0x20 .. 0x7E.</p>
<p>Additionally, string literals also support the following escape characters:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">\&lt;newline&gt;</span></code> (escapes an actual newline)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">\\</span></code> (backslash)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">\'</span></code> (single quote)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">\&quot;</span></code> (double quote)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">\n</span></code> (newline)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">\r</span></code> (carriage return)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">\t</span></code> (tab)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">\xNN</span></code> (hex escape, see below)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">\uNNNN</span></code> (unicode escape, see below)</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">\xNN</span></code> takes a hex value and inserts the appropriate byte, while <code class="docutils literal notranslate"><span class="pre">\uNNNN</span></code> takes a Unicode codepoint and inserts an UTF-8 sequence.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Until version 0.8.0 there were three additional escape sequences: <code class="docutils literal notranslate"><span class="pre">\b</span></code>, <code class="docutils literal notranslate"><span class="pre">\f</span></code> and <code class="docutils literal notranslate"><span class="pre">\v</span></code>.
They are commonly available in other languages but rarely needed in practice.
If you do need them, they can still be inserted via hexadecimal escapes, i.e. <code class="docutils literal notranslate"><span class="pre">\x08</span></code>, <code class="docutils literal notranslate"><span class="pre">\x0c</span></code>
and <code class="docutils literal notranslate"><span class="pre">\x0b</span></code>, respectively, just as any other ASCII character.</p>
</div>
<p>The string in the following example has a length of ten bytes.
It starts with a newline byte, followed by a double quote, a single
quote a backslash character and then (without separator) the
character sequence <code class="docutils literal notranslate"><span class="pre">abcdef</span></code>.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=IlxuXCJcJ1xcYWJjXApkZWYi"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;\n\&quot;</span><span class="err">\&#39;\\</span>abc<span class="err">\</span><span class="w"></span>
def<span class="err">&quot;</span><span class="w"></span>
</pre></div>
</div>
<p>Any Unicode line terminator which is not a newline (i.e. LF, VF, FF, CR, NEL, LS, PS) is considered to
terminate the string literal. Newline only terminates the string literal if it is not preceded by a <code class="docutils literal notranslate"><span class="pre">\</span></code>.</p>
</section>
<section id="unicode-literals">
<h4>Unicode Literals<a class="headerlink" href="#unicode-literals" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>While regular string literals can only contain ASCII, Unicode literals ‚Äì prefixed with the keyword <code class="docutils literal notranslate"><span class="pre">unicode</span></code> ‚Äì can contain any valid UTF-8 sequence.
They also support the very same escape sequences as regular string literals.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=c3RyaW5nIG1lbW9yeSBhID0gdW5pY29kZSJIZWxsbyDwn5iDIjs="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>a<span class="w"> </span><span class="o">=</span><span class="w"> </span>unicode<span class="s2">&quot;Hello üòÉ&quot;</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="hexadecimal-literals">
<span id="index-11"></span><h4>Hexadecimal Literals<a class="headerlink" href="#hexadecimal-literals" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Hexadecimal literals are prefixed with the keyword <code class="docutils literal notranslate"><span class="pre">hex</span></code> and are enclosed in double
or single-quotes (<code class="docutils literal notranslate"><span class="pre">hex&quot;001122FF&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">hex'0011_22_FF'</span></code>). Their content must be
hexadecimal digits which can optionally use a single underscore as separator between
byte boundaries. The value of the literal will be the binary representation
of the hexadecimal sequence.</p>
<p>Multiple hexadecimal literals separated by whitespace are concatenated into a single literal:
<code class="docutils literal notranslate"><span class="pre">hex&quot;00112233&quot;</span> <span class="pre">hex&quot;44556677&quot;</span></code> is equivalent to <code class="docutils literal notranslate"><span class="pre">hex&quot;0011223344556677&quot;</span></code></p>
<p>Hexadecimal literals behave like <a class="reference internal" href="#string-literals"><span class="std std-ref">string literals</span></a> and have the same convertibility restrictions.</p>
</section>
<section id="enums">
<span id="index-12"></span><span id="id8"></span><h4>Enums<a class="headerlink" href="#enums" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Enums are one way to create a user-defined type in Solidity. They are explicitly convertible
to and from all integer types but implicit conversion is not allowed.  The explicit conversion
from integer checks at runtime that the value lies inside the range of the enum and causes a
<a class="reference internal" href="index.html#assert-and-require"><span class="std std-ref">Panic error</span></a> otherwise.
Enums require at least one member, and its default value when declared is the first member.
Enums cannot have more than 256 members.</p>
<p>The data representation is the same as for enums in C: The options are represented by
subsequent unsigned integer values starting from <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p>
<p>Using <code class="docutils literal notranslate"><span class="pre">type(NameOfEnum).min</span></code> and <code class="docutils literal notranslate"><span class="pre">type(NameOfEnum).max</span></code> you can get the
smallest and respectively largest value of the given enum.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5IF4wLjguODsKCmNvbnRyYWN0IHRlc3QgewogICAgZW51bSBBY3Rpb25DaG9pY2VzIHsgR29MZWZ0LCBHb1JpZ2h0LCBHb1N0cmFpZ2h0LCBTaXRTdGlsbCB9CiAgICBBY3Rpb25DaG9pY2VzIGNob2ljZTsKICAgIEFjdGlvbkNob2ljZXMgY29uc3RhbnQgZGVmYXVsdENob2ljZSA9IEFjdGlvbkNob2ljZXMuR29TdHJhaWdodDsKCiAgICBmdW5jdGlvbiBzZXRHb1N0cmFpZ2h0KCkgcHVibGljIHsKICAgICAgICBjaG9pY2UgPSBBY3Rpb25DaG9pY2VzLkdvU3RyYWlnaHQ7CiAgICB9CgogICAgLy8gU2luY2UgZW51bSB0eXBlcyBhcmUgbm90IHBhcnQgb2YgdGhlIEFCSSwgdGhlIHNpZ25hdHVyZSBvZiAiZ2V0Q2hvaWNlIgogICAgLy8gd2lsbCBhdXRvbWF0aWNhbGx5IGJlIGNoYW5nZWQgdG8gImdldENob2ljZSgpIHJldHVybnMgKHVpbnQ4KSIKICAgIC8vIGZvciBhbGwgbWF0dGVycyBleHRlcm5hbCB0byBTb2xpZGl0eS4KICAgIGZ1bmN0aW9uIGdldENob2ljZSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKEFjdGlvbkNob2ljZXMpIHsKICAgICAgICByZXR1cm4gY2hvaWNlOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldERlZmF1bHRDaG9pY2UoKSBwdWJsaWMgcHVyZSByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIHVpbnQoZGVmYXVsdENob2ljZSk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0TGFyZ2VzdFZhbHVlKCkgcHVibGljIHB1cmUgcmV0dXJucyAoQWN0aW9uQ2hvaWNlcykgewogICAgICAgIHJldHVybiB0eXBlKEFjdGlvbkNob2ljZXMpLm1heDsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRTbWFsbGVzdFZhbHVlKCkgcHVibGljIHB1cmUgcmV0dXJucyAoQWN0aW9uQ2hvaWNlcykgewogICAgICAgIHJldHVybiB0eXBlKEFjdGlvbkNob2ljZXMpLm1pbjsKICAgIH0KfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.8.8</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">test</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">enum</span><span class="w"> </span><span class="nv">ActionChoices</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>GoLeft<span class="p">,</span><span class="w"> </span>GoRight<span class="p">,</span><span class="w"> </span>GoStraight<span class="p">,</span><span class="w"> </span>SitStill<span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span>ActionChoices<span class="w"> </span>choice<span class="p">;</span><span class="w"></span>
<span class="w">    </span>ActionChoices<span class="w"> </span><span class="kt">constant</span><span class="w"> </span>defaultChoice<span class="w"> </span><span class="o">=</span><span class="w"> </span>ActionChoices<span class="p">.</span>GoStraight<span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">setGoStraight</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>choice<span class="w"> </span><span class="o">=</span><span class="w"> </span>ActionChoices<span class="p">.</span>GoStraight<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Since enum types are not part of the ABI, the signature of &quot;getChoice&quot;</span>
<span class="w">    </span><span class="c1">// will automatically be changed to &quot;getChoice() returns (uint8)&quot;</span>
<span class="w">    </span><span class="c1">// for all matters external to Solidity.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">getChoice</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span>ActionChoices<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>choice<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">getDefaultChoice</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span><span class="kt">uint</span><span class="p">(</span>defaultChoice<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">getLargestValue</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span>ActionChoices<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>type<span class="p">(</span>ActionChoices<span class="p">).</span>max<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">getSmallestValue</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span>ActionChoices<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>type<span class="p">(</span>ActionChoices<span class="p">).</span>min<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Enums can also be declared on the file level, outside of contract or library definitions.</p>
</div>
</section>
<section id="user-defined-value-types">
<span id="index-13"></span><span id="id9"></span><h4>User Defined Value Types<a class="headerlink" href="#user-defined-value-types" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>A user defined value type allows creating a zero cost abstraction over an elementary value type.
This is similar to an alias, but with stricter type requirements.</p>
<p>A user defined value type is defined using <code class="docutils literal notranslate"><span class="pre">type</span> <span class="pre">C</span> <span class="pre">is</span> <span class="pre">V</span></code>, where <code class="docutils literal notranslate"><span class="pre">C</span></code> is the name of the newly
introduced type and <code class="docutils literal notranslate"><span class="pre">V</span></code> has to be a built-in value type (the ‚Äúunderlying type‚Äù). The function
<code class="docutils literal notranslate"><span class="pre">C.wrap</span></code> is used to convert from the underlying type to the custom type. Similarly, the
function <code class="docutils literal notranslate"><span class="pre">C.unwrap</span></code> is used to convert from the custom type to the underlying type.</p>
<p>The type <code class="docutils literal notranslate"><span class="pre">C</span></code> does not have any operators or bound member functions. In particular, even the
operator <code class="docutils literal notranslate"><span class="pre">==</span></code> is not defined. Explicit and implicit conversions to and from other types are
disallowed.</p>
<p>The data-representation of values of such types are inherited from the underlying type
and the underlying type is also used in the ABI.</p>
<p>The following example illustrates a custom type <code class="docutils literal notranslate"><span class="pre">UFixed256x18</span></code> representing a decimal fixed point
type with 18 decimals and a minimal library to do arithmetic operations on the type.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5IF4wLjguODsKCi8vIFJlcHJlc2VudCBhIDE4IGRlY2ltYWwsIDI1NiBiaXQgd2lkZSBmaXhlZCBwb2ludCB0eXBlIHVzaW5nIGEgdXNlciBkZWZpbmVkIHZhbHVlIHR5cGUuCnR5cGUgVUZpeGVkMjU2eDE4IGlzIHVpbnQyNTY7CgovLy8gQSBtaW5pbWFsIGxpYnJhcnkgdG8gZG8gZml4ZWQgcG9pbnQgb3BlcmF0aW9ucyBvbiBVRml4ZWQyNTZ4MTguCmxpYnJhcnkgRml4ZWRNYXRoIHsKICAgIHVpbnQgY29uc3RhbnQgbXVsdGlwbGllciA9IDEwKioxODsKCiAgICAvLy8gQWRkcyB0d28gVUZpeGVkMjU2eDE4IG51bWJlcnMuIFJldmVydHMgb24gb3ZlcmZsb3csIHJlbHlpbmcgb24gY2hlY2tlZAogICAgLy8vIGFyaXRobWV0aWMgb24gdWludDI1Ni4KICAgIGZ1bmN0aW9uIGFkZChVRml4ZWQyNTZ4MTggYSwgVUZpeGVkMjU2eDE4IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAoVUZpeGVkMjU2eDE4KSB7CiAgICAgICAgcmV0dXJuIFVGaXhlZDI1NngxOC53cmFwKFVGaXhlZDI1NngxOC51bndyYXAoYSkgKyBVRml4ZWQyNTZ4MTgudW53cmFwKGIpKTsKICAgIH0KICAgIC8vLyBNdWx0aXBsaWVzIFVGaXhlZDI1NngxOCBhbmQgdWludDI1Ni4gUmV2ZXJ0cyBvbiBvdmVyZmxvdywgcmVseWluZyBvbiBjaGVja2VkCiAgICAvLy8gYXJpdGhtZXRpYyBvbiB1aW50MjU2LgogICAgZnVuY3Rpb24gbXVsKFVGaXhlZDI1NngxOCBhLCB1aW50MjU2IGIpIGludGVybmFsIHB1cmUgcmV0dXJucyAoVUZpeGVkMjU2eDE4KSB7CiAgICAgICAgcmV0dXJuIFVGaXhlZDI1NngxOC53cmFwKFVGaXhlZDI1NngxOC51bndyYXAoYSkgKiBiKTsKICAgIH0KICAgIC8vLyBUYWtlIHRoZSBmbG9vciBvZiBhIFVGaXhlZDI1NngxOCBudW1iZXIuCiAgICAvLy8gQHJldHVybiB0aGUgbGFyZ2VzdCBpbnRlZ2VyIHRoYXQgZG9lcyBub3QgZXhjZWVkIGBhYC4KICAgIGZ1bmN0aW9uIGZsb29yKFVGaXhlZDI1NngxOCBhKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gVUZpeGVkMjU2eDE4LnVud3JhcChhKSAvIG11bHRpcGxpZXI7CiAgICB9CiAgICAvLy8gVHVybnMgYSB1aW50MjU2IGludG8gYSBVRml4ZWQyNTZ4MTggb2YgdGhlIHNhbWUgdmFsdWUuCiAgICAvLy8gUmV2ZXJ0cyBpZiB0aGUgaW50ZWdlciBpcyB0b28gbGFyZ2UuCiAgICBmdW5jdGlvbiB0b1VGaXhlZDI1NngxOCh1aW50MjU2IGEpIGludGVybmFsIHB1cmUgcmV0dXJucyAoVUZpeGVkMjU2eDE4KSB7CiAgICAgICAgcmV0dXJuIFVGaXhlZDI1NngxOC53cmFwKGEgKiBtdWx0aXBsaWVyKTsKICAgIH0KfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.8.8</span><span class="p">;</span><span class="w"></span>

<span class="c1">// Represent a 18 decimal, 256 bit wide fixed point type using a user defined value type.</span>
type<span class="w"> </span>UFixed256x18<span class="w"> </span><span class="kt">is</span><span class="w"> </span><span class="kt">uint256</span><span class="p">;</span><span class="w"></span>

<span class="c1">/// A minimal library to do fixed point operations on UFixed256x18.</span>
<span class="kt">library</span><span class="w"> </span>FixedMath<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="nv">constant</span><span class="w"> </span>multiplier<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">10</span><span class="o">**</span><span class="m m-Decimal">18</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// Adds two UFixed256x18 numbers. Reverts on overflow, relying on checked</span>
<span class="w">    </span><span class="c1">/// arithmetic on uint256.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">add</span><span class="p">(</span>UFixed256x18<span class="w"> </span>a<span class="p">,</span><span class="w"> </span>UFixed256x18<span class="w"> </span>b<span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span>UFixed256x18<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>UFixed256x18<span class="p">.</span>wrap<span class="p">(</span>UFixed256x18<span class="p">.</span>unwrap<span class="p">(</span>a<span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>UFixed256x18<span class="p">.</span>unwrap<span class="p">(</span>b<span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="c1">/// Multiplies UFixed256x18 and uint256. Reverts on overflow, relying on checked</span>
<span class="w">    </span><span class="c1">/// arithmetic on uint256.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">mul</span><span class="p">(</span>UFixed256x18<span class="w"> </span>a<span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">b</span><span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span>UFixed256x18<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>UFixed256x18<span class="p">.</span>wrap<span class="p">(</span>UFixed256x18<span class="p">.</span>unwrap<span class="p">(</span>a<span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span>b<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="c1">/// Take the floor of a UFixed256x18 number.</span>
<span class="w">    </span><span class="c1">/// @return the largest integer that does not exceed `a`.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">floor</span><span class="p">(</span>UFixed256x18<span class="w"> </span>a<span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint256</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>UFixed256x18<span class="p">.</span>unwrap<span class="p">(</span>a<span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span>multiplier<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="c1">/// Turns a uint256 into a UFixed256x18 of the same value.</span>
<span class="w">    </span><span class="c1">/// Reverts if the integer is too large.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">toUFixed256x18</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">a</span><span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span>UFixed256x18<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>UFixed256x18<span class="p">.</span>wrap<span class="p">(</span>a<span class="w"> </span><span class="o">*</span><span class="w"> </span>multiplier<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Notice how <code class="docutils literal notranslate"><span class="pre">UFixed256x18.wrap</span></code> and <code class="docutils literal notranslate"><span class="pre">FixedMath.toUFixed256x18</span></code> have the same signature but
perform two very different operations: The <code class="docutils literal notranslate"><span class="pre">UFixed256x18.wrap</span></code> function returns a <code class="docutils literal notranslate"><span class="pre">UFixed256x18</span></code>
that has the same data representation as the input, whereas <code class="docutils literal notranslate"><span class="pre">toUFixed256x18</span></code> returns a
<code class="docutils literal notranslate"><span class="pre">UFixed256x18</span></code> that has the same numerical value.</p>
</section>
<section id="function-types">
<span id="index-14"></span><span id="id10"></span><h4>Function Types<a class="headerlink" href="#function-types" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Function types are the types of functions. Variables of function type
can be assigned from functions and function parameters of function type
can be used to pass functions to and return functions from function calls.
Function types come in two flavours - <em>internal</em> and <em>external</em> functions:</p>
<p>Internal functions can only be called inside the current contract (more specifically,
inside the current code unit, which also includes internal library functions
and inherited functions) because they cannot be executed outside of the
context of the current contract. Calling an internal function is realized
by jumping to its entry label, just like when calling a function of the current
contract internally.</p>
<p>External functions consist of an address and a function signature and they can
be passed via and returned from external function calls.</p>
<p>Function types are notated as follows:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=ZnVuY3Rpb24gKDxwYXJhbWV0ZXIgdHlwZXM+KSB7aW50ZXJuYWx8ZXh0ZXJuYWx9IFtwdXJlfHZpZXd8cGF5YWJsZV0gW3JldHVybnMgKDxyZXR1cm4gdHlwZXM+KV0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">function</span><span class="w"> </span><span class="p">(</span><span class="o">&lt;</span>parameter<span class="w"> </span>types<span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="kt">internal</span><span class="err">|</span><span class="kt">external</span><span class="p">}</span><span class="w"> </span><span class="p">[</span>pure<span class="err">|</span>view<span class="err">|</span><span class="kt">payable</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="o">&lt;</span><span class="kt">return</span><span class="w"> </span>types<span class="o">&gt;</span><span class="p">)]</span><span class="w"></span>
</pre></div>
</div>
<p>In contrast to the parameter types, the return types cannot be empty - if the
function type should not return anything, the whole <code class="docutils literal notranslate"><span class="pre">returns</span> <span class="pre">(&lt;return</span> <span class="pre">types&gt;)</span></code>
part has to be omitted.</p>
<p>By default, function types are internal, so the <code class="docutils literal notranslate"><span class="pre">internal</span></code> keyword can be
omitted. Note that this only applies to function types. Visibility has
to be specified explicitly for functions defined in contracts, they
do not have a default.</p>
<p>Conversions:</p>
<p>A function type <code class="docutils literal notranslate"><span class="pre">A</span></code> is implicitly convertible to a function type <code class="docutils literal notranslate"><span class="pre">B</span></code> if and only if
their parameter types are identical, their return types are identical,
their internal/external property is identical and the state mutability of <code class="docutils literal notranslate"><span class="pre">A</span></code>
is more restrictive than the state mutability of <code class="docutils literal notranslate"><span class="pre">B</span></code>. In particular:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pure</span></code> functions can be converted to <code class="docutils literal notranslate"><span class="pre">view</span></code> and <code class="docutils literal notranslate"><span class="pre">non-payable</span></code> functions</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">view</span></code> functions can be converted to <code class="docutils literal notranslate"><span class="pre">non-payable</span></code> functions</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">payable</span></code> functions can be converted to <code class="docutils literal notranslate"><span class="pre">non-payable</span></code> functions</p></li>
</ul>
<p>No other conversions between function types are possible.</p>
<p>The rule about <code class="docutils literal notranslate"><span class="pre">payable</span></code> and <code class="docutils literal notranslate"><span class="pre">non-payable</span></code> might be a little
confusing, but in essence, if a function is <code class="docutils literal notranslate"><span class="pre">payable</span></code>, this means that it
also accepts a payment of zero Ether, so it also is <code class="docutils literal notranslate"><span class="pre">non-payable</span></code>.
On the other hand, a <code class="docutils literal notranslate"><span class="pre">non-payable</span></code> function will reject Ether sent to it,
so <code class="docutils literal notranslate"><span class="pre">non-payable</span></code> functions cannot be converted to <code class="docutils literal notranslate"><span class="pre">payable</span></code> functions.</p>
<p>If a function type variable is not initialised, calling it results
in a <a class="reference internal" href="index.html#assert-and-require"><span class="std std-ref">Panic error</span></a>. The same happens if you call a function after using <code class="docutils literal notranslate"><span class="pre">delete</span></code>
on it.</p>
<p>If external function types are used outside of the context of Solidity,
they are treated as the <code class="docutils literal notranslate"><span class="pre">function</span></code> type, which encodes the address
followed by the function identifier together in a single <code class="docutils literal notranslate"><span class="pre">bytes24</span></code> type.</p>
<p>Note that public functions of the current contract can be used both as an
internal and as an external function. To use <code class="docutils literal notranslate"><span class="pre">f</span></code> as an internal function,
just use <code class="docutils literal notranslate"><span class="pre">f</span></code>, if you want to use its external form, use <code class="docutils literal notranslate"><span class="pre">this.f</span></code>.</p>
<p>A function of an internal type can be assigned to a variable of an internal function type regardless
of where it is defined.
This includes private, internal and public functions of both contracts and libraries as well as free
functions.
External function types, on the other hand, are only compatible with public and external contract
functions.
Libraries are excluded because they require a <code class="docutils literal notranslate"><span class="pre">delegatecall</span></code> and use <a class="reference internal" href="index.html#library-selectors"><span class="std std-ref">a different ABI
convention for their selectors</span></a>.
Functions declared in interfaces do not have definitions so pointing at them does not make sense either.</p>
<p>Members:</p>
<p>External (or public) functions have the following members:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">.address</span></code> returns the address of the contract of the function.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.selector</span></code> returns the <a class="reference internal" href="index.html#abi-function-selector"><span class="std std-ref">ABI function selector</span></a></p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>External (or public) functions used to have the additional members
<code class="docutils literal notranslate"><span class="pre">.gas(uint)</span></code> and <code class="docutils literal notranslate"><span class="pre">.value(uint)</span></code>. These were deprecated in Solidity 0.6.2
and removed in Solidity 0.7.0. Instead use <code class="docutils literal notranslate"><span class="pre">{gas:</span> <span class="pre">...}</span></code> and <code class="docutils literal notranslate"><span class="pre">{value:</span> <span class="pre">...}</span></code>
to specify the amount of gas or the amount of wei sent to a function,
respectively. See <a class="reference internal" href="index.html#external-function-calls"><span class="std std-ref">External Function Calls</span></a> for
more information.</p>
</div>
<p>Example that shows how to use the members:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC42LjQgPDAuOS4wOwoKY29udHJhY3QgRXhhbXBsZSB7CiAgICBmdW5jdGlvbiBmKCkgcHVibGljIHBheWFibGUgcmV0dXJucyAoYnl0ZXM0KSB7CiAgICAgICAgYXNzZXJ0KHRoaXMuZi5hZGRyZXNzID09IGFkZHJlc3ModGhpcykpOwogICAgICAgIHJldHVybiB0aGlzLmYuc2VsZWN0b3I7CiAgICB9CgogICAgZnVuY3Rpb24gZygpIHB1YmxpYyB7CiAgICAgICAgdGhpcy5me2dhczogMTAsIHZhbHVlOiA4MDB9KCk7CiAgICB9Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.6.4</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Example</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">f</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span>bytes4<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>assert<span class="p">(</span><span class="kt">this</span><span class="p">.</span>f<span class="p">.</span><span class="kt">address</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kt">address</span><span class="p">(</span><span class="kt">this</span><span class="p">));</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span><span class="kt">this</span><span class="p">.</span>f<span class="p">.</span>selector<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">g</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">this</span><span class="p">.</span>f<span class="p">{</span>gas<span class="p">:</span><span class="w"> </span><span class="m m-Decimal">10</span><span class="p">,</span><span class="w"> </span>value<span class="p">:</span><span class="w"> </span><span class="m m-Decimal">800</span><span class="p">}();</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Example that shows how to use internal function types:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC40LjE2IDwwLjkuMDsKCmxpYnJhcnkgQXJyYXlVdGlscyB7CiAgICAvLyBpbnRlcm5hbCBmdW5jdGlvbnMgY2FuIGJlIHVzZWQgaW4gaW50ZXJuYWwgbGlicmFyeSBmdW5jdGlvbnMgYmVjYXVzZQogICAgLy8gdGhleSB3aWxsIGJlIHBhcnQgb2YgdGhlIHNhbWUgY29kZSBjb250ZXh0CiAgICBmdW5jdGlvbiBtYXAodWludFtdIG1lbW9yeSBzZWxmLCBmdW5jdGlvbiAodWludCkgcHVyZSByZXR1cm5zICh1aW50KSBmKQogICAgICAgIGludGVybmFsCiAgICAgICAgcHVyZQogICAgICAgIHJldHVybnMgKHVpbnRbXSBtZW1vcnkgcikKICAgIHsKICAgICAgICByID0gbmV3IHVpbnRbXShzZWxmLmxlbmd0aCk7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgc2VsZi5sZW5ndGg7IGkrKykgewogICAgICAgICAgICByW2ldID0gZihzZWxmW2ldKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gcmVkdWNlKAogICAgICAgIHVpbnRbXSBtZW1vcnkgc2VsZiwKICAgICAgICBmdW5jdGlvbiAodWludCwgdWludCkgcHVyZSByZXR1cm5zICh1aW50KSBmCiAgICApCiAgICAgICAgaW50ZXJuYWwKICAgICAgICBwdXJlCiAgICAgICAgcmV0dXJucyAodWludCByKQogICAgewogICAgICAgIHIgPSBzZWxmWzBdOwogICAgICAgIGZvciAodWludCBpID0gMTsgaSA8IHNlbGYubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgciA9IGYociwgc2VsZltpXSk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHJhbmdlKHVpbnQgbGVuZ3RoKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnRbXSBtZW1vcnkgcikgewogICAgICAgIHIgPSBuZXcgdWludFtdKGxlbmd0aCk7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgci5sZW5ndGg7IGkrKykgewogICAgICAgICAgICByW2ldID0gaTsKICAgICAgICB9CiAgICB9Cn0KCgpjb250cmFjdCBQeXJhbWlkIHsKICAgIHVzaW5nIEFycmF5VXRpbHMgZm9yICo7CgogICAgZnVuY3Rpb24gcHlyYW1pZCh1aW50IGwpIHB1YmxpYyBwdXJlIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gQXJyYXlVdGlscy5yYW5nZShsKS5tYXAoc3F1YXJlKS5yZWR1Y2Uoc3VtKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzcXVhcmUodWludCB4KSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4geCAqIHg7CiAgICB9CgogICAgZnVuY3Rpb24gc3VtKHVpbnQgeCwgdWludCB5KSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4geCArIHk7CiAgICB9Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.4.16</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="kt">library</span><span class="w"> </span>ArrayUtils<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// internal functions can be used in internal library functions because</span>
<span class="w">    </span><span class="c1">// they will be part of the same code context</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">map</span><span class="p">(</span><span class="kt">uint</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>self<span class="p">,</span><span class="w"> </span><span class="kt">function</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span>f<span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="kt">internal</span><span class="w"></span>
<span class="w">        </span>pure<span class="w"></span>
<span class="w">        </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>r<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>r<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="kt">uint</span><span class="p">[](</span>self<span class="p">.</span>length<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">for</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span><span class="w"> </span>i<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>self<span class="p">.</span>length<span class="p">;</span><span class="w"> </span>i<span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span>r<span class="p">[</span>i<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>f<span class="p">(</span>self<span class="p">[</span>i<span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">reduce</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>self<span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span>f<span class="w"></span>
<span class="w">    </span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="kt">internal</span><span class="w"></span>
<span class="w">        </span>pure<span class="w"></span>
<span class="w">        </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">r</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>r<span class="w"> </span><span class="o">=</span><span class="w"> </span>self<span class="p">[</span><span class="m m-Decimal">0</span><span class="p">];</span><span class="w"></span>
<span class="w">        </span><span class="kt">for</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">;</span><span class="w"> </span>i<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>self<span class="p">.</span>length<span class="p">;</span><span class="w"> </span>i<span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span>r<span class="w"> </span><span class="o">=</span><span class="w"> </span>f<span class="p">(</span>r<span class="p">,</span><span class="w"> </span>self<span class="p">[</span>i<span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">range</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">length</span><span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>r<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>r<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="kt">uint</span><span class="p">[](</span>length<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">for</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span><span class="w"> </span>i<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>r<span class="p">.</span>length<span class="p">;</span><span class="w"> </span>i<span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span>r<span class="p">[</span>i<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>i<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>


<span class="k">contract</span><span class="w"> </span><span class="ni">Pyramid</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span>using<span class="w"> </span>ArrayUtils<span class="w"> </span><span class="kt">for</span><span class="w"> </span><span class="o">*</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">pyramid</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">l</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>ArrayUtils<span class="p">.</span>range<span class="p">(</span>l<span class="p">).</span>map<span class="p">(</span>square<span class="p">).</span>reduce<span class="p">(</span>sum<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">square</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">x</span><span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>x<span class="w"> </span><span class="o">*</span><span class="w"> </span>x<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">sum</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">x</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">y</span><span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>x<span class="w"> </span><span class="o">+</span><span class="w"> </span>y<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Another example that uses external function types:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC40LjIyIDwwLjkuMDsKCgpjb250cmFjdCBPcmFjbGUgewogICAgc3RydWN0IFJlcXVlc3QgewogICAgICAgIGJ5dGVzIGRhdGE7CiAgICAgICAgZnVuY3Rpb24odWludCkgZXh0ZXJuYWwgY2FsbGJhY2s7CiAgICB9CgogICAgUmVxdWVzdFtdIHByaXZhdGUgcmVxdWVzdHM7CiAgICBldmVudCBOZXdSZXF1ZXN0KHVpbnQpOwoKICAgIGZ1bmN0aW9uIHF1ZXJ5KGJ5dGVzIG1lbW9yeSBkYXRhLCBmdW5jdGlvbih1aW50KSBleHRlcm5hbCBjYWxsYmFjaykgcHVibGljIHsKICAgICAgICByZXF1ZXN0cy5wdXNoKFJlcXVlc3QoZGF0YSwgY2FsbGJhY2spKTsKICAgICAgICBlbWl0IE5ld1JlcXVlc3QocmVxdWVzdHMubGVuZ3RoIC0gMSk7CiAgICB9CgogICAgZnVuY3Rpb24gcmVwbHkodWludCByZXF1ZXN0SUQsIHVpbnQgcmVzcG9uc2UpIHB1YmxpYyB7CiAgICAgICAgLy8gSGVyZSBnb2VzIHRoZSBjaGVjayB0aGF0IHRoZSByZXBseSBjb21lcyBmcm9tIGEgdHJ1c3RlZCBzb3VyY2UKICAgICAgICByZXF1ZXN0c1tyZXF1ZXN0SURdLmNhbGxiYWNrKHJlc3BvbnNlKTsKICAgIH0KfQoKCmNvbnRyYWN0IE9yYWNsZVVzZXIgewogICAgT3JhY2xlIGNvbnN0YW50IHByaXZhdGUgT1JBQ0xFX0NPTlNUID0gT3JhY2xlKGFkZHJlc3MoMHgwMDAwMDAwMDIxOWFiNTQwMzU2Y0JCODM5Q2JlMDUzMDNkNzcwNUZhKSk7IC8vIGtub3duIGNvbnRyYWN0CiAgICB1aW50IHByaXZhdGUgZXhjaGFuZ2VSYXRlOwoKICAgIGZ1bmN0aW9uIGJ1eVNvbWV0aGluZygpIHB1YmxpYyB7CiAgICAgICAgT1JBQ0xFX0NPTlNULnF1ZXJ5KCJVU0QiLCB0aGlzLm9yYWNsZVJlc3BvbnNlKTsKICAgIH0KCiAgICBmdW5jdGlvbiBvcmFjbGVSZXNwb25zZSh1aW50IHJlc3BvbnNlKSBwdWJsaWMgewogICAgICAgIHJlcXVpcmUoCiAgICAgICAgICAgIG1zZy5zZW5kZXIgPT0gYWRkcmVzcyhPUkFDTEVfQ09OU1QpLAogICAgICAgICAgICAiT25seSBvcmFjbGUgY2FuIGNhbGwgdGhpcy4iCiAgICAgICAgKTsKICAgICAgICBleGNoYW5nZVJhdGUgPSByZXNwb25zZTsKICAgIH0KfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.4.22</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>


<span class="k">contract</span><span class="w"> </span><span class="ni">Oracle</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">struct</span><span class="w"> </span><span class="nv">Request</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">bytes</span><span class="w"> </span><span class="nv">data</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">function</span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>callback<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span>Request<span class="p">[]</span><span class="w"> </span><span class="kt">private</span><span class="w"> </span>requests<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">NewRequest</span><span class="p">(</span><span class="kt">uint</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">query</span><span class="p">(</span><span class="kt">bytes</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>data<span class="p">,</span><span class="w"> </span><span class="kt">function</span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>callback<span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>requests<span class="p">.</span>push<span class="p">(</span>Request<span class="p">(</span>data<span class="p">,</span><span class="w"> </span>callback<span class="p">));</span><span class="w"></span>
<span class="w">        </span>emit<span class="w"> </span>NewRequest<span class="p">(</span>requests<span class="p">.</span>length<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">reply</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">requestID</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">response</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Here goes the check that the reply comes from a trusted source</span>
<span class="w">        </span>requests<span class="p">[</span>requestID<span class="p">].</span>callback<span class="p">(</span>response<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>


<span class="k">contract</span><span class="w"> </span><span class="ni">OracleUser</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span>Oracle<span class="w"> </span><span class="kt">constant</span><span class="w"> </span><span class="kt">private</span><span class="w"> </span>ORACLE_CONST<span class="w"> </span><span class="o">=</span><span class="w"> </span>Oracle<span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="mh">0x00000000219ab540356cBB839Cbe05303d7705Fa</span><span class="p">));</span><span class="w"> </span><span class="c1">// known contract</span>
<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="k">private </span><span class="nv">exchangeRate</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">buySomething</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>ORACLE_CONST<span class="p">.</span>query<span class="p">(</span><span class="s2">&quot;USD&quot;</span><span class="p">,</span><span class="w"> </span><span class="kt">this</span><span class="p">.</span>oracleResponse<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">oracleResponse</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">response</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span><span class="w"></span>
<span class="w">            </span><span class="k">msg.sender</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kt">address</span><span class="p">(</span>ORACLE_CONST<span class="p">),</span><span class="w"></span>
<span class="w">            </span><span class="s2">&quot;Only oracle can call this.&quot;</span><span class="w"></span>
<span class="w">        </span><span class="p">);</span><span class="w"></span>
<span class="w">        </span>exchangeRate<span class="w"> </span><span class="o">=</span><span class="w"> </span>response<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Lambda or inline functions are planned but not yet supported.</p>
</div>
</section>
</section>
<section id="reference-types">
<span id="index-15"></span><span id="id11"></span><h3>Reference Types<a class="headerlink" href="#reference-types" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Values of reference type can be modified through multiple different names.
Contrast this with value types where you get an independent copy whenever
a variable of value type is used. Because of that, reference types have to be handled
more carefully than value types. Currently, reference types comprise structs,
arrays and mappings. If you use a reference type, you always have to explicitly
provide the data area where the type is stored: <code class="docutils literal notranslate"><span class="pre">memory</span></code> (whose lifetime is limited
to an external function call), <code class="docutils literal notranslate"><span class="pre">storage</span></code> (the location where the state variables
are stored, where the lifetime is limited to the lifetime of a contract)
or <code class="docutils literal notranslate"><span class="pre">calldata</span></code> (special data location that contains the function arguments).</p>
<p>An assignment or type conversion that changes the data location will always incur an automatic copy operation,
while assignments inside the same data location only copy in some cases for storage types.</p>
<section id="data-location">
<span id="id12"></span><h4>Data location<a class="headerlink" href="#data-location" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Every reference type has an additional
annotation, the ‚Äúdata location‚Äù, about where it is stored. There are three data locations:
<code class="docutils literal notranslate"><span class="pre">memory</span></code>, <code class="docutils literal notranslate"><span class="pre">storage</span></code> and <code class="docutils literal notranslate"><span class="pre">calldata</span></code>. Calldata is a non-modifiable,
non-persistent area where function arguments are stored, and behaves mostly like memory.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you can, try to use <code class="docutils literal notranslate"><span class="pre">calldata</span></code> as data location because it will avoid copies and
also makes sure that the data cannot be modified. Arrays and structs with <code class="docutils literal notranslate"><span class="pre">calldata</span></code>
data location can also be returned from functions, but it is not possible to
allocate such types.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Prior to version 0.6.9 data location for reference-type arguments was limited to
<code class="docutils literal notranslate"><span class="pre">calldata</span></code> in external functions, <code class="docutils literal notranslate"><span class="pre">memory</span></code> in public functions and either
<code class="docutils literal notranslate"><span class="pre">memory</span></code> or <code class="docutils literal notranslate"><span class="pre">storage</span></code> in internal and private ones.
Now <code class="docutils literal notranslate"><span class="pre">memory</span></code> and <code class="docutils literal notranslate"><span class="pre">calldata</span></code> are allowed in all functions regardless of their visibility.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Prior to version 0.5.0 the data location could be omitted, and would default to different locations
depending on the kind of variable, function type, etc., but all complex types must now give an explicit
data location.</p>
</div>
<section id="data-location-and-assignment-behaviour">
<span id="data-location-assignment"></span><h5>Data location and assignment behaviour<a class="headerlink" href="#data-location-and-assignment-behaviour" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>Data locations are not only relevant for persistency of data, but also for the semantics of assignments:</p>
<ul class="simple">
<li><p>Assignments between <code class="docutils literal notranslate"><span class="pre">storage</span></code> and <code class="docutils literal notranslate"><span class="pre">memory</span></code> (or from <code class="docutils literal notranslate"><span class="pre">calldata</span></code>)
always create an independent copy.</p></li>
<li><p>Assignments from <code class="docutils literal notranslate"><span class="pre">memory</span></code> to <code class="docutils literal notranslate"><span class="pre">memory</span></code> only create references. This means
that changes to one memory variable are also visible in all other memory
variables that refer to the same data.</p></li>
<li><p>Assignments from <code class="docutils literal notranslate"><span class="pre">storage</span></code> to a <strong>local</strong> storage variable also only
assign a reference.</p></li>
<li><p>All other assignments to <code class="docutils literal notranslate"><span class="pre">storage</span></code> always copy. Examples for this
case are assignments to state variables or to members of local
variables of storage struct type, even if the local variable
itself is just a reference.</p></li>
</ul>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC41LjAgPDAuOS4wOwoKY29udHJhY3QgQyB7CiAgICAvLyBUaGUgZGF0YSBsb2NhdGlvbiBvZiB4IGlzIHN0b3JhZ2UuCiAgICAvLyBUaGlzIGlzIHRoZSBvbmx5IHBsYWNlIHdoZXJlIHRoZQogICAgLy8gZGF0YSBsb2NhdGlvbiBjYW4gYmUgb21pdHRlZC4KICAgIHVpbnRbXSB4OwoKICAgIC8vIFRoZSBkYXRhIGxvY2F0aW9uIG9mIG1lbW9yeUFycmF5IGlzIG1lbW9yeS4KICAgIGZ1bmN0aW9uIGYodWludFtdIG1lbW9yeSBtZW1vcnlBcnJheSkgcHVibGljIHsKICAgICAgICB4ID0gbWVtb3J5QXJyYXk7IC8vIHdvcmtzLCBjb3BpZXMgdGhlIHdob2xlIGFycmF5IHRvIHN0b3JhZ2UKICAgICAgICB1aW50W10gc3RvcmFnZSB5ID0geDsgLy8gd29ya3MsIGFzc2lnbnMgYSBwb2ludGVyLCBkYXRhIGxvY2F0aW9uIG9mIHkgaXMgc3RvcmFnZQogICAgICAgIHlbN107IC8vIGZpbmUsIHJldHVybnMgdGhlIDh0aCBlbGVtZW50CiAgICAgICAgeS5wb3AoKTsgLy8gZmluZSwgbW9kaWZpZXMgeCB0aHJvdWdoIHkKICAgICAgICBkZWxldGUgeDsgLy8gZmluZSwgY2xlYXJzIHRoZSBhcnJheSwgYWxzbyBtb2RpZmllcyB5CiAgICAgICAgLy8gVGhlIGZvbGxvd2luZyBkb2VzIG5vdCB3b3JrOyBpdCB3b3VsZCBuZWVkIHRvIGNyZWF0ZSBhIG5ldyB0ZW1wb3JhcnkgLwogICAgICAgIC8vIHVubmFtZWQgYXJyYXkgaW4gc3RvcmFnZSwgYnV0IHN0b3JhZ2UgaXMgInN0YXRpY2FsbHkiIGFsbG9jYXRlZDoKICAgICAgICAvLyB5ID0gbWVtb3J5QXJyYXk7CiAgICAgICAgLy8gVGhpcyBkb2VzIG5vdCB3b3JrIGVpdGhlciwgc2luY2UgaXQgd291bGQgInJlc2V0IiB0aGUgcG9pbnRlciwgYnV0IHRoZXJlCiAgICAgICAgLy8gaXMgbm8gc2Vuc2libGUgbG9jYXRpb24gaXQgY291bGQgcG9pbnQgdG8uCiAgICAgICAgLy8gZGVsZXRlIHk7CiAgICAgICAgZyh4KTsgLy8gY2FsbHMgZywgaGFuZGluZyBvdmVyIGEgcmVmZXJlbmNlIHRvIHgKICAgICAgICBoKHgpOyAvLyBjYWxscyBoIGFuZCBjcmVhdGVzIGFuIGluZGVwZW5kZW50LCB0ZW1wb3JhcnkgY29weSBpbiBtZW1vcnkKICAgIH0KCiAgICBmdW5jdGlvbiBnKHVpbnRbXSBzdG9yYWdlKSBpbnRlcm5hbCBwdXJlIHt9CiAgICBmdW5jdGlvbiBoKHVpbnRbXSBtZW1vcnkpIHB1YmxpYyBwdXJlIHt9Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.5.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">C</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// The data location of x is storage.</span>
<span class="w">    </span><span class="c1">// This is the only place where the</span>
<span class="w">    </span><span class="c1">// data location can be omitted.</span>
<span class="w">    </span><span class="kt">uint</span><span class="p">[]</span><span class="w"> </span>x<span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// The data location of memoryArray is memory.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">f</span><span class="p">(</span><span class="kt">uint</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>memoryArray<span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>x<span class="w"> </span><span class="o">=</span><span class="w"> </span>memoryArray<span class="p">;</span><span class="w"> </span><span class="c1">// works, copies the whole array to storage</span>
<span class="w">        </span><span class="kt">uint</span><span class="p">[]</span><span class="w"> </span>storage<span class="w"> </span>y<span class="w"> </span><span class="o">=</span><span class="w"> </span>x<span class="p">;</span><span class="w"> </span><span class="c1">// works, assigns a pointer, data location of y is storage</span>
<span class="w">        </span>y<span class="p">[</span><span class="m m-Decimal">7</span><span class="p">];</span><span class="w"> </span><span class="c1">// fine, returns the 8th element</span>
<span class="w">        </span>y<span class="p">.</span>pop<span class="p">();</span><span class="w"> </span><span class="c1">// fine, modifies x through y</span>
<span class="w">        </span>delete<span class="w"> </span>x<span class="p">;</span><span class="w"> </span><span class="c1">// fine, clears the array, also modifies y</span>
<span class="w">        </span><span class="c1">// The following does not work; it would need to create a new temporary /</span>
<span class="w">        </span><span class="c1">// unnamed array in storage, but storage is &quot;statically&quot; allocated:</span>
<span class="w">        </span><span class="c1">// y = memoryArray;</span>
<span class="w">        </span><span class="c1">// This does not work either, since it would &quot;reset&quot; the pointer, but there</span>
<span class="w">        </span><span class="c1">// is no sensible location it could point to.</span>
<span class="w">        </span><span class="c1">// delete y;</span>
<span class="w">        </span>g<span class="p">(</span>x<span class="p">);</span><span class="w"> </span><span class="c1">// calls g, handing over a reference to x</span>
<span class="w">        </span>h<span class="p">(</span>x<span class="p">);</span><span class="w"> </span><span class="c1">// calls h and creates an independent, temporary copy in memory</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">g</span><span class="p">(</span><span class="kt">uint</span><span class="p">[]</span><span class="w"> </span>storage<span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>pure<span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">h</span><span class="p">(</span><span class="kt">uint</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>pure<span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
<section id="arrays">
<span id="index-16"></span><span id="id13"></span><h4>Arrays<a class="headerlink" href="#arrays" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Arrays can have a compile-time fixed size, or they can have a dynamic size.</p>
<p>The type of an array of fixed size <code class="docutils literal notranslate"><span class="pre">k</span></code> and element type <code class="docutils literal notranslate"><span class="pre">T</span></code> is written as <code class="docutils literal notranslate"><span class="pre">T[k]</span></code>,
and an array of dynamic size as <code class="docutils literal notranslate"><span class="pre">T[]</span></code>.</p>
<p>For example, an array of 5 dynamic arrays of <code class="docutils literal notranslate"><span class="pre">uint</span></code> is written as
<code class="docutils literal notranslate"><span class="pre">uint[][5]</span></code>. The notation is reversed compared to some other languages. In
Solidity, <code class="docutils literal notranslate"><span class="pre">X[3]</span></code> is always an array containing three elements of type <code class="docutils literal notranslate"><span class="pre">X</span></code>,
even if <code class="docutils literal notranslate"><span class="pre">X</span></code> is itself an array. This is not the case in other languages such
as C.</p>
<p>Indices are zero-based, and access is in the opposite direction of the
declaration.</p>
<p>For example, if you have a variable <code class="docutils literal notranslate"><span class="pre">uint[][5]</span> <span class="pre">memory</span> <span class="pre">x</span></code>, you access the
seventh <code class="docutils literal notranslate"><span class="pre">uint</span></code> in the third dynamic array using <code class="docutils literal notranslate"><span class="pre">x[2][6]</span></code>, and to access the
third dynamic array, use <code class="docutils literal notranslate"><span class="pre">x[2]</span></code>. Again,
if you have an array <code class="docutils literal notranslate"><span class="pre">T[5]</span> <span class="pre">a</span></code> for a type <code class="docutils literal notranslate"><span class="pre">T</span></code> that can also be an array,
then <code class="docutils literal notranslate"><span class="pre">a[2]</span></code> always has type <code class="docutils literal notranslate"><span class="pre">T</span></code>.</p>
<p>Array elements can be of any type, including mapping or struct. The general
restrictions for types apply, in that mappings can only be stored in the
<code class="docutils literal notranslate"><span class="pre">storage</span></code> data location and publicly-visible functions need parameters that are <a class="reference internal" href="index.html#abi"><span class="std std-ref">ABI types</span></a>.</p>
<p>It is possible to mark state variable arrays <code class="docutils literal notranslate"><span class="pre">public</span></code> and have Solidity create a <a class="reference internal" href="index.html#visibility-and-getters"><span class="std std-ref">getter</span></a>.
The numeric index becomes a required parameter for the getter.</p>
<p>Accessing an array past its end causes a failing assertion. Methods <code class="docutils literal notranslate"><span class="pre">.push()</span></code> and <code class="docutils literal notranslate"><span class="pre">.push(value)</span></code> can be used
to append a new element at the end of the array, where <code class="docutils literal notranslate"><span class="pre">.push()</span></code> appends a zero-initialized element and returns
a reference to it.</p>
<section id="bytes-and-string-as-arrays">
<span id="bytes"></span><span id="strings"></span><span id="index-17"></span><h5><code class="docutils literal notranslate"><span class="pre">bytes</span></code> and <code class="docutils literal notranslate"><span class="pre">string</span></code> as Arrays<a class="headerlink" href="#bytes-and-string-as-arrays" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>Variables of type <code class="docutils literal notranslate"><span class="pre">bytes</span></code> and <code class="docutils literal notranslate"><span class="pre">string</span></code> are special arrays. The <code class="docutils literal notranslate"><span class="pre">bytes</span></code> type is similar to <code class="docutils literal notranslate"><span class="pre">bytes1[]</span></code>,
but it is packed tightly in calldata and memory. <code class="docutils literal notranslate"><span class="pre">string</span></code> is equal to <code class="docutils literal notranslate"><span class="pre">bytes</span></code> but does not allow
length or index access.</p>
<p>Solidity does not have string manipulation functions, but there are
third-party string libraries. You can also compare two strings by their keccak256-hash using
<code class="docutils literal notranslate"><span class="pre">keccak256(abi.encodePacked(s1))</span> <span class="pre">==</span> <span class="pre">keccak256(abi.encodePacked(s2))</span></code> and
concatenate two strings using <code class="docutils literal notranslate"><span class="pre">string.concat(s1,</span> <span class="pre">s2)</span></code>.</p>
<p>You should use <code class="docutils literal notranslate"><span class="pre">bytes</span></code> over <code class="docutils literal notranslate"><span class="pre">bytes1[]</span></code> because it is cheaper,
since using <code class="docutils literal notranslate"><span class="pre">bytes1[]</span></code> in <code class="docutils literal notranslate"><span class="pre">memory</span></code> adds 31 padding bytes between the elements. Note that in <code class="docutils literal notranslate"><span class="pre">storage</span></code>, the
padding is absent due to tight packing, see <a class="reference internal" href="index.html#bytes-and-string"><span class="std std-ref">bytes and string</span></a>. As a general rule,
use <code class="docutils literal notranslate"><span class="pre">bytes</span></code> for arbitrary-length raw byte data and <code class="docutils literal notranslate"><span class="pre">string</span></code> for arbitrary-length
string (UTF-8) data. If you can limit the length to a certain number of bytes,
always use one of the value types <code class="docutils literal notranslate"><span class="pre">bytes1</span></code> to <code class="docutils literal notranslate"><span class="pre">bytes32</span></code> because they are much cheaper.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you want to access the byte-representation of a string <code class="docutils literal notranslate"><span class="pre">s</span></code>, use
<code class="docutils literal notranslate"><span class="pre">bytes(s).length</span></code> / <code class="docutils literal notranslate"><span class="pre">bytes(s)[7]</span> <span class="pre">=</span> <span class="pre">'x';</span></code>. Keep in mind
that you are accessing the low-level bytes of the UTF-8 representation,
and not the individual characters.</p>
</div>
</section>
<section id="the-functions-bytes-concat-and-string-concat">
<span id="string-concat"></span><span id="bytes-concat"></span><span id="index-18"></span><h5>The functions <code class="docutils literal notranslate"><span class="pre">bytes.concat</span></code> and <code class="docutils literal notranslate"><span class="pre">string.concat</span></code><a class="headerlink" href="#the-functions-bytes-concat-and-string-concat" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>You can concatenate an arbitrary number of <code class="docutils literal notranslate"><span class="pre">string</span></code> values using <code class="docutils literal notranslate"><span class="pre">string.concat</span></code>.
The function returns a single <code class="docutils literal notranslate"><span class="pre">string</span> <span class="pre">memory</span></code> array that contains the contents of the arguments without padding.
If you want to use parameters of other types that are not implicitly convertible to <code class="docutils literal notranslate"><span class="pre">string</span></code>, you need to convert them to <code class="docutils literal notranslate"><span class="pre">string</span></code> first.</p>
<p>Analogously, the <code class="docutils literal notranslate"><span class="pre">bytes.concat</span></code> function can concatenate an arbitrary number of <code class="docutils literal notranslate"><span class="pre">bytes</span></code> or <code class="docutils literal notranslate"><span class="pre">bytes1</span> <span class="pre">...</span> <span class="pre">bytes32</span></code> values.
The function returns a single <code class="docutils literal notranslate"><span class="pre">bytes</span> <span class="pre">memory</span></code> array that contains the contents of the arguments without padding.
If you want to use string parameters or other types that are not implicitly convertible to <code class="docutils literal notranslate"><span class="pre">bytes</span></code>, you need to convert them to <code class="docutils literal notranslate"><span class="pre">bytes</span></code> or <code class="docutils literal notranslate"><span class="pre">bytes1</span></code>/‚Ä¶/<code class="docutils literal notranslate"><span class="pre">bytes32</span></code> first.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5IF4wLjguMTI7Cgpjb250cmFjdCBDIHsKICAgIHN0cmluZyBzID0gIlN0b3JhZ2UiOwogICAgZnVuY3Rpb24gZihieXRlcyBjYWxsZGF0YSBiYywgc3RyaW5nIG1lbW9yeSBzbSwgYnl0ZXMxNiBiKSBwdWJsaWMgdmlldyB7CiAgICAgICAgc3RyaW5nIG1lbW9yeSBjb25jYXRTdHJpbmcgPSBzdHJpbmcuY29uY2F0KHMsIHN0cmluZyhiYyksICJMaXRlcmFsIiwgc20pOwogICAgICAgIGFzc2VydCgoYnl0ZXMocykubGVuZ3RoICsgYmMubGVuZ3RoICsgNyArIGJ5dGVzKHNtKS5sZW5ndGgpID09IGJ5dGVzKGNvbmNhdFN0cmluZykubGVuZ3RoKTsKCiAgICAgICAgYnl0ZXMgbWVtb3J5IGNvbmNhdEJ5dGVzID0gYnl0ZXMuY29uY2F0KGJ5dGVzKHMpLCBiYywgYmNbOjJdLCAiTGl0ZXJhbCIsIGJ5dGVzKHNtKSwgYik7CiAgICAgICAgYXNzZXJ0KChieXRlcyhzKS5sZW5ndGggKyBiYy5sZW5ndGggKyAyICsgNyArIGJ5dGVzKHNtKS5sZW5ndGggKyBiLmxlbmd0aCkgPT0gY29uY2F0Qnl0ZXMubGVuZ3RoKTsKICAgIH0KfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.8.12</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">C</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">string</span><span class="w"> </span><span class="nv">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Storage&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">f</span><span class="p">(</span><span class="kt">bytes</span><span class="w"> </span><span class="nv">calldata</span><span class="w"> </span>bc<span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>sm<span class="p">,</span><span class="w"> </span><span class="kt">bytes16</span><span class="w"> </span><span class="nv">b</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>view<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>concatString<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span><span class="p">.</span>concat<span class="p">(</span>s<span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="p">(</span>bc<span class="p">),</span><span class="w"> </span><span class="s2">&quot;Literal&quot;</span><span class="p">,</span><span class="w"> </span>sm<span class="p">);</span><span class="w"></span>
<span class="w">        </span>assert<span class="p">((</span><span class="kt">bytes</span><span class="p">(</span>s<span class="p">).</span>length<span class="w"> </span><span class="o">+</span><span class="w"> </span>bc<span class="p">.</span>length<span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m m-Decimal">7</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="kt">bytes</span><span class="p">(</span>sm<span class="p">).</span>length<span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kt">bytes</span><span class="p">(</span>concatString<span class="p">).</span>length<span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="kt">bytes</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>concatBytes<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">bytes</span><span class="p">.</span>concat<span class="p">(</span><span class="kt">bytes</span><span class="p">(</span>s<span class="p">),</span><span class="w"> </span>bc<span class="p">,</span><span class="w"> </span>bc<span class="p">[:</span><span class="m m-Decimal">2</span><span class="p">],</span><span class="w"> </span><span class="s2">&quot;Literal&quot;</span><span class="p">,</span><span class="w"> </span><span class="kt">bytes</span><span class="p">(</span>sm<span class="p">),</span><span class="w"> </span>b<span class="p">);</span><span class="w"></span>
<span class="w">        </span>assert<span class="p">((</span><span class="kt">bytes</span><span class="p">(</span>s<span class="p">).</span>length<span class="w"> </span><span class="o">+</span><span class="w"> </span>bc<span class="p">.</span>length<span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m m-Decimal">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m m-Decimal">7</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="kt">bytes</span><span class="p">(</span>sm<span class="p">).</span>length<span class="w"> </span><span class="o">+</span><span class="w"> </span>b<span class="p">.</span>length<span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>concatBytes<span class="p">.</span>length<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>If you call <code class="docutils literal notranslate"><span class="pre">string.concat</span></code> or <code class="docutils literal notranslate"><span class="pre">bytes.concat</span></code> without arguments they return an empty array.</p>
</section>
<section id="allocating-memory-arrays">
<span id="index-19"></span><h5>Allocating Memory Arrays<a class="headerlink" href="#allocating-memory-arrays" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>Memory arrays with dynamic length can be created using the <code class="docutils literal notranslate"><span class="pre">new</span></code> operator.
As opposed to storage arrays, it is <strong>not</strong> possible to resize memory arrays (e.g.
the <code class="docutils literal notranslate"><span class="pre">.push</span></code> member functions are not available).
You either have to calculate the required size in advance
or create a new memory array and copy every element.</p>
<p>As all variables in Solidity, the elements of newly allocated arrays are always initialized
with the <a class="reference internal" href="index.html#default-value"><span class="std std-ref">default value</span></a>.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC40LjE2IDwwLjkuMDsKCmNvbnRyYWN0IEMgewogICAgZnVuY3Rpb24gZih1aW50IGxlbikgcHVibGljIHB1cmUgewogICAgICAgIHVpbnRbXSBtZW1vcnkgYSA9IG5ldyB1aW50W10oNyk7CiAgICAgICAgYnl0ZXMgbWVtb3J5IGIgPSBuZXcgYnl0ZXMobGVuKTsKICAgICAgICBhc3NlcnQoYS5sZW5ndGggPT0gNyk7CiAgICAgICAgYXNzZXJ0KGIubGVuZ3RoID09IGxlbik7CiAgICAgICAgYVs2XSA9IDg7CiAgICB9Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.4.16</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">C</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">f</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">len</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>pure<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>a<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="kt">uint</span><span class="p">[](</span><span class="m m-Decimal">7</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">bytes</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>b<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="kt">bytes</span><span class="p">(</span>len<span class="p">);</span><span class="w"></span>
<span class="w">        </span>assert<span class="p">(</span>a<span class="p">.</span>length<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m m-Decimal">7</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span>assert<span class="p">(</span>b<span class="p">.</span>length<span class="w"> </span><span class="o">==</span><span class="w"> </span>len<span class="p">);</span><span class="w"></span>
<span class="w">        </span>a<span class="p">[</span><span class="m m-Decimal">6</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">8</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="array-literals">
<span id="index-20"></span><h5>Array Literals<a class="headerlink" href="#array-literals" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>An array literal is a comma-separated list of one or more expressions, enclosed
in square brackets (<code class="docutils literal notranslate"><span class="pre">[...]</span></code>). For example <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">a,</span> <span class="pre">f(3)]</span></code>. The type of the
array literal is determined as follows:</p>
<p>It is always a statically-sized memory array whose length is the
number of expressions.</p>
<p>The base type of the array is the type of the first expression on the list such that all
other expressions can be implicitly converted to it. It is a type error
if this is not possible.</p>
<p>It is not enough that there is a type all the elements can be converted to. One of the elements
has to be of that type.</p>
<p>In the example below, the type of <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">2,</span> <span class="pre">3]</span></code> is
<code class="docutils literal notranslate"><span class="pre">uint8[3]</span> <span class="pre">memory</span></code>, because the type of each of these constants is <code class="docutils literal notranslate"><span class="pre">uint8</span></code>. If
you want the result to be a <code class="docutils literal notranslate"><span class="pre">uint[3]</span> <span class="pre">memory</span></code> type, you need to convert
the first element to <code class="docutils literal notranslate"><span class="pre">uint</span></code>.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC40LjE2IDwwLjkuMDsKCmNvbnRyYWN0IEMgewogICAgZnVuY3Rpb24gZigpIHB1YmxpYyBwdXJlIHsKICAgICAgICBnKFt1aW50KDEpLCAyLCAzXSk7CiAgICB9CiAgICBmdW5jdGlvbiBnKHVpbnRbM10gbWVtb3J5KSBwdWJsaWMgcHVyZSB7CiAgICAgICAgLy8gLi4uCiAgICB9Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.4.16</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">C</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">f</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>pure<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>g<span class="p">([</span><span class="kt">uint</span><span class="p">(</span><span class="m m-Decimal">1</span><span class="p">),</span><span class="w"> </span><span class="m m-Decimal">2</span><span class="p">,</span><span class="w"> </span><span class="m m-Decimal">3</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">g</span><span class="p">(</span><span class="kt">uint</span><span class="p">[</span><span class="m m-Decimal">3</span><span class="p">]</span><span class="w"> </span><span class="kt">memory</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>pure<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// ...</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>The array literal <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">-1]</span></code> is invalid because the type of the first expression
is <code class="docutils literal notranslate"><span class="pre">uint8</span></code> while the type of the second is <code class="docutils literal notranslate"><span class="pre">int8</span></code> and they cannot be implicitly
converted to each other. To make it work, you can use <code class="docutils literal notranslate"><span class="pre">[int8(1),</span> <span class="pre">-1]</span></code>, for example.</p>
<p>Since fixed-size memory arrays of different type cannot be converted into each other
(even if the base types can), you always have to specify a common base type explicitly
if you want to use two-dimensional array literals:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC40LjE2IDwwLjkuMDsKCmNvbnRyYWN0IEMgewogICAgZnVuY3Rpb24gZigpIHB1YmxpYyBwdXJlIHJldHVybnMgKHVpbnQyNFsyXVs0XSBtZW1vcnkpIHsKICAgICAgICB1aW50MjRbMl1bNF0gbWVtb3J5IHggPSBbW3VpbnQyNCgweDEpLCAxXSwgWzB4ZmZmZmZmLCAyXSwgW3VpbnQyNCgweGZmKSwgM10sIFt1aW50MjQoMHhmZmZmKSwgNF1dOwogICAgICAgIC8vIFRoZSBmb2xsb3dpbmcgZG9lcyBub3Qgd29yaywgYmVjYXVzZSBzb21lIG9mIHRoZSBpbm5lciBhcnJheXMgYXJlIG5vdCBvZiB0aGUgcmlnaHQgdHlwZS4KICAgICAgICAvLyB1aW50WzJdWzRdIG1lbW9yeSB4ID0gW1sweDEsIDFdLCBbMHhmZmZmZmYsIDJdLCBbMHhmZiwgM10sIFsweGZmZmYsIDRdXTsKICAgICAgICByZXR1cm4geDsKICAgIH0KfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.4.16</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">C</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">f</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint24</span><span class="p">[</span><span class="m m-Decimal">2</span><span class="p">][</span><span class="m m-Decimal">4</span><span class="p">]</span><span class="w"> </span><span class="kt">memory</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint24</span><span class="p">[</span><span class="m m-Decimal">2</span><span class="p">][</span><span class="m m-Decimal">4</span><span class="p">]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>x<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[[</span><span class="kt">uint24</span><span class="p">(</span><span class="mh">0x1</span><span class="p">),</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="mh">0xffffff</span><span class="p">,</span><span class="w"> </span><span class="m m-Decimal">2</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="kt">uint24</span><span class="p">(</span><span class="mh">0xff</span><span class="p">),</span><span class="w"> </span><span class="m m-Decimal">3</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="kt">uint24</span><span class="p">(</span><span class="mh">0xffff</span><span class="p">),</span><span class="w"> </span><span class="m m-Decimal">4</span><span class="p">]];</span><span class="w"></span>
<span class="w">        </span><span class="c1">// The following does not work, because some of the inner arrays are not of the right type.</span>
<span class="w">        </span><span class="c1">// uint[2][4] memory x = [[0x1, 1], [0xffffff, 2], [0xff, 3], [0xffff, 4]];</span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>x<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Fixed size memory arrays cannot be assigned to dynamically-sized
memory arrays, i.e. the following is not possible:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC40LjAgPDAuOS4wOwoKLy8gVGhpcyB3aWxsIG5vdCBjb21waWxlLgpjb250cmFjdCBDIHsKICAgIGZ1bmN0aW9uIGYoKSBwdWJsaWMgewogICAgICAgIC8vIFRoZSBuZXh0IGxpbmUgY3JlYXRlcyBhIHR5cGUgZXJyb3IgYmVjYXVzZSB1aW50WzNdIG1lbW9yeQogICAgICAgIC8vIGNhbm5vdCBiZSBjb252ZXJ0ZWQgdG8gdWludFtdIG1lbW9yeS4KICAgICAgICB1aW50W10gbWVtb3J5IHggPSBbdWludCgxKSwgMywgNF07CiAgICB9Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.4.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="c1">// This will not compile.</span>
<span class="k">contract</span><span class="w"> </span><span class="ni">C</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">f</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// The next line creates a type error because uint[3] memory</span>
<span class="w">        </span><span class="c1">// cannot be converted to uint[] memory.</span>
<span class="w">        </span><span class="kt">uint</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>x<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="kt">uint</span><span class="p">(</span><span class="m m-Decimal">1</span><span class="p">),</span><span class="w"> </span><span class="m m-Decimal">3</span><span class="p">,</span><span class="w"> </span><span class="m m-Decimal">4</span><span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>It is planned to remove this restriction in the future, but it creates some
complications because of how arrays are passed in the ABI.</p>
<p>If you want to initialize dynamically-sized arrays, you have to assign the
individual elements:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC40LjE2IDwwLjkuMDsKCmNvbnRyYWN0IEMgewogICAgZnVuY3Rpb24gZigpIHB1YmxpYyBwdXJlIHsKICAgICAgICB1aW50W10gbWVtb3J5IHggPSBuZXcgdWludFtdKDMpOwogICAgICAgIHhbMF0gPSAxOwogICAgICAgIHhbMV0gPSAzOwogICAgICAgIHhbMl0gPSA0OwogICAgfQp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.4.16</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">C</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">f</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>pure<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>x<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="kt">uint</span><span class="p">[](</span><span class="m m-Decimal">3</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span>x<span class="p">[</span><span class="m m-Decimal">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span>x<span class="p">[</span><span class="m m-Decimal">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">3</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span>x<span class="p">[</span><span class="m m-Decimal">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">4</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="array-members">
<span id="index-21"></span><span id="id14"></span><h5>Array Members<a class="headerlink" href="#array-members" title="Permalink to this heading">ÔÉÅ</a></h5>
<dl class="simple">
<dt><strong>length</strong>:</dt><dd><p>Arrays have a <code class="docutils literal notranslate"><span class="pre">length</span></code> member that contains their number of elements.
The length of memory arrays is fixed (but dynamic, i.e. it can depend on
runtime parameters) once they are created.</p>
</dd>
<dt><strong>push()</strong>:</dt><dd><p>Dynamic storage arrays and <code class="docutils literal notranslate"><span class="pre">bytes</span></code> (not <code class="docutils literal notranslate"><span class="pre">string</span></code>) have a member function
called <code class="docutils literal notranslate"><span class="pre">push()</span></code> that you can use to append a zero-initialised element at the end of the array.
It returns a reference to the element, so that it can be used like
<code class="docutils literal notranslate"><span class="pre">x.push().t</span> <span class="pre">=</span> <span class="pre">2</span></code> or <code class="docutils literal notranslate"><span class="pre">x.push()</span> <span class="pre">=</span> <span class="pre">b</span></code>.</p>
</dd>
<dt><strong>push(x)</strong>:</dt><dd><p>Dynamic storage arrays and <code class="docutils literal notranslate"><span class="pre">bytes</span></code> (not <code class="docutils literal notranslate"><span class="pre">string</span></code>) have a member function
called <code class="docutils literal notranslate"><span class="pre">push(x)</span></code> that you can use to append a given element at the end of the array.
The function returns nothing.</p>
</dd>
<dt><strong>pop()</strong>:</dt><dd><p>Dynamic storage arrays and <code class="docutils literal notranslate"><span class="pre">bytes</span></code> (not <code class="docutils literal notranslate"><span class="pre">string</span></code>) have a member
function called <code class="docutils literal notranslate"><span class="pre">pop()</span></code> that you can use to remove an element from the
end of the array. This also implicitly calls <a class="reference internal" href="#delete"><span class="std std-ref">delete</span></a> on the removed element. The function returns nothing.</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Increasing the length of a storage array by calling <code class="docutils literal notranslate"><span class="pre">push()</span></code>
has constant gas costs because storage is zero-initialised,
while decreasing the length by calling <code class="docutils literal notranslate"><span class="pre">pop()</span></code> has a
cost that depends on the ‚Äúsize‚Äù of the element being removed.
If that element is an array, it can be very costly, because
it includes explicitly clearing the removed
elements similar to calling <a class="reference internal" href="#delete"><span class="std std-ref">delete</span></a> on them.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To use arrays of arrays in external (instead of public) functions, you need to
activate ABI coder v2.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In EVM versions before Byzantium, it was not possible to access
dynamic arrays return from function calls. If you call functions
that return dynamic arrays, make sure to use an EVM that is set to
Byzantium mode.</p>
</div>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC42LjAgPDAuOS4wOwoKY29udHJhY3QgQXJyYXlDb250cmFjdCB7CiAgICB1aW50WzIqKjIwXSBhTG90T2ZJbnRlZ2VyczsKICAgIC8vIE5vdGUgdGhhdCB0aGUgZm9sbG93aW5nIGlzIG5vdCBhIHBhaXIgb2YgZHluYW1pYyBhcnJheXMgYnV0IGEKICAgIC8vIGR5bmFtaWMgYXJyYXkgb2YgcGFpcnMgKGkuZS4gb2YgZml4ZWQgc2l6ZSBhcnJheXMgb2YgbGVuZ3RoIHR3bykuCiAgICAvLyBCZWNhdXNlIG9mIHRoYXQsIFRbXSBpcyBhbHdheXMgYSBkeW5hbWljIGFycmF5IG9mIFQsIGV2ZW4gaWYgVAogICAgLy8gaXRzZWxmIGlzIGFuIGFycmF5LgogICAgLy8gRGF0YSBsb2NhdGlvbiBmb3IgYWxsIHN0YXRlIHZhcmlhYmxlcyBpcyBzdG9yYWdlLgogICAgYm9vbFsyXVtdIHBhaXJzT2ZGbGFnczsKCiAgICAvLyBuZXdQYWlycyBpcyBzdG9yZWQgaW4gbWVtb3J5IC0gdGhlIG9ubHkgcG9zc2liaWxpdHkKICAgIC8vIGZvciBwdWJsaWMgY29udHJhY3QgZnVuY3Rpb24gYXJndW1lbnRzCiAgICBmdW5jdGlvbiBzZXRBbGxGbGFnUGFpcnMoYm9vbFsyXVtdIG1lbW9yeSBuZXdQYWlycykgcHVibGljIHsKICAgICAgICAvLyBhc3NpZ25tZW50IHRvIGEgc3RvcmFnZSBhcnJheSBwZXJmb3JtcyBhIGNvcHkgb2YgYGBuZXdQYWlyc2BgIGFuZAogICAgICAgIC8vIHJlcGxhY2VzIHRoZSBjb21wbGV0ZSBhcnJheSBgYHBhaXJzT2ZGbGFnc2BgLgogICAgICAgIHBhaXJzT2ZGbGFncyA9IG5ld1BhaXJzOwogICAgfQoKICAgIHN0cnVjdCBTdHJ1Y3RUeXBlIHsKICAgICAgICB1aW50W10gY29udGVudHM7CiAgICAgICAgdWludCBtb3JlSW5mbzsKICAgIH0KICAgIFN0cnVjdFR5cGUgczsKCiAgICBmdW5jdGlvbiBmKHVpbnRbXSBtZW1vcnkgYykgcHVibGljIHsKICAgICAgICAvLyBzdG9yZXMgYSByZWZlcmVuY2UgdG8gYGBzYGAgaW4gYGBnYGAKICAgICAgICBTdHJ1Y3RUeXBlIHN0b3JhZ2UgZyA9IHM7CiAgICAgICAgLy8gYWxzbyBjaGFuZ2VzIGBgcy5tb3JlSW5mb2BgLgogICAgICAgIGcubW9yZUluZm8gPSAyOwogICAgICAgIC8vIGFzc2lnbnMgYSBjb3B5IGJlY2F1c2UgYGBnLmNvbnRlbnRzYGAKICAgICAgICAvLyBpcyBub3QgYSBsb2NhbCB2YXJpYWJsZSwgYnV0IGEgbWVtYmVyIG9mCiAgICAgICAgLy8gYSBsb2NhbCB2YXJpYWJsZS4KICAgICAgICBnLmNvbnRlbnRzID0gYzsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRGbGFnUGFpcih1aW50IGluZGV4LCBib29sIGZsYWdBLCBib29sIGZsYWdCKSBwdWJsaWMgewogICAgICAgIC8vIGFjY2VzcyB0byBhIG5vbi1leGlzdGluZyBpbmRleCB3aWxsIHRocm93IGFuIGV4Y2VwdGlvbgogICAgICAgIHBhaXJzT2ZGbGFnc1tpbmRleF1bMF0gPSBmbGFnQTsKICAgICAgICBwYWlyc09mRmxhZ3NbaW5kZXhdWzFdID0gZmxhZ0I7CiAgICB9CgogICAgZnVuY3Rpb24gY2hhbmdlRmxhZ0FycmF5U2l6ZSh1aW50IG5ld1NpemUpIHB1YmxpYyB7CiAgICAgICAgLy8gdXNpbmcgcHVzaCBhbmQgcG9wIGlzIHRoZSBvbmx5IHdheSB0byBjaGFuZ2UgdGhlCiAgICAgICAgLy8gbGVuZ3RoIG9mIGFuIGFycmF5CiAgICAgICAgaWYgKG5ld1NpemUgPCBwYWlyc09mRmxhZ3MubGVuZ3RoKSB7CiAgICAgICAgICAgIHdoaWxlIChwYWlyc09mRmxhZ3MubGVuZ3RoID4gbmV3U2l6ZSkKICAgICAgICAgICAgICAgIHBhaXJzT2ZGbGFncy5wb3AoKTsKICAgICAgICB9IGVsc2UgaWYgKG5ld1NpemUgPiBwYWlyc09mRmxhZ3MubGVuZ3RoKSB7CiAgICAgICAgICAgIHdoaWxlIChwYWlyc09mRmxhZ3MubGVuZ3RoIDwgbmV3U2l6ZSkKICAgICAgICAgICAgICAgIHBhaXJzT2ZGbGFncy5wdXNoKCk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGNsZWFyKCkgcHVibGljIHsKICAgICAgICAvLyB0aGVzZSBjbGVhciB0aGUgYXJyYXlzIGNvbXBsZXRlbHkKICAgICAgICBkZWxldGUgcGFpcnNPZkZsYWdzOwogICAgICAgIGRlbGV0ZSBhTG90T2ZJbnRlZ2VyczsKICAgICAgICAvLyBpZGVudGljYWwgZWZmZWN0IGhlcmUKICAgICAgICBwYWlyc09mRmxhZ3MgPSBuZXcgYm9vbFsyXVtdKDApOwogICAgfQoKICAgIGJ5dGVzIGJ5dGVEYXRhOwoKICAgIGZ1bmN0aW9uIGJ5dGVBcnJheXMoYnl0ZXMgbWVtb3J5IGRhdGEpIHB1YmxpYyB7CiAgICAgICAgLy8gYnl0ZSBhcnJheXMgKCJieXRlcyIpIGFyZSBkaWZmZXJlbnQgYXMgdGhleSBhcmUgc3RvcmVkIHdpdGhvdXQgcGFkZGluZywKICAgICAgICAvLyBidXQgY2FuIGJlIHRyZWF0ZWQgaWRlbnRpY2FsIHRvICJ1aW50OFtdIgogICAgICAgIGJ5dGVEYXRhID0gZGF0YTsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCA3OyBpKyspCiAgICAgICAgICAgIGJ5dGVEYXRhLnB1c2goKTsKICAgICAgICBieXRlRGF0YVszXSA9IDB4MDg7CiAgICAgICAgZGVsZXRlIGJ5dGVEYXRhWzJdOwogICAgfQoKICAgIGZ1bmN0aW9uIGFkZEZsYWcoYm9vbFsyXSBtZW1vcnkgZmxhZykgcHVibGljIHJldHVybnMgKHVpbnQpIHsKICAgICAgICBwYWlyc09mRmxhZ3MucHVzaChmbGFnKTsKICAgICAgICByZXR1cm4gcGFpcnNPZkZsYWdzLmxlbmd0aDsKICAgIH0KCiAgICBmdW5jdGlvbiBjcmVhdGVNZW1vcnlBcnJheSh1aW50IHNpemUpIHB1YmxpYyBwdXJlIHJldHVybnMgKGJ5dGVzIG1lbW9yeSkgewogICAgICAgIC8vIER5bmFtaWMgbWVtb3J5IGFycmF5cyBhcmUgY3JlYXRlZCB1c2luZyBgbmV3YDoKICAgICAgICB1aW50WzJdW10gbWVtb3J5IGFycmF5T2ZQYWlycyA9IG5ldyB1aW50WzJdW10oc2l6ZSk7CgogICAgICAgIC8vIElubGluZSBhcnJheXMgYXJlIGFsd2F5cyBzdGF0aWNhbGx5LXNpemVkIGFuZCBpZiB5b3Ugb25seQogICAgICAgIC8vIHVzZSBsaXRlcmFscywgeW91IGhhdmUgdG8gcHJvdmlkZSBhdCBsZWFzdCBvbmUgdHlwZS4KICAgICAgICBhcnJheU9mUGFpcnNbMF0gPSBbdWludCgxKSwgMl07CgogICAgICAgIC8vIENyZWF0ZSBhIGR5bmFtaWMgYnl0ZSBhcnJheToKICAgICAgICBieXRlcyBtZW1vcnkgYiA9IG5ldyBieXRlcygyMDApOwogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGIubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGJbaV0gPSBieXRlczEodWludDgoaSkpOwogICAgICAgIHJldHVybiBiOwogICAgfQp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.6.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">ArrayContract</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="p">[</span><span class="m m-Decimal">2</span><span class="o">**</span><span class="m m-Decimal">20</span><span class="p">]</span><span class="w"> </span>aLotOfIntegers<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Note that the following is not a pair of dynamic arrays but a</span>
<span class="w">    </span><span class="c1">// dynamic array of pairs (i.e. of fixed size arrays of length two).</span>
<span class="w">    </span><span class="c1">// Because of that, T[] is always a dynamic array of T, even if T</span>
<span class="w">    </span><span class="c1">// itself is an array.</span>
<span class="w">    </span><span class="c1">// Data location for all state variables is storage.</span>
<span class="w">    </span><span class="kt">bool</span><span class="p">[</span><span class="m m-Decimal">2</span><span class="p">][]</span><span class="w"> </span>pairsOfFlags<span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// newPairs is stored in memory - the only possibility</span>
<span class="w">    </span><span class="c1">// for public contract function arguments</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">setAllFlagPairs</span><span class="p">(</span><span class="kt">bool</span><span class="p">[</span><span class="m m-Decimal">2</span><span class="p">][]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>newPairs<span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// assignment to a storage array performs a copy of ``newPairs`` and</span>
<span class="w">        </span><span class="c1">// replaces the complete array ``pairsOfFlags``.</span>
<span class="w">        </span>pairsOfFlags<span class="w"> </span><span class="o">=</span><span class="w"> </span>newPairs<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">struct</span><span class="w"> </span><span class="nv">StructType</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="p">[]</span><span class="w"> </span>contents<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="w"> </span><span class="nv">moreInfo</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span>StructType<span class="w"> </span>s<span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">f</span><span class="p">(</span><span class="kt">uint</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>c<span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// stores a reference to ``s`` in ``g``</span>
<span class="w">        </span>StructType<span class="w"> </span>storage<span class="w"> </span>g<span class="w"> </span><span class="o">=</span><span class="w"> </span>s<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="c1">// also changes ``s.moreInfo``.</span>
<span class="w">        </span>g<span class="p">.</span>moreInfo<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">2</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="c1">// assigns a copy because ``g.contents``</span>
<span class="w">        </span><span class="c1">// is not a local variable, but a member of</span>
<span class="w">        </span><span class="c1">// a local variable.</span>
<span class="w">        </span>g<span class="p">.</span>contents<span class="w"> </span><span class="o">=</span><span class="w"> </span>c<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">setFlagPair</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">index</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nv">flagA</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nv">flagB</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// access to a non-existing index will throw an exception</span>
<span class="w">        </span>pairsOfFlags<span class="p">[</span>index<span class="p">][</span><span class="m m-Decimal">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>flagA<span class="p">;</span><span class="w"></span>
<span class="w">        </span>pairsOfFlags<span class="p">[</span>index<span class="p">][</span><span class="m m-Decimal">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>flagB<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">changeFlagArraySize</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">newSize</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// using push and pop is the only way to change the</span>
<span class="w">        </span><span class="c1">// length of an array</span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>newSize<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>pairsOfFlags<span class="p">.</span>length<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="kt">while</span><span class="w"> </span><span class="p">(</span>pairsOfFlags<span class="p">.</span>length<span class="w"> </span><span class="o">&gt;</span><span class="w"> </span>newSize<span class="p">)</span><span class="w"></span>
<span class="w">                </span>pairsOfFlags<span class="p">.</span>pop<span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="kt">else</span><span class="w"> </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>newSize<span class="w"> </span><span class="o">&gt;</span><span class="w"> </span>pairsOfFlags<span class="p">.</span>length<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="kt">while</span><span class="w"> </span><span class="p">(</span>pairsOfFlags<span class="p">.</span>length<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>newSize<span class="p">)</span><span class="w"></span>
<span class="w">                </span>pairsOfFlags<span class="p">.</span>push<span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">clear</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// these clear the arrays completely</span>
<span class="w">        </span>delete<span class="w"> </span>pairsOfFlags<span class="p">;</span><span class="w"></span>
<span class="w">        </span>delete<span class="w"> </span>aLotOfIntegers<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="c1">// identical effect here</span>
<span class="w">        </span>pairsOfFlags<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="kt">bool</span><span class="p">[</span><span class="m m-Decimal">2</span><span class="p">][](</span><span class="m m-Decimal">0</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">bytes</span><span class="w"> </span><span class="nv">byteData</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">byteArrays</span><span class="p">(</span><span class="kt">bytes</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>data<span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// byte arrays (&quot;bytes&quot;) are different as they are stored without padding,</span>
<span class="w">        </span><span class="c1">// but can be treated identical to &quot;uint8[]&quot;</span>
<span class="w">        </span>byteData<span class="w"> </span><span class="o">=</span><span class="w"> </span>data<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">for</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span><span class="w"> </span>i<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m m-Decimal">7</span><span class="p">;</span><span class="w"> </span>i<span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span>byteData<span class="p">.</span>push<span class="p">();</span><span class="w"></span>
<span class="w">        </span>byteData<span class="p">[</span><span class="m m-Decimal">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x08</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span>delete<span class="w"> </span>byteData<span class="p">[</span><span class="m m-Decimal">2</span><span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">addFlag</span><span class="p">(</span><span class="kt">bool</span><span class="p">[</span><span class="m m-Decimal">2</span><span class="p">]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>flag<span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>pairsOfFlags<span class="p">.</span>push<span class="p">(</span>flag<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>pairsOfFlags<span class="p">.</span>length<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">createMemoryArray</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">size</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bytes</span><span class="w"> </span><span class="nv">memory</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Dynamic memory arrays are created using `new`:</span>
<span class="w">        </span><span class="kt">uint</span><span class="p">[</span><span class="m m-Decimal">2</span><span class="p">][]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>arrayOfPairs<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="kt">uint</span><span class="p">[</span><span class="m m-Decimal">2</span><span class="p">][](</span>size<span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="c1">// Inline arrays are always statically-sized and if you only</span>
<span class="w">        </span><span class="c1">// use literals, you have to provide at least one type.</span>
<span class="w">        </span>arrayOfPairs<span class="p">[</span><span class="m m-Decimal">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="kt">uint</span><span class="p">(</span><span class="m m-Decimal">1</span><span class="p">),</span><span class="w"> </span><span class="m m-Decimal">2</span><span class="p">];</span><span class="w"></span>

<span class="w">        </span><span class="c1">// Create a dynamic byte array:</span>
<span class="w">        </span><span class="kt">bytes</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>b<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="kt">bytes</span><span class="p">(</span><span class="m m-Decimal">200</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">for</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span><span class="w"> </span>i<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>b<span class="p">.</span>length<span class="p">;</span><span class="w"> </span>i<span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span>b<span class="p">[</span>i<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>bytes1<span class="p">(</span><span class="kt">uint8</span><span class="p">(</span>i<span class="p">));</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>b<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="dangling-references-to-storage-array-elements">
<span id="index-22"></span><h5>Dangling References to Storage Array Elements<a class="headerlink" href="#dangling-references-to-storage-array-elements" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>When working with storage arrays, you need to take care to avoid dangling references.
A dangling reference is a reference that points to something that no longer exists or has been
moved without updating the reference. A dangling reference can for example occur, if you store a
reference to an array element in a local variable and then <code class="docutils literal notranslate"><span class="pre">.pop()</span></code> from the containing array:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC44LjAgPDAuOS4wOwoKY29udHJhY3QgQyB7CiAgICB1aW50W11bXSBzOwoKICAgIGZ1bmN0aW9uIGYoKSBwdWJsaWMgewogICAgICAgIC8vIFN0b3JlcyBhIHBvaW50ZXIgdG8gdGhlIGxhc3QgYXJyYXkgZWxlbWVudCBvZiBzLgogICAgICAgIHVpbnRbXSBzdG9yYWdlIHB0ciA9IHNbcy5sZW5ndGggLSAxXTsKICAgICAgICAvLyBSZW1vdmVzIHRoZSBsYXN0IGFycmF5IGVsZW1lbnQgb2Ygcy4KICAgICAgICBzLnBvcCgpOwogICAgICAgIC8vIFdyaXRlcyB0byB0aGUgYXJyYXkgZWxlbWVudCB0aGF0IGlzIG5vIGxvbmdlciB3aXRoaW4gdGhlIGFycmF5LgogICAgICAgIHB0ci5wdXNoKDB4NDIpOwogICAgICAgIC8vIEFkZGluZyBhIG5ldyBlbGVtZW50IHRvIGBgc2BgIG5vdyB3aWxsIG5vdCBhZGQgYW4gZW1wdHkgYXJyYXksIGJ1dAogICAgICAgIC8vIHdpbGwgcmVzdWx0IGluIGFuIGFycmF5IG9mIGxlbmd0aCAxIHdpdGggYGAweDQyYGAgYXMgZWxlbWVudC4KICAgICAgICBzLnB1c2goKTsKICAgICAgICBhc3NlcnQoc1tzLmxlbmd0aCAtIDFdWzBdID09IDB4NDIpOwogICAgfQp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.8.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">C</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="p">[][]</span><span class="w"> </span>s<span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">f</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Stores a pointer to the last array element of s.</span>
<span class="w">        </span><span class="kt">uint</span><span class="p">[]</span><span class="w"> </span>storage<span class="w"> </span>ptr<span class="w"> </span><span class="o">=</span><span class="w"> </span>s<span class="p">[</span>s<span class="p">.</span>length<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">];</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Removes the last array element of s.</span>
<span class="w">        </span>s<span class="p">.</span>pop<span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Writes to the array element that is no longer within the array.</span>
<span class="w">        </span>ptr<span class="p">.</span>push<span class="p">(</span><span class="mh">0x42</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Adding a new element to ``s`` now will not add an empty array, but</span>
<span class="w">        </span><span class="c1">// will result in an array of length 1 with ``0x42`` as element.</span>
<span class="w">        </span>s<span class="p">.</span>push<span class="p">();</span><span class="w"></span>
<span class="w">        </span>assert<span class="p">(</span>s<span class="p">[</span>s<span class="p">.</span>length<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">][</span><span class="m m-Decimal">0</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">0x42</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>The write in <code class="docutils literal notranslate"><span class="pre">ptr.push(0x42)</span></code> will <strong>not</strong> revert, despite the fact that <code class="docutils literal notranslate"><span class="pre">ptr</span></code> no
longer refers to a valid element of <code class="docutils literal notranslate"><span class="pre">s</span></code>. Since the compiler assumes that unused storage
is always zeroed, a subsequent <code class="docutils literal notranslate"><span class="pre">s.push()</span></code> will not explicitly write zeroes to storage,
so the last element of <code class="docutils literal notranslate"><span class="pre">s</span></code> after that <code class="docutils literal notranslate"><span class="pre">push()</span></code> will have length <code class="docutils literal notranslate"><span class="pre">1</span></code> and contain
<code class="docutils literal notranslate"><span class="pre">0x42</span></code> as its first element.</p>
<p>Note that Solidity does not allow to declare references to value types in storage. These kinds
of explicit dangling references are restricted to nested reference types. However, dangling references
can also occur temporarily when using complex expressions in tuple assignments:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC44LjAgPDAuOS4wOwoKY29udHJhY3QgQyB7CiAgICB1aW50W10gczsKICAgIHVpbnRbXSB0OwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgICAgLy8gUHVzaCBzb21lIGluaXRpYWwgdmFsdWVzIHRvIHRoZSBzdG9yYWdlIGFycmF5cy4KICAgICAgICBzLnB1c2goMHgwNyk7CiAgICAgICAgdC5wdXNoKDB4MDMpOwogICAgfQoKICAgIGZ1bmN0aW9uIGcoKSBpbnRlcm5hbCByZXR1cm5zICh1aW50W10gc3RvcmFnZSkgewogICAgICAgIHMucG9wKCk7CiAgICAgICAgcmV0dXJuIHQ7CiAgICB9CgogICAgZnVuY3Rpb24gZigpIHB1YmxpYyByZXR1cm5zICh1aW50W10gbWVtb3J5KSB7CiAgICAgICAgLy8gVGhlIGZvbGxvd2luZyB3aWxsIGZpcnN0IGV2YWx1YXRlIGBgcy5wdXNoKClgYCB0byBhIHJlZmVyZW5jZSB0byBhIG5ldyBlbGVtZW50CiAgICAgICAgLy8gYXQgaW5kZXggMS4gQWZ0ZXJ3YXJkcywgdGhlIGNhbGwgdG8gYGBnYGAgcG9wcyB0aGlzIG5ldyBlbGVtZW50LCByZXN1bHRpbmcgaW4KICAgICAgICAvLyB0aGUgbGVmdC1tb3N0IHR1cGxlIGVsZW1lbnQgdG8gYmVjb21lIGEgZGFuZ2xpbmcgcmVmZXJlbmNlLiBUaGUgYXNzaWdubWVudCBzdGlsbAogICAgICAgIC8vIHRha2VzIHBsYWNlIGFuZCB3aWxsIHdyaXRlIG91dHNpZGUgdGhlIGRhdGEgYXJlYSBvZiBgYHNgYC4KICAgICAgICAocy5wdXNoKCksIGcoKVswXSkgPSAoMHg0MiwgMHgxNyk7CiAgICAgICAgLy8gQSBzdWJzZXF1ZW50IHB1c2ggdG8gYGBzYGAgd2lsbCByZXZlYWwgdGhlIHZhbHVlIHdyaXR0ZW4gYnkgdGhlIHByZXZpb3VzCiAgICAgICAgLy8gc3RhdGVtZW50LCBpLmUuIHRoZSBsYXN0IGVsZW1lbnQgb2YgYGBzYGAgYXQgdGhlIGVuZCBvZiB0aGlzIGZ1bmN0aW9uIHdpbGwgaGF2ZQogICAgICAgIC8vIHRoZSB2YWx1ZSBgYDB4NDJgYC4KICAgICAgICBzLnB1c2goKTsKICAgICAgICByZXR1cm4gczsKICAgIH0KfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.8.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">C</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="p">[]</span><span class="w"> </span>s<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="p">[]</span><span class="w"> </span>t<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Push some initial values to the storage arrays.</span>
<span class="w">        </span>s<span class="p">.</span>push<span class="p">(</span><span class="mh">0x07</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span>t<span class="p">.</span>push<span class="p">(</span><span class="mh">0x03</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">g</span><span class="p">()</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="p">[]</span><span class="w"> </span>storage<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>s<span class="p">.</span>pop<span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>t<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">f</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// The following will first evaluate ``s.push()`` to a reference to a new element</span>
<span class="w">        </span><span class="c1">// at index 1. Afterwards, the call to ``g`` pops this new element, resulting in</span>
<span class="w">        </span><span class="c1">// the left-most tuple element to become a dangling reference. The assignment still</span>
<span class="w">        </span><span class="c1">// takes place and will write outside the data area of ``s``.</span>
<span class="w">        </span><span class="p">(</span>s<span class="p">.</span>push<span class="p">(),</span><span class="w"> </span>g<span class="p">()[</span><span class="m m-Decimal">0</span><span class="p">])</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mh">0x42</span><span class="p">,</span><span class="w"> </span><span class="mh">0x17</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// A subsequent push to ``s`` will reveal the value written by the previous</span>
<span class="w">        </span><span class="c1">// statement, i.e. the last element of ``s`` at the end of this function will have</span>
<span class="w">        </span><span class="c1">// the value ``0x42``.</span>
<span class="w">        </span>s<span class="p">.</span>push<span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>s<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>It is always safer to only assign to storage once per statement and to avoid
complex expressions on the left-hand-side of an assignment.</p>
<p>You need to take particular care when dealing with references to elements of
<code class="docutils literal notranslate"><span class="pre">bytes</span></code> arrays, since a <code class="docutils literal notranslate"><span class="pre">.push()</span></code> on a bytes array may switch <a class="reference internal" href="index.html#bytes-and-string"><span class="std std-ref">from short
to long layout in storage</span></a>.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC44LjAgPDAuOS4wOwoKLy8gVGhpcyB3aWxsIHJlcG9ydCBhIHdhcm5pbmcKY29udHJhY3QgQyB7CiAgICBieXRlcyB4ID0gIjAxMjM0NTY3ODkwMTIzNDU2Nzg5MDEyMzQ1Njc4OSI7CgogICAgZnVuY3Rpb24gdGVzdCgpIGV4dGVybmFsIHJldHVybnModWludCkgewogICAgICAgICh4LnB1c2goKSwgeC5wdXNoKCkpID0gKDB4MDEsIDB4MDIpOwogICAgICAgIHJldHVybiB4Lmxlbmd0aDsKICAgIH0KfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.8.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="c1">// This will report a warning</span>
<span class="k">contract</span><span class="w"> </span><span class="ni">C</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">bytes</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;012345678901234567890123456789&quot;</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">test</span><span class="p">()</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="kt">returns</span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="p">(</span>x<span class="p">.</span>push<span class="p">(),</span><span class="w"> </span>x<span class="p">.</span>push<span class="p">())</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mh">0x01</span><span class="p">,</span><span class="w"> </span><span class="mh">0x02</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>x<span class="p">.</span>length<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Here, when the first <code class="docutils literal notranslate"><span class="pre">x.push()</span></code> is evaluated, <code class="docutils literal notranslate"><span class="pre">x</span></code> is still stored in short
layout, thereby <code class="docutils literal notranslate"><span class="pre">x.push()</span></code> returns a reference to an element in the first storage slot of
<code class="docutils literal notranslate"><span class="pre">x</span></code>. However, the second <code class="docutils literal notranslate"><span class="pre">x.push()</span></code> switches the bytes array to large layout.
Now the element that <code class="docutils literal notranslate"><span class="pre">x.push()</span></code> referred to is in the data area of the array while
the reference still points at its original location, which is now a part of the length field
and the assignment will effectively garble the length of <code class="docutils literal notranslate"><span class="pre">x</span></code>.
To be safe, only enlarge bytes arrays by at most one element during a single
assignment and do not simultaneously index-access the array in the same statement.</p>
<p>While the above describes the behaviour of dangling storage references in the
current version of the compiler, any code with dangling references should be
considered to have <em>undefined behaviour</em>. In particular, this means that
any future version of the compiler may change the behaviour of code that
involves dangling references.</p>
<p>Be sure to avoid dangling references in your code!</p>
</section>
</section>
<section id="array-slices">
<span id="index-23"></span><span id="id15"></span><h4>Array Slices<a class="headerlink" href="#array-slices" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Array slices are a view on a contiguous portion of an array.
They are written as <code class="docutils literal notranslate"><span class="pre">x[start:end]</span></code>, where <code class="docutils literal notranslate"><span class="pre">start</span></code> and
<code class="docutils literal notranslate"><span class="pre">end</span></code> are expressions resulting in a uint256 type (or
implicitly convertible to it). The first element of the
slice is <code class="docutils literal notranslate"><span class="pre">x[start]</span></code> and the last element is <code class="docutils literal notranslate"><span class="pre">x[end</span> <span class="pre">-</span> <span class="pre">1]</span></code>.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">start</span></code> is greater than <code class="docutils literal notranslate"><span class="pre">end</span></code> or if <code class="docutils literal notranslate"><span class="pre">end</span></code> is greater
than the length of the array, an exception is thrown.</p>
<p>Both <code class="docutils literal notranslate"><span class="pre">start</span></code> and <code class="docutils literal notranslate"><span class="pre">end</span></code> are optional: <code class="docutils literal notranslate"><span class="pre">start</span></code> defaults
to <code class="docutils literal notranslate"><span class="pre">0</span></code> and <code class="docutils literal notranslate"><span class="pre">end</span></code> defaults to the length of the array.</p>
<p>Array slices do not have any members. They are implicitly
convertible to arrays of their underlying type
and support index access. Index access is not absolute
in the underlying array, but relative to the start of
the slice.</p>
<p>Array slices do not have a type name which means
no variable can have an array slices as type,
they only exist in intermediate expressions.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As of now, array slices are only implemented for calldata arrays.</p>
</div>
<p>Array slices are useful to ABI-decode secondary data passed in function parameters:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC44LjUgPDAuOS4wOwpjb250cmFjdCBQcm94eSB7CiAgICAvLy8gQGRldiBBZGRyZXNzIG9mIHRoZSBjbGllbnQgY29udHJhY3QgbWFuYWdlZCBieSBwcm94eSBpLmUuLCB0aGlzIGNvbnRyYWN0CiAgICBhZGRyZXNzIGNsaWVudDsKCiAgICBjb25zdHJ1Y3RvcihhZGRyZXNzIGNsaWVudF8pIHsKICAgICAgICBjbGllbnQgPSBjbGllbnRfOwogICAgfQoKICAgIC8vLyBGb3J3YXJkIGNhbGwgdG8gInNldE93bmVyKGFkZHJlc3MpIiB0aGF0IGlzIGltcGxlbWVudGVkIGJ5IGNsaWVudAogICAgLy8vIGFmdGVyIGRvaW5nIGJhc2ljIHZhbGlkYXRpb24gb24gdGhlIGFkZHJlc3MgYXJndW1lbnQuCiAgICBmdW5jdGlvbiBmb3J3YXJkKGJ5dGVzIGNhbGxkYXRhIHBheWxvYWQpIGV4dGVybmFsIHsKICAgICAgICBieXRlczQgc2lnID0gYnl0ZXM0KHBheWxvYWRbOjRdKTsKICAgICAgICAvLyBEdWUgdG8gdHJ1bmNhdGluZyBiZWhhdmlvdXIsIGJ5dGVzNChwYXlsb2FkKSBwZXJmb3JtcyBpZGVudGljYWxseS4KICAgICAgICAvLyBieXRlczQgc2lnID0gYnl0ZXM0KHBheWxvYWQpOwogICAgICAgIGlmIChzaWcgPT0gYnl0ZXM0KGtlY2NhazI1Nigic2V0T3duZXIoYWRkcmVzcykiKSkpIHsKICAgICAgICAgICAgYWRkcmVzcyBvd25lciA9IGFiaS5kZWNvZGUocGF5bG9hZFs0Ol0sIChhZGRyZXNzKSk7CiAgICAgICAgICAgIHJlcXVpcmUob3duZXIgIT0gYWRkcmVzcygwKSwgIkFkZHJlc3Mgb2Ygb3duZXIgY2Fubm90IGJlIHplcm8uIik7CiAgICAgICAgfQogICAgICAgIChib29sIHN0YXR1cywpID0gY2xpZW50LmRlbGVnYXRlY2FsbChwYXlsb2FkKTsKICAgICAgICByZXF1aXJlKHN0YXR1cywgIkZvcndhcmRlZCBjYWxsIGZhaWxlZC4iKTsKICAgIH0KfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.8.5</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>
<span class="k">contract</span><span class="w"> </span><span class="ni">Proxy</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">/// @dev Address of the client contract managed by proxy i.e., this contract</span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">client</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kt">constructor</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">client_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>client<span class="w"> </span><span class="o">=</span><span class="w"> </span>client_<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// Forward call to &quot;setOwner(address)&quot; that is implemented by client</span>
<span class="w">    </span><span class="c1">/// after doing basic validation on the address argument.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">forward</span><span class="p">(</span><span class="kt">bytes</span><span class="w"> </span><span class="nv">calldata</span><span class="w"> </span>payload<span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>bytes4<span class="w"> </span>sig<span class="w"> </span><span class="o">=</span><span class="w"> </span>bytes4<span class="p">(</span>payload<span class="p">[:</span><span class="m m-Decimal">4</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Due to truncating behaviour, bytes4(payload) performs identically.</span>
<span class="w">        </span><span class="c1">// bytes4 sig = bytes4(payload);</span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>sig<span class="w"> </span><span class="o">==</span><span class="w"> </span>bytes4<span class="p">(</span><span class="nb">keccak256</span><span class="p">(</span><span class="s2">&quot;setOwner(address)&quot;</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="kt">address</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>abi<span class="p">.</span>decode<span class="p">(</span>payload<span class="p">[</span><span class="m m-Decimal">4</span><span class="p">:],</span><span class="w"> </span><span class="p">(</span><span class="kt">address</span><span class="p">));</span><span class="w"></span>
<span class="w">            </span><span class="kt">require</span><span class="p">(</span>owner<span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kt">address</span><span class="p">(</span><span class="m m-Decimal">0</span><span class="p">),</span><span class="w"> </span><span class="s2">&quot;Address of owner cannot be zero.&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="nv">status</span><span class="p">,)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>client<span class="p">.</span>delegatecall<span class="p">(</span>payload<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>status<span class="p">,</span><span class="w"> </span><span class="s2">&quot;Forwarded call failed.&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="structs">
<span id="index-24"></span><span id="id16"></span><h4>Structs<a class="headerlink" href="#structs" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Solidity provides a way to define new types in the form of structs, which is
shown in the following example:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC42LjAgPDAuOS4wOwoKLy8gRGVmaW5lcyBhIG5ldyB0eXBlIHdpdGggdHdvIGZpZWxkcy4KLy8gRGVjbGFyaW5nIGEgc3RydWN0IG91dHNpZGUgb2YgYSBjb250cmFjdCBhbGxvd3MKLy8gaXQgdG8gYmUgc2hhcmVkIGJ5IG11bHRpcGxlIGNvbnRyYWN0cy4KLy8gSGVyZSwgdGhpcyBpcyBub3QgcmVhbGx5IG5lZWRlZC4Kc3RydWN0IEZ1bmRlciB7CiAgICBhZGRyZXNzIGFkZHI7CiAgICB1aW50IGFtb3VudDsKfQoKY29udHJhY3QgQ3Jvd2RGdW5kaW5nIHsKICAgIC8vIFN0cnVjdHMgY2FuIGFsc28gYmUgZGVmaW5lZCBpbnNpZGUgY29udHJhY3RzLCB3aGljaCBtYWtlcyB0aGVtCiAgICAvLyB2aXNpYmxlIG9ubHkgdGhlcmUgYW5kIGluIGRlcml2ZWQgY29udHJhY3RzLgogICAgc3RydWN0IENhbXBhaWduIHsKICAgICAgICBhZGRyZXNzIHBheWFibGUgYmVuZWZpY2lhcnk7CiAgICAgICAgdWludCBmdW5kaW5nR29hbDsKICAgICAgICB1aW50IG51bUZ1bmRlcnM7CiAgICAgICAgdWludCBhbW91bnQ7CiAgICAgICAgbWFwcGluZyAodWludCA9PiBGdW5kZXIpIGZ1bmRlcnM7CiAgICB9CgogICAgdWludCBudW1DYW1wYWlnbnM7CiAgICBtYXBwaW5nICh1aW50ID0+IENhbXBhaWduKSBjYW1wYWlnbnM7CgogICAgZnVuY3Rpb24gbmV3Q2FtcGFpZ24oYWRkcmVzcyBwYXlhYmxlIGJlbmVmaWNpYXJ5LCB1aW50IGdvYWwpIHB1YmxpYyByZXR1cm5zICh1aW50IGNhbXBhaWduSUQpIHsKICAgICAgICBjYW1wYWlnbklEID0gbnVtQ2FtcGFpZ25zKys7IC8vIGNhbXBhaWduSUQgaXMgcmV0dXJuIHZhcmlhYmxlCiAgICAgICAgLy8gV2UgY2Fubm90IHVzZSAiY2FtcGFpZ25zW2NhbXBhaWduSURdID0gQ2FtcGFpZ24oYmVuZWZpY2lhcnksIGdvYWwsIDAsIDApIgogICAgICAgIC8vIGJlY2F1c2UgdGhlIHJpZ2h0IGhhbmQgc2lkZSBjcmVhdGVzIGEgbWVtb3J5LXN0cnVjdCAiQ2FtcGFpZ24iIHRoYXQgY29udGFpbnMgYSBtYXBwaW5nLgogICAgICAgIENhbXBhaWduIHN0b3JhZ2UgYyA9IGNhbXBhaWduc1tjYW1wYWlnbklEXTsKICAgICAgICBjLmJlbmVmaWNpYXJ5ID0gYmVuZWZpY2lhcnk7CiAgICAgICAgYy5mdW5kaW5nR29hbCA9IGdvYWw7CiAgICB9CgogICAgZnVuY3Rpb24gY29udHJpYnV0ZSh1aW50IGNhbXBhaWduSUQpIHB1YmxpYyBwYXlhYmxlIHsKICAgICAgICBDYW1wYWlnbiBzdG9yYWdlIGMgPSBjYW1wYWlnbnNbY2FtcGFpZ25JRF07CiAgICAgICAgLy8gQ3JlYXRlcyBhIG5ldyB0ZW1wb3JhcnkgbWVtb3J5IHN0cnVjdCwgaW5pdGlhbGlzZWQgd2l0aCB0aGUgZ2l2ZW4gdmFsdWVzCiAgICAgICAgLy8gYW5kIGNvcGllcyBpdCBvdmVyIHRvIHN0b3JhZ2UuCiAgICAgICAgLy8gTm90ZSB0aGF0IHlvdSBjYW4gYWxzbyB1c2UgRnVuZGVyKG1zZy5zZW5kZXIsIG1zZy52YWx1ZSkgdG8gaW5pdGlhbGlzZS4KICAgICAgICBjLmZ1bmRlcnNbYy5udW1GdW5kZXJzKytdID0gRnVuZGVyKHthZGRyOiBtc2cuc2VuZGVyLCBhbW91bnQ6IG1zZy52YWx1ZX0pOwogICAgICAgIGMuYW1vdW50ICs9IG1zZy52YWx1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBjaGVja0dvYWxSZWFjaGVkKHVpbnQgY2FtcGFpZ25JRCkgcHVibGljIHJldHVybnMgKGJvb2wgcmVhY2hlZCkgewogICAgICAgIENhbXBhaWduIHN0b3JhZ2UgYyA9IGNhbXBhaWduc1tjYW1wYWlnbklEXTsKICAgICAgICBpZiAoYy5hbW91bnQgPCBjLmZ1bmRpbmdHb2FsKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgdWludCBhbW91bnQgPSBjLmFtb3VudDsKICAgICAgICBjLmFtb3VudCA9IDA7CiAgICAgICAgYy5iZW5lZmljaWFyeS50cmFuc2ZlcihhbW91bnQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.6.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="c1">// Defines a new type with two fields.</span>
<span class="c1">// Declaring a struct outside of a contract allows</span>
<span class="c1">// it to be shared by multiple contracts.</span>
<span class="c1">// Here, this is not really needed.</span>
<span class="kt">struct</span><span class="w"> </span><span class="nv">Funder</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">addr</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="nv">amount</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">CrowdFunding</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Structs can also be defined inside contracts, which makes them</span>
<span class="w">    </span><span class="c1">// visible only there and in derived contracts.</span>
<span class="w">    </span><span class="kt">struct</span><span class="w"> </span><span class="nv">Campaign</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">payable</span><span class="w"> </span>beneficiary<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="w"> </span><span class="nv">fundingGoal</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="w"> </span><span class="nv">numFunders</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="w"> </span><span class="nv">amount</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">mapping</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span>Funder<span class="p">)</span><span class="w"> </span>funders<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="nv">numCampaigns</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">mapping</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span>Campaign<span class="p">)</span><span class="w"> </span>campaigns<span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">newCampaign</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">payable</span><span class="w"> </span>beneficiary<span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">goal</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">campaignID</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>campaignID<span class="w"> </span><span class="o">=</span><span class="w"> </span>numCampaigns<span class="o">++</span><span class="p">;</span><span class="w"> </span><span class="c1">// campaignID is return variable</span>
<span class="w">        </span><span class="c1">// We cannot use &quot;campaigns[campaignID] = Campaign(beneficiary, goal, 0, 0)&quot;</span>
<span class="w">        </span><span class="c1">// because the right hand side creates a memory-struct &quot;Campaign&quot; that contains a mapping.</span>
<span class="w">        </span>Campaign<span class="w"> </span>storage<span class="w"> </span>c<span class="w"> </span><span class="o">=</span><span class="w"> </span>campaigns<span class="p">[</span>campaignID<span class="p">];</span><span class="w"></span>
<span class="w">        </span>c<span class="p">.</span>beneficiary<span class="w"> </span><span class="o">=</span><span class="w"> </span>beneficiary<span class="p">;</span><span class="w"></span>
<span class="w">        </span>c<span class="p">.</span>fundingGoal<span class="w"> </span><span class="o">=</span><span class="w"> </span>goal<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">contribute</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">campaignID</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>Campaign<span class="w"> </span>storage<span class="w"> </span>c<span class="w"> </span><span class="o">=</span><span class="w"> </span>campaigns<span class="p">[</span>campaignID<span class="p">];</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Creates a new temporary memory struct, initialised with the given values</span>
<span class="w">        </span><span class="c1">// and copies it over to storage.</span>
<span class="w">        </span><span class="c1">// Note that you can also use Funder(msg.sender, msg.value) to initialise.</span>
<span class="w">        </span>c<span class="p">.</span>funders<span class="p">[</span>c<span class="p">.</span>numFunders<span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Funder<span class="p">({</span>addr<span class="p">:</span><span class="w"> </span><span class="k">msg.sender</span><span class="p">,</span><span class="w"> </span>amount<span class="p">:</span><span class="w"> </span><span class="k">msg.value</span><span class="p">});</span><span class="w"></span>
<span class="w">        </span>c<span class="p">.</span>amount<span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">msg.value</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">checkGoalReached</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">campaignID</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="nv">reached</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>Campaign<span class="w"> </span>storage<span class="w"> </span>c<span class="w"> </span><span class="o">=</span><span class="w"> </span>campaigns<span class="p">[</span>campaignID<span class="p">];</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>c<span class="p">.</span>amount<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>c<span class="p">.</span>fundingGoal<span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="kt">return</span><span class="w"> </span><span class="kt">false</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="w"> </span><span class="nv">amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>c<span class="p">.</span>amount<span class="p">;</span><span class="w"></span>
<span class="w">        </span>c<span class="p">.</span>amount<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span>c<span class="p">.</span>beneficiary<span class="p">.</span>transfer<span class="p">(</span>amount<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>The contract does not provide the full functionality of a crowdfunding
contract, but it contains the basic concepts necessary to understand structs.
Struct types can be used inside mappings and arrays and they can themselves
contain mappings and arrays.</p>
<p>It is not possible for a struct to contain a member of its own type,
although the struct itself can be the value type of a mapping member
or it can contain a dynamically-sized array of its type.
This restriction is necessary, as the size of the struct has to be finite.</p>
<p>Note how in all the functions, a struct type is assigned to a local variable
with data location <code class="docutils literal notranslate"><span class="pre">storage</span></code>.
This does not copy the struct but only stores a reference so that assignments to
members of the local variable actually write to the state.</p>
<p>Of course, you can also directly access the members of the struct without
assigning it to a local variable, as in
<code class="docutils literal notranslate"><span class="pre">campaigns[campaignID].amount</span> <span class="pre">=</span> <span class="pre">0</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Until Solidity 0.7.0, memory-structs containing members of storage-only types (e.g. mappings)
were allowed and assignments like <code class="docutils literal notranslate"><span class="pre">campaigns[campaignID]</span> <span class="pre">=</span> <span class="pre">Campaign(beneficiary,</span> <span class="pre">goal,</span> <span class="pre">0,</span> <span class="pre">0)</span></code>
in the example above would work and just silently skip those members.</p>
</div>
</section>
</section>
<section id="mapping-types">
<span id="index-25"></span><span id="id17"></span><h3>Mapping Types<a class="headerlink" href="#mapping-types" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Mapping types use the syntax <code class="docutils literal notranslate"><span class="pre">mapping(KeyType</span> <span class="pre">=&gt;</span> <span class="pre">ValueType)</span></code> and variables
of mapping type are declared using the syntax <code class="docutils literal notranslate"><span class="pre">mapping(KeyType</span> <span class="pre">=&gt;</span> <span class="pre">ValueType)</span> <span class="pre">VariableName</span></code>.
The <code class="docutils literal notranslate"><span class="pre">KeyType</span></code> can be any
built-in value type, <code class="docutils literal notranslate"><span class="pre">bytes</span></code>, <code class="docutils literal notranslate"><span class="pre">string</span></code>, or any contract or enum type. Other user-defined
or complex types, such as mappings, structs or array types are not allowed.
<code class="docutils literal notranslate"><span class="pre">ValueType</span></code> can be any type, including mappings, arrays and structs.</p>
<p>You can think of mappings as <a class="reference external" href="https://en.wikipedia.org/wiki/Hash_table">hash tables</a>, which are virtually initialised
such that every possible key exists and is mapped to a value whose
byte-representation is all zeros, a type‚Äôs <a class="reference internal" href="index.html#default-value"><span class="std std-ref">default value</span></a>.
The similarity ends there, the key data is not stored in a
mapping, only its <code class="docutils literal notranslate"><span class="pre">keccak256</span></code> hash is used to look up the value.</p>
<p>Because of this, mappings do not have a length or a concept of a key or
value being set, and therefore cannot be erased without extra information
regarding the assigned keys (see <a class="reference internal" href="index.html#clearing-mappings"><span class="std std-ref">Clearing Mappings</span></a>).</p>
<p>Mappings can only have a data location of <code class="docutils literal notranslate"><span class="pre">storage</span></code> and thus
are allowed for state variables, as storage reference types
in functions, or as parameters for library functions.
They cannot be used as parameters or return parameters
of contract functions that are publicly visible.
These restrictions are also true for arrays and structs that contain mappings.</p>
<p>You can mark state variables of mapping type as <code class="docutils literal notranslate"><span class="pre">public</span></code> and Solidity creates a
<a class="reference internal" href="index.html#visibility-and-getters"><span class="std std-ref">getter</span></a> for you. The <code class="docutils literal notranslate"><span class="pre">KeyType</span></code> becomes a parameter for the getter.
If <code class="docutils literal notranslate"><span class="pre">ValueType</span></code> is a value type or a struct, the getter returns <code class="docutils literal notranslate"><span class="pre">ValueType</span></code>.
If <code class="docutils literal notranslate"><span class="pre">ValueType</span></code> is an array or a mapping, the getter has one parameter for
each <code class="docutils literal notranslate"><span class="pre">KeyType</span></code>, recursively.</p>
<p>In the example below, the <code class="docutils literal notranslate"><span class="pre">MappingExample</span></code> contract defines a public <code class="docutils literal notranslate"><span class="pre">balances</span></code>
mapping, with the key type an <code class="docutils literal notranslate"><span class="pre">address</span></code>, and a value type a <code class="docutils literal notranslate"><span class="pre">uint</span></code>, mapping
an Ethereum address to an unsigned integer value. As <code class="docutils literal notranslate"><span class="pre">uint</span></code> is a value type, the getter
returns a value that matches the type, which you can see in the <code class="docutils literal notranslate"><span class="pre">MappingUser</span></code>
contract that returns the value at the specified address.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC40LjAgPDAuOS4wOwoKY29udHJhY3QgTWFwcGluZ0V4YW1wbGUgewogICAgbWFwcGluZyhhZGRyZXNzID0+IHVpbnQpIHB1YmxpYyBiYWxhbmNlczsKCiAgICBmdW5jdGlvbiB1cGRhdGUodWludCBuZXdCYWxhbmNlKSBwdWJsaWMgewogICAgICAgIGJhbGFuY2VzW21zZy5zZW5kZXJdID0gbmV3QmFsYW5jZTsKICAgIH0KfQoKY29udHJhY3QgTWFwcGluZ1VzZXIgewogICAgZnVuY3Rpb24gZigpIHB1YmxpYyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgTWFwcGluZ0V4YW1wbGUgbSA9IG5ldyBNYXBwaW5nRXhhbXBsZSgpOwogICAgICAgIG0udXBkYXRlKDEwMCk7CiAgICAgICAgcmV0dXJuIG0uYmFsYW5jZXMoYWRkcmVzcyh0aGlzKSk7CiAgICB9Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.4.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">MappingExample</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>balances<span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">update</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">newBalance</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>balances<span class="p">[</span><span class="k">msg.sender</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>newBalance<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">MappingUser</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">f</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>MappingExample<span class="w"> </span>m<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span>MappingExample<span class="p">();</span><span class="w"></span>
<span class="w">        </span>m<span class="p">.</span>update<span class="p">(</span><span class="m m-Decimal">100</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>m<span class="p">.</span>balances<span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="kt">this</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>The example below is a simplified version of an
<a class="reference external" href="https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/token/ERC20/ERC20.sol">ERC20 token</a>.
<code class="docutils literal notranslate"><span class="pre">_allowances</span></code> is an example of a mapping type inside another mapping type.
The example below uses <code class="docutils literal notranslate"><span class="pre">_allowances</span></code> to record the amount someone else is allowed to withdraw from your account.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC40LjIyIDwwLjkuMDsKCmNvbnRyYWN0IE1hcHBpbmdFeGFtcGxlIHsKCiAgICBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpIHByaXZhdGUgX2JhbGFuY2VzOwogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBtYXBwaW5nIChhZGRyZXNzID0+IHVpbnQyNTYpKSBwcml2YXRlIF9hbGxvd2FuY2VzOwoKICAgIGV2ZW50IFRyYW5zZmVyKGFkZHJlc3MgaW5kZXhlZCBmcm9tLCBhZGRyZXNzIGluZGV4ZWQgdG8sIHVpbnQyNTYgdmFsdWUpOwogICAgZXZlbnQgQXBwcm92YWwoYWRkcmVzcyBpbmRleGVkIG93bmVyLCBhZGRyZXNzIGluZGV4ZWQgc3BlbmRlciwgdWludDI1NiB2YWx1ZSk7CgogICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFkZHJlc3Mgb3duZXIsIGFkZHJlc3Mgc3BlbmRlcikgcHVibGljIHZpZXcgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiBfYWxsb3dhbmNlc1tvd25lcl1bc3BlbmRlcl07CiAgICB9CgogICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGFkZHJlc3Mgc2VuZGVyLCBhZGRyZXNzIHJlY2lwaWVudCwgdWludDI1NiBhbW91bnQpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZShfYWxsb3dhbmNlc1tzZW5kZXJdW21zZy5zZW5kZXJdID49IGFtb3VudCwgIkVSQzIwOiBBbGxvd2FuY2Ugbm90IGhpZ2ggZW5vdWdoLiIpOwogICAgICAgIF9hbGxvd2FuY2VzW3NlbmRlcl1bbXNnLnNlbmRlcl0gLT0gYW1vdW50OwogICAgICAgIF90cmFuc2ZlcihzZW5kZXIsIHJlY2lwaWVudCwgYW1vdW50KTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBhcHByb3ZlKGFkZHJlc3Mgc3BlbmRlciwgdWludDI1NiBhbW91bnQpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmVxdWlyZShzcGVuZGVyICE9IGFkZHJlc3MoMCksICJFUkMyMDogYXBwcm92ZSB0byB0aGUgemVybyBhZGRyZXNzIik7CgogICAgICAgIF9hbGxvd2FuY2VzW21zZy5zZW5kZXJdW3NwZW5kZXJdID0gYW1vdW50OwogICAgICAgIGVtaXQgQXBwcm92YWwobXNnLnNlbmRlciwgc3BlbmRlciwgYW1vdW50KTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBfdHJhbnNmZXIoYWRkcmVzcyBzZW5kZXIsIGFkZHJlc3MgcmVjaXBpZW50LCB1aW50MjU2IGFtb3VudCkgaW50ZXJuYWwgewogICAgICAgIHJlcXVpcmUoc2VuZGVyICE9IGFkZHJlc3MoMCksICJFUkMyMDogdHJhbnNmZXIgZnJvbSB0aGUgemVybyBhZGRyZXNzIik7CiAgICAgICAgcmVxdWlyZShyZWNpcGllbnQgIT0gYWRkcmVzcygwKSwgIkVSQzIwOiB0cmFuc2ZlciB0byB0aGUgemVybyBhZGRyZXNzIik7CiAgICAgICAgcmVxdWlyZShfYmFsYW5jZXNbc2VuZGVyXSA+PSBhbW91bnQsICJFUkMyMDogTm90IGVub3VnaCBmdW5kcy4iKTsKCiAgICAgICAgX2JhbGFuY2VzW3NlbmRlcl0gLT0gYW1vdW50OwogICAgICAgIF9iYWxhbmNlc1tyZWNpcGllbnRdICs9IGFtb3VudDsKICAgICAgICBlbWl0IFRyYW5zZmVyKHNlbmRlciwgcmVjaXBpZW50LCBhbW91bnQpOwogICAgfQp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.4.22</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">MappingExample</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">    </span><span class="kt">mapping</span><span class="w"> </span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">uint256</span><span class="p">)</span><span class="w"> </span><span class="kt">private</span><span class="w"> </span>_balances<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">mapping</span><span class="w"> </span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">mapping</span><span class="w"> </span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">uint256</span><span class="p">))</span><span class="w"> </span><span class="kt">private</span><span class="w"> </span>_allowances<span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">Transfer</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>from<span class="p">,</span><span class="w"> </span><span class="kt">address</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>to<span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">value</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">Approval</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>owner<span class="p">,</span><span class="w"> </span><span class="kt">address</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>spender<span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">value</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">allowance</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">owner</span><span class="p">,</span><span class="w"> </span><span class="kt">address</span><span class="w"> </span><span class="nv">spender</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint256</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>_allowances<span class="p">[</span>owner<span class="p">][</span>spender<span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">transferFrom</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">sender</span><span class="p">,</span><span class="w"> </span><span class="kt">address</span><span class="w"> </span><span class="nv">recipient</span><span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amount</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>_allowances<span class="p">[</span>sender<span class="p">][</span><span class="k">msg.sender</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span>amount<span class="p">,</span><span class="w"> </span><span class="s2">&quot;ERC20: Allowance not high enough.&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span>_allowances<span class="p">[</span>sender<span class="p">][</span><span class="k">msg.sender</span><span class="p">]</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span>amount<span class="p">;</span><span class="w"></span>
<span class="w">        </span>_transfer<span class="p">(</span>sender<span class="p">,</span><span class="w"> </span>recipient<span class="p">,</span><span class="w"> </span>amount<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">approve</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">spender</span><span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amount</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>spender<span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kt">address</span><span class="p">(</span><span class="m m-Decimal">0</span><span class="p">),</span><span class="w"> </span><span class="s2">&quot;ERC20: approve to the zero address&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span>_allowances<span class="p">[</span><span class="k">msg.sender</span><span class="p">][</span>spender<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>amount<span class="p">;</span><span class="w"></span>
<span class="w">        </span>emit<span class="w"> </span>Approval<span class="p">(</span><span class="k">msg.sender</span><span class="p">,</span><span class="w"> </span>spender<span class="p">,</span><span class="w"> </span>amount<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">_transfer</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">sender</span><span class="p">,</span><span class="w"> </span><span class="kt">address</span><span class="w"> </span><span class="nv">recipient</span><span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amount</span><span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>sender<span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kt">address</span><span class="p">(</span><span class="m m-Decimal">0</span><span class="p">),</span><span class="w"> </span><span class="s2">&quot;ERC20: transfer from the zero address&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>recipient<span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kt">address</span><span class="p">(</span><span class="m m-Decimal">0</span><span class="p">),</span><span class="w"> </span><span class="s2">&quot;ERC20: transfer to the zero address&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>_balances<span class="p">[</span>sender<span class="p">]</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span>amount<span class="p">,</span><span class="w"> </span><span class="s2">&quot;ERC20: Not enough funds.&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span>_balances<span class="p">[</span>sender<span class="p">]</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span>amount<span class="p">;</span><span class="w"></span>
<span class="w">        </span>_balances<span class="p">[</span>recipient<span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span>amount<span class="p">;</span><span class="w"></span>
<span class="w">        </span>emit<span class="w"> </span>Transfer<span class="p">(</span>sender<span class="p">,</span><span class="w"> </span>recipient<span class="p">,</span><span class="w"> </span>amount<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<section id="iterable-mappings">
<span id="index-26"></span><span id="id18"></span><h4>Iterable Mappings<a class="headerlink" href="#iterable-mappings" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>You cannot iterate over mappings, i.e. you cannot enumerate their keys.
It is possible, though, to implement a data structure on
top of them and iterate over that. For example, the code below implements an
<code class="docutils literal notranslate"><span class="pre">IterableMapping</span></code> library that the <code class="docutils literal notranslate"><span class="pre">User</span></code> contract then adds data to, and
the <code class="docutils literal notranslate"><span class="pre">sum</span></code> function iterates over to sum all the values.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5IF4wLjguODsKCnN0cnVjdCBJbmRleFZhbHVlIHsgdWludCBrZXlJbmRleDsgdWludCB2YWx1ZTsgfQpzdHJ1Y3QgS2V5RmxhZyB7IHVpbnQga2V5OyBib29sIGRlbGV0ZWQ7IH0KCnN0cnVjdCBpdG1hcCB7CiAgICBtYXBwaW5nKHVpbnQgPT4gSW5kZXhWYWx1ZSkgZGF0YTsKICAgIEtleUZsYWdbXSBrZXlzOwogICAgdWludCBzaXplOwp9Cgp0eXBlIEl0ZXJhdG9yIGlzIHVpbnQ7CgpsaWJyYXJ5IEl0ZXJhYmxlTWFwcGluZyB7CiAgICBmdW5jdGlvbiBpbnNlcnQoaXRtYXAgc3RvcmFnZSBzZWxmLCB1aW50IGtleSwgdWludCB2YWx1ZSkgaW50ZXJuYWwgcmV0dXJucyAoYm9vbCByZXBsYWNlZCkgewogICAgICAgIHVpbnQga2V5SW5kZXggPSBzZWxmLmRhdGFba2V5XS5rZXlJbmRleDsKICAgICAgICBzZWxmLmRhdGFba2V5XS52YWx1ZSA9IHZhbHVlOwogICAgICAgIGlmIChrZXlJbmRleCA+IDApCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIGVsc2UgewogICAgICAgICAgICBrZXlJbmRleCA9IHNlbGYua2V5cy5sZW5ndGg7CiAgICAgICAgICAgIHNlbGYua2V5cy5wdXNoKCk7CiAgICAgICAgICAgIHNlbGYuZGF0YVtrZXldLmtleUluZGV4ID0ga2V5SW5kZXggKyAxOwogICAgICAgICAgICBzZWxmLmtleXNba2V5SW5kZXhdLmtleSA9IGtleTsKICAgICAgICAgICAgc2VsZi5zaXplKys7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gcmVtb3ZlKGl0bWFwIHN0b3JhZ2Ugc2VsZiwgdWludCBrZXkpIGludGVybmFsIHJldHVybnMgKGJvb2wgc3VjY2VzcykgewogICAgICAgIHVpbnQga2V5SW5kZXggPSBzZWxmLmRhdGFba2V5XS5rZXlJbmRleDsKICAgICAgICBpZiAoa2V5SW5kZXggPT0gMCkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGRlbGV0ZSBzZWxmLmRhdGFba2V5XTsKICAgICAgICBzZWxmLmtleXNba2V5SW5kZXggLSAxXS5kZWxldGVkID0gdHJ1ZTsKICAgICAgICBzZWxmLnNpemUgLS07CiAgICB9CgogICAgZnVuY3Rpb24gY29udGFpbnMoaXRtYXAgc3RvcmFnZSBzZWxmLCB1aW50IGtleSkgaW50ZXJuYWwgdmlldyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIHNlbGYuZGF0YVtrZXldLmtleUluZGV4ID4gMDsKICAgIH0KCiAgICBmdW5jdGlvbiBpdGVyYXRlU3RhcnQoaXRtYXAgc3RvcmFnZSBzZWxmKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKEl0ZXJhdG9yKSB7CiAgICAgICAgcmV0dXJuIGl0ZXJhdG9yU2tpcERlbGV0ZWQoc2VsZiwgMCk7CiAgICB9CgogICAgZnVuY3Rpb24gaXRlcmF0ZVZhbGlkKGl0bWFwIHN0b3JhZ2Ugc2VsZiwgSXRlcmF0b3IgaXRlcmF0b3IpIGludGVybmFsIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBJdGVyYXRvci51bndyYXAoaXRlcmF0b3IpIDwgc2VsZi5rZXlzLmxlbmd0aDsKICAgIH0KCiAgICBmdW5jdGlvbiBpdGVyYXRlTmV4dChpdG1hcCBzdG9yYWdlIHNlbGYsIEl0ZXJhdG9yIGl0ZXJhdG9yKSBpbnRlcm5hbCB2aWV3IHJldHVybnMgKEl0ZXJhdG9yKSB7CiAgICAgICAgcmV0dXJuIGl0ZXJhdG9yU2tpcERlbGV0ZWQoc2VsZiwgSXRlcmF0b3IudW53cmFwKGl0ZXJhdG9yKSArIDEpOwogICAgfQoKICAgIGZ1bmN0aW9uIGl0ZXJhdGVHZXQoaXRtYXAgc3RvcmFnZSBzZWxmLCBJdGVyYXRvciBpdGVyYXRvcikgaW50ZXJuYWwgdmlldyByZXR1cm5zICh1aW50IGtleSwgdWludCB2YWx1ZSkgewogICAgICAgIHVpbnQga2V5SW5kZXggPSBJdGVyYXRvci51bndyYXAoaXRlcmF0b3IpOwogICAgICAgIGtleSA9IHNlbGYua2V5c1trZXlJbmRleF0ua2V5OwogICAgICAgIHZhbHVlID0gc2VsZi5kYXRhW2tleV0udmFsdWU7CiAgICB9CgogICAgZnVuY3Rpb24gaXRlcmF0b3JTa2lwRGVsZXRlZChpdG1hcCBzdG9yYWdlIHNlbGYsIHVpbnQga2V5SW5kZXgpIHByaXZhdGUgdmlldyByZXR1cm5zIChJdGVyYXRvcikgewogICAgICAgIHdoaWxlIChrZXlJbmRleCA8IHNlbGYua2V5cy5sZW5ndGggJiYgc2VsZi5rZXlzW2tleUluZGV4XS5kZWxldGVkKQogICAgICAgICAgICBrZXlJbmRleCsrOwogICAgICAgIHJldHVybiBJdGVyYXRvci53cmFwKGtleUluZGV4KTsKICAgIH0KfQoKLy8gSG93IHRvIHVzZSBpdApjb250cmFjdCBVc2VyIHsKICAgIC8vIEp1c3QgYSBzdHJ1Y3QgaG9sZGluZyBvdXIgZGF0YS4KICAgIGl0bWFwIGRhdGE7CiAgICAvLyBBcHBseSBsaWJyYXJ5IGZ1bmN0aW9ucyB0byB0aGUgZGF0YSB0eXBlLgogICAgdXNpbmcgSXRlcmFibGVNYXBwaW5nIGZvciBpdG1hcDsKCiAgICAvLyBJbnNlcnQgc29tZXRoaW5nCiAgICBmdW5jdGlvbiBpbnNlcnQodWludCBrLCB1aW50IHYpIHB1YmxpYyByZXR1cm5zICh1aW50IHNpemUpIHsKICAgICAgICAvLyBUaGlzIGNhbGxzIEl0ZXJhYmxlTWFwcGluZy5pbnNlcnQoZGF0YSwgaywgdikKICAgICAgICBkYXRhLmluc2VydChrLCB2KTsKICAgICAgICAvLyBXZSBjYW4gc3RpbGwgYWNjZXNzIG1lbWJlcnMgb2YgdGhlIHN0cnVjdCwKICAgICAgICAvLyBidXQgd2Ugc2hvdWxkIHRha2UgY2FyZSBub3QgdG8gbWVzcyB3aXRoIHRoZW0uCiAgICAgICAgcmV0dXJuIGRhdGEuc2l6ZTsKICAgIH0KCiAgICAvLyBDb21wdXRlcyB0aGUgc3VtIG9mIGFsbCBzdG9yZWQgZGF0YS4KICAgIGZ1bmN0aW9uIHN1bSgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQgcykgewogICAgICAgIGZvciAoCiAgICAgICAgICAgIEl0ZXJhdG9yIGkgPSBkYXRhLml0ZXJhdGVTdGFydCgpOwogICAgICAgICAgICBkYXRhLml0ZXJhdGVWYWxpZChpKTsKICAgICAgICAgICAgaSA9IGRhdGEuaXRlcmF0ZU5leHQoaSkKICAgICAgICApIHsKICAgICAgICAgICAgKCwgdWludCB2YWx1ZSkgPSBkYXRhLml0ZXJhdGVHZXQoaSk7CiAgICAgICAgICAgIHMgKz0gdmFsdWU7CiAgICAgICAgfQogICAgfQp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.8.8</span><span class="p">;</span><span class="w"></span>

<span class="kt">struct</span><span class="w"> </span><span class="nv">IndexValue</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">keyIndex</span><span class="p">;</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">value</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="kt">struct</span><span class="w"> </span><span class="nv">KeyFlag</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">key</span><span class="p">;</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nv">deleted</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="kt">struct</span><span class="w"> </span><span class="nv">itmap</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span>IndexValue<span class="p">)</span><span class="w"> </span>data<span class="p">;</span><span class="w"></span>
<span class="w">    </span>KeyFlag<span class="p">[]</span><span class="w"> </span>keys<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="nv">size</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

type<span class="w"> </span>Iterator<span class="w"> </span><span class="kt">is</span><span class="w"> </span><span class="kt">uint</span><span class="p">;</span><span class="w"></span>

<span class="kt">library</span><span class="w"> </span>IterableMapping<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">insert</span><span class="p">(</span>itmap<span class="w"> </span>storage<span class="w"> </span>self<span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">key</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="nv">replaced</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="w"> </span><span class="nv">keyIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>self<span class="p">.</span>data<span class="p">[</span>key<span class="p">].</span>keyIndex<span class="p">;</span><span class="w"></span>
<span class="w">        </span>self<span class="p">.</span>data<span class="p">[</span>key<span class="p">].</span>value<span class="w"> </span><span class="o">=</span><span class="w"> </span>value<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>keyIndex<span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="kt">return</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span>keyIndex<span class="w"> </span><span class="o">=</span><span class="w"> </span>self<span class="p">.</span>keys<span class="p">.</span>length<span class="p">;</span><span class="w"></span>
<span class="w">            </span>self<span class="p">.</span>keys<span class="p">.</span>push<span class="p">();</span><span class="w"></span>
<span class="w">            </span>self<span class="p">.</span>data<span class="p">[</span>key<span class="p">].</span>keyIndex<span class="w"> </span><span class="o">=</span><span class="w"> </span>keyIndex<span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span>self<span class="p">.</span>keys<span class="p">[</span>keyIndex<span class="p">].</span>key<span class="w"> </span><span class="o">=</span><span class="w"> </span>key<span class="p">;</span><span class="w"></span>
<span class="w">            </span>self<span class="p">.</span>size<span class="o">++</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="kt">return</span><span class="w"> </span><span class="kt">false</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">remove</span><span class="p">(</span>itmap<span class="w"> </span>storage<span class="w"> </span>self<span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">key</span><span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="nv">success</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="w"> </span><span class="nv">keyIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>self<span class="p">.</span>data<span class="p">[</span>key<span class="p">].</span>keyIndex<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>keyIndex<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="kt">return</span><span class="w"> </span><span class="kt">false</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span>delete<span class="w"> </span>self<span class="p">.</span>data<span class="p">[</span>key<span class="p">];</span><span class="w"></span>
<span class="w">        </span>self<span class="p">.</span>keys<span class="p">[</span>keyIndex<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">].</span>deleted<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span>self<span class="p">.</span>size<span class="w"> </span><span class="o">--</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">contains</span><span class="p">(</span>itmap<span class="w"> </span>storage<span class="w"> </span>self<span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">key</span><span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>self<span class="p">.</span>data<span class="p">[</span>key<span class="p">].</span>keyIndex<span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">iterateStart</span><span class="p">(</span>itmap<span class="w"> </span>storage<span class="w"> </span>self<span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span>Iterator<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>iteratorSkipDeleted<span class="p">(</span>self<span class="p">,</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">iterateValid</span><span class="p">(</span>itmap<span class="w"> </span>storage<span class="w"> </span>self<span class="p">,</span><span class="w"> </span>Iterator<span class="w"> </span>iterator<span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>Iterator<span class="p">.</span>unwrap<span class="p">(</span>iterator<span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>self<span class="p">.</span>keys<span class="p">.</span>length<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">iterateNext</span><span class="p">(</span>itmap<span class="w"> </span>storage<span class="w"> </span>self<span class="p">,</span><span class="w"> </span>Iterator<span class="w"> </span>iterator<span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span>Iterator<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>iteratorSkipDeleted<span class="p">(</span>self<span class="p">,</span><span class="w"> </span>Iterator<span class="p">.</span>unwrap<span class="p">(</span>iterator<span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">iterateGet</span><span class="p">(</span>itmap<span class="w"> </span>storage<span class="w"> </span>self<span class="p">,</span><span class="w"> </span>Iterator<span class="w"> </span>iterator<span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">key</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="w"> </span><span class="nv">keyIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Iterator<span class="p">.</span>unwrap<span class="p">(</span>iterator<span class="p">);</span><span class="w"></span>
<span class="w">        </span>key<span class="w"> </span><span class="o">=</span><span class="w"> </span>self<span class="p">.</span>keys<span class="p">[</span>keyIndex<span class="p">].</span>key<span class="p">;</span><span class="w"></span>
<span class="w">        </span>value<span class="w"> </span><span class="o">=</span><span class="w"> </span>self<span class="p">.</span>data<span class="p">[</span>key<span class="p">].</span>value<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">iteratorSkipDeleted</span><span class="p">(</span>itmap<span class="w"> </span>storage<span class="w"> </span>self<span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">keyIndex</span><span class="p">)</span><span class="w"> </span><span class="kt">private</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span>Iterator<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">while</span><span class="w"> </span><span class="p">(</span>keyIndex<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>self<span class="p">.</span>keys<span class="p">.</span>length<span class="w"> </span><span class="err">&amp;&amp;</span><span class="w"> </span>self<span class="p">.</span>keys<span class="p">[</span>keyIndex<span class="p">].</span>deleted<span class="p">)</span><span class="w"></span>
<span class="w">            </span>keyIndex<span class="o">++</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>Iterator<span class="p">.</span>wrap<span class="p">(</span>keyIndex<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// How to use it</span>
<span class="k">contract</span><span class="w"> </span><span class="ni">User</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Just a struct holding our data.</span>
<span class="w">    </span>itmap<span class="w"> </span>data<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Apply library functions to the data type.</span>
<span class="w">    </span>using<span class="w"> </span>IterableMapping<span class="w"> </span><span class="kt">for</span><span class="w"> </span>itmap<span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Insert something</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">insert</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">k</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">v</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">size</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// This calls IterableMapping.insert(data, k, v)</span>
<span class="w">        </span>data<span class="p">.</span>insert<span class="p">(</span>k<span class="p">,</span><span class="w"> </span>v<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// We can still access members of the struct,</span>
<span class="w">        </span><span class="c1">// but we should take care not to mess with them.</span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>data<span class="p">.</span>size<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Computes the sum of all stored data.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">sum</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">s</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">for</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">            </span>Iterator<span class="w"> </span>i<span class="w"> </span><span class="o">=</span><span class="w"> </span>data<span class="p">.</span>iterateStart<span class="p">();</span><span class="w"></span>
<span class="w">            </span>data<span class="p">.</span>iterateValid<span class="p">(</span>i<span class="p">);</span><span class="w"></span>
<span class="w">            </span>i<span class="w"> </span><span class="o">=</span><span class="w"> </span>data<span class="p">.</span>iterateNext<span class="p">(</span>i<span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="p">(,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>data<span class="p">.</span>iterateGet<span class="p">(</span>i<span class="p">);</span><span class="w"></span>
<span class="w">            </span>s<span class="w"> </span><span class="o">+=</span><span class="w"> </span>value<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
<section id="operators">
<span id="index-27"></span><h3>Operators<a class="headerlink" href="#operators" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Arithmetic and bit operators can be applied even if the two operands do not have the same type.
For example, you can compute <code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">x</span> <span class="pre">+</span> <span class="pre">z</span></code>, where <code class="docutils literal notranslate"><span class="pre">x</span></code> is a <code class="docutils literal notranslate"><span class="pre">uint8</span></code> and <code class="docutils literal notranslate"><span class="pre">z</span></code> has
the type <code class="docutils literal notranslate"><span class="pre">int32</span></code>. In these cases, the following mechanism will be used to determine
the type in which the operation is computed (this is important in case of overflow)
and the type of the operator‚Äôs result:</p>
<ol class="arabic simple">
<li><p>If the type of the right operand can be implicitly converted to the type of the left
operand, use the type of the left operand,</p></li>
<li><p>if the type of the left operand can be implicitly converted to the type of the right
operand, use the type of the right operand,</p></li>
<li><p>otherwise, the operation is not allowed.</p></li>
</ol>
<p>In case one of the operands is a <a class="reference internal" href="#rational-literals"><span class="std std-ref">literal number</span></a> it is first converted to its
‚Äúmobile type‚Äù, which is the smallest type that can hold the value
(unsigned types of the same bit-width are considered ‚Äúsmaller‚Äù than the signed types).
If both are literal numbers, the operation is computed with arbitrary precision.</p>
<p>The operator‚Äôs result type is the same as the type the operation is performed in,
except for comparison operators where the result is always <code class="docutils literal notranslate"><span class="pre">bool</span></code>.</p>
<p>The operators <code class="docutils literal notranslate"><span class="pre">**</span></code> (exponentiation), <code class="docutils literal notranslate"><span class="pre">&lt;&lt;</span></code>  and <code class="docutils literal notranslate"><span class="pre">&gt;&gt;</span></code> use the type of the
left operand for the operation and the result.</p>
<section id="ternary-operator">
<h4>Ternary Operator<a class="headerlink" href="#ternary-operator" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>The ternary operator is used in expressions of the form <code class="docutils literal notranslate"><span class="pre">&lt;expression&gt;</span> <span class="pre">?</span> <span class="pre">&lt;trueExpression&gt;</span> <span class="pre">:</span> <span class="pre">&lt;falseExpression&gt;</span></code>.
It evaluates one of the latter two given expressions depending upon the result of the evaluation of the main <code class="docutils literal notranslate"><span class="pre">&lt;expression&gt;</span></code>.
If <code class="docutils literal notranslate"><span class="pre">&lt;expression&gt;</span></code> evaluates to <code class="docutils literal notranslate"><span class="pre">true</span></code>, then <code class="docutils literal notranslate"><span class="pre">&lt;trueExpression&gt;</span></code> will be evaluated, otherwise <code class="docutils literal notranslate"><span class="pre">&lt;falseExpression&gt;</span></code> is evaluated.</p>
<p>The result of the ternary operator does not have a rational number type, even if all of its operands are rational number literals.
The result type is determined from the types of the two operands in the same way as above, converting to their mobile type first if required.</p>
<p>As a consequence, <code class="docutils literal notranslate"><span class="pre">255</span> <span class="pre">+</span> <span class="pre">(true</span> <span class="pre">?</span> <span class="pre">1</span> <span class="pre">:</span> <span class="pre">0)</span></code> will revert due to arithmetic overflow.
The reason is that <code class="docutils literal notranslate"><span class="pre">(true</span> <span class="pre">?</span> <span class="pre">1</span> <span class="pre">:</span> <span class="pre">0)</span></code> is of <code class="docutils literal notranslate"><span class="pre">uint8</span></code> type, which forces the addition to be performed in <code class="docutils literal notranslate"><span class="pre">uint8</span></code> as well,
and 256 exceeds the range allowed for this type.</p>
<p>Another consequence is that an expression like <code class="docutils literal notranslate"><span class="pre">1.5</span> <span class="pre">+</span> <span class="pre">1.5</span></code> is valid but <code class="docutils literal notranslate"><span class="pre">1.5</span> <span class="pre">+</span> <span class="pre">(true</span> <span class="pre">?</span> <span class="pre">1.5</span> <span class="pre">:</span> <span class="pre">2.5)</span></code> is not.
This is because the former is a rational expression evaluated in unlimited precision and only its final value matters.
The latter involves a conversion of a fractional rational number to an integer, which is currently disallowed.</p>
</section>
<section id="compound-and-increment-decrement-operators">
<span id="index-28"></span><h4>Compound and Increment/Decrement Operators<a class="headerlink" href="#compound-and-increment-decrement-operators" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>If <code class="docutils literal notranslate"><span class="pre">a</span></code> is an LValue (i.e. a variable or something that can be assigned to), the
following operators are available as shorthands:</p>
<p><code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">+=</span> <span class="pre">e</span></code> is equivalent to <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">=</span> <span class="pre">a</span> <span class="pre">+</span> <span class="pre">e</span></code>. The operators <code class="docutils literal notranslate"><span class="pre">-=</span></code>, <code class="docutils literal notranslate"><span class="pre">*=</span></code>, <code class="docutils literal notranslate"><span class="pre">/=</span></code>, <code class="docutils literal notranslate"><span class="pre">%=</span></code>,
<code class="docutils literal notranslate"><span class="pre">|=</span></code>, <code class="docutils literal notranslate"><span class="pre">&amp;=</span></code>, <code class="docutils literal notranslate"><span class="pre">^=</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;&lt;=</span></code> and <code class="docutils literal notranslate"><span class="pre">&gt;&gt;=</span></code> are defined accordingly. <code class="docutils literal notranslate"><span class="pre">a++</span></code> and <code class="docutils literal notranslate"><span class="pre">a--</span></code> are equivalent
to <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">+=</span> <span class="pre">1</span></code> / <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">-=</span> <span class="pre">1</span></code> but the expression itself still has the previous value
of <code class="docutils literal notranslate"><span class="pre">a</span></code>. In contrast, <code class="docutils literal notranslate"><span class="pre">--a</span></code> and <code class="docutils literal notranslate"><span class="pre">++a</span></code> have the same effect on <code class="docutils literal notranslate"><span class="pre">a</span></code> but
return the value after the change.</p>
</section>
<section id="delete">
<span id="index-29"></span><span id="id19"></span><h4>delete<a class="headerlink" href="#delete" title="Permalink to this heading">ÔÉÅ</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">delete</span> <span class="pre">a</span></code> assigns the initial value for the type to <code class="docutils literal notranslate"><span class="pre">a</span></code>. I.e. for integers it is
equivalent to <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">=</span> <span class="pre">0</span></code>, but it can also be used on arrays, where it assigns a dynamic
array of length zero or a static array of the same length with all elements set to their
initial value. <code class="docutils literal notranslate"><span class="pre">delete</span> <span class="pre">a[x]</span></code> deletes the item at index <code class="docutils literal notranslate"><span class="pre">x</span></code> of the array and leaves
all other elements and the length of the array untouched. This especially means that it leaves
a gap in the array. If you plan to remove items, a <a class="reference internal" href="#mapping-types"><span class="std std-ref">mapping</span></a> is probably a better choice.</p>
<p>For structs, it assigns a struct with all members reset. In other words,
the value of <code class="docutils literal notranslate"><span class="pre">a</span></code> after <code class="docutils literal notranslate"><span class="pre">delete</span> <span class="pre">a</span></code> is the same as if <code class="docutils literal notranslate"><span class="pre">a</span></code> would be declared
without assignment, with the following caveat:</p>
<p><code class="docutils literal notranslate"><span class="pre">delete</span></code> has no effect on mappings (as the keys of mappings may be arbitrary and
are generally unknown). So if you delete a struct, it will reset all members that
are not mappings and also recurse into the members unless they are mappings.
However, individual keys and what they map to can be deleted: If <code class="docutils literal notranslate"><span class="pre">a</span></code> is a
mapping, then <code class="docutils literal notranslate"><span class="pre">delete</span> <span class="pre">a[x]</span></code> will delete the value stored at <code class="docutils literal notranslate"><span class="pre">x</span></code>.</p>
<p>It is important to note that <code class="docutils literal notranslate"><span class="pre">delete</span> <span class="pre">a</span></code> really behaves like an
assignment to <code class="docutils literal notranslate"><span class="pre">a</span></code>, i.e. it stores a new object in <code class="docutils literal notranslate"><span class="pre">a</span></code>.
This distinction is visible when <code class="docutils literal notranslate"><span class="pre">a</span></code> is reference variable: It
will only reset <code class="docutils literal notranslate"><span class="pre">a</span></code> itself, not the
value it referred to previously.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC40LjAgPDAuOS4wOwoKY29udHJhY3QgRGVsZXRlRXhhbXBsZSB7CiAgICB1aW50IGRhdGE7CiAgICB1aW50W10gZGF0YUFycmF5OwoKICAgIGZ1bmN0aW9uIGYoKSBwdWJsaWMgewogICAgICAgIHVpbnQgeCA9IGRhdGE7CiAgICAgICAgZGVsZXRlIHg7IC8vIHNldHMgeCB0byAwLCBkb2VzIG5vdCBhZmZlY3QgZGF0YQogICAgICAgIGRlbGV0ZSBkYXRhOyAvLyBzZXRzIGRhdGEgdG8gMCwgZG9lcyBub3QgYWZmZWN0IHgKICAgICAgICB1aW50W10gc3RvcmFnZSB5ID0gZGF0YUFycmF5OwogICAgICAgIGRlbGV0ZSBkYXRhQXJyYXk7IC8vIHRoaXMgc2V0cyBkYXRhQXJyYXkubGVuZ3RoIHRvIHplcm8sIGJ1dCBhcyB1aW50W10gaXMgYSBjb21wbGV4IG9iamVjdCwgYWxzbwogICAgICAgIC8vIHkgaXMgYWZmZWN0ZWQgd2hpY2ggaXMgYW4gYWxpYXMgdG8gdGhlIHN0b3JhZ2Ugb2JqZWN0CiAgICAgICAgLy8gT24gdGhlIG90aGVyIGhhbmQ6ICJkZWxldGUgeSIgaXMgbm90IHZhbGlkLCBhcyBhc3NpZ25tZW50cyB0byBsb2NhbCB2YXJpYWJsZXMKICAgICAgICAvLyByZWZlcmVuY2luZyBzdG9yYWdlIG9iamVjdHMgY2FuIG9ubHkgYmUgbWFkZSBmcm9tIGV4aXN0aW5nIHN0b3JhZ2Ugb2JqZWN0cy4KICAgICAgICBhc3NlcnQoeS5sZW5ndGggPT0gMCk7CiAgICB9Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.4.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">DeleteExample</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="nv">data</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="p">[]</span><span class="w"> </span>dataArray<span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">f</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>data<span class="p">;</span><span class="w"></span>
<span class="w">        </span>delete<span class="w"> </span>x<span class="p">;</span><span class="w"> </span><span class="c1">// sets x to 0, does not affect data</span>
<span class="w">        </span>delete<span class="w"> </span>data<span class="p">;</span><span class="w"> </span><span class="c1">// sets data to 0, does not affect x</span>
<span class="w">        </span><span class="kt">uint</span><span class="p">[]</span><span class="w"> </span>storage<span class="w"> </span>y<span class="w"> </span><span class="o">=</span><span class="w"> </span>dataArray<span class="p">;</span><span class="w"></span>
<span class="w">        </span>delete<span class="w"> </span>dataArray<span class="p">;</span><span class="w"> </span><span class="c1">// this sets dataArray.length to zero, but as uint[] is a complex object, also</span>
<span class="w">        </span><span class="c1">// y is affected which is an alias to the storage object</span>
<span class="w">        </span><span class="c1">// On the other hand: &quot;delete y&quot; is not valid, as assignments to local variables</span>
<span class="w">        </span><span class="c1">// referencing storage objects can only be made from existing storage objects.</span>
<span class="w">        </span>assert<span class="p">(</span>y<span class="p">.</span>length<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="order-of-precedence-of-operators">
<span id="order"></span><span id="index-30"></span><h4>Order of Precedence of Operators<a class="headerlink" href="#order-of-precedence-of-operators" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>The following is the order of precedence for operators, listed in order of evaluation.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 13%" />
<col style="width: 40%" />
<col style="width: 47%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Precedence</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Operator</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td rowspan="6"><p><em>1</em></p></td>
<td><p>Postfix increment and decrement</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">++</span></code>, <code class="docutils literal notranslate"><span class="pre">--</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>New expression</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">new</span> <span class="pre">&lt;typename&gt;</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Array subscripting</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;array&gt;[&lt;index&gt;]</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Member access</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;object&gt;.&lt;member&gt;</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Function-like call</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;func&gt;(&lt;args...&gt;)</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Parentheses</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">(&lt;statement&gt;)</span></code></p></td>
</tr>
<tr class="row-even"><td rowspan="5"><p><em>2</em></p></td>
<td><p>Prefix increment and decrement</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">++</span></code>, <code class="docutils literal notranslate"><span class="pre">--</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Unary minus</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">-</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Unary operations</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">delete</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Logical NOT</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">!</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Bitwise NOT</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">~</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><em>3</em></p></td>
<td><p>Exponentiation</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">**</span></code></p></td>
</tr>
<tr class="row-even"><td><p><em>4</em></p></td>
<td><p>Multiplication, division and modulo</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code>, <code class="docutils literal notranslate"><span class="pre">/</span></code>, <code class="docutils literal notranslate"><span class="pre">%</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><em>5</em></p></td>
<td><p>Addition and subtraction</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">+</span></code>, <code class="docutils literal notranslate"><span class="pre">-</span></code></p></td>
</tr>
<tr class="row-even"><td><p><em>6</em></p></td>
<td><p>Bitwise shift operators</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;&lt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;&gt;</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><em>7</em></p></td>
<td><p>Bitwise AND</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&amp;</span></code></p></td>
</tr>
<tr class="row-even"><td><p><em>8</em></p></td>
<td><p>Bitwise XOR</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">^</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><em>9</em></p></td>
<td><p>Bitwise OR</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">|</span></code></p></td>
</tr>
<tr class="row-even"><td><p><em>10</em></p></td>
<td><p>Inequality operators</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;=</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;=</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><em>11</em></p></td>
<td><p>Equality operators</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">==</span></code>, <code class="docutils literal notranslate"><span class="pre">!=</span></code></p></td>
</tr>
<tr class="row-even"><td><p><em>12</em></p></td>
<td><p>Logical AND</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><em>13</em></p></td>
<td><p>Logical OR</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">||</span></code></p></td>
</tr>
<tr class="row-even"><td rowspan="2"><p><em>14</em></p></td>
<td><p>Ternary operator</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;conditional&gt;</span> <span class="pre">?</span> <span class="pre">&lt;if-true&gt;</span> <span class="pre">:</span> <span class="pre">&lt;if-false&gt;</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Assignment operators</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">=</span></code>, <code class="docutils literal notranslate"><span class="pre">|=</span></code>, <code class="docutils literal notranslate"><span class="pre">^=</span></code>, <code class="docutils literal notranslate"><span class="pre">&amp;=</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;&lt;=</span></code>,
<code class="docutils literal notranslate"><span class="pre">&gt;&gt;=</span></code>, <code class="docutils literal notranslate"><span class="pre">+=</span></code>, <code class="docutils literal notranslate"><span class="pre">-=</span></code>, <code class="docutils literal notranslate"><span class="pre">*=</span></code>, <code class="docutils literal notranslate"><span class="pre">/=</span></code>,
<code class="docutils literal notranslate"><span class="pre">%=</span></code></p></td>
</tr>
<tr class="row-even"><td><p><em>15</em></p></td>
<td><p>Comma operator</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">,</span></code></p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="conversions-between-elementary-types">
<span id="types-conversion-elementary-types"></span><span id="index-31"></span><h3>Conversions between Elementary Types<a class="headerlink" href="#conversions-between-elementary-types" title="Permalink to this heading">ÔÉÅ</a></h3>
<section id="implicit-conversions">
<h4>Implicit Conversions<a class="headerlink" href="#implicit-conversions" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>An implicit type conversion is automatically applied by the compiler in some cases
during assignments, when passing arguments to functions and when applying operators.
In general, an implicit conversion between value-types is possible if it makes
sense semantically and no information is lost.</p>
<p>For example, <code class="docutils literal notranslate"><span class="pre">uint8</span></code> is convertible to
<code class="docutils literal notranslate"><span class="pre">uint16</span></code> and <code class="docutils literal notranslate"><span class="pre">int128</span></code> to <code class="docutils literal notranslate"><span class="pre">int256</span></code>, but <code class="docutils literal notranslate"><span class="pre">int8</span></code> is not convertible to <code class="docutils literal notranslate"><span class="pre">uint256</span></code>,
because <code class="docutils literal notranslate"><span class="pre">uint256</span></code> cannot hold values such as <code class="docutils literal notranslate"><span class="pre">-1</span></code>.</p>
<p>If an operator is applied to different types, the compiler tries to implicitly
convert one of the operands to the type of the other (the same is true for assignments).
This means that operations are always performed in the type of one of the operands.</p>
<p>For more details about which implicit conversions are possible,
please consult the sections about the types themselves.</p>
<p>In the example below, <code class="docutils literal notranslate"><span class="pre">y</span></code> and <code class="docutils literal notranslate"><span class="pre">z</span></code>, the operands of the addition,
do not have the same type, but <code class="docutils literal notranslate"><span class="pre">uint8</span></code> can
be implicitly converted to <code class="docutils literal notranslate"><span class="pre">uint16</span></code> and not vice-versa. Because of that,
<code class="docutils literal notranslate"><span class="pre">y</span></code> is converted to the type of <code class="docutils literal notranslate"><span class="pre">z</span></code> before the addition is performed
in the <code class="docutils literal notranslate"><span class="pre">uint16</span></code> type. The resulting type of the expression <code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">+</span> <span class="pre">z</span></code> is <code class="docutils literal notranslate"><span class="pre">uint16</span></code>.
Because it is assigned to a variable of type <code class="docutils literal notranslate"><span class="pre">uint32</span></code> another implicit conversion
is performed after the addition.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=dWludDggeTsKdWludDE2IHo7CnVpbnQzMiB4ID0geSArIHo7"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">uint8</span><span class="w"> </span><span class="nv">y</span><span class="p">;</span><span class="w"></span>
<span class="kt">uint16</span><span class="w"> </span><span class="nv">z</span><span class="p">;</span><span class="w"></span>
<span class="kt">uint32</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>y<span class="w"> </span><span class="o">+</span><span class="w"> </span>z<span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="explicit-conversions">
<h4>Explicit Conversions<a class="headerlink" href="#explicit-conversions" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>If the compiler does not allow implicit conversion but you are confident a conversion will work,
an explicit type conversion is sometimes possible. This may
result in unexpected behaviour and allows you to bypass some security
features of the compiler, so be sure to test that the
result is what you want and expect!</p>
<p>Take the following example that converts a negative <code class="docutils literal notranslate"><span class="pre">int</span></code> to a <code class="docutils literal notranslate"><span class="pre">uint</span></code>:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=aW50ICB5ID0gLTM7CnVpbnQgeCA9IHVpbnQoeSk7"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w">  </span><span class="nv">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="m m-Decimal">3</span><span class="p">;</span><span class="w"></span>
<span class="kt">uint</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">uint</span><span class="p">(</span>y<span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>At the end of this code snippet, <code class="docutils literal notranslate"><span class="pre">x</span></code> will have the value <code class="docutils literal notranslate"><span class="pre">0xfffff..fd</span></code> (64 hex
characters), which is -3 in the two‚Äôs complement representation of 256 bits.</p>
<p>If an integer is explicitly converted to a smaller type, higher-order bits are
cut off:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=dWludDMyIGEgPSAweDEyMzQ1Njc4Owp1aW50MTYgYiA9IHVpbnQxNihhKTsgLy8gYiB3aWxsIGJlIDB4NTY3OCBub3c="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">uint32</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x12345678</span><span class="p">;</span><span class="w"></span>
<span class="kt">uint16</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">uint16</span><span class="p">(</span>a<span class="p">);</span><span class="w"> </span><span class="c1">// b will be 0x5678 now</span>
</pre></div>
</div>
<p>If an integer is explicitly converted to a larger type, it is padded on the left (i.e., at the higher order end).
The result of the conversion will compare equal to the original integer:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=dWludDE2IGEgPSAweDEyMzQ7CnVpbnQzMiBiID0gdWludDMyKGEpOyAvLyBiIHdpbGwgYmUgMHgwMDAwMTIzNCBub3cKYXNzZXJ0KGEgPT0gYik7"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">uint16</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x1234</span><span class="p">;</span><span class="w"></span>
<span class="kt">uint32</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">uint32</span><span class="p">(</span>a<span class="p">);</span><span class="w"> </span><span class="c1">// b will be 0x00001234 now</span>
assert<span class="p">(</span>a<span class="w"> </span><span class="o">==</span><span class="w"> </span>b<span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>Fixed-size bytes types behave differently during conversions. They can be thought of as
sequences of individual bytes and converting to a smaller type will cut off the
sequence:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ynl0ZXMyIGEgPSAweDEyMzQ7CmJ5dGVzMSBiID0gYnl0ZXMxKGEpOyAvLyBiIHdpbGwgYmUgMHgxMg=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span>bytes2<span class="w"> </span>a<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x1234</span><span class="p">;</span><span class="w"></span>
bytes1<span class="w"> </span>b<span class="w"> </span><span class="o">=</span><span class="w"> </span>bytes1<span class="p">(</span>a<span class="p">);</span><span class="w"> </span><span class="c1">// b will be 0x12</span>
</pre></div>
</div>
<p>If a fixed-size bytes type is explicitly converted to a larger type, it is padded on
the right. Accessing the byte at a fixed index will result in the same value before and
after the conversion (if the index is still in range):</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ynl0ZXMyIGEgPSAweDEyMzQ7CmJ5dGVzNCBiID0gYnl0ZXM0KGEpOyAvLyBiIHdpbGwgYmUgMHgxMjM0MDAwMAphc3NlcnQoYVswXSA9PSBiWzBdKTsKYXNzZXJ0KGFbMV0gPT0gYlsxXSk7"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span>bytes2<span class="w"> </span>a<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x1234</span><span class="p">;</span><span class="w"></span>
bytes4<span class="w"> </span>b<span class="w"> </span><span class="o">=</span><span class="w"> </span>bytes4<span class="p">(</span>a<span class="p">);</span><span class="w"> </span><span class="c1">// b will be 0x12340000</span>
assert<span class="p">(</span>a<span class="p">[</span><span class="m m-Decimal">0</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>b<span class="p">[</span><span class="m m-Decimal">0</span><span class="p">]);</span><span class="w"></span>
assert<span class="p">(</span>a<span class="p">[</span><span class="m m-Decimal">1</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>b<span class="p">[</span><span class="m m-Decimal">1</span><span class="p">]);</span><span class="w"></span>
</pre></div>
</div>
<p>Since integers and fixed-size byte arrays behave differently when truncating or
padding, explicit conversions between integers and fixed-size byte arrays are only allowed,
if both have the same size. If you want to convert between integers and fixed-size byte arrays of
different size, you have to use intermediate conversions that make the desired truncation and padding
rules explicit:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ynl0ZXMyIGEgPSAweDEyMzQ7CnVpbnQzMiBiID0gdWludDE2KGEpOyAvLyBiIHdpbGwgYmUgMHgwMDAwMTIzNAp1aW50MzIgYyA9IHVpbnQzMihieXRlczQoYSkpOyAvLyBjIHdpbGwgYmUgMHgxMjM0MDAwMAp1aW50OCBkID0gdWludDgodWludDE2KGEpKTsgLy8gZCB3aWxsIGJlIDB4MzQKdWludDggZSA9IHVpbnQ4KGJ5dGVzMShhKSk7IC8vIGUgd2lsbCBiZSAweDEy"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span>bytes2<span class="w"> </span>a<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x1234</span><span class="p">;</span><span class="w"></span>
<span class="kt">uint32</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">uint16</span><span class="p">(</span>a<span class="p">);</span><span class="w"> </span><span class="c1">// b will be 0x00001234</span>
<span class="kt">uint32</span><span class="w"> </span><span class="nv">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">uint32</span><span class="p">(</span>bytes4<span class="p">(</span>a<span class="p">));</span><span class="w"> </span><span class="c1">// c will be 0x12340000</span>
<span class="kt">uint8</span><span class="w"> </span><span class="nv">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">uint8</span><span class="p">(</span><span class="kt">uint16</span><span class="p">(</span>a<span class="p">));</span><span class="w"> </span><span class="c1">// d will be 0x34</span>
<span class="kt">uint8</span><span class="w"> </span><span class="nv">e</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">uint8</span><span class="p">(</span>bytes1<span class="p">(</span>a<span class="p">));</span><span class="w"> </span><span class="c1">// e will be 0x12</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">bytes</span></code> arrays and <code class="docutils literal notranslate"><span class="pre">bytes</span></code> calldata slices can be converted explicitly to fixed bytes types (<code class="docutils literal notranslate"><span class="pre">bytes1</span></code>/‚Ä¶/<code class="docutils literal notranslate"><span class="pre">bytes32</span></code>).
In case the array is longer than the target fixed bytes type, truncation at the end will happen.
If the array is shorter than the target type, it will be padded with zeros at the end.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5IF4wLjguNTsKCmNvbnRyYWN0IEMgewogICAgYnl0ZXMgcyA9ICJhYmNkZWZnaCI7CiAgICBmdW5jdGlvbiBmKGJ5dGVzIGNhbGxkYXRhIGMsIGJ5dGVzIG1lbW9yeSBtKSBwdWJsaWMgdmlldyByZXR1cm5zIChieXRlczE2LCBieXRlczMpIHsKICAgICAgICByZXF1aXJlKGMubGVuZ3RoID09IDE2LCAiIik7CiAgICAgICAgYnl0ZXMxNiBiID0gYnl0ZXMxNihtKTsgIC8vIGlmIGxlbmd0aCBvZiBtIGlzIGdyZWF0ZXIgdGhhbiAxNiwgdHJ1bmNhdGlvbiB3aWxsIGhhcHBlbgogICAgICAgIGIgPSBieXRlczE2KHMpOyAgLy8gcGFkZGVkIG9uIHRoZSByaWdodCwgc28gcmVzdWx0IGlzICJhYmNkZWZnaFwwXDBcMFwwXDBcMFwwXDAiCiAgICAgICAgYnl0ZXMzIGIxID0gYnl0ZXMzKHMpOyAvLyB0cnVuY2F0ZWQsIGIxIGVxdWFscyB0byAiYWJjIgogICAgICAgIGIgPSBieXRlczE2KGNbOjhdKTsgIC8vIGFsc28gcGFkZGVkIHdpdGggemVyb3MKICAgICAgICByZXR1cm4gKGIsIGIxKTsKICAgIH0KfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.8.5</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">C</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">bytes</span><span class="w"> </span><span class="nv">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;abcdefgh&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">f</span><span class="p">(</span><span class="kt">bytes</span><span class="w"> </span><span class="nv">calldata</span><span class="w"> </span>c<span class="p">,</span><span class="w"> </span><span class="kt">bytes</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>m<span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bytes16</span><span class="p">,</span><span class="w"> </span>bytes3<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>c<span class="p">.</span>length<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m m-Decimal">16</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">bytes16</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">bytes16</span><span class="p">(</span>m<span class="p">);</span><span class="w">  </span><span class="c1">// if length of m is greater than 16, truncation will happen</span>
<span class="w">        </span>b<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">bytes16</span><span class="p">(</span>s<span class="p">);</span><span class="w">  </span><span class="c1">// padded on the right, so result is &quot;abcdefgh\0\0\0\0\0\0\0\0&quot;</span>
<span class="w">        </span>bytes3<span class="w"> </span>b1<span class="w"> </span><span class="o">=</span><span class="w"> </span>bytes3<span class="p">(</span>s<span class="p">);</span><span class="w"> </span><span class="c1">// truncated, b1 equals to &quot;abc&quot;</span>
<span class="w">        </span>b<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">bytes16</span><span class="p">(</span>c<span class="p">[:</span><span class="m m-Decimal">8</span><span class="p">]);</span><span class="w">  </span><span class="c1">// also padded with zeros</span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span><span class="p">(</span>b<span class="p">,</span><span class="w"> </span>b1<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
<section id="conversions-between-literals-and-elementary-types">
<span id="types-conversion-literals"></span><h3>Conversions between Literals and Elementary Types<a class="headerlink" href="#conversions-between-literals-and-elementary-types" title="Permalink to this heading">ÔÉÅ</a></h3>
<section id="integer-types">
<h4>Integer Types<a class="headerlink" href="#integer-types" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Decimal and hexadecimal number literals can be implicitly converted to any integer type
that is large enough to represent it without truncation:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=dWludDggYSA9IDEyOyAvLyBmaW5lCnVpbnQzMiBiID0gMTIzNDsgLy8gZmluZQp1aW50MTYgYyA9IDB4MTIzNDU2OyAvLyBmYWlscywgc2luY2UgaXQgd291bGQgaGF2ZSB0byB0cnVuY2F0ZSB0byAweDM0NTY="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">uint8</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">12</span><span class="p">;</span><span class="w"> </span><span class="c1">// fine</span>
<span class="kt">uint32</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">1234</span><span class="p">;</span><span class="w"> </span><span class="c1">// fine</span>
<span class="kt">uint16</span><span class="w"> </span><span class="nv">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x123456</span><span class="p">;</span><span class="w"> </span><span class="c1">// fails, since it would have to truncate to 0x3456</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Prior to version 0.8.0, any decimal or hexadecimal number literals could be explicitly
converted to an integer type. From 0.8.0, such explicit conversions are as strict as implicit
conversions, i.e., they are only allowed if the literal fits in the resulting range.</p>
</div>
</section>
<section id="id20">
<h4>Fixed-Size Byte Arrays<a class="headerlink" href="#id20" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Decimal number literals cannot be implicitly converted to fixed-size byte arrays. Hexadecimal
number literals can be, but only if the number of hex digits exactly fits the size of the bytes
type. As an exception both decimal and hexadecimal literals which have a value of zero can be
converted to any fixed-size bytes type:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ynl0ZXMyIGEgPSA1NDMyMTsgLy8gbm90IGFsbG93ZWQKYnl0ZXMyIGIgPSAweDEyOyAvLyBub3QgYWxsb3dlZApieXRlczIgYyA9IDB4MTIzOyAvLyBub3QgYWxsb3dlZApieXRlczIgZCA9IDB4MTIzNDsgLy8gZmluZQpieXRlczIgZSA9IDB4MDAxMjsgLy8gZmluZQpieXRlczQgZiA9IDA7IC8vIGZpbmUKYnl0ZXM0IGcgPSAweDA7IC8vIGZpbmU="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span>bytes2<span class="w"> </span>a<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">54321</span><span class="p">;</span><span class="w"> </span><span class="c1">// not allowed</span>
bytes2<span class="w"> </span>b<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x12</span><span class="p">;</span><span class="w"> </span><span class="c1">// not allowed</span>
bytes2<span class="w"> </span>c<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x123</span><span class="p">;</span><span class="w"> </span><span class="c1">// not allowed</span>
bytes2<span class="w"> </span>d<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x1234</span><span class="p">;</span><span class="w"> </span><span class="c1">// fine</span>
bytes2<span class="w"> </span>e<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0012</span><span class="p">;</span><span class="w"> </span><span class="c1">// fine</span>
bytes4<span class="w"> </span>f<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// fine</span>
bytes4<span class="w"> </span>g<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0</span><span class="p">;</span><span class="w"> </span><span class="c1">// fine</span>
</pre></div>
</div>
<p>String literals and hex string literals can be implicitly converted to fixed-size byte arrays,
if their number of characters matches the size of the bytes type:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ynl0ZXMyIGEgPSBoZXgiMTIzNCI7IC8vIGZpbmUKYnl0ZXMyIGIgPSAieHkiOyAvLyBmaW5lCmJ5dGVzMiBjID0gaGV4IjEyIjsgLy8gbm90IGFsbG93ZWQKYnl0ZXMyIGQgPSBoZXgiMTIzIjsgLy8gbm90IGFsbG93ZWQKYnl0ZXMyIGUgPSAieCI7IC8vIG5vdCBhbGxvd2VkCmJ5dGVzMiBmID0gInh5eiI7IC8vIG5vdCBhbGxvd2Vk"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span>bytes2<span class="w"> </span>a<span class="w"> </span><span class="o">=</span><span class="w"> </span>hex<span class="s2">&quot;1234&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// fine</span>
bytes2<span class="w"> </span>b<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;xy&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// fine</span>
bytes2<span class="w"> </span>c<span class="w"> </span><span class="o">=</span><span class="w"> </span>hex<span class="s2">&quot;12&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// not allowed</span>
bytes2<span class="w"> </span>d<span class="w"> </span><span class="o">=</span><span class="w"> </span>hex<span class="s2">&quot;123&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// not allowed</span>
bytes2<span class="w"> </span>e<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;x&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// not allowed</span>
bytes2<span class="w"> </span>f<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;xyz&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// not allowed</span>
</pre></div>
</div>
</section>
<section id="addresses">
<h4>Addresses<a class="headerlink" href="#addresses" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>As described in <a class="reference internal" href="#address-literals"><span class="std std-ref">Address Literals</span></a>, hex literals of the correct size that pass the checksum
test are of <code class="docutils literal notranslate"><span class="pre">address</span></code> type. No other literals can be implicitly converted to the <code class="docutils literal notranslate"><span class="pre">address</span></code> type.</p>
<p>Explicit conversions from <code class="docutils literal notranslate"><span class="pre">bytes20</span></code> or any integer type to <code class="docutils literal notranslate"><span class="pre">address</span></code> result in <code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code>.</p>
<p>An <code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">a</span></code> can be converted to <code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code> via <code class="docutils literal notranslate"><span class="pre">payable(a)</span></code>.</p>
</section>
</section>
</section>
<span id="document-units-and-global-variables"></span><section id="units-and-globally-available-variables">
<h2>Units and Globally Available Variables<a class="headerlink" href="#units-and-globally-available-variables" title="Permalink to this heading">ÔÉÅ</a></h2>
<section id="ether-units">
<span id="index-0"></span><h3>Ether Units<a class="headerlink" href="#ether-units" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>A literal number can take a suffix of <code class="docutils literal notranslate"><span class="pre">wei</span></code>, <code class="docutils literal notranslate"><span class="pre">gwei</span></code> or <code class="docutils literal notranslate"><span class="pre">ether</span></code> to specify a subdenomination of Ether, where Ether numbers without a postfix are assumed to be Wei.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=YXNzZXJ0KDEgd2VpID09IDEpOwphc3NlcnQoMSBnd2VpID09IDFlOSk7CmFzc2VydCgxIGV0aGVyID09IDFlMTgpOw=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span>assert<span class="p">(</span><span class="m m-Decimal">1</span><span class="w"> </span>wei<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">);</span><span class="w"></span>
assert<span class="p">(</span><span class="m m-Decimal">1</span><span class="w"> </span>gwei<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="err">1</span>e9<span class="p">);</span><span class="w"></span>
assert<span class="p">(</span><span class="m m-Decimal">1</span><span class="w"> </span>ether<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="err">1</span>e18<span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>The only effect of the subdenomination suffix is a multiplication by a power of ten.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The denominations <code class="docutils literal notranslate"><span class="pre">finney</span></code> and <code class="docutils literal notranslate"><span class="pre">szabo</span></code> have been removed in version 0.7.0.</p>
</div>
</section>
<section id="time-units">
<span id="index-1"></span><h3>Time Units<a class="headerlink" href="#time-units" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Suffixes like <code class="docutils literal notranslate"><span class="pre">seconds</span></code>, <code class="docutils literal notranslate"><span class="pre">minutes</span></code>, <code class="docutils literal notranslate"><span class="pre">hours</span></code>, <code class="docutils literal notranslate"><span class="pre">days</span></code> and <code class="docutils literal notranslate"><span class="pre">weeks</span></code>
after literal numbers can be used to specify units of time where seconds are the base
unit and units are considered naively in the following way:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">==</span> <span class="pre">1</span> <span class="pre">seconds</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">minutes</span> <span class="pre">==</span> <span class="pre">60</span> <span class="pre">seconds</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">hours</span> <span class="pre">==</span> <span class="pre">60</span> <span class="pre">minutes</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">days</span> <span class="pre">==</span> <span class="pre">24</span> <span class="pre">hours</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">weeks</span> <span class="pre">==</span> <span class="pre">7</span> <span class="pre">days</span></code></p></li>
</ul>
<p>Take care if you perform calendar calculations using these units, because
not every year equals 365 days and not even every day has 24 hours
because of <a class="reference external" href="https://en.wikipedia.org/wiki/Leap_second">leap seconds</a>.
Due to the fact that leap seconds cannot be predicted, an exact calendar
library has to be updated by an external oracle.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The suffix <code class="docutils literal notranslate"><span class="pre">years</span></code> has been removed in version 0.5.0 due to the reasons above.</p>
</div>
<p>These suffixes cannot be applied to variables. For example, if you want to
interpret a function parameter in days, you can in the following way:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=ZnVuY3Rpb24gZih1aW50IHN0YXJ0LCB1aW50IGRheXNBZnRlcikgcHVibGljIHsKICAgIGlmIChibG9jay50aW1lc3RhbXAgPj0gc3RhcnQgKyBkYXlzQWZ0ZXIgKiAxIGRheXMpIHsKICAgICAgLy8gLi4uCiAgICB9Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">function</span><span class="w"> </span><span class="nv">f</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">start</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">daysAfter</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span><span class="k">block.timestamp</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span>start<span class="w"> </span><span class="o">+</span><span class="w"> </span>daysAfter<span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="w"> </span>days<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="c1">// ...</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="special-variables-and-functions">
<span id="special-variables-functions"></span><h3>Special Variables and Functions<a class="headerlink" href="#special-variables-and-functions" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>There are special variables and functions which always exist in the global
namespace and are mainly used to provide information about the blockchain
or are general-use utility functions.</p>
<section id="block-and-transaction-properties">
<span id="index-2"></span><h4>Block and Transaction Properties<a class="headerlink" href="#block-and-transaction-properties" title="Permalink to this heading">ÔÉÅ</a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">blockhash(uint</span> <span class="pre">blockNumber)</span> <span class="pre">returns</span> <span class="pre">(bytes32)</span></code>: hash of the given block when <code class="docutils literal notranslate"><span class="pre">blocknumber</span></code> is one of the 256 most recent blocks; otherwise returns zero</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">block.basefee</span></code> (<code class="docutils literal notranslate"><span class="pre">uint</span></code>): current block‚Äôs base fee (<a class="reference external" href="https://eips.ethereum.org/EIPS/eip-3198">EIP-3198</a> and <a class="reference external" href="https://eips.ethereum.org/EIPS/eip-1559">EIP-1559</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">block.chainid</span></code> (<code class="docutils literal notranslate"><span class="pre">uint</span></code>): current chain id</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">block.coinbase</span></code> (<code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code>): current block miner‚Äôs address</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">block.difficulty</span></code> (<code class="docutils literal notranslate"><span class="pre">uint</span></code>): current block difficulty</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">block.gaslimit</span></code> (<code class="docutils literal notranslate"><span class="pre">uint</span></code>): current block gaslimit</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">block.number</span></code> (<code class="docutils literal notranslate"><span class="pre">uint</span></code>): current block number</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">block.timestamp</span></code> (<code class="docutils literal notranslate"><span class="pre">uint</span></code>): current block timestamp as seconds since unix epoch</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gasleft()</span> <span class="pre">returns</span> <span class="pre">(uint256)</span></code>: remaining gas</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">msg.data</span></code> (<code class="docutils literal notranslate"><span class="pre">bytes</span> <span class="pre">calldata</span></code>): complete calldata</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">msg.sender</span></code> (<code class="docutils literal notranslate"><span class="pre">address</span></code>): sender of the message (current call)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">msg.sig</span></code> (<code class="docutils literal notranslate"><span class="pre">bytes4</span></code>): first four bytes of the calldata (i.e. function identifier)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">msg.value</span></code> (<code class="docutils literal notranslate"><span class="pre">uint</span></code>): number of wei sent with the message</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tx.gasprice</span></code> (<code class="docutils literal notranslate"><span class="pre">uint</span></code>): gas price of the transaction</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tx.origin</span></code> (<code class="docutils literal notranslate"><span class="pre">address</span></code>): sender of the transaction (full call chain)</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The values of all members of <code class="docutils literal notranslate"><span class="pre">msg</span></code>, including <code class="docutils literal notranslate"><span class="pre">msg.sender</span></code> and
<code class="docutils literal notranslate"><span class="pre">msg.value</span></code> can change for every <strong>external</strong> function call.
This includes calls to library functions.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When contracts are evaluated off-chain rather than in context of a transaction included in a
block, you should not assume that <code class="docutils literal notranslate"><span class="pre">block.*</span></code> and <code class="docutils literal notranslate"><span class="pre">tx.*</span></code> refer to values from any specific
block or transaction. These values are provided by the EVM implementation that executes the
contract and can be arbitrary.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Do not rely on <code class="docutils literal notranslate"><span class="pre">block.timestamp</span></code> or <code class="docutils literal notranslate"><span class="pre">blockhash</span></code> as a source of randomness,
unless you know what you are doing.</p>
<p>Both the timestamp and the block hash can be influenced by miners to some degree.
Bad actors in the mining community can for example run a casino payout function on a chosen hash
and just retry a different hash if they did not receive any money.</p>
<p>The current block timestamp must be strictly larger than the timestamp of the last block,
but the only guarantee is that it will be somewhere between the timestamps of two
consecutive blocks in the canonical chain.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The block hashes are not available for all blocks for scalability reasons.
You can only access the hashes of the most recent 256 blocks, all other
values will be zero.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The function <code class="docutils literal notranslate"><span class="pre">blockhash</span></code> was previously known as <code class="docutils literal notranslate"><span class="pre">block.blockhash</span></code>, which was deprecated in
version 0.4.22 and removed in version 0.5.0.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The function <code class="docutils literal notranslate"><span class="pre">gasleft</span></code> was previously known as <code class="docutils literal notranslate"><span class="pre">msg.gas</span></code>, which was deprecated in
version 0.4.21 and removed in version 0.5.0.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In version 0.7.0, the alias <code class="docutils literal notranslate"><span class="pre">now</span></code> (for <code class="docutils literal notranslate"><span class="pre">block.timestamp</span></code>) was removed.</p>
</div>
</section>
<section id="abi-encoding-and-decoding-functions">
<span id="index-3"></span><h4>ABI Encoding and Decoding Functions<a class="headerlink" href="#abi-encoding-and-decoding-functions" title="Permalink to this heading">ÔÉÅ</a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">abi.decode(bytes</span> <span class="pre">memory</span> <span class="pre">encodedData,</span> <span class="pre">(...))</span> <span class="pre">returns</span> <span class="pre">(...)</span></code>: ABI-decodes the given data, while the types are given in parentheses as second argument. Example: <code class="docutils literal notranslate"><span class="pre">(uint</span> <span class="pre">a,</span> <span class="pre">uint[2]</span> <span class="pre">memory</span> <span class="pre">b,</span> <span class="pre">bytes</span> <span class="pre">memory</span> <span class="pre">c)</span> <span class="pre">=</span> <span class="pre">abi.decode(data,</span> <span class="pre">(uint,</span> <span class="pre">uint[2],</span> <span class="pre">bytes))</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">abi.encode(...)</span> <span class="pre">returns</span> <span class="pre">(bytes</span> <span class="pre">memory)</span></code>: ABI-encodes the given arguments</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">abi.encodePacked(...)</span> <span class="pre">returns</span> <span class="pre">(bytes</span> <span class="pre">memory)</span></code>: Performs <a class="reference internal" href="index.html#abi-packed-mode"><span class="std std-ref">packed encoding</span></a> of the given arguments. Note that packed encoding can be ambiguous!</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">abi.encodeWithSelector(bytes4</span> <span class="pre">selector,</span> <span class="pre">...)</span> <span class="pre">returns</span> <span class="pre">(bytes</span> <span class="pre">memory)</span></code>: ABI-encodes the given arguments starting from the second and prepends the given four-byte selector</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">abi.encodeWithSignature(string</span> <span class="pre">memory</span> <span class="pre">signature,</span> <span class="pre">...)</span> <span class="pre">returns</span> <span class="pre">(bytes</span> <span class="pre">memory)</span></code>: Equivalent to <code class="docutils literal notranslate"><span class="pre">abi.encodeWithSelector(bytes4(keccak256(bytes(signature))),</span> <span class="pre">...)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">abi.encodeCall(function</span> <span class="pre">functionPointer,</span> <span class="pre">(...))</span> <span class="pre">returns</span> <span class="pre">(bytes</span> <span class="pre">memory)</span></code>: ABI-encodes a call to <code class="docutils literal notranslate"><span class="pre">functionPointer</span></code> with the arguments found in the tuple. Performs a full type-check, ensuring the types match the function signature. Result equals <code class="docutils literal notranslate"><span class="pre">abi.encodeWithSelector(functionPointer.selector,</span> <span class="pre">(...))</span></code></p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>These encoding functions can be used to craft data for external function calls without actually
calling an external function. Furthermore, <code class="docutils literal notranslate"><span class="pre">keccak256(abi.encodePacked(a,</span> <span class="pre">b))</span></code> is a way
to compute the hash of structured data (although be aware that it is possible to
craft a ‚Äúhash collision‚Äù using different function parameter types).</p>
</div>
<p>See the documentation about the <a class="reference internal" href="index.html#abi"><span class="std std-ref">ABI</span></a> and the
<a class="reference internal" href="index.html#abi-packed-mode"><span class="std std-ref">tightly packed encoding</span></a> for details about the encoding.</p>
</section>
<section id="members-of-bytes">
<span id="index-4"></span><h4>Members of bytes<a class="headerlink" href="#members-of-bytes" title="Permalink to this heading">ÔÉÅ</a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">bytes.concat(...)</span> <span class="pre">returns</span> <span class="pre">(bytes</span> <span class="pre">memory)</span></code>: <a class="reference internal" href="index.html#bytes-concat"><span class="std std-ref">Concatenates variable number of bytes and bytes1, ‚Ä¶, bytes32 arguments to one byte array</span></a></p></li>
</ul>
</section>
<section id="members-of-string">
<span id="index-5"></span><h4>Members of string<a class="headerlink" href="#members-of-string" title="Permalink to this heading">ÔÉÅ</a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">string.concat(...)</span> <span class="pre">returns</span> <span class="pre">(string</span> <span class="pre">memory)</span></code>: <a class="reference internal" href="index.html#string-concat"><span class="std std-ref">Concatenates variable number of string arguments to one string array</span></a></p></li>
</ul>
</section>
<section id="error-handling">
<span id="index-6"></span><h4>Error Handling<a class="headerlink" href="#error-handling" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>See the dedicated section on <a class="reference internal" href="index.html#assert-and-require"><span class="std std-ref">assert and require</span></a> for
more details on error handling and when to use which function.</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">assert(bool</span> <span class="pre">condition)</span></code></dt><dd><p>causes a Panic error and thus state change reversion if the condition is not met - to be used for internal errors.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">require(bool</span> <span class="pre">condition)</span></code></dt><dd><p>reverts if the condition is not met - to be used for errors in inputs or external components.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">require(bool</span> <span class="pre">condition,</span> <span class="pre">string</span> <span class="pre">memory</span> <span class="pre">message)</span></code></dt><dd><p>reverts if the condition is not met - to be used for errors in inputs or external components. Also provides an error message.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">revert()</span></code></dt><dd><p>abort execution and revert state changes</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">revert(string</span> <span class="pre">memory</span> <span class="pre">reason)</span></code></dt><dd><p>abort execution and revert state changes, providing an explanatory string</p>
</dd>
</dl>
</section>
<section id="mathematical-and-cryptographic-functions">
<span id="index-7"></span><span id="id1"></span><h4>Mathematical and Cryptographic Functions<a class="headerlink" href="#mathematical-and-cryptographic-functions" title="Permalink to this heading">ÔÉÅ</a></h4>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">addmod(uint</span> <span class="pre">x,</span> <span class="pre">uint</span> <span class="pre">y,</span> <span class="pre">uint</span> <span class="pre">k)</span> <span class="pre">returns</span> <span class="pre">(uint)</span></code></dt><dd><p>compute <code class="docutils literal notranslate"><span class="pre">(x</span> <span class="pre">+</span> <span class="pre">y)</span> <span class="pre">%</span> <span class="pre">k</span></code> where the addition is performed with arbitrary precision and does not wrap around at <code class="docutils literal notranslate"><span class="pre">2**256</span></code>. Assert that <code class="docutils literal notranslate"><span class="pre">k</span> <span class="pre">!=</span> <span class="pre">0</span></code> starting from version 0.5.0.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">mulmod(uint</span> <span class="pre">x,</span> <span class="pre">uint</span> <span class="pre">y,</span> <span class="pre">uint</span> <span class="pre">k)</span> <span class="pre">returns</span> <span class="pre">(uint)</span></code></dt><dd><p>compute <code class="docutils literal notranslate"><span class="pre">(x</span> <span class="pre">*</span> <span class="pre">y)</span> <span class="pre">%</span> <span class="pre">k</span></code> where the multiplication is performed with arbitrary precision and does not wrap around at <code class="docutils literal notranslate"><span class="pre">2**256</span></code>. Assert that <code class="docutils literal notranslate"><span class="pre">k</span> <span class="pre">!=</span> <span class="pre">0</span></code> starting from version 0.5.0.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">keccak256(bytes</span> <span class="pre">memory)</span> <span class="pre">returns</span> <span class="pre">(bytes32)</span></code></dt><dd><p>compute the Keccak-256 hash of the input</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There used to be an alias for <code class="docutils literal notranslate"><span class="pre">keccak256</span></code> called <code class="docutils literal notranslate"><span class="pre">sha3</span></code>, which was removed in version 0.5.0.</p>
</div>
<dl>
<dt><code class="docutils literal notranslate"><span class="pre">sha256(bytes</span> <span class="pre">memory)</span> <span class="pre">returns</span> <span class="pre">(bytes32)</span></code></dt><dd><p>compute the SHA-256 hash of the input</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ripemd160(bytes</span> <span class="pre">memory)</span> <span class="pre">returns</span> <span class="pre">(bytes20)</span></code></dt><dd><p>compute RIPEMD-160 hash of the input</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ecrecover(bytes32</span> <span class="pre">hash,</span> <span class="pre">uint8</span> <span class="pre">v,</span> <span class="pre">bytes32</span> <span class="pre">r,</span> <span class="pre">bytes32</span> <span class="pre">s)</span> <span class="pre">returns</span> <span class="pre">(address)</span></code></dt><dd><p>recover the address associated with the public key from elliptic curve signature or return zero on error.
The function parameters correspond to ECDSA values of the signature:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">r</span></code> = first 32 bytes of signature</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">s</span></code> = second 32 bytes of signature</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">v</span></code> = final 1 byte of signature</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">ecrecover</span></code> returns an <code class="docutils literal notranslate"><span class="pre">address</span></code>, and not an <code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code>. See <a class="reference internal" href="index.html#address"><span class="std std-ref">address payable</span></a> for
conversion, in case you need to transfer funds to the recovered address.</p>
<p>For further details, read <a class="reference external" href="https://ethereum.stackexchange.com/questions/1777/workflow-on-signing-a-string-with-private-key-followed-by-signature-verificatio">example usage</a>.</p>
</dd>
</dl>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If you use <code class="docutils literal notranslate"><span class="pre">ecrecover</span></code>, be aware that a valid signature can be turned into a different valid signature without
requiring knowledge of the corresponding private key. In the Homestead hard fork, this issue was fixed
for _transaction_ signatures (see <a class="reference external" href="https://eips.ethereum.org/EIPS/eip-2#specification">EIP-2</a>), but
the ecrecover function remained unchanged.</p>
<p>This is usually not a problem unless you require signatures to be unique or
use them to identify items. OpenZeppelin have a <a class="reference external" href="https://docs.openzeppelin.com/contracts/2.x/api/cryptography#ECDSA">ECDSA helper library</a> that you can use as a wrapper for <code class="docutils literal notranslate"><span class="pre">ecrecover</span></code> without this issue.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When running <code class="docutils literal notranslate"><span class="pre">sha256</span></code>, <code class="docutils literal notranslate"><span class="pre">ripemd160</span></code> or <code class="docutils literal notranslate"><span class="pre">ecrecover</span></code> on a <em>private blockchain</em>, you might encounter Out-of-Gas. This is because these functions are implemented as ‚Äúprecompiled contracts‚Äù and only really exist after they receive the first message (although their contract code is hardcoded). Messages to non-existing contracts are more expensive and thus the execution might run into an Out-of-Gas error. A workaround for this problem is to first send Wei (1 for example) to each of the contracts before you use them in your actual contracts. This is not an issue on the main or test net.</p>
</div>
</section>
<section id="members-of-address-types">
<span id="address-related"></span><span id="index-8"></span><h4>Members of Address Types<a class="headerlink" href="#members-of-address-types" title="Permalink to this heading">ÔÉÅ</a></h4>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">&lt;address&gt;.balance</span></code> (<code class="docutils literal notranslate"><span class="pre">uint256</span></code>)</dt><dd><p>balance of the <a class="reference internal" href="index.html#address"><span class="std std-ref">Address</span></a> in Wei</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">&lt;address&gt;.code</span></code> (<code class="docutils literal notranslate"><span class="pre">bytes</span> <span class="pre">memory</span></code>)</dt><dd><p>code at the <a class="reference internal" href="index.html#address"><span class="std std-ref">Address</span></a> (can be empty)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">&lt;address&gt;.codehash</span></code> (<code class="docutils literal notranslate"><span class="pre">bytes32</span></code>)</dt><dd><p>the codehash of the <a class="reference internal" href="index.html#address"><span class="std std-ref">Address</span></a></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">&lt;address</span> <span class="pre">payable&gt;.transfer(uint256</span> <span class="pre">amount)</span></code></dt><dd><p>send given amount of Wei to <a class="reference internal" href="index.html#address"><span class="std std-ref">Address</span></a>, reverts on failure, forwards 2300 gas stipend, not adjustable</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">&lt;address</span> <span class="pre">payable&gt;.send(uint256</span> <span class="pre">amount)</span> <span class="pre">returns</span> <span class="pre">(bool)</span></code></dt><dd><p>send given amount of Wei to <a class="reference internal" href="index.html#address"><span class="std std-ref">Address</span></a>, returns <code class="docutils literal notranslate"><span class="pre">false</span></code> on failure, forwards 2300 gas stipend, not adjustable</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">&lt;address&gt;.call(bytes</span> <span class="pre">memory)</span> <span class="pre">returns</span> <span class="pre">(bool,</span> <span class="pre">bytes</span> <span class="pre">memory)</span></code></dt><dd><p>issue low-level <code class="docutils literal notranslate"><span class="pre">CALL</span></code> with the given payload, returns success condition and return data, forwards all available gas, adjustable</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">&lt;address&gt;.delegatecall(bytes</span> <span class="pre">memory)</span> <span class="pre">returns</span> <span class="pre">(bool,</span> <span class="pre">bytes</span> <span class="pre">memory)</span></code></dt><dd><p>issue low-level <code class="docutils literal notranslate"><span class="pre">DELEGATECALL</span></code> with the given payload, returns success condition and return data, forwards all available gas, adjustable</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">&lt;address&gt;.staticcall(bytes</span> <span class="pre">memory)</span> <span class="pre">returns</span> <span class="pre">(bool,</span> <span class="pre">bytes</span> <span class="pre">memory)</span></code></dt><dd><p>issue low-level <code class="docutils literal notranslate"><span class="pre">STATICCALL</span></code> with the given payload, returns success condition and return data, forwards all available gas, adjustable</p>
</dd>
</dl>
<p>For more information, see the section on <a class="reference internal" href="index.html#address"><span class="std std-ref">Address</span></a>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>You should avoid using <code class="docutils literal notranslate"><span class="pre">.call()</span></code> whenever possible when executing another contract function as it bypasses type checking,
function existence check, and argument packing.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>There are some dangers in using <code class="docutils literal notranslate"><span class="pre">send</span></code>: The transfer fails if the call stack depth is at 1024
(this can always be forced by the caller) and it also fails if the recipient runs out of gas. So in order
to make safe Ether transfers, always check the return value of <code class="docutils literal notranslate"><span class="pre">send</span></code>, use <code class="docutils literal notranslate"><span class="pre">transfer</span></code> or even better:
Use a pattern where the recipient withdraws the money.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Due to the fact that the EVM considers a call to a non-existing contract to always succeed,
Solidity includes an extra check using the <code class="docutils literal notranslate"><span class="pre">extcodesize</span></code> opcode when performing external calls.
This ensures that the contract that is about to be called either actually exists (it contains code)
or an exception is raised.</p>
<p>The low-level calls which operate on addresses rather than contract instances (i.e. <code class="docutils literal notranslate"><span class="pre">.call()</span></code>,
<code class="docutils literal notranslate"><span class="pre">.delegatecall()</span></code>, <code class="docutils literal notranslate"><span class="pre">.staticcall()</span></code>, <code class="docutils literal notranslate"><span class="pre">.send()</span></code> and <code class="docutils literal notranslate"><span class="pre">.transfer()</span></code>) <strong>do not</strong> include this
check, which makes them cheaper in terms of gas but also less safe.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Prior to version 0.5.0, Solidity allowed address members to be accessed by a contract instance, for example <code class="docutils literal notranslate"><span class="pre">this.balance</span></code>.
This is now forbidden and an explicit conversion to address must be done: <code class="docutils literal notranslate"><span class="pre">address(this).balance</span></code>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If state variables are accessed via a low-level delegatecall, the storage layout of the two contracts
must align in order for the called contract to correctly access the storage variables of the calling contract by name.
This is of course not the case if storage pointers are passed as function arguments as in the case for
the high-level libraries.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Prior to version 0.5.0, <code class="docutils literal notranslate"><span class="pre">.call</span></code>, <code class="docutils literal notranslate"><span class="pre">.delegatecall</span></code> and <code class="docutils literal notranslate"><span class="pre">.staticcall</span></code> only returned the
success condition and not the return data.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Prior to version 0.5.0, there was a member called <code class="docutils literal notranslate"><span class="pre">callcode</span></code> with similar but slightly different
semantics than <code class="docutils literal notranslate"><span class="pre">delegatecall</span></code>.</p>
</div>
</section>
<section id="contract-related">
<span id="index-9"></span><h4>Contract Related<a class="headerlink" href="#contract-related" title="Permalink to this heading">ÔÉÅ</a></h4>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">this</span></code> (current contract‚Äôs type)</dt><dd><p>the current contract, explicitly convertible to <a class="reference internal" href="index.html#address"><span class="std std-ref">Address</span></a></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">selfdestruct(address</span> <span class="pre">payable</span> <span class="pre">recipient)</span></code></dt><dd><p>Destroy the current contract, sending its funds to the given <a class="reference internal" href="index.html#address"><span class="std std-ref">Address</span></a>
and end execution.
Note that <code class="docutils literal notranslate"><span class="pre">selfdestruct</span></code> has some peculiarities inherited from the EVM:</p>
<ul class="simple">
<li><p>the receiving contract‚Äôs receive function is not executed.</p></li>
<li><p>the contract is only really destroyed at the end of the transaction and <code class="docutils literal notranslate"><span class="pre">revert</span></code> s might ‚Äúundo‚Äù the destruction.</p></li>
</ul>
</dd>
</dl>
<p>Furthermore, all functions of the current contract are callable directly including the current function.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Prior to version 0.5.0, there was a function called <code class="docutils literal notranslate"><span class="pre">suicide</span></code> with the same
semantics as <code class="docutils literal notranslate"><span class="pre">selfdestruct</span></code>.</p>
</div>
</section>
<section id="type-information">
<span id="meta-type"></span><span id="index-10"></span><h4>Type Information<a class="headerlink" href="#type-information" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>The expression <code class="docutils literal notranslate"><span class="pre">type(X)</span></code> can be used to retrieve information about the type
<code class="docutils literal notranslate"><span class="pre">X</span></code>. Currently, there is limited support for this feature (<code class="docutils literal notranslate"><span class="pre">X</span></code> can be either
a contract or an integer type) but it might be expanded in the future.</p>
<p>The following properties are available for a contract type <code class="docutils literal notranslate"><span class="pre">C</span></code>:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">type(C).name</span></code></dt><dd><p>The name of the contract.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">type(C).creationCode</span></code></dt><dd><p>Memory byte array that contains the creation bytecode of the contract.
This can be used in inline assembly to build custom creation routines,
especially by using the <code class="docutils literal notranslate"><span class="pre">create2</span></code> opcode.
This property can <strong>not</strong> be accessed in the contract itself or any
derived contract. It causes the bytecode to be included in the bytecode
of the call site and thus circular references like that are not possible.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">type(C).runtimeCode</span></code></dt><dd><p>Memory byte array that contains the runtime bytecode of the contract.
This is the code that is usually deployed by the constructor of <code class="docutils literal notranslate"><span class="pre">C</span></code>.
If <code class="docutils literal notranslate"><span class="pre">C</span></code> has a constructor that uses inline assembly, this might be
different from the actually deployed bytecode. Also note that libraries
modify their runtime bytecode at time of deployment to guard against
regular calls.
The same restrictions as with <code class="docutils literal notranslate"><span class="pre">.creationCode</span></code> also apply for this
property.</p>
</dd>
</dl>
<p>In addition to the properties above, the following properties are available
for an interface type <code class="docutils literal notranslate"><span class="pre">I</span></code>:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">type(I).interfaceId</span></code>:</dt><dd><p>A <code class="docutils literal notranslate"><span class="pre">bytes4</span></code> value containing the <a class="reference external" href="https://eips.ethereum.org/EIPS/eip-165">EIP-165</a>
interface identifier of the given interface <code class="docutils literal notranslate"><span class="pre">I</span></code>. This identifier is defined as the <code class="docutils literal notranslate"><span class="pre">XOR</span></code> of all
function selectors defined within the interface itself - excluding all inherited functions.</p>
</dd>
</dl>
<p>The following properties are available for an integer type <code class="docutils literal notranslate"><span class="pre">T</span></code>:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">type(T).min</span></code></dt><dd><p>The smallest value representable by type <code class="docutils literal notranslate"><span class="pre">T</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">type(T).max</span></code></dt><dd><p>The largest value representable by type <code class="docutils literal notranslate"><span class="pre">T</span></code>.</p>
</dd>
</dl>
</section>
</section>
</section>
<span id="document-control-structures"></span><section id="expressions-and-control-structures">
<h2>Expressions and Control Structures<a class="headerlink" href="#expressions-and-control-structures" title="Permalink to this heading">ÔÉÅ</a></h2>
<span class="target" id="index-0"></span><section id="control-structures">
<span id="index-1"></span><h3>Control Structures<a class="headerlink" href="#control-structures" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Most of the control structures known from curly-braces languages are available in Solidity:</p>
<p>There is: <code class="docutils literal notranslate"><span class="pre">if</span></code>, <code class="docutils literal notranslate"><span class="pre">else</span></code>, <code class="docutils literal notranslate"><span class="pre">while</span></code>, <code class="docutils literal notranslate"><span class="pre">do</span></code>, <code class="docutils literal notranslate"><span class="pre">for</span></code>, <code class="docutils literal notranslate"><span class="pre">break</span></code>, <code class="docutils literal notranslate"><span class="pre">continue</span></code>, <code class="docutils literal notranslate"><span class="pre">return</span></code>, with
the usual semantics known from C or JavaScript.</p>
<p>Solidity also supports exception handling in the form of <code class="docutils literal notranslate"><span class="pre">try</span></code>/<code class="docutils literal notranslate"><span class="pre">catch</span></code>-statements,
but only for <a class="reference internal" href="#external-function-calls"><span class="std std-ref">external function calls</span></a> and
contract creation calls. Errors can be created using the <a class="reference internal" href="#revert-statement"><span class="std std-ref">revert statement</span></a>.</p>
<p>Parentheses can <em>not</em> be omitted for conditionals, but curly braces can be omitted
around single-statement bodies.</p>
<p>Note that there is no type conversion from non-boolean to boolean types as
there is in C and JavaScript, so <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">(1)</span> <span class="pre">{</span> <span class="pre">...</span> <span class="pre">}</span></code> is <em>not</em> valid
Solidity.</p>
</section>
<section id="function-calls">
<span id="index-2"></span><span id="id1"></span><h3>Function Calls<a class="headerlink" href="#function-calls" title="Permalink to this heading">ÔÉÅ</a></h3>
<section id="internal-function-calls">
<span id="id2"></span><h4>Internal Function Calls<a class="headerlink" href="#internal-function-calls" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Functions of the current contract can be called directly (‚Äúinternally‚Äù), also recursively, as seen in
this nonsensical example:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC40LjIyIDwwLjkuMDsKCi8vIFRoaXMgd2lsbCByZXBvcnQgYSB3YXJuaW5nCmNvbnRyYWN0IEMgewogICAgZnVuY3Rpb24gZyh1aW50IGEpIHB1YmxpYyBwdXJlIHJldHVybnMgKHVpbnQgcmV0KSB7IHJldHVybiBhICsgZigpOyB9CiAgICBmdW5jdGlvbiBmKCkgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50IHJldCkgeyByZXR1cm4gZyg3KSArIGYoKTsgfQp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.4.22</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="c1">// This will report a warning</span>
<span class="k">contract</span><span class="w"> </span><span class="ni">C</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">g</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">a</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">ret</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kt">return</span><span class="w"> </span>a<span class="w"> </span><span class="o">+</span><span class="w"> </span>f<span class="p">();</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">f</span><span class="p">()</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">ret</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kt">return</span><span class="w"> </span>g<span class="p">(</span><span class="m m-Decimal">7</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>f<span class="p">();</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>These function calls are translated into simple jumps inside the EVM. This has
the effect that the current memory is not cleared, i.e. passing memory references
to internally-called functions is very efficient. Only functions of the same
contract instance can be called internally.</p>
<p>You should still avoid excessive recursion, as every internal function call
uses up at least one stack slot and there are only 1024 slots available.</p>
</section>
<section id="external-function-calls">
<span id="id3"></span><h4>External Function Calls<a class="headerlink" href="#external-function-calls" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Functions can also be called using the <code class="docutils literal notranslate"><span class="pre">this.g(8);</span></code> and <code class="docutils literal notranslate"><span class="pre">c.g(2);</span></code> notation, where
<code class="docutils literal notranslate"><span class="pre">c</span></code> is a contract instance and <code class="docutils literal notranslate"><span class="pre">g</span></code> is a function belonging to <code class="docutils literal notranslate"><span class="pre">c</span></code>.
Calling the function <code class="docutils literal notranslate"><span class="pre">g</span></code> via either way results in it being called ‚Äúexternally‚Äù, using a
message call and not directly via jumps.
Please note that function calls on <code class="docutils literal notranslate"><span class="pre">this</span></code> cannot be used in the constructor,
as the actual contract has not been created yet.</p>
<p>Functions of other contracts have to be called externally. For an external call,
all function arguments have to be copied to memory.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A function call from one contract to another does not create its own transaction,
it is a message call as part of the overall transaction.</p>
</div>
<p>When calling functions of other contracts, you can specify the amount of Wei or
gas sent with the call with the special options <code class="docutils literal notranslate"><span class="pre">{value:</span> <span class="pre">10,</span> <span class="pre">gas:</span> <span class="pre">10000}</span></code>.
Note that it is discouraged to specify gas values explicitly, since the gas costs
of opcodes can change in the future. Any Wei you send to the contract is added
to the total balance of that contract:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC42LjIgPDAuOS4wOwoKY29udHJhY3QgSW5mb0ZlZWQgewogICAgZnVuY3Rpb24gaW5mbygpIHB1YmxpYyBwYXlhYmxlIHJldHVybnMgKHVpbnQgcmV0KSB7IHJldHVybiA0MjsgfQp9Cgpjb250cmFjdCBDb25zdW1lciB7CiAgICBJbmZvRmVlZCBmZWVkOwogICAgZnVuY3Rpb24gc2V0RmVlZChJbmZvRmVlZCBhZGRyKSBwdWJsaWMgeyBmZWVkID0gYWRkcjsgfQogICAgZnVuY3Rpb24gY2FsbEZlZWQoKSBwdWJsaWMgeyBmZWVkLmluZm97dmFsdWU6IDEwLCBnYXM6IDgwMH0oKTsgfQp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.6.2</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">InfoFeed</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">info</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">ret</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kt">return</span><span class="w"> </span><span class="m m-Decimal">42</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Consumer</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span>InfoFeed<span class="w"> </span>feed<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">setFeed</span><span class="p">(</span>InfoFeed<span class="w"> </span>addr<span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>feed<span class="w"> </span><span class="o">=</span><span class="w"> </span>addr<span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">callFeed</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>feed<span class="p">.</span>info<span class="p">{</span>value<span class="p">:</span><span class="w"> </span><span class="m m-Decimal">10</span><span class="p">,</span><span class="w"> </span>gas<span class="p">:</span><span class="w"> </span><span class="m m-Decimal">800</span><span class="p">}();</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>You need to use the modifier <code class="docutils literal notranslate"><span class="pre">payable</span></code> with the <code class="docutils literal notranslate"><span class="pre">info</span></code> function because
otherwise, the <code class="docutils literal notranslate"><span class="pre">value</span></code> option would not be available.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Be careful that <code class="docutils literal notranslate"><span class="pre">feed.info{value:</span> <span class="pre">10,</span> <span class="pre">gas:</span> <span class="pre">800}</span></code> only locally sets the
<code class="docutils literal notranslate"><span class="pre">value</span></code> and amount of <code class="docutils literal notranslate"><span class="pre">gas</span></code> sent with the function call, and the
parentheses at the end perform the actual call. So
<code class="docutils literal notranslate"><span class="pre">feed.info{value:</span> <span class="pre">10,</span> <span class="pre">gas:</span> <span class="pre">800}</span></code> does not call the function and
the <code class="docutils literal notranslate"><span class="pre">value</span></code> and <code class="docutils literal notranslate"><span class="pre">gas</span></code> settings are lost, only
<code class="docutils literal notranslate"><span class="pre">feed.info{value:</span> <span class="pre">10,</span> <span class="pre">gas:</span> <span class="pre">800}()</span></code> performs the function call.</p>
</div>
<p>Due to the fact that the EVM considers a call to a non-existing contract to
always succeed, Solidity uses the <code class="docutils literal notranslate"><span class="pre">extcodesize</span></code> opcode to check that
the contract that is about to be called actually exists (it contains code)
and causes an exception if it does not. This check is skipped if the return
data will be decoded after the call and thus the ABI decoder will catch the
case of a non-existing contract.</p>
<p>Note that this check is not performed in case of <a class="reference internal" href="index.html#address-related"><span class="std std-ref">low-level calls</span></a> which
operate on addresses rather than contract instances.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Be careful when using high-level calls to
<a class="reference internal" href="index.html#precompiledcontracts"><span class="std std-ref">precompiled contracts</span></a>,
since the compiler considers them non-existing according to the
above logic even though they execute code and can return data.</p>
</div>
<p>Function calls also cause exceptions if the called contract itself
throws an exception or goes out of gas.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Any interaction with another contract imposes a potential danger, especially
if the source code of the contract is not known in advance. The
current contract hands over control to the called contract and that may potentially
do just about anything. Even if the called contract inherits from a known parent contract,
the inheriting contract is only required to have a correct interface. The
implementation of the contract, however, can be completely arbitrary and thus,
pose a danger. In addition, be prepared in case it calls into other contracts of
your system or even back into the calling contract before the first
call returns. This means
that the called contract can change state variables of the calling contract
via its functions. Write your functions in a way that, for example, calls to
external functions happen after any changes to state variables in your contract
so your contract is not vulnerable to a reentrancy exploit.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Before Solidity 0.6.2, the recommended way to specify the value and gas was to
use <code class="docutils literal notranslate"><span class="pre">f.value(x).gas(g)()</span></code>. This was deprecated in Solidity 0.6.2 and is no
longer possible since Solidity 0.7.0.</p>
</div>
</section>
<section id="named-calls-and-anonymous-function-parameters">
<h4>Named Calls and Anonymous Function Parameters<a class="headerlink" href="#named-calls-and-anonymous-function-parameters" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Function call arguments can be given by name, in any order,
if they are enclosed in <code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">}</span></code> as can be seen in the following
example. The argument list has to coincide by name with the list of
parameters from the function declaration, but can be in arbitrary order.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC40LjAgPDAuOS4wOwoKY29udHJhY3QgQyB7CiAgICBtYXBwaW5nKHVpbnQgPT4gdWludCkgZGF0YTsKCiAgICBmdW5jdGlvbiBmKCkgcHVibGljIHsKICAgICAgICBzZXQoe3ZhbHVlOiAyLCBrZXk6IDN9KTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXQodWludCBrZXksIHVpbnQgdmFsdWUpIHB1YmxpYyB7CiAgICAgICAgZGF0YVtrZXldID0gdmFsdWU7CiAgICB9Cgp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.4.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">C</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span>data<span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">f</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>set<span class="p">({</span>value<span class="p">:</span><span class="w"> </span><span class="m m-Decimal">2</span><span class="p">,</span><span class="w"> </span>key<span class="p">:</span><span class="w"> </span><span class="m m-Decimal">3</span><span class="p">});</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">set</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">key</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>data<span class="p">[</span>key<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>value<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="omitted-function-parameter-names">
<h4>Omitted Function Parameter Names<a class="headerlink" href="#omitted-function-parameter-names" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>The names of unused parameters (especially return parameters) can be omitted.
Those parameters will still be present on the stack, but they are inaccessible.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC40LjIyIDwwLjkuMDsKCmNvbnRyYWN0IEMgewogICAgLy8gb21pdHRlZCBuYW1lIGZvciBwYXJhbWV0ZXIKICAgIGZ1bmN0aW9uIGZ1bmModWludCBrLCB1aW50KSBwdWJsaWMgcHVyZSByZXR1cm5zKHVpbnQpIHsKICAgICAgICByZXR1cm4gazsKICAgIH0KfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.4.22</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">C</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// omitted name for parameter</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">func</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">k</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>k<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
<section id="creating-contracts-via-new">
<span id="creating-contracts"></span><span id="index-3"></span><h3>Creating Contracts via <code class="docutils literal notranslate"><span class="pre">new</span></code><a class="headerlink" href="#creating-contracts-via-new" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>A contract can create other contracts using the <code class="docutils literal notranslate"><span class="pre">new</span></code> keyword. The full
code of the contract being created has to be known when the creating contract
is compiled so recursive creation-dependencies are not possible.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC43LjAgPDAuOS4wOwpjb250cmFjdCBEIHsKICAgIHVpbnQgcHVibGljIHg7CiAgICBjb25zdHJ1Y3Rvcih1aW50IGEpIHBheWFibGUgewogICAgICAgIHggPSBhOwogICAgfQp9Cgpjb250cmFjdCBDIHsKICAgIEQgZCA9IG5ldyBEKDQpOyAvLyB3aWxsIGJlIGV4ZWN1dGVkIGFzIHBhcnQgb2YgQydzIGNvbnN0cnVjdG9yCgogICAgZnVuY3Rpb24gY3JlYXRlRCh1aW50IGFyZykgcHVibGljIHsKICAgICAgICBEIG5ld0QgPSBuZXcgRChhcmcpOwogICAgICAgIG5ld0QueCgpOwogICAgfQoKICAgIGZ1bmN0aW9uIGNyZWF0ZUFuZEVuZG93RCh1aW50IGFyZywgdWludCBhbW91bnQpIHB1YmxpYyBwYXlhYmxlIHsKICAgICAgICAvLyBTZW5kIGV0aGVyIGFsb25nIHdpdGggdGhlIGNyZWF0aW9uCiAgICAgICAgRCBuZXdEID0gbmV3IER7dmFsdWU6IGFtb3VudH0oYXJnKTsKICAgICAgICBuZXdELngoKTsKICAgIH0KfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.7.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>
<span class="k">contract</span><span class="w"> </span><span class="ni">D</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="k">public </span><span class="nv">x</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">constructor</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">a</span><span class="p">)</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>x<span class="w"> </span><span class="o">=</span><span class="w"> </span>a<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">C</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span>D<span class="w"> </span>d<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span>D<span class="p">(</span><span class="m m-Decimal">4</span><span class="p">);</span><span class="w"> </span><span class="c1">// will be executed as part of C&#39;s constructor</span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">createD</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">arg</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>D<span class="w"> </span>newD<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span>D<span class="p">(</span>arg<span class="p">);</span><span class="w"></span>
<span class="w">        </span>newD<span class="p">.</span>x<span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">createAndEndowD</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">arg</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">amount</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Send ether along with the creation</span>
<span class="w">        </span>D<span class="w"> </span>newD<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span>D<span class="p">{</span>value<span class="p">:</span><span class="w"> </span>amount<span class="p">}(</span>arg<span class="p">);</span><span class="w"></span>
<span class="w">        </span>newD<span class="p">.</span>x<span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>As seen in the example, it is possible to send Ether while creating
an instance of <code class="docutils literal notranslate"><span class="pre">D</span></code> using the <code class="docutils literal notranslate"><span class="pre">value</span></code> option, but it is not possible
to limit the amount of gas.
If the creation fails (due to out-of-stack, not enough balance or other problems),
an exception is thrown.</p>
<section id="salted-contract-creations-create2">
<h4>Salted contract creations / create2<a class="headerlink" href="#salted-contract-creations-create2" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>When creating a contract, the address of the contract is computed from
the address of the creating contract and a counter that is increased with
each contract creation.</p>
<p>If you specify the option <code class="docutils literal notranslate"><span class="pre">salt</span></code> (a bytes32 value), then contract creation will
use a different mechanism to come up with the address of the new contract:</p>
<p>It will compute the address from the address of the creating contract,
the given salt value, the (creation) bytecode of the created contract and the constructor
arguments.</p>
<p>In particular, the counter (‚Äúnonce‚Äù) is not used. This allows for more flexibility
in creating contracts: You are able to derive the address of the
new contract before it is created. Furthermore, you can rely on this address
also in case the creating
contracts creates other contracts in the meantime.</p>
<p>The main use-case here is contracts that act as judges for off-chain interactions,
which only need to be created if there is a dispute.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC43LjAgPDAuOS4wOwpjb250cmFjdCBEIHsKICAgIHVpbnQgcHVibGljIHg7CiAgICBjb25zdHJ1Y3Rvcih1aW50IGEpIHsKICAgICAgICB4ID0gYTsKICAgIH0KfQoKY29udHJhY3QgQyB7CiAgICBmdW5jdGlvbiBjcmVhdGVEU2FsdGVkKGJ5dGVzMzIgc2FsdCwgdWludCBhcmcpIHB1YmxpYyB7CiAgICAgICAgLy8gVGhpcyBjb21wbGljYXRlZCBleHByZXNzaW9uIGp1c3QgdGVsbHMgeW91IGhvdyB0aGUgYWRkcmVzcwogICAgICAgIC8vIGNhbiBiZSBwcmUtY29tcHV0ZWQuIEl0IGlzIGp1c3QgdGhlcmUgZm9yIGlsbHVzdHJhdGlvbi4KICAgICAgICAvLyBZb3UgYWN0dWFsbHkgb25seSBuZWVkIGBgbmV3IER7c2FsdDogc2FsdH0oYXJnKWBgLgogICAgICAgIGFkZHJlc3MgcHJlZGljdGVkQWRkcmVzcyA9IGFkZHJlc3ModWludDE2MCh1aW50KGtlY2NhazI1NihhYmkuZW5jb2RlUGFja2VkKAogICAgICAgICAgICBieXRlczEoMHhmZiksCiAgICAgICAgICAgIGFkZHJlc3ModGhpcyksCiAgICAgICAgICAgIHNhbHQsCiAgICAgICAgICAgIGtlY2NhazI1NihhYmkuZW5jb2RlUGFja2VkKAogICAgICAgICAgICAgICAgdHlwZShEKS5jcmVhdGlvbkNvZGUsCiAgICAgICAgICAgICAgICBhYmkuZW5jb2RlKGFyZykKICAgICAgICAgICAgKSkKICAgICAgICApKSkpKTsKCiAgICAgICAgRCBkID0gbmV3IER7c2FsdDogc2FsdH0oYXJnKTsKICAgICAgICByZXF1aXJlKGFkZHJlc3MoZCkgPT0gcHJlZGljdGVkQWRkcmVzcyk7CiAgICB9Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.7.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>
<span class="k">contract</span><span class="w"> </span><span class="ni">D</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="k">public </span><span class="nv">x</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">constructor</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>x<span class="w"> </span><span class="o">=</span><span class="w"> </span>a<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">C</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">createDSalted</span><span class="p">(</span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">salt</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">arg</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// This complicated expression just tells you how the address</span>
<span class="w">        </span><span class="c1">// can be pre-computed. It is just there for illustration.</span>
<span class="w">        </span><span class="c1">// You actually only need ``new D{salt: salt}(arg)``.</span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">predictedAddress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">address</span><span class="p">(</span><span class="kt">uint160</span><span class="p">(</span><span class="kt">uint</span><span class="p">(</span><span class="nb">keccak256</span><span class="p">(</span>abi<span class="p">.</span>encodePacked<span class="p">(</span><span class="w"></span>
<span class="w">            </span>bytes1<span class="p">(</span><span class="mh">0xff</span><span class="p">),</span><span class="w"></span>
<span class="w">            </span><span class="kt">address</span><span class="p">(</span><span class="kt">this</span><span class="p">),</span><span class="w"></span>
<span class="w">            </span>salt<span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="nb">keccak256</span><span class="p">(</span>abi<span class="p">.</span>encodePacked<span class="p">(</span><span class="w"></span>
<span class="w">                </span>type<span class="p">(</span>D<span class="p">).</span>creationCode<span class="p">,</span><span class="w"></span>
<span class="w">                </span>abi<span class="p">.</span>encode<span class="p">(</span>arg<span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="p">)))));</span><span class="w"></span>

<span class="w">        </span>D<span class="w"> </span>d<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span>D<span class="p">{</span>salt<span class="p">:</span><span class="w"> </span>salt<span class="p">}(</span>arg<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span>d<span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>predictedAddress<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>There are some peculiarities in relation to salted creation. A contract can be
re-created at the same address after having been destroyed. Yet, it is possible
for that newly created contract to have a different deployed bytecode even
though the creation bytecode has been the same (which is a requirement because
otherwise the address would change). This is due to the fact that the constructor
can query external state that might have changed between the two creations
and incorporate that into the deployed bytecode before it is stored.</p>
</div>
</section>
</section>
<section id="order-of-evaluation-of-expressions">
<h3>Order of Evaluation of Expressions<a class="headerlink" href="#order-of-evaluation-of-expressions" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>The evaluation order of expressions is not specified (more formally, the order
in which the children of one node in the expression tree are evaluated is not
specified, but they are of course evaluated before the node itself). It is only
guaranteed that statements are executed in order and short-circuiting for
boolean expressions is done.</p>
</section>
<section id="assignment">
<span id="index-4"></span><h3>Assignment<a class="headerlink" href="#assignment" title="Permalink to this heading">ÔÉÅ</a></h3>
<section id="destructuring-assignments-and-returning-multiple-values">
<span id="index-5"></span><h4>Destructuring Assignments and Returning Multiple Values<a class="headerlink" href="#destructuring-assignments-and-returning-multiple-values" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Solidity internally allows tuple types, i.e. a list of objects
of potentially different types whose number is a constant at
compile-time. Those tuples can be used to return multiple values at the same time.
These can then either be assigned to newly declared variables
or to pre-existing variables (or LValues in general).</p>
<p>Tuples are not proper types in Solidity, they can only be used to form syntactic
groupings of expressions.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC41LjAgPDAuOS4wOwoKY29udHJhY3QgQyB7CiAgICB1aW50IGluZGV4OwoKICAgIGZ1bmN0aW9uIGYoKSBwdWJsaWMgcHVyZSByZXR1cm5zICh1aW50LCBib29sLCB1aW50KSB7CiAgICAgICAgcmV0dXJuICg3LCB0cnVlLCAyKTsKICAgIH0KCiAgICBmdW5jdGlvbiBnKCkgcHVibGljIHsKICAgICAgICAvLyBWYXJpYWJsZXMgZGVjbGFyZWQgd2l0aCB0eXBlIGFuZCBhc3NpZ25lZCBmcm9tIHRoZSByZXR1cm5lZCB0dXBsZSwKICAgICAgICAvLyBub3QgYWxsIGVsZW1lbnRzIGhhdmUgdG8gYmUgc3BlY2lmaWVkIChidXQgdGhlIG51bWJlciBtdXN0IG1hdGNoKS4KICAgICAgICAodWludCB4LCAsIHVpbnQgeSkgPSBmKCk7CiAgICAgICAgLy8gQ29tbW9uIHRyaWNrIHRvIHN3YXAgdmFsdWVzIC0tIGRvZXMgbm90IHdvcmsgZm9yIG5vbi12YWx1ZSBzdG9yYWdlIHR5cGVzLgogICAgICAgICh4LCB5KSA9ICh5LCB4KTsKICAgICAgICAvLyBDb21wb25lbnRzIGNhbiBiZSBsZWZ0IG91dCAoYWxzbyBmb3IgdmFyaWFibGUgZGVjbGFyYXRpb25zKS4KICAgICAgICAoaW5kZXgsICwgKSA9IGYoKTsgLy8gU2V0cyB0aGUgaW5kZXggdG8gNwogICAgfQp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.5.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">C</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="nv">index</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">f</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span><span class="p">(</span><span class="m m-Decimal">7</span><span class="p">,</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span><span class="w"> </span><span class="m m-Decimal">2</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">g</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Variables declared with type and assigned from the returned tuple,</span>
<span class="w">        </span><span class="c1">// not all elements have to be specified (but the number must match).</span>
<span class="w">        </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">x</span><span class="p">,</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">y</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>f<span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Common trick to swap values -- does not work for non-value storage types.</span>
<span class="w">        </span><span class="p">(</span>x<span class="p">,</span><span class="w"> </span>y<span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span>y<span class="p">,</span><span class="w"> </span>x<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Components can be left out (also for variable declarations).</span>
<span class="w">        </span><span class="p">(</span>index<span class="p">,</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>f<span class="p">();</span><span class="w"> </span><span class="c1">// Sets the index to 7</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>It is not possible to mix variable declarations and non-declaration assignments,
i.e. the following is not valid: <code class="docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">uint</span> <span class="pre">y)</span> <span class="pre">=</span> <span class="pre">(1,</span> <span class="pre">2);</span></code></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Prior to version 0.5.0 it was possible to assign to tuples of smaller size, either
filling up on the left or on the right side (which ever was empty). This is
now disallowed, so both sides have to have the same number of components.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Be careful when assigning to multiple variables at the same time when
reference types are involved, because it could lead to unexpected
copying behaviour.</p>
</div>
</section>
<section id="complications-for-arrays-and-structs">
<h4>Complications for Arrays and Structs<a class="headerlink" href="#complications-for-arrays-and-structs" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>The semantics of assignments are more complicated for non-value types like arrays and structs,
including <code class="docutils literal notranslate"><span class="pre">bytes</span></code> and <code class="docutils literal notranslate"><span class="pre">string</span></code>, see <a class="reference internal" href="index.html#data-location-assignment"><span class="std std-ref">Data location and assignment behaviour</span></a> for details.</p>
<p>In the example below the call to <code class="docutils literal notranslate"><span class="pre">g(x)</span></code> has no effect on <code class="docutils literal notranslate"><span class="pre">x</span></code> because it creates
an independent copy of the storage value in memory. However, <code class="docutils literal notranslate"><span class="pre">h(x)</span></code> successfully modifies <code class="docutils literal notranslate"><span class="pre">x</span></code>
because only a reference and not a copy is passed.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC40LjIyIDwwLjkuMDsKCmNvbnRyYWN0IEMgewogICAgdWludFsyMF0geDsKCiAgICBmdW5jdGlvbiBmKCkgcHVibGljIHsKICAgICAgICBnKHgpOwogICAgICAgIGgoeCk7CiAgICB9CgogICAgZnVuY3Rpb24gZyh1aW50WzIwXSBtZW1vcnkgeSkgaW50ZXJuYWwgcHVyZSB7CiAgICAgICAgeVsyXSA9IDM7CiAgICB9CgogICAgZnVuY3Rpb24gaCh1aW50WzIwXSBzdG9yYWdlIHkpIGludGVybmFsIHsKICAgICAgICB5WzNdID0gNDsKICAgIH0KfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.4.22</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">C</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="p">[</span><span class="m m-Decimal">20</span><span class="p">]</span><span class="w"> </span>x<span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">f</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>g<span class="p">(</span>x<span class="p">);</span><span class="w"></span>
<span class="w">        </span>h<span class="p">(</span>x<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">g</span><span class="p">(</span><span class="kt">uint</span><span class="p">[</span><span class="m m-Decimal">20</span><span class="p">]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>y<span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>pure<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>y<span class="p">[</span><span class="m m-Decimal">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">3</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">h</span><span class="p">(</span><span class="kt">uint</span><span class="p">[</span><span class="m m-Decimal">20</span><span class="p">]</span><span class="w"> </span>storage<span class="w"> </span>y<span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>y<span class="p">[</span><span class="m m-Decimal">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">4</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
<section id="scoping-and-declarations">
<span id="default-value"></span><span id="index-6"></span><h3>Scoping and Declarations<a class="headerlink" href="#scoping-and-declarations" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>A variable which is declared will have an initial default
value whose byte-representation is all zeros.
The ‚Äúdefault values‚Äù of variables are the typical ‚Äúzero-state‚Äù
of whatever the type is. For example, the default value for a <code class="docutils literal notranslate"><span class="pre">bool</span></code>
is <code class="docutils literal notranslate"><span class="pre">false</span></code>. The default value for the <code class="docutils literal notranslate"><span class="pre">uint</span></code> or <code class="docutils literal notranslate"><span class="pre">int</span></code>
types is <code class="docutils literal notranslate"><span class="pre">0</span></code>. For statically-sized arrays and <code class="docutils literal notranslate"><span class="pre">bytes1</span></code> to
<code class="docutils literal notranslate"><span class="pre">bytes32</span></code>, each individual
element will be initialized to the default value corresponding
to its type. For dynamically-sized arrays, <code class="docutils literal notranslate"><span class="pre">bytes</span></code>
and <code class="docutils literal notranslate"><span class="pre">string</span></code>, the default value is an empty array or string.
For the <code class="docutils literal notranslate"><span class="pre">enum</span></code> type, the default value is its first member.</p>
<p>Scoping in Solidity follows the widespread scoping rules of C99
(and many other languages): Variables are visible from the point right after their declaration
until the end of the smallest <code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">}</span></code>-block that contains the declaration.
As an exception to this rule, variables declared in the
initialization part of a for-loop are only visible until the end of the for-loop.</p>
<p>Variables that are parameter-like (function parameters, modifier parameters,
catch parameters, ‚Ä¶) are visible inside the code block that follows -
the body of the function/modifier for a function and modifier parameter and the catch block
for a catch parameter.</p>
<p>Variables and other items declared outside of a code block, for example functions, contracts,
user-defined types, etc., are visible even before they were declared. This means you can
use state variables before they are declared and call functions recursively.</p>
<p>As a consequence, the following examples will compile without warnings, since
the two variables have the same name but disjoint scopes.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC41LjAgPDAuOS4wOwpjb250cmFjdCBDIHsKICAgIGZ1bmN0aW9uIG1pbmltYWxTY29waW5nKCkgcHVyZSBwdWJsaWMgewogICAgICAgIHsKICAgICAgICAgICAgdWludCBzYW1lOwogICAgICAgICAgICBzYW1lID0gMTsKICAgICAgICB9CgogICAgICAgIHsKICAgICAgICAgICAgdWludCBzYW1lOwogICAgICAgICAgICBzYW1lID0gMzsKICAgICAgICB9CiAgICB9Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.5.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>
<span class="k">contract</span><span class="w"> </span><span class="ni">C</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">minimalScoping</span><span class="p">()</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="kt">uint</span><span class="w"> </span><span class="nv">same</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span>same<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="kt">uint</span><span class="w"> </span><span class="nv">same</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span>same<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">3</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>As a special example of the C99 scoping rules, note that in the following,
the first assignment to <code class="docutils literal notranslate"><span class="pre">x</span></code> will actually assign the outer and not the inner variable.
In any case, you will get a warning about the outer variable being shadowed.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC41LjAgPDAuOS4wOwovLyBUaGlzIHdpbGwgcmVwb3J0IGEgd2FybmluZwpjb250cmFjdCBDIHsKICAgIGZ1bmN0aW9uIGYoKSBwdXJlIHB1YmxpYyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgdWludCB4ID0gMTsKICAgICAgICB7CiAgICAgICAgICAgIHggPSAyOyAvLyB0aGlzIHdpbGwgYXNzaWduIHRvIHRoZSBvdXRlciB2YXJpYWJsZQogICAgICAgICAgICB1aW50IHg7CiAgICAgICAgfQogICAgICAgIHJldHVybiB4OyAvLyB4IGhhcyB2YWx1ZSAyCiAgICB9Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.5.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>
<span class="c1">// This will report a warning</span>
<span class="k">contract</span><span class="w"> </span><span class="ni">C</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">f</span><span class="p">()</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span>x<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">2</span><span class="p">;</span><span class="w"> </span><span class="c1">// this will assign to the outer variable</span>
<span class="w">            </span><span class="kt">uint</span><span class="w"> </span><span class="nv">x</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>x<span class="p">;</span><span class="w"> </span><span class="c1">// x has value 2</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Before version 0.5.0 Solidity followed the same scoping rules as
JavaScript, that is, a variable declared anywhere within a function would be in scope
for the entire function, regardless where it was declared. The following example shows a code snippet that used
to compile but leads to an error starting from version 0.5.0.</p>
</div>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC41LjAgPDAuOS4wOwovLyBUaGlzIHdpbGwgbm90IGNvbXBpbGUKY29udHJhY3QgQyB7CiAgICBmdW5jdGlvbiBmKCkgcHVyZSBwdWJsaWMgcmV0dXJucyAodWludCkgewogICAgICAgIHggPSAyOwogICAgICAgIHVpbnQgeDsKICAgICAgICByZXR1cm4geDsKICAgIH0KfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.5.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>
<span class="c1">// This will not compile</span>
<span class="k">contract</span><span class="w"> </span><span class="ni">C</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">f</span><span class="p">()</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>x<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">2</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="w"> </span><span class="nv">x</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>x<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="checked-or-unchecked-arithmetic">
<span id="unchecked"></span><span id="index-7"></span><h3>Checked or Unchecked Arithmetic<a class="headerlink" href="#checked-or-unchecked-arithmetic" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>An overflow or underflow is the situation where the resulting value of an arithmetic operation,
when executed on an unrestricted integer, falls outside the range of the result type.</p>
<p>Prior to Solidity 0.8.0, arithmetic operations would always wrap in case of
under- or overflow leading to widespread use of libraries that introduce
additional checks.</p>
<p>Since Solidity 0.8.0, all arithmetic operations revert on over- and underflow by default,
thus making the use of these libraries unnecessary.</p>
<p>To obtain the previous behaviour, an <code class="docutils literal notranslate"><span class="pre">unchecked</span></code> block can be used:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5IF4wLjguMDsKY29udHJhY3QgQyB7CiAgICBmdW5jdGlvbiBmKHVpbnQgYSwgdWludCBiKSBwdXJlIHB1YmxpYyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgLy8gVGhpcyBzdWJ0cmFjdGlvbiB3aWxsIHdyYXAgb24gdW5kZXJmbG93LgogICAgICAgIHVuY2hlY2tlZCB7IHJldHVybiBhIC0gYjsgfQogICAgfQogICAgZnVuY3Rpb24gZyh1aW50IGEsIHVpbnQgYikgcHVyZSBwdWJsaWMgcmV0dXJucyAodWludCkgewogICAgICAgIC8vIFRoaXMgc3VidHJhY3Rpb24gd2lsbCByZXZlcnQgb24gdW5kZXJmbG93LgogICAgICAgIHJldHVybiBhIC0gYjsKICAgIH0KfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.8.0</span><span class="p">;</span><span class="w"></span>
<span class="k">contract</span><span class="w"> </span><span class="ni">C</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">f</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">a</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">b</span><span class="p">)</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// This subtraction will wrap on underflow.</span>
<span class="w">        </span>unchecked<span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kt">return</span><span class="w"> </span>a<span class="w"> </span><span class="o">-</span><span class="w"> </span>b<span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">g</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">a</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">b</span><span class="p">)</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// This subtraction will revert on underflow.</span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>a<span class="w"> </span><span class="o">-</span><span class="w"> </span>b<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>The call to <code class="docutils literal notranslate"><span class="pre">f(2,</span> <span class="pre">3)</span></code> will return <code class="docutils literal notranslate"><span class="pre">2**256-1</span></code>, while <code class="docutils literal notranslate"><span class="pre">g(2,</span> <span class="pre">3)</span></code> will cause
a failing assertion.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">unchecked</span></code> block can be used everywhere inside a block, but not as a replacement
for a block. It also cannot be nested.</p>
<p>The setting only affects the statements that are syntactically inside the block.
Functions called from within an <code class="docutils literal notranslate"><span class="pre">unchecked</span></code> block do not inherit the property.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To avoid ambiguity, you cannot use <code class="docutils literal notranslate"><span class="pre">_;</span></code> inside an <code class="docutils literal notranslate"><span class="pre">unchecked</span></code> block.</p>
</div>
<p>The following operators will cause a failing assertion on overflow or underflow
and will wrap without an error if used inside an unchecked block:</p>
<p><code class="docutils literal notranslate"><span class="pre">++</span></code>, <code class="docutils literal notranslate"><span class="pre">--</span></code>, <code class="docutils literal notranslate"><span class="pre">+</span></code>, binary <code class="docutils literal notranslate"><span class="pre">-</span></code>, unary <code class="docutils literal notranslate"><span class="pre">-</span></code>, <code class="docutils literal notranslate"><span class="pre">*</span></code>, <code class="docutils literal notranslate"><span class="pre">/</span></code>, <code class="docutils literal notranslate"><span class="pre">%</span></code>, <code class="docutils literal notranslate"><span class="pre">**</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">+=</span></code>, <code class="docutils literal notranslate"><span class="pre">-=</span></code>, <code class="docutils literal notranslate"><span class="pre">*=</span></code>, <code class="docutils literal notranslate"><span class="pre">/=</span></code>, <code class="docutils literal notranslate"><span class="pre">%=</span></code></p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>It is not possible to disable the check for division by zero
or modulo by zero using the <code class="docutils literal notranslate"><span class="pre">unchecked</span></code> block.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Bitwise operators do not perform overflow or underflow checks.
This is particularly visible when using bitwise shifts (<code class="docutils literal notranslate"><span class="pre">&lt;&lt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;&lt;=</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;&gt;=</span></code>) in
place of integer division and multiplication by a power of 2.
For example <code class="docutils literal notranslate"><span class="pre">type(uint256).max</span> <span class="pre">&lt;&lt;</span> <span class="pre">3</span></code> does not revert even though <code class="docutils literal notranslate"><span class="pre">type(uint256).max</span> <span class="pre">*</span> <span class="pre">8</span></code> would.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The second statement in <code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">x</span> <span class="pre">=</span> <span class="pre">type(int).min;</span> <span class="pre">-x;</span></code> will result in an overflow
because the negative range can hold one more value than the positive range.</p>
</div>
<p>Explicit type conversions will always truncate and never cause a failing assertion
with the exception of a conversion from an integer to an enum type.</p>
</section>
<section id="error-handling-assert-require-revert-and-exceptions">
<span id="assert-and-require"></span><span id="index-8"></span><h3>Error handling: Assert, Require, Revert and Exceptions<a class="headerlink" href="#error-handling-assert-require-revert-and-exceptions" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Solidity uses state-reverting exceptions to handle errors.
Such an exception undoes all changes made to the
state in the current call (and all its sub-calls) and
flags an error to the caller.</p>
<p>When exceptions happen in a sub-call, they ‚Äúbubble up‚Äù (i.e.,
exceptions are rethrown) automatically unless they are caught in
a <code class="docutils literal notranslate"><span class="pre">try/catch</span></code> statement. Exceptions to this rule are <code class="docutils literal notranslate"><span class="pre">send</span></code>
and the low-level functions <code class="docutils literal notranslate"><span class="pre">call</span></code>, <code class="docutils literal notranslate"><span class="pre">delegatecall</span></code> and
<code class="docutils literal notranslate"><span class="pre">staticcall</span></code>: they return <code class="docutils literal notranslate"><span class="pre">false</span></code> as their first return value in case
of an exception instead of ‚Äúbubbling up‚Äù.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The low-level functions <code class="docutils literal notranslate"><span class="pre">call</span></code>, <code class="docutils literal notranslate"><span class="pre">delegatecall</span></code> and
<code class="docutils literal notranslate"><span class="pre">staticcall</span></code> return <code class="docutils literal notranslate"><span class="pre">true</span></code> as their first return value
if the account called is non-existent, as part of the design
of the EVM. Account existence must be checked prior to calling if needed.</p>
</div>
<p>Exceptions can contain error data that is passed back to the caller
in the form of <a class="reference internal" href="index.html#errors"><span class="std std-ref">error instances</span></a>.
The built-in errors <code class="docutils literal notranslate"><span class="pre">Error(string)</span></code> and <code class="docutils literal notranslate"><span class="pre">Panic(uint256)</span></code> are
used by special functions, as explained below. <code class="docutils literal notranslate"><span class="pre">Error</span></code> is used for ‚Äúregular‚Äù error conditions
while <code class="docutils literal notranslate"><span class="pre">Panic</span></code> is used for errors that should not be present in bug-free code.</p>
<section id="panic-via-assert-and-error-via-require">
<h4>Panic via <code class="docutils literal notranslate"><span class="pre">assert</span></code> and Error via <code class="docutils literal notranslate"><span class="pre">require</span></code><a class="headerlink" href="#panic-via-assert-and-error-via-require" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>The convenience functions <code class="docutils literal notranslate"><span class="pre">assert</span></code> and <code class="docutils literal notranslate"><span class="pre">require</span></code> can be used to check for conditions and throw an exception
if the condition is not met.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">assert</span></code> function creates an error of type <code class="docutils literal notranslate"><span class="pre">Panic(uint256)</span></code>.
The same error is created by the compiler in certain situations as listed below.</p>
<p>Assert should only be used to test for internal
errors, and to check invariants. Properly functioning code should
never create a Panic, not even on invalid external input.
If this happens, then there
is a bug in your contract which you should fix. Language analysis
tools can evaluate your contract to identify the conditions and
function calls which will cause a Panic.</p>
<p>A Panic exception is generated in the following situations.
The error code supplied with the error data indicates the kind of panic.</p>
<ol class="arabic simple">
<li><p>0x00: Used for generic compiler inserted panics.</p></li>
<li><p>0x01: If you call <code class="docutils literal notranslate"><span class="pre">assert</span></code> with an argument that evaluates to false.</p></li>
<li><p>0x11: If an arithmetic operation results in underflow or overflow outside of an <code class="docutils literal notranslate"><span class="pre">unchecked</span> <span class="pre">{</span> <span class="pre">...</span> <span class="pre">}</span></code> block.</p></li>
<li><p>0x12; If you divide or modulo by zero (e.g. <code class="docutils literal notranslate"><span class="pre">5</span> <span class="pre">/</span> <span class="pre">0</span></code> or <code class="docutils literal notranslate"><span class="pre">23</span> <span class="pre">%</span> <span class="pre">0</span></code>).</p></li>
<li><p>0x21: If you convert a value that is too big or negative into an enum type.</p></li>
<li><p>0x22: If you access a storage byte array that is incorrectly encoded.</p></li>
<li><p>0x31: If you call <code class="docutils literal notranslate"><span class="pre">.pop()</span></code> on an empty array.</p></li>
<li><p>0x32: If you access an array, <code class="docutils literal notranslate"><span class="pre">bytesN</span></code> or an array slice at an out-of-bounds or negative index (i.e. <code class="docutils literal notranslate"><span class="pre">x[i]</span></code> where <code class="docutils literal notranslate"><span class="pre">i</span> <span class="pre">&gt;=</span> <span class="pre">x.length</span></code> or <code class="docutils literal notranslate"><span class="pre">i</span> <span class="pre">&lt;</span> <span class="pre">0</span></code>).</p></li>
<li><p>0x41: If you allocate too much memory or create an array that is too large.</p></li>
<li><p>0x51: If you call a zero-initialized variable of internal function type.</p></li>
</ol>
<p>The <code class="docutils literal notranslate"><span class="pre">require</span></code> function either creates an error without any data or
an error of type <code class="docutils literal notranslate"><span class="pre">Error(string)</span></code>. It
should be used to ensure valid conditions
that cannot be detected until execution time.
This includes conditions on inputs
or return values from calls to external contracts.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is currently not possible to use custom errors in combination
with <code class="docutils literal notranslate"><span class="pre">require</span></code>. Please use <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">(!condition)</span> <span class="pre">revert</span> <span class="pre">CustomError();</span></code> instead.</p>
</div>
<p>An <code class="docutils literal notranslate"><span class="pre">Error(string)</span></code> exception (or an exception without data) is generated
by the compiler
in the following situations:</p>
<ol class="arabic simple">
<li><p>Calling <code class="docutils literal notranslate"><span class="pre">require(x)</span></code> where <code class="docutils literal notranslate"><span class="pre">x</span></code> evaluates to <code class="docutils literal notranslate"><span class="pre">false</span></code>.</p></li>
<li><p>If you use <code class="docutils literal notranslate"><span class="pre">revert()</span></code> or <code class="docutils literal notranslate"><span class="pre">revert(&quot;description&quot;)</span></code>.</p></li>
<li><p>If you perform an external function call targeting a contract that contains no code.</p></li>
<li><p>If your contract receives Ether via a public function without
<code class="docutils literal notranslate"><span class="pre">payable</span></code> modifier (including the constructor and the fallback function).</p></li>
<li><p>If your contract receives Ether via a public getter function.</p></li>
</ol>
<p>For the following cases, the error data from the external call
(if provided) is forwarded. This means that it can either cause
an <cite>Error</cite> or a <cite>Panic</cite> (or whatever else was given):</p>
<ol class="arabic simple">
<li><p>If a <code class="docutils literal notranslate"><span class="pre">.transfer()</span></code> fails.</p></li>
<li><p>If you call a function via a message call but it does not finish
properly (i.e., it runs out of gas, has no matching function, or
throws an exception itself), except when a low level operation
<code class="docutils literal notranslate"><span class="pre">call</span></code>, <code class="docutils literal notranslate"><span class="pre">send</span></code>, <code class="docutils literal notranslate"><span class="pre">delegatecall</span></code>, <code class="docutils literal notranslate"><span class="pre">callcode</span></code> or <code class="docutils literal notranslate"><span class="pre">staticcall</span></code>
is used. The low level operations never throw exceptions but
indicate failures by returning <code class="docutils literal notranslate"><span class="pre">false</span></code>.</p></li>
<li><p>If you create a contract using the <code class="docutils literal notranslate"><span class="pre">new</span></code> keyword but the contract
creation <a class="reference internal" href="#creating-contracts"><span class="std std-ref">does not finish properly</span></a>.</p></li>
</ol>
<p>You can optionally provide a message string for <code class="docutils literal notranslate"><span class="pre">require</span></code>, but not for <code class="docutils literal notranslate"><span class="pre">assert</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you do not provide a string argument to <code class="docutils literal notranslate"><span class="pre">require</span></code>, it will revert
with empty error data, not even including the error selector.</p>
</div>
<p>The following example shows how you can use <code class="docutils literal notranslate"><span class="pre">require</span></code> to check conditions on inputs
and <code class="docutils literal notranslate"><span class="pre">assert</span></code> for internal error checking.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC41LjAgPDAuOS4wOwoKY29udHJhY3QgU2hhcmVyIHsKICAgIGZ1bmN0aW9uIHNlbmRIYWxmKGFkZHJlc3MgcGF5YWJsZSBhZGRyKSBwdWJsaWMgcGF5YWJsZSByZXR1cm5zICh1aW50IGJhbGFuY2UpIHsKICAgICAgICByZXF1aXJlKG1zZy52YWx1ZSAlIDIgPT0gMCwgIkV2ZW4gdmFsdWUgcmVxdWlyZWQuIik7CiAgICAgICAgdWludCBiYWxhbmNlQmVmb3JlVHJhbnNmZXIgPSBhZGRyZXNzKHRoaXMpLmJhbGFuY2U7CiAgICAgICAgYWRkci50cmFuc2Zlcihtc2cudmFsdWUgLyAyKTsKICAgICAgICAvLyBTaW5jZSB0cmFuc2ZlciB0aHJvd3MgYW4gZXhjZXB0aW9uIG9uIGZhaWx1cmUgYW5kCiAgICAgICAgLy8gY2Fubm90IGNhbGwgYmFjayBoZXJlLCB0aGVyZSBzaG91bGQgYmUgbm8gd2F5IGZvciB1cyB0bwogICAgICAgIC8vIHN0aWxsIGhhdmUgaGFsZiBvZiB0aGUgbW9uZXkuCiAgICAgICAgYXNzZXJ0KGFkZHJlc3ModGhpcykuYmFsYW5jZSA9PSBiYWxhbmNlQmVmb3JlVHJhbnNmZXIgLSBtc2cudmFsdWUgLyAyKTsKICAgICAgICByZXR1cm4gYWRkcmVzcyh0aGlzKS5iYWxhbmNlOwogICAgfQp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.5.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Sharer</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">sendHalf</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">payable</span><span class="w"> </span>addr<span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">balance</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span><span class="k">msg.value</span><span class="w"> </span><span class="err">%</span><span class="w"> </span><span class="m m-Decimal">2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Even value required.&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="w"> </span><span class="nv">balanceBeforeTransfer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">address</span><span class="p">(</span><span class="kt">this</span><span class="p">).</span>balance<span class="p">;</span><span class="w"></span>
<span class="w">        </span>addr<span class="p">.</span>transfer<span class="p">(</span><span class="k">msg.value</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m m-Decimal">2</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Since transfer throws an exception on failure and</span>
<span class="w">        </span><span class="c1">// cannot call back here, there should be no way for us to</span>
<span class="w">        </span><span class="c1">// still have half of the money.</span>
<span class="w">        </span>assert<span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="kt">this</span><span class="p">).</span>balance<span class="w"> </span><span class="o">==</span><span class="w"> </span>balanceBeforeTransfer<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">msg.value</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m m-Decimal">2</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span><span class="kt">address</span><span class="p">(</span><span class="kt">this</span><span class="p">).</span>balance<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Internally, Solidity performs a revert operation (instruction
<code class="docutils literal notranslate"><span class="pre">0xfd</span></code>). This causes
the EVM to revert all changes made to the state. The reason for reverting
is that there is no safe way to continue execution, because an expected effect
did not occur. Because we want to keep the atomicity of transactions, the
safest action is to revert all changes and make the whole transaction
(or at least call) without effect.</p>
<p>In both cases, the caller can react on such failures using <code class="docutils literal notranslate"><span class="pre">try</span></code>/<code class="docutils literal notranslate"><span class="pre">catch</span></code>, but
the changes in the callee will always be reverted.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Panic exceptions used to use the <code class="docutils literal notranslate"><span class="pre">invalid</span></code> opcode before Solidity 0.8.0,
which consumed all gas available to the call.
Exceptions that use <code class="docutils literal notranslate"><span class="pre">require</span></code> used to consume all gas until before the Metropolis release.</p>
</div>
</section>
<section id="revert">
<span id="revert-statement"></span><h4><code class="docutils literal notranslate"><span class="pre">revert</span></code><a class="headerlink" href="#revert" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>A direct revert can be triggered using the <code class="docutils literal notranslate"><span class="pre">revert</span></code> statement and the <code class="docutils literal notranslate"><span class="pre">revert</span></code> function.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">revert</span></code> statement takes a custom error as direct argument without parentheses:</p>
<blockquote>
<div><p>revert CustomError(arg1, arg2);</p>
</div></blockquote>
<p>For backwards-compatibility reasons, there is also the <code class="docutils literal notranslate"><span class="pre">revert()</span></code> function, which uses parentheses
and accepts a string:</p>
<blockquote>
<div><p>revert();
revert(‚Äúdescription‚Äù);</p>
</div></blockquote>
<p>The error data will be passed back to the caller and can be caught there.
Using <code class="docutils literal notranslate"><span class="pre">revert()</span></code> causes a revert without any error data while <code class="docutils literal notranslate"><span class="pre">revert(&quot;description&quot;)</span></code>
will create an <code class="docutils literal notranslate"><span class="pre">Error(string)</span></code> error.</p>
<p>Using a custom error instance will usually be much cheaper than a string description,
because you can use the name of the error to describe it, which is encoded in only
four bytes. A longer description can be supplied via NatSpec which does not incur
any costs.</p>
<p>The following example shows how to use an error string and a custom error instance
together with <code class="docutils literal notranslate"><span class="pre">revert</span></code> and the equivalent <code class="docutils literal notranslate"><span class="pre">require</span></code>:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5IF4wLjguNDsKCmNvbnRyYWN0IFZlbmRpbmdNYWNoaW5lIHsKICAgIGFkZHJlc3Mgb3duZXI7CiAgICBlcnJvciBVbmF1dGhvcml6ZWQoKTsKICAgIGZ1bmN0aW9uIGJ1eSh1aW50IGFtb3VudCkgcHVibGljIHBheWFibGUgewogICAgICAgIGlmIChhbW91bnQgPiBtc2cudmFsdWUgLyAyIGV0aGVyKQogICAgICAgICAgICByZXZlcnQoIk5vdCBlbm91Z2ggRXRoZXIgcHJvdmlkZWQuIik7CiAgICAgICAgLy8gQWx0ZXJuYXRpdmUgd2F5IHRvIGRvIGl0OgogICAgICAgIHJlcXVpcmUoCiAgICAgICAgICAgIGFtb3VudCA8PSBtc2cudmFsdWUgLyAyIGV0aGVyLAogICAgICAgICAgICAiTm90IGVub3VnaCBFdGhlciBwcm92aWRlZC4iCiAgICAgICAgKTsKICAgICAgICAvLyBQZXJmb3JtIHRoZSBwdXJjaGFzZS4KICAgIH0KICAgIGZ1bmN0aW9uIHdpdGhkcmF3KCkgcHVibGljIHsKICAgICAgICBpZiAobXNnLnNlbmRlciAhPSBvd25lcikKICAgICAgICAgICAgcmV2ZXJ0IFVuYXV0aG9yaXplZCgpOwoKICAgICAgICBwYXlhYmxlKG1zZy5zZW5kZXIpLnRyYW5zZmVyKGFkZHJlc3ModGhpcykuYmFsYW5jZSk7CiAgICB9Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.8.4</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">VendingMachine</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">owner</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span>error<span class="w"> </span>Unauthorized<span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">buy</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">amount</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>amount<span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">msg.value</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m m-Decimal">2</span><span class="w"> </span>ether<span class="p">)</span><span class="w"></span>
<span class="w">            </span>revert<span class="p">(</span><span class="s2">&quot;Not enough Ether provided.&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Alternative way to do it:</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span><span class="w"></span>
<span class="w">            </span>amount<span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="k">msg.value</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m m-Decimal">2</span><span class="w"> </span>ether<span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="s2">&quot;Not enough Ether provided.&quot;</span><span class="w"></span>
<span class="w">        </span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Perform the purchase.</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">withdraw</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span><span class="k">msg.sender</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span>owner<span class="p">)</span><span class="w"></span>
<span class="w">            </span>revert<span class="w"> </span>Unauthorized<span class="p">();</span><span class="w"></span>

<span class="w">        </span><span class="kt">payable</span><span class="p">(</span><span class="k">msg.sender</span><span class="p">).</span>transfer<span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="kt">this</span><span class="p">).</span>balance<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>The two ways <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">(!condition)</span> <span class="pre">revert(...);</span></code> and <code class="docutils literal notranslate"><span class="pre">require(condition,</span> <span class="pre">...);</span></code> are
equivalent as long as the arguments to <code class="docutils literal notranslate"><span class="pre">revert</span></code> and <code class="docutils literal notranslate"><span class="pre">require</span></code> do not have side-effects,
for example if they are just strings.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">require</span></code> function is evaluated just as any other function.
This means that all arguments are evaluated before the function itself is executed.
In particular, in <code class="docutils literal notranslate"><span class="pre">require(condition,</span> <span class="pre">f())</span></code> the function <code class="docutils literal notranslate"><span class="pre">f</span></code> is executed even if
<code class="docutils literal notranslate"><span class="pre">condition</span></code> is true.</p>
</div>
<p>The provided string is <a class="reference internal" href="index.html#abi"><span class="std std-ref">abi-encoded</span></a> as if it were a call to a function <code class="docutils literal notranslate"><span class="pre">Error(string)</span></code>.
In the above example, <code class="docutils literal notranslate"><span class="pre">revert(&quot;Not</span> <span class="pre">enough</span> <span class="pre">Ether</span> <span class="pre">provided.&quot;);</span></code> returns the following hexadecimal as error return data:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=MHgwOGMzNzlhMCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZ1bmN0aW9uIHNlbGVjdG9yIGZvciBFcnJvcihzdHJpbmcpCjB4MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAyMCAvLyBEYXRhIG9mZnNldAoweDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMWEgLy8gU3RyaW5nIGxlbmd0aAoweDRlNmY3NDIwNjU2ZTZmNzU2NzY4MjA0NTc0Njg2NTcyMjA3MDcyNmY3NjY5NjQ2NTY0MmUwMDAwMDAwMDAwMDAgLy8gU3RyaW5nIGRhdGE="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="mh">0x08c379a0</span>                                                         <span class="c1">// Function selector for Error(string)</span>
<span class="mh">0x0000000000000000000000000000000000000000000000000000000000000020</span> <span class="c1">// Data offset</span>
<span class="mh">0x000000000000000000000000000000000000000000000000000000000000001a</span> <span class="c1">// String length</span>
<span class="mh">0x4e6f7420656e6f7567682045746865722070726f76696465642e000000000000</span> <span class="c1">// String data</span>
</pre></div>
</div>
<p>The provided message can be retrieved by the caller using <code class="docutils literal notranslate"><span class="pre">try</span></code>/<code class="docutils literal notranslate"><span class="pre">catch</span></code> as shown below.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There used to be a keyword called <code class="docutils literal notranslate"><span class="pre">throw</span></code> with the same semantics as <code class="docutils literal notranslate"><span class="pre">revert()</span></code> which
was deprecated in version 0.4.13 and removed in version 0.5.0.</p>
</div>
</section>
<section id="try-catch">
<span id="id4"></span><h4><code class="docutils literal notranslate"><span class="pre">try</span></code>/<code class="docutils literal notranslate"><span class="pre">catch</span></code><a class="headerlink" href="#try-catch" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>A failure in an external call can be caught using a try/catch statement, as follows:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC44LjE7CgppbnRlcmZhY2UgRGF0YUZlZWQgeyBmdW5jdGlvbiBnZXREYXRhKGFkZHJlc3MgdG9rZW4pIGV4dGVybmFsIHJldHVybnMgKHVpbnQgdmFsdWUpOyB9Cgpjb250cmFjdCBGZWVkQ29uc3VtZXIgewogICAgRGF0YUZlZWQgZmVlZDsKICAgIHVpbnQgZXJyb3JDb3VudDsKICAgIGZ1bmN0aW9uIHJhdGUoYWRkcmVzcyB0b2tlbikgcHVibGljIHJldHVybnMgKHVpbnQgdmFsdWUsIGJvb2wgc3VjY2VzcykgewogICAgICAgIC8vIFBlcm1hbmVudGx5IGRpc2FibGUgdGhlIG1lY2hhbmlzbSBpZiB0aGVyZSBhcmUKICAgICAgICAvLyBtb3JlIHRoYW4gMTAgZXJyb3JzLgogICAgICAgIHJlcXVpcmUoZXJyb3JDb3VudCA8IDEwKTsKICAgICAgICB0cnkgZmVlZC5nZXREYXRhKHRva2VuKSByZXR1cm5zICh1aW50IHYpIHsKICAgICAgICAgICAgcmV0dXJuICh2LCB0cnVlKTsKICAgICAgICB9IGNhdGNoIEVycm9yKHN0cmluZyBtZW1vcnkgLypyZWFzb24qLykgewogICAgICAgICAgICAvLyBUaGlzIGlzIGV4ZWN1dGVkIGluIGNhc2UKICAgICAgICAgICAgLy8gcmV2ZXJ0IHdhcyBjYWxsZWQgaW5zaWRlIGdldERhdGEKICAgICAgICAgICAgLy8gYW5kIGEgcmVhc29uIHN0cmluZyB3YXMgcHJvdmlkZWQuCiAgICAgICAgICAgIGVycm9yQ291bnQrKzsKICAgICAgICAgICAgcmV0dXJuICgwLCBmYWxzZSk7CiAgICAgICAgfSBjYXRjaCBQYW5pYyh1aW50IC8qZXJyb3JDb2RlKi8pIHsKICAgICAgICAgICAgLy8gVGhpcyBpcyBleGVjdXRlZCBpbiBjYXNlIG9mIGEgcGFuaWMsCiAgICAgICAgICAgIC8vIGkuZS4gYSBzZXJpb3VzIGVycm9yIGxpa2UgZGl2aXNpb24gYnkgemVybwogICAgICAgICAgICAvLyBvciBvdmVyZmxvdy4gVGhlIGVycm9yIGNvZGUgY2FuIGJlIHVzZWQKICAgICAgICAgICAgLy8gdG8gZGV0ZXJtaW5lIHRoZSBraW5kIG9mIGVycm9yLgogICAgICAgICAgICBlcnJvckNvdW50Kys7CiAgICAgICAgICAgIHJldHVybiAoMCwgZmFsc2UpOwogICAgICAgIH0gY2F0Y2ggKGJ5dGVzIG1lbW9yeSAvKmxvd0xldmVsRGF0YSovKSB7CiAgICAgICAgICAgIC8vIFRoaXMgaXMgZXhlY3V0ZWQgaW4gY2FzZSByZXZlcnQoKSB3YXMgdXNlZC4KICAgICAgICAgICAgZXJyb3JDb3VudCsrOwogICAgICAgICAgICByZXR1cm4gKDAsIGZhbHNlKTsKICAgICAgICB9CiAgICB9Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.8.1</span><span class="p">;</span><span class="w"></span>

interface<span class="w"> </span>DataFeed<span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kt">function</span><span class="w"> </span><span class="nv">getData</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">token</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">value</span><span class="p">);</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">FeedConsumer</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span>DataFeed<span class="w"> </span>feed<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="nv">errorCount</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">rate</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">token</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">value</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nv">success</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Permanently disable the mechanism if there are</span>
<span class="w">        </span><span class="c1">// more than 10 errors.</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>errorCount<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m m-Decimal">10</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span>try<span class="w"> </span>feed<span class="p">.</span>getData<span class="p">(</span>token<span class="p">)</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="kt">return</span><span class="w"> </span><span class="p">(</span>v<span class="p">,</span><span class="w"> </span><span class="kt">true</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span>catch<span class="w"> </span>Error<span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span><span class="cm">/*reason*/</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="c1">// This is executed in case</span>
<span class="w">            </span><span class="c1">// revert was called inside getData</span>
<span class="w">            </span><span class="c1">// and a reason string was provided.</span>
<span class="w">            </span>errorCount<span class="o">++</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="kt">return</span><span class="w"> </span><span class="p">(</span><span class="m m-Decimal">0</span><span class="p">,</span><span class="w"> </span><span class="kt">false</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span>catch<span class="w"> </span>Panic<span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="cm">/*errorCode*/</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="c1">// This is executed in case of a panic,</span>
<span class="w">            </span><span class="c1">// i.e. a serious error like division by zero</span>
<span class="w">            </span><span class="c1">// or overflow. The error code can be used</span>
<span class="w">            </span><span class="c1">// to determine the kind of error.</span>
<span class="w">            </span>errorCount<span class="o">++</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="kt">return</span><span class="w"> </span><span class="p">(</span><span class="m m-Decimal">0</span><span class="p">,</span><span class="w"> </span><span class="kt">false</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span>catch<span class="w"> </span><span class="p">(</span><span class="kt">bytes</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span><span class="cm">/*lowLevelData*/</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="c1">// This is executed in case revert() was used.</span>
<span class="w">            </span>errorCount<span class="o">++</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="kt">return</span><span class="w"> </span><span class="p">(</span><span class="m m-Decimal">0</span><span class="p">,</span><span class="w"> </span><span class="kt">false</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">try</span></code> keyword has to be followed by an expression representing an external function call
or a contract creation (<code class="docutils literal notranslate"><span class="pre">new</span> <span class="pre">ContractName()</span></code>).
Errors inside the expression are not caught (for example if it is a complex expression
that also involves internal function calls), only a revert happening inside the external
call itself. The <code class="docutils literal notranslate"><span class="pre">returns</span></code> part (which is optional) that follows declares return variables
matching the types returned by the external call. In case there was no error,
these variables are assigned and the contract‚Äôs execution continues inside the
first success block. If the end of the success block is reached, execution continues after the <code class="docutils literal notranslate"><span class="pre">catch</span></code> blocks.</p>
<p>Solidity supports different kinds of catch blocks depending on the
type of error:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">catch</span> <span class="pre">Error(string</span> <span class="pre">memory</span> <span class="pre">reason)</span> <span class="pre">{</span> <span class="pre">...</span> <span class="pre">}</span></code>: This catch clause is executed if the error was caused by <code class="docutils literal notranslate"><span class="pre">revert(&quot;reasonString&quot;)</span></code> or
<code class="docutils literal notranslate"><span class="pre">require(false,</span> <span class="pre">&quot;reasonString&quot;)</span></code> (or an internal error that causes such an
exception).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">catch</span> <span class="pre">Panic(uint</span> <span class="pre">errorCode)</span> <span class="pre">{</span> <span class="pre">...</span> <span class="pre">}</span></code>: If the error was caused by a panic, i.e. by a failing <code class="docutils literal notranslate"><span class="pre">assert</span></code>, division by zero,
invalid array access, arithmetic overflow and others, this catch clause will be run.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">catch</span> <span class="pre">(bytes</span> <span class="pre">memory</span> <span class="pre">lowLevelData)</span> <span class="pre">{</span> <span class="pre">...</span> <span class="pre">}</span></code>: This clause is executed if the error signature
does not match any other clause, if there was an error while decoding the error
message, or
if no error data was provided with the exception.
The declared variable provides access to the low-level error data in that case.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">catch</span> <span class="pre">{</span> <span class="pre">...</span> <span class="pre">}</span></code>: If you are not interested in the error data, you can just use
<code class="docutils literal notranslate"><span class="pre">catch</span> <span class="pre">{</span> <span class="pre">...</span> <span class="pre">}</span></code> (even as the only catch clause) instead of the previous clause.</p></li>
</ul>
<p>It is planned to support other types of error data in the future.
The strings <code class="docutils literal notranslate"><span class="pre">Error</span></code> and <code class="docutils literal notranslate"><span class="pre">Panic</span></code> are currently parsed as is and are not treated as identifiers.</p>
<p>In order to catch all error cases, you have to have at least the clause
<code class="docutils literal notranslate"><span class="pre">catch</span> <span class="pre">{</span> <span class="pre">...}</span></code> or the clause <code class="docutils literal notranslate"><span class="pre">catch</span> <span class="pre">(bytes</span> <span class="pre">memory</span> <span class="pre">lowLevelData)</span> <span class="pre">{</span> <span class="pre">...</span> <span class="pre">}</span></code>.</p>
<p>The variables declared in the <code class="docutils literal notranslate"><span class="pre">returns</span></code> and the <code class="docutils literal notranslate"><span class="pre">catch</span></code> clause are only
in scope in the block that follows.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If an error happens during the decoding of the return data
inside a try/catch-statement, this causes an exception in the currently
executing contract and because of that, it is not caught in the catch clause.
If there is an error during decoding of <code class="docutils literal notranslate"><span class="pre">catch</span> <span class="pre">Error(string</span> <span class="pre">memory</span> <span class="pre">reason)</span></code>
and there is a low-level catch clause, this error is caught there.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If execution reaches a catch-block, then the state-changing effects of
the external call have been reverted. If execution reaches
the success block, the effects were not reverted.
If the effects have been reverted, then execution either continues
in a catch block or the execution of the try/catch statement itself
reverts (for example due to decoding failures as noted above or
due to not providing a low-level catch clause).</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The reason behind a failed call can be manifold. Do not assume that
the error message is coming directly from the called contract:
The error might have happened deeper down in the call chain and the
called contract just forwarded it. Also, it could be due to an
out-of-gas situation and not a deliberate error condition:
The caller always retains at least 1/64th of the gas in a call and thus
even if the called contract goes out of gas, the caller still
has some gas left.</p>
</div>
</section>
</section>
</section>
<span id="document-contracts"></span><section id="contracts">
<span id="index-0"></span><span id="id1"></span><h2>Contracts<a class="headerlink" href="#contracts" title="Permalink to this heading">ÔÉÅ</a></h2>
<p>Contracts in Solidity are similar to classes in object-oriented languages. They
contain persistent data in state variables, and functions that can modify these
variables. Calling a function on a different contract (instance) will perform
an EVM function call and thus switch the context such that state variables
in the calling contract are
inaccessible. A contract and its functions need to be called for anything to happen.
There is no ‚Äúcron‚Äù concept in Ethereum to call a function at a particular event automatically.</p>
<section id="creating-contracts">
<span id="index-1"></span><h3>Creating Contracts<a class="headerlink" href="#creating-contracts" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Contracts can be created ‚Äúfrom outside‚Äù via Ethereum transactions or from within Solidity contracts.</p>
<p>IDEs, such as <a class="reference external" href="https://remix.ethereum.org/">Remix</a>, make the creation process seamless using UI elements.</p>
<p>One way to create contracts programmatically on Ethereum is via the JavaScript API <a class="reference external" href="https://github.com/ethereum/web3.js">web3.js</a>.
It has a function called <a class="reference external" href="https://web3js.readthedocs.io/en/1.0/web3-eth-contract.html#new-contract">web3.eth.Contract</a>
to facilitate contract creation.</p>
<p>When a contract is created, its <a class="reference internal" href="#constructor"><span class="std std-ref">constructor</span></a> (a function declared with
the <code class="docutils literal notranslate"><span class="pre">constructor</span></code> keyword) is executed once.</p>
<p>A constructor is optional. Only one constructor is allowed, which means
overloading is not supported.</p>
<p>After the constructor has executed, the final code of the contract is stored on the
blockchain. This code includes all public and external functions and all functions
that are reachable from there through function calls. The deployed code does not
include the constructor code or internal functions only called from the constructor.</p>
<p id="index-2">Internally, constructor arguments are passed <a class="reference internal" href="index.html#abi"><span class="std std-ref">ABI encoded</span></a> after the code of
the contract itself, but you do not have to care about this if you use <code class="docutils literal notranslate"><span class="pre">web3.js</span></code>.</p>
<p>If a contract wants to create another contract, the source code
(and the binary) of the created contract has to be known to the creator.
This means that cyclic creation dependencies are impossible.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC40LjIyIDwwLjkuMDsKCgpjb250cmFjdCBPd25lZFRva2VuIHsKICAgIC8vIGBUb2tlbkNyZWF0b3JgIGlzIGEgY29udHJhY3QgdHlwZSB0aGF0IGlzIGRlZmluZWQgYmVsb3cuCiAgICAvLyBJdCBpcyBmaW5lIHRvIHJlZmVyZW5jZSBpdCBhcyBsb25nIGFzIGl0IGlzIG5vdCB1c2VkCiAgICAvLyB0byBjcmVhdGUgYSBuZXcgY29udHJhY3QuCiAgICBUb2tlbkNyZWF0b3IgY3JlYXRvcjsKICAgIGFkZHJlc3Mgb3duZXI7CiAgICBieXRlczMyIG5hbWU7CgogICAgLy8gVGhpcyBpcyB0aGUgY29uc3RydWN0b3Igd2hpY2ggcmVnaXN0ZXJzIHRoZQogICAgLy8gY3JlYXRvciBhbmQgdGhlIGFzc2lnbmVkIG5hbWUuCiAgICBjb25zdHJ1Y3RvcihieXRlczMyIG5hbWVfKSB7CiAgICAgICAgLy8gU3RhdGUgdmFyaWFibGVzIGFyZSBhY2Nlc3NlZCB2aWEgdGhlaXIgbmFtZQogICAgICAgIC8vIGFuZCBub3QgdmlhIGUuZy4gYHRoaXMub3duZXJgLiBGdW5jdGlvbnMgY2FuCiAgICAgICAgLy8gYmUgYWNjZXNzZWQgZGlyZWN0bHkgb3IgdGhyb3VnaCBgdGhpcy5mYCwKICAgICAgICAvLyBidXQgdGhlIGxhdHRlciBwcm92aWRlcyBhbiBleHRlcm5hbCB2aWV3CiAgICAgICAgLy8gdG8gdGhlIGZ1bmN0aW9uLiBFc3BlY2lhbGx5IGluIHRoZSBjb25zdHJ1Y3RvciwKICAgICAgICAvLyB5b3Ugc2hvdWxkIG5vdCBhY2Nlc3MgZnVuY3Rpb25zIGV4dGVybmFsbHksCiAgICAgICAgLy8gYmVjYXVzZSB0aGUgZnVuY3Rpb24gZG9lcyBub3QgZXhpc3QgeWV0LgogICAgICAgIC8vIFNlZSB0aGUgbmV4dCBzZWN0aW9uIGZvciBkZXRhaWxzLgogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKCiAgICAgICAgLy8gV2UgcGVyZm9ybSBhbiBleHBsaWNpdCB0eXBlIGNvbnZlcnNpb24gZnJvbSBgYWRkcmVzc2AKICAgICAgICAvLyB0byBgVG9rZW5DcmVhdG9yYCBhbmQgYXNzdW1lIHRoYXQgdGhlIHR5cGUgb2YKICAgICAgICAvLyB0aGUgY2FsbGluZyBjb250cmFjdCBpcyBgVG9rZW5DcmVhdG9yYCwgdGhlcmUgaXMKICAgICAgICAvLyBubyByZWFsIHdheSB0byB2ZXJpZnkgdGhhdC4KICAgICAgICAvLyBUaGlzIGRvZXMgbm90IGNyZWF0ZSBhIG5ldyBjb250cmFjdC4KICAgICAgICBjcmVhdG9yID0gVG9rZW5DcmVhdG9yKG1zZy5zZW5kZXIpOwogICAgICAgIG5hbWUgPSBuYW1lXzsKICAgIH0KCiAgICBmdW5jdGlvbiBjaGFuZ2VOYW1lKGJ5dGVzMzIgbmV3TmFtZSkgcHVibGljIHsKICAgICAgICAvLyBPbmx5IHRoZSBjcmVhdG9yIGNhbiBhbHRlciB0aGUgbmFtZS4KICAgICAgICAvLyBXZSBjb21wYXJlIHRoZSBjb250cmFjdCBiYXNlZCBvbiBpdHMKICAgICAgICAvLyBhZGRyZXNzIHdoaWNoIGNhbiBiZSByZXRyaWV2ZWQgYnkKICAgICAgICAvLyBleHBsaWNpdCBjb252ZXJzaW9uIHRvIGFkZHJlc3MuCiAgICAgICAgaWYgKG1zZy5zZW5kZXIgPT0gYWRkcmVzcyhjcmVhdG9yKSkKICAgICAgICAgICAgbmFtZSA9IG5ld05hbWU7CiAgICB9CgogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyBuZXdPd25lcikgcHVibGljIHsKICAgICAgICAvLyBPbmx5IHRoZSBjdXJyZW50IG93bmVyIGNhbiB0cmFuc2ZlciB0aGUgdG9rZW4uCiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gb3duZXIpIHJldHVybjsKCiAgICAgICAgLy8gV2UgYXNrIHRoZSBjcmVhdG9yIGNvbnRyYWN0IGlmIHRoZSB0cmFuc2ZlcgogICAgICAgIC8vIHNob3VsZCBwcm9jZWVkIGJ5IHVzaW5nIGEgZnVuY3Rpb24gb2YgdGhlCiAgICAgICAgLy8gYFRva2VuQ3JlYXRvcmAgY29udHJhY3QgZGVmaW5lZCBiZWxvdy4gSWYKICAgICAgICAvLyB0aGUgY2FsbCBmYWlscyAoZS5nLiBkdWUgdG8gb3V0LW9mLWdhcyksCiAgICAgICAgLy8gdGhlIGV4ZWN1dGlvbiBhbHNvIGZhaWxzIGhlcmUuCiAgICAgICAgaWYgKGNyZWF0b3IuaXNUb2tlblRyYW5zZmVyT0sob3duZXIsIG5ld093bmVyKSkKICAgICAgICAgICAgb3duZXIgPSBuZXdPd25lcjsKICAgIH0KfQoKCmNvbnRyYWN0IFRva2VuQ3JlYXRvciB7CiAgICBmdW5jdGlvbiBjcmVhdGVUb2tlbihieXRlczMyIG5hbWUpCiAgICAgICAgcHVibGljCiAgICAgICAgcmV0dXJucyAoT3duZWRUb2tlbiB0b2tlbkFkZHJlc3MpCiAgICB7CiAgICAgICAgLy8gQ3JlYXRlIGEgbmV3IGBUb2tlbmAgY29udHJhY3QgYW5kIHJldHVybiBpdHMgYWRkcmVzcy4KICAgICAgICAvLyBGcm9tIHRoZSBKYXZhU2NyaXB0IHNpZGUsIHRoZSByZXR1cm4gdHlwZQogICAgICAgIC8vIG9mIHRoaXMgZnVuY3Rpb24gaXMgYGFkZHJlc3NgLCBhcyB0aGlzIGlzCiAgICAgICAgLy8gdGhlIGNsb3Nlc3QgdHlwZSBhdmFpbGFibGUgaW4gdGhlIEFCSS4KICAgICAgICByZXR1cm4gbmV3IE93bmVkVG9rZW4obmFtZSk7CiAgICB9CgogICAgZnVuY3Rpb24gY2hhbmdlTmFtZShPd25lZFRva2VuIHRva2VuQWRkcmVzcywgYnl0ZXMzMiBuYW1lKSBwdWJsaWMgewogICAgICAgIC8vIEFnYWluLCB0aGUgZXh0ZXJuYWwgdHlwZSBvZiBgdG9rZW5BZGRyZXNzYCBpcwogICAgICAgIC8vIHNpbXBseSBgYWRkcmVzc2AuCiAgICAgICAgdG9rZW5BZGRyZXNzLmNoYW5nZU5hbWUobmFtZSk7CiAgICB9CgogICAgLy8gUGVyZm9ybSBjaGVja3MgdG8gZGV0ZXJtaW5lIGlmIHRyYW5zZmVycmluZyBhIHRva2VuIHRvIHRoZQogICAgLy8gYE93bmVkVG9rZW5gIGNvbnRyYWN0IHNob3VsZCBwcm9jZWVkCiAgICBmdW5jdGlvbiBpc1Rva2VuVHJhbnNmZXJPSyhhZGRyZXNzIGN1cnJlbnRPd25lciwgYWRkcmVzcyBuZXdPd25lcikKICAgICAgICBwdWJsaWMKICAgICAgICBwdXJlCiAgICAgICAgcmV0dXJucyAoYm9vbCBvaykKICAgIHsKICAgICAgICAvLyBDaGVjayBhbiBhcmJpdHJhcnkgY29uZGl0aW9uIHRvIHNlZSBpZiB0cmFuc2ZlciBzaG91bGQgcHJvY2VlZAogICAgICAgIHJldHVybiBrZWNjYWsyNTYoYWJpLmVuY29kZVBhY2tlZChjdXJyZW50T3duZXIsIG5ld093bmVyKSlbMF0gPT0gMHg3ZjsKICAgIH0KfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.4.22</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>


<span class="k">contract</span><span class="w"> </span><span class="ni">OwnedToken</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// `TokenCreator` is a contract type that is defined below.</span>
<span class="w">    </span><span class="c1">// It is fine to reference it as long as it is not used</span>
<span class="w">    </span><span class="c1">// to create a new contract.</span>
<span class="w">    </span>TokenCreator<span class="w"> </span>creator<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">owner</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">name</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// This is the constructor which registers the</span>
<span class="w">    </span><span class="c1">// creator and the assigned name.</span>
<span class="w">    </span><span class="kt">constructor</span><span class="p">(</span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">name_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// State variables are accessed via their name</span>
<span class="w">        </span><span class="c1">// and not via e.g. `this.owner`. Functions can</span>
<span class="w">        </span><span class="c1">// be accessed directly or through `this.f`,</span>
<span class="w">        </span><span class="c1">// but the latter provides an external view</span>
<span class="w">        </span><span class="c1">// to the function. Especially in the constructor,</span>
<span class="w">        </span><span class="c1">// you should not access functions externally,</span>
<span class="w">        </span><span class="c1">// because the function does not exist yet.</span>
<span class="w">        </span><span class="c1">// See the next section for details.</span>
<span class="w">        </span>owner<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">msg.sender</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="c1">// We perform an explicit type conversion from `address`</span>
<span class="w">        </span><span class="c1">// to `TokenCreator` and assume that the type of</span>
<span class="w">        </span><span class="c1">// the calling contract is `TokenCreator`, there is</span>
<span class="w">        </span><span class="c1">// no real way to verify that.</span>
<span class="w">        </span><span class="c1">// This does not create a new contract.</span>
<span class="w">        </span>creator<span class="w"> </span><span class="o">=</span><span class="w"> </span>TokenCreator<span class="p">(</span><span class="k">msg.sender</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span>name<span class="w"> </span><span class="o">=</span><span class="w"> </span>name_<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">changeName</span><span class="p">(</span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">newName</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Only the creator can alter the name.</span>
<span class="w">        </span><span class="c1">// We compare the contract based on its</span>
<span class="w">        </span><span class="c1">// address which can be retrieved by</span>
<span class="w">        </span><span class="c1">// explicit conversion to address.</span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span><span class="k">msg.sender</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kt">address</span><span class="p">(</span>creator<span class="p">))</span><span class="w"></span>
<span class="w">            </span>name<span class="w"> </span><span class="o">=</span><span class="w"> </span>newName<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">transfer</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">newOwner</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Only the current owner can transfer the token.</span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span><span class="k">msg.sender</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span>owner<span class="p">)</span><span class="w"> </span><span class="kt">return</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="c1">// We ask the creator contract if the transfer</span>
<span class="w">        </span><span class="c1">// should proceed by using a function of the</span>
<span class="w">        </span><span class="c1">// `TokenCreator` contract defined below. If</span>
<span class="w">        </span><span class="c1">// the call fails (e.g. due to out-of-gas),</span>
<span class="w">        </span><span class="c1">// the execution also fails here.</span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>creator<span class="p">.</span>isTokenTransferOK<span class="p">(</span>owner<span class="p">,</span><span class="w"> </span>newOwner<span class="p">))</span><span class="w"></span>
<span class="w">            </span>owner<span class="w"> </span><span class="o">=</span><span class="w"> </span>newOwner<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>


<span class="k">contract</span><span class="w"> </span><span class="ni">TokenCreator</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">createToken</span><span class="p">(</span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">name</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="kt">public</span><span class="w"></span>
<span class="w">        </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span>OwnedToken<span class="w"> </span>tokenAddress<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Create a new `Token` contract and return its address.</span>
<span class="w">        </span><span class="c1">// From the JavaScript side, the return type</span>
<span class="w">        </span><span class="c1">// of this function is `address`, as this is</span>
<span class="w">        </span><span class="c1">// the closest type available in the ABI.</span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span>OwnedToken<span class="p">(</span>name<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">changeName</span><span class="p">(</span>OwnedToken<span class="w"> </span>tokenAddress<span class="p">,</span><span class="w"> </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">name</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Again, the external type of `tokenAddress` is</span>
<span class="w">        </span><span class="c1">// simply `address`.</span>
<span class="w">        </span>tokenAddress<span class="p">.</span>changeName<span class="p">(</span>name<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Perform checks to determine if transferring a token to the</span>
<span class="w">    </span><span class="c1">// `OwnedToken` contract should proceed</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">isTokenTransferOK</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">currentOwner</span><span class="p">,</span><span class="w"> </span><span class="kt">address</span><span class="w"> </span><span class="nv">newOwner</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="kt">public</span><span class="w"></span>
<span class="w">        </span>pure<span class="w"></span>
<span class="w">        </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="nv">ok</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Check an arbitrary condition to see if transfer should proceed</span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span><span class="nb">keccak256</span><span class="p">(</span>abi<span class="p">.</span>encodePacked<span class="p">(</span>currentOwner<span class="p">,</span><span class="w"> </span>newOwner<span class="p">))[</span><span class="m m-Decimal">0</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">0x7f</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<span class="target" id="index-3"></span></section>
<section id="visibility-and-getters">
<span id="id2"></span><h3>Visibility and Getters<a class="headerlink" href="#visibility-and-getters" title="Permalink to this heading">ÔÉÅ</a></h3>
<section id="state-variable-visibility">
<h4>State Variable Visibility<a class="headerlink" href="#state-variable-visibility" title="Permalink to this heading">ÔÉÅ</a></h4>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">public</span></code></dt><dd><p>Public state variables differ from internal ones only in that the compiler automatically generates
<a class="reference internal" href="#getter-functions"><span class="std std-ref">getter functions</span></a> for them, which allows other contracts to read their values.
When used within the same contract, the external access (e.g. <code class="docutils literal notranslate"><span class="pre">this.x</span></code>) invokes the getter
while internal access (e.g. <code class="docutils literal notranslate"><span class="pre">x</span></code>) gets the variable value directly from storage.
Setter functions are not generated so other contracts cannot directly modify their values.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">internal</span></code></dt><dd><p>Internal state variables can only be accessed from within the contract they are defined in
and in derived contracts.
They cannot be accessed externally.
This is the default visibility level for state variables.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">private</span></code></dt><dd><p>Private state variables are like internal ones but they are not visible in derived contracts.</p>
</dd>
</dl>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Making something <code class="docutils literal notranslate"><span class="pre">private</span></code> or <code class="docutils literal notranslate"><span class="pre">internal</span></code> only prevents other contracts from reading or modifying the information, but it will still be visible to the whole world outside of the blockchain.</p>
</div>
</section>
<section id="function-visibility">
<h4>Function Visibility<a class="headerlink" href="#function-visibility" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Solidity knows two kinds of function calls: external ones that do create an actual EVM message call and internal ones that do not.
Furthermore, internal functions can be made inaccessible to derived contracts.
This gives rise to four types of visibility for functions.</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">external</span></code></dt><dd><p>External functions are part of the contract interface,
which means they can be called from other contracts and
via transactions. An external function <code class="docutils literal notranslate"><span class="pre">f</span></code> cannot be called
internally (i.e. <code class="docutils literal notranslate"><span class="pre">f()</span></code> does not work, but <code class="docutils literal notranslate"><span class="pre">this.f()</span></code> works).</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">public</span></code></dt><dd><p>Public functions are part of the contract interface
and can be either called internally or via message calls.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">internal</span></code></dt><dd><p>Internal functions can only be accessed from within the current contract
or contracts deriving from it.
They cannot be accessed externally.
Since they are not exposed to the outside through the contract‚Äôs ABI, they can take parameters of internal types like mappings or storage references.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">private</span></code></dt><dd><p>Private functions are like internal ones but they are not visible in derived contracts.</p>
</dd>
</dl>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Making something <code class="docutils literal notranslate"><span class="pre">private</span></code> or <code class="docutils literal notranslate"><span class="pre">internal</span></code> only prevents other contracts from reading or modifying the information, but it will still be visible to the whole world outside of the blockchain.</p>
</div>
<p>The visibility specifier is given after the type for
state variables and between parameter list and
return parameter list for functions.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC40LjE2IDwwLjkuMDsKCmNvbnRyYWN0IEMgewogICAgZnVuY3Rpb24gZih1aW50IGEpIHByaXZhdGUgcHVyZSByZXR1cm5zICh1aW50IGIpIHsgcmV0dXJuIGEgKyAxOyB9CiAgICBmdW5jdGlvbiBzZXREYXRhKHVpbnQgYSkgaW50ZXJuYWwgeyBkYXRhID0gYTsgfQogICAgdWludCBwdWJsaWMgZGF0YTsKfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.4.16</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">C</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">f</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">a</span><span class="p">)</span><span class="w"> </span><span class="kt">private</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kt">return</span><span class="w"> </span>a<span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">setData</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">a</span><span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>data<span class="w"> </span><span class="o">=</span><span class="w"> </span>a<span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="k">public </span><span class="nv">data</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>In the following example, <code class="docutils literal notranslate"><span class="pre">D</span></code>, can call <code class="docutils literal notranslate"><span class="pre">c.getData()</span></code> to retrieve the value of
<code class="docutils literal notranslate"><span class="pre">data</span></code> in state storage, but is not able to call <code class="docutils literal notranslate"><span class="pre">f</span></code>. Contract <code class="docutils literal notranslate"><span class="pre">E</span></code> is derived from
<code class="docutils literal notranslate"><span class="pre">C</span></code> and, thus, can call <code class="docutils literal notranslate"><span class="pre">compute</span></code>.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC40LjE2IDwwLjkuMDsKCmNvbnRyYWN0IEMgewogICAgdWludCBwcml2YXRlIGRhdGE7CgogICAgZnVuY3Rpb24gZih1aW50IGEpIHByaXZhdGUgcHVyZSByZXR1cm5zKHVpbnQgYikgeyByZXR1cm4gYSArIDE7IH0KICAgIGZ1bmN0aW9uIHNldERhdGEodWludCBhKSBwdWJsaWMgeyBkYXRhID0gYTsgfQogICAgZnVuY3Rpb24gZ2V0RGF0YSgpIHB1YmxpYyB2aWV3IHJldHVybnModWludCkgeyByZXR1cm4gZGF0YTsgfQogICAgZnVuY3Rpb24gY29tcHV0ZSh1aW50IGEsIHVpbnQgYikgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50KSB7IHJldHVybiBhICsgYjsgfQp9CgovLyBUaGlzIHdpbGwgbm90IGNvbXBpbGUKY29udHJhY3QgRCB7CiAgICBmdW5jdGlvbiByZWFkRGF0YSgpIHB1YmxpYyB7CiAgICAgICAgQyBjID0gbmV3IEMoKTsKICAgICAgICB1aW50IGxvY2FsID0gYy5mKDcpOyAvLyBlcnJvcjogbWVtYmVyIGBmYCBpcyBub3QgdmlzaWJsZQogICAgICAgIGMuc2V0RGF0YSgzKTsKICAgICAgICBsb2NhbCA9IGMuZ2V0RGF0YSgpOwogICAgICAgIGxvY2FsID0gYy5jb21wdXRlKDMsIDUpOyAvLyBlcnJvcjogbWVtYmVyIGBjb21wdXRlYCBpcyBub3QgdmlzaWJsZQogICAgfQp9Cgpjb250cmFjdCBFIGlzIEMgewogICAgZnVuY3Rpb24gZygpIHB1YmxpYyB7CiAgICAgICAgQyBjID0gbmV3IEMoKTsKICAgICAgICB1aW50IHZhbCA9IGNvbXB1dGUoMywgNSk7IC8vIGFjY2VzcyB0byBpbnRlcm5hbCBtZW1iZXIgKGZyb20gZGVyaXZlZCB0byBwYXJlbnQgY29udHJhY3QpCiAgICB9Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.4.16</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">C</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="k">private </span><span class="nv">data</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">f</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">a</span><span class="p">)</span><span class="w"> </span><span class="kt">private</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kt">return</span><span class="w"> </span>a<span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">setData</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">a</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>data<span class="w"> </span><span class="o">=</span><span class="w"> </span>a<span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">getData</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kt">return</span><span class="w"> </span>data<span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">compute</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">a</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">b</span><span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kt">return</span><span class="w"> </span>a<span class="w"> </span><span class="o">+</span><span class="w"> </span>b<span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// This will not compile</span>
<span class="k">contract</span><span class="w"> </span><span class="ni">D</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">readData</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>C<span class="w"> </span>c<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span>C<span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="w"> </span><span class="nv">local</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>c<span class="p">.</span>f<span class="p">(</span><span class="m m-Decimal">7</span><span class="p">);</span><span class="w"> </span><span class="c1">// error: member `f` is not visible</span>
<span class="w">        </span>c<span class="p">.</span>setData<span class="p">(</span><span class="m m-Decimal">3</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span>local<span class="w"> </span><span class="o">=</span><span class="w"> </span>c<span class="p">.</span>getData<span class="p">();</span><span class="w"></span>
<span class="w">        </span>local<span class="w"> </span><span class="o">=</span><span class="w"> </span>c<span class="p">.</span>compute<span class="p">(</span><span class="m m-Decimal">3</span><span class="p">,</span><span class="w"> </span><span class="m m-Decimal">5</span><span class="p">);</span><span class="w"> </span><span class="c1">// error: member `compute` is not visible</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">E</span><span class="w"> </span><span class="kt">is</span><span class="w"> </span>C<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">g</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>C<span class="w"> </span>c<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span>C<span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="w"> </span><span class="nv">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>compute<span class="p">(</span><span class="m m-Decimal">3</span><span class="p">,</span><span class="w"> </span><span class="m m-Decimal">5</span><span class="p">);</span><span class="w"> </span><span class="c1">// access to internal member (from derived to parent contract)</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="getter-functions">
<span id="index-4"></span><span id="id3"></span><h4>Getter Functions<a class="headerlink" href="#getter-functions" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>The compiler automatically creates getter functions for
all <strong>public</strong> state variables. For the contract given below, the compiler will
generate a function called <code class="docutils literal notranslate"><span class="pre">data</span></code> that does not take any
arguments and returns a <code class="docutils literal notranslate"><span class="pre">uint</span></code>, the value of the state
variable <code class="docutils literal notranslate"><span class="pre">data</span></code>. State variables can be initialized
when they are declared.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC40LjE2IDwwLjkuMDsKCmNvbnRyYWN0IEMgewogICAgdWludCBwdWJsaWMgZGF0YSA9IDQyOwp9Cgpjb250cmFjdCBDYWxsZXIgewogICAgQyBjID0gbmV3IEMoKTsKICAgIGZ1bmN0aW9uIGYoKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIGMuZGF0YSgpOwogICAgfQp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.4.16</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">C</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="k">public </span><span class="nv">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">42</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Caller</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span>C<span class="w"> </span>c<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span>C<span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">f</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>c<span class="p">.</span>data<span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>The getter functions have external visibility. If the
symbol is accessed internally (i.e. without <code class="docutils literal notranslate"><span class="pre">this.</span></code>),
it evaluates to a state variable.  If it is accessed externally
(i.e. with <code class="docutils literal notranslate"><span class="pre">this.</span></code>), it evaluates to a function.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC40LjAgPDAuOS4wOwoKY29udHJhY3QgQyB7CiAgICB1aW50IHB1YmxpYyBkYXRhOwogICAgZnVuY3Rpb24geCgpIHB1YmxpYyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgZGF0YSA9IDM7IC8vIGludGVybmFsIGFjY2VzcwogICAgICAgIHJldHVybiB0aGlzLmRhdGEoKTsgLy8gZXh0ZXJuYWwgYWNjZXNzCiAgICB9Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.4.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">C</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="k">public </span><span class="nv">data</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">x</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>data<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">3</span><span class="p">;</span><span class="w"> </span><span class="c1">// internal access</span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span><span class="kt">this</span><span class="p">.</span>data<span class="p">();</span><span class="w"> </span><span class="c1">// external access</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>If you have a <code class="docutils literal notranslate"><span class="pre">public</span></code> state variable of array type, then you can only retrieve
single elements of the array via the generated getter function. This mechanism
exists to avoid high gas costs when returning an entire array. You can use
arguments to specify which individual element to return, for example
<code class="docutils literal notranslate"><span class="pre">myArray(0)</span></code>. If you want to return an entire array in one call, then you need
to write a function, for example:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC40LjE2IDwwLjkuMDsKCmNvbnRyYWN0IGFycmF5RXhhbXBsZSB7CiAgICAvLyBwdWJsaWMgc3RhdGUgdmFyaWFibGUKICAgIHVpbnRbXSBwdWJsaWMgbXlBcnJheTsKCiAgICAvLyBHZXR0ZXIgZnVuY3Rpb24gZ2VuZXJhdGVkIGJ5IHRoZSBjb21waWxlcgogICAgLyoKICAgIGZ1bmN0aW9uIG15QXJyYXkodWludCBpKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIG15QXJyYXlbaV07CiAgICB9CiAgICAqLwoKICAgIC8vIGZ1bmN0aW9uIHRoYXQgcmV0dXJucyBlbnRpcmUgYXJyYXkKICAgIGZ1bmN0aW9uIGdldEFycmF5KCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludFtdIG1lbW9yeSkgewogICAgICAgIHJldHVybiBteUFycmF5OwogICAgfQp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.4.16</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">arrayExample</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// public state variable</span>
<span class="w">    </span><span class="kt">uint</span><span class="p">[]</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>myArray<span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Getter function generated by the compiler</span>
<span class="w">    </span><span class="cm">/*</span>
<span class="cm">    function myArray(uint i) public view returns (uint) {</span>
<span class="cm">        return myArray[i];</span>
<span class="cm">    }</span>
<span class="cm">    */</span><span class="w"></span>

<span class="w">    </span><span class="c1">// function that returns entire array</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">getArray</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>myArray<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Now you can use <code class="docutils literal notranslate"><span class="pre">getArray()</span></code> to retrieve the entire array, instead of
<code class="docutils literal notranslate"><span class="pre">myArray(i)</span></code>, which returns a single element per call.</p>
<p>The next example is more complex:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC40LjAgPDAuOS4wOwoKY29udHJhY3QgQ29tcGxleCB7CiAgICBzdHJ1Y3QgRGF0YSB7CiAgICAgICAgdWludCBhOwogICAgICAgIGJ5dGVzMyBiOwogICAgICAgIG1hcHBpbmcgKHVpbnQgPT4gdWludCkgbWFwOwogICAgICAgIHVpbnRbM10gYzsKICAgICAgICB1aW50W10gZDsKICAgICAgICBieXRlcyBlOwogICAgfQogICAgbWFwcGluZyAodWludCA9PiBtYXBwaW5nKGJvb2wgPT4gRGF0YVtdKSkgcHVibGljIGRhdGE7Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.4.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Complex</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">struct</span><span class="w"> </span><span class="nv">Data</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="w"> </span><span class="nv">a</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span>bytes3<span class="w"> </span>b<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">mapping</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span>map<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="p">[</span><span class="m m-Decimal">3</span><span class="p">]</span><span class="w"> </span>c<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="p">[]</span><span class="w"> </span>d<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">bytes</span><span class="w"> </span><span class="nv">e</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="kt">mapping</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span>Data<span class="p">[]))</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>data<span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>It generates a function of the following form. The mapping and arrays (with the
exception of byte arrays) in the struct are omitted because there is no good way
to select individual struct members or provide a key for the mapping:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=ZnVuY3Rpb24gZGF0YSh1aW50IGFyZzEsIGJvb2wgYXJnMiwgdWludCBhcmczKQogICAgcHVibGljCiAgICByZXR1cm5zICh1aW50IGEsIGJ5dGVzMyBiLCBieXRlcyBtZW1vcnkgZSkKewogICAgYSA9IGRhdGFbYXJnMV1bYXJnMl1bYXJnM10uYTsKICAgIGIgPSBkYXRhW2FyZzFdW2FyZzJdW2FyZzNdLmI7CiAgICBlID0gZGF0YVthcmcxXVthcmcyXVthcmczXS5lOwp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">function</span><span class="w"> </span><span class="nv">data</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">arg1</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nv">arg2</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">arg3</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="kt">public</span><span class="w"></span>
<span class="w">    </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">a</span><span class="p">,</span><span class="w"> </span>bytes3<span class="w"> </span>b<span class="p">,</span><span class="w"> </span><span class="kt">bytes</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>e<span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span>a<span class="w"> </span><span class="o">=</span><span class="w"> </span>data<span class="p">[</span>arg1<span class="p">][</span>arg2<span class="p">][</span>arg3<span class="p">].</span>a<span class="p">;</span><span class="w"></span>
<span class="w">    </span>b<span class="w"> </span><span class="o">=</span><span class="w"> </span>data<span class="p">[</span>arg1<span class="p">][</span>arg2<span class="p">][</span>arg3<span class="p">].</span>b<span class="p">;</span><span class="w"></span>
<span class="w">    </span>e<span class="w"> </span><span class="o">=</span><span class="w"> </span>data<span class="p">[</span>arg1<span class="p">][</span>arg2<span class="p">][</span>arg3<span class="p">].</span>e<span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
<section id="function-modifiers">
<span id="modifiers"></span><span id="index-5"></span><h3>Function Modifiers<a class="headerlink" href="#function-modifiers" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Modifiers can be used to change the behaviour of functions in a declarative way.
For example,
you can use a modifier to automatically check a condition prior to executing the function.</p>
<p>Modifiers are
inheritable properties of contracts and may be overridden by derived contracts, but only
if they are marked <code class="docutils literal notranslate"><span class="pre">virtual</span></code>. For details, please see
<a class="reference internal" href="#modifier-overriding"><span class="std std-ref">Modifier Overriding</span></a>.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC43LjEgPDAuOS4wOwoKY29udHJhY3Qgb3duZWQgewogICAgY29uc3RydWN0b3IoKSB7IG93bmVyID0gcGF5YWJsZShtc2cuc2VuZGVyKTsgfQogICAgYWRkcmVzcyBwYXlhYmxlIG93bmVyOwoKICAgIC8vIFRoaXMgY29udHJhY3Qgb25seSBkZWZpbmVzIGEgbW9kaWZpZXIgYnV0IGRvZXMgbm90IHVzZQogICAgLy8gaXQ6IGl0IHdpbGwgYmUgdXNlZCBpbiBkZXJpdmVkIGNvbnRyYWN0cy4KICAgIC8vIFRoZSBmdW5jdGlvbiBib2R5IGlzIGluc2VydGVkIHdoZXJlIHRoZSBzcGVjaWFsIHN5bWJvbAogICAgLy8gYF87YCBpbiB0aGUgZGVmaW5pdGlvbiBvZiBhIG1vZGlmaWVyIGFwcGVhcnMuCiAgICAvLyBUaGlzIG1lYW5zIHRoYXQgaWYgdGhlIG93bmVyIGNhbGxzIHRoaXMgZnVuY3Rpb24sIHRoZQogICAgLy8gZnVuY3Rpb24gaXMgZXhlY3V0ZWQgYW5kIG90aGVyd2lzZSwgYW4gZXhjZXB0aW9uIGlzCiAgICAvLyB0aHJvd24uCiAgICBtb2RpZmllciBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUoCiAgICAgICAgICAgIG1zZy5zZW5kZXIgPT0gb3duZXIsCiAgICAgICAgICAgICJPbmx5IG93bmVyIGNhbiBjYWxsIHRoaXMgZnVuY3Rpb24uIgogICAgICAgICk7CiAgICAgICAgXzsKICAgIH0KfQoKY29udHJhY3QgZGVzdHJ1Y3RpYmxlIGlzIG93bmVkIHsKICAgIC8vIFRoaXMgY29udHJhY3QgaW5oZXJpdHMgdGhlIGBvbmx5T3duZXJgIG1vZGlmaWVyIGZyb20KICAgIC8vIGBvd25lZGAgYW5kIGFwcGxpZXMgaXQgdG8gdGhlIGBkZXN0cm95YCBmdW5jdGlvbiwgd2hpY2gKICAgIC8vIGNhdXNlcyB0aGF0IGNhbGxzIHRvIGBkZXN0cm95YCBvbmx5IGhhdmUgYW4gZWZmZWN0IGlmCiAgICAvLyB0aGV5IGFyZSBtYWRlIGJ5IHRoZSBzdG9yZWQgb3duZXIuCiAgICBmdW5jdGlvbiBkZXN0cm95KCkgcHVibGljIG9ubHlPd25lciB7CiAgICAgICAgc2VsZmRlc3RydWN0KG93bmVyKTsKICAgIH0KfQoKY29udHJhY3QgcHJpY2VkIHsKICAgIC8vIE1vZGlmaWVycyBjYW4gcmVjZWl2ZSBhcmd1bWVudHM6CiAgICBtb2RpZmllciBjb3N0cyh1aW50IHByaWNlKSB7CiAgICAgICAgaWYgKG1zZy52YWx1ZSA+PSBwcmljZSkgewogICAgICAgICAgICBfOwogICAgICAgIH0KICAgIH0KfQoKY29udHJhY3QgUmVnaXN0ZXIgaXMgcHJpY2VkLCBkZXN0cnVjdGlibGUgewogICAgbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSByZWdpc3RlcmVkQWRkcmVzc2VzOwogICAgdWludCBwcmljZTsKCiAgICBjb25zdHJ1Y3Rvcih1aW50IGluaXRpYWxQcmljZSkgeyBwcmljZSA9IGluaXRpYWxQcmljZTsgfQoKICAgIC8vIEl0IGlzIGltcG9ydGFudCB0byBhbHNvIHByb3ZpZGUgdGhlCiAgICAvLyBgcGF5YWJsZWAga2V5d29yZCBoZXJlLCBvdGhlcndpc2UgdGhlIGZ1bmN0aW9uIHdpbGwKICAgIC8vIGF1dG9tYXRpY2FsbHkgcmVqZWN0IGFsbCBFdGhlciBzZW50IHRvIGl0LgogICAgZnVuY3Rpb24gcmVnaXN0ZXIoKSBwdWJsaWMgcGF5YWJsZSBjb3N0cyhwcmljZSkgewogICAgICAgIHJlZ2lzdGVyZWRBZGRyZXNzZXNbbXNnLnNlbmRlcl0gPSB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGNoYW5nZVByaWNlKHVpbnQgcHJpY2VfKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBwcmljZSA9IHByaWNlXzsKICAgIH0KfQoKY29udHJhY3QgTXV0ZXggewogICAgYm9vbCBsb2NrZWQ7CiAgICBtb2RpZmllciBub1JlZW50cmFuY3koKSB7CiAgICAgICAgcmVxdWlyZSgKICAgICAgICAgICAgIWxvY2tlZCwKICAgICAgICAgICAgIlJlZW50cmFudCBjYWxsLiIKICAgICAgICApOwogICAgICAgIGxvY2tlZCA9IHRydWU7CiAgICAgICAgXzsKICAgICAgICBsb2NrZWQgPSBmYWxzZTsKICAgIH0KCiAgICAvLy8gVGhpcyBmdW5jdGlvbiBpcyBwcm90ZWN0ZWQgYnkgYSBtdXRleCwgd2hpY2ggbWVhbnMgdGhhdAogICAgLy8vIHJlZW50cmFudCBjYWxscyBmcm9tIHdpdGhpbiBgbXNnLnNlbmRlci5jYWxsYCBjYW5ub3QgY2FsbCBgZmAgYWdhaW4uCiAgICAvLy8gVGhlIGByZXR1cm4gN2Agc3RhdGVtZW50IGFzc2lnbnMgNyB0byB0aGUgcmV0dXJuIHZhbHVlIGJ1dCBzdGlsbAogICAgLy8vIGV4ZWN1dGVzIHRoZSBzdGF0ZW1lbnQgYGxvY2tlZCA9IGZhbHNlYCBpbiB0aGUgbW9kaWZpZXIuCiAgICBmdW5jdGlvbiBmKCkgcHVibGljIG5vUmVlbnRyYW5jeSByZXR1cm5zICh1aW50KSB7CiAgICAgICAgKGJvb2wgc3VjY2VzcywpID0gbXNnLnNlbmRlci5jYWxsKCIiKTsKICAgICAgICByZXF1aXJlKHN1Y2Nlc3MpOwogICAgICAgIHJldHVybiA3OwogICAgfQp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.7.1</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">owned</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>owner<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">payable</span><span class="p">(</span><span class="k">msg.sender</span><span class="p">);</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">payable</span><span class="w"> </span>owner<span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// This contract only defines a modifier but does not use</span>
<span class="w">    </span><span class="c1">// it: it will be used in derived contracts.</span>
<span class="w">    </span><span class="c1">// The function body is inserted where the special symbol</span>
<span class="w">    </span><span class="c1">// `_;` in the definition of a modifier appears.</span>
<span class="w">    </span><span class="c1">// This means that if the owner calls this function, the</span>
<span class="w">    </span><span class="c1">// function is executed and otherwise, an exception is</span>
<span class="w">    </span><span class="c1">// thrown.</span>
<span class="w">    </span><span class="kt">modifier</span><span class="w"> </span>onlyOwner<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span><span class="w"></span>
<span class="w">            </span><span class="k">msg.sender</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>owner<span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="s2">&quot;Only owner can call this function.&quot;</span><span class="w"></span>
<span class="w">        </span><span class="p">);</span><span class="w"></span>
<span class="w">        </span>_<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">destructible</span><span class="w"> </span><span class="kt">is</span><span class="w"> </span>owned<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// This contract inherits the `onlyOwner` modifier from</span>
<span class="w">    </span><span class="c1">// `owned` and applies it to the `destroy` function, which</span>
<span class="w">    </span><span class="c1">// causes that calls to `destroy` only have an effect if</span>
<span class="w">    </span><span class="c1">// they are made by the stored owner.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">destroy</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>onlyOwner<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>selfdestruct<span class="p">(</span>owner<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">priced</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Modifiers can receive arguments:</span>
<span class="w">    </span><span class="kt">modifier</span><span class="w"> </span>costs<span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">price</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span><span class="k">msg.value</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span>price<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span>_<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Register</span><span class="w"> </span><span class="kt">is</span><span class="w"> </span>priced<span class="p">,</span><span class="w"> </span>destructible<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">mapping</span><span class="w"> </span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span>registeredAddresses<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="nv">price</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kt">constructor</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">initialPrice</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>price<span class="w"> </span><span class="o">=</span><span class="w"> </span>initialPrice<span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">// It is important to also provide the</span>
<span class="w">    </span><span class="c1">// `payable` keyword here, otherwise the function will</span>
<span class="w">    </span><span class="c1">// automatically reject all Ether sent to it.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">register</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span>costs<span class="p">(</span>price<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>registeredAddresses<span class="p">[</span><span class="k">msg.sender</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">changePrice</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">price_</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>onlyOwner<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>price<span class="w"> </span><span class="o">=</span><span class="w"> </span>price_<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Mutex</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="nv">locked</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">modifier</span><span class="w"> </span>noReentrancy<span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span><span class="w"></span>
<span class="w">            </span><span class="o">!</span>locked<span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="s2">&quot;Reentrant call.&quot;</span><span class="w"></span>
<span class="w">        </span><span class="p">);</span><span class="w"></span>
<span class="w">        </span>locked<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span>_<span class="p">;</span><span class="w"></span>
<span class="w">        </span>locked<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">false</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// This function is protected by a mutex, which means that</span>
<span class="w">    </span><span class="c1">/// reentrant calls from within `msg.sender.call` cannot call `f` again.</span>
<span class="w">    </span><span class="c1">/// The `return 7` statement assigns 7 to the return value but still</span>
<span class="w">    </span><span class="c1">/// executes the statement `locked = false` in the modifier.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">f</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>noReentrancy<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="nv">success</span><span class="p">,)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">msg.sender</span><span class="p">.</span>call<span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>success<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span><span class="m m-Decimal">7</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>If you want to access a modifier <code class="docutils literal notranslate"><span class="pre">m</span></code> defined in a contract <code class="docutils literal notranslate"><span class="pre">C</span></code>, you can use <code class="docutils literal notranslate"><span class="pre">C.m</span></code> to
reference it without virtual lookup. It is only possible to use modifiers defined in the current
contract or its base contracts. Modifiers can also be defined in libraries but their use is
limited to functions of the same library.</p>
<p>Multiple modifiers are applied to a function by specifying them in a
whitespace-separated list and are evaluated in the order presented.</p>
<p>Modifiers cannot implicitly access or change the arguments and return values of functions they modify.
Their values can only be passed to them explicitly at the point of invocation.</p>
<p>Explicit returns from a modifier or function body only leave the current
modifier or function body. Return variables are assigned and
control flow continues after the <code class="docutils literal notranslate"><span class="pre">_</span></code> in the preceding modifier.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>In an earlier version of Solidity, <code class="docutils literal notranslate"><span class="pre">return</span></code> statements in functions
having modifiers behaved differently.</p>
</div>
<p>An explicit return from a modifier with <code class="docutils literal notranslate"><span class="pre">return;</span></code> does not affect the values returned by the function.
The modifier can, however, choose not to execute the function body at all and in that case the return
variables are set to their <a class="reference internal" href="index.html#default-value"><span class="std std-ref">default values</span></a> just as if the function had an empty
body.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">_</span></code> symbol can appear in the modifier multiple times. Each occurrence is replaced with
the function body.</p>
<p>Arbitrary expressions are allowed for modifier arguments and in this context,
all symbols visible from the function are visible in the modifier. Symbols
introduced in the modifier are not visible in the function (as they might
change by overriding).</p>
</section>
<section id="constant-and-immutable-state-variables">
<span id="constants"></span><span id="index-6"></span><h3>Constant and Immutable State Variables<a class="headerlink" href="#constant-and-immutable-state-variables" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>State variables can be declared as <code class="docutils literal notranslate"><span class="pre">constant</span></code> or <code class="docutils literal notranslate"><span class="pre">immutable</span></code>.
In both cases, the variables cannot be modified after the contract has been constructed.
For <code class="docutils literal notranslate"><span class="pre">constant</span></code> variables, the value has to be fixed at compile-time, while
for <code class="docutils literal notranslate"><span class="pre">immutable</span></code>, it can still be assigned at construction time.</p>
<p>It is also possible to define <code class="docutils literal notranslate"><span class="pre">constant</span></code> variables at the file level.</p>
<p>The compiler does not reserve a storage slot for these variables, and every occurrence is
replaced by the respective value.</p>
<p>Compared to regular state variables, the gas costs of constant and immutable variables
are much lower. For a constant variable, the expression assigned to it is copied to
all the places where it is accessed and also re-evaluated each time. This allows for local
optimizations. Immutable variables are evaluated once at construction time and their value
is copied to all the places in the code where they are accessed. For these values,
32 bytes are reserved, even if they would fit in fewer bytes. Due to this, constant values
can sometimes be cheaper than immutable values.</p>
<p>Not all types for constants and immutables are implemented at this time. The only supported types are
<a class="reference internal" href="index.html#strings"><span class="std std-ref">strings</span></a> (only for constants) and <a class="reference internal" href="index.html#value-types"><span class="std std-ref">value types</span></a>.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC43LjQ7Cgp1aW50IGNvbnN0YW50IFggPSAzMioqMjIgKyA4OwoKY29udHJhY3QgQyB7CiAgICBzdHJpbmcgY29uc3RhbnQgVEVYVCA9ICJhYmMiOwogICAgYnl0ZXMzMiBjb25zdGFudCBNWV9IQVNIID0ga2VjY2FrMjU2KCJhYmMiKTsKICAgIHVpbnQgaW1tdXRhYmxlIGRlY2ltYWxzOwogICAgdWludCBpbW11dGFibGUgbWF4QmFsYW5jZTsKICAgIGFkZHJlc3MgaW1tdXRhYmxlIG93bmVyID0gbXNnLnNlbmRlcjsKCiAgICBjb25zdHJ1Y3Rvcih1aW50IGRlY2ltYWxzXywgYWRkcmVzcyByZWYpIHsKICAgICAgICBkZWNpbWFscyA9IGRlY2ltYWxzXzsKICAgICAgICAvLyBBc3NpZ25tZW50cyB0byBpbW11dGFibGVzIGNhbiBldmVuIGFjY2VzcyB0aGUgZW52aXJvbm1lbnQuCiAgICAgICAgbWF4QmFsYW5jZSA9IHJlZi5iYWxhbmNlOwogICAgfQoKICAgIGZ1bmN0aW9uIGlzQmFsYW5jZVRvb0hpZ2goYWRkcmVzcyBvdGhlcikgcHVibGljIHZpZXcgcmV0dXJucyAoYm9vbCkgewogICAgICAgIHJldHVybiBvdGhlci5iYWxhbmNlID4gbWF4QmFsYW5jZTsKICAgIH0KfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.7.4</span><span class="p">;</span><span class="w"></span>

<span class="kt">uint</span><span class="w"> </span><span class="nv">constant</span><span class="w"> </span>X<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">32</span><span class="o">**</span><span class="m m-Decimal">22</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m m-Decimal">8</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">C</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">string</span><span class="w"> </span><span class="nv">constant</span><span class="w"> </span>TEXT<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;abc&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">constant</span><span class="w"> </span>MY_HASH<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">keccak256</span><span class="p">(</span><span class="s2">&quot;abc&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="nv">immutable</span><span class="w"> </span>decimals<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="nv">immutable</span><span class="w"> </span>maxBalance<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">immutable</span><span class="w"> </span>owner<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">msg.sender</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kt">constructor</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">decimals_</span><span class="p">,</span><span class="w"> </span><span class="kt">address</span><span class="w"> </span><span class="nv">ref</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>decimals<span class="w"> </span><span class="o">=</span><span class="w"> </span>decimals_<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Assignments to immutables can even access the environment.</span>
<span class="w">        </span>maxBalance<span class="w"> </span><span class="o">=</span><span class="w"> </span>ref<span class="p">.</span>balance<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">isBalanceTooHigh</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">other</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>other<span class="p">.</span>balance<span class="w"> </span><span class="o">&gt;</span><span class="w"> </span>maxBalance<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<section id="constant">
<h4>Constant<a class="headerlink" href="#constant" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>For <code class="docutils literal notranslate"><span class="pre">constant</span></code> variables, the value has to be a constant at compile time and it has to be
assigned where the variable is declared. Any expression
that accesses storage, blockchain data (e.g. <code class="docutils literal notranslate"><span class="pre">block.timestamp</span></code>, <code class="docutils literal notranslate"><span class="pre">address(this).balance</span></code> or
<code class="docutils literal notranslate"><span class="pre">block.number</span></code>) or
execution data (<code class="docutils literal notranslate"><span class="pre">msg.value</span></code> or <code class="docutils literal notranslate"><span class="pre">gasleft()</span></code>) or makes calls to external contracts is disallowed. Expressions
that might have a side-effect on memory allocation are allowed, but those that
might have a side-effect on other memory objects are not. The built-in functions
<code class="docutils literal notranslate"><span class="pre">keccak256</span></code>, <code class="docutils literal notranslate"><span class="pre">sha256</span></code>, <code class="docutils literal notranslate"><span class="pre">ripemd160</span></code>, <code class="docutils literal notranslate"><span class="pre">ecrecover</span></code>, <code class="docutils literal notranslate"><span class="pre">addmod</span></code> and <code class="docutils literal notranslate"><span class="pre">mulmod</span></code>
are allowed (even though, with the exception of <code class="docutils literal notranslate"><span class="pre">keccak256</span></code>, they do call external contracts).</p>
<p>The reason behind allowing side-effects on the memory allocator is that it
should be possible to construct complex objects like e.g. lookup-tables.
This feature is not yet fully usable.</p>
</section>
<section id="immutable">
<h4>Immutable<a class="headerlink" href="#immutable" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Variables declared as <code class="docutils literal notranslate"><span class="pre">immutable</span></code> are a bit less restricted than those
declared as <code class="docutils literal notranslate"><span class="pre">constant</span></code>: Immutable variables can be assigned an arbitrary
value in the constructor of the contract or at the point of their declaration.
They can be assigned only once and can, from that point on, be read even during
construction time.</p>
<p>The contract creation code generated by the compiler will modify the
contract‚Äôs runtime code before it is returned by replacing all references
to immutables by the values assigned to the them. This is important if
you are comparing the
runtime code generated by the compiler with the one actually stored in the
blockchain.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Immutables that are assigned at their declaration are only considered
initialized once the constructor of the contract is executing.
This means you cannot initialize immutables inline with a value
that depends on another immutable. You can do this, however,
inside the constructor of the contract.</p>
<p>This is a safeguard against different interpretations about the order
of state variable initialization and constructor execution, especially
with regards to inheritance.</p>
</div>
</section>
</section>
<section id="functions">
<span id="index-7"></span><span id="id4"></span><h3>Functions<a class="headerlink" href="#functions" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Functions can be defined inside and outside of contracts.</p>
<p>Functions outside of a contract, also called ‚Äúfree functions‚Äù, always have implicit <code class="docutils literal notranslate"><span class="pre">internal</span></code>
<a class="reference internal" href="#visibility-and-getters"><span class="std std-ref">visibility</span></a>. Their code is included in all contracts
that call them, similar to internal library functions.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC43LjEgPDAuOS4wOwoKZnVuY3Rpb24gc3VtKHVpbnRbXSBtZW1vcnkgYXJyKSBwdXJlIHJldHVybnMgKHVpbnQgcykgewogICAgZm9yICh1aW50IGkgPSAwOyBpIDwgYXJyLmxlbmd0aDsgaSsrKQogICAgICAgIHMgKz0gYXJyW2ldOwp9Cgpjb250cmFjdCBBcnJheUV4YW1wbGUgewogICAgYm9vbCBmb3VuZDsKICAgIGZ1bmN0aW9uIGYodWludFtdIG1lbW9yeSBhcnIpIHB1YmxpYyB7CiAgICAgICAgLy8gVGhpcyBjYWxscyB0aGUgZnJlZSBmdW5jdGlvbiBpbnRlcm5hbGx5LgogICAgICAgIC8vIFRoZSBjb21waWxlciB3aWxsIGFkZCBpdHMgY29kZSB0byB0aGUgY29udHJhY3QuCiAgICAgICAgdWludCBzID0gc3VtKGFycik7CiAgICAgICAgcmVxdWlyZShzID49IDEwKTsKICAgICAgICBmb3VuZCA9IHRydWU7CiAgICB9Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.7.1</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="kt">function</span><span class="w"> </span><span class="nv">sum</span><span class="p">(</span><span class="kt">uint</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>arr<span class="p">)</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">s</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">for</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span><span class="w"> </span>i<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>arr<span class="p">.</span>length<span class="p">;</span><span class="w"> </span>i<span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span>s<span class="w"> </span><span class="o">+=</span><span class="w"> </span>arr<span class="p">[</span>i<span class="p">];</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">ArrayExample</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="nv">found</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">f</span><span class="p">(</span><span class="kt">uint</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>arr<span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// This calls the free function internally.</span>
<span class="w">        </span><span class="c1">// The compiler will add its code to the contract.</span>
<span class="w">        </span><span class="kt">uint</span><span class="w"> </span><span class="nv">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>sum<span class="p">(</span>arr<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>s<span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="m m-Decimal">10</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span>found<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Functions defined outside a contract are still always executed
in the context of a contract. They still have access to the variable <code class="docutils literal notranslate"><span class="pre">this</span></code>,
can call other contracts, send them Ether and destroy the contract that called them,
among other things. The main difference to functions defined inside a contract
is that free functions do not have direct access to storage variables and functions
not in their scope.</p>
</div>
<section id="function-parameters-and-return-variables">
<span id="function-parameters-return-variables"></span><h4>Function Parameters and Return Variables<a class="headerlink" href="#function-parameters-and-return-variables" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Functions take typed parameters as input and may, unlike in many other
languages, also return an arbitrary number of values as output.</p>
<section id="function-parameters">
<h5>Function Parameters<a class="headerlink" href="#function-parameters" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>Function parameters are declared the same way as variables, and the name of
unused parameters can be omitted.</p>
<p>For example, if you want your contract to accept one kind of external call
with two integers, you would use something like the following:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC40LjE2IDwwLjkuMDsKCmNvbnRyYWN0IFNpbXBsZSB7CiAgICB1aW50IHN1bTsKICAgIGZ1bmN0aW9uIHRha2VyKHVpbnQgYSwgdWludCBiKSBwdWJsaWMgewogICAgICAgIHN1bSA9IGEgKyBiOwogICAgfQp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.4.16</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Simple</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="nv">sum</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">taker</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">a</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">b</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>sum<span class="w"> </span><span class="o">=</span><span class="w"> </span>a<span class="w"> </span><span class="o">+</span><span class="w"> </span>b<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Function parameters can be used as any other local variable and they can also be assigned to.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>An <a class="reference internal" href="index.html#external-function-calls"><span class="std std-ref">external function</span></a> cannot accept a
multi-dimensional array as an input
parameter. This functionality is possible if you enable the ABI coder v2
by adding <code class="docutils literal notranslate"><span class="pre">pragma</span> <span class="pre">abicoder</span> <span class="pre">v2;</span></code> to your source file.</p>
<p>An <a class="reference internal" href="index.html#external-function-calls"><span class="std std-ref">internal function</span></a> can accept a
multi-dimensional array without enabling the feature.</p>
</div>
</section>
<section id="return-variables">
<span id="index-8"></span><h5>Return Variables<a class="headerlink" href="#return-variables" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>Function return variables are declared with the same syntax after the
<code class="docutils literal notranslate"><span class="pre">returns</span></code> keyword.</p>
<p>For example, suppose you want to return two results: the sum and the product of
two integers passed as function parameters, then you use something like:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC40LjE2IDwwLjkuMDsKCmNvbnRyYWN0IFNpbXBsZSB7CiAgICBmdW5jdGlvbiBhcml0aG1ldGljKHVpbnQgYSwgdWludCBiKQogICAgICAgIHB1YmxpYwogICAgICAgIHB1cmUKICAgICAgICByZXR1cm5zICh1aW50IHN1bSwgdWludCBwcm9kdWN0KQogICAgewogICAgICAgIHN1bSA9IGEgKyBiOwogICAgICAgIHByb2R1Y3QgPSBhICogYjsKICAgIH0KfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.4.16</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Simple</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">arithmetic</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">a</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">b</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="kt">public</span><span class="w"></span>
<span class="w">        </span>pure<span class="w"></span>
<span class="w">        </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">sum</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">product</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>sum<span class="w"> </span><span class="o">=</span><span class="w"> </span>a<span class="w"> </span><span class="o">+</span><span class="w"> </span>b<span class="p">;</span><span class="w"></span>
<span class="w">        </span>product<span class="w"> </span><span class="o">=</span><span class="w"> </span>a<span class="w"> </span><span class="o">*</span><span class="w"> </span>b<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>The names of return variables can be omitted.
Return variables can be used as any other local variable and they
are initialized with their <a class="reference internal" href="index.html#default-value"><span class="std std-ref">default value</span></a> and have that
value until they are (re-)assigned.</p>
<p>You can either explicitly assign to return variables and
then leave the function as above,
or you can provide return values
(either a single or <a class="reference internal" href="#multi-return"><span class="std std-ref">multiple ones</span></a>) directly with the <code class="docutils literal notranslate"><span class="pre">return</span></code>
statement:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC40LjE2IDwwLjkuMDsKCmNvbnRyYWN0IFNpbXBsZSB7CiAgICBmdW5jdGlvbiBhcml0aG1ldGljKHVpbnQgYSwgdWludCBiKQogICAgICAgIHB1YmxpYwogICAgICAgIHB1cmUKICAgICAgICByZXR1cm5zICh1aW50IHN1bSwgdWludCBwcm9kdWN0KQogICAgewogICAgICAgIHJldHVybiAoYSArIGIsIGEgKiBiKTsKICAgIH0KfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.4.16</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Simple</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">arithmetic</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">a</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">b</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="kt">public</span><span class="w"></span>
<span class="w">        </span>pure<span class="w"></span>
<span class="w">        </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">sum</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">product</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span><span class="p">(</span>a<span class="w"> </span><span class="o">+</span><span class="w"> </span>b<span class="p">,</span><span class="w"> </span>a<span class="w"> </span><span class="o">*</span><span class="w"> </span>b<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>If you use an early <code class="docutils literal notranslate"><span class="pre">return</span></code> to leave a function that has return variables,
you must provide return values together with the return statement.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You cannot return some types from non-internal functions, notably
multi-dimensional dynamic arrays and structs. If you enable the
ABI coder v2 by adding <code class="docutils literal notranslate"><span class="pre">pragma</span> <span class="pre">abicoder</span> <span class="pre">v2;</span></code>
to your source file then more types are available, but
<code class="docutils literal notranslate"><span class="pre">mapping</span></code> types are still limited to inside a single contract and you
cannot transfer them.</p>
</div>
</section>
<section id="returning-multiple-values">
<span id="multi-return"></span><h5>Returning Multiple Values<a class="headerlink" href="#returning-multiple-values" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>When a function has multiple return types, the statement <code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">(v0,</span> <span class="pre">v1,</span> <span class="pre">...,</span> <span class="pre">vn)</span></code> can be used to return multiple values.
The number of components must be the same as the number of return variables
and their types have to match, potentially after an <a class="reference internal" href="index.html#types-conversion-elementary-types"><span class="std std-ref">implicit conversion</span></a>.</p>
</section>
</section>
<section id="state-mutability">
<span id="id5"></span><h4>State Mutability<a class="headerlink" href="#state-mutability" title="Permalink to this heading">ÔÉÅ</a></h4>
<section id="view-functions">
<span id="index-9"></span><span id="id6"></span><h5>View Functions<a class="headerlink" href="#view-functions" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>Functions can be declared <code class="docutils literal notranslate"><span class="pre">view</span></code> in which case they promise not to modify the state.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the compiler‚Äôs EVM target is Byzantium or newer (default) the opcode
<code class="docutils literal notranslate"><span class="pre">STATICCALL</span></code> is used when <code class="docutils literal notranslate"><span class="pre">view</span></code> functions are called, which enforces the state
to stay unmodified as part of the EVM execution. For library <code class="docutils literal notranslate"><span class="pre">view</span></code> functions
<code class="docutils literal notranslate"><span class="pre">DELEGATECALL</span></code> is used, because there is no combined <code class="docutils literal notranslate"><span class="pre">DELEGATECALL</span></code> and <code class="docutils literal notranslate"><span class="pre">STATICCALL</span></code>.
This means library <code class="docutils literal notranslate"><span class="pre">view</span></code> functions do not have run-time checks that prevent state
modifications. This should not impact security negatively because library code is
usually known at compile-time and the static checker performs compile-time checks.</p>
</div>
<p>The following statements are considered modifying the state:</p>
<ol class="arabic simple">
<li><p>Writing to state variables.</p></li>
<li><p><a class="reference internal" href="#events"><span class="std std-ref">Emitting events</span></a>.</p></li>
<li><p><a class="reference internal" href="index.html#creating-contracts"><span class="std std-ref">Creating other contracts</span></a>.</p></li>
<li><p>Using <code class="docutils literal notranslate"><span class="pre">selfdestruct</span></code>.</p></li>
<li><p>Sending Ether via calls.</p></li>
<li><p>Calling any function not marked <code class="docutils literal notranslate"><span class="pre">view</span></code> or <code class="docutils literal notranslate"><span class="pre">pure</span></code>.</p></li>
<li><p>Using low-level calls.</p></li>
<li><p>Using inline assembly that contains certain opcodes.</p></li>
</ol>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC41LjAgPDAuOS4wOwoKY29udHJhY3QgQyB7CiAgICBmdW5jdGlvbiBmKHVpbnQgYSwgdWludCBiKSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIGEgKiAoYiArIDQyKSArIGJsb2NrLnRpbWVzdGFtcDsKICAgIH0KfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.5.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">C</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">f</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">a</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">b</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>a<span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span>b<span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m m-Decimal">42</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">block.timestamp</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">constant</span></code> on functions used to be an alias to <code class="docutils literal notranslate"><span class="pre">view</span></code>, but this was dropped in version 0.5.0.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Getter methods are automatically marked <code class="docutils literal notranslate"><span class="pre">view</span></code>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Prior to version 0.5.0, the compiler did not use the <code class="docutils literal notranslate"><span class="pre">STATICCALL</span></code> opcode
for <code class="docutils literal notranslate"><span class="pre">view</span></code> functions.
This enabled state modifications in <code class="docutils literal notranslate"><span class="pre">view</span></code> functions through the use of
invalid explicit type conversions.
By using  <code class="docutils literal notranslate"><span class="pre">STATICCALL</span></code> for <code class="docutils literal notranslate"><span class="pre">view</span></code> functions, modifications to the
state are prevented on the level of the EVM.</p>
</div>
</section>
<section id="pure-functions">
<span id="index-10"></span><span id="id7"></span><h5>Pure Functions<a class="headerlink" href="#pure-functions" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>Functions can be declared <code class="docutils literal notranslate"><span class="pre">pure</span></code> in which case they promise not to read from or modify the state.
In particular, it should be possible to evaluate a <code class="docutils literal notranslate"><span class="pre">pure</span></code> function at compile-time given
only its inputs and <code class="docutils literal notranslate"><span class="pre">msg.data</span></code>, but without any knowledge of the current blockchain state.
This means that reading from <code class="docutils literal notranslate"><span class="pre">immutable</span></code> variables can be a non-pure operation.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the compiler‚Äôs EVM target is Byzantium or newer (default) the opcode <code class="docutils literal notranslate"><span class="pre">STATICCALL</span></code> is used,
which does not guarantee that the state is not read, but at least that it is not modified.</p>
</div>
<p>In addition to the list of state modifying statements explained above, the following are considered reading from the state:</p>
<ol class="arabic simple">
<li><p>Reading from state variables.</p></li>
<li><p>Accessing <code class="docutils literal notranslate"><span class="pre">address(this).balance</span></code> or <code class="docutils literal notranslate"><span class="pre">&lt;address&gt;.balance</span></code>.</p></li>
<li><p>Accessing any of the members of <code class="docutils literal notranslate"><span class="pre">block</span></code>, <code class="docutils literal notranslate"><span class="pre">tx</span></code>, <code class="docutils literal notranslate"><span class="pre">msg</span></code> (with the exception of <code class="docutils literal notranslate"><span class="pre">msg.sig</span></code> and <code class="docutils literal notranslate"><span class="pre">msg.data</span></code>).</p></li>
<li><p>Calling any function not marked <code class="docutils literal notranslate"><span class="pre">pure</span></code>.</p></li>
<li><p>Using inline assembly that contains certain opcodes.</p></li>
</ol>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC41LjAgPDAuOS4wOwoKY29udHJhY3QgQyB7CiAgICBmdW5jdGlvbiBmKHVpbnQgYSwgdWludCBiKSBwdWJsaWMgcHVyZSByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIGEgKiAoYiArIDQyKTsKICAgIH0KfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.5.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">C</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">f</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">a</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">b</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>a<span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span>b<span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m m-Decimal">42</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Pure functions are able to use the <code class="docutils literal notranslate"><span class="pre">revert()</span></code> and <code class="docutils literal notranslate"><span class="pre">require()</span></code> functions to revert
potential state changes when an <a class="reference internal" href="index.html#assert-and-require"><span class="std std-ref">error occurs</span></a>.</p>
<p>Reverting a state change is not considered a ‚Äústate modification‚Äù, as only changes to the
state made previously in code that did not have the <code class="docutils literal notranslate"><span class="pre">view</span></code> or <code class="docutils literal notranslate"><span class="pre">pure</span></code> restriction
are reverted and that code has the option to catch the <code class="docutils literal notranslate"><span class="pre">revert</span></code> and not pass it on.</p>
<p>This behaviour is also in line with the <code class="docutils literal notranslate"><span class="pre">STATICCALL</span></code> opcode.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>It is not possible to prevent functions from reading the state at the level
of the EVM, it is only possible to prevent them from writing to the state
(i.e. only <code class="docutils literal notranslate"><span class="pre">view</span></code> can be enforced at the EVM level, <code class="docutils literal notranslate"><span class="pre">pure</span></code> can not).</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Prior to version 0.5.0, the compiler did not use the <code class="docutils literal notranslate"><span class="pre">STATICCALL</span></code> opcode
for <code class="docutils literal notranslate"><span class="pre">pure</span></code> functions.
This enabled state modifications in <code class="docutils literal notranslate"><span class="pre">pure</span></code> functions through the use of
invalid explicit type conversions.
By using  <code class="docutils literal notranslate"><span class="pre">STATICCALL</span></code> for <code class="docutils literal notranslate"><span class="pre">pure</span></code> functions, modifications to the
state are prevented on the level of the EVM.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Prior to version 0.4.17 the compiler did not enforce that <code class="docutils literal notranslate"><span class="pre">pure</span></code> is not reading the state.
It is a compile-time type check, which can be circumvented doing invalid explicit conversions
between contract types, because the compiler can verify that the type of the contract does
not do state-changing operations, but it cannot check that the contract that will be called
at runtime is actually of that type.</p>
</div>
</section>
</section>
<section id="special-functions">
<span id="id8"></span><h4>Special Functions<a class="headerlink" href="#special-functions" title="Permalink to this heading">ÔÉÅ</a></h4>
<section id="receive-ether-function">
<span id="index-11"></span><span id="id9"></span><h5>Receive Ether Function<a class="headerlink" href="#receive-ether-function" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>A contract can have at most one <code class="docutils literal notranslate"><span class="pre">receive</span></code> function, declared using
<code class="docutils literal notranslate"><span class="pre">receive()</span> <span class="pre">external</span> <span class="pre">payable</span> <span class="pre">{</span> <span class="pre">...</span> <span class="pre">}</span></code>
(without the <code class="docutils literal notranslate"><span class="pre">function</span></code> keyword).
This function cannot have arguments, cannot return anything and must have
<code class="docutils literal notranslate"><span class="pre">external</span></code> visibility and <code class="docutils literal notranslate"><span class="pre">payable</span></code> state mutability.
It can be virtual, can override and can have modifiers.</p>
<p>The receive function is executed on a
call to the contract with empty calldata. This is the function that is executed
on plain Ether transfers (e.g. via <code class="docutils literal notranslate"><span class="pre">.send()</span></code> or <code class="docutils literal notranslate"><span class="pre">.transfer()</span></code>). If no such
function exists, but a payable <a class="reference internal" href="#fallback-function"><span class="std std-ref">fallback function</span></a>
exists, the fallback function will be called on a plain Ether transfer. If
neither a receive Ether nor a payable fallback function is present, the
contract cannot receive Ether through regular transactions and throws an
exception.</p>
<p>In the worst case, the <code class="docutils literal notranslate"><span class="pre">receive</span></code> function can only rely on 2300 gas being
available (for example when <code class="docutils literal notranslate"><span class="pre">send</span></code> or <code class="docutils literal notranslate"><span class="pre">transfer</span></code> is used), leaving little
room to perform other operations except basic logging. The following operations
will consume more gas than the 2300 gas stipend:</p>
<ul class="simple">
<li><p>Writing to storage</p></li>
<li><p>Creating a contract</p></li>
<li><p>Calling an external function which consumes a large amount of gas</p></li>
<li><p>Sending Ether</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>When Ether is sent directly to a contract (without a function call, i.e. sender uses <code class="docutils literal notranslate"><span class="pre">send</span></code> or <code class="docutils literal notranslate"><span class="pre">transfer</span></code>)
but the receiving contract does not define a receive Ether function or a payable fallback function,
an exception will be thrown, sending back the Ether (this was different
before Solidity v0.4.0). If you want your contract to receive Ether,
you have to implement a receive Ether function (using payable fallback functions for receiving Ether is
not recommended, since the fallback is invoked and would not fail for interface confusions
on the part of the sender).</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>A contract without a receive Ether function can receive Ether as a
recipient of a <em>coinbase transaction</em> (aka <em>miner block reward</em>)
or as a destination of a <code class="docutils literal notranslate"><span class="pre">selfdestruct</span></code>.</p>
<p>A contract cannot react to such Ether transfers and thus also
cannot reject them. This is a design choice of the EVM and
Solidity cannot work around it.</p>
<p>It also means that <code class="docutils literal notranslate"><span class="pre">address(this).balance</span></code> can be higher
than the sum of some manual accounting implemented in a
contract (i.e. having a counter updated in the receive Ether function).</p>
</div>
<p>Below you can see an example of a Sink contract that uses function <code class="docutils literal notranslate"><span class="pre">receive</span></code>.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC42LjAgPDAuOS4wOwoKLy8gVGhpcyBjb250cmFjdCBrZWVwcyBhbGwgRXRoZXIgc2VudCB0byBpdCB3aXRoIG5vIHdheQovLyB0byBnZXQgaXQgYmFjay4KY29udHJhY3QgU2luayB7CiAgICBldmVudCBSZWNlaXZlZChhZGRyZXNzLCB1aW50KTsKICAgIHJlY2VpdmUoKSBleHRlcm5hbCBwYXlhYmxlIHsKICAgICAgICBlbWl0IFJlY2VpdmVkKG1zZy5zZW5kZXIsIG1zZy52YWx1ZSk7CiAgICB9Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.6.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="c1">// This contract keeps all Ether sent to it with no way</span>
<span class="c1">// to get it back.</span>
<span class="k">contract</span><span class="w"> </span><span class="ni">Sink</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">Received</span><span class="p">(</span><span class="kt">address</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span>receive<span class="p">()</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>emit<span class="w"> </span>Received<span class="p">(</span><span class="k">msg.sender</span><span class="p">,</span><span class="w"> </span><span class="k">msg.value</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="fallback-function">
<span id="index-12"></span><span id="id10"></span><h5>Fallback Function<a class="headerlink" href="#fallback-function" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>A contract can have at most one <code class="docutils literal notranslate"><span class="pre">fallback</span></code> function, declared using either <code class="docutils literal notranslate"><span class="pre">fallback</span> <span class="pre">()</span> <span class="pre">external</span> <span class="pre">[payable]</span></code>
or <code class="docutils literal notranslate"><span class="pre">fallback</span> <span class="pre">(bytes</span> <span class="pre">calldata</span> <span class="pre">input)</span> <span class="pre">external</span> <span class="pre">[payable]</span> <span class="pre">returns</span> <span class="pre">(bytes</span> <span class="pre">memory</span> <span class="pre">output)</span></code>
(both without the <code class="docutils literal notranslate"><span class="pre">function</span></code> keyword).
This function must have <code class="docutils literal notranslate"><span class="pre">external</span></code> visibility. A fallback function can be virtual, can override
and can have modifiers.</p>
<p>The fallback function is executed on a call to the contract if none of the other
functions match the given function signature, or if no data was supplied at
all and there is no <a class="reference internal" href="#receive-ether-function"><span class="std std-ref">receive Ether function</span></a>.
The fallback function always receives data, but in order to also receive Ether
it must be marked <code class="docutils literal notranslate"><span class="pre">payable</span></code>.</p>
<p>If the version with parameters is used, <code class="docutils literal notranslate"><span class="pre">input</span></code> will contain the full data sent to the contract
(equal to <code class="docutils literal notranslate"><span class="pre">msg.data</span></code>) and can return data in <code class="docutils literal notranslate"><span class="pre">output</span></code>. The returned data will not be
ABI-encoded. Instead it will be returned without modifications (not even padding).</p>
<p>In the worst case, if a payable fallback function is also used in
place of a receive function, it can only rely on 2300 gas being
available (see <a class="reference internal" href="#receive-ether-function"><span class="std std-ref">receive Ether function</span></a>
for a brief description of the implications of this).</p>
<p>Like any function, the fallback function can execute complex
operations as long as there is enough gas passed on to it.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>A <code class="docutils literal notranslate"><span class="pre">payable</span></code> fallback function is also executed for
plain Ether transfers, if no <a class="reference internal" href="#receive-ether-function"><span class="std std-ref">receive Ether function</span></a>
is present. It is recommended to always define a receive Ether
function as well, if you define a payable fallback function
to distinguish Ether transfers from interface confusions.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you want to decode the input data, you can check the first four bytes
for the function selector and then
you can use <code class="docutils literal notranslate"><span class="pre">abi.decode</span></code> together with the array slice syntax to
decode ABI-encoded data:
<code class="docutils literal notranslate"><span class="pre">(c,</span> <span class="pre">d)</span> <span class="pre">=</span> <span class="pre">abi.decode(input[4:],</span> <span class="pre">(uint256,</span> <span class="pre">uint256));</span></code>
Note that this should only be used as a last resort and
proper functions should be used instead.</p>
</div>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC42LjIgPDAuOS4wOwoKY29udHJhY3QgVGVzdCB7CiAgICB1aW50IHg7CiAgICAvLyBUaGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCBmb3IgYWxsIG1lc3NhZ2VzIHNlbnQgdG8KICAgIC8vIHRoaXMgY29udHJhY3QgKHRoZXJlIGlzIG5vIG90aGVyIGZ1bmN0aW9uKS4KICAgIC8vIFNlbmRpbmcgRXRoZXIgdG8gdGhpcyBjb250cmFjdCB3aWxsIGNhdXNlIGFuIGV4Y2VwdGlvbiwKICAgIC8vIGJlY2F1c2UgdGhlIGZhbGxiYWNrIGZ1bmN0aW9uIGRvZXMgbm90IGhhdmUgdGhlIGBwYXlhYmxlYAogICAgLy8gbW9kaWZpZXIuCiAgICBmYWxsYmFjaygpIGV4dGVybmFsIHsgeCA9IDE7IH0KfQoKY29udHJhY3QgVGVzdFBheWFibGUgewogICAgdWludCB4OwogICAgdWludCB5OwogICAgLy8gVGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgZm9yIGFsbCBtZXNzYWdlcyBzZW50IHRvCiAgICAvLyB0aGlzIGNvbnRyYWN0LCBleGNlcHQgcGxhaW4gRXRoZXIgdHJhbnNmZXJzCiAgICAvLyAodGhlcmUgaXMgbm8gb3RoZXIgZnVuY3Rpb24gZXhjZXB0IHRoZSByZWNlaXZlIGZ1bmN0aW9uKS4KICAgIC8vIEFueSBjYWxsIHdpdGggbm9uLWVtcHR5IGNhbGxkYXRhIHRvIHRoaXMgY29udHJhY3Qgd2lsbCBleGVjdXRlCiAgICAvLyB0aGUgZmFsbGJhY2sgZnVuY3Rpb24gKGV2ZW4gaWYgRXRoZXIgaXMgc2VudCBhbG9uZyB3aXRoIHRoZSBjYWxsKS4KICAgIGZhbGxiYWNrKCkgZXh0ZXJuYWwgcGF5YWJsZSB7IHggPSAxOyB5ID0gbXNnLnZhbHVlOyB9CgogICAgLy8gVGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgZm9yIHBsYWluIEV0aGVyIHRyYW5zZmVycywgaS5lLgogICAgLy8gZm9yIGV2ZXJ5IGNhbGwgd2l0aCBlbXB0eSBjYWxsZGF0YS4KICAgIHJlY2VpdmUoKSBleHRlcm5hbCBwYXlhYmxlIHsgeCA9IDI7IHkgPSBtc2cudmFsdWU7IH0KfQoKY29udHJhY3QgQ2FsbGVyIHsKICAgIGZ1bmN0aW9uIGNhbGxUZXN0KFRlc3QgdGVzdCkgcHVibGljIHJldHVybnMgKGJvb2wpIHsKICAgICAgICAoYm9vbCBzdWNjZXNzLCkgPSBhZGRyZXNzKHRlc3QpLmNhbGwoYWJpLmVuY29kZVdpdGhTaWduYXR1cmUoIm5vbkV4aXN0aW5nRnVuY3Rpb24oKSIpKTsKICAgICAgICByZXF1aXJlKHN1Y2Nlc3MpOwogICAgICAgIC8vIHJlc3VsdHMgaW4gdGVzdC54IGJlY29taW5nID09IDEuCgogICAgICAgIC8vIGFkZHJlc3ModGVzdCkgd2lsbCBub3QgYWxsb3cgdG8gY2FsbCBgYHNlbmRgYCBkaXJlY3RseSwgc2luY2UgYGB0ZXN0YGAgaGFzIG5vIHBheWFibGUKICAgICAgICAvLyBmYWxsYmFjayBmdW5jdGlvbi4KICAgICAgICAvLyBJdCBoYXMgdG8gYmUgY29udmVydGVkIHRvIHRoZSBgYGFkZHJlc3MgcGF5YWJsZWBgIHR5cGUgdG8gZXZlbiBhbGxvdyBjYWxsaW5nIGBgc2VuZGBgIG9uIGl0LgogICAgICAgIGFkZHJlc3MgcGF5YWJsZSB0ZXN0UGF5YWJsZSA9IHBheWFibGUoYWRkcmVzcyh0ZXN0KSk7CgogICAgICAgIC8vIElmIHNvbWVvbmUgc2VuZHMgRXRoZXIgdG8gdGhhdCBjb250cmFjdCwKICAgICAgICAvLyB0aGUgdHJhbnNmZXIgd2lsbCBmYWlsLCBpLmUuIHRoaXMgcmV0dXJucyBmYWxzZSBoZXJlLgogICAgICAgIHJldHVybiB0ZXN0UGF5YWJsZS5zZW5kKDIgZXRoZXIpOwogICAgfQoKICAgIGZ1bmN0aW9uIGNhbGxUZXN0UGF5YWJsZShUZXN0UGF5YWJsZSB0ZXN0KSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIChib29sIHN1Y2Nlc3MsKSA9IGFkZHJlc3ModGVzdCkuY2FsbChhYmkuZW5jb2RlV2l0aFNpZ25hdHVyZSgibm9uRXhpc3RpbmdGdW5jdGlvbigpIikpOwogICAgICAgIHJlcXVpcmUoc3VjY2Vzcyk7CiAgICAgICAgLy8gcmVzdWx0cyBpbiB0ZXN0LnggYmVjb21pbmcgPT0gMSBhbmQgdGVzdC55IGJlY29taW5nIDAuCiAgICAgICAgKHN1Y2Nlc3MsKSA9IGFkZHJlc3ModGVzdCkuY2FsbHt2YWx1ZTogMX0oYWJpLmVuY29kZVdpdGhTaWduYXR1cmUoIm5vbkV4aXN0aW5nRnVuY3Rpb24oKSIpKTsKICAgICAgICByZXF1aXJlKHN1Y2Nlc3MpOwogICAgICAgIC8vIHJlc3VsdHMgaW4gdGVzdC54IGJlY29taW5nID09IDEgYW5kIHRlc3QueSBiZWNvbWluZyAxLgoKICAgICAgICAvLyBJZiBzb21lb25lIHNlbmRzIEV0aGVyIHRvIHRoYXQgY29udHJhY3QsIHRoZSByZWNlaXZlIGZ1bmN0aW9uIGluIFRlc3RQYXlhYmxlIHdpbGwgYmUgY2FsbGVkLgogICAgICAgIC8vIFNpbmNlIHRoYXQgZnVuY3Rpb24gd3JpdGVzIHRvIHN0b3JhZ2UsIGl0IHRha2VzIG1vcmUgZ2FzIHRoYW4gaXMgYXZhaWxhYmxlIHdpdGggYQogICAgICAgIC8vIHNpbXBsZSBgYHNlbmRgYCBvciBgYHRyYW5zZmVyYGAuIEJlY2F1c2Ugb2YgdGhhdCwgd2UgaGF2ZSB0byB1c2UgYSBsb3ctbGV2ZWwgY2FsbC4KICAgICAgICAoc3VjY2VzcywpID0gYWRkcmVzcyh0ZXN0KS5jYWxse3ZhbHVlOiAyIGV0aGVyfSgiIik7CiAgICAgICAgcmVxdWlyZShzdWNjZXNzKTsKICAgICAgICAvLyByZXN1bHRzIGluIHRlc3QueCBiZWNvbWluZyA9PSAyIGFuZCB0ZXN0LnkgYmVjb21pbmcgMiBldGhlci4KCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.6.2</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Test</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="nv">x</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="c1">// This function is called for all messages sent to</span>
<span class="w">    </span><span class="c1">// this contract (there is no other function).</span>
<span class="w">    </span><span class="c1">// Sending Ether to this contract will cause an exception,</span>
<span class="w">    </span><span class="c1">// because the fallback function does not have the `payable`</span>
<span class="w">    </span><span class="c1">// modifier.</span>
<span class="w">    </span>fallback<span class="p">()</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>x<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">TestPayable</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="nv">x</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="nv">y</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="c1">// This function is called for all messages sent to</span>
<span class="w">    </span><span class="c1">// this contract, except plain Ether transfers</span>
<span class="w">    </span><span class="c1">// (there is no other function except the receive function).</span>
<span class="w">    </span><span class="c1">// Any call with non-empty calldata to this contract will execute</span>
<span class="w">    </span><span class="c1">// the fallback function (even if Ether is sent along with the call).</span>
<span class="w">    </span>fallback<span class="p">()</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>x<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">;</span><span class="w"> </span>y<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">msg.value</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">// This function is called for plain Ether transfers, i.e.</span>
<span class="w">    </span><span class="c1">// for every call with empty calldata.</span>
<span class="w">    </span>receive<span class="p">()</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>x<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">2</span><span class="p">;</span><span class="w"> </span>y<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">msg.value</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Caller</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">callTest</span><span class="p">(</span>Test<span class="w"> </span>test<span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="nv">success</span><span class="p">,)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">address</span><span class="p">(</span>test<span class="p">).</span>call<span class="p">(</span>abi<span class="p">.</span>encodeWithSignature<span class="p">(</span><span class="s2">&quot;nonExistingFunction()&quot;</span><span class="p">));</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>success<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// results in test.x becoming == 1.</span>

<span class="w">        </span><span class="c1">// address(test) will not allow to call ``send`` directly, since ``test`` has no payable</span>
<span class="w">        </span><span class="c1">// fallback function.</span>
<span class="w">        </span><span class="c1">// It has to be converted to the ``address payable`` type to even allow calling ``send`` on it.</span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">payable</span><span class="w"> </span>testPayable<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">payable</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span>test<span class="p">));</span><span class="w"></span>

<span class="w">        </span><span class="c1">// If someone sends Ether to that contract,</span>
<span class="w">        </span><span class="c1">// the transfer will fail, i.e. this returns false here.</span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>testPayable<span class="p">.</span>send<span class="p">(</span><span class="m m-Decimal">2</span><span class="w"> </span>ether<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">callTestPayable</span><span class="p">(</span>TestPayable<span class="w"> </span>test<span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="nv">success</span><span class="p">,)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">address</span><span class="p">(</span>test<span class="p">).</span>call<span class="p">(</span>abi<span class="p">.</span>encodeWithSignature<span class="p">(</span><span class="s2">&quot;nonExistingFunction()&quot;</span><span class="p">));</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>success<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// results in test.x becoming == 1 and test.y becoming 0.</span>
<span class="w">        </span><span class="p">(</span>success<span class="p">,)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">address</span><span class="p">(</span>test<span class="p">).</span>call<span class="p">{</span>value<span class="p">:</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">}(</span>abi<span class="p">.</span>encodeWithSignature<span class="p">(</span><span class="s2">&quot;nonExistingFunction()&quot;</span><span class="p">));</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>success<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// results in test.x becoming == 1 and test.y becoming 1.</span>

<span class="w">        </span><span class="c1">// If someone sends Ether to that contract, the receive function in TestPayable will be called.</span>
<span class="w">        </span><span class="c1">// Since that function writes to storage, it takes more gas than is available with a</span>
<span class="w">        </span><span class="c1">// simple ``send`` or ``transfer``. Because of that, we have to use a low-level call.</span>
<span class="w">        </span><span class="p">(</span>success<span class="p">,)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">address</span><span class="p">(</span>test<span class="p">).</span>call<span class="p">{</span>value<span class="p">:</span><span class="w"> </span><span class="m m-Decimal">2</span><span class="w"> </span>ether<span class="p">}(</span><span class="s2">&quot;&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>success<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// results in test.x becoming == 2 and test.y becoming 2 ether.</span>

<span class="w">        </span><span class="kt">return</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
<section id="function-overloading">
<span id="overload-function"></span><span id="index-13"></span><h4>Function Overloading<a class="headerlink" href="#function-overloading" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>A contract can have multiple functions of the same name but with different parameter
types.
This process is called ‚Äúoverloading‚Äù and also applies to inherited functions.
The following example shows overloading of the function
<code class="docutils literal notranslate"><span class="pre">f</span></code> in the scope of contract <code class="docutils literal notranslate"><span class="pre">A</span></code>.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC40LjE2IDwwLjkuMDsKCmNvbnRyYWN0IEEgewogICAgZnVuY3Rpb24gZih1aW50IHZhbHVlKSBwdWJsaWMgcHVyZSByZXR1cm5zICh1aW50IG91dCkgewogICAgICAgIG91dCA9IHZhbHVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGYodWludCB2YWx1ZSwgYm9vbCByZWFsbHkpIHB1YmxpYyBwdXJlIHJldHVybnMgKHVpbnQgb3V0KSB7CiAgICAgICAgaWYgKHJlYWxseSkKICAgICAgICAgICAgb3V0ID0gdmFsdWU7CiAgICB9Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.4.16</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">A</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">f</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">out</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>out<span class="w"> </span><span class="o">=</span><span class="w"> </span>value<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">f</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">value</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nv">really</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">out</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>really<span class="p">)</span><span class="w"></span>
<span class="w">            </span>out<span class="w"> </span><span class="o">=</span><span class="w"> </span>value<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Overloaded functions are also present in the external interface. It is an error if two
externally visible functions differ by their Solidity types but not by their external types.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC40LjE2IDwwLjkuMDsKCi8vIFRoaXMgd2lsbCBub3QgY29tcGlsZQpjb250cmFjdCBBIHsKICAgIGZ1bmN0aW9uIGYoQiB2YWx1ZSkgcHVibGljIHB1cmUgcmV0dXJucyAoQiBvdXQpIHsKICAgICAgICBvdXQgPSB2YWx1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBmKGFkZHJlc3MgdmFsdWUpIHB1YmxpYyBwdXJlIHJldHVybnMgKGFkZHJlc3Mgb3V0KSB7CiAgICAgICAgb3V0ID0gdmFsdWU7CiAgICB9Cn0KCmNvbnRyYWN0IEIgewp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.4.16</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="c1">// This will not compile</span>
<span class="k">contract</span><span class="w"> </span><span class="ni">A</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">f</span><span class="p">(</span>B<span class="w"> </span>value<span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span>B<span class="w"> </span>out<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>out<span class="w"> </span><span class="o">=</span><span class="w"> </span>value<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">f</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">out</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>out<span class="w"> </span><span class="o">=</span><span class="w"> </span>value<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">B</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Both <code class="docutils literal notranslate"><span class="pre">f</span></code> function overloads above end up accepting the address type for the ABI although
they are considered different inside Solidity.</p>
<section id="overload-resolution-and-argument-matching">
<h5>Overload resolution and Argument matching<a class="headerlink" href="#overload-resolution-and-argument-matching" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>Overloaded functions are selected by matching the function declarations in the current scope
to the arguments supplied in the function call. Functions are selected as overload candidates
if all arguments can be implicitly converted to the expected types. If there is not exactly one
candidate, resolution fails.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Return parameters are not taken into account for overload resolution.</p>
</div>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC40LjE2IDwwLjkuMDsKCmNvbnRyYWN0IEEgewogICAgZnVuY3Rpb24gZih1aW50OCB2YWwpIHB1YmxpYyBwdXJlIHJldHVybnMgKHVpbnQ4IG91dCkgewogICAgICAgIG91dCA9IHZhbDsKICAgIH0KCiAgICBmdW5jdGlvbiBmKHVpbnQyNTYgdmFsKSBwdWJsaWMgcHVyZSByZXR1cm5zICh1aW50MjU2IG91dCkgewogICAgICAgIG91dCA9IHZhbDsKICAgIH0KfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.4.16</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">A</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">f</span><span class="p">(</span><span class="kt">uint8</span><span class="w"> </span><span class="nv">val</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint8</span><span class="w"> </span><span class="nv">out</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>out<span class="w"> </span><span class="o">=</span><span class="w"> </span>val<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">f</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">val</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">out</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>out<span class="w"> </span><span class="o">=</span><span class="w"> </span>val<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Calling <code class="docutils literal notranslate"><span class="pre">f(50)</span></code> would create a type error since <code class="docutils literal notranslate"><span class="pre">50</span></code> can be implicitly converted both to <code class="docutils literal notranslate"><span class="pre">uint8</span></code>
and <code class="docutils literal notranslate"><span class="pre">uint256</span></code> types. On another hand <code class="docutils literal notranslate"><span class="pre">f(256)</span></code> would resolve to <code class="docutils literal notranslate"><span class="pre">f(uint256)</span></code> overload as <code class="docutils literal notranslate"><span class="pre">256</span></code> cannot be implicitly
converted to <code class="docutils literal notranslate"><span class="pre">uint8</span></code>.</p>
</section>
</section>
</section>
<section id="events">
<span id="index-14"></span><span id="id11"></span><h3>Events<a class="headerlink" href="#events" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Solidity events give an abstraction on top of the EVM‚Äôs logging functionality.
Applications can subscribe and listen to these events through the RPC interface of an Ethereum client.</p>
<p>Events are inheritable members of contracts. When you call them, they cause the
arguments to be stored in the transaction‚Äôs log - a special data structure
in the blockchain. These logs are associated with the address of the contract,
are incorporated into the blockchain, and stay there as long as a block is
accessible (forever as of now, but this might
change with Serenity). The Log and its event data is not accessible from within
contracts (not even from the contract that created them).</p>
<p>It is possible to request a Merkle proof for logs, so if
an external entity supplies a contract with such a proof, it can check
that the log actually exists inside the blockchain. You have to supply block headers
because the contract can only see the last 256 block hashes.</p>
<p>You can add the attribute <code class="docutils literal notranslate"><span class="pre">indexed</span></code> to up to three parameters which adds them
to a special data structure known as <a class="reference internal" href="index.html#abi-events"><span class="std std-ref">‚Äútopics‚Äù</span></a> instead of
the data part of the log.
A topic can only hold a single word (32 bytes) so if you use a <a class="reference internal" href="index.html#reference-types"><span class="std std-ref">reference type</span></a> for an indexed argument, the Keccak-256 hash of the value is stored
as a topic instead.</p>
<p>All parameters without the <code class="docutils literal notranslate"><span class="pre">indexed</span></code> attribute are <a class="reference internal" href="index.html#abi"><span class="std std-ref">ABI-encoded</span></a>
into the data part of the log.</p>
<p>Topics allow you to search for events, for example when filtering a sequence of
blocks for certain events. You can also filter events by the address of the
contract that emitted the event.</p>
<p>For example, the code below uses the web3.js <code class="docutils literal notranslate"><span class="pre">subscribe(&quot;logs&quot;)</span></code>
<a class="reference external" href="https://web3js.readthedocs.io/en/1.0/web3-eth-subscribe.html#subscribe-logs">method</a> to filter
logs that match a topic with a certain address value:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nx">fromBlock</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nx">address</span><span class="o">:</span><span class="w"> </span><span class="nx">web3</span><span class="p">.</span><span class="nx">eth</span><span class="p">.</span><span class="nx">defaultAccount</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nx">topics</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">]</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
<span class="nx">web3</span><span class="p">.</span><span class="nx">eth</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="s1">&#39;logs&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">options</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">error</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span><span class="w"></span>
<span class="p">})</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">log</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">log</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">})</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;changed&quot;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">log</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="p">});</span><span class="w"></span>
</pre></div>
</div>
<p>The hash of the signature of the event is one of the topics, except if you
declared the event with the <code class="docutils literal notranslate"><span class="pre">anonymous</span></code> specifier. This means that it is
not possible to filter for specific anonymous events by name, you can
only filter by the contract address. The advantage of anonymous events
is that they are cheaper to deploy and call. It also allows you to declare
four indexed arguments rather than three.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Since the transaction log only stores the event data and not the type,
you have to know the type of the event, including which parameter is
indexed and if the event is anonymous in order to correctly interpret
the data.
In particular, it is possible to ‚Äúfake‚Äù the signature of another event
using an anonymous event.</p>
</div>
<section id="members-of-events">
<span id="index-15"></span><h4>Members of Events<a class="headerlink" href="#members-of-events" title="Permalink to this heading">ÔÉÅ</a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">event.selector</span></code>: For non-anonymous events, this is a <code class="docutils literal notranslate"><span class="pre">bytes32</span></code> value
containing the <code class="docutils literal notranslate"><span class="pre">keccak256</span></code> hash of the event signature, as used in the default topic.</p></li>
</ul>
</section>
<section id="example">
<h4>Example<a class="headerlink" href="#example" title="Permalink to this heading">ÔÉÅ</a></h4>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC40LjIxIDwwLjkuMDsKCmNvbnRyYWN0IENsaWVudFJlY2VpcHQgewogICAgZXZlbnQgRGVwb3NpdCgKICAgICAgICBhZGRyZXNzIGluZGV4ZWQgZnJvbSwKICAgICAgICBieXRlczMyIGluZGV4ZWQgaWQsCiAgICAgICAgdWludCB2YWx1ZQogICAgKTsKCiAgICBmdW5jdGlvbiBkZXBvc2l0KGJ5dGVzMzIgaWQpIHB1YmxpYyBwYXlhYmxlIHsKICAgICAgICAvLyBFdmVudHMgYXJlIGVtaXR0ZWQgdXNpbmcgYGVtaXRgLCBmb2xsb3dlZCBieQogICAgICAgIC8vIHRoZSBuYW1lIG9mIHRoZSBldmVudCBhbmQgdGhlIGFyZ3VtZW50cwogICAgICAgIC8vIChpZiBhbnkpIGluIHBhcmVudGhlc2VzLiBBbnkgc3VjaCBpbnZvY2F0aW9uCiAgICAgICAgLy8gKGV2ZW4gZGVlcGx5IG5lc3RlZCkgY2FuIGJlIGRldGVjdGVkIGZyb20KICAgICAgICAvLyB0aGUgSmF2YVNjcmlwdCBBUEkgYnkgZmlsdGVyaW5nIGZvciBgRGVwb3NpdGAuCiAgICAgICAgZW1pdCBEZXBvc2l0KG1zZy5zZW5kZXIsIGlkLCBtc2cudmFsdWUpOwogICAgfQp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.4.21</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">ClientReceipt</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">Deposit</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>from<span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>id<span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="w"> </span><span class="nv">value</span><span class="w"></span>
<span class="w">    </span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">deposit</span><span class="p">(</span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">id</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Events are emitted using `emit`, followed by</span>
<span class="w">        </span><span class="c1">// the name of the event and the arguments</span>
<span class="w">        </span><span class="c1">// (if any) in parentheses. Any such invocation</span>
<span class="w">        </span><span class="c1">// (even deeply nested) can be detected from</span>
<span class="w">        </span><span class="c1">// the JavaScript API by filtering for `Deposit`.</span>
<span class="w">        </span>emit<span class="w"> </span>Deposit<span class="p">(</span><span class="k">msg.sender</span><span class="p">,</span><span class="w"> </span>id<span class="p">,</span><span class="w"> </span><span class="k">msg.value</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>The use in the JavaScript API is as follows:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">abi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="cm">/* abi as generated by the compiler */</span><span class="p">;</span><span class="w"></span>
<span class="kd">var</span><span class="w"> </span><span class="nx">ClientReceipt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">web3</span><span class="p">.</span><span class="nx">eth</span><span class="p">.</span><span class="nx">contract</span><span class="p">(</span><span class="nx">abi</span><span class="p">);</span><span class="w"></span>
<span class="kd">var</span><span class="w"> </span><span class="nx">clientReceipt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ClientReceipt</span><span class="p">.</span><span class="nx">at</span><span class="p">(</span><span class="s2">&quot;0x1234...ab67&quot;</span><span class="w"> </span><span class="cm">/* address */</span><span class="p">);</span><span class="w"></span>

<span class="kd">var</span><span class="w"> </span><span class="nx">depositEvent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">clientReceipt</span><span class="p">.</span><span class="nx">Deposit</span><span class="p">();</span><span class="w"></span>

<span class="c1">// watch for changes</span><span class="w"></span>
<span class="nx">depositEvent</span><span class="p">.</span><span class="nx">watch</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">){</span><span class="w"></span>
<span class="w">    </span><span class="c1">// result contains non-indexed arguments and topics</span><span class="w"></span>
<span class="w">    </span><span class="c1">// given to the `Deposit` call.</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">error</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span><span class="w"></span>
<span class="p">});</span><span class="w"></span>


<span class="c1">// Or pass a callback to start watching immediately</span><span class="w"></span>
<span class="kd">var</span><span class="w"> </span><span class="nx">depositEvent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">clientReceipt</span><span class="p">.</span><span class="nx">Deposit</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span><span class="w"> </span><span class="nx">result</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">error</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span><span class="w"></span>
<span class="p">});</span><span class="w"></span>
</pre></div>
</div>
<p>The output of the above looks like the following (trimmed):</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="nt">&quot;returnValues&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">       </span><span class="nt">&quot;from&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0x1111‚Ä¶FFFFCCCC&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">       </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0x50‚Ä¶sd5adb20&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">       </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0x420042&quot;</span><span class="w"></span>
<span class="w">   </span><span class="p">},</span><span class="w"></span>
<span class="w">   </span><span class="nt">&quot;raw&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">       </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0x7f‚Ä¶91385&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">       </span><span class="nt">&quot;topics&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;0xfd4‚Ä¶b4ead7&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;0x7f‚Ä¶1a91385&quot;</span><span class="p">]</span><span class="w"></span>
<span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="additional-resources-for-understanding-events">
<h4>Additional Resources for Understanding Events<a class="headerlink" href="#additional-resources-for-understanding-events" title="Permalink to this heading">ÔÉÅ</a></h4>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/ethereum/web3.js/blob/1.x/docs/web3-eth-contract.rst#events">Javascript documentation</a></p></li>
<li><p><a class="reference external" href="https://github.com/ethchange/smart-exchange/blob/master/lib/contracts/SmartExchange.sol">Example usage of events</a></p></li>
<li><p><a class="reference external" href="https://github.com/ethchange/smart-exchange/blob/master/lib/exchange_transactions.js">How to access them in js</a></p></li>
</ul>
</section>
</section>
<section id="errors-and-the-revert-statement">
<span id="errors"></span><span id="index-16"></span><h3>Errors and the Revert Statement<a class="headerlink" href="#errors-and-the-revert-statement" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Errors in Solidity provide a convenient and gas-efficient way to explain to the
user why an operation failed. They can be defined inside and outside of contracts (including interfaces and libraries).</p>
<p>They have to be used together with the <a class="reference internal" href="index.html#revert-statement"><span class="std std-ref">revert statement</span></a>
which causes
all changes in the current call to be reverted and passes the error data back to the
caller.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5IF4wLjguNDsKCi8vLyBJbnN1ZmZpY2llbnQgYmFsYW5jZSBmb3IgdHJhbnNmZXIuIE5lZWRlZCBgcmVxdWlyZWRgIGJ1dCBvbmx5Ci8vLyBgYXZhaWxhYmxlYCBhdmFpbGFibGUuCi8vLyBAcGFyYW0gYXZhaWxhYmxlIGJhbGFuY2UgYXZhaWxhYmxlLgovLy8gQHBhcmFtIHJlcXVpcmVkIHJlcXVlc3RlZCBhbW91bnQgdG8gdHJhbnNmZXIuCmVycm9yIEluc3VmZmljaWVudEJhbGFuY2UodWludDI1NiBhdmFpbGFibGUsIHVpbnQyNTYgcmVxdWlyZWQpOwoKY29udHJhY3QgVGVzdFRva2VuIHsKICAgIG1hcHBpbmcoYWRkcmVzcyA9PiB1aW50KSBiYWxhbmNlOwogICAgZnVuY3Rpb24gdHJhbnNmZXIoYWRkcmVzcyB0bywgdWludDI1NiBhbW91bnQpIHB1YmxpYyB7CiAgICAgICAgaWYgKGFtb3VudCA+IGJhbGFuY2VbbXNnLnNlbmRlcl0pCiAgICAgICAgICAgIHJldmVydCBJbnN1ZmZpY2llbnRCYWxhbmNlKHsKICAgICAgICAgICAgICAgIGF2YWlsYWJsZTogYmFsYW5jZVttc2cuc2VuZGVyXSwKICAgICAgICAgICAgICAgIHJlcXVpcmVkOiBhbW91bnQKICAgICAgICAgICAgfSk7CiAgICAgICAgYmFsYW5jZVttc2cuc2VuZGVyXSAtPSBhbW91bnQ7CiAgICAgICAgYmFsYW5jZVt0b10gKz0gYW1vdW50OwogICAgfQogICAgLy8gLi4uCn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.8.4</span><span class="p">;</span><span class="w"></span>

<span class="c1">/// Insufficient balance for transfer. Needed `required` but only</span>
<span class="c1">/// `available` available.</span>
<span class="c1">/// @param available balance available.</span>
<span class="c1">/// @param required requested amount to transfer.</span>
error<span class="w"> </span>InsufficientBalance<span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">available</span><span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">required</span><span class="p">);</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">TestToken</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span>balance<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">transfer</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">to</span><span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amount</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>amount<span class="w"> </span><span class="o">&gt;</span><span class="w"> </span>balance<span class="p">[</span><span class="k">msg.sender</span><span class="p">])</span><span class="w"></span>
<span class="w">            </span>revert<span class="w"> </span>InsufficientBalance<span class="p">({</span><span class="w"></span>
<span class="w">                </span>available<span class="p">:</span><span class="w"> </span>balance<span class="p">[</span><span class="k">msg.sender</span><span class="p">],</span><span class="w"></span>
<span class="w">                </span>required<span class="p">:</span><span class="w"> </span>amount<span class="w"></span>
<span class="w">            </span><span class="p">});</span><span class="w"></span>
<span class="w">        </span>balance<span class="p">[</span><span class="k">msg.sender</span><span class="p">]</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span>amount<span class="p">;</span><span class="w"></span>
<span class="w">        </span>balance<span class="p">[</span>to<span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span>amount<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Errors cannot be overloaded or overridden but are inherited.
The same error can be defined in multiple places as long as the scopes are distinct.
Instances of errors can only be created using <code class="docutils literal notranslate"><span class="pre">revert</span></code> statements.</p>
<p>The error creates data that is then passed to the caller with the revert operation
to either return to the off-chain component or catch it in a <a class="reference internal" href="index.html#try-catch"><span class="std std-ref">try/catch statement</span></a>.
Note that an error can only be caught when coming from an external call,
reverts happening in internal calls or inside the same function cannot be caught.</p>
<p>If you do not provide any parameters, the error only needs four bytes of
data and you can use <a class="reference internal" href="index.html#natspec"><span class="std std-ref">NatSpec</span></a> as above
to further explain the reasons behind the error, which is not stored on chain.
This makes this a very cheap and convenient error-reporting feature at the same time.</p>
<p>More specifically, an error instance is ABI-encoded in the same way as
a function call to a function of the same name and types would be
and then used as the return data in the <code class="docutils literal notranslate"><span class="pre">revert</span></code> opcode.
This means that the data consists of a 4-byte selector followed by <a class="reference internal" href="index.html#abi"><span class="std std-ref">ABI-encoded</span></a> data.
The selector consists of the first four bytes of the keccak256-hash of the signature of the error type.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is possible for a contract to revert
with different errors of the same name or even with errors defined in different places
that are indistinguishable by the caller. For the outside, i.e. the ABI,
only the name of the error is relevant, not the contract or file where it is defined.</p>
</div>
<p>The statement <code class="docutils literal notranslate"><span class="pre">require(condition,</span> <span class="pre">&quot;description&quot;);</span></code> would be equivalent to
<code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">(!condition)</span> <span class="pre">revert</span> <span class="pre">Error(&quot;description&quot;)</span></code> if you could define
<code class="docutils literal notranslate"><span class="pre">error</span> <span class="pre">Error(string)</span></code>.
Note, however, that <code class="docutils literal notranslate"><span class="pre">Error</span></code> is a built-in type and cannot be defined in user-supplied code.</p>
<p>Similarly, a failing <code class="docutils literal notranslate"><span class="pre">assert</span></code> or similar conditions will revert with an error
of the built-in type <code class="docutils literal notranslate"><span class="pre">Panic(uint256)</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Error data should only be used to give an indication of failure, but
not as a means for control-flow. The reason is that the revert data
of inner calls is propagated back through the chain of external calls
by default. This means that an inner call
can ‚Äúforge‚Äù revert data that looks like it could have come from the
contract that called it.</p>
</div>
<section id="members-of-errors">
<h4>Members of Errors<a class="headerlink" href="#members-of-errors" title="Permalink to this heading">ÔÉÅ</a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">error.selector</span></code>: A <code class="docutils literal notranslate"><span class="pre">bytes4</span></code> value containing the error selector.</p></li>
</ul>
</section>
</section>
<section id="inheritance">
<span id="index-17"></span><h3>Inheritance<a class="headerlink" href="#inheritance" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Solidity supports multiple inheritance including polymorphism.</p>
<p>Polymorphism means that a function call (internal and external)
always executes the function of the same name (and parameter types)
in the most derived contract in the inheritance hierarchy.
This has to be explicitly enabled on each function in the
hierarchy using the <code class="docutils literal notranslate"><span class="pre">virtual</span></code> and <code class="docutils literal notranslate"><span class="pre">override</span></code> keywords.
See <a class="reference internal" href="#function-overriding"><span class="std std-ref">Function Overriding</span></a> for more details.</p>
<p>It is possible to call functions further up in the inheritance
hierarchy internally by explicitly specifying the contract
using <code class="docutils literal notranslate"><span class="pre">ContractName.functionName()</span></code> or using <code class="docutils literal notranslate"><span class="pre">super.functionName()</span></code>
if you want to call the function one level higher up in
the flattened inheritance hierarchy (see below).</p>
<p>When a contract inherits from other contracts, only a single
contract is created on the blockchain, and the code from all the base contracts
is compiled into the created contract. This means that all internal calls
to functions of base contracts also just use internal function calls
(<code class="docutils literal notranslate"><span class="pre">super.f(..)</span></code> will use JUMP and not a message call).</p>
<p>State variable shadowing is considered as an error.  A derived contract can
only declare a state variable <code class="docutils literal notranslate"><span class="pre">x</span></code>, if there is no visible state variable
with the same name in any of its bases.</p>
<p>The general inheritance system is very similar to
<a class="reference external" href="https://docs.python.org/3/tutorial/classes.html#inheritance">Python‚Äôs</a>,
especially concerning multiple inheritance, but there are also
some <a class="reference internal" href="#multi-inheritance"><span class="std std-ref">differences</span></a>.</p>
<p>Details are given in the following example.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC43LjAgPDAuOS4wOwoKCmNvbnRyYWN0IE93bmVkIHsKICAgIGNvbnN0cnVjdG9yKCkgeyBvd25lciA9IHBheWFibGUobXNnLnNlbmRlcik7IH0KICAgIGFkZHJlc3MgcGF5YWJsZSBvd25lcjsKfQoKCi8vIFVzZSBgaXNgIHRvIGRlcml2ZSBmcm9tIGFub3RoZXIgY29udHJhY3QuIERlcml2ZWQKLy8gY29udHJhY3RzIGNhbiBhY2Nlc3MgYWxsIG5vbi1wcml2YXRlIG1lbWJlcnMgaW5jbHVkaW5nCi8vIGludGVybmFsIGZ1bmN0aW9ucyBhbmQgc3RhdGUgdmFyaWFibGVzLiBUaGVzZSBjYW5ub3QgYmUKLy8gYWNjZXNzZWQgZXh0ZXJuYWxseSB2aWEgYHRoaXNgLCB0aG91Z2guCmNvbnRyYWN0IERlc3RydWN0aWJsZSBpcyBPd25lZCB7CiAgICAvLyBUaGUga2V5d29yZCBgdmlydHVhbGAgbWVhbnMgdGhhdCB0aGUgZnVuY3Rpb24gY2FuIGNoYW5nZQogICAgLy8gaXRzIGJlaGF2aW91ciBpbiBkZXJpdmVkIGNsYXNzZXMgKCJvdmVycmlkaW5nIikuCiAgICBmdW5jdGlvbiBkZXN0cm95KCkgdmlydHVhbCBwdWJsaWMgewogICAgICAgIGlmIChtc2cuc2VuZGVyID09IG93bmVyKSBzZWxmZGVzdHJ1Y3Qob3duZXIpOwogICAgfQp9CgoKLy8gVGhlc2UgYWJzdHJhY3QgY29udHJhY3RzIGFyZSBvbmx5IHByb3ZpZGVkIHRvIG1ha2UgdGhlCi8vIGludGVyZmFjZSBrbm93biB0byB0aGUgY29tcGlsZXIuIE5vdGUgdGhlIGZ1bmN0aW9uCi8vIHdpdGhvdXQgYm9keS4gSWYgYSBjb250cmFjdCBkb2VzIG5vdCBpbXBsZW1lbnQgYWxsCi8vIGZ1bmN0aW9ucyBpdCBjYW4gb25seSBiZSB1c2VkIGFzIGFuIGludGVyZmFjZS4KYWJzdHJhY3QgY29udHJhY3QgQ29uZmlnIHsKICAgIGZ1bmN0aW9uIGxvb2t1cCh1aW50IGlkKSBwdWJsaWMgdmlydHVhbCByZXR1cm5zIChhZGRyZXNzIGFkcik7Cn0KCgphYnN0cmFjdCBjb250cmFjdCBOYW1lUmVnIHsKICAgIGZ1bmN0aW9uIHJlZ2lzdGVyKGJ5dGVzMzIgbmFtZSkgcHVibGljIHZpcnR1YWw7CiAgICBmdW5jdGlvbiB1bnJlZ2lzdGVyKCkgcHVibGljIHZpcnR1YWw7Cn0KCgovLyBNdWx0aXBsZSBpbmhlcml0YW5jZSBpcyBwb3NzaWJsZS4gTm90ZSB0aGF0IGBPd25lZGAgaXMKLy8gYWxzbyBhIGJhc2UgY2xhc3Mgb2YgYERlc3RydWN0aWJsZWAsIHlldCB0aGVyZSBpcyBvbmx5IGEgc2luZ2xlCi8vIGluc3RhbmNlIG9mIGBPd25lZGAgKGFzIGZvciB2aXJ0dWFsIGluaGVyaXRhbmNlIGluIEMrKykuCmNvbnRyYWN0IE5hbWVkIGlzIE93bmVkLCBEZXN0cnVjdGlibGUgewogICAgY29uc3RydWN0b3IoYnl0ZXMzMiBuYW1lKSB7CiAgICAgICAgQ29uZmlnIGNvbmZpZyA9IENvbmZpZygweEQ1ZjlEOEQ5NDg4NkU3MGIwNkU0NzRjM2ZCMTRGZDQzRTJmMjM5NzApOwogICAgICAgIE5hbWVSZWcoY29uZmlnLmxvb2t1cCgxKSkucmVnaXN0ZXIobmFtZSk7CiAgICB9CgogICAgLy8gRnVuY3Rpb25zIGNhbiBiZSBvdmVycmlkZGVuIGJ5IGFub3RoZXIgZnVuY3Rpb24gd2l0aCB0aGUgc2FtZSBuYW1lIGFuZAogICAgLy8gdGhlIHNhbWUgbnVtYmVyL3R5cGVzIG9mIGlucHV0cy4gIElmIHRoZSBvdmVycmlkaW5nIGZ1bmN0aW9uIGhhcyBkaWZmZXJlbnQKICAgIC8vIHR5cGVzIG9mIG91dHB1dCBwYXJhbWV0ZXJzLCB0aGF0IGNhdXNlcyBhbiBlcnJvci4KICAgIC8vIEJvdGggbG9jYWwgYW5kIG1lc3NhZ2UtYmFzZWQgZnVuY3Rpb24gY2FsbHMgdGFrZSB0aGVzZSBvdmVycmlkZXMKICAgIC8vIGludG8gYWNjb3VudC4KICAgIC8vIElmIHlvdSB3YW50IHRoZSBmdW5jdGlvbiB0byBvdmVycmlkZSwgeW91IG5lZWQgdG8gdXNlIHRoZQogICAgLy8gYG92ZXJyaWRlYCBrZXl3b3JkLiBZb3UgbmVlZCB0byBzcGVjaWZ5IHRoZSBgdmlydHVhbGAga2V5d29yZCBhZ2FpbgogICAgLy8gaWYgeW91IHdhbnQgdGhpcyBmdW5jdGlvbiB0byBiZSBvdmVycmlkZGVuIGFnYWluLgogICAgZnVuY3Rpb24gZGVzdHJveSgpIHB1YmxpYyB2aXJ0dWFsIG92ZXJyaWRlIHsKICAgICAgICBpZiAobXNnLnNlbmRlciA9PSBvd25lcikgewogICAgICAgICAgICBDb25maWcgY29uZmlnID0gQ29uZmlnKDB4RDVmOUQ4RDk0ODg2RTcwYjA2RTQ3NGMzZkIxNEZkNDNFMmYyMzk3MCk7CiAgICAgICAgICAgIE5hbWVSZWcoY29uZmlnLmxvb2t1cCgxKSkudW5yZWdpc3RlcigpOwogICAgICAgICAgICAvLyBJdCBpcyBzdGlsbCBwb3NzaWJsZSB0byBjYWxsIGEgc3BlY2lmaWMKICAgICAgICAgICAgLy8gb3ZlcnJpZGRlbiBmdW5jdGlvbi4KICAgICAgICAgICAgRGVzdHJ1Y3RpYmxlLmRlc3Ryb3koKTsKICAgICAgICB9CiAgICB9Cn0KCgovLyBJZiBhIGNvbnN0cnVjdG9yIHRha2VzIGFuIGFyZ3VtZW50LCBpdCBuZWVkcyB0byBiZQovLyBwcm92aWRlZCBpbiB0aGUgaGVhZGVyIG9yIG1vZGlmaWVyLWludm9jYXRpb24tc3R5bGUgYXQKLy8gdGhlIGNvbnN0cnVjdG9yIG9mIHRoZSBkZXJpdmVkIGNvbnRyYWN0IChzZWUgYmVsb3cpLgpjb250cmFjdCBQcmljZUZlZWQgaXMgT3duZWQsIERlc3RydWN0aWJsZSwgTmFtZWQoIkdvbGRGZWVkIikgewogICAgZnVuY3Rpb24gdXBkYXRlSW5mbyh1aW50IG5ld0luZm8pIHB1YmxpYyB7CiAgICAgICAgaWYgKG1zZy5zZW5kZXIgPT0gb3duZXIpIGluZm8gPSBuZXdJbmZvOwogICAgfQoKICAgIC8vIEhlcmUsIHdlIG9ubHkgc3BlY2lmeSBgb3ZlcnJpZGVgIGFuZCBub3QgYHZpcnR1YWxgLgogICAgLy8gVGhpcyBtZWFucyB0aGF0IGNvbnRyYWN0cyBkZXJpdmluZyBmcm9tIGBQcmljZUZlZWRgCiAgICAvLyBjYW5ub3QgY2hhbmdlIHRoZSBiZWhhdmlvdXIgb2YgYGRlc3Ryb3lgIGFueW1vcmUuCiAgICBmdW5jdGlvbiBkZXN0cm95KCkgcHVibGljIG92ZXJyaWRlKERlc3RydWN0aWJsZSwgTmFtZWQpIHsgTmFtZWQuZGVzdHJveSgpOyB9CiAgICBmdW5jdGlvbiBnZXQoKSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQgcikgeyByZXR1cm4gaW5mbzsgfQoKICAgIHVpbnQgaW5mbzsKfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.7.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>


<span class="k">contract</span><span class="w"> </span><span class="ni">Owned</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>owner<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">payable</span><span class="p">(</span><span class="k">msg.sender</span><span class="p">);</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">payable</span><span class="w"> </span>owner<span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>


<span class="c1">// Use `is` to derive from another contract. Derived</span>
<span class="c1">// contracts can access all non-private members including</span>
<span class="c1">// internal functions and state variables. These cannot be</span>
<span class="c1">// accessed externally via `this`, though.</span>
<span class="k">contract</span><span class="w"> </span><span class="ni">Destructible</span><span class="w"> </span><span class="kt">is</span><span class="w"> </span>Owned<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// The keyword `virtual` means that the function can change</span>
<span class="w">    </span><span class="c1">// its behaviour in derived classes (&quot;overriding&quot;).</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">destroy</span><span class="p">()</span><span class="w"> </span>virtual<span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span><span class="k">msg.sender</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>owner<span class="p">)</span><span class="w"> </span>selfdestruct<span class="p">(</span>owner<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>


<span class="c1">// These abstract contracts are only provided to make the</span>
<span class="c1">// interface known to the compiler. Note the function</span>
<span class="c1">// without body. If a contract does not implement all</span>
<span class="c1">// functions it can only be used as an interface.</span>
abstract<span class="w"> </span><span class="k">contract</span><span class="w"> </span><span class="ni">Config</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">lookup</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">id</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>virtual<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">adr</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>


abstract<span class="w"> </span><span class="k">contract</span><span class="w"> </span><span class="ni">NameReg</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">register</span><span class="p">(</span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">name</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>virtual<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">unregister</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>virtual<span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>


<span class="c1">// Multiple inheritance is possible. Note that `Owned` is</span>
<span class="c1">// also a base class of `Destructible`, yet there is only a single</span>
<span class="c1">// instance of `Owned` (as for virtual inheritance in C++).</span>
<span class="k">contract</span><span class="w"> </span><span class="ni">Named</span><span class="w"> </span><span class="kt">is</span><span class="w"> </span>Owned<span class="p">,</span><span class="w"> </span>Destructible<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">constructor</span><span class="p">(</span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>Config<span class="w"> </span>config<span class="w"> </span><span class="o">=</span><span class="w"> </span>Config<span class="p">(</span><span class="mh">0xD5f9D8D94886E70b06E474c3fB14Fd43E2f23970</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span>NameReg<span class="p">(</span>config<span class="p">.</span>lookup<span class="p">(</span><span class="m m-Decimal">1</span><span class="p">)).</span>register<span class="p">(</span>name<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Functions can be overridden by another function with the same name and</span>
<span class="w">    </span><span class="c1">// the same number/types of inputs.  If the overriding function has different</span>
<span class="w">    </span><span class="c1">// types of output parameters, that causes an error.</span>
<span class="w">    </span><span class="c1">// Both local and message-based function calls take these overrides</span>
<span class="w">    </span><span class="c1">// into account.</span>
<span class="w">    </span><span class="c1">// If you want the function to override, you need to use the</span>
<span class="w">    </span><span class="c1">// `override` keyword. You need to specify the `virtual` keyword again</span>
<span class="w">    </span><span class="c1">// if you want this function to be overridden again.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">destroy</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>virtual<span class="w"> </span>override<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span><span class="k">msg.sender</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>owner<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span>Config<span class="w"> </span>config<span class="w"> </span><span class="o">=</span><span class="w"> </span>Config<span class="p">(</span><span class="mh">0xD5f9D8D94886E70b06E474c3fB14Fd43E2f23970</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span>NameReg<span class="p">(</span>config<span class="p">.</span>lookup<span class="p">(</span><span class="m m-Decimal">1</span><span class="p">)).</span>unregister<span class="p">();</span><span class="w"></span>
<span class="w">            </span><span class="c1">// It is still possible to call a specific</span>
<span class="w">            </span><span class="c1">// overridden function.</span>
<span class="w">            </span>Destructible<span class="p">.</span>destroy<span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>


<span class="c1">// If a constructor takes an argument, it needs to be</span>
<span class="c1">// provided in the header or modifier-invocation-style at</span>
<span class="c1">// the constructor of the derived contract (see below).</span>
<span class="k">contract</span><span class="w"> </span><span class="ni">PriceFeed</span><span class="w"> </span><span class="kt">is</span><span class="w"> </span>Owned<span class="p">,</span><span class="w"> </span>Destructible<span class="p">,</span><span class="w"> </span>Named<span class="p">(</span><span class="s2">&quot;GoldFeed&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">updateInfo</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">newInfo</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span><span class="k">msg.sender</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>owner<span class="p">)</span><span class="w"> </span>info<span class="w"> </span><span class="o">=</span><span class="w"> </span>newInfo<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Here, we only specify `override` and not `virtual`.</span>
<span class="w">    </span><span class="c1">// This means that contracts deriving from `PriceFeed`</span>
<span class="w">    </span><span class="c1">// cannot change the behaviour of `destroy` anymore.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">destroy</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>override<span class="p">(</span>Destructible<span class="p">,</span><span class="w"> </span>Named<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>Named<span class="p">.</span>destroy<span class="p">();</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">get</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kt">return</span><span class="w"> </span>info<span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="nv">info</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Note that above, we call <code class="docutils literal notranslate"><span class="pre">Destructible.destroy()</span></code> to ‚Äúforward‚Äù the
destruction request. The way this is done is problematic, as
seen in the following example:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC43LjAgPDAuOS4wOwoKY29udHJhY3Qgb3duZWQgewogICAgY29uc3RydWN0b3IoKSB7IG93bmVyID0gcGF5YWJsZShtc2cuc2VuZGVyKTsgfQogICAgYWRkcmVzcyBwYXlhYmxlIG93bmVyOwp9Cgpjb250cmFjdCBEZXN0cnVjdGlibGUgaXMgb3duZWQgewogICAgZnVuY3Rpb24gZGVzdHJveSgpIHB1YmxpYyB2aXJ0dWFsIHsKICAgICAgICBpZiAobXNnLnNlbmRlciA9PSBvd25lcikgc2VsZmRlc3RydWN0KG93bmVyKTsKICAgIH0KfQoKY29udHJhY3QgQmFzZTEgaXMgRGVzdHJ1Y3RpYmxlIHsKICAgIGZ1bmN0aW9uIGRlc3Ryb3koKSBwdWJsaWMgdmlydHVhbCBvdmVycmlkZSB7IC8qIGRvIGNsZWFudXAgMSAqLyBEZXN0cnVjdGlibGUuZGVzdHJveSgpOyB9Cn0KCmNvbnRyYWN0IEJhc2UyIGlzIERlc3RydWN0aWJsZSB7CiAgICBmdW5jdGlvbiBkZXN0cm95KCkgcHVibGljIHZpcnR1YWwgb3ZlcnJpZGUgeyAvKiBkbyBjbGVhbnVwIDIgKi8gRGVzdHJ1Y3RpYmxlLmRlc3Ryb3koKTsgfQp9Cgpjb250cmFjdCBGaW5hbCBpcyBCYXNlMSwgQmFzZTIgewogICAgZnVuY3Rpb24gZGVzdHJveSgpIHB1YmxpYyBvdmVycmlkZShCYXNlMSwgQmFzZTIpIHsgQmFzZTIuZGVzdHJveSgpOyB9Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.7.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">owned</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>owner<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">payable</span><span class="p">(</span><span class="k">msg.sender</span><span class="p">);</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">payable</span><span class="w"> </span>owner<span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Destructible</span><span class="w"> </span><span class="kt">is</span><span class="w"> </span>owned<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">destroy</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>virtual<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span><span class="k">msg.sender</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>owner<span class="p">)</span><span class="w"> </span>selfdestruct<span class="p">(</span>owner<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Base1</span><span class="w"> </span><span class="kt">is</span><span class="w"> </span>Destructible<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">destroy</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>virtual<span class="w"> </span>override<span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* do cleanup 1 */</span><span class="w"> </span>Destructible<span class="p">.</span>destroy<span class="p">();</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Base2</span><span class="w"> </span><span class="kt">is</span><span class="w"> </span>Destructible<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">destroy</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>virtual<span class="w"> </span>override<span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* do cleanup 2 */</span><span class="w"> </span>Destructible<span class="p">.</span>destroy<span class="p">();</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Final</span><span class="w"> </span><span class="kt">is</span><span class="w"> </span>Base1<span class="p">,</span><span class="w"> </span>Base2<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">destroy</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>override<span class="p">(</span>Base1<span class="p">,</span><span class="w"> </span>Base2<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>Base2<span class="p">.</span>destroy<span class="p">();</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>A call to <code class="docutils literal notranslate"><span class="pre">Final.destroy()</span></code> will call <code class="docutils literal notranslate"><span class="pre">Base2.destroy</span></code> because we specify it
explicitly in the final override, but this function will bypass
<code class="docutils literal notranslate"><span class="pre">Base1.destroy</span></code>. The way around this is to use <code class="docutils literal notranslate"><span class="pre">super</span></code>:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC43LjAgPDAuOS4wOwoKY29udHJhY3Qgb3duZWQgewogICAgY29uc3RydWN0b3IoKSB7IG93bmVyID0gcGF5YWJsZShtc2cuc2VuZGVyKTsgfQogICAgYWRkcmVzcyBwYXlhYmxlIG93bmVyOwp9Cgpjb250cmFjdCBEZXN0cnVjdGlibGUgaXMgb3duZWQgewogICAgZnVuY3Rpb24gZGVzdHJveSgpIHZpcnR1YWwgcHVibGljIHsKICAgICAgICBpZiAobXNnLnNlbmRlciA9PSBvd25lcikgc2VsZmRlc3RydWN0KG93bmVyKTsKICAgIH0KfQoKY29udHJhY3QgQmFzZTEgaXMgRGVzdHJ1Y3RpYmxlIHsKICAgIGZ1bmN0aW9uIGRlc3Ryb3koKSBwdWJsaWMgdmlydHVhbCBvdmVycmlkZSB7IC8qIGRvIGNsZWFudXAgMSAqLyBzdXBlci5kZXN0cm95KCk7IH0KfQoKCmNvbnRyYWN0IEJhc2UyIGlzIERlc3RydWN0aWJsZSB7CiAgICBmdW5jdGlvbiBkZXN0cm95KCkgcHVibGljIHZpcnR1YWwgb3ZlcnJpZGUgeyAvKiBkbyBjbGVhbnVwIDIgKi8gc3VwZXIuZGVzdHJveSgpOyB9Cn0KCmNvbnRyYWN0IEZpbmFsIGlzIEJhc2UxLCBCYXNlMiB7CiAgICBmdW5jdGlvbiBkZXN0cm95KCkgcHVibGljIG92ZXJyaWRlKEJhc2UxLCBCYXNlMikgeyBzdXBlci5kZXN0cm95KCk7IH0KfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.7.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">owned</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>owner<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">payable</span><span class="p">(</span><span class="k">msg.sender</span><span class="p">);</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">payable</span><span class="w"> </span>owner<span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Destructible</span><span class="w"> </span><span class="kt">is</span><span class="w"> </span>owned<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">destroy</span><span class="p">()</span><span class="w"> </span>virtual<span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span><span class="k">msg.sender</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>owner<span class="p">)</span><span class="w"> </span>selfdestruct<span class="p">(</span>owner<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Base1</span><span class="w"> </span><span class="kt">is</span><span class="w"> </span>Destructible<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">destroy</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>virtual<span class="w"> </span>override<span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* do cleanup 1 */</span><span class="w"> </span>super<span class="p">.</span>destroy<span class="p">();</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>


<span class="k">contract</span><span class="w"> </span><span class="ni">Base2</span><span class="w"> </span><span class="kt">is</span><span class="w"> </span>Destructible<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">destroy</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>virtual<span class="w"> </span>override<span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* do cleanup 2 */</span><span class="w"> </span>super<span class="p">.</span>destroy<span class="p">();</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Final</span><span class="w"> </span><span class="kt">is</span><span class="w"> </span>Base1<span class="p">,</span><span class="w"> </span>Base2<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">destroy</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>override<span class="p">(</span>Base1<span class="p">,</span><span class="w"> </span>Base2<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>super<span class="p">.</span>destroy<span class="p">();</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">Base2</span></code> calls a function of <code class="docutils literal notranslate"><span class="pre">super</span></code>, it does not simply
call this function on one of its base contracts.  Rather, it
calls this function on the next base contract in the final
inheritance graph, so it will call <code class="docutils literal notranslate"><span class="pre">Base1.destroy()</span></code> (note that
the final inheritance sequence is ‚Äì starting with the most
derived contract: Final, Base2, Base1, Destructible, owned).
The actual function that is called when using super is
not known in the context of the class where it is used,
although its type is known. This is similar for ordinary
virtual method lookup.</p>
<section id="function-overriding">
<span id="index-18"></span><span id="id12"></span><h4>Function Overriding<a class="headerlink" href="#function-overriding" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Base functions can be overridden by inheriting contracts to change their
behavior if they are marked as <code class="docutils literal notranslate"><span class="pre">virtual</span></code>. The overriding function must then
use the <code class="docutils literal notranslate"><span class="pre">override</span></code> keyword in the function header.
The overriding function may only change the visibility of the overridden function from <code class="docutils literal notranslate"><span class="pre">external</span></code> to <code class="docutils literal notranslate"><span class="pre">public</span></code>.
The mutability may be changed to a more strict one following the order:
<code class="docutils literal notranslate"><span class="pre">nonpayable</span></code> can be overridden by <code class="docutils literal notranslate"><span class="pre">view</span></code> and <code class="docutils literal notranslate"><span class="pre">pure</span></code>. <code class="docutils literal notranslate"><span class="pre">view</span></code> can be overridden by <code class="docutils literal notranslate"><span class="pre">pure</span></code>.
<code class="docutils literal notranslate"><span class="pre">payable</span></code> is an exception and cannot be changed to any other mutability.</p>
<p>The following example demonstrates changing mutability and visibility:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC43LjAgPDAuOS4wOwoKY29udHJhY3QgQmFzZQp7CiAgICBmdW5jdGlvbiBmb28oKSB2aXJ0dWFsIGV4dGVybmFsIHZpZXcge30KfQoKY29udHJhY3QgTWlkZGxlIGlzIEJhc2Uge30KCmNvbnRyYWN0IEluaGVyaXRlZCBpcyBNaWRkbGUKewogICAgZnVuY3Rpb24gZm9vKCkgb3ZlcnJpZGUgcHVibGljIHB1cmUge30KfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.7.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Base</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">foo</span><span class="p">()</span><span class="w"> </span>virtual<span class="w"> </span><span class="kt">external</span><span class="w"> </span>view<span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Middle</span><span class="w"> </span><span class="kt">is</span><span class="w"> </span>Base<span class="w"> </span><span class="p">{}</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Inherited</span><span class="w"> </span><span class="kt">is</span><span class="w"> </span>Middle<span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">foo</span><span class="p">()</span><span class="w"> </span>override<span class="w"> </span><span class="kt">public</span><span class="w"> </span>pure<span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>For multiple inheritance, the most derived base contracts that define the same
function must be specified explicitly after the <code class="docutils literal notranslate"><span class="pre">override</span></code> keyword.
In other words, you have to specify all base contracts that define the same function
and have not yet been overridden by another base contract (on some path through the inheritance graph).
Additionally, if a contract inherits the same function from multiple (unrelated)
bases, it has to explicitly override it:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC42LjAgPDAuOS4wOwoKY29udHJhY3QgQmFzZTEKewogICAgZnVuY3Rpb24gZm9vKCkgdmlydHVhbCBwdWJsaWMge30KfQoKY29udHJhY3QgQmFzZTIKewogICAgZnVuY3Rpb24gZm9vKCkgdmlydHVhbCBwdWJsaWMge30KfQoKY29udHJhY3QgSW5oZXJpdGVkIGlzIEJhc2UxLCBCYXNlMgp7CiAgICAvLyBEZXJpdmVzIGZyb20gbXVsdGlwbGUgYmFzZXMgZGVmaW5pbmcgZm9vKCksIHNvIHdlIG11c3QgZXhwbGljaXRseQogICAgLy8gb3ZlcnJpZGUgaXQKICAgIGZ1bmN0aW9uIGZvbygpIHB1YmxpYyBvdmVycmlkZShCYXNlMSwgQmFzZTIpIHt9Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.6.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Base1</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">foo</span><span class="p">()</span><span class="w"> </span>virtual<span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Base2</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">foo</span><span class="p">()</span><span class="w"> </span>virtual<span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Inherited</span><span class="w"> </span><span class="kt">is</span><span class="w"> </span>Base1<span class="p">,</span><span class="w"> </span>Base2<span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Derives from multiple bases defining foo(), so we must explicitly</span>
<span class="w">    </span><span class="c1">// override it</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">foo</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>override<span class="p">(</span>Base1<span class="p">,</span><span class="w"> </span>Base2<span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>An explicit override specifier is not required if
the function is defined in a common base contract
or if there is a unique function in a common base contract
that already overrides all other functions.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC42LjAgPDAuOS4wOwoKY29udHJhY3QgQSB7IGZ1bmN0aW9uIGYoKSBwdWJsaWMgcHVyZXt9IH0KY29udHJhY3QgQiBpcyBBIHt9CmNvbnRyYWN0IEMgaXMgQSB7fQovLyBObyBleHBsaWNpdCBvdmVycmlkZSByZXF1aXJlZApjb250cmFjdCBEIGlzIEIsIEMge30="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.6.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">A</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kt">function</span><span class="w"> </span><span class="nv">f</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>pure<span class="p">{}</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="k">contract</span><span class="w"> </span><span class="ni">B</span><span class="w"> </span><span class="kt">is</span><span class="w"> </span>A<span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="k">contract</span><span class="w"> </span><span class="ni">C</span><span class="w"> </span><span class="kt">is</span><span class="w"> </span>A<span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="c1">// No explicit override required</span>
<span class="k">contract</span><span class="w"> </span><span class="ni">D</span><span class="w"> </span><span class="kt">is</span><span class="w"> </span>B<span class="p">,</span><span class="w"> </span>C<span class="w"> </span><span class="p">{}</span><span class="w"></span>
</pre></div>
</div>
<p>More formally, it is not required to override a function (directly or
indirectly) inherited from multiple bases if there is a base contract
that is part of all override paths for the signature, and (1) that
base implements the function and no paths from the current contract
to the base mentions a function with that signature or (2) that base
does not implement the function and there is at most one mention of
the function in all paths from the current contract to that base.</p>
<p>In this sense, an override path for a signature is a path through
the inheritance graph that starts at the contract under consideration
and ends at a contract mentioning a function with that signature
that does not override.</p>
<p>If you do not mark a function that overrides as <code class="docutils literal notranslate"><span class="pre">virtual</span></code>, derived
contracts can no longer change the behaviour of that function.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Functions with the <code class="docutils literal notranslate"><span class="pre">private</span></code> visibility cannot be <code class="docutils literal notranslate"><span class="pre">virtual</span></code>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Functions without implementation have to be marked <code class="docutils literal notranslate"><span class="pre">virtual</span></code>
outside of interfaces. In interfaces, all functions are
automatically considered <code class="docutils literal notranslate"><span class="pre">virtual</span></code>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Starting from Solidity 0.8.8, the <code class="docutils literal notranslate"><span class="pre">override</span></code> keyword is not
required when overriding an interface function, except for the
case where the function is defined in multiple bases.</p>
</div>
<p>Public state variables can override external functions if the
parameter and return types of the function matches the getter function
of the variable:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC42LjAgPDAuOS4wOwoKY29udHJhY3QgQQp7CiAgICBmdW5jdGlvbiBmKCkgZXh0ZXJuYWwgdmlldyB2aXJ0dWFsIHJldHVybnModWludCkgeyByZXR1cm4gNTsgfQp9Cgpjb250cmFjdCBCIGlzIEEKewogICAgdWludCBwdWJsaWMgb3ZlcnJpZGUgZjsKfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.6.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">A</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">f</span><span class="p">()</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>view<span class="w"> </span>virtual<span class="w"> </span><span class="kt">returns</span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kt">return</span><span class="w"> </span><span class="m m-Decimal">5</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">B</span><span class="w"> </span><span class="kt">is</span><span class="w"> </span>A<span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="k">public </span><span class="nv">override</span><span class="w"> </span>f<span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>While public state variables can override external functions, they themselves cannot
be overridden.</p>
</div>
</section>
<section id="modifier-overriding">
<span id="index-19"></span><span id="id13"></span><h4>Modifier Overriding<a class="headerlink" href="#modifier-overriding" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Function modifiers can override each other. This works in the same way as
<a class="reference internal" href="#function-overriding"><span class="std std-ref">function overriding</span></a> (except that there is no overloading for modifiers). The
<code class="docutils literal notranslate"><span class="pre">virtual</span></code> keyword must be used on the overridden modifier
and the <code class="docutils literal notranslate"><span class="pre">override</span></code> keyword must be used in the overriding modifier:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC42LjAgPDAuOS4wOwoKY29udHJhY3QgQmFzZQp7CiAgICBtb2RpZmllciBmb28oKSB2aXJ0dWFsIHtfO30KfQoKY29udHJhY3QgSW5oZXJpdGVkIGlzIEJhc2UKewogICAgbW9kaWZpZXIgZm9vKCkgb3ZlcnJpZGUge187fQp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.6.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Base</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">modifier</span><span class="w"> </span>foo<span class="p">()</span><span class="w"> </span>virtual<span class="w"> </span><span class="p">{</span>_<span class="p">;}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Inherited</span><span class="w"> </span><span class="kt">is</span><span class="w"> </span>Base<span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">modifier</span><span class="w"> </span>foo<span class="p">()</span><span class="w"> </span>override<span class="w"> </span><span class="p">{</span>_<span class="p">;}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>In case of multiple inheritance, all direct base contracts must be specified
explicitly:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC42LjAgPDAuOS4wOwoKY29udHJhY3QgQmFzZTEKewogICAgbW9kaWZpZXIgZm9vKCkgdmlydHVhbCB7Xzt9Cn0KCmNvbnRyYWN0IEJhc2UyCnsKICAgIG1vZGlmaWVyIGZvbygpIHZpcnR1YWwge187fQp9Cgpjb250cmFjdCBJbmhlcml0ZWQgaXMgQmFzZTEsIEJhc2UyCnsKICAgIG1vZGlmaWVyIGZvbygpIG92ZXJyaWRlKEJhc2UxLCBCYXNlMikge187fQp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.6.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Base1</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">modifier</span><span class="w"> </span>foo<span class="p">()</span><span class="w"> </span>virtual<span class="w"> </span><span class="p">{</span>_<span class="p">;}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Base2</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">modifier</span><span class="w"> </span>foo<span class="p">()</span><span class="w"> </span>virtual<span class="w"> </span><span class="p">{</span>_<span class="p">;}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Inherited</span><span class="w"> </span><span class="kt">is</span><span class="w"> </span>Base1<span class="p">,</span><span class="w"> </span>Base2<span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">modifier</span><span class="w"> </span>foo<span class="p">()</span><span class="w"> </span>override<span class="p">(</span>Base1<span class="p">,</span><span class="w"> </span>Base2<span class="p">)</span><span class="w"> </span><span class="p">{</span>_<span class="p">;}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="constructors">
<span id="constructor"></span><span id="index-20"></span><h4>Constructors<a class="headerlink" href="#constructors" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>A constructor is an optional function declared with the <code class="docutils literal notranslate"><span class="pre">constructor</span></code> keyword
which is executed upon contract creation, and where you can run contract
initialisation code.</p>
<p>Before the constructor code is executed, state variables are initialised to
their specified value if you initialise them inline, or their <a class="reference internal" href="index.html#default-value"><span class="std std-ref">default value</span></a> if you do not.</p>
<p>After the constructor has run, the final code of the contract is deployed
to the blockchain. The deployment of
the code costs additional gas linear to the length of the code.
This code includes all functions that are part of the public interface
and all functions that are reachable from there through function calls.
It does not include the constructor code or internal functions that are
only called from the constructor.</p>
<p>If there is no
constructor, the contract will assume the default constructor, which is
equivalent to <code class="docutils literal notranslate"><span class="pre">constructor()</span> <span class="pre">{}</span></code>. For example:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC43LjAgPDAuOS4wOwoKYWJzdHJhY3QgY29udHJhY3QgQSB7CiAgICB1aW50IHB1YmxpYyBhOwoKICAgIGNvbnN0cnVjdG9yKHVpbnQgYV8pIHsKICAgICAgICBhID0gYV87CiAgICB9Cn0KCmNvbnRyYWN0IEIgaXMgQSgxKSB7CiAgICBjb25zdHJ1Y3RvcigpIHt9Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.7.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

abstract<span class="w"> </span><span class="k">contract</span><span class="w"> </span><span class="ni">A</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="k">public </span><span class="nv">a</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kt">constructor</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">a_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>a<span class="w"> </span><span class="o">=</span><span class="w"> </span>a_<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">B</span><span class="w"> </span><span class="kt">is</span><span class="w"> </span>A<span class="p">(</span><span class="m m-Decimal">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>You can use internal parameters in a constructor (for example storage pointers). In this case,
the contract has to be marked <a class="reference internal" href="#abstract-contract"><span class="std std-ref">abstract</span></a>, because these parameters
cannot be assigned valid values from outside but only through the constructors of derived contracts.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Prior to version 0.4.22, constructors were defined as functions with the same name as the contract.
This syntax was deprecated and is not allowed anymore in version 0.5.0.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Prior to version 0.7.0, you had to specify the visibility of constructors as either
<code class="docutils literal notranslate"><span class="pre">internal</span></code> or <code class="docutils literal notranslate"><span class="pre">public</span></code>.</p>
</div>
</section>
<section id="arguments-for-base-constructors">
<span id="index-21"></span><h4>Arguments for Base Constructors<a class="headerlink" href="#arguments-for-base-constructors" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>The constructors of all the base contracts will be called following the
linearization rules explained below. If the base constructors have arguments,
derived contracts need to specify all of them. This can be done in two ways:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC43LjAgPDAuOS4wOwoKY29udHJhY3QgQmFzZSB7CiAgICB1aW50IHg7CiAgICBjb25zdHJ1Y3Rvcih1aW50IHhfKSB7IHggPSB4XzsgfQp9CgovLyBFaXRoZXIgZGlyZWN0bHkgc3BlY2lmeSBpbiB0aGUgaW5oZXJpdGFuY2UgbGlzdC4uLgpjb250cmFjdCBEZXJpdmVkMSBpcyBCYXNlKDcpIHsKICAgIGNvbnN0cnVjdG9yKCkge30KfQoKLy8gb3IgdGhyb3VnaCBhICJtb2RpZmllciIgb2YgdGhlIGRlcml2ZWQgY29uc3RydWN0b3IuLi4KY29udHJhY3QgRGVyaXZlZDIgaXMgQmFzZSB7CiAgICBjb25zdHJ1Y3Rvcih1aW50IHkpIEJhc2UoeSAqIHkpIHt9Cn0KCi8vIG9yIGRlY2xhcmUgYWJzdHJhY3QuLi4KYWJzdHJhY3QgY29udHJhY3QgRGVyaXZlZDMgaXMgQmFzZSB7Cn0KCi8vIGFuZCBoYXZlIHRoZSBuZXh0IGNvbmNyZXRlIGRlcml2ZWQgY29udHJhY3QgaW5pdGlhbGl6ZSBpdC4KY29udHJhY3QgRGVyaXZlZEZyb21EZXJpdmVkIGlzIERlcml2ZWQzIHsKICAgIGNvbnN0cnVjdG9yKCkgQmFzZSgxMCArIDEwKSB7fQp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.7.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Base</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="nv">x</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">constructor</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">x_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>x<span class="w"> </span><span class="o">=</span><span class="w"> </span>x_<span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// Either directly specify in the inheritance list...</span>
<span class="k">contract</span><span class="w"> </span><span class="ni">Derived1</span><span class="w"> </span><span class="kt">is</span><span class="w"> </span>Base<span class="p">(</span><span class="m m-Decimal">7</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// or through a &quot;modifier&quot; of the derived constructor...</span>
<span class="k">contract</span><span class="w"> </span><span class="ni">Derived2</span><span class="w"> </span><span class="kt">is</span><span class="w"> </span>Base<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">constructor</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">y</span><span class="p">)</span><span class="w"> </span>Base<span class="p">(</span>y<span class="w"> </span><span class="o">*</span><span class="w"> </span>y<span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// or declare abstract...</span>
abstract<span class="w"> </span><span class="k">contract</span><span class="w"> </span><span class="ni">Derived3</span><span class="w"> </span><span class="kt">is</span><span class="w"> </span>Base<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// and have the next concrete derived contract initialize it.</span>
<span class="k">contract</span><span class="w"> </span><span class="ni">DerivedFromDerived</span><span class="w"> </span><span class="kt">is</span><span class="w"> </span>Derived3<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">constructor</span><span class="p">()</span><span class="w"> </span>Base<span class="p">(</span><span class="m m-Decimal">10</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m m-Decimal">10</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>One way is directly in the inheritance list (<code class="docutils literal notranslate"><span class="pre">is</span> <span class="pre">Base(7)</span></code>).  The other is in
the way a modifier is invoked as part of
the derived constructor (<code class="docutils literal notranslate"><span class="pre">Base(y</span> <span class="pre">*</span> <span class="pre">y)</span></code>). The first way to
do it is more convenient if the constructor argument is a
constant and defines the behaviour of the contract or
describes it. The second way has to be used if the
constructor arguments of the base depend on those of the
derived contract. Arguments have to be given either in the
inheritance list or in modifier-style in the derived constructor.
Specifying arguments in both places is an error.</p>
<p>If a derived contract does not specify the arguments to all of its base
contracts‚Äô constructors, it must be declared abstract. In that case, when
another contract derives from it, that other contract‚Äôs inheritance list
or constructor must provide the necessary parameters
for all base classes that haven‚Äôt had their parameters specified (otherwise,
that other contract must be declared abstract as well). For example, in the above
code snippet, see <code class="docutils literal notranslate"><span class="pre">Derived3</span></code> and <code class="docutils literal notranslate"><span class="pre">DerivedFromDerived</span></code>.</p>
</section>
<section id="multiple-inheritance-and-linearization">
<span id="multi-inheritance"></span><span id="index-22"></span><h4>Multiple Inheritance and Linearization<a class="headerlink" href="#multiple-inheritance-and-linearization" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Languages that allow multiple inheritance have to deal with
several problems.  One is the <a class="reference external" href="https://en.wikipedia.org/wiki/Multiple_inheritance#The_diamond_problem">Diamond Problem</a>.
Solidity is similar to Python in that it uses ‚Äú<a class="reference external" href="https://en.wikipedia.org/wiki/C3_linearization">C3 Linearization</a>‚Äù
to force a specific order in the directed acyclic graph (DAG) of base classes. This
results in the desirable property of monotonicity but
disallows some inheritance graphs. Especially, the order in
which the base classes are given in the <code class="docutils literal notranslate"><span class="pre">is</span></code> directive is
important: You have to list the direct base contracts
in the order from ‚Äúmost base-like‚Äù to ‚Äúmost derived‚Äù.
Note that this order is the reverse of the one used in Python.</p>
<p>Another simplifying way to explain this is that when a function is called that
is defined multiple times in different contracts, the given bases
are searched from right to left (left to right in Python) in a depth-first manner,
stopping at the first match. If a base contract has already been searched, it is skipped.</p>
<p>In the following code, Solidity will give the
error ‚ÄúLinearization of inheritance graph impossible‚Äù.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC40LjAgPDAuOS4wOwoKY29udHJhY3QgWCB7fQpjb250cmFjdCBBIGlzIFgge30KLy8gVGhpcyB3aWxsIG5vdCBjb21waWxlCmNvbnRyYWN0IEMgaXMgQSwgWCB7fQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.4.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">X</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="k">contract</span><span class="w"> </span><span class="ni">A</span><span class="w"> </span><span class="kt">is</span><span class="w"> </span>X<span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="c1">// This will not compile</span>
<span class="k">contract</span><span class="w"> </span><span class="ni">C</span><span class="w"> </span><span class="kt">is</span><span class="w"> </span>A<span class="p">,</span><span class="w"> </span>X<span class="w"> </span><span class="p">{}</span><span class="w"></span>
</pre></div>
</div>
<p>The reason for this is that <code class="docutils literal notranslate"><span class="pre">C</span></code> requests <code class="docutils literal notranslate"><span class="pre">X</span></code> to override <code class="docutils literal notranslate"><span class="pre">A</span></code>
(by specifying <code class="docutils literal notranslate"><span class="pre">A,</span> <span class="pre">X</span></code> in this order), but <code class="docutils literal notranslate"><span class="pre">A</span></code> itself
requests to override <code class="docutils literal notranslate"><span class="pre">X</span></code>, which is a contradiction that
cannot be resolved.</p>
<p>Due to the fact that you have to explicitly override a function
that is inherited from multiple bases without a unique override,
C3 linearization is not too important in practice.</p>
<p>One area where inheritance linearization is especially important and perhaps not as clear is when there are multiple constructors in the inheritance hierarchy. The constructors will always be executed in the linearized order, regardless of the order in which their arguments are provided in the inheriting contract‚Äôs constructor.  For example:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC43LjAgPDAuOS4wOwoKY29udHJhY3QgQmFzZTEgewogICAgY29uc3RydWN0b3IoKSB7fQp9Cgpjb250cmFjdCBCYXNlMiB7CiAgICBjb25zdHJ1Y3RvcigpIHt9Cn0KCi8vIENvbnN0cnVjdG9ycyBhcmUgZXhlY3V0ZWQgaW4gdGhlIGZvbGxvd2luZyBvcmRlcjoKLy8gIDEgLSBCYXNlMQovLyAgMiAtIEJhc2UyCi8vICAzIC0gRGVyaXZlZDEKY29udHJhY3QgRGVyaXZlZDEgaXMgQmFzZTEsIEJhc2UyIHsKICAgIGNvbnN0cnVjdG9yKCkgQmFzZTEoKSBCYXNlMigpIHt9Cn0KCi8vIENvbnN0cnVjdG9ycyBhcmUgZXhlY3V0ZWQgaW4gdGhlIGZvbGxvd2luZyBvcmRlcjoKLy8gIDEgLSBCYXNlMgovLyAgMiAtIEJhc2UxCi8vICAzIC0gRGVyaXZlZDIKY29udHJhY3QgRGVyaXZlZDIgaXMgQmFzZTIsIEJhc2UxIHsKICAgIGNvbnN0cnVjdG9yKCkgQmFzZTIoKSBCYXNlMSgpIHt9Cn0KCi8vIENvbnN0cnVjdG9ycyBhcmUgc3RpbGwgZXhlY3V0ZWQgaW4gdGhlIGZvbGxvd2luZyBvcmRlcjoKLy8gIDEgLSBCYXNlMgovLyAgMiAtIEJhc2UxCi8vICAzIC0gRGVyaXZlZDMKY29udHJhY3QgRGVyaXZlZDMgaXMgQmFzZTIsIEJhc2UxIHsKICAgIGNvbnN0cnVjdG9yKCkgQmFzZTEoKSBCYXNlMigpIHt9Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.7.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Base1</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Base2</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// Constructors are executed in the following order:</span>
<span class="c1">//  1 - Base1</span>
<span class="c1">//  2 - Base2</span>
<span class="c1">//  3 - Derived1</span>
<span class="k">contract</span><span class="w"> </span><span class="ni">Derived1</span><span class="w"> </span><span class="kt">is</span><span class="w"> </span>Base1<span class="p">,</span><span class="w"> </span>Base2<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">constructor</span><span class="p">()</span><span class="w"> </span>Base1<span class="p">()</span><span class="w"> </span>Base2<span class="p">()</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// Constructors are executed in the following order:</span>
<span class="c1">//  1 - Base2</span>
<span class="c1">//  2 - Base1</span>
<span class="c1">//  3 - Derived2</span>
<span class="k">contract</span><span class="w"> </span><span class="ni">Derived2</span><span class="w"> </span><span class="kt">is</span><span class="w"> </span>Base2<span class="p">,</span><span class="w"> </span>Base1<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">constructor</span><span class="p">()</span><span class="w"> </span>Base2<span class="p">()</span><span class="w"> </span>Base1<span class="p">()</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// Constructors are still executed in the following order:</span>
<span class="c1">//  1 - Base2</span>
<span class="c1">//  2 - Base1</span>
<span class="c1">//  3 - Derived3</span>
<span class="k">contract</span><span class="w"> </span><span class="ni">Derived3</span><span class="w"> </span><span class="kt">is</span><span class="w"> </span>Base2<span class="p">,</span><span class="w"> </span>Base1<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">constructor</span><span class="p">()</span><span class="w"> </span>Base1<span class="p">()</span><span class="w"> </span>Base2<span class="p">()</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="inheriting-different-kinds-of-members-of-the-same-name">
<h4>Inheriting Different Kinds of Members of the Same Name<a class="headerlink" href="#inheriting-different-kinds-of-members-of-the-same-name" title="Permalink to this heading">ÔÉÅ</a></h4>
<dl class="simple">
<dt>It is an error when any of the following pairs in a contract have the same name due to inheritance:</dt><dd><ul class="simple">
<li><p>a function and a modifier</p></li>
<li><p>a function and an event</p></li>
<li><p>an event and a modifier</p></li>
</ul>
</dd>
</dl>
<p>As an exception, a state variable getter can override an external function.</p>
</section>
</section>
<section id="abstract-contracts">
<span id="abstract-contract"></span><span id="index-23"></span><h3>Abstract Contracts<a class="headerlink" href="#abstract-contracts" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Contracts must be marked as abstract when at least one of their functions is not implemented or when
they do not provide arguments for all of their base contract constructors.
Even if this is not the case, a contract may still be marked abstract, such as when you do not intend
for the contract to be created directly. Abstract contracts are similar to <a class="reference internal" href="#interfaces"><span class="std std-ref">Interfaces</span></a> but an
interface is more limited in what it can declare.</p>
<p>An abstract contract is declared using the <code class="docutils literal notranslate"><span class="pre">abstract</span></code> keyword as shown in the following example.
Note that this contract needs to be defined as abstract, because the function <code class="docutils literal notranslate"><span class="pre">utterance()</span></code> is declared,
but no implementation was provided (no implementation body <code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">}</span></code> was given).</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC42LjAgPDAuOS4wOwoKYWJzdHJhY3QgY29udHJhY3QgRmVsaW5lIHsKICAgIGZ1bmN0aW9uIHV0dGVyYW5jZSgpIHB1YmxpYyB2aXJ0dWFsIHJldHVybnMgKGJ5dGVzMzIpOwp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.6.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

abstract<span class="w"> </span><span class="k">contract</span><span class="w"> </span><span class="ni">Feline</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">utterance</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>virtual<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bytes32</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Such abstract contracts can not be instantiated directly. This is also true, if an abstract contract itself does implement
all defined functions. The usage of an abstract contract as a base class is shown in the following example:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC42LjAgPDAuOS4wOwoKYWJzdHJhY3QgY29udHJhY3QgRmVsaW5lIHsKICAgIGZ1bmN0aW9uIHV0dGVyYW5jZSgpIHB1YmxpYyBwdXJlIHZpcnR1YWwgcmV0dXJucyAoYnl0ZXMzMik7Cn0KCmNvbnRyYWN0IENhdCBpcyBGZWxpbmUgewogICAgZnVuY3Rpb24gdXR0ZXJhbmNlKCkgcHVibGljIHB1cmUgb3ZlcnJpZGUgcmV0dXJucyAoYnl0ZXMzMikgeyByZXR1cm4gIm1pYW93IjsgfQp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.6.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

abstract<span class="w"> </span><span class="k">contract</span><span class="w"> </span><span class="ni">Feline</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">utterance</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>pure<span class="w"> </span>virtual<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bytes32</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Cat</span><span class="w"> </span><span class="kt">is</span><span class="w"> </span>Feline<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">utterance</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>pure<span class="w"> </span>override<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bytes32</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kt">return</span><span class="w"> </span><span class="s2">&quot;miaow&quot;</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>If a contract inherits from an abstract contract and does not implement all non-implemented
functions by overriding, it needs to be marked as abstract as well.</p>
<p>Note that a function without implementation is different from
a <a class="reference internal" href="index.html#function-types"><span class="std std-ref">Function Type</span></a> even though their syntax looks very similar.</p>
<p>Example of function without implementation (a function declaration):</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=ZnVuY3Rpb24gZm9vKGFkZHJlc3MpIGV4dGVybmFsIHJldHVybnMgKGFkZHJlc3MpOw=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">function</span><span class="w"> </span><span class="nv">foo</span><span class="p">(</span><span class="kt">address</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">address</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>Example of a declaration of a variable whose type is a function type:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=ZnVuY3Rpb24oYWRkcmVzcykgZXh0ZXJuYWwgcmV0dXJucyAoYWRkcmVzcykgZm9vOw=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">function</span><span class="p">(</span><span class="kt">address</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">address</span><span class="p">)</span><span class="w"> </span>foo<span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>Abstract contracts decouple the definition of a contract from its
implementation providing better extensibility and self-documentation and
facilitating patterns like the <a class="reference external" href="https://en.wikipedia.org/wiki/Template_method_pattern">Template method</a> and removing code duplication.
Abstract contracts are useful in the same way that defining methods
in an interface is useful. It is a way for the designer of the
abstract contract to say ‚Äúany child of mine must implement this method‚Äù.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Abstract contracts cannot override an implemented virtual function with an
unimplemented one.</p>
</div>
</section>
<section id="interfaces">
<span id="index-24"></span><span id="id14"></span><h3>Interfaces<a class="headerlink" href="#interfaces" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Interfaces are similar to abstract contracts, but they cannot have any functions implemented.
There are further restrictions:</p>
<ul class="simple">
<li><p>They cannot inherit from other contracts, but they can inherit from other interfaces.</p></li>
<li><p>All declared functions must be external in the interface, even if they are public in the contract.</p></li>
<li><p>They cannot declare a constructor.</p></li>
<li><p>They cannot declare state variables.</p></li>
<li><p>They cannot declare modifiers.</p></li>
</ul>
<p>Some of these restrictions might be lifted in the future.</p>
<p>Interfaces are basically limited to what the Contract ABI can represent, and the conversion between the ABI and
an interface should be possible without any information loss.</p>
<p>Interfaces are denoted by their own keyword:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC42LjIgPDAuOS4wOwoKaW50ZXJmYWNlIFRva2VuIHsKICAgIGVudW0gVG9rZW5UeXBlIHsgRnVuZ2libGUsIE5vbkZ1bmdpYmxlIH0KICAgIHN0cnVjdCBDb2luIHsgc3RyaW5nIG9idmVyc2U7IHN0cmluZyByZXZlcnNlOyB9CiAgICBmdW5jdGlvbiB0cmFuc2ZlcihhZGRyZXNzIHJlY2lwaWVudCwgdWludCBhbW91bnQpIGV4dGVybmFsOwp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.6.2</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

interface<span class="w"> </span>Token<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">enum</span><span class="w"> </span><span class="nv">TokenType</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>Fungible<span class="p">,</span><span class="w"> </span>NonFungible<span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="kt">struct</span><span class="w"> </span><span class="nv">Coin</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nv">obverse</span><span class="p">;</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nv">reverse</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">transfer</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">recipient</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">amount</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Contracts can inherit interfaces as they would inherit other contracts.</p>
<p>All functions declared in interfaces are implicitly <code class="docutils literal notranslate"><span class="pre">virtual</span></code> and any
functions that override them do not need the <code class="docutils literal notranslate"><span class="pre">override</span></code> keyword.
This does not automatically mean that an overriding function can be overridden again -
this is only possible if the overriding function is marked <code class="docutils literal notranslate"><span class="pre">virtual</span></code>.</p>
<p>Interfaces can inherit from other interfaces. This has the same rules as normal
inheritance.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC42LjIgPDAuOS4wOwoKaW50ZXJmYWNlIFBhcmVudEEgewogICAgZnVuY3Rpb24gdGVzdCgpIGV4dGVybmFsIHJldHVybnMgKHVpbnQyNTYpOwp9CgppbnRlcmZhY2UgUGFyZW50QiB7CiAgICBmdW5jdGlvbiB0ZXN0KCkgZXh0ZXJuYWwgcmV0dXJucyAodWludDI1Nik7Cn0KCmludGVyZmFjZSBTdWJJbnRlcmZhY2UgaXMgUGFyZW50QSwgUGFyZW50QiB7CiAgICAvLyBNdXN0IHJlZGVmaW5lIHRlc3QgaW4gb3JkZXIgdG8gYXNzZXJ0IHRoYXQgdGhlIHBhcmVudAogICAgLy8gbWVhbmluZ3MgYXJlIGNvbXBhdGlibGUuCiAgICBmdW5jdGlvbiB0ZXN0KCkgZXh0ZXJuYWwgb3ZlcnJpZGUoUGFyZW50QSwgUGFyZW50QikgcmV0dXJucyAodWludDI1Nik7Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.6.2</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

interface<span class="w"> </span>ParentA<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">test</span><span class="p">()</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint256</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

interface<span class="w"> </span>ParentB<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">test</span><span class="p">()</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint256</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

interface<span class="w"> </span>SubInterface<span class="w"> </span><span class="kt">is</span><span class="w"> </span>ParentA<span class="p">,</span><span class="w"> </span>ParentB<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Must redefine test in order to assert that the parent</span>
<span class="w">    </span><span class="c1">// meanings are compatible.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">test</span><span class="p">()</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>override<span class="p">(</span>ParentA<span class="p">,</span><span class="w"> </span>ParentB<span class="p">)</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint256</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Types defined inside interfaces and other contract-like structures
can be accessed from other contracts: <code class="docutils literal notranslate"><span class="pre">Token.TokenType</span></code> or <code class="docutils literal notranslate"><span class="pre">Token.Coin</span></code>.</p>
</section>
<section id="libraries">
<span id="index-25"></span><span id="id15"></span><h3>Libraries<a class="headerlink" href="#libraries" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Libraries are similar to contracts, but their purpose is that they are deployed
only once at a specific address and their code is reused using the <code class="docutils literal notranslate"><span class="pre">DELEGATECALL</span></code>
(<code class="docutils literal notranslate"><span class="pre">CALLCODE</span></code> until Homestead)
feature of the EVM. This means that if library functions are called, their code
is executed in the context of the calling contract, i.e. <code class="docutils literal notranslate"><span class="pre">this</span></code> points to the
calling contract, and especially the storage from the calling contract can be
accessed. As a library is an isolated piece of source code, it can only access
state variables of the calling contract if they are explicitly supplied (it
would have no way to name them, otherwise). Library functions can only be
called directly (i.e. without the use of <code class="docutils literal notranslate"><span class="pre">DELEGATECALL</span></code>) if they do not modify
the state (i.e. if they are <code class="docutils literal notranslate"><span class="pre">view</span></code> or <code class="docutils literal notranslate"><span class="pre">pure</span></code> functions),
because libraries are assumed to be stateless. In particular, it is
not possible to destroy a library.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Until version 0.4.20, it was possible to destroy libraries by
circumventing Solidity‚Äôs type system. Starting from that version,
libraries contain a <a class="reference internal" href="#call-protection"><span class="std std-ref">mechanism</span></a> that
disallows state-modifying functions
to be called directly (i.e. without <code class="docutils literal notranslate"><span class="pre">DELEGATECALL</span></code>).</p>
</div>
<p>Libraries can be seen as implicit base contracts of the contracts that use them.
They will not be explicitly visible in the inheritance hierarchy, but calls
to library functions look just like calls to functions of explicit base
contracts (using qualified access like <code class="docutils literal notranslate"><span class="pre">L.f()</span></code>).
Of course, calls to internal functions
use the internal calling convention, which means that all internal types
can be passed and types <a class="reference internal" href="index.html#data-location"><span class="std std-ref">stored in memory</span></a> will be passed by reference and not copied.
To realize this in the EVM, the code of internal library functions
that are called from a contract
and all functions called from therein will at compile time be included in the calling
contract, and a regular <code class="docutils literal notranslate"><span class="pre">JUMP</span></code> call will be used instead of a <code class="docutils literal notranslate"><span class="pre">DELEGATECALL</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The inheritance analogy breaks down when it comes to public functions.
Calling a public library function with <code class="docutils literal notranslate"><span class="pre">L.f()</span></code> results in an external call (<code class="docutils literal notranslate"><span class="pre">DELEGATECALL</span></code>
to be precise).
In contrast, <code class="docutils literal notranslate"><span class="pre">A.f()</span></code> is an internal call when <code class="docutils literal notranslate"><span class="pre">A</span></code> is a base contract of the current contract.</p>
</div>
<p id="index-26">The following example illustrates how to use libraries (but using a manual method,
be sure to check out <a class="reference internal" href="#using-for"><span class="std std-ref">using for</span></a> for a
more advanced example to implement a set).</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC42LjAgPDAuOS4wOwoKCi8vIFdlIGRlZmluZSBhIG5ldyBzdHJ1Y3QgZGF0YXR5cGUgdGhhdCB3aWxsIGJlIHVzZWQgdG8KLy8gaG9sZCBpdHMgZGF0YSBpbiB0aGUgY2FsbGluZyBjb250cmFjdC4Kc3RydWN0IERhdGEgewogICAgbWFwcGluZyh1aW50ID0+IGJvb2wpIGZsYWdzOwp9CgpsaWJyYXJ5IFNldCB7CiAgICAvLyBOb3RlIHRoYXQgdGhlIGZpcnN0IHBhcmFtZXRlciBpcyBvZiB0eXBlICJzdG9yYWdlCiAgICAvLyByZWZlcmVuY2UiIGFuZCB0aHVzIG9ubHkgaXRzIHN0b3JhZ2UgYWRkcmVzcyBhbmQgbm90CiAgICAvLyBpdHMgY29udGVudHMgaXMgcGFzc2VkIGFzIHBhcnQgb2YgdGhlIGNhbGwuICBUaGlzIGlzIGEKICAgIC8vIHNwZWNpYWwgZmVhdHVyZSBvZiBsaWJyYXJ5IGZ1bmN0aW9ucy4gIEl0IGlzIGlkaW9tYXRpYwogICAgLy8gdG8gY2FsbCB0aGUgZmlyc3QgcGFyYW1ldGVyIGBzZWxmYCwgaWYgdGhlIGZ1bmN0aW9uIGNhbgogICAgLy8gYmUgc2VlbiBhcyBhIG1ldGhvZCBvZiB0aGF0IG9iamVjdC4KICAgIGZ1bmN0aW9uIGluc2VydChEYXRhIHN0b3JhZ2Ugc2VsZiwgdWludCB2YWx1ZSkKICAgICAgICBwdWJsaWMKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIGlmIChzZWxmLmZsYWdzW3ZhbHVlXSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOyAvLyBhbHJlYWR5IHRoZXJlCiAgICAgICAgc2VsZi5mbGFnc1t2YWx1ZV0gPSB0cnVlOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIHJlbW92ZShEYXRhIHN0b3JhZ2Ugc2VsZiwgdWludCB2YWx1ZSkKICAgICAgICBwdWJsaWMKICAgICAgICByZXR1cm5zIChib29sKQogICAgewogICAgICAgIGlmICghc2VsZi5mbGFnc1t2YWx1ZV0pCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsgLy8gbm90IHRoZXJlCiAgICAgICAgc2VsZi5mbGFnc1t2YWx1ZV0gPSBmYWxzZTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBjb250YWlucyhEYXRhIHN0b3JhZ2Ugc2VsZiwgdWludCB2YWx1ZSkKICAgICAgICBwdWJsaWMKICAgICAgICB2aWV3CiAgICAgICAgcmV0dXJucyAoYm9vbCkKICAgIHsKICAgICAgICByZXR1cm4gc2VsZi5mbGFnc1t2YWx1ZV07CiAgICB9Cn0KCgpjb250cmFjdCBDIHsKICAgIERhdGEga25vd25WYWx1ZXM7CgogICAgZnVuY3Rpb24gcmVnaXN0ZXIodWludCB2YWx1ZSkgcHVibGljIHsKICAgICAgICAvLyBUaGUgbGlicmFyeSBmdW5jdGlvbnMgY2FuIGJlIGNhbGxlZCB3aXRob3V0IGEKICAgICAgICAvLyBzcGVjaWZpYyBpbnN0YW5jZSBvZiB0aGUgbGlicmFyeSwgc2luY2UgdGhlCiAgICAgICAgLy8gImluc3RhbmNlIiB3aWxsIGJlIHRoZSBjdXJyZW50IGNvbnRyYWN0LgogICAgICAgIHJlcXVpcmUoU2V0Lmluc2VydChrbm93blZhbHVlcywgdmFsdWUpKTsKICAgIH0KICAgIC8vIEluIHRoaXMgY29udHJhY3QsIHdlIGNhbiBhbHNvIGRpcmVjdGx5IGFjY2VzcyBrbm93blZhbHVlcy5mbGFncywgaWYgd2Ugd2FudC4KfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.6.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>


<span class="c1">// We define a new struct datatype that will be used to</span>
<span class="c1">// hold its data in the calling contract.</span>
<span class="kt">struct</span><span class="w"> </span><span class="nv">Data</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span>flags<span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">library</span><span class="w"> </span>Set<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Note that the first parameter is of type &quot;storage</span>
<span class="w">    </span><span class="c1">// reference&quot; and thus only its storage address and not</span>
<span class="w">    </span><span class="c1">// its contents is passed as part of the call.  This is a</span>
<span class="w">    </span><span class="c1">// special feature of library functions.  It is idiomatic</span>
<span class="w">    </span><span class="c1">// to call the first parameter `self`, if the function can</span>
<span class="w">    </span><span class="c1">// be seen as a method of that object.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">insert</span><span class="p">(</span>Data<span class="w"> </span>storage<span class="w"> </span>self<span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="kt">public</span><span class="w"></span>
<span class="w">        </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>self<span class="p">.</span>flags<span class="p">[</span>value<span class="p">])</span><span class="w"></span>
<span class="w">            </span><span class="kt">return</span><span class="w"> </span><span class="kt">false</span><span class="p">;</span><span class="w"> </span><span class="c1">// already there</span>
<span class="w">        </span>self<span class="p">.</span>flags<span class="p">[</span>value<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">remove</span><span class="p">(</span>Data<span class="w"> </span>storage<span class="w"> </span>self<span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="kt">public</span><span class="w"></span>
<span class="w">        </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span>self<span class="p">.</span>flags<span class="p">[</span>value<span class="p">])</span><span class="w"></span>
<span class="w">            </span><span class="kt">return</span><span class="w"> </span><span class="kt">false</span><span class="p">;</span><span class="w"> </span><span class="c1">// not there</span>
<span class="w">        </span>self<span class="p">.</span>flags<span class="p">[</span>value<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">false</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">contains</span><span class="p">(</span>Data<span class="w"> </span>storage<span class="w"> </span>self<span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="kt">public</span><span class="w"></span>
<span class="w">        </span>view<span class="w"></span>
<span class="w">        </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>self<span class="p">.</span>flags<span class="p">[</span>value<span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>


<span class="k">contract</span><span class="w"> </span><span class="ni">C</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span>Data<span class="w"> </span>knownValues<span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">register</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// The library functions can be called without a</span>
<span class="w">        </span><span class="c1">// specific instance of the library, since the</span>
<span class="w">        </span><span class="c1">// &quot;instance&quot; will be the current contract.</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>Set<span class="p">.</span>insert<span class="p">(</span>knownValues<span class="p">,</span><span class="w"> </span>value<span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="c1">// In this contract, we can also directly access knownValues.flags, if we want.</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Of course, you do not have to follow this way to use
libraries: they can also be used without defining struct
data types. Functions also work without any storage
reference parameters, and they can have multiple storage reference
parameters and in any position.</p>
<p>The calls to <code class="docutils literal notranslate"><span class="pre">Set.contains</span></code>, <code class="docutils literal notranslate"><span class="pre">Set.insert</span></code> and <code class="docutils literal notranslate"><span class="pre">Set.remove</span></code>
are all compiled as calls (<code class="docutils literal notranslate"><span class="pre">DELEGATECALL</span></code>) to an external
contract/library. If you use libraries, be aware that an
actual external function call is performed.
<code class="docutils literal notranslate"><span class="pre">msg.sender</span></code>, <code class="docutils literal notranslate"><span class="pre">msg.value</span></code> and <code class="docutils literal notranslate"><span class="pre">this</span></code> will retain their values
in this call, though (prior to Homestead, because of the use of <code class="docutils literal notranslate"><span class="pre">CALLCODE</span></code>, <code class="docutils literal notranslate"><span class="pre">msg.sender</span></code> and
<code class="docutils literal notranslate"><span class="pre">msg.value</span></code> changed, though).</p>
<p>The following example shows how to use <a class="reference internal" href="index.html#data-location"><span class="std std-ref">types stored in memory</span></a> and
internal functions in libraries in order to implement
custom types without the overhead of external function calls:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5IF4wLjguMDsKCnN0cnVjdCBiaWdpbnQgewogICAgdWludFtdIGxpbWJzOwp9CgpsaWJyYXJ5IEJpZ0ludCB7CiAgICBmdW5jdGlvbiBmcm9tVWludCh1aW50IHgpIGludGVybmFsIHB1cmUgcmV0dXJucyAoYmlnaW50IG1lbW9yeSByKSB7CiAgICAgICAgci5saW1icyA9IG5ldyB1aW50W10oMSk7CiAgICAgICAgci5saW1ic1swXSA9IHg7CiAgICB9CgogICAgZnVuY3Rpb24gYWRkKGJpZ2ludCBtZW1vcnkgYSwgYmlnaW50IG1lbW9yeSBiKSBpbnRlcm5hbCBwdXJlIHJldHVybnMgKGJpZ2ludCBtZW1vcnkgcikgewogICAgICAgIHIubGltYnMgPSBuZXcgdWludFtdKG1heChhLmxpbWJzLmxlbmd0aCwgYi5saW1icy5sZW5ndGgpKTsKICAgICAgICB1aW50IGNhcnJ5ID0gMDsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCByLmxpbWJzLmxlbmd0aDsgKytpKSB7CiAgICAgICAgICAgIHVpbnQgbGltYkEgPSBsaW1iKGEsIGkpOwogICAgICAgICAgICB1aW50IGxpbWJCID0gbGltYihiLCBpKTsKICAgICAgICAgICAgdW5jaGVja2VkIHsKICAgICAgICAgICAgICAgIHIubGltYnNbaV0gPSBsaW1iQSArIGxpbWJCICsgY2Fycnk7CgogICAgICAgICAgICAgICAgaWYgKGxpbWJBICsgbGltYkIgPCBsaW1iQSB8fCAobGltYkEgKyBsaW1iQiA9PSB0eXBlKHVpbnQpLm1heCAmJiBjYXJyeSA+IDApKQogICAgICAgICAgICAgICAgICAgIGNhcnJ5ID0gMTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBjYXJyeSA9IDA7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGNhcnJ5ID4gMCkgewogICAgICAgICAgICAvLyB0b28gYmFkLCB3ZSBoYXZlIHRvIGFkZCBhIGxpbWIKICAgICAgICAgICAgdWludFtdIG1lbW9yeSBuZXdMaW1icyA9IG5ldyB1aW50W10oci5saW1icy5sZW5ndGggKyAxKTsKICAgICAgICAgICAgdWludCBpOwogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgci5saW1icy5sZW5ndGg7ICsraSkKICAgICAgICAgICAgICAgIG5ld0xpbWJzW2ldID0gci5saW1ic1tpXTsKICAgICAgICAgICAgbmV3TGltYnNbaV0gPSBjYXJyeTsKICAgICAgICAgICAgci5saW1icyA9IG5ld0xpbWJzOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBsaW1iKGJpZ2ludCBtZW1vcnkgYSwgdWludCBpbmRleCkgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIGluZGV4IDwgYS5saW1icy5sZW5ndGggPyBhLmxpbWJzW2luZGV4XSA6IDA7CiAgICB9CgogICAgZnVuY3Rpb24gbWF4KHVpbnQgYSwgdWludCBiKSBwcml2YXRlIHB1cmUgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBhID4gYiA/IGEgOiBiOwogICAgfQp9Cgpjb250cmFjdCBDIHsKICAgIHVzaW5nIEJpZ0ludCBmb3IgYmlnaW50OwoKICAgIGZ1bmN0aW9uIGYoKSBwdWJsaWMgcHVyZSB7CiAgICAgICAgYmlnaW50IG1lbW9yeSB4ID0gQmlnSW50LmZyb21VaW50KDcpOwogICAgICAgIGJpZ2ludCBtZW1vcnkgeSA9IEJpZ0ludC5mcm9tVWludCh0eXBlKHVpbnQpLm1heCk7CiAgICAgICAgYmlnaW50IG1lbW9yeSB6ID0geC5hZGQoeSk7CiAgICAgICAgYXNzZXJ0KHoubGltYigxKSA+IDApOwogICAgfQp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.8.0</span><span class="p">;</span><span class="w"></span>

<span class="kt">struct</span><span class="w"> </span><span class="nv">bigint</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="p">[]</span><span class="w"> </span>limbs<span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">library</span><span class="w"> </span>BigInt<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">fromUint</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">x</span><span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span>bigint<span class="w"> </span><span class="kt">memory</span><span class="w"> </span>r<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>r<span class="p">.</span>limbs<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="kt">uint</span><span class="p">[](</span><span class="m m-Decimal">1</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span>r<span class="p">.</span>limbs<span class="p">[</span><span class="m m-Decimal">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>x<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">add</span><span class="p">(</span>bigint<span class="w"> </span><span class="kt">memory</span><span class="w"> </span>a<span class="p">,</span><span class="w"> </span>bigint<span class="w"> </span><span class="kt">memory</span><span class="w"> </span>b<span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span>bigint<span class="w"> </span><span class="kt">memory</span><span class="w"> </span>r<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>r<span class="p">.</span>limbs<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="kt">uint</span><span class="p">[](</span>max<span class="p">(</span>a<span class="p">.</span>limbs<span class="p">.</span>length<span class="p">,</span><span class="w"> </span>b<span class="p">.</span>limbs<span class="p">.</span>length<span class="p">));</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="w"> </span><span class="nv">carry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">for</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span><span class="w"> </span>i<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>r<span class="p">.</span>limbs<span class="p">.</span>length<span class="p">;</span><span class="w"> </span><span class="o">++</span>i<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="kt">uint</span><span class="w"> </span><span class="nv">limbA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>limb<span class="p">(</span>a<span class="p">,</span><span class="w"> </span>i<span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="kt">uint</span><span class="w"> </span><span class="nv">limbB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>limb<span class="p">(</span>b<span class="p">,</span><span class="w"> </span>i<span class="p">);</span><span class="w"></span>
<span class="w">            </span>unchecked<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span>r<span class="p">.</span>limbs<span class="p">[</span>i<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>limbA<span class="w"> </span><span class="o">+</span><span class="w"> </span>limbB<span class="w"> </span><span class="o">+</span><span class="w"> </span>carry<span class="p">;</span><span class="w"></span>

<span class="w">                </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>limbA<span class="w"> </span><span class="o">+</span><span class="w"> </span>limbB<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>limbA<span class="w"> </span><span class="err">||</span><span class="w"> </span><span class="p">(</span>limbA<span class="w"> </span><span class="o">+</span><span class="w"> </span>limbB<span class="w"> </span><span class="o">==</span><span class="w"> </span>type<span class="p">(</span><span class="kt">uint</span><span class="p">).</span>max<span class="w"> </span><span class="err">&amp;&amp;</span><span class="w"> </span>carry<span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">))</span><span class="w"></span>
<span class="w">                    </span>carry<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="kt">else</span><span class="w"></span>
<span class="w">                    </span>carry<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>carry<span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="c1">// too bad, we have to add a limb</span>
<span class="w">            </span><span class="kt">uint</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>newLimbs<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="kt">uint</span><span class="p">[](</span>r<span class="p">.</span>limbs<span class="p">.</span>length<span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="kt">uint</span><span class="w"> </span><span class="nv">i</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="kt">for</span><span class="w"> </span><span class="p">(</span>i<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span><span class="w"> </span>i<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>r<span class="p">.</span>limbs<span class="p">.</span>length<span class="p">;</span><span class="w"> </span><span class="o">++</span>i<span class="p">)</span><span class="w"></span>
<span class="w">                </span>newLimbs<span class="p">[</span>i<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>r<span class="p">.</span>limbs<span class="p">[</span>i<span class="p">];</span><span class="w"></span>
<span class="w">            </span>newLimbs<span class="p">[</span>i<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>carry<span class="p">;</span><span class="w"></span>
<span class="w">            </span>r<span class="p">.</span>limbs<span class="w"> </span><span class="o">=</span><span class="w"> </span>newLimbs<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">limb</span><span class="p">(</span>bigint<span class="w"> </span><span class="kt">memory</span><span class="w"> </span>a<span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">index</span><span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>index<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>a<span class="p">.</span>limbs<span class="p">.</span>length<span class="w"> </span><span class="err">?</span><span class="w"> </span>a<span class="p">.</span>limbs<span class="p">[</span>index<span class="p">]</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">max</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">a</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">b</span><span class="p">)</span><span class="w"> </span><span class="kt">private</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>a<span class="w"> </span><span class="o">&gt;</span><span class="w"> </span>b<span class="w"> </span><span class="err">?</span><span class="w"> </span>a<span class="w"> </span><span class="p">:</span><span class="w"> </span>b<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">C</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span>using<span class="w"> </span>BigInt<span class="w"> </span><span class="kt">for</span><span class="w"> </span>bigint<span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">f</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>pure<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>bigint<span class="w"> </span><span class="kt">memory</span><span class="w"> </span>x<span class="w"> </span><span class="o">=</span><span class="w"> </span>BigInt<span class="p">.</span>fromUint<span class="p">(</span><span class="m m-Decimal">7</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span>bigint<span class="w"> </span><span class="kt">memory</span><span class="w"> </span>y<span class="w"> </span><span class="o">=</span><span class="w"> </span>BigInt<span class="p">.</span>fromUint<span class="p">(</span>type<span class="p">(</span><span class="kt">uint</span><span class="p">).</span>max<span class="p">);</span><span class="w"></span>
<span class="w">        </span>bigint<span class="w"> </span><span class="kt">memory</span><span class="w"> </span>z<span class="w"> </span><span class="o">=</span><span class="w"> </span>x<span class="p">.</span>add<span class="p">(</span>y<span class="p">);</span><span class="w"></span>
<span class="w">        </span>assert<span class="p">(</span>z<span class="p">.</span>limb<span class="p">(</span><span class="m m-Decimal">1</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>It is possible to obtain the address of a library by converting
the library type to the <code class="docutils literal notranslate"><span class="pre">address</span></code> type, i.e. using <code class="docutils literal notranslate"><span class="pre">address(LibraryName)</span></code>.</p>
<p>As the compiler does not know the address where the library will be deployed, the compiled hex code
will contain placeholders of the form <code class="docutils literal notranslate"><span class="pre">__$30bbc0abd4d6364515865950d3e0d10953$__</span></code>. The placeholder
is a 34 character prefix of the hex encoding of the keccak256 hash of the fully qualified library
name, which would be for example <code class="docutils literal notranslate"><span class="pre">libraries/bigint.sol:BigInt</span></code> if the library was stored in a file
called <code class="docutils literal notranslate"><span class="pre">bigint.sol</span></code> in a <code class="docutils literal notranslate"><span class="pre">libraries/</span></code> directory. Such bytecode is incomplete and should not be
deployed. Placeholders need to be replaced with actual addresses. You can do that by either passing
them to the compiler when the library is being compiled or by using the linker to update an already
compiled binary. See <a class="reference internal" href="index.html#library-linking"><span class="std std-ref">Library Linking</span></a> for information on how to use the commandline compiler
for linking.</p>
<p>In comparison to contracts, libraries are restricted in the following ways:</p>
<ul class="simple">
<li><p>they cannot have state variables</p></li>
<li><p>they cannot inherit nor be inherited</p></li>
<li><p>they cannot receive Ether</p></li>
<li><p>they cannot be destroyed</p></li>
</ul>
<p>(These might be lifted at a later point.)</p>
<span class="target" id="library-selectors"></span><section id="function-signatures-and-selectors-in-libraries">
<span id="index-27"></span><h4>Function Signatures and Selectors in Libraries<a class="headerlink" href="#function-signatures-and-selectors-in-libraries" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>While external calls to public or external library functions are possible, the calling convention for such calls
is considered to be internal to Solidity and not the same as specified for the regular <a class="reference internal" href="index.html#abi"><span class="std std-ref">contract ABI</span></a>.
External library functions support more argument types than external contract functions, for example recursive structs
and storage pointers. For that reason, the function signatures used to compute the 4-byte selector are computed
following an internal naming schema and arguments of types not supported in the contract ABI use an internal encoding.</p>
<p>The following identifiers are used for the types in the signatures:</p>
<ul class="simple">
<li><p>Value types, non-storage <code class="docutils literal notranslate"><span class="pre">string</span></code> and non-storage <code class="docutils literal notranslate"><span class="pre">bytes</span></code> use the same identifiers as in the contract ABI.</p></li>
<li><p>Non-storage array types follow the same convention as in the contract ABI, i.e. <code class="docutils literal notranslate"><span class="pre">&lt;type&gt;[]</span></code> for dynamic arrays and
<code class="docutils literal notranslate"><span class="pre">&lt;type&gt;[M]</span></code> for fixed-size arrays of <code class="docutils literal notranslate"><span class="pre">M</span></code> elements.</p></li>
<li><p>Non-storage structs are referred to by their fully qualified name, i.e. <code class="docutils literal notranslate"><span class="pre">C.S</span></code> for <code class="docutils literal notranslate"><span class="pre">contract</span> <span class="pre">C</span> <span class="pre">{</span> <span class="pre">struct</span> <span class="pre">S</span> <span class="pre">{</span> <span class="pre">...</span> <span class="pre">}</span> <span class="pre">}</span></code>.</p></li>
<li><p>Storage pointer mappings use <code class="docutils literal notranslate"><span class="pre">mapping(&lt;keyType&gt;</span> <span class="pre">=&gt;</span> <span class="pre">&lt;valueType&gt;)</span> <span class="pre">storage</span></code> where <code class="docutils literal notranslate"><span class="pre">&lt;keyType&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;valueType&gt;</span></code> are
the identifiers for the key and value types of the mapping, respectively.</p></li>
<li><p>Other storage pointer types use the type identifier of their corresponding non-storage type, but append a single space
followed by <code class="docutils literal notranslate"><span class="pre">storage</span></code> to it.</p></li>
</ul>
<p>The argument encoding is the same as for the regular contract ABI, except for storage pointers, which are encoded as a
<code class="docutils literal notranslate"><span class="pre">uint256</span></code> value referring to the storage slot to which they point.</p>
<p>Similarly to the contract ABI, the selector consists of the first four bytes of the Keccak256-hash of the signature.
Its value can be obtained from Solidity using the <code class="docutils literal notranslate"><span class="pre">.selector</span></code> member as follows:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC41LjE0IDwwLjkuMDsKCmxpYnJhcnkgTCB7CiAgICBmdW5jdGlvbiBmKHVpbnQyNTYpIGV4dGVybmFsIHt9Cn0KCmNvbnRyYWN0IEMgewogICAgZnVuY3Rpb24gZygpIHB1YmxpYyBwdXJlIHJldHVybnMgKGJ5dGVzNCkgewogICAgICAgIHJldHVybiBMLmYuc2VsZWN0b3I7CiAgICB9Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.5.14</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="kt">library</span><span class="w"> </span>L<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">f</span><span class="p">(</span><span class="kt">uint256</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">C</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">g</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span>bytes4<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>L<span class="p">.</span>f<span class="p">.</span>selector<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="call-protection-for-libraries">
<span id="call-protection"></span><h4>Call Protection For Libraries<a class="headerlink" href="#call-protection-for-libraries" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>As mentioned in the introduction, if a library‚Äôs code is executed
using a <code class="docutils literal notranslate"><span class="pre">CALL</span></code> instead of a <code class="docutils literal notranslate"><span class="pre">DELEGATECALL</span></code> or <code class="docutils literal notranslate"><span class="pre">CALLCODE</span></code>,
it will revert unless a <code class="docutils literal notranslate"><span class="pre">view</span></code> or <code class="docutils literal notranslate"><span class="pre">pure</span></code> function is called.</p>
<p>The EVM does not provide a direct way for a contract to detect
whether it was called using <code class="docutils literal notranslate"><span class="pre">CALL</span></code> or not, but a contract
can use the <code class="docutils literal notranslate"><span class="pre">ADDRESS</span></code> opcode to find out ‚Äúwhere‚Äù it is
currently running. The generated code compares this address
to the address used at construction time to determine the mode
of calling.</p>
<p>More specifically, the runtime code of a library always starts
with a push instruction, which is a zero of 20 bytes at
compilation time. When the deploy code runs, this constant
is replaced in memory by the current address and this
modified code is stored in the contract. At runtime,
this causes the deploy time address to be the first
constant to be pushed onto the stack and the dispatcher
code compares the current address against this constant
for any non-view and non-pure function.</p>
<p>This means that the actual code stored on chain for a library
is different from the code reported by the compiler as
<code class="docutils literal notranslate"><span class="pre">deployedBytecode</span></code>.</p>
</section>
</section>
<section id="using-for">
<span id="index-28"></span><span id="id16"></span><h3>Using For<a class="headerlink" href="#using-for" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>The directive <code class="docutils literal notranslate"><span class="pre">using</span> <span class="pre">A</span> <span class="pre">for</span> <span class="pre">B;</span></code> can be used to attach
functions (<code class="docutils literal notranslate"><span class="pre">A</span></code>) as member functions to any type (<code class="docutils literal notranslate"><span class="pre">B</span></code>).
These functions will receive the object they are called on
as their first parameter (like the <code class="docutils literal notranslate"><span class="pre">self</span></code> variable in Python).</p>
<p>It is valid either at file level or inside a contract,
at contract level.</p>
<p>The first part, <code class="docutils literal notranslate"><span class="pre">A</span></code>, can be one of:</p>
<ul class="simple">
<li><p>a list of file-level or library functions (<code class="docutils literal notranslate"><span class="pre">using</span> <span class="pre">{f,</span> <span class="pre">g,</span> <span class="pre">h,</span> <span class="pre">L.t}</span> <span class="pre">for</span> <span class="pre">uint;</span></code>) -
only those functions will be attached to the type.</p></li>
<li><p>the name of a library (<code class="docutils literal notranslate"><span class="pre">using</span> <span class="pre">L</span> <span class="pre">for</span> <span class="pre">uint;</span></code>) -
all functions (both public and internal ones) of the library are attached to the type</p></li>
</ul>
<p>At file level, the second part, <code class="docutils literal notranslate"><span class="pre">B</span></code>, has to be an explicit type (without data location specifier).
Inside contracts, you can also use <code class="docutils literal notranslate"><span class="pre">using</span> <span class="pre">L</span> <span class="pre">for</span> <span class="pre">*;</span></code>,
which has the effect that all functions of the library <code class="docutils literal notranslate"><span class="pre">L</span></code>
are attached to <em>all</em> types.</p>
<p>If you specify a library, <em>all</em> functions in the library are attached,
even those where the type of the first parameter does not
match the type of the object. The type is checked at the
point the function is called and function overload
resolution is performed.</p>
<p>If you use a list of functions (<code class="docutils literal notranslate"><span class="pre">using</span> <span class="pre">{f,</span> <span class="pre">g,</span> <span class="pre">h,</span> <span class="pre">L.t}</span> <span class="pre">for</span> <span class="pre">uint;</span></code>),
then the type (<code class="docutils literal notranslate"><span class="pre">uint</span></code>) has to be implicitly convertible to the
first parameter of each of these functions. This check is
performed even if none of these functions are called.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">using</span> <span class="pre">A</span> <span class="pre">for</span> <span class="pre">B;</span></code> directive is active only within the current
scope (either the contract or the current module/source unit),
including within all of its functions, and has no effect
outside of the contract or module in which it is used.</p>
<p>When the directive is used at file level and applied to a
user-defined type which was defined at file level in the same file,
the word <code class="docutils literal notranslate"><span class="pre">global</span></code> can be added at the end. This will have the
effect that the functions are attached to the type everywhere
the type is available (including other files), not only in the
scope of the using statement.</p>
<p>Let us rewrite the set example from the
<a class="reference internal" href="#libraries"><span class="std std-ref">Libraries</span></a> section in this way, using file-level functions
instead of library functions.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5IF4wLjguMTM7CgpzdHJ1Y3QgRGF0YSB7IG1hcHBpbmcodWludCA9PiBib29sKSBmbGFnczsgfQovLyBOb3cgd2UgYXR0YWNoIGZ1bmN0aW9ucyB0byB0aGUgdHlwZS4KLy8gVGhlIGF0dGFjaGVkIGZ1bmN0aW9ucyBjYW4gYmUgdXNlZCB0aHJvdWdob3V0IHRoZSByZXN0IG9mIHRoZSBtb2R1bGUuCi8vIElmIHlvdSBpbXBvcnQgdGhlIG1vZHVsZSwgeW91IGhhdmUgdG8KLy8gcmVwZWF0IHRoZSB1c2luZyBkaXJlY3RpdmUgdGhlcmUsIGZvciBleGFtcGxlIGFzCi8vICAgaW1wb3J0ICJmbGFncy5zb2wiIGFzIEZsYWdzOwovLyAgIHVzaW5nIHtGbGFncy5pbnNlcnQsIEZsYWdzLnJlbW92ZSwgRmxhZ3MuY29udGFpbnN9Ci8vICAgICBmb3IgRmxhZ3MuRGF0YTsKdXNpbmcge2luc2VydCwgcmVtb3ZlLCBjb250YWluc30gZm9yIERhdGE7CgpmdW5jdGlvbiBpbnNlcnQoRGF0YSBzdG9yYWdlIHNlbGYsIHVpbnQgdmFsdWUpCiAgICByZXR1cm5zIChib29sKQp7CiAgICBpZiAoc2VsZi5mbGFnc1t2YWx1ZV0pCiAgICAgICAgcmV0dXJuIGZhbHNlOyAvLyBhbHJlYWR5IHRoZXJlCiAgICBzZWxmLmZsYWdzW3ZhbHVlXSA9IHRydWU7CiAgICByZXR1cm4gdHJ1ZTsKfQoKZnVuY3Rpb24gcmVtb3ZlKERhdGEgc3RvcmFnZSBzZWxmLCB1aW50IHZhbHVlKQogICAgcmV0dXJucyAoYm9vbCkKewogICAgaWYgKCFzZWxmLmZsYWdzW3ZhbHVlXSkKICAgICAgICByZXR1cm4gZmFsc2U7IC8vIG5vdCB0aGVyZQogICAgc2VsZi5mbGFnc1t2YWx1ZV0gPSBmYWxzZTsKICAgIHJldHVybiB0cnVlOwp9CgpmdW5jdGlvbiBjb250YWlucyhEYXRhIHN0b3JhZ2Ugc2VsZiwgdWludCB2YWx1ZSkKICAgIHZpZXcKICAgIHJldHVybnMgKGJvb2wpCnsKICAgIHJldHVybiBzZWxmLmZsYWdzW3ZhbHVlXTsKfQoKCmNvbnRyYWN0IEMgewogICAgRGF0YSBrbm93blZhbHVlczsKCiAgICBmdW5jdGlvbiByZWdpc3Rlcih1aW50IHZhbHVlKSBwdWJsaWMgewogICAgICAgIC8vIEhlcmUsIGFsbCB2YXJpYWJsZXMgb2YgdHlwZSBEYXRhIGhhdmUKICAgICAgICAvLyBjb3JyZXNwb25kaW5nIG1lbWJlciBmdW5jdGlvbnMuCiAgICAgICAgLy8gVGhlIGZvbGxvd2luZyBmdW5jdGlvbiBjYWxsIGlzIGlkZW50aWNhbCB0bwogICAgICAgIC8vIGBTZXQuaW5zZXJ0KGtub3duVmFsdWVzLCB2YWx1ZSlgCiAgICAgICAgcmVxdWlyZShrbm93blZhbHVlcy5pbnNlcnQodmFsdWUpKTsKICAgIH0KfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.8.13</span><span class="p">;</span><span class="w"></span>

<span class="kt">struct</span><span class="w"> </span><span class="nv">Data</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span>flags<span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="c1">// Now we attach functions to the type.</span>
<span class="c1">// The attached functions can be used throughout the rest of the module.</span>
<span class="c1">// If you import the module, you have to</span>
<span class="c1">// repeat the using directive there, for example as</span>
<span class="c1">//   import &quot;flags.sol&quot; as Flags;</span>
<span class="c1">//   using {Flags.insert, Flags.remove, Flags.contains}</span>
<span class="c1">//     for Flags.Data;</span>
using<span class="w"> </span><span class="p">{</span>insert<span class="p">,</span><span class="w"> </span>remove<span class="p">,</span><span class="w"> </span>contains<span class="p">}</span><span class="w"> </span><span class="kt">for</span><span class="w"> </span>Data<span class="p">;</span><span class="w"></span>

<span class="kt">function</span><span class="w"> </span><span class="nv">insert</span><span class="p">(</span>Data<span class="w"> </span>storage<span class="w"> </span>self<span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>self<span class="p">.</span>flags<span class="p">[</span>value<span class="p">])</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span><span class="kt">false</span><span class="p">;</span><span class="w"> </span><span class="c1">// already there</span>
<span class="w">    </span>self<span class="p">.</span>flags<span class="p">[</span>value<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">return</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">function</span><span class="w"> </span><span class="nv">remove</span><span class="p">(</span>Data<span class="w"> </span>storage<span class="w"> </span>self<span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span>self<span class="p">.</span>flags<span class="p">[</span>value<span class="p">])</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span><span class="kt">false</span><span class="p">;</span><span class="w"> </span><span class="c1">// not there</span>
<span class="w">    </span>self<span class="p">.</span>flags<span class="p">[</span>value<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">false</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">return</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">function</span><span class="w"> </span><span class="nv">contains</span><span class="p">(</span>Data<span class="w"> </span>storage<span class="w"> </span>self<span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>view<span class="w"></span>
<span class="w">    </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">return</span><span class="w"> </span>self<span class="p">.</span>flags<span class="p">[</span>value<span class="p">];</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>


<span class="k">contract</span><span class="w"> </span><span class="ni">C</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span>Data<span class="w"> </span>knownValues<span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">register</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Here, all variables of type Data have</span>
<span class="w">        </span><span class="c1">// corresponding member functions.</span>
<span class="w">        </span><span class="c1">// The following function call is identical to</span>
<span class="w">        </span><span class="c1">// `Set.insert(knownValues, value)`</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>knownValues<span class="p">.</span>insert<span class="p">(</span>value<span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>It is also possible to extend built-in types in that way.
In this example, we will use a library.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5IF4wLjguMTM7CgpsaWJyYXJ5IFNlYXJjaCB7CiAgICBmdW5jdGlvbiBpbmRleE9mKHVpbnRbXSBzdG9yYWdlIHNlbGYsIHVpbnQgdmFsdWUpCiAgICAgICAgcHVibGljCiAgICAgICAgdmlldwogICAgICAgIHJldHVybnMgKHVpbnQpCiAgICB7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgc2VsZi5sZW5ndGg7IGkrKykKICAgICAgICAgICAgaWYgKHNlbGZbaV0gPT0gdmFsdWUpIHJldHVybiBpOwogICAgICAgIHJldHVybiB0eXBlKHVpbnQpLm1heDsKICAgIH0KfQp1c2luZyBTZWFyY2ggZm9yIHVpbnRbXTsKCmNvbnRyYWN0IEMgewogICAgdWludFtdIGRhdGE7CgogICAgZnVuY3Rpb24gYXBwZW5kKHVpbnQgdmFsdWUpIHB1YmxpYyB7CiAgICAgICAgZGF0YS5wdXNoKHZhbHVlKTsKICAgIH0KCiAgICBmdW5jdGlvbiByZXBsYWNlKHVpbnQgZnJvbSwgdWludCB0bykgcHVibGljIHsKICAgICAgICAvLyBUaGlzIHBlcmZvcm1zIHRoZSBsaWJyYXJ5IGZ1bmN0aW9uIGNhbGwKICAgICAgICB1aW50IGluZGV4ID0gZGF0YS5pbmRleE9mKGZyb20pOwogICAgICAgIGlmIChpbmRleCA9PSB0eXBlKHVpbnQpLm1heCkKICAgICAgICAgICAgZGF0YS5wdXNoKHRvKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIGRhdGFbaW5kZXhdID0gdG87CiAgICB9Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.8.13</span><span class="p">;</span><span class="w"></span>

<span class="kt">library</span><span class="w"> </span>Search<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">indexOf</span><span class="p">(</span><span class="kt">uint</span><span class="p">[]</span><span class="w"> </span>storage<span class="w"> </span>self<span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="kt">public</span><span class="w"></span>
<span class="w">        </span>view<span class="w"></span>
<span class="w">        </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">for</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span><span class="w"> </span>i<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>self<span class="p">.</span>length<span class="p">;</span><span class="w"> </span>i<span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>self<span class="p">[</span>i<span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>value<span class="p">)</span><span class="w"> </span><span class="kt">return</span><span class="w"> </span>i<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>type<span class="p">(</span><span class="kt">uint</span><span class="p">).</span>max<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
using<span class="w"> </span>Search<span class="w"> </span><span class="kt">for</span><span class="w"> </span><span class="kt">uint</span><span class="p">[];</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">C</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="p">[]</span><span class="w"> </span>data<span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">append</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>data<span class="p">.</span>push<span class="p">(</span>value<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">replace</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">from</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">to</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// This performs the library function call</span>
<span class="w">        </span><span class="kt">uint</span><span class="w"> </span><span class="nv">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>data<span class="p">.</span>indexOf<span class="p">(</span>from<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>index<span class="w"> </span><span class="o">==</span><span class="w"> </span>type<span class="p">(</span><span class="kt">uint</span><span class="p">).</span>max<span class="p">)</span><span class="w"></span>
<span class="w">            </span>data<span class="p">.</span>push<span class="p">(</span>to<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">else</span><span class="w"></span>
<span class="w">            </span>data<span class="p">[</span>index<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>to<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Note that all external library calls are actual EVM function calls. This means that
if you pass memory or value types, a copy will be performed, even in case of the
<code class="docutils literal notranslate"><span class="pre">self</span></code> variable. The only situation where no copy will be performed
is when storage reference variables are used or when internal library
functions are called.</p>
</section>
</section>
<span id="document-assembly"></span><section id="inline-assembly">
<span id="id1"></span><h2>Inline Assembly<a class="headerlink" href="#inline-assembly" title="Permalink to this heading">ÔÉÅ</a></h2>
<p id="index-0">You can interleave Solidity statements with inline assembly in a language close
to the one of the Ethereum virtual machine. This gives you more fine-grained control,
which is especially useful when you are enhancing the language by writing libraries.</p>
<p>The language used for inline assembly in Solidity is called <a class="reference internal" href="index.html#yul"><span class="std std-ref">Yul</span></a>
and it is documented in its own section. This section will only cover
how the inline assembly code can interface with the surrounding Solidity code.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Inline assembly is a way to access the Ethereum Virtual Machine
at a low level. This bypasses several important safety
features and checks of Solidity. You should only use it for
tasks that need it, and only if you are confident with using it.</p>
</div>
<p>An inline assembly block is marked by <code class="docutils literal notranslate"><span class="pre">assembly</span> <span class="pre">{</span> <span class="pre">...</span> <span class="pre">}</span></code>, where the code inside
the curly braces is code in the <a class="reference internal" href="index.html#yul"><span class="std std-ref">Yul</span></a> language.</p>
<p>The inline assembly code can access local Solidity variables as explained below.</p>
<p>Different inline assembly blocks share no namespace, i.e. it is not possible
to call a Yul function or access a Yul variable defined in a different inline assembly block.</p>
<section id="example">
<h3>Example<a class="headerlink" href="#example" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>The following example provides library code to access the code of another contract and
load it into a <code class="docutils literal notranslate"><span class="pre">bytes</span></code> variable. This is possible with ‚Äúplain Solidity‚Äù too, by using
<code class="docutils literal notranslate"><span class="pre">&lt;address&gt;.code</span></code>. But the point here is that reusable assembly libraries can enhance the
Solidity language without a compiler change.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC40LjE2IDwwLjkuMDsKCmxpYnJhcnkgR2V0Q29kZSB7CiAgICBmdW5jdGlvbiBhdChhZGRyZXNzIGFkZHIpIHB1YmxpYyB2aWV3IHJldHVybnMgKGJ5dGVzIG1lbW9yeSBjb2RlKSB7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICAvLyByZXRyaWV2ZSB0aGUgc2l6ZSBvZiB0aGUgY29kZSwgdGhpcyBuZWVkcyBhc3NlbWJseQogICAgICAgICAgICBsZXQgc2l6ZSA6PSBleHRjb2Rlc2l6ZShhZGRyKQogICAgICAgICAgICAvLyBhbGxvY2F0ZSBvdXRwdXQgYnl0ZSBhcnJheSAtIHRoaXMgY291bGQgYWxzbyBiZSBkb25lIHdpdGhvdXQgYXNzZW1ibHkKICAgICAgICAgICAgLy8gYnkgdXNpbmcgY29kZSA9IG5ldyBieXRlcyhzaXplKQogICAgICAgICAgICBjb2RlIDo9IG1sb2FkKDB4NDApCiAgICAgICAgICAgIC8vIG5ldyAibWVtb3J5IGVuZCIgaW5jbHVkaW5nIHBhZGRpbmcKICAgICAgICAgICAgbXN0b3JlKDB4NDAsIGFkZChjb2RlLCBhbmQoYWRkKGFkZChzaXplLCAweDIwKSwgMHgxZiksIG5vdCgweDFmKSkpKQogICAgICAgICAgICAvLyBzdG9yZSBsZW5ndGggaW4gbWVtb3J5CiAgICAgICAgICAgIG1zdG9yZShjb2RlLCBzaXplKQogICAgICAgICAgICAvLyBhY3R1YWxseSByZXRyaWV2ZSB0aGUgY29kZSwgdGhpcyBuZWVkcyBhc3NlbWJseQogICAgICAgICAgICBleHRjb2RlY29weShhZGRyLCBhZGQoY29kZSwgMHgyMCksIDAsIHNpemUpCiAgICAgICAgfQogICAgfQp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.4.16</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="kt">library</span><span class="w"> </span>GetCode<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">at</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">addr</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bytes</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>code<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>assembly<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="c1">// retrieve the size of the code, this needs assembly</span>
<span class="w">            </span>let<span class="w"> </span>size<span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span>extcodesize<span class="p">(</span>addr<span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="c1">// allocate output byte array - this could also be done without assembly</span>
<span class="w">            </span><span class="c1">// by using code = new bytes(size)</span>
<span class="w">            </span>code<span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span>mload<span class="p">(</span><span class="mh">0x40</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="c1">// new &quot;memory end&quot; including padding</span>
<span class="w">            </span>mstore<span class="p">(</span><span class="mh">0x40</span><span class="p">,</span><span class="w"> </span>add<span class="p">(</span>code<span class="p">,</span><span class="w"> </span>and<span class="p">(</span>add<span class="p">(</span>add<span class="p">(</span>size<span class="p">,</span><span class="w"> </span><span class="mh">0x20</span><span class="p">),</span><span class="w"> </span><span class="mh">0x1f</span><span class="p">),</span><span class="w"> </span>not<span class="p">(</span><span class="mh">0x1f</span><span class="p">))))</span><span class="w"></span>
<span class="w">            </span><span class="c1">// store length in memory</span>
<span class="w">            </span>mstore<span class="p">(</span>code<span class="p">,</span><span class="w"> </span>size<span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="c1">// actually retrieve the code, this needs assembly</span>
<span class="w">            </span>extcodecopy<span class="p">(</span>addr<span class="p">,</span><span class="w"> </span>add<span class="p">(</span>code<span class="p">,</span><span class="w"> </span><span class="mh">0x20</span><span class="p">),</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">,</span><span class="w"> </span>size<span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Inline assembly is also beneficial in cases where the optimizer fails to produce
efficient code, for example:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC40LjE2IDwwLjkuMDsKCgpsaWJyYXJ5IFZlY3RvclN1bSB7CiAgICAvLyBUaGlzIGZ1bmN0aW9uIGlzIGxlc3MgZWZmaWNpZW50IGJlY2F1c2UgdGhlIG9wdGltaXplciBjdXJyZW50bHkgZmFpbHMgdG8KICAgIC8vIHJlbW92ZSB0aGUgYm91bmRzIGNoZWNrcyBpbiBhcnJheSBhY2Nlc3MuCiAgICBmdW5jdGlvbiBzdW1Tb2xpZGl0eSh1aW50W10gbWVtb3J5IGRhdGEpIHB1YmxpYyBwdXJlIHJldHVybnMgKHVpbnQgc3VtKSB7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7ICsraSkKICAgICAgICAgICAgc3VtICs9IGRhdGFbaV07CiAgICB9CgogICAgLy8gV2Uga25vdyB0aGF0IHdlIG9ubHkgYWNjZXNzIHRoZSBhcnJheSBpbiBib3VuZHMsIHNvIHdlIGNhbiBhdm9pZCB0aGUgY2hlY2suCiAgICAvLyAweDIwIG5lZWRzIHRvIGJlIGFkZGVkIHRvIGFuIGFycmF5IGJlY2F1c2UgdGhlIGZpcnN0IHNsb3QgY29udGFpbnMgdGhlCiAgICAvLyBhcnJheSBsZW5ndGguCiAgICBmdW5jdGlvbiBzdW1Bc20odWludFtdIG1lbW9yeSBkYXRhKSBwdWJsaWMgcHVyZSByZXR1cm5zICh1aW50IHN1bSkgewogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGRhdGEubGVuZ3RoOyArK2kpIHsKICAgICAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICAgICAgc3VtIDo9IGFkZChzdW0sIG1sb2FkKGFkZChhZGQoZGF0YSwgMHgyMCksIG11bChpLCAweDIwKSkpKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8vIFNhbWUgYXMgYWJvdmUsIGJ1dCBhY2NvbXBsaXNoIHRoZSBlbnRpcmUgY29kZSB3aXRoaW4gaW5saW5lIGFzc2VtYmx5LgogICAgZnVuY3Rpb24gc3VtUHVyZUFzbSh1aW50W10gbWVtb3J5IGRhdGEpIHB1YmxpYyBwdXJlIHJldHVybnMgKHVpbnQgc3VtKSB7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICAvLyBMb2FkIHRoZSBsZW5ndGggKGZpcnN0IDMyIGJ5dGVzKQogICAgICAgICAgICBsZXQgbGVuIDo9IG1sb2FkKGRhdGEpCgogICAgICAgICAgICAvLyBTa2lwIG92ZXIgdGhlIGxlbmd0aCBmaWVsZC4KICAgICAgICAgICAgLy8KICAgICAgICAgICAgLy8gS2VlcCB0ZW1wb3JhcnkgdmFyaWFibGUgc28gaXQgY2FuIGJlIGluY3JlbWVudGVkIGluIHBsYWNlLgogICAgICAgICAgICAvLwogICAgICAgICAgICAvLyBOT1RFOiBpbmNyZW1lbnRpbmcgZGF0YSB3b3VsZCByZXN1bHQgaW4gYW4gdW51c2FibGUKICAgICAgICAgICAgLy8gICAgICAgZGF0YSB2YXJpYWJsZSBhZnRlciB0aGlzIGFzc2VtYmx5IGJsb2NrCiAgICAgICAgICAgIGxldCBkYXRhRWxlbWVudExvY2F0aW9uIDo9IGFkZChkYXRhLCAweDIwKQoKICAgICAgICAgICAgLy8gSXRlcmF0ZSB1bnRpbCB0aGUgYm91bmQgaXMgbm90IG1ldC4KICAgICAgICAgICAgZm9yCiAgICAgICAgICAgICAgICB7IGxldCBlbmQgOj0gYWRkKGRhdGFFbGVtZW50TG9jYXRpb24sIG11bChsZW4sIDB4MjApKSB9CiAgICAgICAgICAgICAgICBsdChkYXRhRWxlbWVudExvY2F0aW9uLCBlbmQpCiAgICAgICAgICAgICAgICB7IGRhdGEgOj0gYWRkKGRhdGFFbGVtZW50TG9jYXRpb24sIDB4MjApIH0KICAgICAgICAgICAgewogICAgICAgICAgICAgICAgc3VtIDo9IGFkZChzdW0sIG1sb2FkKGRhdGFFbGVtZW50TG9jYXRpb24pKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.4.16</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>


<span class="kt">library</span><span class="w"> </span>VectorSum<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// This function is less efficient because the optimizer currently fails to</span>
<span class="w">    </span><span class="c1">// remove the bounds checks in array access.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">sumSolidity</span><span class="p">(</span><span class="kt">uint</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>data<span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">sum</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">for</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span><span class="w"> </span>i<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>data<span class="p">.</span>length<span class="p">;</span><span class="w"> </span><span class="o">++</span>i<span class="p">)</span><span class="w"></span>
<span class="w">            </span>sum<span class="w"> </span><span class="o">+=</span><span class="w"> </span>data<span class="p">[</span>i<span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">// We know that we only access the array in bounds, so we can avoid the check.</span>
<span class="w">    </span><span class="c1">// 0x20 needs to be added to an array because the first slot contains the</span>
<span class="w">    </span><span class="c1">// array length.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">sumAsm</span><span class="p">(</span><span class="kt">uint</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>data<span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">sum</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">for</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span><span class="w"> </span>i<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>data<span class="p">.</span>length<span class="p">;</span><span class="w"> </span><span class="o">++</span>i<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span>assembly<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span>sum<span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span>add<span class="p">(</span>sum<span class="p">,</span><span class="w"> </span>mload<span class="p">(</span>add<span class="p">(</span>add<span class="p">(</span>data<span class="p">,</span><span class="w"> </span><span class="mh">0x20</span><span class="p">),</span><span class="w"> </span>mul<span class="p">(</span>i<span class="p">,</span><span class="w"> </span><span class="mh">0x20</span><span class="p">))))</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Same as above, but accomplish the entire code within inline assembly.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">sumPureAsm</span><span class="p">(</span><span class="kt">uint</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>data<span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">sum</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>assembly<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="c1">// Load the length (first 32 bytes)</span>
<span class="w">            </span>let<span class="w"> </span>len<span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span>mload<span class="p">(</span>data<span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="c1">// Skip over the length field.</span>
<span class="w">            </span><span class="c1">//</span>
<span class="w">            </span><span class="c1">// Keep temporary variable so it can be incremented in place.</span>
<span class="w">            </span><span class="c1">//</span>
<span class="w">            </span><span class="c1">// NOTE: incrementing data would result in an unusable</span>
<span class="w">            </span><span class="c1">//       data variable after this assembly block</span>
<span class="w">            </span>let<span class="w"> </span>dataElementLocation<span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span>add<span class="p">(</span>data<span class="p">,</span><span class="w"> </span><span class="mh">0x20</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="c1">// Iterate until the bound is not met.</span>
<span class="w">            </span><span class="kt">for</span><span class="w"></span>
<span class="w">                </span><span class="p">{</span><span class="w"> </span>let<span class="w"> </span>end<span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span>add<span class="p">(</span>dataElementLocation<span class="p">,</span><span class="w"> </span>mul<span class="p">(</span>len<span class="p">,</span><span class="w"> </span><span class="mh">0x20</span><span class="p">))</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">                </span>lt<span class="p">(</span>dataElementLocation<span class="p">,</span><span class="w"> </span>end<span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="p">{</span><span class="w"> </span>data<span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span>add<span class="p">(</span>dataElementLocation<span class="p">,</span><span class="w"> </span><span class="mh">0x20</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span>sum<span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span>add<span class="p">(</span>sum<span class="p">,</span><span class="w"> </span>mload<span class="p">(</span>dataElementLocation<span class="p">))</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="access-to-external-variables-functions-and-libraries">
<span id="index-1"></span><h3>Access to External Variables, Functions and Libraries<a class="headerlink" href="#access-to-external-variables-functions-and-libraries" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>You can access Solidity variables and other identifiers by using their name.</p>
<p>Local variables of value type are directly usable in inline assembly.
They can both be read and assigned to.</p>
<p>Local variables that refer to memory evaluate to the address of the variable in memory not the value itself.
Such variables can also be assigned to, but note that an assignment will only change the pointer and not the data
and that it is your responsibility to respect Solidity‚Äôs memory management.
See <a class="reference internal" href="#conventions-in-solidity"><span class="std std-ref">Conventions in Solidity</span></a>.</p>
<p>Similarly, local variables that refer to statically-sized calldata arrays or calldata structs
evaluate to the address of the variable in calldata, not the value itself.
The variable can also be assigned a new offset, but note that no validation to ensure that
the variable will not point beyond <code class="docutils literal notranslate"><span class="pre">calldatasize()</span></code> is performed.</p>
<p>For external function pointers the address and the function selector can be
accessed using <code class="docutils literal notranslate"><span class="pre">x.address</span></code> and <code class="docutils literal notranslate"><span class="pre">x.selector</span></code>.
The selector consists of four right-aligned bytes.
Both values can be assigned to. For example:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC44LjEwIDwwLjkuMDsKCmNvbnRyYWN0IEMgewogICAgLy8gQXNzaWducyBhIG5ldyBzZWxlY3RvciBhbmQgYWRkcmVzcyB0byB0aGUgcmV0dXJuIHZhcmlhYmxlIEBmdW4KICAgIGZ1bmN0aW9uIGNvbWJpbmVUb0Z1bmN0aW9uUG9pbnRlcihhZGRyZXNzIG5ld0FkZHJlc3MsIHVpbnQgbmV3U2VsZWN0b3IpIHB1YmxpYyBwdXJlIHJldHVybnMgKGZ1bmN0aW9uKCkgZXh0ZXJuYWwgZnVuKSB7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICBmdW4uc2VsZWN0b3IgOj0gbmV3U2VsZWN0b3IKICAgICAgICAgICAgZnVuLmFkZHJlc3MgIDo9IG5ld0FkZHJlc3MKICAgICAgICB9CiAgICB9Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.8.10</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">C</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Assigns a new selector and address to the return variable @fun</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">combineToFunctionPointer</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">newAddress</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">newSelector</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">function</span><span class="p">()</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>fun<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>assembly<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span>fun<span class="p">.</span>selector<span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span>newSelector<span class="w"></span>
<span class="w">            </span>fun<span class="p">.</span><span class="kt">address</span><span class="w">  </span><span class="p">:</span><span class="o">=</span><span class="w"> </span>newAddress<span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>For dynamic calldata arrays, you can access
their calldata offset (in bytes) and length (number of elements) using <code class="docutils literal notranslate"><span class="pre">x.offset</span></code> and <code class="docutils literal notranslate"><span class="pre">x.length</span></code>.
Both expressions can also be assigned to, but as for the static case, no validation will be performed
to ensure that the resulting data area is within the bounds of <code class="docutils literal notranslate"><span class="pre">calldatasize()</span></code>.</p>
<p>For local storage variables or state variables, a single Yul identifier
is not sufficient, since they do not necessarily occupy a single full storage slot.
Therefore, their ‚Äúaddress‚Äù is composed of a slot and a byte-offset
inside that slot. To retrieve the slot pointed to by the variable <code class="docutils literal notranslate"><span class="pre">x</span></code>, you
use <code class="docutils literal notranslate"><span class="pre">x.slot</span></code>, and to retrieve the byte-offset you use <code class="docutils literal notranslate"><span class="pre">x.offset</span></code>.
Using <code class="docutils literal notranslate"><span class="pre">x</span></code> itself will result in an error.</p>
<p>You can also assign to the <code class="docutils literal notranslate"><span class="pre">.slot</span></code> part of a local storage variable pointer.
For these (structs, arrays or mappings), the <code class="docutils literal notranslate"><span class="pre">.offset</span></code> part is always zero.
It is not possible to assign to the <code class="docutils literal notranslate"><span class="pre">.slot</span></code> or <code class="docutils literal notranslate"><span class="pre">.offset</span></code> part of a state variable,
though.</p>
<p>Local Solidity variables are available for assignments, for example:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC43LjAgPDAuOS4wOwoKY29udHJhY3QgQyB7CiAgICB1aW50IGI7CiAgICBmdW5jdGlvbiBmKHVpbnQgeCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCByKSB7CiAgICAgICAgYXNzZW1ibHkgewogICAgICAgICAgICAvLyBXZSBpZ25vcmUgdGhlIHN0b3JhZ2Ugc2xvdCBvZmZzZXQsIHdlIGtub3cgaXQgaXMgemVybwogICAgICAgICAgICAvLyBpbiB0aGlzIHNwZWNpYWwgY2FzZS4KICAgICAgICAgICAgciA6PSBtdWwoeCwgc2xvYWQoYi5zbG90KSkKICAgICAgICB9CiAgICB9Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.7.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">C</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="nv">b</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">f</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">x</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>assembly<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="c1">// We ignore the storage slot offset, we know it is zero</span>
<span class="w">            </span><span class="c1">// in this special case.</span>
<span class="w">            </span>r<span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span>mul<span class="p">(</span>x<span class="p">,</span><span class="w"> </span>sload<span class="p">(</span>b<span class="p">.</span>slot<span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If you access variables of a type that spans less than 256 bits
(for example <code class="docutils literal notranslate"><span class="pre">uint64</span></code>, <code class="docutils literal notranslate"><span class="pre">address</span></code>, or <code class="docutils literal notranslate"><span class="pre">bytes16</span></code>),
you cannot make any assumptions about bits not part of the
encoding of the type. Especially, do not assume them to be zero.
To be safe, always clear the data properly before you use it
in a context where this is important:
<code class="docutils literal notranslate"><span class="pre">uint32</span> <span class="pre">x</span> <span class="pre">=</span> <span class="pre">f();</span> <span class="pre">assembly</span> <span class="pre">{</span> <span class="pre">x</span> <span class="pre">:=</span> <span class="pre">and(x,</span> <span class="pre">0xffffffff)</span> <span class="pre">/*</span> <span class="pre">now</span> <span class="pre">use</span> <span class="pre">x</span> <span class="pre">*/</span> <span class="pre">}</span></code>
To clean signed types, you can use the <code class="docutils literal notranslate"><span class="pre">signextend</span></code> opcode:
<code class="docutils literal notranslate"><span class="pre">assembly</span> <span class="pre">{</span> <span class="pre">signextend(&lt;num_bytes_of_x_minus_one&gt;,</span> <span class="pre">x)</span> <span class="pre">}</span></code></p>
</div>
<p>Since Solidity 0.6.0 the name of a inline assembly variable may not
shadow any declaration visible in the scope of the inline assembly block
(including variable, contract and function declarations).</p>
<p>Since Solidity 0.7.0, variables and functions declared inside the
inline assembly block may not contain <code class="docutils literal notranslate"><span class="pre">.</span></code>, but using <code class="docutils literal notranslate"><span class="pre">.</span></code> is
valid to access Solidity variables from outside the inline assembly block.</p>
</section>
<section id="things-to-avoid">
<h3>Things to Avoid<a class="headerlink" href="#things-to-avoid" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Inline assembly might have a quite high-level look, but it actually is extremely
low-level. Function calls, loops, ifs and switches are converted by simple
rewriting rules and after that, the only thing the assembler does for you is re-arranging
functional-style opcodes, counting stack height for
variable access and removing stack slots for assembly-local variables when the end
of their block is reached.</p>
</section>
<section id="conventions-in-solidity">
<span id="id2"></span><h3>Conventions in Solidity<a class="headerlink" href="#conventions-in-solidity" title="Permalink to this heading">ÔÉÅ</a></h3>
<section id="values-of-typed-variables">
<span id="assembly-typed-variables"></span><h4>Values of Typed Variables<a class="headerlink" href="#values-of-typed-variables" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>In contrast to EVM assembly, Solidity has types which are narrower than 256 bits,
e.g. <code class="docutils literal notranslate"><span class="pre">uint24</span></code>. For efficiency, most arithmetic operations ignore the fact that
types can be shorter than 256
bits, and the higher-order bits are cleaned when necessary,
i.e., shortly before they are written to memory or before comparisons are performed.
This means that if you access such a variable
from within inline assembly, you might have to manually clean the higher-order bits
first.</p>
</section>
<section id="memory-management">
<span id="assembly-memory-management"></span><h4>Memory Management<a class="headerlink" href="#memory-management" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Solidity manages memory in the following way. There is a ‚Äúfree memory pointer‚Äù
at position <code class="docutils literal notranslate"><span class="pre">0x40</span></code> in memory. If you want to allocate memory, use the memory
starting from where this pointer points at and update it.
There is no guarantee that the memory has not been used before and thus
you cannot assume that its contents are zero bytes.
There is no built-in mechanism to release or free allocated memory.
Here is an assembly snippet you can use for allocating memory that follows the process outlined above</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=yul&amp;version=0.8.15&amp;code=ZnVuY3Rpb24gYWxsb2NhdGUobGVuZ3RoKSAtPiBwb3MgewogIHBvcyA6PSBtbG9hZCgweDQwKQogIG1zdG9yZSgweDQwLCBhZGQocG9zLCBsZW5ndGgpKQp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-yul notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="n">allocate</span><span class="p">(</span><span class="n">length</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pos</span> <span class="p">{</span>
  <span class="n">pos</span> <span class="o">:=</span> <span class="nf">mload</span><span class="p">(</span><span class="mh">0x40</span><span class="p">)</span>
  <span class="nf">mstore</span><span class="p">(</span><span class="mh">0x40</span><span class="p">,</span> <span class="nf">add</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">length</span><span class="p">))</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The first 64 bytes of memory can be used as ‚Äúscratch space‚Äù for short-term
allocation. The 32 bytes after the free memory pointer (i.e., starting at <code class="docutils literal notranslate"><span class="pre">0x60</span></code>)
are meant to be zero permanently and is used as the initial value for
empty dynamic memory arrays.
This means that the allocatable memory starts at <code class="docutils literal notranslate"><span class="pre">0x80</span></code>, which is the initial value
of the free memory pointer.</p>
<p>Elements in memory arrays in Solidity always occupy multiples of 32 bytes (this is
even true for <code class="docutils literal notranslate"><span class="pre">bytes1[]</span></code>, but not for <code class="docutils literal notranslate"><span class="pre">bytes</span></code> and <code class="docutils literal notranslate"><span class="pre">string</span></code>). Multi-dimensional memory
arrays are pointers to memory arrays. The length of a dynamic array is stored at the
first slot of the array and followed by the array elements.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Statically-sized memory arrays do not have a length field, but it might be added later
to allow better convertibility between statically- and dynamically-sized arrays, so
do not rely on this.</p>
</div>
</section>
<section id="memory-safety">
<h4>Memory Safety<a class="headerlink" href="#memory-safety" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Without the use of inline assembly, the compiler can rely on memory to remain in a well-defined
state at all times. This is especially relevant for <a class="reference internal" href="index.html#ir-breaking-changes"><span class="std std-ref">the new code generation pipeline via Yul IR</span></a>:
this code generation path can move local variables from stack to memory to avoid stack-too-deep errors and
perform additional memory optimizations, if it can rely on certain assumptions about memory use.</p>
<p>While we recommend to always respect Solidity‚Äôs memory model, inline assembly allows you to use memory
in an incompatible way. Therefore, moving stack variables to memory and additional memory optimizations are,
by default, disabled in the presence of any inline assembly block that contains a memory operation or assigns
to solidity variables in memory.</p>
<p>However, you can specifically annotate an assembly block to indicate that it in fact respects Solidity‚Äôs memory
model as follows:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=YXNzZW1ibHkgKCJtZW1vcnktc2FmZSIpIHsKICAgIC4uLgp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span>assembly<span class="w"> </span><span class="p">(</span><span class="s2">&quot;memory-safe&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">...</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>In particular, a memory-safe assembly block may only access the following memory ranges:</p>
<ul class="simple">
<li><p>Memory allocated by yourself using a mechanism like the <code class="docutils literal notranslate"><span class="pre">allocate</span></code> function described above.</p></li>
<li><p>Memory allocated by Solidity, e.g. memory within the bounds of a memory array you reference.</p></li>
<li><p>The scratch space between memory offset 0 and 64 mentioned above.</p></li>
<li><p>Temporary memory that is located <em>after</em> the value of the free memory pointer at the beginning of the assembly block,
i.e. memory that is ‚Äúallocated‚Äù at the free memory pointer without updating the free memory pointer.</p></li>
</ul>
<p>Furthermore, if the assembly block assigns to Solidity variables in memory, you need to assure that accesses to
the Solidity variables only access these memory ranges.</p>
<p>Since this is mainly about the optimizer, these restrictions still need to be followed, even if the assembly block
reverts or terminates. As an example, the following assembly snippet is not memory safe, because the value of
<code class="docutils literal notranslate"><span class="pre">returndatasize()</span></code> may exceed the 64 byte scratch space:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=YXNzZW1ibHkgewogIHJldHVybmRhdGFjb3B5KDAsIDAsIHJldHVybmRhdGFzaXplKCkpCiAgcmV2ZXJ0KDAsIHJldHVybmRhdGFzaXplKCkpCn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span>assembly<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span>returndatacopy<span class="p">(</span><span class="m m-Decimal">0</span><span class="p">,</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">,</span><span class="w"> </span>returndatasize<span class="p">())</span><span class="w"></span>
<span class="w">  </span>revert<span class="p">(</span><span class="m m-Decimal">0</span><span class="p">,</span><span class="w"> </span>returndatasize<span class="p">())</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>On the other hand, the following code <em>is</em> memory safe, because memory beyond the location pointed to by the
free memory pointer can safely be used as temporary scratch space:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=YXNzZW1ibHkgKCJtZW1vcnktc2FmZSIpIHsKICBsZXQgcCA6PSBtbG9hZCgweDQwKQogIHJldHVybmRhdGFjb3B5KHAsIDAsIHJldHVybmRhdGFzaXplKCkpCiAgcmV2ZXJ0KHAsIHJldHVybmRhdGFzaXplKCkpCn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span>assembly<span class="w"> </span><span class="p">(</span><span class="s2">&quot;memory-safe&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span>let<span class="w"> </span>p<span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span>mload<span class="p">(</span><span class="mh">0x40</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span>returndatacopy<span class="p">(</span>p<span class="p">,</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">,</span><span class="w"> </span>returndatasize<span class="p">())</span><span class="w"></span>
<span class="w">  </span>revert<span class="p">(</span>p<span class="p">,</span><span class="w"> </span>returndatasize<span class="p">())</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Note that you do not need to update the free memory pointer if there is no following allocation,
but you can only use memory starting from the current offset given by the free memory pointer.</p>
<p>If the memory operations use a length of zero, it is also fine to just use any offset (not only if it falls into the scratch space):</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=YXNzZW1ibHkgKCJtZW1vcnktc2FmZSIpIHsKICByZXZlcnQoMCwgMCkKfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span>assembly<span class="w"> </span><span class="p">(</span><span class="s2">&quot;memory-safe&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span>revert<span class="p">(</span><span class="m m-Decimal">0</span><span class="p">,</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Note that not only memory operations in inline assembly itself can be memory-unsafe, but also assignments to
solidity variables of reference type in memory. For example the following is not memory-safe:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ynl0ZXMgbWVtb3J5IHg7CmFzc2VtYmx5IHsKICB4IDo9IDB4NDAKfQp4WzB4MjBdID0gMHg0Mjs="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">bytes</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>x<span class="p">;</span><span class="w"></span>
assembly<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span>x<span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="mh">0x40</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
x<span class="p">[</span><span class="mh">0x20</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x42</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>Inline assembly that neither involves any operations that access memory nor assigns to any solidity variables
in memory is automatically considered memory-safe and does not need to be annotated.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>It is your responsibility to make sure that the assembly actually satisfies the memory model. If you annotate
an assembly block as memory-safe, but violate one of the memory assumptions, this <strong>will</strong> lead to incorrect and
undefined behaviour that cannot easily be discovered by testing.</p>
</div>
<p>In case you are developing a library that is meant to be compatible across multiple versions
of solidity, you can use a special comment to annotate an assembly block as memory-safe:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8vIEBzb2xpZGl0eSBtZW1vcnktc2FmZS1hc3NlbWJseQphc3NlbWJseSB7CiAgICAuLi4KfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">/// @solidity memory-safe-assembly</span>
assembly<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">...</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Note that we will disallow the annotation via comment in a future breaking release, so if you are not concerned with
backwards-compatibility with older compiler versions, prefer using the dialect string.</p>
</section>
</section>
</section>
<span id="document-cheatsheet"></span><section id="cheatsheet">
<h2>Cheatsheet<a class="headerlink" href="#cheatsheet" title="Permalink to this heading">ÔÉÅ</a></h2>
<section id="order-of-precedence-of-operators">
<span id="index-0"></span><h3>Order of Precedence of Operators<a class="headerlink" href="#order-of-precedence-of-operators" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>The following is the order of precedence for operators, listed in order of evaluation.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 13%" />
<col style="width: 40%" />
<col style="width: 47%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Precedence</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Operator</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td rowspan="6"><p><em>1</em></p></td>
<td><p>Postfix increment and decrement</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">++</span></code>, <code class="docutils literal notranslate"><span class="pre">--</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>New expression</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">new</span> <span class="pre">&lt;typename&gt;</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Array subscripting</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;array&gt;[&lt;index&gt;]</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Member access</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;object&gt;.&lt;member&gt;</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Function-like call</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;func&gt;(&lt;args...&gt;)</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Parentheses</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">(&lt;statement&gt;)</span></code></p></td>
</tr>
<tr class="row-even"><td rowspan="5"><p><em>2</em></p></td>
<td><p>Prefix increment and decrement</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">++</span></code>, <code class="docutils literal notranslate"><span class="pre">--</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Unary minus</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">-</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Unary operations</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">delete</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Logical NOT</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">!</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Bitwise NOT</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">~</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><em>3</em></p></td>
<td><p>Exponentiation</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">**</span></code></p></td>
</tr>
<tr class="row-even"><td><p><em>4</em></p></td>
<td><p>Multiplication, division and modulo</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">*</span></code>, <code class="docutils literal notranslate"><span class="pre">/</span></code>, <code class="docutils literal notranslate"><span class="pre">%</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><em>5</em></p></td>
<td><p>Addition and subtraction</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">+</span></code>, <code class="docutils literal notranslate"><span class="pre">-</span></code></p></td>
</tr>
<tr class="row-even"><td><p><em>6</em></p></td>
<td><p>Bitwise shift operators</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;&lt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;&gt;</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><em>7</em></p></td>
<td><p>Bitwise AND</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&amp;</span></code></p></td>
</tr>
<tr class="row-even"><td><p><em>8</em></p></td>
<td><p>Bitwise XOR</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">^</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><em>9</em></p></td>
<td><p>Bitwise OR</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">|</span></code></p></td>
</tr>
<tr class="row-even"><td><p><em>10</em></p></td>
<td><p>Inequality operators</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;=</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;=</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><em>11</em></p></td>
<td><p>Equality operators</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">==</span></code>, <code class="docutils literal notranslate"><span class="pre">!=</span></code></p></td>
</tr>
<tr class="row-even"><td><p><em>12</em></p></td>
<td><p>Logical AND</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><em>13</em></p></td>
<td><p>Logical OR</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">||</span></code></p></td>
</tr>
<tr class="row-even"><td rowspan="2"><p><em>14</em></p></td>
<td><p>Ternary operator</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&lt;conditional&gt;</span> <span class="pre">?</span> <span class="pre">&lt;if-true&gt;</span> <span class="pre">:</span> <span class="pre">&lt;if-false&gt;</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>Assignment operators</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">=</span></code>, <code class="docutils literal notranslate"><span class="pre">|=</span></code>, <code class="docutils literal notranslate"><span class="pre">^=</span></code>, <code class="docutils literal notranslate"><span class="pre">&amp;=</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;&lt;=</span></code>,
<code class="docutils literal notranslate"><span class="pre">&gt;&gt;=</span></code>, <code class="docutils literal notranslate"><span class="pre">+=</span></code>, <code class="docutils literal notranslate"><span class="pre">-=</span></code>, <code class="docutils literal notranslate"><span class="pre">*=</span></code>, <code class="docutils literal notranslate"><span class="pre">/=</span></code>,
<code class="docutils literal notranslate"><span class="pre">%=</span></code></p></td>
</tr>
<tr class="row-even"><td><p><em>15</em></p></td>
<td><p>Comma operator</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">,</span></code></p></td>
</tr>
</tbody>
</table>
</section>
<section id="global-variables">
<span id="index-1"></span><h3>Global Variables<a class="headerlink" href="#global-variables" title="Permalink to this heading">ÔÉÅ</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">abi.decode(bytes</span> <span class="pre">memory</span> <span class="pre">encodedData,</span> <span class="pre">(...))</span> <span class="pre">returns</span> <span class="pre">(...)</span></code>: <a class="reference internal" href="index.html#abi"><span class="std std-ref">ABI</span></a>-decodes
the provided data. The types are given in parentheses as second argument.
Example: <code class="docutils literal notranslate"><span class="pre">(uint</span> <span class="pre">a,</span> <span class="pre">uint[2]</span> <span class="pre">memory</span> <span class="pre">b,</span> <span class="pre">bytes</span> <span class="pre">memory</span> <span class="pre">c)</span> <span class="pre">=</span> <span class="pre">abi.decode(data,</span> <span class="pre">(uint,</span> <span class="pre">uint[2],</span> <span class="pre">bytes))</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">abi.encode(...)</span> <span class="pre">returns</span> <span class="pre">(bytes</span> <span class="pre">memory)</span></code>: <a class="reference internal" href="index.html#abi"><span class="std std-ref">ABI</span></a>-encodes the given arguments</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">abi.encodePacked(...)</span> <span class="pre">returns</span> <span class="pre">(bytes</span> <span class="pre">memory)</span></code>: Performs <a class="reference internal" href="index.html#abi-packed-mode"><span class="std std-ref">packed encoding</span></a> of
the given arguments. Note that this encoding can be ambiguous!</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">abi.encodeWithSelector(bytes4</span> <span class="pre">selector,</span> <span class="pre">...)</span> <span class="pre">returns</span> <span class="pre">(bytes</span> <span class="pre">memory)</span></code>: <a class="reference internal" href="index.html#abi"><span class="std std-ref">ABI</span></a>-encodes
the given arguments starting from the second and prepends the given four-byte selector</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">abi.encodeCall(function</span> <span class="pre">functionPointer,</span> <span class="pre">(...))</span> <span class="pre">returns</span> <span class="pre">(bytes</span> <span class="pre">memory)</span></code>: ABI-encodes a call to <code class="docutils literal notranslate"><span class="pre">functionPointer</span></code> with the arguments found in the
tuple. Performs a full type-check, ensuring the types match the function signature. Result equals <code class="docutils literal notranslate"><span class="pre">abi.encodeWithSelector(functionPointer.selector,</span> <span class="pre">(...))</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">abi.encodeWithSignature(string</span> <span class="pre">memory</span> <span class="pre">signature,</span> <span class="pre">...)</span> <span class="pre">returns</span> <span class="pre">(bytes</span> <span class="pre">memory)</span></code>: Equivalent
to <code class="docutils literal notranslate"><span class="pre">abi.encodeWithSelector(bytes4(keccak256(bytes(signature)),</span> <span class="pre">...)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bytes.concat(...)</span> <span class="pre">returns</span> <span class="pre">(bytes</span> <span class="pre">memory)</span></code>: <a class="reference internal" href="index.html#bytes-concat"><span class="std std-ref">Concatenates variable number of
arguments to one byte array</span></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">string.concat(...)</span> <span class="pre">returns</span> <span class="pre">(string</span> <span class="pre">memory)</span></code>: <a class="reference internal" href="index.html#string-concat"><span class="std std-ref">Concatenates variable number of
arguments to one string array</span></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">block.basefee</span></code> (<code class="docutils literal notranslate"><span class="pre">uint</span></code>): current block‚Äôs base fee (<a class="reference external" href="https://eips.ethereum.org/EIPS/eip-3198">EIP-3198</a> and <a class="reference external" href="https://eips.ethereum.org/EIPS/eip-1559">EIP-1559</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">block.chainid</span></code> (<code class="docutils literal notranslate"><span class="pre">uint</span></code>): current chain id</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">block.coinbase</span></code> (<code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code>): current block miner‚Äôs address</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">block.difficulty</span></code> (<code class="docutils literal notranslate"><span class="pre">uint</span></code>): current block difficulty</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">block.gaslimit</span></code> (<code class="docutils literal notranslate"><span class="pre">uint</span></code>): current block gaslimit</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">block.number</span></code> (<code class="docutils literal notranslate"><span class="pre">uint</span></code>): current block number</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">block.timestamp</span></code> (<code class="docutils literal notranslate"><span class="pre">uint</span></code>): current block timestamp in seconds since Unix epoch</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gasleft()</span> <span class="pre">returns</span> <span class="pre">(uint256)</span></code>: remaining gas</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">msg.data</span></code> (<code class="docutils literal notranslate"><span class="pre">bytes</span></code>): complete calldata</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">msg.sender</span></code> (<code class="docutils literal notranslate"><span class="pre">address</span></code>): sender of the message (current call)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">msg.sig</span></code> (<code class="docutils literal notranslate"><span class="pre">bytes4</span></code>): first four bytes of the calldata (i.e. function identifier)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">msg.value</span></code> (<code class="docutils literal notranslate"><span class="pre">uint</span></code>): number of wei sent with the message</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tx.gasprice</span></code> (<code class="docutils literal notranslate"><span class="pre">uint</span></code>): gas price of the transaction</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tx.origin</span></code> (<code class="docutils literal notranslate"><span class="pre">address</span></code>): sender of the transaction (full call chain)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">assert(bool</span> <span class="pre">condition)</span></code>: abort execution and revert state changes if condition is <code class="docutils literal notranslate"><span class="pre">false</span></code> (use for internal error)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">require(bool</span> <span class="pre">condition)</span></code>: abort execution and revert state changes if condition is <code class="docutils literal notranslate"><span class="pre">false</span></code> (use
for malformed input or error in external component)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">require(bool</span> <span class="pre">condition,</span> <span class="pre">string</span> <span class="pre">memory</span> <span class="pre">message)</span></code>: abort execution and revert state changes if
condition is <code class="docutils literal notranslate"><span class="pre">false</span></code> (use for malformed input or error in external component). Also provide error message.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">revert()</span></code>: abort execution and revert state changes</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">revert(string</span> <span class="pre">memory</span> <span class="pre">message)</span></code>: abort execution and revert state changes providing an explanatory string</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">blockhash(uint</span> <span class="pre">blockNumber)</span> <span class="pre">returns</span> <span class="pre">(bytes32)</span></code>: hash of the given block - only works for 256 most recent blocks</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">keccak256(bytes</span> <span class="pre">memory)</span> <span class="pre">returns</span> <span class="pre">(bytes32)</span></code>: compute the Keccak-256 hash of the input</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sha256(bytes</span> <span class="pre">memory)</span> <span class="pre">returns</span> <span class="pre">(bytes32)</span></code>: compute the SHA-256 hash of the input</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ripemd160(bytes</span> <span class="pre">memory)</span> <span class="pre">returns</span> <span class="pre">(bytes20)</span></code>: compute the RIPEMD-160 hash of the input</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ecrecover(bytes32</span> <span class="pre">hash,</span> <span class="pre">uint8</span> <span class="pre">v,</span> <span class="pre">bytes32</span> <span class="pre">r,</span> <span class="pre">bytes32</span> <span class="pre">s)</span> <span class="pre">returns</span> <span class="pre">(address)</span></code>: recover address associated with
the public key from elliptic curve signature, return zero on error</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">addmod(uint</span> <span class="pre">x,</span> <span class="pre">uint</span> <span class="pre">y,</span> <span class="pre">uint</span> <span class="pre">k)</span> <span class="pre">returns</span> <span class="pre">(uint)</span></code>: compute <code class="docutils literal notranslate"><span class="pre">(x</span> <span class="pre">+</span> <span class="pre">y)</span> <span class="pre">%</span> <span class="pre">k</span></code> where the addition is performed with
arbitrary precision and does not wrap around at <code class="docutils literal notranslate"><span class="pre">2**256</span></code>. Assert that <code class="docutils literal notranslate"><span class="pre">k</span> <span class="pre">!=</span> <span class="pre">0</span></code> starting from version 0.5.0.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mulmod(uint</span> <span class="pre">x,</span> <span class="pre">uint</span> <span class="pre">y,</span> <span class="pre">uint</span> <span class="pre">k)</span> <span class="pre">returns</span> <span class="pre">(uint)</span></code>: compute <code class="docutils literal notranslate"><span class="pre">(x</span> <span class="pre">*</span> <span class="pre">y)</span> <span class="pre">%</span> <span class="pre">k</span></code> where the multiplication is performed
with arbitrary precision and does not wrap around at <code class="docutils literal notranslate"><span class="pre">2**256</span></code>. Assert that <code class="docutils literal notranslate"><span class="pre">k</span> <span class="pre">!=</span> <span class="pre">0</span></code> starting from version 0.5.0.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">this</span></code> (current contract‚Äôs type): the current contract, explicitly convertible to <code class="docutils literal notranslate"><span class="pre">address</span></code> or <code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">super</span></code>: the contract one level higher in the inheritance hierarchy</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">selfdestruct(address</span> <span class="pre">payable</span> <span class="pre">recipient)</span></code>: destroy the current contract, sending its funds to the given address</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;address&gt;.balance</span></code> (<code class="docutils literal notranslate"><span class="pre">uint256</span></code>): balance of the <a class="reference internal" href="index.html#address"><span class="std std-ref">Address</span></a> in Wei</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;address&gt;.code</span></code> (<code class="docutils literal notranslate"><span class="pre">bytes</span> <span class="pre">memory</span></code>): code at the <a class="reference internal" href="index.html#address"><span class="std std-ref">Address</span></a> (can be empty)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;address&gt;.codehash</span></code> (<code class="docutils literal notranslate"><span class="pre">bytes32</span></code>): the codehash of the <a class="reference internal" href="index.html#address"><span class="std std-ref">Address</span></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;address</span> <span class="pre">payable&gt;.send(uint256</span> <span class="pre">amount)</span> <span class="pre">returns</span> <span class="pre">(bool)</span></code>: send given amount of Wei to <a class="reference internal" href="index.html#address"><span class="std std-ref">Address</span></a>,
returns <code class="docutils literal notranslate"><span class="pre">false</span></code> on failure</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;address</span> <span class="pre">payable&gt;.transfer(uint256</span> <span class="pre">amount)</span></code>: send given amount of Wei to <a class="reference internal" href="index.html#address"><span class="std std-ref">Address</span></a>, throws on failure</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">type(C).name</span></code> (<code class="docutils literal notranslate"><span class="pre">string</span></code>): the name of the contract</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">type(C).creationCode</span></code> (<code class="docutils literal notranslate"><span class="pre">bytes</span> <span class="pre">memory</span></code>): creation bytecode of the given contract, see <a class="reference internal" href="index.html#meta-type"><span class="std std-ref">Type Information</span></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">type(C).runtimeCode</span></code> (<code class="docutils literal notranslate"><span class="pre">bytes</span> <span class="pre">memory</span></code>): runtime bytecode of the given contract, see <a class="reference internal" href="index.html#meta-type"><span class="std std-ref">Type Information</span></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">type(I).interfaceId</span></code> (<code class="docutils literal notranslate"><span class="pre">bytes4</span></code>): value containing the EIP-165 interface identifier of the given interface, see <a class="reference internal" href="index.html#meta-type"><span class="std std-ref">Type Information</span></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">type(T).min</span></code> (<code class="docutils literal notranslate"><span class="pre">T</span></code>): the minimum value representable by the integer type <code class="docutils literal notranslate"><span class="pre">T</span></code>, see <a class="reference internal" href="index.html#meta-type"><span class="std std-ref">Type Information</span></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">type(T).max</span></code> (<code class="docutils literal notranslate"><span class="pre">T</span></code>): the maximum value representable by the integer type <code class="docutils literal notranslate"><span class="pre">T</span></code>, see <a class="reference internal" href="index.html#meta-type"><span class="std std-ref">Type Information</span></a>.</p></li>
</ul>
</section>
<section id="function-visibility-specifiers">
<span id="index-2"></span><h3>Function Visibility Specifiers<a class="headerlink" href="#function-visibility-specifiers" title="Permalink to this heading">ÔÉÅ</a></h3>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=ZnVuY3Rpb24gbXlGdW5jdGlvbigpIDx2aXNpYmlsaXR5IHNwZWNpZmllcj4gcmV0dXJucyAoYm9vbCkgewogICAgcmV0dXJuIHRydWU7Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">function</span><span class="w"> </span><span class="nv">myFunction</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;</span>visibility<span class="w"> </span>specifier<span class="o">&gt;</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">return</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">public</span></code>: visible externally and internally (creates a <a class="reference internal" href="index.html#getter-functions"><span class="std std-ref">getter function</span></a> for storage/state variables)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">private</span></code>: only visible in the current contract</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">external</span></code>: only visible externally (only for functions) - i.e. can only be message-called (via <code class="docutils literal notranslate"><span class="pre">this.func</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">internal</span></code>: only visible internally</p></li>
</ul>
</section>
<section id="modifiers">
<span id="index-3"></span><h3>Modifiers<a class="headerlink" href="#modifiers" title="Permalink to this heading">ÔÉÅ</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pure</span></code> for functions: Disallows modification or access of state.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">view</span></code> for functions: Disallows modification of state.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">payable</span></code> for functions: Allows them to receive Ether together with a call.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">constant</span></code> for state variables: Disallows assignment (except initialisation), does not occupy storage slot.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">immutable</span></code> for state variables: Allows exactly one assignment at construction time and is constant afterwards. Is stored in code.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">anonymous</span></code> for events: Does not store event signature as topic.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">indexed</span></code> for event parameters: Stores the parameter as topic.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">virtual</span></code> for functions and modifiers: Allows the function‚Äôs or modifier‚Äôs
behaviour to be changed in derived contracts.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">override</span></code>: States that this function, modifier or public state variable changes
the behaviour of a function or modifier in a base contract.</p></li>
</ul>
</section>
<section id="reserved-keywords">
<h3>Reserved Keywords<a class="headerlink" href="#reserved-keywords" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>These keywords are reserved in Solidity. They might become part of the syntax in the future:</p>
<p><code class="docutils literal notranslate"><span class="pre">after</span></code>, <code class="docutils literal notranslate"><span class="pre">alias</span></code>, <code class="docutils literal notranslate"><span class="pre">apply</span></code>, <code class="docutils literal notranslate"><span class="pre">auto</span></code>, <code class="docutils literal notranslate"><span class="pre">byte</span></code>, <code class="docutils literal notranslate"><span class="pre">case</span></code>, <code class="docutils literal notranslate"><span class="pre">copyof</span></code>, <code class="docutils literal notranslate"><span class="pre">default</span></code>,
<code class="docutils literal notranslate"><span class="pre">define</span></code>, <code class="docutils literal notranslate"><span class="pre">final</span></code>, <code class="docutils literal notranslate"><span class="pre">implements</span></code>, <code class="docutils literal notranslate"><span class="pre">in</span></code>, <code class="docutils literal notranslate"><span class="pre">inline</span></code>, <code class="docutils literal notranslate"><span class="pre">let</span></code>, <code class="docutils literal notranslate"><span class="pre">macro</span></code>, <code class="docutils literal notranslate"><span class="pre">match</span></code>,
<code class="docutils literal notranslate"><span class="pre">mutable</span></code>, <code class="docutils literal notranslate"><span class="pre">null</span></code>, <code class="docutils literal notranslate"><span class="pre">of</span></code>, <code class="docutils literal notranslate"><span class="pre">partial</span></code>, <code class="docutils literal notranslate"><span class="pre">promise</span></code>, <code class="docutils literal notranslate"><span class="pre">reference</span></code>, <code class="docutils literal notranslate"><span class="pre">relocatable</span></code>,
<code class="docutils literal notranslate"><span class="pre">sealed</span></code>, <code class="docutils literal notranslate"><span class="pre">sizeof</span></code>, <code class="docutils literal notranslate"><span class="pre">static</span></code>, <code class="docutils literal notranslate"><span class="pre">supports</span></code>, <code class="docutils literal notranslate"><span class="pre">switch</span></code>, <code class="docutils literal notranslate"><span class="pre">typedef</span></code>, <code class="docutils literal notranslate"><span class="pre">typeof</span></code>,
<code class="docutils literal notranslate"><span class="pre">var</span></code>.</p>
</section>
</section>
</div>
<div class="toctree-wrapper compound">
<span id="document-using-the-compiler"></span><section id="using-the-compiler">
<h2>Using the Compiler<a class="headerlink" href="#using-the-compiler" title="Permalink to this heading">ÔÉÅ</a></h2>
<section id="using-the-commandline-compiler">
<span id="commandline-compiler"></span><span id="index-0"></span><h3>Using the Commandline Compiler<a class="headerlink" href="#using-the-commandline-compiler" title="Permalink to this heading">ÔÉÅ</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This section does not apply to <a class="reference internal" href="index.html#solcjs"><span class="std std-ref">solcjs</span></a>, not even if it is used in commandline mode.</p>
</div>
<section id="basic-usage">
<h4>Basic Usage<a class="headerlink" href="#basic-usage" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>One of the build targets of the Solidity repository is <code class="docutils literal notranslate"><span class="pre">solc</span></code>, the solidity commandline compiler.
Using <code class="docutils literal notranslate"><span class="pre">solc</span> <span class="pre">--help</span></code> provides you with an explanation of all options. The compiler can produce various outputs, ranging from simple binaries and assembly over an abstract syntax tree (parse tree) to estimations of gas usage.
If you only want to compile a single file, you run it as <code class="docutils literal notranslate"><span class="pre">solc</span> <span class="pre">--bin</span> <span class="pre">sourceFile.sol</span></code> and it will print the binary. If you want to get some of the more advanced output variants of <code class="docutils literal notranslate"><span class="pre">solc</span></code>, it is probably better to tell it to output everything to separate files using <code class="docutils literal notranslate"><span class="pre">solc</span> <span class="pre">-o</span> <span class="pre">outputDirectory</span> <span class="pre">--bin</span> <span class="pre">--ast-compact-json</span> <span class="pre">--asm</span> <span class="pre">sourceFile.sol</span></code>.</p>
</section>
<section id="optimizer-options">
<h4>Optimizer Options<a class="headerlink" href="#optimizer-options" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Before you deploy your contract, activate the optimizer when compiling using <code class="docutils literal notranslate"><span class="pre">solc</span> <span class="pre">--optimize</span> <span class="pre">--bin</span> <span class="pre">sourceFile.sol</span></code>.
By default, the optimizer will optimize the contract assuming it is called 200 times across its lifetime
(more specifically, it assumes each opcode is executed around 200 times).
If you want the initial contract deployment to be cheaper and the later function executions to be more expensive,
set it to <code class="docutils literal notranslate"><span class="pre">--optimize-runs=1</span></code>. If you expect many transactions and do not care for higher deployment cost and
output size, set <code class="docutils literal notranslate"><span class="pre">--optimize-runs</span></code> to a high number.
This parameter has effects on the following (this might change in the future):</p>
<ul class="simple">
<li><p>the size of the binary search in the function dispatch routine</p></li>
<li><p>the way constants like large numbers or strings are stored</p></li>
</ul>
</section>
<section id="base-path-and-import-remapping">
<span id="index-1"></span><h4>Base Path and Import Remapping<a class="headerlink" href="#base-path-and-import-remapping" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>The commandline compiler will automatically read imported files from the filesystem, but
it is also possible to provide <a class="reference internal" href="index.html#import-remapping"><span class="std std-ref">path redirects</span></a> using <code class="docutils literal notranslate"><span class="pre">prefix=path</span></code> in the following way:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>solc github.com/ethereum/dapp-bin/<span class="o">=</span>/usr/local/lib/dapp-bin/ file.sol
</pre></div>
</div>
<p>This essentially instructs the compiler to search for anything starting with
<code class="docutils literal notranslate"><span class="pre">github.com/ethereum/dapp-bin/</span></code> under <code class="docutils literal notranslate"><span class="pre">/usr/local/lib/dapp-bin</span></code>.</p>
<p>When accessing the filesystem to search for imports, <a class="reference internal" href="index.html#direct-imports"><span class="std std-ref">paths that do not start with ./
or ../</span></a> are treated as relative to the directories specified using
<code class="docutils literal notranslate"><span class="pre">--base-path</span></code> and <code class="docutils literal notranslate"><span class="pre">--include-path</span></code> options (or the current working directory if base path is not specified).
Furthermore, the part of the path added via these options will not appear in the contract metadata.</p>
<p>For security reasons the compiler has <a class="reference internal" href="index.html#allowed-paths"><span class="std std-ref">restrictions on what directories it can access</span></a>.
Directories of source files specified on the command line and target paths of
remappings are automatically allowed to be accessed by the file reader, but everything
else is rejected by default.
Additional paths (and their subdirectories) can be allowed via the
<code class="docutils literal notranslate"><span class="pre">--allow-paths</span> <span class="pre">/sample/path,/another/sample/path</span></code> switch.
Everything inside the path specified via <code class="docutils literal notranslate"><span class="pre">--base-path</span></code> is always allowed.</p>
<p>The above is only a simplification of how the compiler handles import paths.
For a detailed explanation with examples and discussion of corner cases please refer to the section on
<a class="reference internal" href="index.html#path-resolution"><span class="std std-ref">path resolution</span></a>.</p>
</section>
<section id="library-linking">
<span id="index-2"></span><span id="id1"></span><h4>Library Linking<a class="headerlink" href="#library-linking" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>If your contracts use <a class="reference internal" href="index.html#libraries"><span class="std std-ref">libraries</span></a>, you will notice that the bytecode contains substrings of the form <code class="docutils literal notranslate"><span class="pre">__$53aea86b7d70b31448b230b20ae141a537$__</span></code>. These are placeholders for the actual library addresses.
The placeholder is a 34 character prefix of the hex encoding of the keccak256 hash of the fully qualified library name.
The bytecode file will also contain lines of the form <code class="docutils literal notranslate"><span class="pre">//</span> <span class="pre">&lt;placeholder&gt;</span> <span class="pre">-&gt;</span> <span class="pre">&lt;fq</span> <span class="pre">library</span> <span class="pre">name&gt;</span></code> at the end to help
identify which libraries the placeholders represent. Note that the fully qualified library name
is the path of its source file and the library name separated by <code class="docutils literal notranslate"><span class="pre">:</span></code>.
You can use <code class="docutils literal notranslate"><span class="pre">solc</span></code> as a linker meaning that it will insert the library addresses for you at those points:</p>
<p>Either add <code class="docutils literal notranslate"><span class="pre">--libraries</span> <span class="pre">&quot;file.sol:Math=0x1234567890123456789012345678901234567890</span> <span class="pre">file.sol:Heap=0xabCD567890123456789012345678901234567890&quot;</span></code> to your command to provide an address for each library (use commas or spaces as separators) or store the string in a file (one library per line) and run <code class="docutils literal notranslate"><span class="pre">solc</span></code> using <code class="docutils literal notranslate"><span class="pre">--libraries</span> <span class="pre">fileName</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Starting Solidity 0.8.1 accepts <code class="docutils literal notranslate"><span class="pre">=</span></code> as separator between library and address, and <code class="docutils literal notranslate"><span class="pre">:</span></code> as a separator is deprecated. It will be removed in the future. Currently <code class="docutils literal notranslate"><span class="pre">--libraries</span> <span class="pre">&quot;file.sol:Math:0x1234567890123456789012345678901234567890</span> <span class="pre">file.sol:Heap:0xabCD567890123456789012345678901234567890&quot;</span></code> will work too.</p>
</div>
<p id="index-3">If <code class="docutils literal notranslate"><span class="pre">solc</span></code> is called with the option <code class="docutils literal notranslate"><span class="pre">--standard-json</span></code>, it will expect a JSON input (as explained below) on the standard input, and return a JSON output on the standard output. This is the recommended interface for more complex and especially automated uses. The process will always terminate in a ‚Äúsuccess‚Äù state and report any errors via the JSON output.
The option <code class="docutils literal notranslate"><span class="pre">--base-path</span></code> is also processed in standard-json mode.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">solc</span></code> is called with the option <code class="docutils literal notranslate"><span class="pre">--link</span></code>, all input files are interpreted to be unlinked binaries (hex-encoded) in the <code class="docutils literal notranslate"><span class="pre">__$53aea86b7d70b31448b230b20ae141a537$__</span></code>-format given above and are linked in-place (if the input is read from stdin, it is written to stdout). All options except <code class="docutils literal notranslate"><span class="pre">--libraries</span></code> are ignored (including <code class="docutils literal notranslate"><span class="pre">-o</span></code>) in this case.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Manually linking libraries on the generated bytecode is discouraged because it does not update
contract metadata. Since metadata contains a list of libraries specified at the time of
compilation and bytecode contains a metadata hash, you will get different binaries, depending
on when linking is performed.</p>
<p>You should ask the compiler to link the libraries at the time a contract is compiled by either
using the <code class="docutils literal notranslate"><span class="pre">--libraries</span></code> option of <code class="docutils literal notranslate"><span class="pre">solc</span></code> or the <code class="docutils literal notranslate"><span class="pre">libraries</span></code> key if you use the
standard-JSON interface to the compiler.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The library placeholder used to be the fully qualified name of the library itself
instead of the hash of it. This format is still supported by <code class="docutils literal notranslate"><span class="pre">solc</span> <span class="pre">--link</span></code> but
the compiler will no longer output it. This change was made to reduce
the likelihood of a collision between libraries, since only the first 36 characters
of the fully qualified library name could be used.</p>
</div>
<span class="target" id="evm-version"></span></section>
</section>
<section id="setting-the-evm-version-to-target">
<span id="index-4"></span><h3>Setting the EVM Version to Target<a class="headerlink" href="#setting-the-evm-version-to-target" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>When you compile your contract code you can specify the Ethereum virtual machine
version to compile for to avoid particular features or behaviours.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Compiling for the wrong EVM version can result in wrong, strange and failing
behaviour. Please ensure, especially if running a private chain, that you
use matching EVM versions.</p>
</div>
<p>On the command line, you can select the EVM version as follows:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>solc --evm-version &lt;VERSION&gt; contract.sol
</pre></div>
</div>
<p>In the <a class="reference internal" href="#compiler-api"><span class="std std-ref">standard JSON interface</span></a>, use the <code class="docutils literal notranslate"><span class="pre">&quot;evmVersion&quot;</span></code>
key in the <code class="docutils literal notranslate"><span class="pre">&quot;settings&quot;</span></code> field:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="s2">&quot;sources&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="cm">/* ... */</span><span class="p">},</span><span class="w"></span>
<span class="w">  </span><span class="s2">&quot;settings&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="s2">&quot;optimizer&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="cm">/* ... */</span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="s2">&quot;evmVersion&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;&lt;VERSION&gt;&quot;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<section id="target-options">
<h4>Target Options<a class="headerlink" href="#target-options" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Below is a list of target EVM versions and the compiler-relevant changes introduced
at each version. Backward compatibility is not guaranteed between each version.</p>
<ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">homestead</span></code></dt><dd><ul>
<li><p>(oldest version)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">tangerineWhistle</span></code></dt><dd><ul>
<li><p>Gas cost for access to other accounts increased, relevant for gas estimation and the optimizer.</p></li>
<li><p>All gas sent by default for external calls, previously a certain amount had to be retained.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">spuriousDragon</span></code></dt><dd><ul>
<li><p>Gas cost for the <code class="docutils literal notranslate"><span class="pre">exp</span></code> opcode increased, relevant for gas estimation and the optimizer.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">byzantium</span></code></dt><dd><ul>
<li><p>Opcodes <code class="docutils literal notranslate"><span class="pre">returndatacopy</span></code>, <code class="docutils literal notranslate"><span class="pre">returndatasize</span></code> and <code class="docutils literal notranslate"><span class="pre">staticcall</span></code> are available in assembly.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">staticcall</span></code> opcode is used when calling non-library view or pure functions, which prevents the functions from modifying state at the EVM level, i.e., even applies when you use invalid type conversions.</p></li>
<li><p>It is possible to access dynamic data returned from function calls.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">revert</span></code> opcode introduced, which means that <code class="docutils literal notranslate"><span class="pre">revert()</span></code> will not waste gas.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">constantinople</span></code></dt><dd><ul>
<li><p>Opcodes <code class="docutils literal notranslate"><span class="pre">create2`,</span> <span class="pre">``extcodehash</span></code>, <code class="docutils literal notranslate"><span class="pre">shl</span></code>, <code class="docutils literal notranslate"><span class="pre">shr</span></code> and <code class="docutils literal notranslate"><span class="pre">sar</span></code> are available in assembly.</p></li>
<li><p>Shifting operators use shifting opcodes and thus need less gas.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">petersburg</span></code></dt><dd><ul>
<li><p>The compiler behaves the same way as with constantinople.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">istanbul</span></code></dt><dd><ul>
<li><p>Opcodes <code class="docutils literal notranslate"><span class="pre">chainid</span></code> and <code class="docutils literal notranslate"><span class="pre">selfbalance</span></code> are available in assembly.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">berlin</span></code></dt><dd><ul>
<li><p>Gas costs for <code class="docutils literal notranslate"><span class="pre">SLOAD</span></code>, <code class="docutils literal notranslate"><span class="pre">*CALL</span></code>, <code class="docutils literal notranslate"><span class="pre">BALANCE</span></code>, <code class="docutils literal notranslate"><span class="pre">EXT*</span></code> and <code class="docutils literal notranslate"><span class="pre">SELFDESTRUCT</span></code> increased. The
compiler assumes cold gas costs for such operations. This is relevant for gas estimation and
the optimizer.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">london</span></code> (<strong>default</strong>)</dt><dd><ul>
<li><p>The block‚Äôs base fee (<a class="reference external" href="https://eips.ethereum.org/EIPS/eip-3198">EIP-3198</a> and <a class="reference external" href="https://eips.ethereum.org/EIPS/eip-1559">EIP-1559</a>) can be accessed via the global <code class="docutils literal notranslate"><span class="pre">block.basefee</span></code> or <code class="docutils literal notranslate"><span class="pre">basefee()</span></code> in inline assembly.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
</section>
<section id="compiler-input-and-output-json-description">
<span id="compiler-api"></span><span id="index-5"></span><h3>Compiler Input and Output JSON Description<a class="headerlink" href="#compiler-input-and-output-json-description" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>The recommended way to interface with the Solidity compiler especially for
more complex and automated setups is the so-called JSON-input-output interface.
The same interface is provided by all distributions of the compiler.</p>
<p>The fields are generally subject to change,
some are optional (as noted), but we try to only make backwards compatible changes.</p>
<p>The compiler API expects a JSON formatted input and outputs the compilation result in a JSON formatted output.
The standard error output is not used and the process will always terminate in a ‚Äúsuccess‚Äù state, even
if there were errors. Errors are always reported as part of the JSON output.</p>
<p>The following subsections describe the format through an example.
Comments are of course not permitted and used here only for explanatory purposes.</p>
<section id="input-description">
<h4>Input Description<a class="headerlink" href="#input-description" title="Permalink to this heading">ÔÉÅ</a></h4>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="c1">// Required: Source code language. Currently supported are &quot;Solidity&quot; and &quot;Yul&quot;.</span><span class="w"></span>
<span class="w">  </span><span class="s2">&quot;language&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Solidity&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="c1">// Required</span><span class="w"></span>
<span class="w">  </span><span class="s2">&quot;sources&quot;</span><span class="o">:</span><span class="w"></span>
<span class="w">  </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// The keys here are the &quot;global&quot; names of the source files,</span><span class="w"></span>
<span class="w">    </span><span class="c1">// imports can use other files via remappings (see below).</span><span class="w"></span>
<span class="w">    </span><span class="s2">&quot;myFile.sol&quot;</span><span class="o">:</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Optional: keccak256 hash of the source file</span><span class="w"></span>
<span class="w">      </span><span class="c1">// It is used to verify the retrieved content if imported via URLs.</span><span class="w"></span>
<span class="w">      </span><span class="s2">&quot;keccak256&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0x123...&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Required (unless &quot;content&quot; is used, see below): URL(s) to the source file.</span><span class="w"></span>
<span class="w">      </span><span class="c1">// URL(s) should be imported in this order and the result checked against the</span><span class="w"></span>
<span class="w">      </span><span class="c1">// keccak256 hash (if available). If the hash doesn&#39;t match or none of the</span><span class="w"></span>
<span class="w">      </span><span class="c1">// URL(s) result in success, an error should be raised.</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Using the commandline interface only filesystem paths are supported.</span><span class="w"></span>
<span class="w">      </span><span class="c1">// With the JavaScript interface the URL will be passed to the user-supplied</span><span class="w"></span>
<span class="w">      </span><span class="c1">// read callback, so any URL supported by the callback can be used.</span><span class="w"></span>
<span class="w">      </span><span class="s2">&quot;urls&quot;</span><span class="o">:</span><span class="w"></span>
<span class="w">      </span><span class="p">[</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;bzzr://56ab...&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;ipfs://Qma...&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;/tmp/path/to/file.sol&quot;</span><span class="w"></span>
<span class="w">        </span><span class="c1">// If files are used, their directories should be added to the command line via</span><span class="w"></span>
<span class="w">        </span><span class="c1">// `--allow-paths &lt;path&gt;`.</span><span class="w"></span>
<span class="w">      </span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="s2">&quot;destructible&quot;</span><span class="o">:</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Optional: keccak256 hash of the source file</span><span class="w"></span>
<span class="w">      </span><span class="s2">&quot;keccak256&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0x234...&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Required (unless &quot;urls&quot; is used): literal contents of the source file</span><span class="w"></span>
<span class="w">      </span><span class="s2">&quot;content&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;contract destructible is owned { function shutdown() { if (msg.sender == owner) selfdestruct(owner); } }&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">},</span><span class="w"></span>
<span class="w">  </span><span class="c1">// Optional</span><span class="w"></span>
<span class="w">  </span><span class="s2">&quot;settings&quot;</span><span class="o">:</span><span class="w"></span>
<span class="w">  </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Optional: Stop compilation after the given stage. Currently only &quot;parsing&quot; is valid here</span><span class="w"></span>
<span class="w">    </span><span class="s2">&quot;stopAfter&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;parsing&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Optional: Sorted list of remappings</span><span class="w"></span>
<span class="w">    </span><span class="s2">&quot;remappings&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">&quot;:g=/dir&quot;</span><span class="w"> </span><span class="p">],</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Optional: Optimizer settings</span><span class="w"></span>
<span class="w">    </span><span class="s2">&quot;optimizer&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Disabled by default.</span><span class="w"></span>
<span class="w">      </span><span class="c1">// NOTE: enabled=false still leaves some optimizations on. See comments below.</span><span class="w"></span>
<span class="w">      </span><span class="c1">// WARNING: Before version 0.8.6 omitting the &#39;enabled&#39; key was not equivalent to setting</span><span class="w"></span>
<span class="w">      </span><span class="c1">// it to false and would actually disable all the optimizations.</span><span class="w"></span>
<span class="w">      </span><span class="s2">&quot;enabled&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Optimize for how many times you intend to run the code.</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Lower values will optimize more for initial deployment cost, higher</span><span class="w"></span>
<span class="w">      </span><span class="c1">// values will optimize more for high-frequency usage.</span><span class="w"></span>
<span class="w">      </span><span class="s2">&quot;runs&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">200</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Switch optimizer components on or off in detail.</span><span class="w"></span>
<span class="w">      </span><span class="c1">// The &quot;enabled&quot; switch above provides two defaults which can be</span><span class="w"></span>
<span class="w">      </span><span class="c1">// tweaked here. If &quot;details&quot; is given, &quot;enabled&quot; can be omitted.</span><span class="w"></span>
<span class="w">      </span><span class="s2">&quot;details&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// The peephole optimizer is always on if no details are given,</span><span class="w"></span>
<span class="w">        </span><span class="c1">// use details to switch it off.</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;peephole&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="c1">// The inliner is always on if no details are given,</span><span class="w"></span>
<span class="w">        </span><span class="c1">// use details to switch it off.</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;inliner&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="c1">// The unused jumpdest remover is always on if no details are given,</span><span class="w"></span>
<span class="w">        </span><span class="c1">// use details to switch it off.</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;jumpdestRemover&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Sometimes re-orders literals in commutative operations.</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;orderLiterals&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Removes duplicate code blocks</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;deduplicate&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Common subexpression elimination, this is the most complicated step but</span><span class="w"></span>
<span class="w">        </span><span class="c1">// can also provide the largest gain.</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;cse&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Optimize representation of literal numbers and strings in code.</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;constantOptimizer&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="c1">// The new Yul optimizer. Mostly operates on the code of ABI coder v2</span><span class="w"></span>
<span class="w">        </span><span class="c1">// and inline assembly.</span><span class="w"></span>
<span class="w">        </span><span class="c1">// It is activated together with the global optimizer setting</span><span class="w"></span>
<span class="w">        </span><span class="c1">// and can be deactivated here.</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Before Solidity 0.6.0 it had to be activated through this switch.</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;yul&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Tuning options for the Yul optimizer.</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;yulDetails&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="c1">// Improve allocation of stack slots for variables, can free up stack slots early.</span><span class="w"></span>
<span class="w">          </span><span class="c1">// Activated by default if the Yul optimizer is activated.</span><span class="w"></span>
<span class="w">          </span><span class="s2">&quot;stackAllocation&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="c1">// Select optimization steps to be applied.</span><span class="w"></span>
<span class="w">          </span><span class="c1">// Optional, the optimizer will use the default sequence if omitted.</span><span class="w"></span>
<span class="w">          </span><span class="s2">&quot;optimizerSteps&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;dhfoDgvulfnTUtnIf...&quot;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Version of the EVM to compile for.</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Affects type checking and code generation. Can be homestead,</span><span class="w"></span>
<span class="w">    </span><span class="c1">// tangerineWhistle, spuriousDragon, byzantium, constantinople, petersburg, istanbul or berlin</span><span class="w"></span>
<span class="w">    </span><span class="s2">&quot;evmVersion&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;byzantium&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Optional: Change compilation pipeline to go through the Yul intermediate representation.</span><span class="w"></span>
<span class="w">    </span><span class="c1">// This is false by default.</span><span class="w"></span>
<span class="w">    </span><span class="s2">&quot;viaIR&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Optional: Debugging settings</span><span class="w"></span>
<span class="w">    </span><span class="s2">&quot;debug&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="c1">// How to treat revert (and require) reason strings. Settings are</span><span class="w"></span>
<span class="w">      </span><span class="c1">// &quot;default&quot;, &quot;strip&quot;, &quot;debug&quot; and &quot;verboseDebug&quot;.</span><span class="w"></span>
<span class="w">      </span><span class="c1">// &quot;default&quot; does not inject compiler-generated revert strings and keeps user-supplied ones.</span><span class="w"></span>
<span class="w">      </span><span class="c1">// &quot;strip&quot; removes all revert strings (if possible, i.e. if literals are used) keeping side-effects</span><span class="w"></span>
<span class="w">      </span><span class="c1">// &quot;debug&quot; injects strings for compiler-generated internal reverts, implemented for ABI encoders V1 and V2 for now.</span><span class="w"></span>
<span class="w">      </span><span class="c1">// &quot;verboseDebug&quot; even appends further information to user-supplied revert strings (not yet implemented)</span><span class="w"></span>
<span class="w">      </span><span class="s2">&quot;revertStrings&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Optional: How much extra debug information to include in comments in the produced EVM</span><span class="w"></span>
<span class="w">      </span><span class="c1">// assembly and Yul code. Available components are:</span><span class="w"></span>
<span class="w">      </span><span class="c1">// - `location`: Annotations of the form `@src &lt;index&gt;:&lt;start&gt;:&lt;end&gt;` indicating the</span><span class="w"></span>
<span class="w">      </span><span class="c1">//    location of the corresponding element in the original Solidity file, where:</span><span class="w"></span>
<span class="w">      </span><span class="c1">//     - `&lt;index&gt;` is the file index matching the `@use-src` annotation,</span><span class="w"></span>
<span class="w">      </span><span class="c1">//     - `&lt;start&gt;` is the index of the first byte at that location,</span><span class="w"></span>
<span class="w">      </span><span class="c1">//     - `&lt;end&gt;` is the index of the first byte after that location.</span><span class="w"></span>
<span class="w">      </span><span class="c1">// - `snippet`: A single-line code snippet from the location indicated by `@src`.</span><span class="w"></span>
<span class="w">      </span><span class="c1">//     The snippet is quoted and follows the corresponding `@src` annotation.</span><span class="w"></span>
<span class="w">      </span><span class="c1">// - `*`: Wildcard value that can be used to request everything.</span><span class="w"></span>
<span class="w">      </span><span class="s2">&quot;debugInfo&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;location&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;snippet&quot;</span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Metadata settings (optional)</span><span class="w"></span>
<span class="w">    </span><span class="s2">&quot;metadata&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Use only literal content and not URLs (false by default)</span><span class="w"></span>
<span class="w">      </span><span class="s2">&quot;useLiteralContent&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Use the given hash method for the metadata hash that is appended to the bytecode.</span><span class="w"></span>
<span class="w">      </span><span class="c1">// The metadata hash can be removed from the bytecode via option &quot;none&quot;.</span><span class="w"></span>
<span class="w">      </span><span class="c1">// The other options are &quot;ipfs&quot; and &quot;bzzr1&quot;.</span><span class="w"></span>
<span class="w">      </span><span class="c1">// If the option is omitted, &quot;ipfs&quot; is used by default.</span><span class="w"></span>
<span class="w">      </span><span class="s2">&quot;bytecodeHash&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;ipfs&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Addresses of the libraries. If not all libraries are given here,</span><span class="w"></span>
<span class="w">    </span><span class="c1">// it can result in unlinked objects whose output data is different.</span><span class="w"></span>
<span class="w">    </span><span class="s2">&quot;libraries&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="c1">// The top level key is the the name of the source file where the library is used.</span><span class="w"></span>
<span class="w">      </span><span class="c1">// If remappings are used, this source file should match the global path</span><span class="w"></span>
<span class="w">      </span><span class="c1">// after remappings were applied.</span><span class="w"></span>
<span class="w">      </span><span class="c1">// If this key is an empty string, that refers to a global level.</span><span class="w"></span>
<span class="w">      </span><span class="s2">&quot;myFile.sol&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;MyLib&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0x123123...&quot;</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="c1">// The following can be used to select desired outputs based</span><span class="w"></span>
<span class="w">    </span><span class="c1">// on file and contract names.</span><span class="w"></span>
<span class="w">    </span><span class="c1">// If this field is omitted, then the compiler loads and does type checking,</span><span class="w"></span>
<span class="w">    </span><span class="c1">// but will not generate any outputs apart from errors.</span><span class="w"></span>
<span class="w">    </span><span class="c1">// The first level key is the file name and the second level key is the contract name.</span><span class="w"></span>
<span class="w">    </span><span class="c1">// An empty contract name is used for outputs that are not tied to a contract</span><span class="w"></span>
<span class="w">    </span><span class="c1">// but to the whole source file like the AST.</span><span class="w"></span>
<span class="w">    </span><span class="c1">// A star as contract name refers to all contracts in the file.</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Similarly, a star as a file name matches all files.</span><span class="w"></span>
<span class="w">    </span><span class="c1">// To select all outputs the compiler can possibly generate, use</span><span class="w"></span>
<span class="w">    </span><span class="c1">// &quot;outputSelection: { &quot;*&quot;: { &quot;*&quot;: [ &quot;*&quot; ], &quot;&quot;: [ &quot;*&quot; ] } }&quot;</span><span class="w"></span>
<span class="w">    </span><span class="c1">// but note that this might slow down the compilation process needlessly.</span><span class="w"></span>
<span class="w">    </span><span class="c1">//</span><span class="w"></span>
<span class="w">    </span><span class="c1">// The available output types are as follows:</span><span class="w"></span>
<span class="w">    </span><span class="c1">//</span><span class="w"></span>
<span class="w">    </span><span class="c1">// File level (needs empty string as contract name):</span><span class="w"></span>
<span class="w">    </span><span class="c1">//   ast - AST of all source files</span><span class="w"></span>
<span class="w">    </span><span class="c1">//</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Contract level (needs the contract name or &quot;*&quot;):</span><span class="w"></span>
<span class="w">    </span><span class="c1">//   abi - ABI</span><span class="w"></span>
<span class="w">    </span><span class="c1">//   devdoc - Developer documentation (natspec)</span><span class="w"></span>
<span class="w">    </span><span class="c1">//   userdoc - User documentation (natspec)</span><span class="w"></span>
<span class="w">    </span><span class="c1">//   metadata - Metadata</span><span class="w"></span>
<span class="w">    </span><span class="c1">//   ir - Yul intermediate representation of the code before optimization</span><span class="w"></span>
<span class="w">    </span><span class="c1">//   irOptimized - Intermediate representation after optimization</span><span class="w"></span>
<span class="w">    </span><span class="c1">//   storageLayout - Slots, offsets and types of the contract&#39;s state variables.</span><span class="w"></span>
<span class="w">    </span><span class="c1">//   evm.assembly - New assembly format</span><span class="w"></span>
<span class="w">    </span><span class="c1">//   evm.legacyAssembly - Old-style assembly format in JSON</span><span class="w"></span>
<span class="w">    </span><span class="c1">//   evm.bytecode.functionDebugData - Debugging information at function level</span><span class="w"></span>
<span class="w">    </span><span class="c1">//   evm.bytecode.object - Bytecode object</span><span class="w"></span>
<span class="w">    </span><span class="c1">//   evm.bytecode.opcodes - Opcodes list</span><span class="w"></span>
<span class="w">    </span><span class="c1">//   evm.bytecode.sourceMap - Source mapping (useful for debugging)</span><span class="w"></span>
<span class="w">    </span><span class="c1">//   evm.bytecode.linkReferences - Link references (if unlinked object)</span><span class="w"></span>
<span class="w">    </span><span class="c1">//   evm.bytecode.generatedSources - Sources generated by the compiler</span><span class="w"></span>
<span class="w">    </span><span class="c1">//   evm.deployedBytecode* - Deployed bytecode (has all the options that evm.bytecode has)</span><span class="w"></span>
<span class="w">    </span><span class="c1">//   evm.deployedBytecode.immutableReferences - Map from AST ids to bytecode ranges that reference immutables</span><span class="w"></span>
<span class="w">    </span><span class="c1">//   evm.methodIdentifiers - The list of function hashes</span><span class="w"></span>
<span class="w">    </span><span class="c1">//   evm.gasEstimates - Function gas estimates</span><span class="w"></span>
<span class="w">    </span><span class="c1">//   ewasm.wast - Ewasm in WebAssembly S-expressions format</span><span class="w"></span>
<span class="w">    </span><span class="c1">//   ewasm.wasm - Ewasm in WebAssembly binary format</span><span class="w"></span>
<span class="w">    </span><span class="c1">//</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Note that using a using `evm`, `evm.bytecode`, `ewasm`, etc. will select every</span><span class="w"></span>
<span class="w">    </span><span class="c1">// target part of that output. Additionally, `*` can be used as a wildcard to request everything.</span><span class="w"></span>
<span class="w">    </span><span class="c1">//</span><span class="w"></span>
<span class="w">    </span><span class="s2">&quot;outputSelection&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="s2">&quot;*&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;*&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">          </span><span class="s2">&quot;metadata&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;evm.bytecode&quot;</span><span class="w"> </span><span class="c1">// Enable the metadata and bytecode outputs of every single contract.</span><span class="w"></span>
<span class="w">          </span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;evm.bytecode.sourceMap&quot;</span><span class="w"> </span><span class="c1">// Enable the source map output of every single contract.</span><span class="w"></span>
<span class="w">        </span><span class="p">],</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">          </span><span class="s2">&quot;ast&quot;</span><span class="w"> </span><span class="c1">// Enable the AST output of every single file.</span><span class="w"></span>
<span class="w">        </span><span class="p">]</span><span class="w"></span>
<span class="w">      </span><span class="p">},</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Enable the abi and opcodes output of MyContract defined in file def.</span><span class="w"></span>
<span class="w">      </span><span class="s2">&quot;def&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;MyContract&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">&quot;abi&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;evm.bytecode.opcodes&quot;</span><span class="w"> </span><span class="p">]</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="c1">// The modelChecker object is experimental and subject to changes.</span><span class="w"></span>
<span class="w">    </span><span class="s2">&quot;modelChecker&quot;</span><span class="o">:</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Chose which contracts should be analyzed as the deployed one.</span><span class="w"></span>
<span class="w">      </span><span class="s2">&quot;contracts&quot;</span><span class="o">:</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;source1.sol&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;contract1&quot;</span><span class="p">],</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;source2.sol&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;contract2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;contract3&quot;</span><span class="p">]</span><span class="w"></span>
<span class="w">      </span><span class="p">},</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Choose how division and modulo operations should be encoded.</span><span class="w"></span>
<span class="w">      </span><span class="c1">// When using `false` they are replaced by multiplication with slack</span><span class="w"></span>
<span class="w">      </span><span class="c1">// variables. This is the default.</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Using `true` here is recommended if you are using the CHC engine</span><span class="w"></span>
<span class="w">      </span><span class="c1">// and not using Spacer as the Horn solver (using Eldarica, for example).</span><span class="w"></span>
<span class="w">      </span><span class="c1">// See the Formal Verification section for a more detailed explanation of this option.</span><span class="w"></span>
<span class="w">      </span><span class="s2">&quot;divModNoSlacks&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Choose which model checker engine to use: all (default), bmc, chc, none.</span><span class="w"></span>
<span class="w">      </span><span class="s2">&quot;engine&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;chc&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Choose which types of invariants should be reported to the user: contract, reentrancy.</span><span class="w"></span>
<span class="w">      </span><span class="s2">&quot;invariants&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;contract&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;reentrancy&quot;</span><span class="p">],</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Choose whether to output all unproved targets. The default is `false`.</span><span class="w"></span>
<span class="w">      </span><span class="s2">&quot;showUnproved&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Choose which solvers should be used, if available.</span><span class="w"></span>
<span class="w">      </span><span class="c1">// See the Formal Verification section for the solvers description.</span><span class="w"></span>
<span class="w">      </span><span class="s2">&quot;solvers&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;cvc4&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;smtlib2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;z3&quot;</span><span class="p">],</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Choose which targets should be checked: constantCondition,</span><span class="w"></span>
<span class="w">      </span><span class="c1">// underflow, overflow, divByZero, balance, assert, popEmptyArray, outOfBounds.</span><span class="w"></span>
<span class="w">      </span><span class="c1">// If the option is not given all targets are checked by default,</span><span class="w"></span>
<span class="w">      </span><span class="c1">// except underflow/overflow for Solidity &gt;=0.8.7.</span><span class="w"></span>
<span class="w">      </span><span class="c1">// See the Formal Verification section for the targets description.</span><span class="w"></span>
<span class="w">      </span><span class="s2">&quot;targets&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;underflow&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;overflow&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;assert&quot;</span><span class="p">],</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Timeout for each SMT query in milliseconds.</span><span class="w"></span>
<span class="w">      </span><span class="c1">// If this option is not given, the SMTChecker will use a deterministic</span><span class="w"></span>
<span class="w">      </span><span class="c1">// resource limit by default.</span><span class="w"></span>
<span class="w">      </span><span class="c1">// A given timeout of 0 means no resource/time restrictions for any query.</span><span class="w"></span>
<span class="w">      </span><span class="s2">&quot;timeout&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">20000</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="output-description">
<h4>Output Description<a class="headerlink" href="#output-description" title="Permalink to this heading">ÔÉÅ</a></h4>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="c1">// Optional: not present if no errors/warnings/infos were encountered</span><span class="w"></span>
<span class="w">  </span><span class="s2">&quot;errors&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Optional: Location within the source file.</span><span class="w"></span>
<span class="w">      </span><span class="s2">&quot;sourceLocation&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;file&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;sourceFile.sol&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;start&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;end&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">100</span><span class="w"></span>
<span class="w">      </span><span class="p">},</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Optional: Further locations (e.g. places of conflicting declarations)</span><span class="w"></span>
<span class="w">      </span><span class="s2">&quot;secondarySourceLocations&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="s2">&quot;file&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;sourceFile.sol&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="s2">&quot;start&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">64</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="s2">&quot;end&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">92</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="s2">&quot;message&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Other declaration is here:&quot;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="p">],</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Mandatory: Error type, such as &quot;TypeError&quot;, &quot;InternalCompilerError&quot;, &quot;Exception&quot;, etc.</span><span class="w"></span>
<span class="w">      </span><span class="c1">// See below for complete list of types.</span><span class="w"></span>
<span class="w">      </span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;TypeError&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Mandatory: Component where the error originated, such as &quot;general&quot;, &quot;ewasm&quot;, etc.</span><span class="w"></span>
<span class="w">      </span><span class="s2">&quot;component&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;general&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Mandatory (&quot;error&quot;, &quot;warning&quot; or &quot;info&quot;, but please note that this may be extended in the future)</span><span class="w"></span>
<span class="w">      </span><span class="s2">&quot;severity&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;error&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Optional: unique code for the cause of the error</span><span class="w"></span>
<span class="w">      </span><span class="s2">&quot;errorCode&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;3141&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Mandatory</span><span class="w"></span>
<span class="w">      </span><span class="s2">&quot;message&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Invalid keyword&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Optional: the message formatted with source location</span><span class="w"></span>
<span class="w">      </span><span class="s2">&quot;formattedMessage&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;sourceFile.sol:100: Invalid keyword&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">],</span><span class="w"></span>
<span class="w">  </span><span class="c1">// This contains the file-level outputs.</span><span class="w"></span>
<span class="w">  </span><span class="c1">// It can be limited/filtered by the outputSelection settings.</span><span class="w"></span>
<span class="w">  </span><span class="s2">&quot;sources&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="s2">&quot;sourceFile.sol&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Identifier of the source (used in source maps)</span><span class="w"></span>
<span class="w">      </span><span class="s2">&quot;id&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="c1">// The AST object</span><span class="w"></span>
<span class="w">      </span><span class="s2">&quot;ast&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">},</span><span class="w"></span>
<span class="w">  </span><span class="c1">// This contains the contract-level outputs.</span><span class="w"></span>
<span class="w">  </span><span class="c1">// It can be limited/filtered by the outputSelection settings.</span><span class="w"></span>
<span class="w">  </span><span class="s2">&quot;contracts&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="s2">&quot;sourceFile.sol&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="c1">// If the language used has no contract names, this field should equal to an empty string.</span><span class="w"></span>
<span class="w">      </span><span class="s2">&quot;ContractName&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// The Ethereum Contract ABI. If empty, it is represented as an empty array.</span><span class="w"></span>
<span class="w">        </span><span class="c1">// See https://docs.soliditylang.org/en/develop/abi-spec.html</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;abi&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[],</span><span class="w"></span>
<span class="w">        </span><span class="c1">// See the Metadata Output documentation (serialised JSON string)</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;metadata&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;{/* ... */}&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="c1">// User documentation (natspec)</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;userdoc&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{},</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Developer documentation (natspec)</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;devdoc&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{},</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Intermediate representation (string)</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;ir&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="c1">// See the Storage Layout documentation.</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;storageLayout&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;storage&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="cm">/* ... */</span><span class="p">],</span><span class="w"> </span><span class="s2">&quot;types&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="cm">/* ... */</span><span class="p">}</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="c1">// EVM-related outputs</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;evm&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="c1">// Assembly (string)</span><span class="w"></span>
<span class="w">          </span><span class="s2">&quot;assembly&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="c1">// Old-style assembly (object)</span><span class="w"></span>
<span class="w">          </span><span class="s2">&quot;legacyAssembly&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{},</span><span class="w"></span>
<span class="w">          </span><span class="c1">// Bytecode and related details.</span><span class="w"></span>
<span class="w">          </span><span class="s2">&quot;bytecode&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="c1">// Debugging data at the level of functions.</span><span class="w"></span>
<span class="w">            </span><span class="s2">&quot;functionDebugData&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">              </span><span class="c1">// Now follows a set of functions including compiler-internal and</span><span class="w"></span>
<span class="w">              </span><span class="c1">// user-defined function. The set does not have to be complete.</span><span class="w"></span>
<span class="w">              </span><span class="s2">&quot;@mint_13&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// Internal name of the function</span><span class="w"></span>
<span class="w">                </span><span class="s2">&quot;entryPoint&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">128</span><span class="p">,</span><span class="w"> </span><span class="c1">// Byte offset into the bytecode where the function starts (optional)</span><span class="w"></span>
<span class="w">                </span><span class="s2">&quot;id&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">13</span><span class="p">,</span><span class="w"> </span><span class="c1">// AST ID of the function definition or null for compiler-internal functions (optional)</span><span class="w"></span>
<span class="w">                </span><span class="s2">&quot;parameterSlots&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="c1">// Number of EVM stack slots for the function parameters (optional)</span><span class="w"></span>
<span class="w">                </span><span class="s2">&quot;returnSlots&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="c1">// Number of EVM stack slots for the return values (optional)</span><span class="w"></span>
<span class="w">              </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="p">},</span><span class="w"></span>
<span class="w">            </span><span class="c1">// The bytecode as a hex string.</span><span class="w"></span>
<span class="w">            </span><span class="s2">&quot;object&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;00fe&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="c1">// Opcodes list (string)</span><span class="w"></span>
<span class="w">            </span><span class="s2">&quot;opcodes&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="c1">// The source mapping as a string. See the source mapping definition.</span><span class="w"></span>
<span class="w">            </span><span class="s2">&quot;sourceMap&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="c1">// Array of sources generated by the compiler. Currently only</span><span class="w"></span>
<span class="w">            </span><span class="c1">// contains a single Yul file.</span><span class="w"></span>
<span class="w">            </span><span class="s2">&quot;generatedSources&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[{</span><span class="w"></span>
<span class="w">              </span><span class="c1">// Yul AST</span><span class="w"></span>
<span class="w">              </span><span class="s2">&quot;ast&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="cm">/* ... */</span><span class="p">},</span><span class="w"></span>
<span class="w">              </span><span class="c1">// Source file in its text form (may contain comments)</span><span class="w"></span>
<span class="w">              </span><span class="s2">&quot;contents&quot;</span><span class="o">:</span><span class="s2">&quot;{ function abi_decode(start, end) -&gt; data { data := calldataload(start) } }&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">              </span><span class="c1">// Source file ID, used for source references, same &quot;namespace&quot; as the Solidity source files</span><span class="w"></span>
<span class="w">              </span><span class="s2">&quot;id&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"></span>
<span class="w">              </span><span class="s2">&quot;language&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Yul&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">              </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;#utility.yul&quot;</span><span class="w"></span>
<span class="w">            </span><span class="p">}],</span><span class="w"></span>
<span class="w">            </span><span class="c1">// If given, this is an unlinked object.</span><span class="w"></span>
<span class="w">            </span><span class="s2">&quot;linkReferences&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">              </span><span class="s2">&quot;libraryFile.sol&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="c1">// Byte offsets into the bytecode.</span><span class="w"></span>
<span class="w">                </span><span class="c1">// Linking replaces the 20 bytes located there.</span><span class="w"></span>
<span class="w">                </span><span class="s2">&quot;Library1&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">                  </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;start&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;length&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">20</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">                  </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;start&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">200</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;length&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">20</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">                </span><span class="p">]</span><span class="w"></span>
<span class="w">              </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">          </span><span class="p">},</span><span class="w"></span>
<span class="w">          </span><span class="s2">&quot;deployedBytecode&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="cm">/* ..., */</span><span class="w"> </span><span class="c1">// The same layout as above.</span><span class="w"></span>
<span class="w">            </span><span class="s2">&quot;immutableReferences&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">              </span><span class="c1">// There are two references to the immutable with AST ID 3, both 32 bytes long. One is</span><span class="w"></span>
<span class="w">              </span><span class="c1">// at bytecode offset 42, the other at bytecode offset 80.</span><span class="w"></span>
<span class="w">              </span><span class="s2">&quot;3&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[{</span><span class="w"> </span><span class="s2">&quot;start&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">42</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;length&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">32</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;start&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">80</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;length&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">32</span><span class="w"> </span><span class="p">}]</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">          </span><span class="p">},</span><span class="w"></span>
<span class="w">          </span><span class="c1">// The list of function hashes</span><span class="w"></span>
<span class="w">          </span><span class="s2">&quot;methodIdentifiers&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="s2">&quot;delegate(address)&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;5c19a95c&quot;</span><span class="w"></span>
<span class="w">          </span><span class="p">},</span><span class="w"></span>
<span class="w">          </span><span class="c1">// Function gas estimates</span><span class="w"></span>
<span class="w">          </span><span class="s2">&quot;gasEstimates&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="s2">&quot;creation&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">              </span><span class="s2">&quot;codeDepositCost&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;420000&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">              </span><span class="s2">&quot;executionCost&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;infinite&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">              </span><span class="s2">&quot;totalCost&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;infinite&quot;</span><span class="w"></span>
<span class="w">            </span><span class="p">},</span><span class="w"></span>
<span class="w">            </span><span class="s2">&quot;external&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">              </span><span class="s2">&quot;delegate(address)&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;25000&quot;</span><span class="w"></span>
<span class="w">            </span><span class="p">},</span><span class="w"></span>
<span class="w">            </span><span class="s2">&quot;internal&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">              </span><span class="s2">&quot;heavyLifting()&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;infinite&quot;</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">          </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Ewasm related outputs</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;ewasm&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="c1">// S-expressions format</span><span class="w"></span>
<span class="w">          </span><span class="s2">&quot;wast&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="c1">// Binary format (hex string)</span><span class="w"></span>
<span class="w">          </span><span class="s2">&quot;wasm&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<section id="error-types">
<h5>Error Types<a class="headerlink" href="#error-types" title="Permalink to this heading">ÔÉÅ</a></h5>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">JSONError</span></code>: JSON input doesn‚Äôt conform to the required format, e.g. input is not a JSON object, the language is not supported, etc.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">IOError</span></code>: IO and import processing errors, such as unresolvable URL or hash mismatch in supplied sources.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ParserError</span></code>: Source code doesn‚Äôt conform to the language rules.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DocstringParsingError</span></code>: The NatSpec tags in the comment block cannot be parsed.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SyntaxError</span></code>: Syntactical error, such as <code class="docutils literal notranslate"><span class="pre">continue</span></code> is used outside of a <code class="docutils literal notranslate"><span class="pre">for</span></code> loop.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DeclarationError</span></code>: Invalid, unresolvable or clashing identifier names. e.g. <code class="docutils literal notranslate"><span class="pre">Identifier</span> <span class="pre">not</span> <span class="pre">found</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TypeError</span></code>: Error within the type system, such as invalid type conversions, invalid assignments, etc.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">UnimplementedFeatureError</span></code>: Feature is not supported by the compiler, but is expected to be supported in future versions.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">InternalCompilerError</span></code>: Internal bug triggered in the compiler - this should be reported as an issue.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Exception</span></code>: Unknown failure during compilation - this should be reported as an issue.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CompilerError</span></code>: Invalid use of the compiler stack - this should be reported as an issue.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">FatalError</span></code>: Fatal error not processed correctly - this should be reported as an issue.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Warning</span></code>: A warning, which didn‚Äôt stop the compilation, but should be addressed if possible.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Info</span></code>: Information that the compiler thinks the user might find useful, but is not dangerous and does not necessarily need to be addressed.</p></li>
</ol>
</section>
</section>
</section>
<section id="compiler-tools">
<span id="id2"></span><h3>Compiler Tools<a class="headerlink" href="#compiler-tools" title="Permalink to this heading">ÔÉÅ</a></h3>
<section id="solidity-upgrade">
<h4>solidity-upgrade<a class="headerlink" href="#solidity-upgrade" title="Permalink to this heading">ÔÉÅ</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">solidity-upgrade</span></code> can help you to semi-automatically upgrade your contracts
to breaking language changes. While it does not and cannot implement all
required changes for every breaking release, it still supports the ones, that
would need plenty of repetitive manual adjustments otherwise.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">solidity-upgrade</span></code> carries out a large part of the work, but your
contracts will most likely need further manual adjustments. We recommend
using a version control system for your files. This helps reviewing and
eventually rolling back the changes made.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><code class="docutils literal notranslate"><span class="pre">solidity-upgrade</span></code> is not considered to be complete or free from bugs, so
please use with care.</p>
</div>
<section id="how-it-works">
<h5>How it Works<a class="headerlink" href="#how-it-works" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>You can pass (a) Solidity source file(s) to <code class="docutils literal notranslate"><span class="pre">solidity-upgrade</span> <span class="pre">[files]</span></code>. If
these make use of <code class="docutils literal notranslate"><span class="pre">import</span></code> statement which refer to files outside the
current source file‚Äôs directory, you need to specify directories that
are allowed to read and import files from, by passing
<code class="docutils literal notranslate"><span class="pre">--allow-paths</span> <span class="pre">[directory]</span></code>. You can ignore missing files by passing
<code class="docutils literal notranslate"><span class="pre">--ignore-missing</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">solidity-upgrade</span></code> is based on <code class="docutils literal notranslate"><span class="pre">libsolidity</span></code> and can parse, compile and
analyse your source files, and might find applicable source upgrades in them.</p>
<p>Source upgrades are considered to be small textual changes to your source code.
They are applied to an in-memory representation of the source files
given. The corresponding source file is updated by default, but you can pass
<code class="docutils literal notranslate"><span class="pre">--dry-run</span></code> to simulate to whole upgrade process without writing to any file.</p>
<p>The upgrade process itself has two phases. In the first phase source files are
parsed, and since it is not possible to upgrade source code on that level,
errors are collected and can be logged by passing <code class="docutils literal notranslate"><span class="pre">--verbose</span></code>. No source
upgrades available at this point.</p>
<p>In the second phase, all sources are compiled and all activated upgrade analysis
modules are run alongside compilation. By default, all available modules are
activated. Please read the documentation on
<a class="reference internal" href="#upgrade-modules"><span class="std std-ref">available modules</span></a> for further details.</p>
<p>This can result in compilation errors that may
be fixed by source upgrades. If no errors occur, no source upgrades are being
reported and you‚Äôre done.
If errors occur and some upgrade module reported a source upgrade, the first
reported one gets applied and compilation is triggered again for all given
source files. The previous step is repeated as long as source upgrades are
reported. If errors still occur, you can log them by passing <code class="docutils literal notranslate"><span class="pre">--verbose</span></code>.
If no errors occur, your contracts are up to date and can be compiled with
the latest version of the compiler.</p>
</section>
<section id="available-upgrade-modules">
<span id="upgrade-modules"></span><h5>Available Upgrade Modules<a class="headerlink" href="#available-upgrade-modules" title="Permalink to this heading">ÔÉÅ</a></h5>
<table class="docutils align-default">
<colgroup>
<col style="width: 32%" />
<col style="width: 10%" />
<col style="width: 57%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Module</p></th>
<th class="head"><p>Version</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">constructor</span></code></p></td>
<td><p>0.5.0</p></td>
<td><p>Constructors must now be defined using the
<code class="docutils literal notranslate"><span class="pre">constructor</span></code> keyword.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">visibility</span></code></p></td>
<td><p>0.5.0</p></td>
<td><p>Explicit function visibility is now mandatory,
defaults to <code class="docutils literal notranslate"><span class="pre">public</span></code>.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">abstract</span></code></p></td>
<td><p>0.6.0</p></td>
<td><p>The keyword <code class="docutils literal notranslate"><span class="pre">abstract</span></code> has to be used if a
contract does not implement all its functions.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">virtual</span></code></p></td>
<td><p>0.6.0</p></td>
<td><p>Functions without implementation outside an
interface have to be marked <code class="docutils literal notranslate"><span class="pre">virtual</span></code>.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">override</span></code></p></td>
<td><p>0.6.0</p></td>
<td><p>When overriding a function or modifier, the new
keyword <code class="docutils literal notranslate"><span class="pre">override</span></code> must be used.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">dotsyntax</span></code></p></td>
<td><p>0.7.0</p></td>
<td><p>The following syntax is deprecated:
<code class="docutils literal notranslate"><span class="pre">f.gas(...)()</span></code>, <code class="docutils literal notranslate"><span class="pre">f.value(...)()</span></code> and
<code class="docutils literal notranslate"><span class="pre">(new</span> <span class="pre">C).value(...)()</span></code>. Replace these calls by
<code class="docutils literal notranslate"><span class="pre">f{gas:</span> <span class="pre">...,</span> <span class="pre">value:</span> <span class="pre">...}()</span></code> and
<code class="docutils literal notranslate"><span class="pre">(new</span> <span class="pre">C){value:</span> <span class="pre">...}()</span></code>.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">now</span></code></p></td>
<td><p>0.7.0</p></td>
<td><p>The <code class="docutils literal notranslate"><span class="pre">now</span></code> keyword is deprecated. Use
<code class="docutils literal notranslate"><span class="pre">block.timestamp</span></code> instead.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">constructor-visibility</span></code></p></td>
<td><p>0.7.0</p></td>
<td><p>Removes visibility of constructors.</p></td>
</tr>
</tbody>
</table>
<p>Please read <a class="reference internal" href="index.html#document-050-breaking-changes"><span class="doc">0.5.0 release notes</span></a>,
<a class="reference internal" href="index.html#document-060-breaking-changes"><span class="doc">0.6.0 release notes</span></a>,
<a class="reference internal" href="index.html#document-070-breaking-changes"><span class="doc">0.7.0 release notes</span></a> and <a class="reference internal" href="index.html#document-080-breaking-changes"><span class="doc">0.8.0 release notes</span></a> for further details.</p>
</section>
<section id="synopsis">
<h5>Synopsis<a class="headerlink" href="#synopsis" title="Permalink to this heading">ÔÉÅ</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Usage: solidity-upgrade [options] contract.sol

Allowed options:
    --help               Show help message and exit.
    --version            Show version and exit.
    --allow-paths path(s)
                         Allow a given path for imports. A list of paths can be
                         supplied by separating them with a comma.
    --ignore-missing     Ignore missing files.
    --modules module(s)  Only activate a specific upgrade module. A list of
                         modules can be supplied by separating them with a comma.
    --dry-run            Apply changes in-memory only and don&#39;t write to input
                         file.
    --verbose            Print logs, errors and changes. Shortens output of
                         upgrade patches.
    --unsafe             Accept *unsafe* changes.
</pre></div>
</div>
</section>
<section id="bug-reports-feature-requests">
<h5>Bug Reports / Feature Requests<a class="headerlink" href="#bug-reports-feature-requests" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>If you found a bug or if you have a feature request, please
<a class="reference external" href="https://github.com/ethereum/solidity/issues/new/choose">file an issue</a> on Github.</p>
</section>
<section id="example">
<h5>Example<a class="headerlink" href="#example" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>Assume that you have the following contract in <code class="docutils literal notranslate"><span class="pre">Source.sol</span></code>:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=cHJhZ21hIHNvbGlkaXR5ID49MC42LjAgPDAuNi40OwovLyBUaGlzIHdpbGwgbm90IGNvbXBpbGUgYWZ0ZXIgMC43LjAKLy8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKY29udHJhY3QgQyB7CiAgICAvLyBGSVhNRTogcmVtb3ZlIGNvbnN0cnVjdG9yIHZpc2liaWxpdHkgYW5kIG1ha2UgdGhlIGNvbnRyYWN0IGFic3RyYWN0CiAgICBjb25zdHJ1Y3RvcigpIGludGVybmFsIHt9Cn0KCmNvbnRyYWN0IEQgewogICAgdWludCB0aW1lOwoKICAgIGZ1bmN0aW9uIGYoKSBwdWJsaWMgcGF5YWJsZSB7CiAgICAgICAgLy8gRklYTUU6IGNoYW5nZSBub3cgdG8gYmxvY2sudGltZXN0YW1wCiAgICAgICAgdGltZSA9IG5vdzsKICAgIH0KfQoKY29udHJhY3QgRSB7CiAgICBEIGQ7CgogICAgLy8gRklYTUU6IHJlbW92ZSBjb25zdHJ1Y3RvciB2aXNpYmlsaXR5CiAgICBjb25zdHJ1Y3RvcigpIHB1YmxpYyB7fQoKICAgIGZ1bmN0aW9uIGcoKSBwdWJsaWMgewogICAgICAgIC8vIEZJWE1FOiBjaGFuZ2UgLnZhbHVlKDUpID0+ICB7dmFsdWU6IDV9CiAgICAgICAgZC5mLnZhbHVlKDUpKCk7CiAgICB9Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="k">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">4</span><span class="p">;</span>
<span class="c1">// This will not compile after 0.7.0</span>
<span class="c1">// </span><span class="cs">SPDX-License-Identifier:</span><span class="c1"> GPL-3.0</span>
<span class="kd">contract</span> <span class="n">C</span> <span class="p">{</span>
    <span class="c1">// FIXME: remove constructor visibility and make the contract abstract</span>
    <span class="kd">constructor</span><span class="p">()</span> <span class="k">internal</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">D</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="n">time</span><span class="p">;</span>

    <span class="kd">function</span> <span class="n">f</span><span class="p">()</span> <span class="k">public</span> <span class="k">payable</span> <span class="p">{</span>
        <span class="c1">// FIXME: change now to block.timestamp</span>
        <span class="n">time</span> <span class="o">=</span> <span class="nb">now</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">E</span> <span class="p">{</span>
    <span class="n">D</span> <span class="n">d</span><span class="p">;</span>

    <span class="c1">// FIXME: remove constructor visibility</span>
    <span class="kd">constructor</span><span class="p">()</span> <span class="k">public</span> <span class="p">{}</span>

    <span class="kd">function</span> <span class="n">g</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
        <span class="c1">// FIXME: change .value(5) =&gt;  {value: 5}</span>
        <span class="n">d</span><span class="p">.</span><span class="n">f</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="mi">5</span><span class="p">)();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<section id="required-changes">
<h6>Required Changes<a class="headerlink" href="#required-changes" title="Permalink to this heading">ÔÉÅ</a></h6>
<p>The above contract will not compile starting from 0.7.0. To bring the contract up to date with the
current Solidity version, the following upgrade modules have to be executed:
<code class="docutils literal notranslate"><span class="pre">constructor-visibility</span></code>, <code class="docutils literal notranslate"><span class="pre">now</span></code> and <code class="docutils literal notranslate"><span class="pre">dotsyntax</span></code>. Please read the documentation on
<a class="reference internal" href="#upgrade-modules"><span class="std std-ref">available modules</span></a> for further details.</p>
</section>
<section id="running-the-upgrade">
<h6>Running the Upgrade<a class="headerlink" href="#running-the-upgrade" title="Permalink to this heading">ÔÉÅ</a></h6>
<p>It is recommended to explicitly specify the upgrade modules by using <code class="docutils literal notranslate"><span class="pre">--modules</span></code> argument.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>solidity-upgrade --modules constructor-visibility,now,dotsyntax Source.sol
</pre></div>
</div>
<p>The command above applies all changes as shown below. Please review them carefully (the pragmas will
have to be updated manually.)</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC43LjAgPDAuOS4wOwphYnN0cmFjdCBjb250cmFjdCBDIHsKICAgIC8vIEZJWE1FOiByZW1vdmUgY29uc3RydWN0b3IgdmlzaWJpbGl0eSBhbmQgbWFrZSB0aGUgY29udHJhY3QgYWJzdHJhY3QKICAgIGNvbnN0cnVjdG9yKCkge30KfQoKY29udHJhY3QgRCB7CiAgICB1aW50IHRpbWU7CgogICAgZnVuY3Rpb24gZigpIHB1YmxpYyBwYXlhYmxlIHsKICAgICAgICAvLyBGSVhNRTogY2hhbmdlIG5vdyB0byBibG9jay50aW1lc3RhbXAKICAgICAgICB0aW1lID0gYmxvY2sudGltZXN0YW1wOwogICAgfQp9Cgpjb250cmFjdCBFIHsKICAgIEQgZDsKCiAgICAvLyBGSVhNRTogcmVtb3ZlIGNvbnN0cnVjdG9yIHZpc2liaWxpdHkKICAgIGNvbnN0cnVjdG9yKCkge30KCiAgICBmdW5jdGlvbiBnKCkgcHVibGljIHsKICAgICAgICAvLyBGSVhNRTogY2hhbmdlIC52YWx1ZSg1KSA9PiAge3ZhbHVlOiA1fQogICAgICAgIGQuZnt2YWx1ZTogNX0oKTsKICAgIH0KfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// </span><span class="cs">SPDX-License-Identifier:</span><span class="c1"> GPL-3.0</span>
<span class="k">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.7</span><span class="p">.</span><span class="mi">0</span> <span class="o">&lt;</span><span class="mf">0.9</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
<span class="k">abstract</span> <span class="kd">contract</span> <span class="n">C</span> <span class="p">{</span>
    <span class="c1">// FIXME: remove constructor visibility and make the contract abstract</span>
    <span class="kd">constructor</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">D</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="n">time</span><span class="p">;</span>

    <span class="kd">function</span> <span class="n">f</span><span class="p">()</span> <span class="k">public</span> <span class="k">payable</span> <span class="p">{</span>
        <span class="c1">// FIXME: change now to block.timestamp</span>
        <span class="n">time</span> <span class="o">=</span> <span class="nb">block.timestamp</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">E</span> <span class="p">{</span>
    <span class="n">D</span> <span class="n">d</span><span class="p">;</span>

    <span class="c1">// FIXME: remove constructor visibility</span>
    <span class="kd">constructor</span><span class="p">()</span> <span class="p">{}</span>

    <span class="kd">function</span> <span class="n">g</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
        <span class="c1">// FIXME: change .value(5) =&gt;  {value: 5}</span>
        <span class="n">d</span><span class="p">.</span><span class="n">f</span><span class="p">{</span><span class="n">value</span><span class="o">:</span> <span class="mi">5</span><span class="p">}();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
</section>
</section>
</section>
<span id="document-analysing-compilation-output"></span><section id="analysing-the-compiler-output">
<span id="index-0"></span><h2>Analysing the Compiler Output<a class="headerlink" href="#analysing-the-compiler-output" title="Permalink to this heading">ÔÉÅ</a></h2>
<p>It is often useful to look at the assembly code generated by the compiler. The generated binary,
i.e., the output of <code class="docutils literal notranslate"><span class="pre">solc</span> <span class="pre">--bin</span> <span class="pre">contract.sol</span></code>, is generally difficult to read. It is recommended
to use the flag <code class="docutils literal notranslate"><span class="pre">--asm</span></code> to analyse the assembly output. Even for large contracts, looking at a
visual diff of the assembly before and after a change is often very enlightening.</p>
<p>Consider the following contract (named, say <code class="docutils literal notranslate"><span class="pre">contract.sol</span></code>):</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC41LjAgPDAuOS4wOwpjb250cmFjdCBDIHsKICAgIGZ1bmN0aW9uIG9uZSgpIHB1YmxpYyBwdXJlIHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gMTsKICAgIH0KfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// </span><span class="cs">SPDX-License-Identifier:</span><span class="c1"> GPL-3.0</span>
<span class="k">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span> <span class="o">&lt;</span><span class="mf">0.9</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
<span class="kd">contract</span> <span class="n">C</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">one</span><span class="p">()</span> <span class="k">public</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The following would be the output of <code class="docutils literal notranslate"><span class="pre">solc</span> <span class="pre">--asm</span> <span class="pre">contract.sol</span></code></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>======= contract.sol:C =======
EVM assembly:
    /* &quot;contract.sol&quot;:0:86  contract C {... */
  mstore(0x40, 0x80)
  callvalue
  dup1
  iszero
  tag_1
  jumpi
  0x00
  dup1
  revert
tag_1:
  pop
  dataSize(sub_0)
  dup1
  dataOffset(sub_0)
  0x00
  codecopy
  0x00
  return
stop

sub_0: assembly {
        /* &quot;contract.sol&quot;:0:86  contract C {... */
      mstore(0x40, 0x80)
      callvalue
      dup1
      iszero
      tag_1
      jumpi
      0x00
      dup1
      revert
    tag_1:
      pop
      jumpi(tag_2, lt(calldatasize, 0x04))
      shr(0xe0, calldataload(0x00))
      dup1
      0x901717d1
      eq
      tag_3
      jumpi
    tag_2:
      0x00
      dup1
      revert
        /* &quot;contract.sol&quot;:17:84  function one() public pure returns (uint) {... */
    tag_3:
      tag_4
      tag_5
      jump  // in
    tag_4:
      mload(0x40)
      tag_6
      swap2
      swap1
      tag_7
      jump  // in
    tag_6:
      mload(0x40)
      dup1
      swap2
      sub
      swap1
      return
    tag_5:
        /* &quot;contract.sol&quot;:53:57  uint */
      0x00
        /* &quot;contract.sol&quot;:76:77  1 */
      0x01
        /* &quot;contract.sol&quot;:69:77  return 1 */
      swap1
      pop
        /* &quot;contract.sol&quot;:17:84  function one() public pure returns (uint) {... */
      swap1
      jump  // out
        /* &quot;#utility.yul&quot;:7:125   */
    tag_10:
        /* &quot;#utility.yul&quot;:94:118   */
      tag_12
        /* &quot;#utility.yul&quot;:112:117   */
      dup2
        /* &quot;#utility.yul&quot;:94:118   */
      tag_13
      jump  // in
    tag_12:
        /* &quot;#utility.yul&quot;:89:92   */
      dup3
        /* &quot;#utility.yul&quot;:82:119   */
      mstore
        /* &quot;#utility.yul&quot;:72:125   */
      pop
      pop
      jump  // out
        /* &quot;#utility.yul&quot;:131:353   */
    tag_7:
      0x00
        /* &quot;#utility.yul&quot;:262:264   */
      0x20
        /* &quot;#utility.yul&quot;:251:260   */
      dup3
        /* &quot;#utility.yul&quot;:247:265   */
      add
        /* &quot;#utility.yul&quot;:239:265   */
      swap1
      pop
        /* &quot;#utility.yul&quot;:275:346   */
      tag_15
        /* &quot;#utility.yul&quot;:343:344   */
      0x00
        /* &quot;#utility.yul&quot;:332:341   */
      dup4
        /* &quot;#utility.yul&quot;:328:345   */
      add
        /* &quot;#utility.yul&quot;:319:325   */
      dup5
        /* &quot;#utility.yul&quot;:275:346   */
      tag_10
      jump  // in
    tag_15:
        /* &quot;#utility.yul&quot;:229:353   */
      swap3
      swap2
      pop
      pop
      jump  // out
        /* &quot;#utility.yul&quot;:359:436   */
    tag_13:
      0x00
        /* &quot;#utility.yul&quot;:425:430   */
      dup2
        /* &quot;#utility.yul&quot;:414:430   */
      swap1
      pop
        /* &quot;#utility.yul&quot;:404:436   */
      swap2
      swap1
      pop
      jump  // out

    auxdata: 0xa2646970667358221220a5874f19737ddd4c5d77ace1619e5160c67b3d4bedac75fce908fed32d98899864736f6c637827302e382e342d646576656c6f702e323032312e332e33302b636f6d6d69742e65613065363933380058
}
</pre></div>
</div>
<p>Alternatively, the above output can also be obtained from <a class="reference external" href="https://remix.ethereum.org/">Remix</a>,
under the option ‚ÄúCompilation Details‚Äù after compiling a contract.</p>
<p>Notice that the <code class="docutils literal notranslate"><span class="pre">asm</span></code> output starts with the creation / constructor code. The deploy code is
provided as part of the sub object (in the above example, it is part of the sub-object <code class="docutils literal notranslate"><span class="pre">sub_0</span></code>).
The <code class="docutils literal notranslate"><span class="pre">auxdata</span></code> field corresponds to the contract <a class="reference internal" href="index.html#encoding-of-the-metadata-hash-in-the-bytecode"><span class="std std-ref">metadata</span></a>. The comments in the assembly output point to the
source location. Note that <code class="docutils literal notranslate"><span class="pre">#utility.yul</span></code> is an internally generated file of utility functions
that can be obtained using the flags <code class="docutils literal notranslate"><span class="pre">--combined-json</span>
<span class="pre">generated-sources,generated-sources-runtime</span></code>.</p>
<p>Similarly, the optimized assembly can be obtained with the command: <code class="docutils literal notranslate"><span class="pre">solc</span> <span class="pre">--optimize</span> <span class="pre">--asm</span>
<span class="pre">contract.sol</span></code>. Often times, it is interesting to see if two different sources in Solidity result in
the same optimized code. For example, to see if the expressions <code class="docutils literal notranslate"><span class="pre">(a</span> <span class="pre">*</span> <span class="pre">b)</span> <span class="pre">/</span> <span class="pre">c</span></code>, <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">*</span> <span class="pre">b</span> <span class="pre">/</span> <span class="pre">c</span></code>
generates the same bytecode. This can be easily done by taking a <code class="docutils literal notranslate"><span class="pre">diff</span></code> of the corresponding
assembly output, after potentially stripping comments that reference the source locations.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">--asm</span></code> output is not designed to be machine readable. Therefore, there may be breaking
changes on the output between minor versions of solc.</p>
</div>
</section>
<span id="document-ir-breaking-changes"></span><section id="solidity-ir-based-codegen-changes">
<span id="ir-breaking-changes"></span><h2>Solidity IR-based Codegen Changes<a class="headerlink" href="#solidity-ir-based-codegen-changes" title="Permalink to this heading">ÔÉÅ</a></h2>
<p>Solidity can generate EVM bytecode in two different ways:
Either directly from Solidity to EVM opcodes (‚Äúold codegen‚Äù) or through
an intermediate representation (‚ÄúIR‚Äù) in Yul (‚Äúnew codegen‚Äù or ‚ÄúIR-based codegen‚Äù).</p>
<p>The IR-based code generator was introduced with an aim to not only allow
code generation to be more transparent and auditable but also
to enable more powerful optimization passes that span across functions.</p>
<p>You can enable it on the command line using <code class="docutils literal notranslate"><span class="pre">--via-ir</span></code>
or with the option <code class="docutils literal notranslate"><span class="pre">{&quot;viaIR&quot;:</span> <span class="pre">true}</span></code> in standard-json and we
encourage everyone to try it out!</p>
<p>For several reasons, there are tiny semantic differences between the old
and the IR-based code generator, mostly in areas where we would not
expect people to rely on this behaviour anyway.
This section highlights the main differences between the old and the IR-based codegen.</p>
<section id="semantic-only-changes">
<h3>Semantic Only Changes<a class="headerlink" href="#semantic-only-changes" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>This section lists the changes that are semantic-only, thus potentially
hiding new and different behavior in existing code.</p>
<ul>
<li><p>The order of state variable initialization has changed in case of inheritance.</p>
<p>The order used to be:</p>
<ul class="simple">
<li><p>All state variables are zero-initialized at the beginning.</p></li>
<li><p>Evaluate base constructor arguments from most derived to most base contract.</p></li>
<li><p>Initialize all state variables in the whole inheritance hierarchy from most base to most derived.</p></li>
<li><p>Run the constructor, if present, for all contracts in the linearized hierarchy from most base to most derived.</p></li>
</ul>
<p>New order:</p>
<ul>
<li><p>All state variables are zero-initialized at the beginning.</p></li>
<li><p>Evaluate base constructor arguments from most derived to most base contract.</p></li>
<li><p>For every contract in order from most base to most derived in the linearized hierarchy:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Initialize state variables.</p></li>
<li><p>Run the constructor (if present).</p></li>
</ol>
</div></blockquote>
</li>
</ul>
<p>This causes differences in contracts where the initial value of a state
variable relies on the result of the constructor in another contract:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC43LjE7Cgpjb250cmFjdCBBIHsKICAgIHVpbnQgeDsKICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgIHggPSA0MjsKICAgIH0KICAgIGZ1bmN0aW9uIGYoKSBwdWJsaWMgdmlldyByZXR1cm5zKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4geDsKICAgIH0KfQpjb250cmFjdCBCIGlzIEEgewogICAgdWludCBwdWJsaWMgeSA9IGYoKTsKfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.7.1</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">A</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="nv">x</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>x<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">42</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">f</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="p">(</span><span class="kt">uint256</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>x<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="k">contract</span><span class="w"> </span><span class="ni">B</span><span class="w"> </span><span class="kt">is</span><span class="w"> </span>A<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="k">public </span><span class="nv">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>f<span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Previously, <code class="docutils literal notranslate"><span class="pre">y</span></code> would be set to 0. This is due to the fact that we would first initialize state variables: First, <code class="docutils literal notranslate"><span class="pre">x</span></code> is set to 0, and when initializing <code class="docutils literal notranslate"><span class="pre">y</span></code>, <code class="docutils literal notranslate"><span class="pre">f()</span></code> would return 0 causing <code class="docutils literal notranslate"><span class="pre">y</span></code> to be 0 as well.
With the new rules, <code class="docutils literal notranslate"><span class="pre">y</span></code> will be set to 42. We first initialize <code class="docutils literal notranslate"><span class="pre">x</span></code> to 0, then call A‚Äôs constructor which sets <code class="docutils literal notranslate"><span class="pre">x</span></code> to 42. Finally, when initializing <code class="docutils literal notranslate"><span class="pre">y</span></code>, <code class="docutils literal notranslate"><span class="pre">f()</span></code> returns 42 causing <code class="docutils literal notranslate"><span class="pre">y</span></code> to be 42.</p>
</li>
<li><p>When storage structs are deleted, every storage slot that contains
a member of the struct is set to zero entirely. Formerly, padding space
was left untouched.
Consequently, if the padding space within a struct is used to store data
(e.g. in the context of a contract upgrade), you have to be aware that
<code class="docutils literal notranslate"><span class="pre">delete</span></code> will now also clear the added member (while it wouldn‚Äôt
have been cleared in the past).</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC43LjE7Cgpjb250cmFjdCBDIHsKICAgIHN0cnVjdCBTIHsKICAgICAgICB1aW50NjQgeTsKICAgICAgICB1aW50NjQgejsKICAgIH0KICAgIFMgczsKICAgIGZ1bmN0aW9uIGYoKSBwdWJsaWMgewogICAgICAgIC8vIC4uLgogICAgICAgIGRlbGV0ZSBzOwogICAgICAgIC8vIHMgb2NjdXBpZXMgb25seSBmaXJzdCAxNiBieXRlcyBvZiB0aGUgMzIgYnl0ZXMgc2xvdAogICAgICAgIC8vIGRlbGV0ZSB3aWxsIHdyaXRlIHplcm8gdG8gdGhlIGZ1bGwgc2xvdAogICAgfQp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.7.1</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">C</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">struct</span><span class="w"> </span><span class="nv">S</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint64</span><span class="w"> </span><span class="nv">y</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint64</span><span class="w"> </span><span class="nv">z</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span>S<span class="w"> </span>s<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">f</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// ...</span>
<span class="w">        </span>delete<span class="w"> </span>s<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="c1">// s occupies only first 16 bytes of the 32 bytes slot</span>
<span class="w">        </span><span class="c1">// delete will write zero to the full slot</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>We have the same behavior for implicit delete, for example when array of structs is shortened.</p>
</li>
<li><p>Function modifiers are implemented in a slightly different way regarding function parameters and return variables.
This especially has an effect if the placeholder <code class="docutils literal notranslate"><span class="pre">_;</span></code> is evaluated multiple times in a modifier.
In the old code generator, each function parameter and return variable has a fixed slot on the stack.
If the function is run multiple times because <code class="docutils literal notranslate"><span class="pre">_;</span></code> is used multiple times or used in a loop, then a
change to the function parameter‚Äôs or return variable‚Äôs value is visible in the next execution of the function.
The new code generator implements modifiers using actual functions and passes function parameters on.
This means that multiple evaluations of a function‚Äôs body will get the same values for the parameters,
and the effect on return variables is that they are reset to their default (zero) value for each
execution.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC43LjA7CmNvbnRyYWN0IEMgewogICAgZnVuY3Rpb24gZih1aW50IGEpIHB1YmxpYyBwdXJlIG1vZCgpIHJldHVybnMgKHVpbnQgcikgewogICAgICAgIHIgPSBhKys7CiAgICB9CiAgICBtb2RpZmllciBtb2QoKSB7IF87IF87IH0KfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.7.0</span><span class="p">;</span><span class="w"></span>
<span class="k">contract</span><span class="w"> </span><span class="ni">C</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">f</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">a</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>pure<span class="w"> </span>mod<span class="p">()</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>r<span class="w"> </span><span class="o">=</span><span class="w"> </span>a<span class="o">++</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="kt">modifier</span><span class="w"> </span>mod<span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>_<span class="p">;</span><span class="w"> </span>_<span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>If you execute <code class="docutils literal notranslate"><span class="pre">f(0)</span></code> in the old code generator, it will return <code class="docutils literal notranslate"><span class="pre">2</span></code>, while
it will return <code class="docutils literal notranslate"><span class="pre">1</span></code> when using the new code generator.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC43LjEgPDAuOS4wOwoKY29udHJhY3QgQyB7CiAgICBib29sIGFjdGl2ZSA9IHRydWU7CiAgICBtb2RpZmllciBtb2QoKQogICAgewogICAgICAgIF87CiAgICAgICAgYWN0aXZlID0gZmFsc2U7CiAgICAgICAgXzsKICAgIH0KICAgIGZ1bmN0aW9uIGZvbygpIGV4dGVybmFsIG1vZCgpIHJldHVybnMgKHVpbnQgcmV0KQogICAgewogICAgICAgIGlmIChhY3RpdmUpCiAgICAgICAgICAgIHJldCA9IDE7IC8vIFNhbWUgYXMgYGByZXR1cm4gMWBgCiAgICB9Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.7.1</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">C</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="nv">active</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">modifier</span><span class="w"> </span>mod<span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>_<span class="p">;</span><span class="w"></span>
<span class="w">        </span>active<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">false</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span>_<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">foo</span><span class="p">()</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>mod<span class="p">()</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">ret</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>active<span class="p">)</span><span class="w"></span>
<span class="w">            </span>ret<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// Same as ``return 1``</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>The function <code class="docutils literal notranslate"><span class="pre">C.foo()</span></code> returns the following values:</p>
<ul class="simple">
<li><p>Old code generator: <code class="docutils literal notranslate"><span class="pre">1</span></code> as the return variable is initialized to <code class="docutils literal notranslate"><span class="pre">0</span></code> only once before the first <code class="docutils literal notranslate"><span class="pre">_;</span></code>
evaluation and then overwritten by the <code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">1;</span></code>. It is not initialized again for the second <code class="docutils literal notranslate"><span class="pre">_;</span></code>
evaluation and <code class="docutils literal notranslate"><span class="pre">foo()</span></code> does not explicitly assign it either (due to <code class="docutils literal notranslate"><span class="pre">active</span> <span class="pre">==</span> <span class="pre">false</span></code>), thus it keeps
its first value.</p></li>
<li><p>New code generator: <code class="docutils literal notranslate"><span class="pre">0</span></code> as all parameters, including return parameters, will be re-initialized before
each <code class="docutils literal notranslate"><span class="pre">_;</span></code> evaluation.</p></li>
</ul>
</li>
<li id="index-0"><p>For the old code generator, the evaluation order of expressions is unspecified.
For the new code generator, we try to evaluate in source order (left to right), but do not guarantee it.
This can lead to semantic differences.</p>
<p>For example:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC44LjE7CmNvbnRyYWN0IEMgewogICAgZnVuY3Rpb24gcHJlaW5jcl91OCh1aW50OCBhKSBwdWJsaWMgcHVyZSByZXR1cm5zICh1aW50OCkgewogICAgICAgIHJldHVybiArK2EgKyBhOwogICAgfQp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.8.1</span><span class="p">;</span><span class="w"></span>
<span class="k">contract</span><span class="w"> </span><span class="ni">C</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">preincr_u8</span><span class="p">(</span><span class="kt">uint8</span><span class="w"> </span><span class="nv">a</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint8</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span><span class="o">++</span>a<span class="w"> </span><span class="o">+</span><span class="w"> </span>a<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>The function <code class="docutils literal notranslate"><span class="pre">preincr_u8(1)</span></code> returns the following values:</p>
<ul class="simple">
<li><p>Old code generator: 3 (<code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">+</span> <span class="pre">2</span></code>) but the return value is unspecified in general</p></li>
<li><p>New code generator: 4 (<code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">+</span> <span class="pre">2</span></code>) but the return value is not guaranteed</p></li>
</ul>
<p id="index-1">On the other hand, function argument expressions are evaluated in the same order
by both code generators with the exception of the global functions <code class="docutils literal notranslate"><span class="pre">addmod</span></code> and <code class="docutils literal notranslate"><span class="pre">mulmod</span></code>.
For example:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC44LjE7CmNvbnRyYWN0IEMgewogICAgZnVuY3Rpb24gYWRkKHVpbnQ4IGEsIHVpbnQ4IGIpIHB1YmxpYyBwdXJlIHJldHVybnMgKHVpbnQ4KSB7CiAgICAgICAgcmV0dXJuIGEgKyBiOwogICAgfQogICAgZnVuY3Rpb24gZyh1aW50OCBhLCB1aW50OCBiKSBwdWJsaWMgcHVyZSByZXR1cm5zICh1aW50OCkgewogICAgICAgIHJldHVybiBhZGQoKythICsgKytiLCBhICsgYik7CiAgICB9Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.8.1</span><span class="p">;</span><span class="w"></span>
<span class="k">contract</span><span class="w"> </span><span class="ni">C</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">add</span><span class="p">(</span><span class="kt">uint8</span><span class="w"> </span><span class="nv">a</span><span class="p">,</span><span class="w"> </span><span class="kt">uint8</span><span class="w"> </span><span class="nv">b</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint8</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>a<span class="w"> </span><span class="o">+</span><span class="w"> </span>b<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">g</span><span class="p">(</span><span class="kt">uint8</span><span class="w"> </span><span class="nv">a</span><span class="p">,</span><span class="w"> </span><span class="kt">uint8</span><span class="w"> </span><span class="nv">b</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint8</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>add<span class="p">(</span><span class="o">++</span>a<span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">++</span>b<span class="p">,</span><span class="w"> </span>a<span class="w"> </span><span class="o">+</span><span class="w"> </span>b<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>The function <code class="docutils literal notranslate"><span class="pre">g(1,</span> <span class="pre">2)</span></code> returns the following values:</p>
<ul class="simple">
<li><p>Old code generator: <code class="docutils literal notranslate"><span class="pre">10</span></code> (<code class="docutils literal notranslate"><span class="pre">add(2</span> <span class="pre">+</span> <span class="pre">3,</span> <span class="pre">2</span> <span class="pre">+</span> <span class="pre">3)</span></code>) but the return value is unspecified in general</p></li>
<li><p>New code generator: <code class="docutils literal notranslate"><span class="pre">10</span></code> but the return value is not guaranteed</p></li>
</ul>
<p>The arguments to the global functions <code class="docutils literal notranslate"><span class="pre">addmod</span></code> and <code class="docutils literal notranslate"><span class="pre">mulmod</span></code> are evaluated right-to-left by the old code generator
and left-to-right by the new code generator.
For example:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC44LjE7CmNvbnRyYWN0IEMgewogICAgZnVuY3Rpb24gZigpIHB1YmxpYyBwdXJlIHJldHVybnMgKHVpbnQyNTYgYU1vZCwgdWludDI1NiBtTW9kKSB7CiAgICAgICAgdWludDI1NiB4ID0gMzsKICAgICAgICAvLyBPbGQgY29kZSBnZW46IGFkZC9tdWxtb2QoNSwgNCwgMykKICAgICAgICAvLyBOZXcgY29kZSBnZW46IGFkZC9tdWxtb2QoNCwgNSwgNSkKICAgICAgICBhTW9kID0gYWRkbW9kKCsreCwgKyt4LCB4KTsKICAgICAgICBtTW9kID0gbXVsbW9kKCsreCwgKyt4LCB4KTsKICAgIH0KfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.8.1</span><span class="p">;</span><span class="w"></span>
<span class="k">contract</span><span class="w"> </span><span class="ni">C</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">f</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">aMod</span><span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">mMod</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">3</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Old code gen: add/mulmod(5, 4, 3)</span>
<span class="w">        </span><span class="c1">// New code gen: add/mulmod(4, 5, 5)</span>
<span class="w">        </span>aMod<span class="w"> </span><span class="o">=</span><span class="w"> </span>addmod<span class="p">(</span><span class="o">++</span>x<span class="p">,</span><span class="w"> </span><span class="o">++</span>x<span class="p">,</span><span class="w"> </span>x<span class="p">);</span><span class="w"></span>
<span class="w">        </span>mMod<span class="w"> </span><span class="o">=</span><span class="w"> </span>mulmod<span class="p">(</span><span class="o">++</span>x<span class="p">,</span><span class="w"> </span><span class="o">++</span>x<span class="p">,</span><span class="w"> </span>x<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>The function <code class="docutils literal notranslate"><span class="pre">f()</span></code> returns the following values:</p>
<ul class="simple">
<li><p>Old code generator: <code class="docutils literal notranslate"><span class="pre">aMod</span> <span class="pre">=</span> <span class="pre">0</span></code> and <code class="docutils literal notranslate"><span class="pre">mMod</span> <span class="pre">=</span> <span class="pre">2</span></code></p></li>
<li><p>New code generator: <code class="docutils literal notranslate"><span class="pre">aMod</span> <span class="pre">=</span> <span class="pre">4</span></code> and <code class="docutils literal notranslate"><span class="pre">mMod</span> <span class="pre">=</span> <span class="pre">0</span></code></p></li>
</ul>
</li>
<li><p>The new code generator imposes a hard limit of <code class="docutils literal notranslate"><span class="pre">type(uint64).max</span></code>
(<code class="docutils literal notranslate"><span class="pre">0xffffffffffffffff</span></code>) for the free memory pointer. Allocations that would
increase its value beyond this limit revert. The old code generator does not
have this limit.</p>
<p>For example:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID4wLjguMDsKY29udHJhY3QgQyB7CiAgICBmdW5jdGlvbiBmKCkgcHVibGljIHsKICAgICAgICB1aW50W10gbWVtb3J5IGFycjsKICAgICAgICAvLyBhbGxvY2F0aW9uIHNpemU6IDU3NjQ2MDc1MjMwMzQyMzQ4MQogICAgICAgIC8vIGFzc3VtZXMgZnJlZU1lbVB0ciBwb2ludHMgdG8gMHg4MCBpbml0aWFsbHkKICAgICAgICB1aW50IHNvbFl1bE1heEFsbG9jYXRpb25CZWZvcmVNZW1QdHJPdmVyZmxvdyA9ICh0eXBlKHVpbnQ2NCkubWF4IC0gMHg4MCAtIDMxKSAvIDMyOwogICAgICAgIC8vIGZyZWVNZW1QdHIgb3ZlcmZsb3dzIFVJTlQ2NF9NQVgKICAgICAgICBhcnIgPSBuZXcgdWludFtdKHNvbFl1bE1heEFsbG9jYXRpb25CZWZvcmVNZW1QdHJPdmVyZmxvdyk7CiAgICB9Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="err">&gt;0.8.0</span><span class="p">;</span><span class="w"></span>
<span class="k">contract</span><span class="w"> </span><span class="ni">C</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">f</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>arr<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="c1">// allocation size: 576460752303423481</span>
<span class="w">        </span><span class="c1">// assumes freeMemPtr points to 0x80 initially</span>
<span class="w">        </span><span class="kt">uint</span><span class="w"> </span><span class="nv">solYulMaxAllocationBeforeMemPtrOverflow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span>type<span class="p">(</span><span class="kt">uint64</span><span class="p">).</span>max<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mh">0x80</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m m-Decimal">31</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m m-Decimal">32</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="c1">// freeMemPtr overflows UINT64_MAX</span>
<span class="w">        </span>arr<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="kt">uint</span><span class="p">[](</span>solYulMaxAllocationBeforeMemPtrOverflow<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>The function <cite>f()</cite> behaves as follows:</p>
<ul class="simple">
<li><p>Old code generator: runs out of gas while zeroing the array contents after the large memory allocation</p></li>
<li><p>New code generator: reverts due to free memory pointer overflow (does not run out of gas)</p></li>
</ul>
</li>
</ul>
</section>
<section id="internals">
<h3>Internals<a class="headerlink" href="#internals" title="Permalink to this heading">ÔÉÅ</a></h3>
<section id="internal-function-pointers">
<h4>Internal function pointers<a class="headerlink" href="#internal-function-pointers" title="Permalink to this heading">ÔÉÅ</a></h4>
<p id="index-2">The old code generator uses code offsets or tags for values of internal function pointers. This is especially complicated since
these offsets are different at construction time and after deployment and the values can cross this border via storage.
Because of that, both offsets are encoded at construction time into the same value (into different bytes).</p>
<p>In the new code generator, function pointers use internal IDs that are allocated in sequence. Since calls via jumps are not possible,
calls through function pointers always have to use an internal dispatch function that uses the <code class="docutils literal notranslate"><span class="pre">switch</span></code> statement to select
the right function.</p>
<p>The ID <code class="docutils literal notranslate"><span class="pre">0</span></code> is reserved for uninitialized function pointers which then cause a panic in the dispatch function when called.</p>
<p>In the old code generator, internal function pointers are initialized with a special function that always causes a panic.
This causes a storage write at construction time for internal function pointers in storage.</p>
</section>
<section id="cleanup">
<h4>Cleanup<a class="headerlink" href="#cleanup" title="Permalink to this heading">ÔÉÅ</a></h4>
<p id="index-3">The old code generator only performs cleanup before an operation whose result could be affected by the values of the dirty bits.
The new code generator performs cleanup after any operation that can result in dirty bits.
The hope is that the optimizer will be powerful enough to eliminate redundant cleanup operations.</p>
<p>For example:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC44LjE7CmNvbnRyYWN0IEMgewogICAgZnVuY3Rpb24gZih1aW50OCBhKSBwdWJsaWMgcHVyZSByZXR1cm5zICh1aW50IHIxLCB1aW50IHIyKQogICAgewogICAgICAgIGEgPSB+YTsKICAgICAgICBhc3NlbWJseSB7CiAgICAgICAgICAgIHIxIDo9IGEKICAgICAgICB9CiAgICAgICAgcjIgPSBhOwogICAgfQp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.8.1</span><span class="p">;</span><span class="w"></span>
<span class="k">contract</span><span class="w"> </span><span class="ni">C</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">f</span><span class="p">(</span><span class="kt">uint8</span><span class="w"> </span><span class="nv">a</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">r1</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">r2</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>a<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">~</span>a<span class="p">;</span><span class="w"></span>
<span class="w">        </span>assembly<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span>r1<span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span>a<span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span>r2<span class="w"> </span><span class="o">=</span><span class="w"> </span>a<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>The function <code class="docutils literal notranslate"><span class="pre">f(1)</span></code> returns the following values:</p>
<ul class="simple">
<li><p>Old code generator: (<code class="docutils literal notranslate"><span class="pre">fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe</span></code>, <code class="docutils literal notranslate"><span class="pre">00000000000000000000000000000000000000000000000000000000000000fe</span></code>)</p></li>
<li><p>New code generator: (<code class="docutils literal notranslate"><span class="pre">00000000000000000000000000000000000000000000000000000000000000fe</span></code>, <code class="docutils literal notranslate"><span class="pre">00000000000000000000000000000000000000000000000000000000000000fe</span></code>)</p></li>
</ul>
<p>Note that, unlike the new code generator, the old code generator does not perform a cleanup after the bit-not assignment (<code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">=</span> <span class="pre">~a</span></code>).
This results in different values being assigned (within the inline assembly block) to return value <code class="docutils literal notranslate"><span class="pre">r1</span></code> between the old and new code generators.
However, both code generators perform a cleanup before the new value of <code class="docutils literal notranslate"><span class="pre">a</span></code> is assigned to <code class="docutils literal notranslate"><span class="pre">r2</span></code>.</p>
</section>
</section>
</section>
</div>
<div class="toctree-wrapper compound">
<span id="document-internals/layout_in_storage"></span><section id="layout-of-state-variables-in-storage">
<span id="index-0"></span><h2>Layout of State Variables in Storage<a class="headerlink" href="#layout-of-state-variables-in-storage" title="Permalink to this heading">ÔÉÅ</a></h2>
<p id="storage-inplace-encoding">State variables of contracts are stored in storage in a compact way such
that multiple values sometimes use the same storage slot.
Except for dynamically-sized arrays and mappings (see below), data is stored
contiguously item after item starting with the first state variable,
which is stored in slot <code class="docutils literal notranslate"><span class="pre">0</span></code>. For each variable,
a size in bytes is determined according to its type.
Multiple, contiguous items that need less than 32 bytes are packed into a single
storage slot if possible, according to the following rules:</p>
<ul class="simple">
<li><p>The first item in a storage slot is stored lower-order aligned.</p></li>
<li><p>Value types use only as many bytes as are necessary to store them.</p></li>
<li><p>If a value type does not fit the remaining part of a storage slot, it is stored in the next storage slot.</p></li>
<li><p>Structs and array data always start a new slot and their items are packed tightly according to these rules.</p></li>
<li><p>Items following struct or array data always start a new storage slot.</p></li>
</ul>
<p>For contracts that use inheritance, the ordering of state variables is determined by the
C3-linearized order of contracts starting with the most base-ward contract. If allowed
by the above rules, state variables from different contracts do share the same storage slot.</p>
<p>The elements of structs and arrays are stored after each other, just as if they were given
as individual values.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>When using elements that are smaller than 32 bytes, your contract‚Äôs gas usage may be higher.
This is because the EVM operates on 32 bytes at a time. Therefore, if the element is smaller
than that, the EVM must use more operations in order to reduce the size of the element from 32
bytes to the desired size.</p>
<p>It might be beneficial to use reduced-size types if you are dealing with storage values
because the compiler will pack multiple elements into one storage slot, and thus, combine
multiple reads or writes into a single operation.
If you are not reading or writing all the values in a slot at the same time, this can
have the opposite effect, though: When one value is written to a multi-value storage
slot, the storage slot has to be read first and then
combined with the new value such that other data in the same slot is not destroyed.</p>
<p>When dealing with function arguments or memory
values, there is no inherent benefit because the compiler does not pack these values.</p>
<p>Finally, in order to allow the EVM to optimize for this, ensure that you try to order your
storage variables and <code class="docutils literal notranslate"><span class="pre">struct</span></code> members such that they can be packed tightly. For example,
declaring your storage variables in the order of <code class="docutils literal notranslate"><span class="pre">uint128,</span> <span class="pre">uint128,</span> <span class="pre">uint256</span></code> instead of
<code class="docutils literal notranslate"><span class="pre">uint128,</span> <span class="pre">uint256,</span> <span class="pre">uint128</span></code>, as the former will only take up two slots of storage whereas the
latter will take up three.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The layout of state variables in storage is considered to be part of the external interface
of Solidity due to the fact that storage pointers can be passed to libraries. This means that
any change to the rules outlined in this section is considered a breaking change
of the language and due to its critical nature should be considered very carefully before
being executed. In the event of such a breaking change, we would want to release a
compatibility mode in which the compiler would generate bytecode supporting the old layout.</p>
</div>
<section id="mappings-and-dynamic-arrays">
<h3>Mappings and Dynamic Arrays<a class="headerlink" href="#mappings-and-dynamic-arrays" title="Permalink to this heading">ÔÉÅ</a></h3>
<p id="storage-hashed-encoding">Due to their unpredictable size, mappings and dynamically-sized array types cannot be stored
‚Äúin between‚Äù the state variables preceding and following them.
Instead, they are considered to occupy only 32 bytes with regards to the
<a class="reference internal" href="#storage-inplace-encoding"><span class="std std-ref">rules above</span></a> and the elements they contain are stored starting at a different
storage slot that is computed using a Keccak-256 hash.</p>
<p>Assume the storage location of the mapping or array ends up being a slot <code class="docutils literal notranslate"><span class="pre">p</span></code>
after applying <a class="reference internal" href="#storage-inplace-encoding"><span class="std std-ref">the storage layout rules</span></a>.
For dynamic arrays,
this slot stores the number of elements in the array (byte arrays and
strings are an exception, see <a class="reference internal" href="#bytes-and-string"><span class="std std-ref">below</span></a>).
For mappings, the slot stays empty, but it is still needed to ensure that even if there are
two mappings next to each other, their content ends up at different storage locations.</p>
<p>Array data is located starting at <code class="docutils literal notranslate"><span class="pre">keccak256(p)</span></code> and it is laid out in the same way as
statically-sized array data would: One element after the other, potentially sharing
storage slots if the elements are not longer than 16 bytes. Dynamic arrays of dynamic arrays apply this
rule recursively. The location of element <code class="docutils literal notranslate"><span class="pre">x[i][j]</span></code>, where the type of <code class="docutils literal notranslate"><span class="pre">x</span></code> is <code class="docutils literal notranslate"><span class="pre">uint24[][]</span></code>, is
computed as follows (again, assuming <code class="docutils literal notranslate"><span class="pre">x</span></code> itself is stored at slot <code class="docutils literal notranslate"><span class="pre">p</span></code>):
The slot is <code class="docutils literal notranslate"><span class="pre">keccak256(keccak256(p)</span> <span class="pre">+</span> <span class="pre">i)</span> <span class="pre">+</span> <span class="pre">floor(j</span> <span class="pre">/</span> <span class="pre">floor(256</span> <span class="pre">/</span> <span class="pre">24))</span></code> and
the element can be obtained from the slot data <code class="docutils literal notranslate"><span class="pre">v</span></code> using <code class="docutils literal notranslate"><span class="pre">(v</span> <span class="pre">&gt;&gt;</span> <span class="pre">((j</span> <span class="pre">%</span> <span class="pre">floor(256</span> <span class="pre">/</span> <span class="pre">24))</span> <span class="pre">*</span> <span class="pre">24))</span> <span class="pre">&amp;</span> <span class="pre">type(uint24).max</span></code>.</p>
<p>The value corresponding to a mapping key <code class="docutils literal notranslate"><span class="pre">k</span></code> is located at <code class="docutils literal notranslate"><span class="pre">keccak256(h(k)</span> <span class="pre">.</span> <span class="pre">p)</span></code>
where <code class="docutils literal notranslate"><span class="pre">.</span></code> is concatenation and <code class="docutils literal notranslate"><span class="pre">h</span></code> is a function that is applied to the key depending on its type:</p>
<ul class="simple">
<li><p>for value types, <code class="docutils literal notranslate"><span class="pre">h</span></code> pads the value to 32 bytes in the same way as when storing the value in memory.</p></li>
<li><p>for strings and byte arrays, <code class="docutils literal notranslate"><span class="pre">h(k)</span></code> is just the unpadded data.</p></li>
</ul>
<p>If the mapping value is a
non-value type, the computed slot marks the start of the data. If the value is of struct type,
for example, you have to add an offset corresponding to the struct member to reach the member.</p>
<p>As an example, consider the following contract:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC40LjAgPDAuOS4wOwoKCmNvbnRyYWN0IEMgewogICAgc3RydWN0IFMgeyB1aW50MTYgYTsgdWludDE2IGI7IHVpbnQyNTYgYzsgfQogICAgdWludCB4OwogICAgbWFwcGluZyh1aW50ID0+IG1hcHBpbmcodWludCA9PiBTKSkgZGF0YTsKfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.4.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>


<span class="k">contract</span><span class="w"> </span><span class="ni">C</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">struct</span><span class="w"> </span><span class="nv">S</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kt">uint16</span><span class="w"> </span><span class="nv">a</span><span class="p">;</span><span class="w"> </span><span class="kt">uint16</span><span class="w"> </span><span class="nv">b</span><span class="p">;</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">c</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="nv">x</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span>S<span class="p">))</span><span class="w"> </span>data<span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Let us compute the storage location of <code class="docutils literal notranslate"><span class="pre">data[4][9].c</span></code>.
The position of the mapping itself is <code class="docutils literal notranslate"><span class="pre">1</span></code> (the variable <code class="docutils literal notranslate"><span class="pre">x</span></code> with 32 bytes precedes it).
This means <code class="docutils literal notranslate"><span class="pre">data[4]</span></code> is stored at <code class="docutils literal notranslate"><span class="pre">keccak256(uint256(4)</span> <span class="pre">.</span> <span class="pre">uint256(1))</span></code>. The type of <code class="docutils literal notranslate"><span class="pre">data[4]</span></code> is
again a mapping and the data for <code class="docutils literal notranslate"><span class="pre">data[4][9]</span></code> starts at slot
<code class="docutils literal notranslate"><span class="pre">keccak256(uint256(9)</span> <span class="pre">.</span> <span class="pre">keccak256(uint256(4)</span> <span class="pre">.</span> <span class="pre">uint256(1)))</span></code>.
The slot offset of the member <code class="docutils literal notranslate"><span class="pre">c</span></code> inside the struct <code class="docutils literal notranslate"><span class="pre">S</span></code> is <code class="docutils literal notranslate"><span class="pre">1</span></code> because <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code> are packed
in a single slot. This means the slot for
<code class="docutils literal notranslate"><span class="pre">data[4][9].c</span></code> is <code class="docutils literal notranslate"><span class="pre">keccak256(uint256(9)</span> <span class="pre">.</span> <span class="pre">keccak256(uint256(4)</span> <span class="pre">.</span> <span class="pre">uint256(1)))</span> <span class="pre">+</span> <span class="pre">1</span></code>.
The type of the value is <code class="docutils literal notranslate"><span class="pre">uint256</span></code>, so it uses a single slot.</p>
<section id="bytes-and-string">
<span id="id1"></span><h4><code class="docutils literal notranslate"><span class="pre">bytes</span></code> and <code class="docutils literal notranslate"><span class="pre">string</span></code><a class="headerlink" href="#bytes-and-string" title="Permalink to this heading">ÔÉÅ</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">bytes</span></code> and <code class="docutils literal notranslate"><span class="pre">string</span></code> are encoded identically.
In general, the encoding is similar to <code class="docutils literal notranslate"><span class="pre">bytes1[]</span></code>, in the sense that there is a slot for the array itself and
a data area that is computed using a <code class="docutils literal notranslate"><span class="pre">keccak256</span></code> hash of that slot‚Äôs position.
However, for short values (shorter than 32 bytes) the array elements are stored together with the length in the same slot.</p>
<p>In particular: if the data is at most <code class="docutils literal notranslate"><span class="pre">31</span></code> bytes long, the elements are stored
in the higher-order bytes (left aligned) and the lowest-order byte stores the value <code class="docutils literal notranslate"><span class="pre">length</span> <span class="pre">*</span> <span class="pre">2</span></code>.
For byte arrays that store data which is <code class="docutils literal notranslate"><span class="pre">32</span></code> or more bytes long, the main slot <code class="docutils literal notranslate"><span class="pre">p</span></code> stores <code class="docutils literal notranslate"><span class="pre">length</span> <span class="pre">*</span> <span class="pre">2</span> <span class="pre">+</span> <span class="pre">1</span></code> and the data is
stored as usual in <code class="docutils literal notranslate"><span class="pre">keccak256(p)</span></code>. This means that you can distinguish a short array from a long array
by checking if the lowest bit is set: short (not set) and long (set).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Handling invalidly encoded slots is currently not supported but may be added in the future.
If you are compiling via IR, reading an invalidly encoded slot results in a <code class="docutils literal notranslate"><span class="pre">Panic(0x22)</span></code> error.</p>
</div>
</section>
</section>
<section id="json-output">
<h3>JSON Output<a class="headerlink" href="#json-output" title="Permalink to this heading">ÔÉÅ</a></h3>
<p id="storage-layout-top-level">The storage layout of a contract can be requested via
the <a class="reference internal" href="index.html#compiler-api"><span class="std std-ref">standard JSON interface</span></a>.  The output is a JSON object containing two keys,
<code class="docutils literal notranslate"><span class="pre">storage</span></code> and <code class="docutils literal notranslate"><span class="pre">types</span></code>.  The <code class="docutils literal notranslate"><span class="pre">storage</span></code> object is an array where each
element has the following form:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=ewogICAgImFzdElkIjogMiwKICAgICJjb250cmFjdCI6ICJmaWxlQTpBIiwKICAgICJsYWJlbCI6ICJ4IiwKICAgICJvZmZzZXQiOiAwLAogICAgInNsb3QiOiAiMCIsCiAgICAidHlwZSI6ICJ0X3VpbnQyNTYiCn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s">&quot;astId&quot;</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s">&quot;contract&quot;</span><span class="o">:</span> <span class="s">&quot;fileA:A&quot;</span><span class="p">,</span>
    <span class="s">&quot;label&quot;</span><span class="o">:</span> <span class="s">&quot;x&quot;</span><span class="p">,</span>
    <span class="s">&quot;offset&quot;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s">&quot;slot&quot;</span><span class="o">:</span> <span class="s">&quot;0&quot;</span><span class="p">,</span>
    <span class="s">&quot;type&quot;</span><span class="o">:</span> <span class="s">&quot;t_uint256&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The example above is the storage layout of <code class="docutils literal notranslate"><span class="pre">contract</span> <span class="pre">A</span> <span class="pre">{</span> <span class="pre">uint</span> <span class="pre">x;</span> <span class="pre">}</span></code> from source unit <code class="docutils literal notranslate"><span class="pre">fileA</span></code>
and</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">astId</span></code> is the id of the AST node of the state variable‚Äôs declaration</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">contract</span></code> is the name of the contract including its path as prefix</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">label</span></code> is the name of the state variable</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">offset</span></code> is the offset in bytes within the storage slot according to the encoding</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">slot</span></code> is the storage slot where the state variable resides or starts. This
number may be very large and therefore its JSON value is represented as a
string.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">type</span></code> is an identifier used as key to the variable‚Äôs type information (described in the following)</p></li>
</ul>
<p>The given <code class="docutils literal notranslate"><span class="pre">type</span></code>, in this case <code class="docutils literal notranslate"><span class="pre">t_uint256</span></code> represents an element in
<code class="docutils literal notranslate"><span class="pre">types</span></code>, which has the form:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=ewogICAgImVuY29kaW5nIjogImlucGxhY2UiLAogICAgImxhYmVsIjogInVpbnQyNTYiLAogICAgIm51bWJlck9mQnl0ZXMiOiAiMzIiLAp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s">&quot;encoding&quot;</span><span class="o">:</span> <span class="s">&quot;inplace&quot;</span><span class="p">,</span>
    <span class="s">&quot;label&quot;</span><span class="o">:</span> <span class="s">&quot;uint256&quot;</span><span class="p">,</span>
    <span class="s">&quot;numberOfBytes&quot;</span><span class="o">:</span> <span class="s">&quot;32&quot;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">encoding</span></code> how the data is encoded in storage, where the possible values are:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">inplace</span></code>: data is laid out contiguously in storage (see <a class="reference internal" href="#storage-inplace-encoding"><span class="std std-ref">above</span></a>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mapping</span></code>: Keccak-256 hash-based method (see <a class="reference internal" href="#storage-hashed-encoding"><span class="std std-ref">above</span></a>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dynamic_array</span></code>: Keccak-256 hash-based method (see <a class="reference internal" href="#storage-hashed-encoding"><span class="std std-ref">above</span></a>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bytes</span></code>: single slot or Keccak-256 hash-based depending on the data size (see <a class="reference internal" href="#bytes-and-string"><span class="std std-ref">above</span></a>).</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">label</span></code> is the canonical type name.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">numberOfBytes</span></code> is the number of used bytes (as a decimal string).
Note that if <code class="docutils literal notranslate"><span class="pre">numberOfBytes</span> <span class="pre">&gt;</span> <span class="pre">32</span></code> this means that more than one slot is used.</p></li>
</ul>
<p>Some types have extra information besides the four above. Mappings contain
its <code class="docutils literal notranslate"><span class="pre">key</span></code> and <code class="docutils literal notranslate"><span class="pre">value</span></code> types (again referencing an entry in this mapping
of types), arrays have its <code class="docutils literal notranslate"><span class="pre">base</span></code> type, and structs list their <code class="docutils literal notranslate"><span class="pre">members</span></code> in
the same format as the top-level <code class="docutils literal notranslate"><span class="pre">storage</span></code> (see <a class="reference internal" href="#storage-layout-top-level"><span class="std std-ref">above</span></a>).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The JSON output format of a contract‚Äôs storage layout is still considered experimental
and is subject to change in non-breaking releases of Solidity.</p>
</div>
<p>The following example shows a contract and its storage layout, containing
value and reference types, types that are encoded packed, and nested types.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC40LjAgPDAuOS4wOwpjb250cmFjdCBBIHsKICAgIHN0cnVjdCBTIHsKICAgICAgICB1aW50MTI4IGE7CiAgICAgICAgdWludDEyOCBiOwogICAgICAgIHVpbnRbMl0gc3RhdGljQXJyYXk7CiAgICAgICAgdWludFtdIGR5bkFycmF5OwogICAgfQoKICAgIHVpbnQgeDsKICAgIHVpbnQgeTsKICAgIFMgczsKICAgIGFkZHJlc3MgYWRkcjsKICAgIG1hcHBpbmcgKHVpbnQgPT4gbWFwcGluZyAoYWRkcmVzcyA9PiBib29sKSkgbWFwOwogICAgdWludFtdIGFycmF5OwogICAgc3RyaW5nIHMxOwogICAgYnl0ZXMgYjE7Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.4.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>
<span class="k">contract</span><span class="w"> </span><span class="ni">A</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">struct</span><span class="w"> </span><span class="nv">S</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint128</span><span class="w"> </span><span class="nv">a</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint128</span><span class="w"> </span><span class="nv">b</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="p">[</span><span class="m m-Decimal">2</span><span class="p">]</span><span class="w"> </span>staticArray<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="p">[]</span><span class="w"> </span>dynArray<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="nv">x</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="nv">y</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span>S<span class="w"> </span>s<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">addr</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">mapping</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">mapping</span><span class="w"> </span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">bool</span><span class="p">))</span><span class="w"> </span>map<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="p">[]</span><span class="w"> </span>array<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">string</span><span class="w"> </span><span class="nv">s1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">bytes</span><span class="w"> </span><span class="nv">b1</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;storage&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;astId&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;contract&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;fileA:A&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;label&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;offset&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;slot&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;t_uint256&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;astId&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">17</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;contract&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;fileA:A&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;label&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;y&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;offset&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;slot&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;t_uint256&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;astId&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;contract&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;fileA:A&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;label&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;s&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;offset&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;slot&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;t_struct(S)13_storage&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;astId&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">22</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;contract&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;fileA:A&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;label&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;addr&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;offset&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;slot&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;6&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;t_address&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;astId&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">28</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;contract&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;fileA:A&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;label&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;map&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;offset&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;slot&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;7&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;t_mapping(t_uint256,t_mapping(t_address,t_bool))&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;astId&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">31</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;contract&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;fileA:A&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;label&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;array&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;offset&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;slot&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;8&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;t_array(t_uint256)dyn_storage&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;astId&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;contract&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;fileA:A&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;label&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;s1&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;offset&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;slot&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;9&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;t_string_storage&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;astId&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">35</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;contract&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;fileA:A&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;label&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;b1&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;offset&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;slot&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;10&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;t_bytes_storage&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">],</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;types&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;t_address&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;encoding&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;inplace&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;label&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;address&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;numberOfBytes&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;20&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;t_array(t_uint256)2_storage&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;base&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;t_uint256&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;encoding&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;inplace&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;label&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uint256[2]&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;numberOfBytes&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;64&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;t_array(t_uint256)dyn_storage&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;base&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;t_uint256&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;encoding&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;dynamic_array&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;label&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uint256[]&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;numberOfBytes&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;32&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;t_bool&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;encoding&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;inplace&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;label&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;bool&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;numberOfBytes&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;t_bytes_storage&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;encoding&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;bytes&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;label&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;bytes&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;numberOfBytes&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;32&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;t_mapping(t_address,t_bool)&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;encoding&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;mapping&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;t_address&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;label&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;mapping(address =&gt; bool)&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;numberOfBytes&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;32&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;t_bool&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;t_mapping(t_uint256,t_mapping(t_address,t_bool))&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;encoding&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;mapping&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;key&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;t_uint256&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;label&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;mapping(uint256 =&gt; mapping(address =&gt; bool))&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;numberOfBytes&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;32&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;t_mapping(t_address,t_bool)&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;t_string_storage&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;encoding&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;bytes&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;label&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;numberOfBytes&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;32&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;t_struct(S)13_storage&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;encoding&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;inplace&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;label&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;struct A.S&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;members&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="nt">&quot;astId&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="nt">&quot;contract&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;fileA:A&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="nt">&quot;label&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;a&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="nt">&quot;offset&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="nt">&quot;slot&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;t_uint128&quot;</span><span class="w"></span>
<span class="w">        </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="nt">&quot;astId&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="nt">&quot;contract&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;fileA:A&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="nt">&quot;label&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;b&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="nt">&quot;offset&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="nt">&quot;slot&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;t_uint128&quot;</span><span class="w"></span>
<span class="w">        </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="nt">&quot;astId&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="nt">&quot;contract&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;fileA:A&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="nt">&quot;label&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;staticArray&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="nt">&quot;offset&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="nt">&quot;slot&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;t_array(t_uint256)2_storage&quot;</span><span class="w"></span>
<span class="w">        </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="nt">&quot;astId&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="nt">&quot;contract&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;fileA:A&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="nt">&quot;label&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;dynArray&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="nt">&quot;offset&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="nt">&quot;slot&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;3&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;t_array(t_uint256)dyn_storage&quot;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="p">],</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;numberOfBytes&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;128&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;t_uint128&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;encoding&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;inplace&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;label&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uint128&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;numberOfBytes&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;16&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;t_uint256&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;encoding&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;inplace&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;label&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uint256&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;numberOfBytes&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;32&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
<span id="document-internals/layout_in_memory"></span><section id="layout-in-memory">
<h2>Layout in Memory<a class="headerlink" href="#layout-in-memory" title="Permalink to this heading">ÔÉÅ</a></h2>
<p>Solidity reserves four 32-byte slots, with specific byte ranges (inclusive of endpoints) being used as follows:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0x00</span></code> - <code class="docutils literal notranslate"><span class="pre">0x3f</span></code> (64 bytes): scratch space for hashing methods</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x40</span></code> - <code class="docutils literal notranslate"><span class="pre">0x5f</span></code> (32 bytes): currently allocated memory size (aka. free memory pointer)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x60</span></code> - <code class="docutils literal notranslate"><span class="pre">0x7f</span></code> (32 bytes): zero slot</p></li>
</ul>
<p>Scratch space can be used between statements (i.e. within inline assembly). The zero slot
is used as initial value for dynamic memory arrays and should never be written to
(the free memory pointer points to <code class="docutils literal notranslate"><span class="pre">0x80</span></code> initially).</p>
<p>Solidity always places new objects at the free memory pointer and
memory is never freed (this might change in the future).</p>
<p>Elements in memory arrays in Solidity always occupy multiples of 32 bytes (this
is even true for <code class="docutils literal notranslate"><span class="pre">bytes1[]</span></code>, but not for <code class="docutils literal notranslate"><span class="pre">bytes</span></code> and <code class="docutils literal notranslate"><span class="pre">string</span></code>).
Multi-dimensional memory arrays are pointers to memory arrays. The length of a
dynamic array is stored at the first slot of the array and followed by the array
elements.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>There are some operations in Solidity that need a temporary memory area
larger than 64 bytes and therefore will not fit into the scratch space.
They will be placed where the free memory points to, but given their
short lifetime, the pointer is not updated. The memory may or may not
be zeroed out. Because of this, one should not expect the free memory
to point to zeroed out memory.</p>
<p>While it may seem like a good idea to use <code class="docutils literal notranslate"><span class="pre">msize</span></code> to arrive at a
definitely zeroed out memory area, using such a pointer non-temporarily
without updating the free memory pointer can have unexpected results.</p>
</div>
<section id="differences-to-layout-in-storage">
<h3>Differences to Layout in Storage<a class="headerlink" href="#differences-to-layout-in-storage" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>As described above the layout in memory is different from the layout in
<a class="reference internal" href="index.html#storage-inplace-encoding"><span class="std std-ref">storage</span></a>. Below there are some examples.</p>
<section id="example-for-difference-in-arrays">
<h4>Example for Difference in Arrays<a class="headerlink" href="#example-for-difference-in-arrays" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>The following array occupies 32 bytes (1 slot) in storage, but 128
bytes (4 items with 32 bytes each) in memory.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=dWludDhbNF0gYTs="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">uint8</span><span class="p">[</span><span class="m m-Decimal">4</span><span class="p">]</span><span class="w"> </span>a<span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="example-for-difference-in-struct-layout">
<h4>Example for Difference in Struct Layout<a class="headerlink" href="#example-for-difference-in-struct-layout" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>The following struct occupies 96 bytes (3 slots of 32 bytes) in storage,
but 128 bytes (4 items with 32 bytes each) in memory.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=c3RydWN0IFMgewogICAgdWludCBhOwogICAgdWludCBiOwogICAgdWludDggYzsKICAgIHVpbnQ4IGQ7Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">struct</span><span class="w"> </span><span class="nv">S</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="nv">a</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="nv">b</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint8</span><span class="w"> </span><span class="nv">c</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint8</span><span class="w"> </span><span class="nv">d</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
</section>
<span id="document-internals/layout_in_calldata"></span><section id="layout-of-call-data">
<h2>Layout of Call Data<a class="headerlink" href="#layout-of-call-data" title="Permalink to this heading">ÔÉÅ</a></h2>
<p>The input data for a function call is assumed to be in the format defined by the <a class="reference internal" href="index.html#abi"><span class="std std-ref">ABI
specification</span></a>. Among others, the ABI specification requires arguments to be padded to multiples of 32
bytes. The internal function calls use a different convention.</p>
<p>Arguments for the constructor of a contract are directly appended at the end of the
contract‚Äôs code, also in ABI encoding. The constructor will access them through a hard-coded offset, and
not by using the <code class="docutils literal notranslate"><span class="pre">codesize</span></code> opcode, since this of course changes when appending
data to the code.</p>
</section>
<span id="document-internals/variable_cleanup"></span><section id="cleaning-up-variables">
<h2>Cleaning Up Variables<a class="headerlink" href="#cleaning-up-variables" title="Permalink to this heading">ÔÉÅ</a></h2>
<p>When a value is shorter than 256 bit, in some cases the remaining bits
must be cleaned.
The Solidity compiler is designed to clean such remaining bits before any operations
that might be adversely affected by the potential garbage in the remaining bits.
For example, before writing a value to  memory, the remaining bits need
to be cleared because the memory contents can be used for computing
hashes or sent as the data of a message call.  Similarly, before
storing a value in the storage, the remaining bits need to be cleaned
because otherwise the garbled value can be observed.</p>
<p>Note that access via inline assembly is not considered such an operation:
If you use inline assembly to access Solidity variables
shorter than 256 bits, the compiler does not guarantee that
the value is properly cleaned up.</p>
<p>Moreover, we do not clean the bits if the immediately
following operation is not affected.  For instance, since any non-zero
value is considered <code class="docutils literal notranslate"><span class="pre">true</span></code> by <code class="docutils literal notranslate"><span class="pre">JUMPI</span></code> instruction, we do not clean
the boolean values before they are used as the condition for
<code class="docutils literal notranslate"><span class="pre">JUMPI</span></code>.</p>
<p>In addition to the design principle above, the Solidity compiler
cleans input data when it is loaded onto the stack.</p>
<p>Different types have different rules for cleaning up invalid values:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 31%" />
<col style="width: 31%" />
<col style="width: 39%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Valid Values</p></th>
<th class="head"><p>Invalid Values Mean</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>enum of n
members</p></td>
<td><p>0 until n - 1</p></td>
<td><p>exception</p></td>
</tr>
<tr class="row-odd"><td><p>bool</p></td>
<td><p>0 or 1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>signed integers</p></td>
<td><p>sign-extended
word</p></td>
<td><p>currently silently
wraps; in the
future exceptions
will be thrown</p></td>
</tr>
<tr class="row-odd"><td><p>unsigned
integers</p></td>
<td><p>higher bits
zeroed</p></td>
<td><p>currently silently
wraps; in the
future exceptions
will be thrown</p></td>
</tr>
</tbody>
</table>
</section>
<span id="document-internals/source_mappings"></span><section id="source-mappings">
<span id="index-0"></span><h2>Source Mappings<a class="headerlink" href="#source-mappings" title="Permalink to this heading">ÔÉÅ</a></h2>
<p>As part of the AST output, the compiler provides the range of the source
code that is represented by the respective node in the AST. This can be
used for various purposes ranging from static analysis tools that report
errors based on the AST and debugging tools that highlight local variables
and their uses.</p>
<p>Furthermore, the compiler can also generate a mapping from the bytecode
to the range in the source code that generated the instruction. This is again
important for static analysis tools that operate on bytecode level and
for displaying the current position in the source code inside a debugger
or for breakpoint handling. This mapping also contains other information,
like the jump type and the modifier depth (see below).</p>
<p>Both kinds of source mappings use integer identifiers to refer to source files.
The identifier of a source file is stored in
<code class="docutils literal notranslate"><span class="pre">output['sources'][sourceName]['id']</span></code> where <code class="docutils literal notranslate"><span class="pre">output</span></code> is the output of the
standard-json compiler interface parsed as JSON.
For some utility routines, the compiler generates ‚Äúinternal‚Äù source files
that are not part of the original input but are referenced from the source
mappings. These source files together with their identifiers can be
obtained via <code class="docutils literal notranslate"><span class="pre">output['contracts'][sourceName][contractName]['evm']['bytecode']['generatedSources']</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In the case of instructions that are not associated with any particular source file,
the source mapping assigns an integer identifier of <code class="docutils literal notranslate"><span class="pre">-1</span></code>. This may happen for
bytecode sections stemming from compiler-generated inline assembly statements.</p>
</div>
<p>The source mappings inside the AST use the following
notation:</p>
<p><code class="docutils literal notranslate"><span class="pre">s:l:f</span></code></p>
<p>Where <code class="docutils literal notranslate"><span class="pre">s</span></code> is the byte-offset to the start of the range in the source file,
<code class="docutils literal notranslate"><span class="pre">l</span></code> is the length of the source range in bytes and <code class="docutils literal notranslate"><span class="pre">f</span></code> is the source
index mentioned above.</p>
<p>The encoding in the source mapping for the bytecode is more complicated:
It is a list of <code class="docutils literal notranslate"><span class="pre">s:l:f:j:m</span></code> separated by <code class="docutils literal notranslate"><span class="pre">;</span></code>. Each of these
elements corresponds to an instruction, i.e. you cannot use the byte offset
but have to use the instruction offset (push instructions are longer than a single byte).
The fields <code class="docutils literal notranslate"><span class="pre">s</span></code>, <code class="docutils literal notranslate"><span class="pre">l</span></code> and <code class="docutils literal notranslate"><span class="pre">f</span></code> are as above. <code class="docutils literal notranslate"><span class="pre">j</span></code> can be either
<code class="docutils literal notranslate"><span class="pre">i</span></code>, <code class="docutils literal notranslate"><span class="pre">o</span></code> or <code class="docutils literal notranslate"><span class="pre">-</span></code> signifying whether a jump instruction goes into a
function, returns from a function or is a regular jump as part of e.g. a loop.
The last field, <code class="docutils literal notranslate"><span class="pre">m</span></code>, is an integer that denotes the ‚Äúmodifier depth‚Äù. This depth
is increased whenever the placeholder statement (<code class="docutils literal notranslate"><span class="pre">_</span></code>) is entered in a modifier
and decreased when it is left again. This allows debuggers to track tricky cases
like the same modifier being used twice or multiple placeholder statements being
used in a single modifier.</p>
<p>In order to compress these source mappings especially for bytecode, the
following rules are used:</p>
<ul class="simple">
<li><p>If a field is empty, the value of the preceding element is used.</p></li>
<li><p>If a <code class="docutils literal notranslate"><span class="pre">:</span></code> is missing, all following fields are considered empty.</p></li>
</ul>
<p>This means the following source mappings represent the same information:</p>
<p><code class="docutils literal notranslate"><span class="pre">1:2:1;1:9:1;2:1:2;2:1:2;2:1:2</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">1:2:1;:9;2:1:2;;</span></code></p>
<p>Important to note is that when the <a class="reference internal" href="index.html#yul-verbatim"><span class="std std-ref">verbatim</span></a> builtin is used,
the source mappings will be invalid: The builtin is considered a single
instruction instead of potentially multiple.</p>
</section>
<span id="document-internals/optimizer"></span><section id="the-optimizer">
<span id="optimizer"></span><span id="index-0"></span><h2>The Optimizer<a class="headerlink" href="#the-optimizer" title="Permalink to this heading">ÔÉÅ</a></h2>
<p>The Solidity compiler uses two different optimizer modules: The ‚Äúold‚Äù optimizer
that operates at the opcode level and the ‚Äúnew‚Äù optimizer that operates on Yul IR code.</p>
<p>The opcode-based optimizer applies a set of <a class="reference external" href="https://github.com/ethereum/solidity/blob/develop/libevmasm/RuleList.h">simplification rules</a>
to opcodes. It also combines equal code sets and removes unused code.</p>
<p>The Yul-based optimizer is much more powerful, because it can work across function
calls. For example, arbitrary jumps are not possible in Yul, so it is
possible to compute the side-effects of each function. Consider two function calls,
where the first does not modify storage and the second does modify storage.
If their arguments and return values do not depend on each other, we can reorder
the function calls. Similarly, if a function is
side-effect free and its result is multiplied by zero, you can remove the function
call completely.</p>
<p>Currently, the parameter <code class="docutils literal notranslate"><span class="pre">--optimize</span></code> activates the opcode-based optimizer for the
generated bytecode and the Yul optimizer for the Yul code generated internally, for example for ABI coder v2.
One can use <code class="docutils literal notranslate"><span class="pre">solc</span> <span class="pre">--ir-optimized</span> <span class="pre">--optimize</span></code> to produce an
optimized Yul IR for a Solidity source. Similarly, one can use <code class="docutils literal notranslate"><span class="pre">solc</span> <span class="pre">--strict-assembly</span> <span class="pre">--optimize</span></code>
for a stand-alone Yul mode.</p>
<p>You can find more details on both optimizer modules and their optimization steps below.</p>
<section id="benefits-of-optimizing-solidity-code">
<h3>Benefits of Optimizing Solidity Code<a class="headerlink" href="#benefits-of-optimizing-solidity-code" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Overall, the optimizer tries to simplify complicated expressions, which reduces both code
size and execution cost, i.e., it can reduce gas needed for contract deployment as well as for external calls made to the contract.
It also specializes or inlines functions. Especially
function inlining is an operation that can cause much bigger code, but it is
often done because it results in opportunities for more simplifications.</p>
</section>
<section id="differences-between-optimized-and-non-optimized-code">
<h3>Differences between Optimized and Non-Optimized Code<a class="headerlink" href="#differences-between-optimized-and-non-optimized-code" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Generally, the most visible difference is that constant expressions are evaluated at compile time.
When it comes to the ASM output, one can also notice a reduction of equivalent or duplicate
code blocks (compare the output of the flags <code class="docutils literal notranslate"><span class="pre">--asm</span></code> and <code class="docutils literal notranslate"><span class="pre">--asm</span> <span class="pre">--optimize</span></code>). However,
when it comes to the Yul/intermediate-representation, there can be significant
differences, for example, functions may be inlined, combined, or rewritten to eliminate
redundancies, etc. (compare the output between the flags <code class="docutils literal notranslate"><span class="pre">--ir</span></code> and
<code class="docutils literal notranslate"><span class="pre">--optimize</span> <span class="pre">--ir-optimized</span></code>).</p>
</section>
<section id="optimizer-parameter-runs">
<span id="id1"></span><h3>Optimizer Parameter Runs<a class="headerlink" href="#optimizer-parameter-runs" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>The number of runs (<code class="docutils literal notranslate"><span class="pre">--optimize-runs</span></code>) specifies roughly how often each opcode of the
deployed code will be executed across the life-time of the contract. This means it is a
trade-off parameter between code size (deploy cost) and code execution cost (cost after deployment).
A ‚Äúruns‚Äù parameter of ‚Äú1‚Äù will produce short but expensive code. In contrast, a larger ‚Äúruns‚Äù
parameter will produce longer but more gas efficient code. The maximum value of the parameter
is <code class="docutils literal notranslate"><span class="pre">2**32-1</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A common misconception is that this parameter specifies the number of iterations of the optimizer.
This is not true: The optimizer will always run as many times as it can still improve the code.</p>
</div>
</section>
<section id="opcode-based-optimizer-module">
<h3>Opcode-Based Optimizer Module<a class="headerlink" href="#opcode-based-optimizer-module" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>The opcode-based optimizer module operates on assembly code. It splits the
sequence of instructions into basic blocks at <code class="docutils literal notranslate"><span class="pre">JUMPs</span></code> and <code class="docutils literal notranslate"><span class="pre">JUMPDESTs</span></code>.
Inside these blocks, the optimizer analyzes the instructions and records every modification to the stack,
memory, or storage as an expression which consists of an instruction and
a list of arguments which are pointers to other expressions.</p>
<p>Additionally, the opcode-based optimizer
uses a component called ‚ÄúCommonSubexpressionEliminator‚Äù that, amongst other
tasks, finds expressions that are always equal (on every input) and combines
them into an expression class. It first tries to find each new
expression in a list of already known expressions. If no such matches are found,
it simplifies the expression according to rules like
<code class="docutils literal notranslate"><span class="pre">constant</span> <span class="pre">+</span> <span class="pre">constant</span> <span class="pre">=</span> <span class="pre">sum_of_constants</span></code> or <code class="docutils literal notranslate"><span class="pre">X</span> <span class="pre">*</span> <span class="pre">1</span> <span class="pre">=</span> <span class="pre">X</span></code>. Since this is
a recursive process, we can also apply the latter rule if the second factor
is a more complex expression which we know always evaluates to one.</p>
<p>Certain optimizer steps symbolically track the storage and memory locations. For example, this
information is used to compute Keccak-256 hashes that can be evaluated during compile time. Consider
the sequence:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>PUSH 32
PUSH 0
CALLDATALOAD
PUSH 100
DUP2
MSTORE
KECCAK256
</pre></div>
</div>
<p>or the equivalent Yul</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=yul&amp;version=0.8.15&amp;code=bGV0IHggOj0gY2FsbGRhdGFsb2FkKDApCm1zdG9yZSh4LCAxMDApCmxldCB2YWx1ZSA6PSBrZWNjYWsyNTYoeCwgMzIp"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-yul notranslate"><div class="highlight"><pre><span></span><span class="ow">let</span> <span class="nv">x</span> <span class="o">:=</span> <span class="nf">calldataload</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="nf">mstore</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="ow">let</span> <span class="nv">value</span> <span class="o">:=</span> <span class="nf">keccak256</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>
</pre></div>
</div>
<p>In this case, the optimizer tracks the value at a memory location <code class="docutils literal notranslate"><span class="pre">calldataload(0)</span></code> and then
realizes that the Keccak-256 hash can be evaluated at compile time. This only works if there is no
other instruction that modifies memory between the <code class="docutils literal notranslate"><span class="pre">mstore</span></code> and <code class="docutils literal notranslate"><span class="pre">keccak256</span></code>. So if there is an
instruction that writes to memory (or storage), then we need to erase the knowledge of the current
memory (or storage). There is, however, an exception to this erasing, when we can easily see that
the instruction doesn‚Äôt write to a certain location.</p>
<p>For example,</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=yul&amp;version=0.8.15&amp;code=bGV0IHggOj0gY2FsbGRhdGFsb2FkKDApCm1zdG9yZSh4LCAxMDApCi8vIEN1cnJlbnQga25vd2xlZGdlIG1lbW9yeSBsb2NhdGlvbiB4IC0+IDEwMApsZXQgeSA6PSBhZGQoeCwgMzIpCi8vIERvZXMgbm90IGNsZWFyIHRoZSBrbm93bGVkZ2UgdGhhdCB4IC0+IDEwMCwgc2luY2UgeSBkb2VzIG5vdCB3cml0ZSB0byBbeCwgeCArIDMyKQptc3RvcmUoeSwgMjAwKQovLyBUaGlzIEtlY2Nhay0yNTYgY2FuIG5vdyBiZSBldmFsdWF0ZWQKbGV0IHZhbHVlIDo9IGtlY2NhazI1Nih4LCAzMik="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-yul notranslate"><div class="highlight"><pre><span></span><span class="ow">let</span> <span class="nv">x</span> <span class="o">:=</span> <span class="nf">calldataload</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="nf">mstore</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="c1">// Current knowledge memory location x -&gt; 100</span>
<span class="ow">let</span> <span class="nv">y</span> <span class="o">:=</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>
<span class="c1">// Does not clear the knowledge that x -&gt; 100, since y does not write to [x, x + 32)</span>
<span class="nf">mstore</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="c1">// This Keccak-256 can now be evaluated</span>
<span class="ow">let</span> <span class="nv">value</span> <span class="o">:=</span> <span class="nf">keccak256</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>
</pre></div>
</div>
<p>Therefore, modifications to storage and memory locations, of say location <code class="docutils literal notranslate"><span class="pre">l</span></code>, must erase
knowledge about storage or memory locations which may be equal to <code class="docutils literal notranslate"><span class="pre">l</span></code>. More specifically, for
storage, the optimizer has to erase all knowledge of symbolic locations, that may be equal to <code class="docutils literal notranslate"><span class="pre">l</span></code>
and for memory, the optimizer has to erase all knowledge of symbolic locations that may not be at
least 32 bytes away. If <code class="docutils literal notranslate"><span class="pre">m</span></code> denotes an arbitrary location, then this decision on erasure is done
by computing the value <code class="docutils literal notranslate"><span class="pre">sub(l,</span> <span class="pre">m)</span></code>. For storage, if this value evaluates to a literal that is
non-zero, then the knowledge about <code class="docutils literal notranslate"><span class="pre">m</span></code> will be kept. For memory, if the value evaluates to a
literal that is between <code class="docutils literal notranslate"><span class="pre">32</span></code> and <code class="docutils literal notranslate"><span class="pre">2**256</span> <span class="pre">-</span> <span class="pre">32</span></code>, then the knowledge about <code class="docutils literal notranslate"><span class="pre">m</span></code> will be kept. In
all other cases, the knowledge about <code class="docutils literal notranslate"><span class="pre">m</span></code> will be erased.</p>
<p>After this process, we know which expressions have to be on the stack at
the end, and have a list of modifications to memory and storage. This information
is stored together with the basic blocks and is used to link them. Furthermore,
knowledge about the stack, storage and memory configuration is forwarded to
the next block(s).</p>
<p>If we know the targets of all <code class="docutils literal notranslate"><span class="pre">JUMP</span></code> and <code class="docutils literal notranslate"><span class="pre">JUMPI</span></code> instructions,
we can build a complete control flow graph of the program. If there is only
one target we do not know (this can happen as in principle, jump targets can
be computed from inputs), we have to erase all knowledge about the input state
of a block as it can be the target of the unknown <code class="docutils literal notranslate"><span class="pre">JUMP</span></code>. If the opcode-based
optimizer module finds a <code class="docutils literal notranslate"><span class="pre">JUMPI</span></code> whose condition evaluates to a constant, it transforms it
to an unconditional jump.</p>
<p>As the last step, the code in each block is re-generated. The optimizer creates
a dependency graph from the expressions on the stack at the end of the block,
and it drops every operation that is not part of this graph. It generates code
that applies the modifications to memory and storage in the order they were
made in the original code (dropping modifications which were found not to be
needed). Finally, it generates all values that are required to be on the
stack in the correct place.</p>
<p>These steps are applied to each basic block and the newly generated code
is used as replacement if it is smaller. If a basic block is split at a
<code class="docutils literal notranslate"><span class="pre">JUMPI</span></code> and during the analysis, the condition evaluates to a constant,
the <code class="docutils literal notranslate"><span class="pre">JUMPI</span></code> is replaced based on the value of the constant. Thus code like</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=dWludCB4ID0gNzsKZGF0YVs3XSA9IDk7CmlmIChkYXRhW3hdICE9IHggKyAyKSAvLyB0aGlzIGNvbmRpdGlvbiBpcyBuZXZlciB0cnVlCiAgcmV0dXJuIDI7CmVsc2UKICByZXR1cm4gMTs="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">uint</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">7</span><span class="p">;</span><span class="w"></span>
data<span class="p">[</span><span class="m m-Decimal">7</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">9</span><span class="p">;</span><span class="w"></span>
<span class="kt">if</span><span class="w"> </span><span class="p">(</span>data<span class="p">[</span>x<span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span>x<span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m m-Decimal">2</span><span class="p">)</span><span class="w"> </span><span class="c1">// this condition is never true</span>
<span class="w">  </span><span class="kt">return</span><span class="w"> </span><span class="m m-Decimal">2</span><span class="p">;</span><span class="w"></span>
<span class="kt">else</span><span class="w"></span>
<span class="w">  </span><span class="kt">return</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>simplifies to this:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=ZGF0YVs3XSA9IDk7CnJldHVybiAxOw=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span>data<span class="p">[</span><span class="m m-Decimal">7</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">9</span><span class="p">;</span><span class="w"></span>
<span class="kt">return</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<section id="simple-inlining">
<h4>Simple Inlining<a class="headerlink" href="#simple-inlining" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Since Solidity version 0.8.2, there is another optimizer step that replaces certain
jumps to blocks containing ‚Äúsimple‚Äù instructions ending with a ‚Äújump‚Äù by a copy of these instructions.
This corresponds to inlining of simple, small Solidity or Yul functions. In particular, the sequence
<code class="docutils literal notranslate"><span class="pre">PUSHTAG(tag)</span> <span class="pre">JUMP</span></code> may be replaced, whenever the <code class="docutils literal notranslate"><span class="pre">JUMP</span></code> is marked as jump ‚Äúinto‚Äù a
function and behind <code class="docutils literal notranslate"><span class="pre">tag</span></code> there is a basic block (as described above for the
‚ÄúCommonSubexpressionEliminator‚Äù) that ends in another <code class="docutils literal notranslate"><span class="pre">JUMP</span></code> which is marked as a jump
‚Äúout of‚Äù a function.</p>
<p>In particular, consider the following prototypical example of assembly generated for a
call to an internal Solidity function:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>  tag_return
  tag_f
  jump      // in
tag_return:
  ...opcodes after call to f...

tag_f:
  ...body of function f...
  jump      // out
</pre></div>
</div>
<p>As long as the body of the function is a continuous basic block, the ‚ÄúInliner‚Äù can replace <code class="docutils literal notranslate"><span class="pre">tag_f</span> <span class="pre">jump</span></code> by
the block at <code class="docutils literal notranslate"><span class="pre">tag_f</span></code> resulting in:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>  tag_return
  ...body of function f...
  jump
tag_return:
  ...opcodes after call to f...

tag_f:
  ...body of function f...
  jump      // out
</pre></div>
</div>
<p>Now ideally, the other optimizer steps described above will result in the return tag push being moved
towards the remaining jump resulting in:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>  ...body of function f...
  tag_return
  jump
tag_return:
  ...opcodes after call to f...

tag_f:
  ...body of function f...
  jump      // out
</pre></div>
</div>
<p>In this situation the ‚ÄúPeepholeOptimizer‚Äù will remove the return jump. Ideally, all of this can be done
for all references to <code class="docutils literal notranslate"><span class="pre">tag_f</span></code> leaving it unused, s.t. it can be removed, yielding:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>...body of function f...
...opcodes after call to f...
</pre></div>
</div>
<p>So the call to function <code class="docutils literal notranslate"><span class="pre">f</span></code> is inlined and the original definition of <code class="docutils literal notranslate"><span class="pre">f</span></code> can be removed.</p>
<p>Inlining like this is attempted, whenever a heuristics suggests that inlining is cheaper over the lifetime of a
contract than not inlining. This heuristics depends on the size of the function body, the
number of other references to its tag (approximating the number of calls to the function) and
the expected number of executions of the contract (the global optimizer parameter ‚Äúruns‚Äù).</p>
</section>
</section>
<section id="yul-based-optimizer-module">
<h3>Yul-Based Optimizer Module<a class="headerlink" href="#yul-based-optimizer-module" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>The Yul-based optimizer consists of several stages and components that all transform
the AST in a semantically equivalent way. The goal is to end up either with code
that is shorter or at least only marginally longer but will allow further
optimization steps.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Since the optimizer is under heavy development, the information here might be outdated.
If you rely on a certain functionality, please reach out to the team directly.</p>
</div>
<p>The optimizer currently follows a purely greedy strategy and does not do any
backtracking.</p>
<p>All components of the Yul-based optimizer module are explained below.
The following transformation steps are the main components:</p>
<ul class="simple">
<li><p>SSA Transform</p></li>
<li><p>Common Subexpression Eliminator</p></li>
<li><p>Expression Simplifier</p></li>
<li><p>Redundant Assign Eliminator</p></li>
<li><p>Full Inliner</p></li>
</ul>
<section id="optimizer-steps">
<h4>Optimizer Steps<a class="headerlink" href="#optimizer-steps" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>This is a list of all steps the Yul-based optimizer sorted alphabetically. You can find more information
on the individual steps and their sequence below.</p>
<ul class="simple">
<li><p><a class="reference internal" href="#block-flattener"><span class="std std-ref">BlockFlattener</span></a>.</p></li>
<li><p><a class="reference internal" href="#circular-reference-pruner"><span class="std std-ref">CircularReferencesPruner</span></a>.</p></li>
<li><p><a class="reference internal" href="#common-subexpression-eliminator"><span class="std std-ref">CommonSubexpressionEliminator</span></a>.</p></li>
<li><p><a class="reference internal" href="#conditional-simplifier"><span class="std std-ref">ConditionalSimplifier</span></a>.</p></li>
<li><p><a class="reference internal" href="#conditional-unsimplifier"><span class="std std-ref">ConditionalUnsimplifier</span></a>.</p></li>
<li><p><a class="reference internal" href="#control-flow-simplifier"><span class="std std-ref">ControlFlowSimplifier</span></a>.</p></li>
<li><p><a class="reference internal" href="#dead-code-eliminator"><span class="std std-ref">DeadCodeEliminator</span></a>.</p></li>
<li><p><a class="reference internal" href="#equal-store-eliminator"><span class="std std-ref">EqualStoreEliminator</span></a>.</p></li>
<li><p><a class="reference internal" href="#equivalent-function-combiner"><span class="std std-ref">EquivalentFunctionCombiner</span></a>.</p></li>
<li><p><a class="reference internal" href="#expression-joiner"><span class="std std-ref">ExpressionJoiner</span></a>.</p></li>
<li><p><a class="reference internal" href="#expression-simplifier"><span class="std std-ref">Expression Simplifier</span></a>.</p></li>
<li><p><a class="reference internal" href="#expression-splitter"><span class="std std-ref">ExpressionSplitter</span></a>.</p></li>
<li><p><a class="reference internal" href="#for-loop-condition-into-body"><span class="std std-ref">ForLoopConditionIntoBody</span></a>.</p></li>
<li><p><a class="reference internal" href="#for-loop-condition-out-of-body"><span class="std std-ref">ForLoopConditionOutOfBody</span></a>.</p></li>
<li><p><a class="reference internal" href="#for-loop-init-rewriter"><span class="std std-ref">ForLoopInitRewriter</span></a>.</p></li>
<li><p><a class="reference internal" href="#expression-inliner"><span class="std std-ref">ExpressionInliner</span></a>.</p></li>
<li><p><a class="reference internal" href="#full-inliner"><span class="std std-ref">FullInliner</span></a>.</p></li>
<li><p><a class="reference internal" href="#function-grouper"><span class="std std-ref">FunctionGrouper</span></a>.</p></li>
<li><p><a class="reference internal" href="#function-hoister"><span class="std std-ref">FunctionHoister</span></a>.</p></li>
<li><p><a class="reference internal" href="#function-specializer"><span class="std std-ref">FunctionSpecializer</span></a>.</p></li>
<li><p><a class="reference internal" href="#literal-rematerialiser"><span class="std std-ref">LiteralRematerialiser</span></a>.</p></li>
<li><p><a class="reference internal" href="#load-resolver"><span class="std std-ref">LoadResolver</span></a>.</p></li>
<li><p><a class="reference internal" href="#loop-invariant-code-motion"><span class="std std-ref">LoopInvariantCodeMotion</span></a>.</p></li>
<li><p><a class="reference internal" href="#redundant-assign-eliminator"><span class="std std-ref">RedundantAssignEliminator</span></a>.</p></li>
<li><p><a class="reference internal" href="#reasoning-based-simplifier"><span class="std std-ref">ReasoningBasedSimplifier</span></a>.</p></li>
<li><p><a class="reference internal" href="#rematerialiser"><span class="std std-ref">Rematerialiser</span></a>.</p></li>
<li><p><a class="reference internal" href="#ssa-reverser"><span class="std std-ref">SSAReverser</span></a>.</p></li>
<li><p><a class="reference internal" href="#ssa-transform"><span class="std std-ref">SSATransform</span></a>.</p></li>
<li><p><a class="reference internal" href="#structural-simplifier"><span class="std std-ref">StructuralSimplifier</span></a>.</p></li>
<li><p><a class="reference internal" href="#unused-function-parameter-pruner"><span class="std std-ref">UnusedFunctionParameterPruner</span></a>.</p></li>
<li><p><a class="reference internal" href="#unused-pruner"><span class="std std-ref">UnusedPruner</span></a>.</p></li>
<li><p><a class="reference internal" href="#var-decl-initializer"><span class="std std-ref">VarDeclInitializer</span></a>.</p></li>
</ul>
</section>
<section id="selecting-optimizations">
<h4>Selecting Optimizations<a class="headerlink" href="#selecting-optimizations" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>By default the optimizer applies its predefined sequence of optimization steps to
the generated assembly. You can override this sequence and supply your own using
the <code class="docutils literal notranslate"><span class="pre">--yul-optimizations</span></code> option:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>solc --optimize --ir-optimized --yul-optimizations <span class="s1">&#39;dhfoD[xarrscLMcCTU]uljmul&#39;</span>
</pre></div>
</div>
<p>The sequence inside <code class="docutils literal notranslate"><span class="pre">[...]</span></code> will be applied multiple times in a loop until the Yul code
remains unchanged or until the maximum number of rounds (currently 12) has been reached.</p>
<p>Available abbreviations are listed in the <a class="reference internal" href="index.html#optimization-step-sequence"><span class="std std-ref">Yul optimizer docs</span></a>.</p>
</section>
<section id="preprocessing">
<h4>Preprocessing<a class="headerlink" href="#preprocessing" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>The preprocessing components perform transformations to get the program
into a certain normal form that is easier to work with. This normal
form is kept during the rest of the optimization process.</p>
<section id="disambiguator">
<span id="id2"></span><h5>Disambiguator<a class="headerlink" href="#disambiguator" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>The disambiguator takes an AST and returns a fresh copy where all identifiers have
unique names in the input AST. This is a prerequisite for all other optimizer stages.
One of the benefits is that identifier lookup does not need to take scopes into account
which simplifies the analysis needed for other steps.</p>
<p>All subsequent stages have the property that all names stay unique. This means if
a new identifier needs to be introduced, a new unique name is generated.</p>
</section>
<section id="functionhoister">
<span id="function-hoister"></span><h5>FunctionHoister<a class="headerlink" href="#functionhoister" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>The function hoister moves all function definitions to the end of the topmost block. This is
a semantically equivalent transformation as long as it is performed after the
disambiguation stage. The reason is that moving a definition to a higher-level block cannot decrease
its visibility and it is impossible to reference variables defined in a different function.</p>
<p>The benefit of this stage is that function definitions can be looked up more easily
and functions can be optimized in isolation without having to traverse the AST completely.</p>
</section>
<section id="functiongrouper">
<span id="function-grouper"></span><h5>FunctionGrouper<a class="headerlink" href="#functiongrouper" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>The function grouper has to be applied after the disambiguator and the function hoister.
Its effect is that all topmost elements that are not function definitions are moved
into a single block which is the first statement of the root block.</p>
<p>After this step, a program has the following normal form:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>{ I F... }
</pre></div>
</div>
<p>Where <code class="docutils literal notranslate"><span class="pre">I</span></code> is a (potentially empty) block that does not contain any function definitions (not even recursively)
and <code class="docutils literal notranslate"><span class="pre">F</span></code> is a list of function definitions such that no function contains a function definition.</p>
<p>The benefit of this stage is that we always know where the list of function begins.</p>
</section>
<section id="forloopconditionintobody">
<span id="for-loop-condition-into-body"></span><h5>ForLoopConditionIntoBody<a class="headerlink" href="#forloopconditionintobody" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>This transformation moves the loop-iteration condition of a for-loop into loop body.
We need this transformation because <a class="reference internal" href="#expression-splitter"><span class="std std-ref">ExpressionSplitter</span></a> will not
apply to iteration condition expressions (the <code class="docutils literal notranslate"><span class="pre">C</span></code> in the following example).</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>for { Init... } C { Post... } {
    Body...
}
</pre></div>
</div>
<p>is transformed to</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>for { Init... } 1 { Post... } {
    if iszero(C) { break }
    Body...
}
</pre></div>
</div>
<p>This transformation can also be useful when paired with <code class="docutils literal notranslate"><span class="pre">LoopInvariantCodeMotion</span></code>, since
invariants in the loop-invariant conditions can then be taken outside the loop.</p>
</section>
<section id="forloopinitrewriter">
<span id="for-loop-init-rewriter"></span><h5>ForLoopInitRewriter<a class="headerlink" href="#forloopinitrewriter" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>This transformation moves the initialization part of a for-loop to before
the loop:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>for { Init... } C { Post... } {
    Body...
}
</pre></div>
</div>
<p>is transformed to</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Init...
for {} C { Post... } {
    Body...
}
</pre></div>
</div>
<p>This eases the rest of the optimization process because we can ignore
the complicated scoping rules of the for loop initialisation block.</p>
</section>
<section id="vardeclinitializer">
<span id="var-decl-initializer"></span><h5>VarDeclInitializer<a class="headerlink" href="#vardeclinitializer" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>This step rewrites variable declarations so that all of them are initialized.
Declarations like <code class="docutils literal notranslate"><span class="pre">let</span> <span class="pre">x,</span> <span class="pre">y</span></code> are split into multiple declaration statements.</p>
<p>Only supports initializing with the zero literal for now.</p>
</section>
</section>
<section id="pseudo-ssa-transformation">
<h4>Pseudo-SSA Transformation<a class="headerlink" href="#pseudo-ssa-transformation" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>The purpose of this components is to get the program into a longer form,
so that other components can more easily work with it. The final representation
will be similar to a static-single-assignment (SSA) form, with the difference
that it does not make use of explicit ‚Äúphi‚Äù functions which combines the values
from different branches of control flow because such a feature does not exist
in the Yul language. Instead, when control flow merges, if a variable is re-assigned
in one of the branches, a new SSA variable is declared to hold its current value,
so that the following expressions still only need to reference SSA variables.</p>
<p>An example transformation is the following:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=yul&amp;version=0.8.15&amp;code=ewogICAgbGV0IGEgOj0gY2FsbGRhdGFsb2FkKDApCiAgICBsZXQgYiA6PSBjYWxsZGF0YWxvYWQoMHgyMCkKICAgIGlmIGd0KGEsIDApIHsKICAgICAgICBiIDo9IG11bChiLCAweDIwKQogICAgfQogICAgYSA6PSBhZGQoYSwgMSkKICAgIHNzdG9yZShhLCBhZGQoYiwgMHgyMCkpCn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-yul notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="ow">let</span> <span class="nv">a</span> <span class="o">:=</span> <span class="nf">calldataload</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="ow">let</span> <span class="nv">b</span> <span class="o">:=</span> <span class="nf">calldataload</span><span class="p">(</span><span class="mh">0x20</span><span class="p">)</span>
    <span class="k">if</span> <span class="nf">gt</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">b</span> <span class="o">:=</span> <span class="nf">mul</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">a</span> <span class="o">:=</span> <span class="nf">add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="nf">sstore</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="nf">add</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">))</span>
<span class="p">}</span>
</pre></div>
</div>
<p>When all the following transformation steps are applied, the program will look
as follows:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=yul&amp;version=0.8.15&amp;code=ewogICAgbGV0IF8xIDo9IDAKICAgIGxldCBhXzkgOj0gY2FsbGRhdGFsb2FkKF8xKQogICAgbGV0IGEgOj0gYV85CiAgICBsZXQgXzIgOj0gMHgyMAogICAgbGV0IGJfMTAgOj0gY2FsbGRhdGFsb2FkKF8yKQogICAgbGV0IGIgOj0gYl8xMAogICAgbGV0IF8zIDo9IDAKICAgIGxldCBfNCA6PSBndChhXzksIF8zKQogICAgaWYgXzQKICAgIHsKICAgICAgICBsZXQgXzUgOj0gMHgyMAogICAgICAgIGxldCBiXzExIDo9IG11bChiXzEwLCBfNSkKICAgICAgICBiIDo9IGJfMTEKICAgIH0KICAgIGxldCBiXzEyIDo9IGIKICAgIGxldCBfNiA6PSAxCiAgICBsZXQgYV8xMyA6PSBhZGQoYV85LCBfNikKICAgIGxldCBfNyA6PSAweDIwCiAgICBsZXQgXzggOj0gYWRkKGJfMTIsIF83KQogICAgc3N0b3JlKGFfMTMsIF84KQp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-yul notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="ow">let</span> <span class="nv">_1</span> <span class="o">:=</span> <span class="mi">0</span>
    <span class="ow">let</span> <span class="nv">a_9</span> <span class="o">:=</span> <span class="nf">calldataload</span><span class="p">(</span><span class="n">_1</span><span class="p">)</span>
    <span class="ow">let</span> <span class="nv">a</span> <span class="o">:=</span> <span class="n">a_9</span>
    <span class="ow">let</span> <span class="nv">_2</span> <span class="o">:=</span> <span class="mh">0x20</span>
    <span class="ow">let</span> <span class="nv">b_10</span> <span class="o">:=</span> <span class="nf">calldataload</span><span class="p">(</span><span class="n">_2</span><span class="p">)</span>
    <span class="ow">let</span> <span class="nv">b</span> <span class="o">:=</span> <span class="n">b_10</span>
    <span class="ow">let</span> <span class="nv">_3</span> <span class="o">:=</span> <span class="mi">0</span>
    <span class="ow">let</span> <span class="nv">_4</span> <span class="o">:=</span> <span class="nf">gt</span><span class="p">(</span><span class="n">a_9</span><span class="p">,</span> <span class="n">_3</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_4</span>
    <span class="p">{</span>
        <span class="ow">let</span> <span class="nv">_5</span> <span class="o">:=</span> <span class="mh">0x20</span>
        <span class="ow">let</span> <span class="nv">b_11</span> <span class="o">:=</span> <span class="nf">mul</span><span class="p">(</span><span class="n">b_10</span><span class="p">,</span> <span class="n">_5</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">:=</span> <span class="n">b_11</span>
    <span class="p">}</span>
    <span class="ow">let</span> <span class="nv">b_12</span> <span class="o">:=</span> <span class="n">b</span>
    <span class="ow">let</span> <span class="nv">_6</span> <span class="o">:=</span> <span class="mi">1</span>
    <span class="ow">let</span> <span class="nv">a_13</span> <span class="o">:=</span> <span class="nf">add</span><span class="p">(</span><span class="n">a_9</span><span class="p">,</span> <span class="n">_6</span><span class="p">)</span>
    <span class="ow">let</span> <span class="nv">_7</span> <span class="o">:=</span> <span class="mh">0x20</span>
    <span class="ow">let</span> <span class="nv">_8</span> <span class="o">:=</span> <span class="nf">add</span><span class="p">(</span><span class="n">b_12</span><span class="p">,</span> <span class="n">_7</span><span class="p">)</span>
    <span class="nf">sstore</span><span class="p">(</span><span class="n">a_13</span><span class="p">,</span> <span class="n">_8</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Note that the only variable that is re-assigned in this snippet is <code class="docutils literal notranslate"><span class="pre">b</span></code>.
This re-assignment cannot be avoided because <code class="docutils literal notranslate"><span class="pre">b</span></code> has different values
depending on the control flow. All other variables never change their
value once they are defined. The advantage of this property is that
variables can be freely moved around and references to them
can be exchanged by their initial value (and vice-versa),
as long as these values are still valid in the new context.</p>
<p>Of course, the code here is far from being optimized. To the contrary, it is much
longer. The hope is that this code will be easier to work with and furthermore,
there are optimizer steps that undo these changes and make the code more
compact again at the end.</p>
<section id="expressionsplitter">
<span id="expression-splitter"></span><h5>ExpressionSplitter<a class="headerlink" href="#expressionsplitter" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>The expression splitter turns expressions like <code class="docutils literal notranslate"><span class="pre">add(mload(0x123),</span> <span class="pre">mul(mload(0x456),</span> <span class="pre">0x20))</span></code>
into a sequence of declarations of unique variables that are assigned sub-expressions
of that expression so that each function call has only variables
as arguments.</p>
<p>The above would be transformed into</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=yul&amp;version=0.8.15&amp;code=ewogICAgbGV0IF8xIDo9IDB4MjAKICAgIGxldCBfMiA6PSAweDQ1NgogICAgbGV0IF8zIDo9IG1sb2FkKF8yKQogICAgbGV0IF80IDo9IG11bChfMywgXzEpCiAgICBsZXQgXzUgOj0gMHgxMjMKICAgIGxldCBfNiA6PSBtbG9hZChfNSkKICAgIGxldCB6IDo9IGFkZChfNiwgXzQpCn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-yul notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="ow">let</span> <span class="nv">_1</span> <span class="o">:=</span> <span class="mh">0x20</span>
    <span class="ow">let</span> <span class="nv">_2</span> <span class="o">:=</span> <span class="mh">0x456</span>
    <span class="ow">let</span> <span class="nv">_3</span> <span class="o">:=</span> <span class="nf">mload</span><span class="p">(</span><span class="n">_2</span><span class="p">)</span>
    <span class="ow">let</span> <span class="nv">_4</span> <span class="o">:=</span> <span class="nf">mul</span><span class="p">(</span><span class="n">_3</span><span class="p">,</span> <span class="n">_1</span><span class="p">)</span>
    <span class="ow">let</span> <span class="nv">_5</span> <span class="o">:=</span> <span class="mh">0x123</span>
    <span class="ow">let</span> <span class="nv">_6</span> <span class="o">:=</span> <span class="nf">mload</span><span class="p">(</span><span class="n">_5</span><span class="p">)</span>
    <span class="ow">let</span> <span class="nv">z</span> <span class="o">:=</span> <span class="nf">add</span><span class="p">(</span><span class="n">_6</span><span class="p">,</span> <span class="n">_4</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Note that this transformation does not change the order of opcodes or function calls.</p>
<p>It is not applied to loop iteration-condition, because the loop control flow does not allow
this ‚Äúoutlining‚Äù of the inner expressions in all cases. We can sidestep this limitation by applying
<a class="reference internal" href="#for-loop-condition-into-body"><span class="std std-ref">ForLoopConditionIntoBody</span></a> to move the iteration condition into loop body.</p>
<p>The final program should be in a form such that (with the exception of loop conditions)
function calls cannot appear nested inside expressions
and all function call arguments have to be variables.</p>
<p>The benefits of this form are that it is much easier to re-order the sequence of opcodes
and it is also easier to perform function call inlining. Furthermore, it is simpler
to replace individual parts of expressions or re-organize the ‚Äúexpression tree‚Äù.
The drawback is that such code is much harder to read for humans.</p>
</section>
<section id="ssatransform">
<span id="ssa-transform"></span><h5>SSATransform<a class="headerlink" href="#ssatransform" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>This stage tries to replace repeated assignments to
existing variables by declarations of new variables as much as
possible.
The reassignments are still there, but all references to the
reassigned variables are replaced by the newly declared variables.</p>
<p>Example:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=yul&amp;version=0.8.15&amp;code=ewogICAgbGV0IGEgOj0gMQogICAgbXN0b3JlKGEsIDIpCiAgICBhIDo9IDMKfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-yul notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="ow">let</span> <span class="nv">a</span> <span class="o">:=</span> <span class="mi">1</span>
    <span class="nf">mstore</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">:=</span> <span class="mi">3</span>
<span class="p">}</span>
</pre></div>
</div>
<p>is transformed to</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=yul&amp;version=0.8.15&amp;code=ewogICAgbGV0IGFfMSA6PSAxCiAgICBsZXQgYSA6PSBhXzEKICAgIG1zdG9yZShhXzEsIDIpCiAgICBsZXQgYV8zIDo9IDMKICAgIGEgOj0gYV8zCn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-yul notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="ow">let</span> <span class="nv">a_1</span> <span class="o">:=</span> <span class="mi">1</span>
    <span class="ow">let</span> <span class="nv">a</span> <span class="o">:=</span> <span class="n">a_1</span>
    <span class="nf">mstore</span><span class="p">(</span><span class="n">a_1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="ow">let</span> <span class="nv">a_3</span> <span class="o">:=</span> <span class="mi">3</span>
    <span class="n">a</span> <span class="o">:=</span> <span class="n">a_3</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Exact semantics:</p>
<p>For any variable <code class="docutils literal notranslate"><span class="pre">a</span></code> that is assigned to somewhere in the code
(variables that are declared with value and never re-assigned
are not modified) perform the following transforms:</p>
<ul class="simple">
<li><p>replace <code class="docutils literal notranslate"><span class="pre">let</span> <span class="pre">a</span> <span class="pre">:=</span> <span class="pre">v</span></code> by <code class="docutils literal notranslate"><span class="pre">let</span> <span class="pre">a_i</span> <span class="pre">:=</span> <span class="pre">v</span>&#160;&#160; <span class="pre">let</span> <span class="pre">a</span> <span class="pre">:=</span> <span class="pre">a_i</span></code></p></li>
<li><p>replace <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">:=</span> <span class="pre">v</span></code> by <code class="docutils literal notranslate"><span class="pre">let</span> <span class="pre">a_i</span> <span class="pre">:=</span> <span class="pre">v</span>&#160;&#160; <span class="pre">a</span> <span class="pre">:=</span> <span class="pre">a_i</span></code> where <code class="docutils literal notranslate"><span class="pre">i</span></code> is a number such that <code class="docutils literal notranslate"><span class="pre">a_i</span></code> is yet unused.</p></li>
</ul>
<p>Furthermore, always record the current value of <code class="docutils literal notranslate"><span class="pre">i</span></code> used for <code class="docutils literal notranslate"><span class="pre">a</span></code> and replace each
reference to <code class="docutils literal notranslate"><span class="pre">a</span></code> by <code class="docutils literal notranslate"><span class="pre">a_i</span></code>.
The current value mapping is cleared for a variable <code class="docutils literal notranslate"><span class="pre">a</span></code> at the end of each block
in which it was assigned to and at the end of the for loop init block if it is assigned
inside the for loop body or post block.
If a variable‚Äôs value is cleared according to the rule above and the variable is declared outside
the block, a new SSA variable will be created at the location where control flow joins,
this includes the beginning of loop post/body block and the location right after
If/Switch/ForLoop/Block statement.</p>
<p>After this stage, the Redundant Assign Eliminator is recommended to remove the unnecessary
intermediate assignments.</p>
<p>This stage provides best results if the Expression Splitter and the Common Subexpression Eliminator
are run right before it, because then it does not generate excessive amounts of variables.
On the other hand, the Common Subexpression Eliminator could be more efficient if run after the
SSA transform.</p>
</section>
<section id="redundantassigneliminator">
<span id="redundant-assign-eliminator"></span><h5>RedundantAssignEliminator<a class="headerlink" href="#redundantassigneliminator" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>The SSA transform always generates an assignment of the form <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">:=</span> <span class="pre">a_i</span></code>, even though
these might be unnecessary in many cases, like the following example:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=yul&amp;version=0.8.15&amp;code=ewogICAgbGV0IGEgOj0gMQogICAgYSA6PSBtbG9hZChhKQogICAgYSA6PSBzbG9hZChhKQogICAgc3N0b3JlKGEsIDEpCn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-yul notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="ow">let</span> <span class="nv">a</span> <span class="o">:=</span> <span class="mi">1</span>
    <span class="n">a</span> <span class="o">:=</span> <span class="nf">mload</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">:=</span> <span class="nf">sload</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="nf">sstore</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The SSA transform converts this snippet to the following:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=yul&amp;version=0.8.15&amp;code=ewogICAgbGV0IGFfMSA6PSAxCiAgICBsZXQgYSA6PSBhXzEKICAgIGxldCBhXzIgOj0gbWxvYWQoYV8xKQogICAgYSA6PSBhXzIKICAgIGxldCBhXzMgOj0gc2xvYWQoYV8yKQogICAgYSA6PSBhXzMKICAgIHNzdG9yZShhXzMsIDEpCn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-yul notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="ow">let</span> <span class="nv">a_1</span> <span class="o">:=</span> <span class="mi">1</span>
    <span class="ow">let</span> <span class="nv">a</span> <span class="o">:=</span> <span class="n">a_1</span>
    <span class="ow">let</span> <span class="nv">a_2</span> <span class="o">:=</span> <span class="nf">mload</span><span class="p">(</span><span class="n">a_1</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">:=</span> <span class="n">a_2</span>
    <span class="ow">let</span> <span class="nv">a_3</span> <span class="o">:=</span> <span class="nf">sload</span><span class="p">(</span><span class="n">a_2</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">:=</span> <span class="n">a_3</span>
    <span class="nf">sstore</span><span class="p">(</span><span class="n">a_3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The Redundant Assign Eliminator removes all the three assignments to <code class="docutils literal notranslate"><span class="pre">a</span></code>, because
the value of <code class="docutils literal notranslate"><span class="pre">a</span></code> is not used and thus turn this
snippet into strict SSA form:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=yul&amp;version=0.8.15&amp;code=ewogICAgbGV0IGFfMSA6PSAxCiAgICBsZXQgYV8yIDo9IG1sb2FkKGFfMSkKICAgIGxldCBhXzMgOj0gc2xvYWQoYV8yKQogICAgc3N0b3JlKGFfMywgMSkKfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-yul notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="ow">let</span> <span class="nv">a_1</span> <span class="o">:=</span> <span class="mi">1</span>
    <span class="ow">let</span> <span class="nv">a_2</span> <span class="o">:=</span> <span class="nf">mload</span><span class="p">(</span><span class="n">a_1</span><span class="p">)</span>
    <span class="ow">let</span> <span class="nv">a_3</span> <span class="o">:=</span> <span class="nf">sload</span><span class="p">(</span><span class="n">a_2</span><span class="p">)</span>
    <span class="nf">sstore</span><span class="p">(</span><span class="n">a_3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Of course the intricate parts of determining whether an assignment is redundant or not
are connected to joining control flow.</p>
<p>The component works as follows in detail:</p>
<p>The AST is traversed twice: in an information gathering step and in the
actual removal step. During information gathering, we maintain a
mapping from assignment statements to the three states
‚Äúunused‚Äù, ‚Äúundecided‚Äù and ‚Äúused‚Äù which signifies whether the assigned
value will be used later by a reference to the variable.</p>
<p>When an assignment is visited, it is added to the mapping in the ‚Äúundecided‚Äù state
(see remark about for loops below) and every other assignment to the same variable
that is still in the ‚Äúundecided‚Äù state is changed to ‚Äúunused‚Äù.
When a variable is referenced, the state of any assignment to that variable still
in the ‚Äúundecided‚Äù state is changed to ‚Äúused‚Äù.</p>
<p>At points where control flow splits, a copy
of the mapping is handed over to each branch. At points where control flow
joins, the two mappings coming from the two branches are combined in the following way:
Statements that are only in one mapping or have the same state are used unchanged.
Conflicting values are resolved in the following way:</p>
<ul class="simple">
<li><p>‚Äúunused‚Äù, ‚Äúundecided‚Äù -&gt; ‚Äúundecided‚Äù</p></li>
<li><p>‚Äúunused‚Äù, ‚Äúused‚Äù -&gt; ‚Äúused‚Äù</p></li>
<li><p>‚Äúundecided, ‚Äúused‚Äù -&gt; ‚Äúused‚Äù</p></li>
</ul>
<p>For for-loops, the condition, body and post-part are visited twice, taking
the joining control-flow at the condition into account.
In other words, we create three control flow paths: Zero runs of the loop,
one run and two runs and then combine them at the end.</p>
<p>Simulating a third run or even more is unnecessary, which can be seen as follows:</p>
<p>A state of an assignment at the beginning of the iteration will deterministically
result in a state of that assignment at the end of the iteration. Let this
state mapping function be called <code class="docutils literal notranslate"><span class="pre">f</span></code>. The combination of the three different
states <code class="docutils literal notranslate"><span class="pre">unused</span></code>, <code class="docutils literal notranslate"><span class="pre">undecided</span></code> and <code class="docutils literal notranslate"><span class="pre">used</span></code> as explained above is the <code class="docutils literal notranslate"><span class="pre">max</span></code>
operation where <code class="docutils literal notranslate"><span class="pre">unused</span> <span class="pre">=</span> <span class="pre">0</span></code>, <code class="docutils literal notranslate"><span class="pre">undecided</span> <span class="pre">=</span> <span class="pre">1</span></code> and <code class="docutils literal notranslate"><span class="pre">used</span> <span class="pre">=</span> <span class="pre">2</span></code>.</p>
<p>The proper way would be to compute</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>max(s, f(s), f(f(s)), f(f(f(s))), ...)
</pre></div>
</div>
<p>as state after the loop. Since <code class="docutils literal notranslate"><span class="pre">f</span></code> just has a range of three different values,
iterating it has to reach a cycle after at most three iterations,
and thus <code class="docutils literal notranslate"><span class="pre">f(f(f(s)))</span></code> has to equal one of <code class="docutils literal notranslate"><span class="pre">s</span></code>, <code class="docutils literal notranslate"><span class="pre">f(s)</span></code>, or <code class="docutils literal notranslate"><span class="pre">f(f(s))</span></code>
and thus</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>max(s, f(s), f(f(s))) = max(s, f(s), f(f(s)), f(f(f(s))), ...).
</pre></div>
</div>
<p>In summary, running the loop at most twice is enough because there are only three
different states.</p>
<p>For switch statements that have a ‚Äúdefault‚Äù-case, there is no control-flow
part that skips the switch.</p>
<p>When a variable goes out of scope, all statements still in the ‚Äúundecided‚Äù
state are changed to ‚Äúunused‚Äù, unless the variable is the return
parameter of a function - there, the state changes to ‚Äúused‚Äù.</p>
<p>In the second traversal, all assignments that are in the ‚Äúunused‚Äù state are removed.</p>
<p>This step is usually run right after the SSA transform to complete
the generation of the pseudo-SSA.</p>
</section>
</section>
<section id="tools">
<h4>Tools<a class="headerlink" href="#tools" title="Permalink to this heading">ÔÉÅ</a></h4>
<section id="movability">
<h5>Movability<a class="headerlink" href="#movability" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>Movability is a property of an expression. It roughly means that the expression
is side-effect free and its evaluation only depends on the values of variables
and the call-constant state of the environment. Most expressions are movable.
The following parts make an expression non-movable:</p>
<ul class="simple">
<li><p>function calls (might be relaxed in the future if all statements in the function are movable)</p></li>
<li><p>opcodes that (can) have side-effects (like <code class="docutils literal notranslate"><span class="pre">call</span></code> or <code class="docutils literal notranslate"><span class="pre">selfdestruct</span></code>)</p></li>
<li><p>opcodes that read or write memory, storage or external state information</p></li>
<li><p>opcodes that depend on the current PC, memory size or returndata size</p></li>
</ul>
</section>
<section id="dataflowanalyzer">
<h5>DataflowAnalyzer<a class="headerlink" href="#dataflowanalyzer" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>The Dataflow Analyzer is not an optimizer step itself but is used as a tool
by other components. While traversing the AST, it tracks the current value of
each variable, as long as that value is a movable expression.
It records the variables that are part of the expression
that is currently assigned to each other variable. Upon each assignment to
a variable <code class="docutils literal notranslate"><span class="pre">a</span></code>, the current stored value of <code class="docutils literal notranslate"><span class="pre">a</span></code> is updated and
all stored values of all variables <code class="docutils literal notranslate"><span class="pre">b</span></code> are cleared whenever <code class="docutils literal notranslate"><span class="pre">a</span></code> is part
of the currently stored expression for <code class="docutils literal notranslate"><span class="pre">b</span></code>.</p>
<p>At control-flow joins, knowledge about variables is cleared if they have or would be assigned
in any of the control-flow paths. For instance, upon entering a
for loop, all variables are cleared that will be assigned during the
body or the post block.</p>
</section>
</section>
<section id="expression-scale-simplifications">
<h4>Expression-Scale Simplifications<a class="headerlink" href="#expression-scale-simplifications" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>These simplification passes change expressions and replace them by equivalent
and hopefully simpler expressions.</p>
<section id="commonsubexpressioneliminator">
<span id="common-subexpression-eliminator"></span><h5>CommonSubexpressionEliminator<a class="headerlink" href="#commonsubexpressioneliminator" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>This step uses the Dataflow Analyzer and replaces subexpressions that
syntactically match the current value of a variable by a reference to
that variable. This is an equivalence transform because such subexpressions have
to be movable.</p>
<p>All subexpressions that are identifiers themselves are replaced by their
current value if the value is an identifier.</p>
<p>The combination of the two rules above allow to compute a local value
numbering, which means that if two variables have the same
value, one of them will always be unused. The Unused Pruner or the
Redundant Assign Eliminator will then be able to fully eliminate such
variables.</p>
<p>This step is especially efficient if the expression splitter is run
before. If the code is in pseudo-SSA form,
the values of variables are available for a longer time and thus we
have a higher chance of expressions to be replaceable.</p>
<p>The expression simplifier will be able to perform better replacements
if the common subexpression eliminator was run right before it.</p>
</section>
<section id="expression-simplifier">
<span id="id3"></span><h5>Expression Simplifier<a class="headerlink" href="#expression-simplifier" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>The Expression Simplifier uses the Dataflow Analyzer and makes use
of a list of equivalence transforms on expressions like <code class="docutils literal notranslate"><span class="pre">X</span> <span class="pre">+</span> <span class="pre">0</span> <span class="pre">-&gt;</span> <span class="pre">X</span></code>
to simplify the code.</p>
<p>It tries to match patterns like <code class="docutils literal notranslate"><span class="pre">X</span> <span class="pre">+</span> <span class="pre">0</span></code> on each subexpression.
During the matching procedure, it resolves variables to their currently
assigned expressions to be able to match more deeply nested patterns
even when the code is in pseudo-SSA form.</p>
<p>Some of the patterns like <code class="docutils literal notranslate"><span class="pre">X</span> <span class="pre">-</span> <span class="pre">X</span> <span class="pre">-&gt;</span> <span class="pre">0</span></code> can only be applied as long
as the expression <code class="docutils literal notranslate"><span class="pre">X</span></code> is movable, because otherwise it would remove its potential side-effects.
Since variable references are always movable, even if their current
value might not be, the Expression Simplifier is again more powerful
in split or pseudo-SSA form.</p>
</section>
<section id="literalrematerialiser">
<span id="literal-rematerialiser"></span><h5>LiteralRematerialiser<a class="headerlink" href="#literalrematerialiser" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>To be documented.</p>
</section>
<section id="loadresolver">
<span id="load-resolver"></span><h5>LoadResolver<a class="headerlink" href="#loadresolver" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>Optimisation stage that replaces expressions of type <code class="docutils literal notranslate"><span class="pre">sload(x)</span></code> and <code class="docutils literal notranslate"><span class="pre">mload(x)</span></code> by the value
currently stored in storage resp. memory, if known.</p>
<p>Works best if the code is in SSA form.</p>
<p>Prerequisite: Disambiguator, ForLoopInitRewriter.</p>
</section>
<section id="reasoningbasedsimplifier">
<span id="reasoning-based-simplifier"></span><h5>ReasoningBasedSimplifier<a class="headerlink" href="#reasoningbasedsimplifier" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>This optimizer uses SMT solvers to check whether <code class="docutils literal notranslate"><span class="pre">if</span></code> conditions are constant.</p>
<ul class="simple">
<li><p>If <code class="docutils literal notranslate"><span class="pre">constraints</span> <span class="pre">AND</span> <span class="pre">condition</span></code> is UNSAT, the condition is never true and the whole body can be removed.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">constraints</span> <span class="pre">AND</span> <span class="pre">NOT</span> <span class="pre">condition</span></code> is UNSAT, the condition is always true and can be replaced by <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p></li>
</ul>
<p>The simplifications above can only be applied if the condition is movable.</p>
<p>It is only effective on the EVM dialect, but safe to use on other dialects.</p>
<p>Prerequisite: Disambiguator, SSATransform.</p>
</section>
</section>
<section id="statement-scale-simplifications">
<h4>Statement-Scale Simplifications<a class="headerlink" href="#statement-scale-simplifications" title="Permalink to this heading">ÔÉÅ</a></h4>
<section id="circularreferencespruner">
<span id="circular-reference-pruner"></span><h5>CircularReferencesPruner<a class="headerlink" href="#circularreferencespruner" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>This stage removes functions that call each other but are
neither externally referenced nor referenced from the outermost context.</p>
</section>
<section id="conditionalsimplifier">
<span id="conditional-simplifier"></span><h5>ConditionalSimplifier<a class="headerlink" href="#conditionalsimplifier" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>The Conditional Simplifier inserts assignments to condition variables if the value can be determined
from the control-flow.</p>
<p>Destroys SSA form.</p>
<p>Currently, this tool is very limited, mostly because we do not yet have support
for boolean types. Since conditions only check for expressions being nonzero,
we cannot assign a specific value.</p>
<p>Current features:</p>
<ul class="simple">
<li><p>switch cases: insert ‚Äú&lt;condition&gt; := &lt;caseLabel&gt;‚Äù</p></li>
<li><p>after if statement with terminating control-flow, insert ‚Äú&lt;condition&gt; := 0‚Äù</p></li>
</ul>
<p>Future features:</p>
<ul class="simple">
<li><p>allow replacements by ‚Äú1‚Äù</p></li>
<li><p>take termination of user-defined functions into account</p></li>
</ul>
<p>Works best with SSA form and if dead code removal has run before.</p>
<p>Prerequisite: Disambiguator.</p>
</section>
<section id="conditionalunsimplifier">
<span id="conditional-unsimplifier"></span><h5>ConditionalUnsimplifier<a class="headerlink" href="#conditionalunsimplifier" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>Reverse of Conditional Simplifier.</p>
</section>
<section id="controlflowsimplifier">
<span id="control-flow-simplifier"></span><h5>ControlFlowSimplifier<a class="headerlink" href="#controlflowsimplifier" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>Simplifies several control-flow structures:</p>
<ul class="simple">
<li><p>replace if with empty body with pop(condition)</p></li>
<li><p>remove empty default switch case</p></li>
<li><p>remove empty switch case if no default case exists</p></li>
<li><p>replace switch with no cases with pop(expression)</p></li>
<li><p>turn switch with single case into if</p></li>
<li><p>replace switch with only default case with pop(expression) and body</p></li>
<li><p>replace switch with const expr with matching case body</p></li>
<li><p>replace <code class="docutils literal notranslate"><span class="pre">for</span></code> with terminating control flow and without other break/continue by <code class="docutils literal notranslate"><span class="pre">if</span></code></p></li>
<li><p>remove <code class="docutils literal notranslate"><span class="pre">leave</span></code> at the end of a function.</p></li>
</ul>
<p>None of these operations depend on the data flow. The StructuralSimplifier
performs similar tasks that do depend on data flow.</p>
<p>The ControlFlowSimplifier does record the presence or absence of <code class="docutils literal notranslate"><span class="pre">break</span></code>
and <code class="docutils literal notranslate"><span class="pre">continue</span></code> statements during its traversal.</p>
<p>Prerequisite: Disambiguator, FunctionHoister, ForLoopInitRewriter.
Important: Introduces EVM opcodes and thus can only be used on EVM code for now.</p>
</section>
<section id="deadcodeeliminator">
<span id="dead-code-eliminator"></span><h5>DeadCodeEliminator<a class="headerlink" href="#deadcodeeliminator" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>This optimization stage removes unreachable code.</p>
<p>Unreachable code is any code within a block which is preceded by a
leave, return, invalid, break, continue, selfdestruct or revert.</p>
<p>Function definitions are retained as they might be called by earlier
code and thus are considered reachable.</p>
<p>Because variables declared in a for loop‚Äôs init block have their scope extended to the loop body,
we require ForLoopInitRewriter to run before this step.</p>
<p>Prerequisite: ForLoopInitRewriter, Function Hoister, Function Grouper</p>
</section>
<section id="equalstoreeliminator">
<span id="equal-store-eliminator"></span><h5>EqualStoreEliminator<a class="headerlink" href="#equalstoreeliminator" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>This steps removes <code class="docutils literal notranslate"><span class="pre">mstore(k,</span> <span class="pre">v)</span></code> and <code class="docutils literal notranslate"><span class="pre">sstore(k,</span> <span class="pre">v)</span></code> calls if
there was a previous call to <code class="docutils literal notranslate"><span class="pre">mstore(k,</span> <span class="pre">v)</span></code> / <code class="docutils literal notranslate"><span class="pre">sstore(k,</span> <span class="pre">v)</span></code>,
no other store in between and the values of <code class="docutils literal notranslate"><span class="pre">k</span></code> and <code class="docutils literal notranslate"><span class="pre">v</span></code> did not change.</p>
<p>This simple step is effective if run after the SSA transform and the
Common Subexpression Eliminator, because SSA will make sure that the variables
will not change and the Common Subexpression Eliminator re-uses exactly the same
variable if the value is known to be the same.</p>
<p>Prerequisites: Disambiguator, ForLoopInitRewriter</p>
</section>
<section id="unusedpruner">
<span id="unused-pruner"></span><h5>UnusedPruner<a class="headerlink" href="#unusedpruner" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>This step removes the definitions of all functions that are never referenced.</p>
<p>It also removes the declaration of variables that are never referenced.
If the declaration assigns a value that is not movable, the expression is retained,
but its value is discarded.</p>
<p>All movable expression statements (expressions that are not assigned) are removed.</p>
</section>
<section id="structuralsimplifier">
<span id="structural-simplifier"></span><h5>StructuralSimplifier<a class="headerlink" href="#structuralsimplifier" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>This is a general step that performs various kinds of simplifications on
a structural level:</p>
<ul class="simple">
<li><p>replace if statement with empty body by <code class="docutils literal notranslate"><span class="pre">pop(condition)</span></code></p></li>
<li><p>replace if statement with true condition by its body</p></li>
<li><p>remove if statement with false condition</p></li>
<li><p>turn switch with single case into if</p></li>
<li><p>replace switch with only default case by <code class="docutils literal notranslate"><span class="pre">pop(expression)</span></code> and body</p></li>
<li><p>replace switch with literal expression by matching case body</p></li>
<li><p>replace for loop with false condition by its initialization part</p></li>
</ul>
<p>This component uses the Dataflow Analyzer.</p>
</section>
<section id="blockflattener">
<span id="block-flattener"></span><h5>BlockFlattener<a class="headerlink" href="#blockflattener" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>This stage eliminates nested blocks by inserting the statement in the
inner block at the appropriate place in the outer block. It depends on the
FunctionGrouper and does not flatten the outermost block to keep the form
produced by the FunctionGrouper.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=yul&amp;version=0.8.15&amp;code=ewogICAgewogICAgICAgIGxldCB4IDo9IDIKICAgICAgICB7CiAgICAgICAgICAgIGxldCB5IDo9IDMKICAgICAgICAgICAgbXN0b3JlKHgsIHkpCiAgICAgICAgfQogICAgfQp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-yul notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="p">{</span>
        <span class="ow">let</span> <span class="nv">x</span> <span class="o">:=</span> <span class="mi">2</span>
        <span class="p">{</span>
            <span class="ow">let</span> <span class="nv">y</span> <span class="o">:=</span> <span class="mi">3</span>
            <span class="nf">mstore</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>is transformed to</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=yul&amp;version=0.8.15&amp;code=ewogICAgewogICAgICAgIGxldCB4IDo9IDIKICAgICAgICBsZXQgeSA6PSAzCiAgICAgICAgbXN0b3JlKHgsIHkpCiAgICB9Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-yul notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="p">{</span>
        <span class="ow">let</span> <span class="nv">x</span> <span class="o">:=</span> <span class="mi">2</span>
        <span class="ow">let</span> <span class="nv">y</span> <span class="o">:=</span> <span class="mi">3</span>
        <span class="nf">mstore</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>As long as the code is disambiguated, this does not cause a problem because
the scopes of variables can only grow.</p>
</section>
<section id="loopinvariantcodemotion">
<span id="loop-invariant-code-motion"></span><h5>LoopInvariantCodeMotion<a class="headerlink" href="#loopinvariantcodemotion" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>This optimization moves movable SSA variable declarations outside the loop.</p>
<p>Only statements at the top level in a loop‚Äôs body or post block are considered, i.e variable
declarations inside conditional branches will not be moved out of the loop.</p>
<p>Requirements:</p>
<ul class="simple">
<li><p>The Disambiguator, ForLoopInitRewriter and FunctionHoister must be run upfront.</p></li>
<li><p>Expression splitter and SSA transform should be run upfront to obtain better result.</p></li>
</ul>
</section>
</section>
<section id="function-level-optimizations">
<h4>Function-Level Optimizations<a class="headerlink" href="#function-level-optimizations" title="Permalink to this heading">ÔÉÅ</a></h4>
<section id="functionspecializer">
<span id="function-specializer"></span><h5>FunctionSpecializer<a class="headerlink" href="#functionspecializer" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>This step specializes the function with its literal arguments.</p>
<p>If a function, say, <code class="docutils literal notranslate"><span class="pre">function</span> <span class="pre">f(a,</span> <span class="pre">b)</span> <span class="pre">{</span> <span class="pre">sstore</span> <span class="pre">(a,</span> <span class="pre">b)</span> <span class="pre">}</span></code>, is called with literal arguments, for
example, <code class="docutils literal notranslate"><span class="pre">f(x,</span> <span class="pre">5)</span></code>, where <code class="docutils literal notranslate"><span class="pre">x</span></code> is an identifier, it could be specialized by creating a new
function <code class="docutils literal notranslate"><span class="pre">f_1</span></code> that takes only one argument, i.e.,</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=yul&amp;version=0.8.15&amp;code=ZnVuY3Rpb24gZl8xKGFfMSkgewogICAgbGV0IGJfMSA6PSA1CiAgICBzc3RvcmUoYV8xLCBiXzEpCn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-yul notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="n">f_1</span><span class="p">(</span><span class="n">a_1</span><span class="p">)</span> <span class="p">{</span>
    <span class="ow">let</span> <span class="nv">b_1</span> <span class="o">:=</span> <span class="mi">5</span>
    <span class="nf">sstore</span><span class="p">(</span><span class="n">a_1</span><span class="p">,</span> <span class="n">b_1</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Other optimization steps will be able to make more simplifications to the function. The
optimization step is mainly useful for functions that would not be inlined.</p>
<p>Prerequisites: Disambiguator, FunctionHoister</p>
<p>LiteralRematerialiser is recommended as a prerequisite, even though it‚Äôs not required for
correctness.</p>
</section>
<section id="unusedfunctionparameterpruner">
<span id="unused-function-parameter-pruner"></span><h5>UnusedFunctionParameterPruner<a class="headerlink" href="#unusedfunctionparameterpruner" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>This step removes unused parameters in a function.</p>
<p>If a parameter is unused, like <code class="docutils literal notranslate"><span class="pre">c</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> in, <code class="docutils literal notranslate"><span class="pre">function</span> <span class="pre">f(a,b,c)</span> <span class="pre">-&gt;</span> <span class="pre">x,</span> <span class="pre">y</span> <span class="pre">{</span> <span class="pre">x</span> <span class="pre">:=</span> <span class="pre">div(a,b)</span> <span class="pre">}</span></code>, we
remove the parameter and create a new ‚Äúlinking‚Äù function as follows:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=yul&amp;version=0.8.15&amp;code=ZnVuY3Rpb24gZihhLGIpIC0+IHggeyB4IDo9IGRpdihhLGIpIH0KZnVuY3Rpb24gZjIoYSxiLGMpIC0+IHgsIHkgeyB4IDo9IGYoYSxiKSB9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-yul notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="n">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="p">{</span> <span class="n">x</span> <span class="o">:=</span> <span class="nf">div</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span> <span class="p">}</span>
<span class="k">function</span> <span class="n">f2</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="p">{</span> <span class="n">x</span> <span class="o">:=</span> <span class="n">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span> <span class="p">}</span>
</pre></div>
</div>
<p>and replace all references to <code class="docutils literal notranslate"><span class="pre">f</span></code> by <code class="docutils literal notranslate"><span class="pre">f2</span></code>.
The inliner should be run afterwards to make sure that all references to <code class="docutils literal notranslate"><span class="pre">f2</span></code> are replaced by
<code class="docutils literal notranslate"><span class="pre">f</span></code>.</p>
<p>Prerequisites: Disambiguator, FunctionHoister, LiteralRematerialiser.</p>
<p>The step LiteralRematerialiser is not required for correctness. It helps deal with cases such as:
<code class="docutils literal notranslate"><span class="pre">function</span> <span class="pre">f(x)</span> <span class="pre">-&gt;</span> <span class="pre">y</span> <span class="pre">{</span> <span class="pre">revert(y,</span> <span class="pre">y}</span> <span class="pre">}</span></code> where the literal <code class="docutils literal notranslate"><span class="pre">y</span></code> will be replaced by its value <code class="docutils literal notranslate"><span class="pre">0</span></code>,
allowing us to rewrite the function.</p>
</section>
<section id="equivalentfunctioncombiner">
<span id="equivalent-function-combiner"></span><h5>EquivalentFunctionCombiner<a class="headerlink" href="#equivalentfunctioncombiner" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>If two functions are syntactically equivalent, while allowing variable
renaming but not any re-ordering, then any reference to one of the
functions is replaced by the other.</p>
<p>The actual removal of the function is performed by the Unused Pruner.</p>
</section>
</section>
<section id="function-inlining">
<h4>Function Inlining<a class="headerlink" href="#function-inlining" title="Permalink to this heading">ÔÉÅ</a></h4>
<section id="expressioninliner">
<span id="expression-inliner"></span><h5>ExpressionInliner<a class="headerlink" href="#expressioninliner" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>This component of the optimizer performs restricted function inlining by inlining functions that can be
inlined inside functional expressions, i.e. functions that:</p>
<ul class="simple">
<li><p>return a single value.</p></li>
<li><p>have a body like <code class="docutils literal notranslate"><span class="pre">r</span> <span class="pre">:=</span> <span class="pre">&lt;functional</span> <span class="pre">expression&gt;</span></code>.</p></li>
<li><p>neither reference themselves nor <code class="docutils literal notranslate"><span class="pre">r</span></code> in the right hand side.</p></li>
</ul>
<p>Furthermore, for all parameters, all of the following need to be true:</p>
<ul class="simple">
<li><p>The argument is movable.</p></li>
<li><p>The parameter is either referenced less than twice in the function body, or the argument is rather cheap
(‚Äúcost‚Äù of at most 1, like a constant up to 0xff).</p></li>
</ul>
<p>Example: The function to be inlined has the form of <code class="docutils literal notranslate"><span class="pre">function</span> <span class="pre">f(...)</span> <span class="pre">-&gt;</span> <span class="pre">r</span> <span class="pre">{</span> <span class="pre">r</span> <span class="pre">:=</span> <span class="pre">E</span> <span class="pre">}</span></code> where
<code class="docutils literal notranslate"><span class="pre">E</span></code> is an expression that does not reference <code class="docutils literal notranslate"><span class="pre">r</span></code> and all arguments in the function call are movable expressions.</p>
<p>The result of this inlining is always a single expression.</p>
<p>This component can only be used on sources with unique names.</p>
</section>
<section id="fullinliner">
<span id="full-inliner"></span><h5>FullInliner<a class="headerlink" href="#fullinliner" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>The Full Inliner replaces certain calls of certain functions
by the function‚Äôs body. This is not very helpful in most cases, because
it just increases the code size but does not have a benefit. Furthermore,
code is usually very expensive and we would often rather have shorter
code than more efficient code. In same cases, though, inlining a function
can have positive effects on subsequent optimizer steps. This is the case
if one of the function arguments is a constant, for example.</p>
<p>During inlining, a heuristic is used to tell if the function call
should be inlined or not.
The current heuristic does not inline into ‚Äúlarge‚Äù functions unless
the called function is tiny. Functions that are only used once
are inlined, as well as medium-sized functions, while function
calls with constant arguments allow slightly larger functions.</p>
<p>In the future, we may include a backtracking component
that, instead of inlining a function right away, only specializes it,
which means that a copy of the function is generated where
a certain parameter is always replaced by a constant. After that,
we can run the optimizer on this specialized function. If it
results in heavy gains, the specialized function is kept,
otherwise the original function is used instead.</p>
</section>
</section>
<section id="cleanup">
<h4>Cleanup<a class="headerlink" href="#cleanup" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>The cleanup is performed at the end of the optimizer run. It tries
to combine split expressions into deeply nested ones again and also
improves the ‚Äúcompilability‚Äù for stack machines by eliminating
variables as much as possible.</p>
<section id="expressionjoiner">
<span id="expression-joiner"></span><h5>ExpressionJoiner<a class="headerlink" href="#expressionjoiner" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>This is the opposite operation of the expression splitter. It turns a sequence of
variable declarations that have exactly one reference into a complex expression.
This stage fully preserves the order of function calls and opcode executions.
It does not make use of any information concerning the commutativity of the opcodes;
if moving the value of a variable to its place of use would change the order
of any function call or opcode execution, the transformation is not performed.</p>
<p>Note that the component will not move the assigned value of a variable assignment
or a variable that is referenced more than once.</p>
<p>The snippet <code class="docutils literal notranslate"><span class="pre">let</span> <span class="pre">x</span> <span class="pre">:=</span> <span class="pre">add(0,</span> <span class="pre">2)</span> <span class="pre">let</span> <span class="pre">y</span> <span class="pre">:=</span> <span class="pre">mul(x,</span> <span class="pre">mload(2))</span></code> is not transformed,
because it would cause the order of the call to the opcodes <code class="docutils literal notranslate"><span class="pre">add</span></code> and
<code class="docutils literal notranslate"><span class="pre">mload</span></code> to be swapped - even though this would not make a difference
because <code class="docutils literal notranslate"><span class="pre">add</span></code> is movable.</p>
<p>When reordering opcodes like that, variable references and literals are ignored.
Because of that, the snippet <code class="docutils literal notranslate"><span class="pre">let</span> <span class="pre">x</span> <span class="pre">:=</span> <span class="pre">add(0,</span> <span class="pre">2)</span> <span class="pre">let</span> <span class="pre">y</span> <span class="pre">:=</span> <span class="pre">mul(x,</span> <span class="pre">3)</span></code> is
transformed to <code class="docutils literal notranslate"><span class="pre">let</span> <span class="pre">y</span> <span class="pre">:=</span> <span class="pre">mul(add(0,</span> <span class="pre">2),</span> <span class="pre">3)</span></code>, even though the <code class="docutils literal notranslate"><span class="pre">add</span></code> opcode
would be executed after the evaluation of the literal <code class="docutils literal notranslate"><span class="pre">3</span></code>.</p>
</section>
<section id="ssareverser">
<span id="ssa-reverser"></span><h5>SSAReverser<a class="headerlink" href="#ssareverser" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>This is a tiny step that helps in reversing the effects of the SSA transform
if it is combined with the Common Subexpression Eliminator and the
Unused Pruner.</p>
<p>The SSA form we generate is detrimental to code generation on the EVM and
WebAssembly alike because it generates many local variables. It would
be better to just re-use existing variables with assignments instead of
fresh variable declarations.</p>
<p>The SSA transform rewrites</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=yul&amp;version=0.8.15&amp;code=bGV0IGEgOj0gY2FsbGRhdGFsb2FkKDApCm1zdG9yZShhLCAxKQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-yul notranslate"><div class="highlight"><pre><span></span><span class="ow">let</span> <span class="nv">a</span> <span class="o">:=</span> <span class="nf">calldataload</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="nf">mstore</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>to</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=yul&amp;version=0.8.15&amp;code=bGV0IGFfMSA6PSBjYWxsZGF0YWxvYWQoMCkKbGV0IGEgOj0gYV8xCm1zdG9yZShhXzEsIDEpCmxldCBhXzIgOj0gY2FsbGRhdGFsb2FkKDB4MjApCmEgOj0gYV8y"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-yul notranslate"><div class="highlight"><pre><span></span><span class="ow">let</span> <span class="nv">a_1</span> <span class="o">:=</span> <span class="nf">calldataload</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="ow">let</span> <span class="nv">a</span> <span class="o">:=</span> <span class="n">a_1</span>
<span class="nf">mstore</span><span class="p">(</span><span class="n">a_1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="ow">let</span> <span class="nv">a_2</span> <span class="o">:=</span> <span class="nf">calldataload</span><span class="p">(</span><span class="mh">0x20</span><span class="p">)</span>
<span class="n">a</span> <span class="o">:=</span> <span class="n">a_2</span>
</pre></div>
</div>
<p>The problem is that instead of <code class="docutils literal notranslate"><span class="pre">a</span></code>, the variable <code class="docutils literal notranslate"><span class="pre">a_1</span></code> is used
whenever <code class="docutils literal notranslate"><span class="pre">a</span></code> was referenced. The SSA transform changes statements
of this form by just swapping out the declaration and the assignment. The above
snippet is turned into</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=yul&amp;version=0.8.15&amp;code=bGV0IGEgOj0gY2FsbGRhdGFsb2FkKDApCmxldCBhXzEgOj0gYQptc3RvcmUoYV8xLCAxKQphIDo9IGNhbGxkYXRhbG9hZCgweDIwKQpsZXQgYV8yIDo9IGE="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-yul notranslate"><div class="highlight"><pre><span></span><span class="ow">let</span> <span class="nv">a</span> <span class="o">:=</span> <span class="nf">calldataload</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="ow">let</span> <span class="nv">a_1</span> <span class="o">:=</span> <span class="n">a</span>
<span class="nf">mstore</span><span class="p">(</span><span class="n">a_1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">a</span> <span class="o">:=</span> <span class="nf">calldataload</span><span class="p">(</span><span class="mh">0x20</span><span class="p">)</span>
<span class="ow">let</span> <span class="nv">a_2</span> <span class="o">:=</span> <span class="n">a</span>
</pre></div>
</div>
<p>This is a very simple equivalence transform, but when we now run the
Common Subexpression Eliminator, it will replace all occurrences of <code class="docutils literal notranslate"><span class="pre">a_1</span></code>
by <code class="docutils literal notranslate"><span class="pre">a</span></code> (until <code class="docutils literal notranslate"><span class="pre">a</span></code> is re-assigned). The Unused Pruner will then
eliminate the variable <code class="docutils literal notranslate"><span class="pre">a_1</span></code> altogether and thus fully reverse the
SSA transform.</p>
</section>
<section id="stackcompressor">
<span id="stack-compressor"></span><h5>StackCompressor<a class="headerlink" href="#stackcompressor" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>One problem that makes code generation for the Ethereum Virtual Machine
hard is the fact that there is a hard limit of 16 slots for reaching
down the expression stack. This more or less translates to a limit
of 16 local variables. The stack compressor takes Yul code and
compiles it to EVM bytecode. Whenever the stack difference is too
large, it records the function this happened in.</p>
<p>For each function that caused such a problem, the Rematerialiser
is called with a special request to aggressively eliminate specific
variables sorted by the cost of their values.</p>
<p>On failure, this procedure is repeated multiple times.</p>
</section>
<section id="rematerialiser">
<span id="id4"></span><h5>Rematerialiser<a class="headerlink" href="#rematerialiser" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>The rematerialisation stage tries to replace variable references by the expression that
was last assigned to the variable. This is of course only beneficial if this expression
is comparatively cheap to evaluate. Furthermore, it is only semantically equivalent if
the value of the expression did not change between the point of assignment and the
point of use. The main benefit of this stage is that it can save stack slots if it
leads to a variable being eliminated completely (see below), but it can also
save a DUP opcode on the EVM if the expression is very cheap.</p>
<p>The Rematerialiser uses the Dataflow Analyzer to track the current values of variables,
which are always movable.
If the value is very cheap or the variable was explicitly requested to be eliminated,
the variable reference is replaced by its current value.</p>
</section>
<section id="forloopconditionoutofbody">
<span id="for-loop-condition-out-of-body"></span><h5>ForLoopConditionOutOfBody<a class="headerlink" href="#forloopconditionoutofbody" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>Reverses the transformation of ForLoopConditionIntoBody.</p>
<p>For any movable <code class="docutils literal notranslate"><span class="pre">c</span></code>, it turns</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>for { ... } 1 { ... } {
if iszero(c) { break }
...
}
</pre></div>
</div>
<p>into</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>for { ... } c { ... } {
...
}
</pre></div>
</div>
<p>and it turns</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>for { ... } 1 { ... } {
if c { break }
...
}
</pre></div>
</div>
<p>into</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>for { ... } iszero(c) { ... } {
...
}
</pre></div>
</div>
<p>The LiteralRematerialiser should be run before this step.</p>
</section>
</section>
<section id="webassembly-specific">
<h4>WebAssembly specific<a class="headerlink" href="#webassembly-specific" title="Permalink to this heading">ÔÉÅ</a></h4>
<section id="mainfunction">
<h5>MainFunction<a class="headerlink" href="#mainfunction" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>Changes the topmost block to be a function with a specific name (‚Äúmain‚Äù) which has no
inputs nor outputs.</p>
<p>Depends on the Function Grouper.</p>
</section>
</section>
</section>
</section>
<span id="document-metadata"></span><section id="contract-metadata">
<span id="metadata"></span><h2>Contract Metadata<a class="headerlink" href="#contract-metadata" title="Permalink to this heading">ÔÉÅ</a></h2>
<p id="index-0">The Solidity compiler automatically generates a JSON file, the contract
metadata, that contains information about the compiled contract. You can use
this file to query the compiler version, the sources used, the ABI and NatSpec
documentation to more safely interact with the contract and verify its source
code.</p>
<p>The compiler appends by default the IPFS hash of the metadata file to the end
of the bytecode (for details, see below) of each contract, so that you can
retrieve the file in an authenticated way without having to resort to a
centralized data provider. The other available options are the Swarm hash and
not appending the metadata hash to the bytecode.  These can be configured via
the <a class="reference internal" href="index.html#compiler-api"><span class="std std-ref">Standard JSON Interface</span></a>.</p>
<p>You have to publish the metadata file to IPFS, Swarm, or another service so
that others can access it. You create the file by using the <code class="docutils literal notranslate"><span class="pre">solc</span> <span class="pre">--metadata</span></code>
command that generates a file called <code class="docutils literal notranslate"><span class="pre">ContractName_meta.json</span></code>. It contains
IPFS and Swarm references to the source code, so you have to upload all source
files and the metadata file.</p>
<p>The metadata file has the following format. The example below is presented in a
human-readable way. Properly formatted metadata should use quotes correctly,
reduce whitespace to a minimum and sort the keys of all objects to arrive at a
unique formatting. Comments are not permitted and used here only for
explanatory purposes.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="c1">// Required: The version of the metadata format</span><span class="w"></span>
<span class="w">  </span><span class="s2">&quot;version&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="c1">// Required: Source code language, basically selects a &quot;sub-version&quot;</span><span class="w"></span>
<span class="w">  </span><span class="c1">// of the specification</span><span class="w"></span>
<span class="w">  </span><span class="s2">&quot;language&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Solidity&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="c1">// Required: Details about the compiler, contents are specific</span><span class="w"></span>
<span class="w">  </span><span class="c1">// to the language.</span><span class="w"></span>
<span class="w">  </span><span class="s2">&quot;compiler&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Required for Solidity: Version of the compiler</span><span class="w"></span>
<span class="w">    </span><span class="s2">&quot;version&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.4.6+commit.2dabbdf0.Emscripten.clang&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Optional: Hash of the compiler binary which produced this output</span><span class="w"></span>
<span class="w">    </span><span class="s2">&quot;keccak256&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0x123...&quot;</span><span class="w"></span>
<span class="w">  </span><span class="p">},</span><span class="w"></span>
<span class="w">  </span><span class="c1">// Required: Compilation source files/source units, keys are file names</span><span class="w"></span>
<span class="w">  </span><span class="s2">&quot;sources&quot;</span><span class="o">:</span><span class="w"></span>
<span class="w">  </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="s2">&quot;myFile.sol&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Required: keccak256 hash of the source file</span><span class="w"></span>
<span class="w">      </span><span class="s2">&quot;keccak256&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0x123...&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Required (unless &quot;content&quot; is used, see below): Sorted URL(s)</span><span class="w"></span>
<span class="w">      </span><span class="c1">// to the source file, protocol is more or less arbitrary, but a</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Swarm URL is recommended</span><span class="w"></span>
<span class="w">      </span><span class="s2">&quot;urls&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">&quot;bzzr://56ab...&quot;</span><span class="w"> </span><span class="p">],</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Optional: SPDX license identifier as given in the source file</span><span class="w"></span>
<span class="w">      </span><span class="s2">&quot;license&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;MIT&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="s2">&quot;destructible&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Required: keccak256 hash of the source file</span><span class="w"></span>
<span class="w">      </span><span class="s2">&quot;keccak256&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0x234...&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Required (unless &quot;url&quot; is used): literal contents of the source file</span><span class="w"></span>
<span class="w">      </span><span class="s2">&quot;content&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;contract destructible is owned { function destroy() { if (msg.sender == owner) selfdestruct(owner); } }&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">},</span><span class="w"></span>
<span class="w">  </span><span class="c1">// Required: Compiler settings</span><span class="w"></span>
<span class="w">  </span><span class="s2">&quot;settings&quot;</span><span class="o">:</span><span class="w"></span>
<span class="w">  </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Required for Solidity: Sorted list of remappings</span><span class="w"></span>
<span class="w">    </span><span class="s2">&quot;remappings&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">&quot;:g=/dir&quot;</span><span class="w"> </span><span class="p">],</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Optional: Optimizer settings. The fields &quot;enabled&quot; and &quot;runs&quot; are deprecated</span><span class="w"></span>
<span class="w">    </span><span class="c1">// and are only given for backwards-compatibility.</span><span class="w"></span>
<span class="w">    </span><span class="s2">&quot;optimizer&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="s2">&quot;enabled&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="s2">&quot;runs&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">500</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="s2">&quot;details&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// peephole defaults to &quot;true&quot;</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;peephole&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="c1">// inliner defaults to &quot;true&quot;</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;inliner&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="c1">// jumpdestRemover defaults to &quot;true&quot;</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;jumpdestRemover&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;orderLiterals&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;deduplicate&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;cse&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;constantOptimizer&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;yul&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Optional: Only present if &quot;yul&quot; is &quot;true&quot;</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;yulDetails&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="s2">&quot;stackAllocation&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="s2">&quot;optimizerSteps&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;dhfoDgvulfnTUtnIf...&quot;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="s2">&quot;metadata&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Reflects the setting used in the input json, defaults to false</span><span class="w"></span>
<span class="w">      </span><span class="s2">&quot;useLiteralContent&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="c1">// Reflects the setting used in the input json, defaults to &quot;ipfs&quot;</span><span class="w"></span>
<span class="w">      </span><span class="s2">&quot;bytecodeHash&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;ipfs&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Required for Solidity: File and name of the contract or library this</span><span class="w"></span>
<span class="w">    </span><span class="c1">// metadata is created for.</span><span class="w"></span>
<span class="w">    </span><span class="s2">&quot;compilationTarget&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="s2">&quot;myFile.sol&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;MyContract&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Required for Solidity: Addresses for libraries used</span><span class="w"></span>
<span class="w">    </span><span class="s2">&quot;libraries&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="s2">&quot;MyLib&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0x123123...&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">},</span><span class="w"></span>
<span class="w">  </span><span class="c1">// Required: Generated information about the contract.</span><span class="w"></span>
<span class="w">  </span><span class="s2">&quot;output&quot;</span><span class="o">:</span><span class="w"></span>
<span class="w">  </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Required: ABI definition of the contract</span><span class="w"></span>
<span class="w">    </span><span class="s2">&quot;abi&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="cm">/* ... */</span><span class="p">],</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Required: NatSpec user documentation of the contract</span><span class="w"></span>
<span class="w">    </span><span class="s2">&quot;userdoc&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="cm">/* ... */</span><span class="p">],</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Required: NatSpec developer documentation of the contract</span><span class="w"></span>
<span class="w">    </span><span class="s2">&quot;devdoc&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="cm">/* ... */</span><span class="p">]</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Since the bytecode of the resulting contract contains the metadata hash by default, any
change to the metadata might result in a change of the bytecode. This includes
changes to a filename or path, and since the metadata includes a hash of all the
sources used, a single whitespace change results in different metadata, and
different bytecode.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The ABI definition above has no fixed order. It can change with compiler versions.
Starting from Solidity version 0.5.12, though, the array maintains a certain
order.</p>
</div>
<section id="encoding-of-the-metadata-hash-in-the-bytecode">
<span id="id1"></span><h3>Encoding of the Metadata Hash in the Bytecode<a class="headerlink" href="#encoding-of-the-metadata-hash-in-the-bytecode" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Because we might support other ways to retrieve the metadata file in the future,
the mapping <code class="docutils literal notranslate"><span class="pre">{&quot;ipfs&quot;:</span> <span class="pre">&lt;IPFS</span> <span class="pre">hash&gt;,</span> <span class="pre">&quot;solc&quot;:</span> <span class="pre">&lt;compiler</span> <span class="pre">version&gt;}</span></code> is stored
<a class="reference external" href="https://tools.ietf.org/html/rfc7049">CBOR</a>-encoded. Since the mapping might
contain more keys (see below) and the beginning of that
encoding is not easy to find, its length is added in a two-byte big-endian
encoding. The current version of the Solidity compiler usually adds the following
to the end of the deployed bytecode</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>0xa2
0x64 &#39;i&#39; &#39;p&#39; &#39;f&#39; &#39;s&#39; 0x58 0x22 &lt;34 bytes IPFS hash&gt;
0x64 &#39;s&#39; &#39;o&#39; &#39;l&#39; &#39;c&#39; 0x43 &lt;3 byte version encoding&gt;
0x00 0x33
</pre></div>
</div>
<p>So in order to retrieve the data, the end of the deployed bytecode can be checked
to match that pattern and use the IPFS hash to retrieve the file.</p>
<p>Whereas release builds of solc use a 3 byte encoding of the version as shown
above (one byte each for major, minor and patch version number), prerelease builds
will instead use a complete version string including commit hash and build date.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The CBOR mapping can also contain other keys, so it is better to fully
decode the data instead of relying on it starting with <code class="docutils literal notranslate"><span class="pre">0xa264</span></code>.
For example, if any experimental features that affect code generation
are used, the mapping will also contain <code class="docutils literal notranslate"><span class="pre">&quot;experimental&quot;:</span> <span class="pre">true</span></code>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The compiler currently uses the IPFS hash of the metadata by default, but
it may also use the bzzr1 hash or some other hash in the future, so do
not rely on this sequence to start with <code class="docutils literal notranslate"><span class="pre">0xa2</span> <span class="pre">0x64</span> <span class="pre">'i'</span> <span class="pre">'p'</span> <span class="pre">'f'</span> <span class="pre">'s'</span></code>.  We
might also add additional data to this CBOR structure, so the best option
is to use a proper CBOR parser.</p>
</div>
</section>
<section id="usage-for-automatic-interface-generation-and-natspec">
<h3>Usage for Automatic Interface Generation and NatSpec<a class="headerlink" href="#usage-for-automatic-interface-generation-and-natspec" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>The metadata is used in the following way: A component that wants to interact
with a contract (e.g. Mist or any wallet) retrieves the code of the contract,
from that the IPFS/Swarm hash of a file which is then retrieved.  That file
is JSON-decoded into a structure like above.</p>
<p>The component can then use the ABI to automatically generate a rudimentary
user interface for the contract.</p>
<p>Furthermore, the wallet can use the NatSpec user documentation to display a confirmation message to the user
whenever they interact with the contract, together with requesting
authorization for the transaction signature.</p>
<p>For additional information, read <a class="reference internal" href="index.html#document-natspec-format"><span class="doc">Ethereum Natural Language Specification (NatSpec) format</span></a>.</p>
</section>
<section id="usage-for-source-code-verification">
<h3>Usage for Source Code Verification<a class="headerlink" href="#usage-for-source-code-verification" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>In order to verify the compilation, sources can be retrieved from IPFS/Swarm
via the link in the metadata file.
The compiler of the correct version (which is checked to be part of the ‚Äúofficial‚Äù compilers)
is invoked on that input with the specified settings. The resulting
bytecode is compared to the data of the creation transaction or <code class="docutils literal notranslate"><span class="pre">CREATE</span></code> opcode data.
This automatically verifies the metadata since its hash is part of the bytecode.
Excess data corresponds to the constructor input data, which should be decoded
according to the interface and presented to the user.</p>
<p>In the repository <a class="reference external" href="https://github.com/ethereum/sourcify">sourcify</a>
(<a class="reference external" href="https://www.npmjs.com/package/source-verify">npm package</a>) you can see
example code that shows how to use this feature.</p>
</section>
</section>
<span id="document-abi-spec"></span><section id="contract-abi-specification">
<span id="abi"></span><span id="index-0"></span><h2>Contract ABI Specification<a class="headerlink" href="#contract-abi-specification" title="Permalink to this heading">ÔÉÅ</a></h2>
<section id="basic-design">
<h3>Basic Design<a class="headerlink" href="#basic-design" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>The Contract Application Binary Interface (ABI) is the standard way to interact with contracts in the Ethereum ecosystem, both
from outside the blockchain and for contract-to-contract interaction. Data is encoded according to its type,
as described in this specification. The encoding is not self describing and thus requires a schema in order to decode.</p>
<p>We assume the interface functions of a contract are strongly typed, known at compilation time and static.
We assume that all contracts will have the interface definitions of any contracts they call available at compile-time.</p>
<p>This specification does not address contracts whose interface is dynamic or otherwise known only at run-time.</p>
<span class="target" id="abi-function-selector"></span></section>
<section id="function-selector">
<span id="index-1"></span><h3>Function Selector<a class="headerlink" href="#function-selector" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>The first four bytes of the call data for a function call specifies the function to be called. It is the
first (left, high-order in big-endian) four bytes of the Keccak-256 hash of the signature of
the function. The signature is defined as the canonical expression of the basic prototype without data
location specifier, i.e.
the function name with the parenthesised list of parameter types. Parameter types are split by a single
comma - no spaces are used.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The return type of a function is not part of this signature. In
<a class="reference internal" href="index.html#overload-function"><span class="std std-ref">Solidity‚Äôs function overloading</span></a> return types are not considered.
The reason is to keep function call resolution context-independent.
The <a class="reference internal" href="#abi-json"><span class="std std-ref">JSON description of the ABI</span></a> however contains both inputs and outputs.</p>
</div>
</section>
<section id="argument-encoding">
<h3>Argument Encoding<a class="headerlink" href="#argument-encoding" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Starting from the fifth byte, the encoded arguments follow. This encoding is also used in
other places, e.g. the return values and also event arguments are encoded in the same way,
without the four bytes specifying the function.</p>
</section>
<section id="types">
<h3>Types<a class="headerlink" href="#types" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>The following elementary types exist:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">uint&lt;M&gt;</span></code>: unsigned integer type of <code class="docutils literal notranslate"><span class="pre">M</span></code> bits, <code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">&lt;</span> <span class="pre">M</span> <span class="pre">&lt;=</span> <span class="pre">256</span></code>, <code class="docutils literal notranslate"><span class="pre">M</span> <span class="pre">%</span> <span class="pre">8</span> <span class="pre">==</span> <span class="pre">0</span></code>. e.g. <code class="docutils literal notranslate"><span class="pre">uint32</span></code>, <code class="docutils literal notranslate"><span class="pre">uint8</span></code>, <code class="docutils literal notranslate"><span class="pre">uint256</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">int&lt;M&gt;</span></code>: two‚Äôs complement signed integer type of <code class="docutils literal notranslate"><span class="pre">M</span></code> bits, <code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">&lt;</span> <span class="pre">M</span> <span class="pre">&lt;=</span> <span class="pre">256</span></code>, <code class="docutils literal notranslate"><span class="pre">M</span> <span class="pre">%</span> <span class="pre">8</span> <span class="pre">==</span> <span class="pre">0</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">address</span></code>: equivalent to <code class="docutils literal notranslate"><span class="pre">uint160</span></code>, except for the assumed interpretation and language typing.
For computing the function selector, <code class="docutils literal notranslate"><span class="pre">address</span></code> is used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">uint</span></code>, <code class="docutils literal notranslate"><span class="pre">int</span></code>: synonyms for <code class="docutils literal notranslate"><span class="pre">uint256</span></code>, <code class="docutils literal notranslate"><span class="pre">int256</span></code> respectively. For computing the function
selector, <code class="docutils literal notranslate"><span class="pre">uint256</span></code> and <code class="docutils literal notranslate"><span class="pre">int256</span></code> have to be used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bool</span></code>: equivalent to <code class="docutils literal notranslate"><span class="pre">uint8</span></code> restricted to the values 0 and 1. For computing the function selector, <code class="docutils literal notranslate"><span class="pre">bool</span></code> is used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fixed&lt;M&gt;x&lt;N&gt;</span></code>: signed fixed-point decimal number of <code class="docutils literal notranslate"><span class="pre">M</span></code> bits, <code class="docutils literal notranslate"><span class="pre">8</span> <span class="pre">&lt;=</span> <span class="pre">M</span> <span class="pre">&lt;=</span> <span class="pre">256</span></code>,
<code class="docutils literal notranslate"><span class="pre">M</span> <span class="pre">%</span> <span class="pre">8</span> <span class="pre">==</span> <span class="pre">0</span></code>, and <code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">&lt;</span> <span class="pre">N</span> <span class="pre">&lt;=</span> <span class="pre">80</span></code>, which denotes the value <code class="docutils literal notranslate"><span class="pre">v</span></code> as <code class="docutils literal notranslate"><span class="pre">v</span> <span class="pre">/</span> <span class="pre">(10</span> <span class="pre">**</span> <span class="pre">N)</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ufixed&lt;M&gt;x&lt;N&gt;</span></code>: unsigned variant of <code class="docutils literal notranslate"><span class="pre">fixed&lt;M&gt;x&lt;N&gt;</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fixed</span></code>, <code class="docutils literal notranslate"><span class="pre">ufixed</span></code>: synonyms for <code class="docutils literal notranslate"><span class="pre">fixed128x18</span></code>, <code class="docutils literal notranslate"><span class="pre">ufixed128x18</span></code> respectively. For
computing the function selector, <code class="docutils literal notranslate"><span class="pre">fixed128x18</span></code> and <code class="docutils literal notranslate"><span class="pre">ufixed128x18</span></code> have to be used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bytes&lt;M&gt;</span></code>: binary type of <code class="docutils literal notranslate"><span class="pre">M</span></code> bytes, <code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">&lt;</span> <span class="pre">M</span> <span class="pre">&lt;=</span> <span class="pre">32</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">function</span></code>: an address (20 bytes) followed by a function selector (4 bytes). Encoded identical to <code class="docutils literal notranslate"><span class="pre">bytes24</span></code>.</p></li>
</ul>
<p>The following (fixed-size) array type exists:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;type&gt;[M]</span></code>: a fixed-length array of <code class="docutils literal notranslate"><span class="pre">M</span></code> elements, <code class="docutils literal notranslate"><span class="pre">M</span> <span class="pre">&gt;=</span> <span class="pre">0</span></code>, of the given type.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>While this ABI specification can express fixed-length arrays with zero elements, they‚Äôre not supported by the compiler.</p>
</div>
</li>
</ul>
<p>The following non-fixed-size types exist:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">bytes</span></code>: dynamic sized byte sequence.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">string</span></code>: dynamic sized unicode string assumed to be UTF-8 encoded.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;type&gt;[]</span></code>: a variable-length array of elements of the given type.</p></li>
</ul>
<p>Types can be combined to a tuple by enclosing them inside parentheses, separated by commas:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">(T1,T2,...,Tn)</span></code>: tuple consisting of the types <code class="docutils literal notranslate"><span class="pre">T1</span></code>, ‚Ä¶, <code class="docutils literal notranslate"><span class="pre">Tn</span></code>, <code class="docutils literal notranslate"><span class="pre">n</span> <span class="pre">&gt;=</span> <span class="pre">0</span></code></p></li>
</ul>
<p>It is possible to form tuples of tuples, arrays of tuples and so on. It is also possible to form zero-tuples (where <code class="docutils literal notranslate"><span class="pre">n</span> <span class="pre">==</span> <span class="pre">0</span></code>).</p>
<section id="mapping-solidity-to-abi-types">
<h4>Mapping Solidity to ABI types<a class="headerlink" href="#mapping-solidity-to-abi-types" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Solidity supports all the types presented above with the same names with the
exception of tuples. On the other hand, some Solidity types are not supported
by the ABI. The following table shows on the left column Solidity types that
are not part of the ABI, and on the right column the ABI types that represent
them.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 29%" />
<col style="width: 71%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Solidity</p></th>
<th class="head"><p>ABI</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference internal" href="index.html#address"><span class="std std-ref">address payable</span></a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">address</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="index.html#contracts"><span class="std std-ref">contract</span></a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">address</span></code></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="index.html#enums"><span class="std std-ref">enum</span></a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">uint8</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="index.html#user-defined-value-types"><span class="std std-ref">user defined value types</span></a></p></td>
<td><p>its underlying value type</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="index.html#structs"><span class="std std-ref">struct</span></a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">tuple</span></code></p></td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Before version <code class="docutils literal notranslate"><span class="pre">0.8.0</span></code> enums could have more than 256 members and were represented by the
smallest integer type just big enough to hold the value of any member.</p>
</div>
</section>
</section>
<section id="design-criteria-for-the-encoding">
<h3>Design Criteria for the Encoding<a class="headerlink" href="#design-criteria-for-the-encoding" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>The encoding is designed to have the following properties, which are especially useful if some arguments are nested arrays:</p>
<ol class="arabic simple">
<li><p>The number of reads necessary to access a value is at most the depth of the value
inside the argument array structure, i.e. four reads are needed to retrieve <code class="docutils literal notranslate"><span class="pre">a_i[k][l][r]</span></code>. In a
previous version of the ABI, the number of reads scaled linearly with the total number of dynamic
parameters in the worst case.</p></li>
<li><p>The data of a variable or array element is not interleaved with other data and it is
relocatable, i.e. it only uses relative ‚Äúaddresses‚Äù.</p></li>
</ol>
</section>
<section id="formal-specification-of-the-encoding">
<h3>Formal Specification of the Encoding<a class="headerlink" href="#formal-specification-of-the-encoding" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>We distinguish static and dynamic types. Static types are encoded in-place and dynamic types are
encoded at a separately allocated location after the current block.</p>
<p><strong>Definition:</strong> The following types are called ‚Äúdynamic‚Äù:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">bytes</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">string</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">T[]</span></code> for any <code class="docutils literal notranslate"><span class="pre">T</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">T[k]</span></code> for any dynamic <code class="docutils literal notranslate"><span class="pre">T</span></code> and any <code class="docutils literal notranslate"><span class="pre">k</span> <span class="pre">&gt;=</span> <span class="pre">0</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">(T1,...,Tk)</span></code> if <code class="docutils literal notranslate"><span class="pre">Ti</span></code> is dynamic for some <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">&lt;=</span> <span class="pre">i</span> <span class="pre">&lt;=</span> <span class="pre">k</span></code></p></li>
</ul>
<p>All other types are called ‚Äústatic‚Äù.</p>
<p><strong>Definition:</strong> <code class="docutils literal notranslate"><span class="pre">len(a)</span></code> is the number of bytes in a binary string <code class="docutils literal notranslate"><span class="pre">a</span></code>.
The type of <code class="docutils literal notranslate"><span class="pre">len(a)</span></code> is assumed to be <code class="docutils literal notranslate"><span class="pre">uint256</span></code>.</p>
<p>We define <code class="docutils literal notranslate"><span class="pre">enc</span></code>, the actual encoding, as a mapping of values of the ABI types to binary strings such
that <code class="docutils literal notranslate"><span class="pre">len(enc(X))</span></code> depends on the value of <code class="docutils literal notranslate"><span class="pre">X</span></code> if and only if the type of <code class="docutils literal notranslate"><span class="pre">X</span></code> is dynamic.</p>
<p><strong>Definition:</strong> For any ABI value <code class="docutils literal notranslate"><span class="pre">X</span></code>, we recursively define <code class="docutils literal notranslate"><span class="pre">enc(X)</span></code>, depending
on the type of <code class="docutils literal notranslate"><span class="pre">X</span></code> being</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">(T1,...,Tk)</span></code> for <code class="docutils literal notranslate"><span class="pre">k</span> <span class="pre">&gt;=</span> <span class="pre">0</span></code> and any types <code class="docutils literal notranslate"><span class="pre">T1</span></code>, ‚Ä¶, <code class="docutils literal notranslate"><span class="pre">Tk</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">enc(X)</span> <span class="pre">=</span> <span class="pre">head(X(1))</span> <span class="pre">...</span> <span class="pre">head(X(k))</span> <span class="pre">tail(X(1))</span> <span class="pre">...</span> <span class="pre">tail(X(k))</span></code></p>
<p>where <code class="docutils literal notranslate"><span class="pre">X</span> <span class="pre">=</span> <span class="pre">(X(1),</span> <span class="pre">...,</span> <span class="pre">X(k))</span></code> and
<code class="docutils literal notranslate"><span class="pre">head</span></code> and <code class="docutils literal notranslate"><span class="pre">tail</span></code> are defined for <code class="docutils literal notranslate"><span class="pre">Ti</span></code> as follows:</p>
<p>if <code class="docutils literal notranslate"><span class="pre">Ti</span></code> is static:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">head(X(i))</span> <span class="pre">=</span> <span class="pre">enc(X(i))</span></code> and <code class="docutils literal notranslate"><span class="pre">tail(X(i))</span> <span class="pre">=</span> <span class="pre">&quot;&quot;</span></code> (the empty string)</p>
</div></blockquote>
<p>otherwise, i.e. if <code class="docutils literal notranslate"><span class="pre">Ti</span></code> is dynamic:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">head(X(i))</span> <span class="pre">=</span> <span class="pre">enc(len(</span> <span class="pre">head(X(1))</span> <span class="pre">...</span> <span class="pre">head(X(k))</span> <span class="pre">tail(X(1))</span> <span class="pre">...</span> <span class="pre">tail(X(i-1))</span> <span class="pre">))</span></code>
<code class="docutils literal notranslate"><span class="pre">tail(X(i))</span> <span class="pre">=</span> <span class="pre">enc(X(i))</span></code></p>
</div></blockquote>
<p>Note that in the dynamic case, <code class="docutils literal notranslate"><span class="pre">head(X(i))</span></code> is well-defined since the lengths of
the head parts only depend on the types and not the values. The value of <code class="docutils literal notranslate"><span class="pre">head(X(i))</span></code> is the offset
of the beginning of <code class="docutils literal notranslate"><span class="pre">tail(X(i))</span></code> relative to the start of <code class="docutils literal notranslate"><span class="pre">enc(X)</span></code>.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">T[k]</span></code> for any <code class="docutils literal notranslate"><span class="pre">T</span></code> and <code class="docutils literal notranslate"><span class="pre">k</span></code>:</p>
<p><code class="docutils literal notranslate"><span class="pre">enc(X)</span> <span class="pre">=</span> <span class="pre">enc((X[0],</span> <span class="pre">...,</span> <span class="pre">X[k-1]))</span></code></p>
<p>i.e. it is encoded as if it were a tuple with <code class="docutils literal notranslate"><span class="pre">k</span></code> elements
of the same type.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">T[]</span></code> where <code class="docutils literal notranslate"><span class="pre">X</span></code> has <code class="docutils literal notranslate"><span class="pre">k</span></code> elements (<code class="docutils literal notranslate"><span class="pre">k</span></code> is assumed to be of type <code class="docutils literal notranslate"><span class="pre">uint256</span></code>):</p>
<p><code class="docutils literal notranslate"><span class="pre">enc(X)</span> <span class="pre">=</span> <span class="pre">enc(k)</span> <span class="pre">enc([X[0],</span> <span class="pre">...,</span> <span class="pre">X[k-1]])</span></code></p>
<p>i.e. it is encoded as if it were an array of static size <code class="docutils literal notranslate"><span class="pre">k</span></code>, prefixed with
the number of elements.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">bytes</span></code>, of length <code class="docutils literal notranslate"><span class="pre">k</span></code> (which is assumed to be of type <code class="docutils literal notranslate"><span class="pre">uint256</span></code>):</p>
<p><code class="docutils literal notranslate"><span class="pre">enc(X)</span> <span class="pre">=</span> <span class="pre">enc(k)</span> <span class="pre">pad_right(X)</span></code>, i.e. the number of bytes is encoded as a
<code class="docutils literal notranslate"><span class="pre">uint256</span></code> followed by the actual value of <code class="docutils literal notranslate"><span class="pre">X</span></code> as a byte sequence, followed by
the minimum number of zero-bytes such that <code class="docutils literal notranslate"><span class="pre">len(enc(X))</span></code> is a multiple of 32.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">string</span></code>:</p>
<p><code class="docutils literal notranslate"><span class="pre">enc(X)</span> <span class="pre">=</span> <span class="pre">enc(enc_utf8(X))</span></code>, i.e. <code class="docutils literal notranslate"><span class="pre">X</span></code> is UTF-8 encoded and this value is interpreted
as of <code class="docutils literal notranslate"><span class="pre">bytes</span></code> type and encoded further. Note that the length used in this subsequent
encoding is the number of bytes of the UTF-8 encoded string, not its number of characters.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">uint&lt;M&gt;</span></code>: <code class="docutils literal notranslate"><span class="pre">enc(X)</span></code> is the big-endian encoding of <code class="docutils literal notranslate"><span class="pre">X</span></code>, padded on the higher-order
(left) side with zero-bytes such that the length is 32 bytes.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">address</span></code>: as in the <code class="docutils literal notranslate"><span class="pre">uint160</span></code> case</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">int&lt;M&gt;</span></code>: <code class="docutils literal notranslate"><span class="pre">enc(X)</span></code> is the big-endian two‚Äôs complement encoding of <code class="docutils literal notranslate"><span class="pre">X</span></code>, padded on the higher-order (left) side with <code class="docutils literal notranslate"><span class="pre">0xff</span></code> bytes for negative <code class="docutils literal notranslate"><span class="pre">X</span></code> and with zero-bytes for non-negative <code class="docutils literal notranslate"><span class="pre">X</span></code> such that the length is 32 bytes.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bool</span></code>: as in the <code class="docutils literal notranslate"><span class="pre">uint8</span></code> case, where <code class="docutils literal notranslate"><span class="pre">1</span></code> is used for <code class="docutils literal notranslate"><span class="pre">true</span></code> and <code class="docutils literal notranslate"><span class="pre">0</span></code> for <code class="docutils literal notranslate"><span class="pre">false</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fixed&lt;M&gt;x&lt;N&gt;</span></code>: <code class="docutils literal notranslate"><span class="pre">enc(X)</span></code> is <code class="docutils literal notranslate"><span class="pre">enc(X</span> <span class="pre">*</span> <span class="pre">10**N)</span></code> where <code class="docutils literal notranslate"><span class="pre">X</span> <span class="pre">*</span> <span class="pre">10**N</span></code> is interpreted as a <code class="docutils literal notranslate"><span class="pre">int256</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fixed</span></code>: as in the <code class="docutils literal notranslate"><span class="pre">fixed128x18</span></code> case</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ufixed&lt;M&gt;x&lt;N&gt;</span></code>: <code class="docutils literal notranslate"><span class="pre">enc(X)</span></code> is <code class="docutils literal notranslate"><span class="pre">enc(X</span> <span class="pre">*</span> <span class="pre">10**N)</span></code> where <code class="docutils literal notranslate"><span class="pre">X</span> <span class="pre">*</span> <span class="pre">10**N</span></code> is interpreted as a <code class="docutils literal notranslate"><span class="pre">uint256</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ufixed</span></code>: as in the <code class="docutils literal notranslate"><span class="pre">ufixed128x18</span></code> case</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bytes&lt;M&gt;</span></code>: <code class="docutils literal notranslate"><span class="pre">enc(X)</span></code> is the sequence of bytes in <code class="docutils literal notranslate"><span class="pre">X</span></code> padded with trailing zero-bytes to a length of 32 bytes.</p></li>
</ul>
<p>Note that for any <code class="docutils literal notranslate"><span class="pre">X</span></code>, <code class="docutils literal notranslate"><span class="pre">len(enc(X))</span></code> is a multiple of 32.</p>
</section>
<section id="function-selector-and-argument-encoding">
<h3>Function Selector and Argument Encoding<a class="headerlink" href="#function-selector-and-argument-encoding" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>All in all, a call to the function <code class="docutils literal notranslate"><span class="pre">f</span></code> with parameters <code class="docutils literal notranslate"><span class="pre">a_1,</span> <span class="pre">...,</span> <span class="pre">a_n</span></code> is encoded as</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">function_selector(f)</span> <span class="pre">enc((a_1,</span> <span class="pre">...,</span> <span class="pre">a_n))</span></code></p>
</div></blockquote>
<p>and the return values <code class="docutils literal notranslate"><span class="pre">v_1,</span> <span class="pre">...,</span> <span class="pre">v_k</span></code> of <code class="docutils literal notranslate"><span class="pre">f</span></code> are encoded as</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">enc((v_1,</span> <span class="pre">...,</span> <span class="pre">v_k))</span></code></p>
</div></blockquote>
<p>i.e. the values are combined into a tuple and encoded.</p>
</section>
<section id="examples">
<h3>Examples<a class="headerlink" href="#examples" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Given the contract:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC40LjE2IDwwLjkuMDsKCmNvbnRyYWN0IEZvbyB7CiAgICBmdW5jdGlvbiBiYXIoYnl0ZXMzWzJdIG1lbW9yeSkgcHVibGljIHB1cmUge30KICAgIGZ1bmN0aW9uIGJheih1aW50MzIgeCwgYm9vbCB5KSBwdWJsaWMgcHVyZSByZXR1cm5zIChib29sIHIpIHsgciA9IHggPiAzMiB8fCB5OyB9CiAgICBmdW5jdGlvbiBzYW0oYnl0ZXMgbWVtb3J5LCBib29sLCB1aW50W10gbWVtb3J5KSBwdWJsaWMgcHVyZSB7fQp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.4.16</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Foo</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">bar</span><span class="p">(</span>bytes3<span class="p">[</span><span class="m m-Decimal">2</span><span class="p">]</span><span class="w"> </span><span class="kt">memory</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>pure<span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">baz</span><span class="p">(</span><span class="kt">uint32</span><span class="w"> </span><span class="nv">x</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nv">y</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="nv">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>r<span class="w"> </span><span class="o">=</span><span class="w"> </span>x<span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m m-Decimal">32</span><span class="w"> </span><span class="err">||</span><span class="w"> </span>y<span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">sam</span><span class="p">(</span><span class="kt">bytes</span><span class="w"> </span><span class="nv">memory</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>pure<span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Thus for our <code class="docutils literal notranslate"><span class="pre">Foo</span></code> example if we wanted to call <code class="docutils literal notranslate"><span class="pre">baz</span></code> with the parameters <code class="docutils literal notranslate"><span class="pre">69</span></code> and
<code class="docutils literal notranslate"><span class="pre">true</span></code>, we would pass 68 bytes total, which can be broken down into:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0xcdcd77c0</span></code>: the Method ID. This is derived as the first 4 bytes of the Keccak hash of
the ASCII form of the signature <code class="docutils literal notranslate"><span class="pre">baz(uint32,bool)</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000045</span></code>: the first parameter,
a uint32 value <code class="docutils literal notranslate"><span class="pre">69</span></code> padded to 32 bytes</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000001</span></code>: the second parameter - boolean
<code class="docutils literal notranslate"><span class="pre">true</span></code>, padded to 32 bytes</p></li>
</ul>
<p>In total:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>0xcdcd77c000000000000000000000000000000000000000000000000000000000000000450000000000000000000000000000000000000000000000000000000000000001
</pre></div>
</div>
<p>It returns a single <code class="docutils literal notranslate"><span class="pre">bool</span></code>. If, for example, it were to return <code class="docutils literal notranslate"><span class="pre">false</span></code>, its output would be
the single byte array <code class="docutils literal notranslate"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000000</span></code>, a single bool.</p>
<p>If we wanted to call <code class="docutils literal notranslate"><span class="pre">bar</span></code> with the argument <code class="docutils literal notranslate"><span class="pre">[&quot;abc&quot;,</span> <span class="pre">&quot;def&quot;]</span></code>, we would pass 68 bytes total, broken down into:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0xfce353f6</span></code>: the Method ID. This is derived from the signature <code class="docutils literal notranslate"><span class="pre">bar(bytes3[2])</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x6162630000000000000000000000000000000000000000000000000000000000</span></code>: the first part of the first
parameter, a <code class="docutils literal notranslate"><span class="pre">bytes3</span></code> value <code class="docutils literal notranslate"><span class="pre">&quot;abc&quot;</span></code> (left-aligned).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x6465660000000000000000000000000000000000000000000000000000000000</span></code>: the second part of the first
parameter, a <code class="docutils literal notranslate"><span class="pre">bytes3</span></code> value <code class="docutils literal notranslate"><span class="pre">&quot;def&quot;</span></code> (left-aligned).</p></li>
</ul>
<p>In total:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>0xfce353f661626300000000000000000000000000000000000000000000000000000000006465660000000000000000000000000000000000000000000000000000000000
</pre></div>
</div>
<p>If we wanted to call <code class="docutils literal notranslate"><span class="pre">sam</span></code> with the arguments <code class="docutils literal notranslate"><span class="pre">&quot;dave&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">true</span></code> and <code class="docutils literal notranslate"><span class="pre">[1,2,3]</span></code>, we would
pass 292 bytes total, broken down into:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0xa5643bf2</span></code>: the Method ID. This is derived from the signature <code class="docutils literal notranslate"><span class="pre">sam(bytes,bool,uint256[])</span></code>. Note that <code class="docutils literal notranslate"><span class="pre">uint</span></code> is replaced with its canonical representation <code class="docutils literal notranslate"><span class="pre">uint256</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000060</span></code>: the location of the data part of the first parameter (dynamic type), measured in bytes from the start of the arguments block. In this case, <code class="docutils literal notranslate"><span class="pre">0x60</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000001</span></code>: the second parameter: boolean true.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x00000000000000000000000000000000000000000000000000000000000000a0</span></code>: the location of the data part of the third parameter (dynamic type), measured in bytes. In this case, <code class="docutils literal notranslate"><span class="pre">0xa0</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000004</span></code>: the data part of the first argument, it starts with the length of the byte array in elements, in this case, 4.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x6461766500000000000000000000000000000000000000000000000000000000</span></code>: the contents of the first argument: the UTF-8 (equal to ASCII in this case) encoding of <code class="docutils literal notranslate"><span class="pre">&quot;dave&quot;</span></code>, padded on the right to 32 bytes.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000003</span></code>: the data part of the third argument, it starts with the length of the array in elements, in this case, 3.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000001</span></code>: the first entry of the third parameter.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000002</span></code>: the second entry of the third parameter.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000003</span></code>: the third entry of the third parameter.</p></li>
</ul>
<p>In total:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>0xa5643bf20000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000000464617665000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000003
</pre></div>
</div>
</section>
<section id="use-of-dynamic-types">
<h3>Use of Dynamic Types<a class="headerlink" href="#use-of-dynamic-types" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>A call to a function with the signature <code class="docutils literal notranslate"><span class="pre">f(uint256,uint32[],bytes10,bytes)</span></code> with values
<code class="docutils literal notranslate"><span class="pre">(0x123,</span> <span class="pre">[0x456,</span> <span class="pre">0x789],</span> <span class="pre">&quot;1234567890&quot;,</span> <span class="pre">&quot;Hello,</span> <span class="pre">world!&quot;)</span></code> is encoded in the following way:</p>
<p>We take the first four bytes of <code class="docutils literal notranslate"><span class="pre">sha3(&quot;f(uint256,uint32[],bytes10,bytes)&quot;)</span></code>, i.e. <code class="docutils literal notranslate"><span class="pre">0x8be65246</span></code>.
Then we encode the head parts of all four arguments. For the static types <code class="docutils literal notranslate"><span class="pre">uint256</span></code> and <code class="docutils literal notranslate"><span class="pre">bytes10</span></code>,
these are directly the values we want to pass, whereas for the dynamic types <code class="docutils literal notranslate"><span class="pre">uint32[]</span></code> and <code class="docutils literal notranslate"><span class="pre">bytes</span></code>,
we use the offset in bytes to the start of their data area, measured from the start of the value
encoding (i.e. not counting the first four bytes containing the hash of the function signature). These are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000123</span></code> (<code class="docutils literal notranslate"><span class="pre">0x123</span></code> padded to 32 bytes)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000080</span></code> (offset to start of data part of second parameter, 4*32 bytes, exactly the size of the head part)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x3132333435363738393000000000000000000000000000000000000000000000</span></code> (<code class="docutils literal notranslate"><span class="pre">&quot;1234567890&quot;</span></code> padded to 32 bytes on the right)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x00000000000000000000000000000000000000000000000000000000000000e0</span></code> (offset to start of data part of fourth parameter = offset to start of data part of first dynamic parameter + size of data part of first dynamic parameter = 4*32 + 3*32 (see below))</p></li>
</ul>
<p>After this, the data part of the first dynamic argument, <code class="docutils literal notranslate"><span class="pre">[0x456,</span> <span class="pre">0x789]</span></code> follows:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000002</span></code> (number of elements of the array, 2)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000456</span></code> (first element)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000789</span></code> (second element)</p></li>
</ul>
<p>Finally, we encode the data part of the second dynamic argument, <code class="docutils literal notranslate"><span class="pre">&quot;Hello,</span> <span class="pre">world!&quot;</span></code>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0x000000000000000000000000000000000000000000000000000000000000000d</span></code> (number of elements (bytes in this case): 13)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x48656c6c6f2c20776f726c642100000000000000000000000000000000000000</span></code> (<code class="docutils literal notranslate"><span class="pre">&quot;Hello,</span> <span class="pre">world!&quot;</span></code> padded to 32 bytes on the right)</p></li>
</ul>
<p>All together, the encoding is (newline after function selector and each 32-bytes for clarity):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>0x8be65246
  0000000000000000000000000000000000000000000000000000000000000123
  0000000000000000000000000000000000000000000000000000000000000080
  3132333435363738393000000000000000000000000000000000000000000000
  00000000000000000000000000000000000000000000000000000000000000e0
  0000000000000000000000000000000000000000000000000000000000000002
  0000000000000000000000000000000000000000000000000000000000000456
  0000000000000000000000000000000000000000000000000000000000000789
  000000000000000000000000000000000000000000000000000000000000000d
  48656c6c6f2c20776f726c642100000000000000000000000000000000000000
</pre></div>
</div>
<p>Let us apply the same principle to encode the data for a function with a signature <code class="docutils literal notranslate"><span class="pre">g(uint256[][],string[])</span></code>
with values <code class="docutils literal notranslate"><span class="pre">([[1,</span> <span class="pre">2],</span> <span class="pre">[3]],</span> <span class="pre">[&quot;one&quot;,</span> <span class="pre">&quot;two&quot;,</span> <span class="pre">&quot;three&quot;])</span></code> but start from the most atomic parts of the encoding:</p>
<p>First we encode the length and data of the first embedded dynamic array <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">2]</span></code> of the first root array <code class="docutils literal notranslate"><span class="pre">[[1,</span> <span class="pre">2],</span> <span class="pre">[3]]</span></code>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000002</span></code> (number of elements in the first array, 2; the elements themselves are <code class="docutils literal notranslate"><span class="pre">1</span></code> and <code class="docutils literal notranslate"><span class="pre">2</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000001</span></code> (first element)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000002</span></code> (second element)</p></li>
</ul>
<p>Then we encode the length and data of the second embedded dynamic array <code class="docutils literal notranslate"><span class="pre">[3]</span></code> of the first root array <code class="docutils literal notranslate"><span class="pre">[[1,</span> <span class="pre">2],</span> <span class="pre">[3]]</span></code>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000001</span></code> (number of elements in the second array, 1; the element is <code class="docutils literal notranslate"><span class="pre">3</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000003</span></code> (first element)</p></li>
</ul>
<p>Then we need to find the offsets <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code> for their respective dynamic arrays <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">2]</span></code> and <code class="docutils literal notranslate"><span class="pre">[3]</span></code>.
To calculate the offsets we can take a look at the encoded data of the first root array <code class="docutils literal notranslate"><span class="pre">[[1,</span> <span class="pre">2],</span> <span class="pre">[3]]</span></code>
enumerating each line in the encoding:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>0 - a                                                                - offset of [1, 2]
1 - b                                                                - offset of [3]
2 - 0000000000000000000000000000000000000000000000000000000000000002 - count for [1, 2]
3 - 0000000000000000000000000000000000000000000000000000000000000001 - encoding of 1
4 - 0000000000000000000000000000000000000000000000000000000000000002 - encoding of 2
5 - 0000000000000000000000000000000000000000000000000000000000000001 - count for [3]
6 - 0000000000000000000000000000000000000000000000000000000000000003 - encoding of 3
</pre></div>
</div>
<p>Offset <code class="docutils literal notranslate"><span class="pre">a</span></code> points to the start of the content of the array <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">2]</span></code> which is line
2 (64 bytes); thus <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">=</span> <span class="pre">0x0000000000000000000000000000000000000000000000000000000000000040</span></code>.</p>
<p>Offset <code class="docutils literal notranslate"><span class="pre">b</span></code> points to the start of the content of the array <code class="docutils literal notranslate"><span class="pre">[3]</span></code> which is line 5 (160 bytes);
thus <code class="docutils literal notranslate"><span class="pre">b</span> <span class="pre">=</span> <span class="pre">0x00000000000000000000000000000000000000000000000000000000000000a0</span></code>.</p>
<p>Then we encode the embedded strings of the second root array:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000003</span></code> (number of characters in word <code class="docutils literal notranslate"><span class="pre">&quot;one&quot;</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x6f6e650000000000000000000000000000000000000000000000000000000000</span></code> (utf8 representation of word <code class="docutils literal notranslate"><span class="pre">&quot;one&quot;</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000003</span></code> (number of characters in word <code class="docutils literal notranslate"><span class="pre">&quot;two&quot;</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x74776f0000000000000000000000000000000000000000000000000000000000</span></code> (utf8 representation of word <code class="docutils literal notranslate"><span class="pre">&quot;two&quot;</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000005</span></code> (number of characters in word <code class="docutils literal notranslate"><span class="pre">&quot;three&quot;</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x7468726565000000000000000000000000000000000000000000000000000000</span></code> (utf8 representation of word <code class="docutils literal notranslate"><span class="pre">&quot;three&quot;</span></code>)</p></li>
</ul>
<p>In parallel to the first root array, since strings are dynamic elements we need to find their offsets <code class="docutils literal notranslate"><span class="pre">c</span></code>, <code class="docutils literal notranslate"><span class="pre">d</span></code> and <code class="docutils literal notranslate"><span class="pre">e</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>0 - c                                                                - offset for &quot;one&quot;
1 - d                                                                - offset for &quot;two&quot;
2 - e                                                                - offset for &quot;three&quot;
3 - 0000000000000000000000000000000000000000000000000000000000000003 - count for &quot;one&quot;
4 - 6f6e650000000000000000000000000000000000000000000000000000000000 - encoding of &quot;one&quot;
5 - 0000000000000000000000000000000000000000000000000000000000000003 - count for &quot;two&quot;
6 - 74776f0000000000000000000000000000000000000000000000000000000000 - encoding of &quot;two&quot;
7 - 0000000000000000000000000000000000000000000000000000000000000005 - count for &quot;three&quot;
8 - 7468726565000000000000000000000000000000000000000000000000000000 - encoding of &quot;three&quot;
</pre></div>
</div>
<p>Offset <code class="docutils literal notranslate"><span class="pre">c</span></code> points to the start of the content of the string <code class="docutils literal notranslate"><span class="pre">&quot;one&quot;</span></code> which is line 3 (96 bytes);
thus <code class="docutils literal notranslate"><span class="pre">c</span> <span class="pre">=</span> <span class="pre">0x0000000000000000000000000000000000000000000000000000000000000060</span></code>.</p>
<p>Offset <code class="docutils literal notranslate"><span class="pre">d</span></code> points to the start of the content of the string <code class="docutils literal notranslate"><span class="pre">&quot;two&quot;</span></code> which is line 5 (160 bytes);
thus <code class="docutils literal notranslate"><span class="pre">d</span> <span class="pre">=</span> <span class="pre">0x00000000000000000000000000000000000000000000000000000000000000a0</span></code>.</p>
<p>Offset <code class="docutils literal notranslate"><span class="pre">e</span></code> points to the start of the content of the string <code class="docutils literal notranslate"><span class="pre">&quot;three&quot;</span></code> which is line 7 (224 bytes);
thus <code class="docutils literal notranslate"><span class="pre">e</span> <span class="pre">=</span> <span class="pre">0x00000000000000000000000000000000000000000000000000000000000000e0</span></code>.</p>
<p>Note that the encodings of the embedded elements of the root arrays are not dependent on each other
and have the same encodings for a function with a signature <code class="docutils literal notranslate"><span class="pre">g(string[],uint256[][])</span></code>.</p>
<p>Then we encode the length of the first root array:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000002</span></code> (number of elements in the first root array, 2; the elements themselves are <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">2]</span></code>  and <code class="docutils literal notranslate"><span class="pre">[3]</span></code>)</p></li>
</ul>
<p>Then we encode the length of the second root array:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000003</span></code> (number of strings in the second root array, 3; the strings themselves are <code class="docutils literal notranslate"><span class="pre">&quot;one&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;two&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;three&quot;</span></code>)</p></li>
</ul>
<p>Finally we find the offsets <code class="docutils literal notranslate"><span class="pre">f</span></code> and <code class="docutils literal notranslate"><span class="pre">g</span></code> for their respective root dynamic arrays <code class="docutils literal notranslate"><span class="pre">[[1,</span> <span class="pre">2],</span> <span class="pre">[3]]</span></code> and
<code class="docutils literal notranslate"><span class="pre">[&quot;one&quot;,</span> <span class="pre">&quot;two&quot;,</span> <span class="pre">&quot;three&quot;]</span></code>, and assemble parts in the correct order:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>0x2289b18c                                                            - function signature
 0 - f                                                                - offset of [[1, 2], [3]]
 1 - g                                                                - offset of [&quot;one&quot;, &quot;two&quot;, &quot;three&quot;]
 2 - 0000000000000000000000000000000000000000000000000000000000000002 - count for [[1, 2], [3]]
 3 - 0000000000000000000000000000000000000000000000000000000000000040 - offset of [1, 2]
 4 - 00000000000000000000000000000000000000000000000000000000000000a0 - offset of [3]
 5 - 0000000000000000000000000000000000000000000000000000000000000002 - count for [1, 2]
 6 - 0000000000000000000000000000000000000000000000000000000000000001 - encoding of 1
 7 - 0000000000000000000000000000000000000000000000000000000000000002 - encoding of 2
 8 - 0000000000000000000000000000000000000000000000000000000000000001 - count for [3]
 9 - 0000000000000000000000000000000000000000000000000000000000000003 - encoding of 3
10 - 0000000000000000000000000000000000000000000000000000000000000003 - count for [&quot;one&quot;, &quot;two&quot;, &quot;three&quot;]
11 - 0000000000000000000000000000000000000000000000000000000000000060 - offset for &quot;one&quot;
12 - 00000000000000000000000000000000000000000000000000000000000000a0 - offset for &quot;two&quot;
13 - 00000000000000000000000000000000000000000000000000000000000000e0 - offset for &quot;three&quot;
14 - 0000000000000000000000000000000000000000000000000000000000000003 - count for &quot;one&quot;
15 - 6f6e650000000000000000000000000000000000000000000000000000000000 - encoding of &quot;one&quot;
16 - 0000000000000000000000000000000000000000000000000000000000000003 - count for &quot;two&quot;
17 - 74776f0000000000000000000000000000000000000000000000000000000000 - encoding of &quot;two&quot;
18 - 0000000000000000000000000000000000000000000000000000000000000005 - count for &quot;three&quot;
19 - 7468726565000000000000000000000000000000000000000000000000000000 - encoding of &quot;three&quot;
</pre></div>
</div>
<p>Offset <code class="docutils literal notranslate"><span class="pre">f</span></code> points to the start of the content of the array <code class="docutils literal notranslate"><span class="pre">[[1,</span> <span class="pre">2],</span> <span class="pre">[3]]</span></code> which is line 2 (64 bytes);
thus <code class="docutils literal notranslate"><span class="pre">f</span> <span class="pre">=</span> <span class="pre">0x0000000000000000000000000000000000000000000000000000000000000040</span></code>.</p>
<p>Offset <code class="docutils literal notranslate"><span class="pre">g</span></code> points to the start of the content of the array <code class="docutils literal notranslate"><span class="pre">[&quot;one&quot;,</span> <span class="pre">&quot;two&quot;,</span> <span class="pre">&quot;three&quot;]</span></code> which is line 10 (320 bytes);
thus <code class="docutils literal notranslate"><span class="pre">g</span> <span class="pre">=</span> <span class="pre">0x0000000000000000000000000000000000000000000000000000000000000140</span></code>.</p>
</section>
<section id="events">
<span id="abi-events"></span><h3>Events<a class="headerlink" href="#events" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Events are an abstraction of the Ethereum logging/event-watching protocol. Log entries provide the contract‚Äôs
address, a series of up to four topics and some arbitrary length binary data. Events leverage the existing function
ABI in order to interpret this (together with an interface spec) as a properly typed structure.</p>
<p>Given an event name and series of event parameters, we split them into two sub-series: those which are indexed and
those which are not.
Those which are indexed, which may number up to 3 (for non-anonymous events) or 4 (for anonymous ones), are used
alongside the Keccak hash of the event signature to form the topics of the log entry.
Those which are not indexed form the byte array of the event.</p>
<p>In effect, a log entry using this ABI is described as:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">address</span></code>: the address of the contract (intrinsically provided by Ethereum);</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">topics[0]</span></code>: <code class="docutils literal notranslate"><span class="pre">keccak(EVENT_NAME+&quot;(&quot;+EVENT_ARGS.map(canonical_type_of).join(&quot;,&quot;)+&quot;)&quot;)</span></code> (<code class="docutils literal notranslate"><span class="pre">canonical_type_of</span></code>
is a function that simply returns the canonical type of a given argument, e.g. for <code class="docutils literal notranslate"><span class="pre">uint</span> <span class="pre">indexed</span> <span class="pre">foo</span></code>, it would
return <code class="docutils literal notranslate"><span class="pre">uint256</span></code>). This value is only present in <code class="docutils literal notranslate"><span class="pre">topics[0]</span></code> if the event is not declared as <code class="docutils literal notranslate"><span class="pre">anonymous</span></code>;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">topics[n]</span></code>: <code class="docutils literal notranslate"><span class="pre">abi_encode(EVENT_INDEXED_ARGS[n</span> <span class="pre">-</span> <span class="pre">1])</span></code> if the event is not declared as <code class="docutils literal notranslate"><span class="pre">anonymous</span></code>
or <code class="docutils literal notranslate"><span class="pre">abi_encode(EVENT_INDEXED_ARGS[n])</span></code> if it is (<code class="docutils literal notranslate"><span class="pre">EVENT_INDEXED_ARGS</span></code> is the series of <code class="docutils literal notranslate"><span class="pre">EVENT_ARGS</span></code> that
are indexed);</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">data</span></code>: ABI encoding of <code class="docutils literal notranslate"><span class="pre">EVENT_NON_INDEXED_ARGS</span></code> (<code class="docutils literal notranslate"><span class="pre">EVENT_NON_INDEXED_ARGS</span></code> is the series of <code class="docutils literal notranslate"><span class="pre">EVENT_ARGS</span></code>
that are not indexed, <code class="docutils literal notranslate"><span class="pre">abi_encode</span></code> is the ABI encoding function used for returning a series of typed values
from a function, as described above).</p></li>
</ul>
<p>For all types of length at most 32 bytes, the <code class="docutils literal notranslate"><span class="pre">EVENT_INDEXED_ARGS</span></code> array contains
the value directly, padded or sign-extended (for signed integers) to 32 bytes, just as for regular ABI encoding.
However, for all ‚Äúcomplex‚Äù types or types of dynamic length, including all arrays, <code class="docutils literal notranslate"><span class="pre">string</span></code>, <code class="docutils literal notranslate"><span class="pre">bytes</span></code> and structs,
<code class="docutils literal notranslate"><span class="pre">EVENT_INDEXED_ARGS</span></code> will contain the <em>Keccak hash</em> of a special in-place encoded value
(see <a class="reference internal" href="#indexed-event-encoding"><span class="std std-ref">Encoding of Indexed Event Parameters</span></a>), rather than the encoded value directly.
This allows applications to efficiently query for values of dynamic-length types
(by setting the hash of the encoded value as the topic), but leaves applications unable
to decode indexed values they have not queried for. For dynamic-length types,
application developers face a trade-off between fast search for predetermined values
(if the argument is indexed) and legibility of arbitrary values (which requires that
the arguments not be indexed). Developers may overcome this tradeoff and achieve both
efficient search and arbitrary legibility by defining events with two arguments ‚Äî one
indexed, one not ‚Äî intended to hold the same value.</p>
<span class="target" id="abi-errors"></span></section>
<section id="errors">
<span id="index-2"></span><h3>Errors<a class="headerlink" href="#errors" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>In case of a failure inside a contract, the contract can use a special opcode to abort execution and revert
all state changes. In addition to these effects, descriptive data can be returned to the caller.
This descriptive data is the encoding of an error and its arguments in the same way as data for a function
call.</p>
<p>As an example, let us consider the following contract whose <code class="docutils literal notranslate"><span class="pre">transfer</span></code> function always
reverts with a custom error of ‚Äúinsufficient balance‚Äù:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5IF4wLjguNDsKCmNvbnRyYWN0IFRlc3RUb2tlbiB7CiAgICBlcnJvciBJbnN1ZmZpY2llbnRCYWxhbmNlKHVpbnQyNTYgYXZhaWxhYmxlLCB1aW50MjU2IHJlcXVpcmVkKTsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyKGFkZHJlc3MgLyp0byovLCB1aW50IGFtb3VudCkgcHVibGljIHB1cmUgewogICAgICAgIHJldmVydCBJbnN1ZmZpY2llbnRCYWxhbmNlKDAsIGFtb3VudCk7CiAgICB9Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.8.4</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">TestToken</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span>error<span class="w"> </span>InsufficientBalance<span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">available</span><span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">required</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">transfer</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="cm">/*to*/</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">amount</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>pure<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>revert<span class="w"> </span>InsufficientBalance<span class="p">(</span><span class="m m-Decimal">0</span><span class="p">,</span><span class="w"> </span>amount<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>The return data would be encoded in the same way as the function call
<code class="docutils literal notranslate"><span class="pre">InsufficientBalance(0,</span> <span class="pre">amount)</span></code> to the function <code class="docutils literal notranslate"><span class="pre">InsufficientBalance(uint256,uint256)</span></code>,
i.e. <code class="docutils literal notranslate"><span class="pre">0xcf479181</span></code>, <code class="docutils literal notranslate"><span class="pre">uint256(0)</span></code>, <code class="docutils literal notranslate"><span class="pre">uint256(amount)</span></code>.</p>
<p>The error selectors <code class="docutils literal notranslate"><span class="pre">0x00000000</span></code> and <code class="docutils literal notranslate"><span class="pre">0xffffffff</span></code> are reserved for future use.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Never trust error data.
The error data by default bubbles up through the chain of external calls, which
means that a contract may receive an error not defined in any of the contracts
it calls directly.
Furthermore, any contract can fake any error by returning data that matches
an error signature, even if the error is not defined anywhere.</p>
</div>
</section>
<section id="json">
<span id="abi-json"></span><h3>JSON<a class="headerlink" href="#json" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>The JSON format for a contract‚Äôs interface is given by an array of function, event and error descriptions.
A function description is a JSON object with the fields:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">type</span></code>: <code class="docutils literal notranslate"><span class="pre">&quot;function&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;constructor&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;receive&quot;</span></code> (the <a class="reference internal" href="index.html#receive-ether-function"><span class="std std-ref">‚Äúreceive Ether‚Äù function</span></a>) or <code class="docutils literal notranslate"><span class="pre">&quot;fallback&quot;</span></code> (the <a class="reference internal" href="index.html#fallback-function"><span class="std std-ref">‚Äúdefault‚Äù function</span></a>);</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code>: the name of the function;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">inputs</span></code>: an array of objects, each of which contains:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code>: the name of the parameter.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">type</span></code>: the canonical type of the parameter (more below).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">components</span></code>: used for tuple types (more below).</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">outputs</span></code>: an array of objects similar to <code class="docutils literal notranslate"><span class="pre">inputs</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stateMutability</span></code>: a string with one of the following values: <code class="docutils literal notranslate"><span class="pre">pure</span></code> (<a class="reference internal" href="index.html#pure-functions"><span class="std std-ref">specified to not read
blockchain state</span></a>), <code class="docutils literal notranslate"><span class="pre">view</span></code> (<a class="reference internal" href="index.html#view-functions"><span class="std std-ref">specified to not modify the blockchain
state</span></a>), <code class="docutils literal notranslate"><span class="pre">nonpayable</span></code> (function does not accept Ether - the default) and <code class="docutils literal notranslate"><span class="pre">payable</span></code> (function accepts Ether).</p></li>
</ul>
<p>Constructor and fallback function never have <code class="docutils literal notranslate"><span class="pre">name</span></code> or <code class="docutils literal notranslate"><span class="pre">outputs</span></code>. Fallback function doesn‚Äôt have <code class="docutils literal notranslate"><span class="pre">inputs</span></code> either.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Sending non-zero Ether to non-payable function will revert the transaction.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The state mutability <code class="docutils literal notranslate"><span class="pre">nonpayable</span></code> is reflected in Solidity by not specifying
a state mutability modifier at all.</p>
</div>
<p>An event description is a JSON object with fairly similar fields:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">type</span></code>: always <code class="docutils literal notranslate"><span class="pre">&quot;event&quot;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code>: the name of the event.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">inputs</span></code>: an array of objects, each of which contains:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code>: the name of the parameter.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">type</span></code>: the canonical type of the parameter (more below).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">components</span></code>: used for tuple types (more below).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">indexed</span></code>: <code class="docutils literal notranslate"><span class="pre">true</span></code> if the field is part of the log‚Äôs topics, <code class="docutils literal notranslate"><span class="pre">false</span></code> if it one of the log‚Äôs data segment.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">anonymous</span></code>: <code class="docutils literal notranslate"><span class="pre">true</span></code> if the event was declared as <code class="docutils literal notranslate"><span class="pre">anonymous</span></code>.</p></li>
</ul>
<p>Errors look as follows:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">type</span></code>: always <code class="docutils literal notranslate"><span class="pre">&quot;error&quot;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code>: the name of the error.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">inputs</span></code>: an array of objects, each of which contains:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code>: the name of the parameter.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">type</span></code>: the canonical type of the parameter (more below).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">components</span></code>: used for tuple types (more below).</p></li>
</ul>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There can be multiple errors with the same name and even with identical signature
in the JSON array, for example if the errors originate from different
files in the smart contract or are referenced from another smart contract.
For the ABI, only the name of the error itself is relevant and not where it is
defined.</p>
</div>
<p>For example,</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5IF4wLjguNDsKCgpjb250cmFjdCBUZXN0IHsKICAgIGNvbnN0cnVjdG9yKCkgeyBiID0gaGV4IjEyMzQ1Njc4OTAxMjM0NTY3ODkwMTIzNDU2Nzg5MDEyIjsgfQogICAgZXZlbnQgRXZlbnQodWludCBpbmRleGVkIGEsIGJ5dGVzMzIgYik7CiAgICBldmVudCBFdmVudDIodWludCBpbmRleGVkIGEsIGJ5dGVzMzIgYik7CiAgICBlcnJvciBJbnN1ZmZpY2llbnRCYWxhbmNlKHVpbnQyNTYgYXZhaWxhYmxlLCB1aW50MjU2IHJlcXVpcmVkKTsKICAgIGZ1bmN0aW9uIGZvbyh1aW50IGEpIHB1YmxpYyB7IGVtaXQgRXZlbnQoYSwgYik7IH0KICAgIGJ5dGVzMzIgYjsKfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.8.4</span><span class="p">;</span><span class="w"></span>


<span class="k">contract</span><span class="w"> </span><span class="ni">Test</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>b<span class="w"> </span><span class="o">=</span><span class="w"> </span>hex<span class="s2">&quot;12345678901234567890123456789012&quot;</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">Event</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>a<span class="p">,</span><span class="w"> </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">b</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">Event2</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>a<span class="p">,</span><span class="w"> </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">b</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span>error<span class="w"> </span>InsufficientBalance<span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">available</span><span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">required</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">foo</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">a</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>emit<span class="w"> </span>Event<span class="p">(</span>a<span class="p">,</span><span class="w"> </span>b<span class="p">);</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">b</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>would result in the JSON:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">[{</span><span class="w"></span>
<span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;error&quot;</span><span class="p">,</span><span class="w"></span>
<span class="nt">&quot;inputs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;available&quot;</span><span class="p">,</span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;uint256&quot;</span><span class="p">},{</span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;required&quot;</span><span class="p">,</span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;uint256&quot;</span><span class="p">}],</span><span class="w"></span>
<span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;InsufficientBalance&quot;</span><span class="w"></span>
<span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;event&quot;</span><span class="p">,</span><span class="w"></span>
<span class="nt">&quot;inputs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;a&quot;</span><span class="p">,</span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;uint256&quot;</span><span class="p">,</span><span class="nt">&quot;indexed&quot;</span><span class="p">:</span><span class="kc">true</span><span class="p">},{</span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;b&quot;</span><span class="p">,</span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;bytes32&quot;</span><span class="p">,</span><span class="nt">&quot;indexed&quot;</span><span class="p">:</span><span class="kc">false</span><span class="p">}],</span><span class="w"></span>
<span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;Event&quot;</span><span class="w"></span>
<span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;event&quot;</span><span class="p">,</span><span class="w"></span>
<span class="nt">&quot;inputs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;a&quot;</span><span class="p">,</span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;uint256&quot;</span><span class="p">,</span><span class="nt">&quot;indexed&quot;</span><span class="p">:</span><span class="kc">true</span><span class="p">},{</span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;b&quot;</span><span class="p">,</span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;bytes32&quot;</span><span class="p">,</span><span class="nt">&quot;indexed&quot;</span><span class="p">:</span><span class="kc">false</span><span class="p">}],</span><span class="w"></span>
<span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;Event2&quot;</span><span class="w"></span>
<span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;function&quot;</span><span class="p">,</span><span class="w"></span>
<span class="nt">&quot;inputs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;a&quot;</span><span class="p">,</span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;uint256&quot;</span><span class="p">}],</span><span class="w"></span>
<span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;foo&quot;</span><span class="p">,</span><span class="w"></span>
<span class="nt">&quot;outputs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w"></span>
<span class="p">}]</span><span class="w"></span>
</pre></div>
</div>
<section id="handling-tuple-types">
<h4>Handling tuple types<a class="headerlink" href="#handling-tuple-types" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Despite that names are intentionally not part of the ABI encoding they do make a lot of sense to be included
in the JSON to enable displaying it to the end user. The structure is nested in the following way:</p>
<p>An object with members <code class="docutils literal notranslate"><span class="pre">name</span></code>, <code class="docutils literal notranslate"><span class="pre">type</span></code> and potentially <code class="docutils literal notranslate"><span class="pre">components</span></code> describes a typed variable.
The canonical type is determined until a tuple type is reached and the string description up
to that point is stored in <code class="docutils literal notranslate"><span class="pre">type</span></code> prefix with the word <code class="docutils literal notranslate"><span class="pre">tuple</span></code>, i.e. it will be <code class="docutils literal notranslate"><span class="pre">tuple</span></code> followed by
a sequence of <code class="docutils literal notranslate"><span class="pre">[]</span></code> and <code class="docutils literal notranslate"><span class="pre">[k]</span></code> with
integers <code class="docutils literal notranslate"><span class="pre">k</span></code>. The components of the tuple are then stored in the member <code class="docutils literal notranslate"><span class="pre">components</span></code>,
which is of array type and has the same structure as the top-level object except that
<code class="docutils literal notranslate"><span class="pre">indexed</span></code> is not allowed there.</p>
<p>As an example, the code</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC43LjUgPDAuOS4wOwpwcmFnbWEgYWJpY29kZXIgdjI7Cgpjb250cmFjdCBUZXN0IHsKICAgIHN0cnVjdCBTIHsgdWludCBhOyB1aW50W10gYjsgVFtdIGM7IH0KICAgIHN0cnVjdCBUIHsgdWludCB4OyB1aW50IHk7IH0KICAgIGZ1bmN0aW9uIGYoUyBtZW1vcnksIFQgbWVtb3J5LCB1aW50KSBwdWJsaWMgcHVyZSB7fQogICAgZnVuY3Rpb24gZygpIHB1YmxpYyBwdXJlIHJldHVybnMgKFMgbWVtb3J5LCBUIG1lbW9yeSwgdWludCkge30KfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.7.5</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>
pragma<span class="w"> </span>abicoder<span class="w"> </span>v2<span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Test</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">struct</span><span class="w"> </span><span class="nv">S</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">a</span><span class="p">;</span><span class="w"> </span><span class="kt">uint</span><span class="p">[]</span><span class="w"> </span>b<span class="p">;</span><span class="w"> </span>T<span class="p">[]</span><span class="w"> </span>c<span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="kt">struct</span><span class="w"> </span><span class="nv">T</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">x</span><span class="p">;</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">y</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">f</span><span class="p">(</span>S<span class="w"> </span><span class="kt">memory</span><span class="p">,</span><span class="w"> </span>T<span class="w"> </span><span class="kt">memory</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>pure<span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">g</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span>S<span class="w"> </span><span class="kt">memory</span><span class="p">,</span><span class="w"> </span>T<span class="w"> </span><span class="kt">memory</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>would result in the JSON:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="w"></span>
<span class="w">  </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;f&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;function&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;inputs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;s&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tuple&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;components&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">          </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;a&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uint256&quot;</span><span class="w"></span>
<span class="w">          </span><span class="p">},</span><span class="w"></span>
<span class="w">          </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;b&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uint256[]&quot;</span><span class="w"></span>
<span class="w">          </span><span class="p">},</span><span class="w"></span>
<span class="w">          </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;c&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tuple[]&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="nt">&quot;components&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">              </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uint256&quot;</span><span class="w"></span>
<span class="w">              </span><span class="p">},</span><span class="w"></span>
<span class="w">              </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;y&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uint256&quot;</span><span class="w"></span>
<span class="w">              </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="p">]</span><span class="w"></span>
<span class="w">          </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">]</span><span class="w"></span>
<span class="w">      </span><span class="p">},</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;t&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tuple&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;components&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">          </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uint256&quot;</span><span class="w"></span>
<span class="w">          </span><span class="p">},</span><span class="w"></span>
<span class="w">          </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;y&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uint256&quot;</span><span class="w"></span>
<span class="w">          </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">]</span><span class="w"></span>
<span class="w">      </span><span class="p">},</span><span class="w"></span>
<span class="w">      </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;a&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uint256&quot;</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">],</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;outputs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">]</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
<section id="strict-encoding-mode">
<span id="abi-packed-mode"></span><h3>Strict Encoding Mode<a class="headerlink" href="#strict-encoding-mode" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Strict encoding mode is the mode that leads to exactly the same encoding as defined in the formal specification above.
This means offsets have to be as small as possible while still not creating overlaps in the data areas and thus no gaps are
allowed.</p>
<p>Usually, ABI decoders are written in a straightforward way just following offset pointers, but some decoders
might enforce strict mode. The Solidity ABI decoder currently does not enforce strict mode, but the encoder
always creates data in strict mode.</p>
</section>
<section id="non-standard-packed-mode">
<h3>Non-standard Packed Mode<a class="headerlink" href="#non-standard-packed-mode" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Through <code class="docutils literal notranslate"><span class="pre">abi.encodePacked()</span></code>, Solidity supports a non-standard packed mode where:</p>
<ul class="simple">
<li><p>types shorter than 32 bytes are concatenated directly, without padding or sign extension</p></li>
<li><p>dynamic types are encoded in-place and without the length.</p></li>
<li><p>array elements are padded, but still encoded in-place</p></li>
</ul>
<p>Furthermore, structs as well as nested arrays are not supported.</p>
<p>As an example, the encoding of <code class="docutils literal notranslate"><span class="pre">int16(-1),</span> <span class="pre">bytes1(0x42),</span> <span class="pre">uint16(0x03),</span> <span class="pre">string(&quot;Hello,</span> <span class="pre">world!&quot;)</span></code> results in:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>0xffff42000348656c6c6f2c20776f726c6421
  ^^^^                                 int16(-1)
      ^^                               bytes1(0x42)
        ^^^^                           uint16(0x03)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^ string(&quot;Hello, world!&quot;) without a length field
</pre></div>
</div>
<p>More specifically:</p>
<ul class="simple">
<li><p>During the encoding, everything is encoded in-place. This means that there is
no distinction between head and tail, as in the ABI encoding, and the length
of an array is not encoded.</p></li>
<li><p>The direct arguments of <code class="docutils literal notranslate"><span class="pre">abi.encodePacked</span></code> are encoded without padding,
as long as they are not arrays (or <code class="docutils literal notranslate"><span class="pre">string</span></code> or <code class="docutils literal notranslate"><span class="pre">bytes</span></code>).</p></li>
<li><p>The encoding of an array is the concatenation of the
encoding of its elements <strong>with</strong> padding.</p></li>
<li><p>Dynamically-sized types like <code class="docutils literal notranslate"><span class="pre">string</span></code>, <code class="docutils literal notranslate"><span class="pre">bytes</span></code> or <code class="docutils literal notranslate"><span class="pre">uint[]</span></code> are encoded
without their length field.</p></li>
<li><p>The encoding of <code class="docutils literal notranslate"><span class="pre">string</span></code> or <code class="docutils literal notranslate"><span class="pre">bytes</span></code> does not apply padding at the end
unless it is part of an array or struct (then it is padded to a multiple of
32 bytes).</p></li>
</ul>
<p>In general, the encoding is ambiguous as soon as there are two dynamically-sized elements,
because of the missing length field.</p>
<p>If padding is needed, explicit type conversions can be used: <code class="docutils literal notranslate"><span class="pre">abi.encodePacked(uint16(0x12))</span> <span class="pre">==</span> <span class="pre">hex&quot;0012&quot;</span></code>.</p>
<p>Since packed encoding is not used when calling functions, there is no special support
for prepending a function selector. Since the encoding is ambiguous, there is no decoding function.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If you use <code class="docutils literal notranslate"><span class="pre">keccak256(abi.encodePacked(a,</span> <span class="pre">b))</span></code> and both <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code> are dynamic types,
it is easy to craft collisions in the hash value by moving parts of <code class="docutils literal notranslate"><span class="pre">a</span></code> into <code class="docutils literal notranslate"><span class="pre">b</span></code> and
vice-versa. More specifically, <code class="docutils literal notranslate"><span class="pre">abi.encodePacked(&quot;a&quot;,</span> <span class="pre">&quot;bc&quot;)</span> <span class="pre">==</span> <span class="pre">abi.encodePacked(&quot;ab&quot;,</span> <span class="pre">&quot;c&quot;)</span></code>.
If you use <code class="docutils literal notranslate"><span class="pre">abi.encodePacked</span></code> for signatures, authentication or data integrity, make
sure to always use the same types and check that at most one of them is dynamic.
Unless there is a compelling reason, <code class="docutils literal notranslate"><span class="pre">abi.encode</span></code> should be preferred.</p>
</div>
</section>
<section id="encoding-of-indexed-event-parameters">
<span id="indexed-event-encoding"></span><h3>Encoding of Indexed Event Parameters<a class="headerlink" href="#encoding-of-indexed-event-parameters" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Indexed event parameters that are not value types, i.e. arrays and structs are not
stored directly but instead a keccak256-hash of an encoding is stored. This encoding
is defined as follows:</p>
<ul class="simple">
<li><p>the encoding of a <code class="docutils literal notranslate"><span class="pre">bytes</span></code> and <code class="docutils literal notranslate"><span class="pre">string</span></code> value is just the string contents
without any padding or length prefix.</p></li>
<li><p>the encoding of a struct is the concatenation of the encoding of its members,
always padded to a multiple of 32 bytes (even <code class="docutils literal notranslate"><span class="pre">bytes</span></code> and <code class="docutils literal notranslate"><span class="pre">string</span></code>).</p></li>
<li><p>the encoding of an array (both dynamically- and statically-sized) is
the concatenation of the encoding of its elements, always padded to a multiple
of 32 bytes (even <code class="docutils literal notranslate"><span class="pre">bytes</span></code> and <code class="docutils literal notranslate"><span class="pre">string</span></code>) and without any length prefix</p></li>
</ul>
<p>In the above, as usual, a negative number is padded by sign extension and not zero padded.
<code class="docutils literal notranslate"><span class="pre">bytesNN</span></code> types are padded on the right while <code class="docutils literal notranslate"><span class="pre">uintNN</span></code> / <code class="docutils literal notranslate"><span class="pre">intNN</span></code> are padded on the left.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The encoding of a struct is ambiguous if it contains more than one dynamically-sized
array. Because of that, always re-check the event data and do not rely on the search result
based on the indexed parameters alone.</p>
</div>
</section>
</section>
</div>
<div class="toctree-wrapper compound">
<span id="document-050-breaking-changes"></span><section id="solidity-v0-5-0-breaking-changes">
<h2>Solidity v0.5.0 Breaking Changes<a class="headerlink" href="#solidity-v0-5-0-breaking-changes" title="Permalink to this heading">ÔÉÅ</a></h2>
<p>This section highlights the main breaking changes introduced in Solidity
version 0.5.0, along with the reasoning behind the changes and how to update
affected code.
For the full list check
<a class="reference external" href="https://github.com/ethereum/solidity/releases/tag/v0.5.0">the release changelog</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Contracts compiled with Solidity v0.5.0 can still interface with contracts
and even libraries compiled with older versions without recompiling or
redeploying them.  Changing the interfaces to include data locations and
visibility and mutability specifiers suffices. See the
<a class="reference internal" href="#interoperability"><span class="std std-ref">Interoperability With Older Contracts</span></a> section below.</p>
</div>
<section id="semantic-only-changes">
<h3>Semantic Only Changes<a class="headerlink" href="#semantic-only-changes" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>This section lists the changes that are semantic-only, thus potentially
hiding new and different behavior in existing code.</p>
<ul class="simple">
<li><p>Signed right shift now uses proper arithmetic shift, i.e. rounding towards
negative infinity, instead of rounding towards zero.  Signed and unsigned
shift will have dedicated opcodes in Constantinople, and are emulated by
Solidity for the moment.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">continue</span></code> statement in a <code class="docutils literal notranslate"><span class="pre">do...while</span></code> loop now jumps to the
condition, which is the common behavior in such cases. It used to jump to the
loop body. Thus, if the condition is false, the loop terminates.</p></li>
<li><p>The functions <code class="docutils literal notranslate"><span class="pre">.call()</span></code>, <code class="docutils literal notranslate"><span class="pre">.delegatecall()</span></code> and <code class="docutils literal notranslate"><span class="pre">.staticcall()</span></code> do not
pad anymore when given a single <code class="docutils literal notranslate"><span class="pre">bytes</span></code> parameter.</p></li>
<li><p>Pure and view functions are now called using the opcode <code class="docutils literal notranslate"><span class="pre">STATICCALL</span></code>
instead of <code class="docutils literal notranslate"><span class="pre">CALL</span></code> if the EVM version is Byzantium or later. This
disallows state changes on the EVM level.</p></li>
<li><p>The ABI encoder now properly pads byte arrays and strings from calldata
(<code class="docutils literal notranslate"><span class="pre">msg.data</span></code> and external function parameters) when used in external
function calls and in <code class="docutils literal notranslate"><span class="pre">abi.encode</span></code>. For unpadded encoding, use
<code class="docutils literal notranslate"><span class="pre">abi.encodePacked</span></code>.</p></li>
<li><p>The ABI decoder reverts in the beginning of functions and in
<code class="docutils literal notranslate"><span class="pre">abi.decode()</span></code> if passed calldata is too short or points out of bounds.
Note that dirty higher order bits are still simply ignored.</p></li>
<li><p>Forward all available gas with external function calls starting from
Tangerine Whistle.</p></li>
</ul>
</section>
<section id="semantic-and-syntactic-changes">
<h3>Semantic and Syntactic Changes<a class="headerlink" href="#semantic-and-syntactic-changes" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>This section highlights changes that affect syntax and semantics.</p>
<ul class="simple">
<li><p>The functions <code class="docutils literal notranslate"><span class="pre">.call()</span></code>, <code class="docutils literal notranslate"><span class="pre">.delegatecall()</span></code>, <code class="docutils literal notranslate"><span class="pre">staticcall()</span></code>,
<code class="docutils literal notranslate"><span class="pre">keccak256()</span></code>, <code class="docutils literal notranslate"><span class="pre">sha256()</span></code> and <code class="docutils literal notranslate"><span class="pre">ripemd160()</span></code> now accept only a single
<code class="docutils literal notranslate"><span class="pre">bytes</span></code> argument. Moreover, the argument is not padded. This was changed to
make more explicit and clear how the arguments are concatenated. Change every
<code class="docutils literal notranslate"><span class="pre">.call()</span></code> (and family) to a <code class="docutils literal notranslate"><span class="pre">.call(&quot;&quot;)</span></code> and every <code class="docutils literal notranslate"><span class="pre">.call(signature,</span> <span class="pre">a,</span>
<span class="pre">b,</span> <span class="pre">c)</span></code> to use <code class="docutils literal notranslate"><span class="pre">.call(abi.encodeWithSignature(signature,</span> <span class="pre">a,</span> <span class="pre">b,</span> <span class="pre">c))</span></code> (the
last one only works for value types).  Change every <code class="docutils literal notranslate"><span class="pre">keccak256(a,</span> <span class="pre">b,</span> <span class="pre">c)</span></code> to
<code class="docutils literal notranslate"><span class="pre">keccak256(abi.encodePacked(a,</span> <span class="pre">b,</span> <span class="pre">c))</span></code>. Even though it is not a breaking
change, it is suggested that developers change
<code class="docutils literal notranslate"><span class="pre">x.call(bytes4(keccak256(&quot;f(uint256)&quot;)),</span> <span class="pre">a,</span> <span class="pre">b)</span></code> to
<code class="docutils literal notranslate"><span class="pre">x.call(abi.encodeWithSignature(&quot;f(uint256)&quot;,</span> <span class="pre">a,</span> <span class="pre">b))</span></code>.</p></li>
<li><p>Functions <code class="docutils literal notranslate"><span class="pre">.call()</span></code>, <code class="docutils literal notranslate"><span class="pre">.delegatecall()</span></code> and <code class="docutils literal notranslate"><span class="pre">.staticcall()</span></code> now return
<code class="docutils literal notranslate"><span class="pre">(bool,</span> <span class="pre">bytes</span> <span class="pre">memory)</span></code> to provide access to the return data.  Change
<code class="docutils literal notranslate"><span class="pre">bool</span> <span class="pre">success</span> <span class="pre">=</span> <span class="pre">otherContract.call(&quot;f&quot;)</span></code> to <code class="docutils literal notranslate"><span class="pre">(bool</span> <span class="pre">success,</span> <span class="pre">bytes</span> <span class="pre">memory</span>
<span class="pre">data)</span> <span class="pre">=</span> <span class="pre">otherContract.call(&quot;f&quot;)</span></code>.</p></li>
<li><p>Solidity now implements C99-style scoping rules for function local
variables, that is, variables can only be used after they have been
declared and only in the same or nested scopes. Variables declared in the
initialization block of a <code class="docutils literal notranslate"><span class="pre">for</span></code> loop are valid at any point inside the
loop.</p></li>
</ul>
</section>
<section id="explicitness-requirements">
<h3>Explicitness Requirements<a class="headerlink" href="#explicitness-requirements" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>This section lists changes where the code now needs to be more explicit.
For most of the topics the compiler will provide suggestions.</p>
<ul class="simple">
<li><p>Explicit function visibility is now mandatory.  Add <code class="docutils literal notranslate"><span class="pre">public</span></code> to every
function and constructor, and <code class="docutils literal notranslate"><span class="pre">external</span></code> to every fallback or interface
function that does not specify its visibility already.</p></li>
<li><p>Explicit data location for all variables of struct, array or mapping types is
now mandatory. This is also applied to function parameters and return
variables.  For example, change <code class="docutils literal notranslate"><span class="pre">uint[]</span> <span class="pre">x</span> <span class="pre">=</span> <span class="pre">z</span></code> to <code class="docutils literal notranslate"><span class="pre">uint[]</span> <span class="pre">storage</span> <span class="pre">x</span> <span class="pre">=</span>
<span class="pre">z</span></code>, and <code class="docutils literal notranslate"><span class="pre">function</span> <span class="pre">f(uint[][]</span> <span class="pre">x)</span></code> to <code class="docutils literal notranslate"><span class="pre">function</span> <span class="pre">f(uint[][]</span> <span class="pre">memory</span> <span class="pre">x)</span></code>
where <code class="docutils literal notranslate"><span class="pre">memory</span></code> is the data location and might be replaced by <code class="docutils literal notranslate"><span class="pre">storage</span></code> or
<code class="docutils literal notranslate"><span class="pre">calldata</span></code> accordingly.  Note that <code class="docutils literal notranslate"><span class="pre">external</span></code> functions require
parameters with a data location of <code class="docutils literal notranslate"><span class="pre">calldata</span></code>.</p></li>
<li><p>Contract types do not include <code class="docutils literal notranslate"><span class="pre">address</span></code> members anymore in
order to separate the namespaces.  Therefore, it is now necessary to
explicitly convert values of contract type to addresses before using an
<code class="docutils literal notranslate"><span class="pre">address</span></code> member.  Example: if <code class="docutils literal notranslate"><span class="pre">c</span></code> is a contract, change
<code class="docutils literal notranslate"><span class="pre">c.transfer(...)</span></code> to <code class="docutils literal notranslate"><span class="pre">address(c).transfer(...)</span></code>,
and <code class="docutils literal notranslate"><span class="pre">c.balance</span></code> to <code class="docutils literal notranslate"><span class="pre">address(c).balance</span></code>.</p></li>
<li><p>Explicit conversions between unrelated contract types are now disallowed. You can only
convert from a contract type to one of its base or ancestor types. If you are sure that
a contract is compatible with the contract type you want to convert to, although it does not
inherit from it, you can work around this by converting to <code class="docutils literal notranslate"><span class="pre">address</span></code> first.
Example: if <code class="docutils literal notranslate"><span class="pre">A</span></code> and <code class="docutils literal notranslate"><span class="pre">B</span></code> are contract types, <code class="docutils literal notranslate"><span class="pre">B</span></code> does not inherit from <code class="docutils literal notranslate"><span class="pre">A</span></code> and
<code class="docutils literal notranslate"><span class="pre">b</span></code> is a contract of type <code class="docutils literal notranslate"><span class="pre">B</span></code>, you can still convert <code class="docutils literal notranslate"><span class="pre">b</span></code> to type <code class="docutils literal notranslate"><span class="pre">A</span></code> using <code class="docutils literal notranslate"><span class="pre">A(address(b))</span></code>.
Note that you still need to watch out for matching payable fallback functions, as explained below.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">address</span></code> type  was split into <code class="docutils literal notranslate"><span class="pre">address</span></code> and <code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code>,
where only <code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code> provides the <code class="docutils literal notranslate"><span class="pre">transfer</span></code> function.  An
<code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code> can be directly converted to an <code class="docutils literal notranslate"><span class="pre">address</span></code>, but the
other way around is not allowed. Converting <code class="docutils literal notranslate"><span class="pre">address</span></code> to <code class="docutils literal notranslate"><span class="pre">address</span>
<span class="pre">payable</span></code> is possible via conversion through <code class="docutils literal notranslate"><span class="pre">uint160</span></code>. If <code class="docutils literal notranslate"><span class="pre">c</span></code> is a
contract, <code class="docutils literal notranslate"><span class="pre">address(c)</span></code> results in <code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code> only if <code class="docutils literal notranslate"><span class="pre">c</span></code> has a
payable fallback function. If you use the <a class="reference internal" href="index.html#withdrawal-pattern"><span class="std std-ref">withdraw pattern</span></a>,
you most likely do not have to change your code because <code class="docutils literal notranslate"><span class="pre">transfer</span></code>
is only used on <code class="docutils literal notranslate"><span class="pre">msg.sender</span></code> instead of stored addresses and <code class="docutils literal notranslate"><span class="pre">msg.sender</span></code>
is an <code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code>.</p></li>
<li><p>Conversions between <code class="docutils literal notranslate"><span class="pre">bytesX</span></code> and <code class="docutils literal notranslate"><span class="pre">uintY</span></code> of different size are now
disallowed due to <code class="docutils literal notranslate"><span class="pre">bytesX</span></code> padding on the right and <code class="docutils literal notranslate"><span class="pre">uintY</span></code> padding on
the left which may cause unexpected conversion results.  The size must now be
adjusted within the type before the conversion.  For example, you can convert
a <code class="docutils literal notranslate"><span class="pre">bytes4</span></code> (4 bytes) to a <code class="docutils literal notranslate"><span class="pre">uint64</span></code> (8 bytes) by first converting the
<code class="docutils literal notranslate"><span class="pre">bytes4</span></code> variable to <code class="docutils literal notranslate"><span class="pre">bytes8</span></code> and then to <code class="docutils literal notranslate"><span class="pre">uint64</span></code>. You get the
opposite padding when converting through <code class="docutils literal notranslate"><span class="pre">uint32</span></code>. Before v0.5.0 any
conversion between <code class="docutils literal notranslate"><span class="pre">bytesX</span></code> and <code class="docutils literal notranslate"><span class="pre">uintY</span></code> would go through <code class="docutils literal notranslate"><span class="pre">uint8X</span></code>. For
example <code class="docutils literal notranslate"><span class="pre">uint8(bytes3(0x291807))</span></code> would be converted to <code class="docutils literal notranslate"><span class="pre">uint8(uint24(bytes3(0x291807)))</span></code>
(the result is <code class="docutils literal notranslate"><span class="pre">0x07</span></code>).</p></li>
<li><p>Using <code class="docutils literal notranslate"><span class="pre">msg.value</span></code> in non-payable functions (or introducing it via a
modifier) is disallowed as a security feature. Turn the function into
<code class="docutils literal notranslate"><span class="pre">payable</span></code> or create a new internal function for the program logic that
uses <code class="docutils literal notranslate"><span class="pre">msg.value</span></code>.</p></li>
<li><p>For clarity reasons, the command line interface now requires <code class="docutils literal notranslate"><span class="pre">-</span></code> if the
standard input is used as source.</p></li>
</ul>
</section>
<section id="deprecated-elements">
<h3>Deprecated Elements<a class="headerlink" href="#deprecated-elements" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>This section lists changes that deprecate prior features or syntax.  Note that
many of these changes were already enabled in the experimental mode
<code class="docutils literal notranslate"><span class="pre">v0.5.0</span></code>.</p>
<section id="command-line-and-json-interfaces">
<h4>Command Line and JSON Interfaces<a class="headerlink" href="#command-line-and-json-interfaces" title="Permalink to this heading">ÔÉÅ</a></h4>
<ul class="simple">
<li><p>The command line option <code class="docutils literal notranslate"><span class="pre">--formal</span></code> (used to generate Why3 output for
further formal verification) was deprecated and is now removed.  A new
formal verification module, the SMTChecker, is enabled via <code class="docutils literal notranslate"><span class="pre">pragma</span>
<span class="pre">experimental</span> <span class="pre">SMTChecker;</span></code>.</p></li>
<li><p>The command line option <code class="docutils literal notranslate"><span class="pre">--julia</span></code> was renamed to <code class="docutils literal notranslate"><span class="pre">--yul</span></code> due to the
renaming of the intermediate language <code class="docutils literal notranslate"><span class="pre">Julia</span></code> to <code class="docutils literal notranslate"><span class="pre">Yul</span></code>.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">--clone-bin</span></code> and <code class="docutils literal notranslate"><span class="pre">--combined-json</span> <span class="pre">clone-bin</span></code> command line options
were removed.</p></li>
<li><p>Remappings with empty prefix are disallowed.</p></li>
<li><p>The JSON AST fields <code class="docutils literal notranslate"><span class="pre">constant</span></code> and <code class="docutils literal notranslate"><span class="pre">payable</span></code> were removed. The
information is now present in the <code class="docutils literal notranslate"><span class="pre">stateMutability</span></code> field.</p></li>
<li><p>The JSON AST field <code class="docutils literal notranslate"><span class="pre">isConstructor</span></code> of the <code class="docutils literal notranslate"><span class="pre">FunctionDefinition</span></code>
node was replaced by a field called <code class="docutils literal notranslate"><span class="pre">kind</span></code> which can have the
value <code class="docutils literal notranslate"><span class="pre">&quot;constructor&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;fallback&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;function&quot;</span></code>.</p></li>
<li><p>In unlinked binary hex files, library address placeholders are now
the first 36 hex characters of the keccak256 hash of the fully qualified
library name, surrounded by <code class="docutils literal notranslate"><span class="pre">$...$</span></code>. Previously,
just the fully qualified library name was used.
This reduces the chances of collisions, especially when long paths are used.
Binary files now also contain a list of mappings from these placeholders
to the fully qualified names.</p></li>
</ul>
</section>
<section id="constructors">
<h4>Constructors<a class="headerlink" href="#constructors" title="Permalink to this heading">ÔÉÅ</a></h4>
<ul class="simple">
<li><p>Constructors must now be defined using the <code class="docutils literal notranslate"><span class="pre">constructor</span></code> keyword.</p></li>
<li><p>Calling base constructors without parentheses is now disallowed.</p></li>
<li><p>Specifying base constructor arguments multiple times in the same inheritance
hierarchy is now disallowed.</p></li>
<li><p>Calling a constructor with arguments but with wrong argument count is now
disallowed.  If you only want to specify an inheritance relation without
giving arguments, do not provide parentheses at all.</p></li>
</ul>
</section>
<section id="functions">
<h4>Functions<a class="headerlink" href="#functions" title="Permalink to this heading">ÔÉÅ</a></h4>
<ul class="simple">
<li><p>Function <code class="docutils literal notranslate"><span class="pre">callcode</span></code> is now disallowed (in favor of <code class="docutils literal notranslate"><span class="pre">delegatecall</span></code>). It
is still possible to use it via inline assembly.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">suicide</span></code> is now disallowed (in favor of <code class="docutils literal notranslate"><span class="pre">selfdestruct</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sha3</span></code> is now disallowed (in favor of <code class="docutils literal notranslate"><span class="pre">keccak256</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">throw</span></code> is now disallowed (in favor of <code class="docutils literal notranslate"><span class="pre">revert</span></code>, <code class="docutils literal notranslate"><span class="pre">require</span></code> and
<code class="docutils literal notranslate"><span class="pre">assert</span></code>).</p></li>
</ul>
</section>
<section id="conversions">
<h4>Conversions<a class="headerlink" href="#conversions" title="Permalink to this heading">ÔÉÅ</a></h4>
<ul class="simple">
<li><p>Explicit and implicit conversions from decimal literals to <code class="docutils literal notranslate"><span class="pre">bytesXX</span></code> types
is now disallowed.</p></li>
<li><p>Explicit and implicit conversions from hex literals to <code class="docutils literal notranslate"><span class="pre">bytesXX</span></code> types
of different size is now disallowed.</p></li>
</ul>
</section>
<section id="literals-and-suffixes">
<h4>Literals and Suffixes<a class="headerlink" href="#literals-and-suffixes" title="Permalink to this heading">ÔÉÅ</a></h4>
<ul class="simple">
<li><p>The unit denomination <code class="docutils literal notranslate"><span class="pre">years</span></code> is now disallowed due to complications and
confusions about leap years.</p></li>
<li><p>Trailing dots that are not followed by a number are now disallowed.</p></li>
<li><p>Combining hex numbers with unit denominations (e.g. <code class="docutils literal notranslate"><span class="pre">0x1e</span> <span class="pre">wei</span></code>) is now
disallowed.</p></li>
<li><p>The prefix <code class="docutils literal notranslate"><span class="pre">0X</span></code> for hex numbers is disallowed, only <code class="docutils literal notranslate"><span class="pre">0x</span></code> is possible.</p></li>
</ul>
</section>
<section id="variables">
<h4>Variables<a class="headerlink" href="#variables" title="Permalink to this heading">ÔÉÅ</a></h4>
<ul class="simple">
<li><p>Declaring empty structs is now disallowed for clarity.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">var</span></code> keyword is now disallowed to favor explicitness.</p></li>
<li><p>Assignments between tuples with different number of components is now
disallowed.</p></li>
<li><p>Values for constants that are not compile-time constants are disallowed.</p></li>
<li><p>Multi-variable declarations with mismatching number of values are now
disallowed.</p></li>
<li><p>Uninitialized storage variables are now disallowed.</p></li>
<li><p>Empty tuple components are now disallowed.</p></li>
<li><p>Detecting cyclic dependencies in variables and structs is limited in
recursion to 256.</p></li>
<li><p>Fixed-size arrays with a length of zero are now disallowed.</p></li>
</ul>
</section>
<section id="syntax">
<h4>Syntax<a class="headerlink" href="#syntax" title="Permalink to this heading">ÔÉÅ</a></h4>
<ul class="simple">
<li><p>Using <code class="docutils literal notranslate"><span class="pre">constant</span></code> as function state mutability modifier is now disallowed.</p></li>
<li><p>Boolean expressions cannot use arithmetic operations.</p></li>
<li><p>The unary <code class="docutils literal notranslate"><span class="pre">+</span></code> operator is now disallowed.</p></li>
<li><p>Literals cannot anymore be used with <code class="docutils literal notranslate"><span class="pre">abi.encodePacked</span></code> without prior
conversion to an explicit type.</p></li>
<li><p>Empty return statements for functions with one or more return values are now
disallowed.</p></li>
<li><p>The ‚Äúloose assembly‚Äù syntax is now disallowed entirely, that is, jump labels,
jumps and non-functional instructions cannot be used anymore. Use the new
<code class="docutils literal notranslate"><span class="pre">while</span></code>, <code class="docutils literal notranslate"><span class="pre">switch</span></code> and <code class="docutils literal notranslate"><span class="pre">if</span></code> constructs instead.</p></li>
<li><p>Functions without implementation cannot use modifiers anymore.</p></li>
<li><p>Function types with named return values are now disallowed.</p></li>
<li><p>Single statement variable declarations inside if/while/for bodies that are
not blocks are now disallowed.</p></li>
<li><p>New keywords: <code class="docutils literal notranslate"><span class="pre">calldata</span></code> and <code class="docutils literal notranslate"><span class="pre">constructor</span></code>.</p></li>
<li><p>New reserved keywords: <code class="docutils literal notranslate"><span class="pre">alias</span></code>, <code class="docutils literal notranslate"><span class="pre">apply</span></code>, <code class="docutils literal notranslate"><span class="pre">auto</span></code>, <code class="docutils literal notranslate"><span class="pre">copyof</span></code>,
<code class="docutils literal notranslate"><span class="pre">define</span></code>, <code class="docutils literal notranslate"><span class="pre">immutable</span></code>, <code class="docutils literal notranslate"><span class="pre">implements</span></code>, <code class="docutils literal notranslate"><span class="pre">macro</span></code>, <code class="docutils literal notranslate"><span class="pre">mutable</span></code>,
<code class="docutils literal notranslate"><span class="pre">override</span></code>, <code class="docutils literal notranslate"><span class="pre">partial</span></code>, <code class="docutils literal notranslate"><span class="pre">promise</span></code>, <code class="docutils literal notranslate"><span class="pre">reference</span></code>, <code class="docutils literal notranslate"><span class="pre">sealed</span></code>,
<code class="docutils literal notranslate"><span class="pre">sizeof</span></code>, <code class="docutils literal notranslate"><span class="pre">supports</span></code>, <code class="docutils literal notranslate"><span class="pre">typedef</span></code> and <code class="docutils literal notranslate"><span class="pre">unchecked</span></code>.</p></li>
</ul>
</section>
</section>
<section id="interoperability-with-older-contracts">
<span id="interoperability"></span><h3>Interoperability With Older Contracts<a class="headerlink" href="#interoperability-with-older-contracts" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>It is still possible to interface with contracts written for Solidity versions prior to
v0.5.0 (or the other way around) by defining interfaces for them.
Consider you have the following pre-0.5.0 contract already deployed:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMjU7Ci8vIFRoaXMgd2lsbCByZXBvcnQgYSB3YXJuaW5nIHVudGlsIHZlcnNpb24gMC40LjI1IG9mIHRoZSBjb21waWxlcgovLyBUaGlzIHdpbGwgbm90IGNvbXBpbGUgYWZ0ZXIgMC41LjAKY29udHJhY3QgT2xkQ29udHJhY3QgewogICAgZnVuY3Rpb24gc29tZU9sZEZ1bmN0aW9uKHVpbnQ4IGEpIHsKICAgICAgICAvLy4uLgogICAgfQogICAgZnVuY3Rpb24gYW5vdGhlck9sZEZ1bmN0aW9uKCkgY29uc3RhbnQgcmV0dXJucyAoYm9vbCkgewogICAgICAgIC8vLi4uCiAgICB9CiAgICAvLyAuLi4KfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.4.25</span><span class="p">;</span><span class="w"></span>
<span class="c1">// This will report a warning until version 0.4.25 of the compiler</span>
<span class="c1">// This will not compile after 0.5.0</span>
<span class="k">contract</span><span class="w"> </span><span class="ni">OldContract</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">someOldFunction</span><span class="p">(</span><span class="kt">uint8</span><span class="w"> </span><span class="nv">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">//...</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">anotherOldFunction</span><span class="p">()</span><span class="w"> </span><span class="kt">constant</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">//...</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>This will no longer compile with Solidity v0.5.0. However, you can define a compatible interface for it:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC41LjAgPDAuOS4wOwppbnRlcmZhY2UgT2xkQ29udHJhY3QgewogICAgZnVuY3Rpb24gc29tZU9sZEZ1bmN0aW9uKHVpbnQ4IGEpIGV4dGVybmFsOwogICAgZnVuY3Rpb24gYW5vdGhlck9sZEZ1bmN0aW9uKCkgZXh0ZXJuYWwgcmV0dXJucyAoYm9vbCk7Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.5.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>
interface<span class="w"> </span>OldContract<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">someOldFunction</span><span class="p">(</span><span class="kt">uint8</span><span class="w"> </span><span class="nv">a</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">anotherOldFunction</span><span class="p">()</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Note that we did not declare <code class="docutils literal notranslate"><span class="pre">anotherOldFunction</span></code> to be <code class="docutils literal notranslate"><span class="pre">view</span></code>, despite it being declared <code class="docutils literal notranslate"><span class="pre">constant</span></code> in the original
contract. This is due to the fact that starting with Solidity v0.5.0 <code class="docutils literal notranslate"><span class="pre">staticcall</span></code> is used to call <code class="docutils literal notranslate"><span class="pre">view</span></code> functions.
Prior to v0.5.0 the <code class="docutils literal notranslate"><span class="pre">constant</span></code> keyword was not enforced, so calling a function declared <code class="docutils literal notranslate"><span class="pre">constant</span></code> with <code class="docutils literal notranslate"><span class="pre">staticcall</span></code>
may still revert, since the <code class="docutils literal notranslate"><span class="pre">constant</span></code> function may still attempt to modify storage. Consequently, when defining an
interface for older contracts, you should only use <code class="docutils literal notranslate"><span class="pre">view</span></code> in place of <code class="docutils literal notranslate"><span class="pre">constant</span></code> in case you are absolutely sure that
the function will work with <code class="docutils literal notranslate"><span class="pre">staticcall</span></code>.</p>
<p>Given the interface defined above, you can now easily use the already deployed pre-0.5.0 contract:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC41LjAgPDAuOS4wOwoKaW50ZXJmYWNlIE9sZENvbnRyYWN0IHsKICAgIGZ1bmN0aW9uIHNvbWVPbGRGdW5jdGlvbih1aW50OCBhKSBleHRlcm5hbDsKICAgIGZ1bmN0aW9uIGFub3RoZXJPbGRGdW5jdGlvbigpIGV4dGVybmFsIHJldHVybnMgKGJvb2wpOwp9Cgpjb250cmFjdCBOZXdDb250cmFjdCB7CiAgICBmdW5jdGlvbiBkb1NvbWV0aGluZyhPbGRDb250cmFjdCBhKSBwdWJsaWMgcmV0dXJucyAoYm9vbCkgewogICAgICAgIGEuc29tZU9sZEZ1bmN0aW9uKDB4NDIpOwogICAgICAgIHJldHVybiBhLmFub3RoZXJPbGRGdW5jdGlvbigpOwogICAgfQp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.5.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

interface<span class="w"> </span>OldContract<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">someOldFunction</span><span class="p">(</span><span class="kt">uint8</span><span class="w"> </span><span class="nv">a</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">anotherOldFunction</span><span class="p">()</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">NewContract</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">doSomething</span><span class="p">(</span>OldContract<span class="w"> </span>a<span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>a<span class="p">.</span>someOldFunction<span class="p">(</span><span class="mh">0x42</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>a<span class="p">.</span>anotherOldFunction<span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Similarly, pre-0.5.0 libraries can be used by defining the functions of the library without implementation and
supplying the address of the pre-0.5.0 library during linking (see <a class="reference internal" href="index.html#commandline-compiler"><span class="std std-ref">Using the Commandline Compiler</span></a> for how to use the
commandline compiler for linking):</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gVGhpcyB3aWxsIG5vdCBjb21waWxlIGFmdGVyIDAuNi4wCi8vIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBHUEwtMy4wCnByYWdtYSBzb2xpZGl0eSBeMC41LjA7CgpsaWJyYXJ5IE9sZExpYnJhcnkgewogICAgZnVuY3Rpb24gc29tZUZ1bmN0aW9uKHVpbnQ4IGEpIHB1YmxpYyByZXR1cm5zKGJvb2wpOwp9Cgpjb250cmFjdCBOZXdDb250cmFjdCB7CiAgICBmdW5jdGlvbiBmKHVpbnQ4IGEpIHB1YmxpYyByZXR1cm5zIChib29sKSB7CiAgICAgICAgcmV0dXJuIE9sZExpYnJhcnkuc29tZUZ1bmN0aW9uKGEpOwogICAgfQp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// This will not compile after 0.6.0</span>
<span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.5.0</span><span class="p">;</span><span class="w"></span>

<span class="kt">library</span><span class="w"> </span>OldLibrary<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">someFunction</span><span class="p">(</span><span class="kt">uint8</span><span class="w"> </span><span class="nv">a</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="kt">returns</span><span class="p">(</span><span class="kt">bool</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">NewContract</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">f</span><span class="p">(</span><span class="kt">uint8</span><span class="w"> </span><span class="nv">a</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>OldLibrary<span class="p">.</span>someFunction<span class="p">(</span>a<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="example">
<h3>Example<a class="headerlink" href="#example" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>The following example shows a contract and its updated version for Solidity
v0.5.0 with some of the changes listed in this section.</p>
<p>Old version:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5IF4wLjQuMjU7Ci8vIFRoaXMgd2lsbCBub3QgY29tcGlsZSBhZnRlciAwLjUuMAoKY29udHJhY3QgT3RoZXJDb250cmFjdCB7CiAgICB1aW50IHg7CiAgICBmdW5jdGlvbiBmKHVpbnQgeSkgZXh0ZXJuYWwgewogICAgICAgIHggPSB5OwogICAgfQogICAgZnVuY3Rpb24oKSBwYXlhYmxlIGV4dGVybmFsIHt9Cn0KCmNvbnRyYWN0IE9sZCB7CiAgICBPdGhlckNvbnRyYWN0IG90aGVyOwogICAgdWludCBteU51bWJlcjsKCiAgICAvLyBGdW5jdGlvbiBtdXRhYmlsaXR5IG5vdCBwcm92aWRlZCwgbm90IGFuIGVycm9yLgogICAgZnVuY3Rpb24gc29tZUludGVnZXIoKSBpbnRlcm5hbCByZXR1cm5zICh1aW50KSB7IHJldHVybiAyOyB9CgogICAgLy8gRnVuY3Rpb24gdmlzaWJpbGl0eSBub3QgcHJvdmlkZWQsIG5vdCBhbiBlcnJvci4KICAgIC8vIEZ1bmN0aW9uIG11dGFiaWxpdHkgbm90IHByb3ZpZGVkLCBub3QgYW4gZXJyb3IuCiAgICBmdW5jdGlvbiBmKHVpbnQgeCkgcmV0dXJucyAoYnl0ZXMpIHsKICAgICAgICAvLyBWYXIgaXMgZmluZSBpbiB0aGlzIHZlcnNpb24uCiAgICAgICAgdmFyIHogPSBzb21lSW50ZWdlcigpOwogICAgICAgIHggKz0gejsKICAgICAgICAvLyBUaHJvdyBpcyBmaW5lIGluIHRoaXMgdmVyc2lvbi4KICAgICAgICBpZiAoeCA+IDEwMCkKICAgICAgICAgICAgdGhyb3c7CiAgICAgICAgYnl0ZXMgbWVtb3J5IGIgPSBuZXcgYnl0ZXMoeCk7CiAgICAgICAgeSA9IC0zID4+IDE7CiAgICAgICAgLy8geSA9PSAtMSAod3JvbmcsIHNob3VsZCBiZSAtMikKICAgICAgICBkbyB7CiAgICAgICAgICAgIHggKz0gMTsKICAgICAgICAgICAgaWYgKHggPiAxMCkgY29udGludWU7CiAgICAgICAgICAgIC8vICdDb250aW51ZScgY2F1c2VzIGFuIGluZmluaXRlIGxvb3AuCiAgICAgICAgfSB3aGlsZSAoeCA8IDExKTsKICAgICAgICAvLyBDYWxsIHJldHVybnMgb25seSBhIEJvb2wuCiAgICAgICAgYm9vbCBzdWNjZXNzID0gYWRkcmVzcyhvdGhlcikuY2FsbCgiZiIpOwogICAgICAgIGlmICghc3VjY2VzcykKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIC8vIExvY2FsIHZhcmlhYmxlcyBjb3VsZCBiZSBkZWNsYXJlZCBhZnRlciB0aGVpciB1c2UuCiAgICAgICAgICAgIGludCB5OwogICAgICAgIH0KICAgICAgICByZXR1cm4gYjsKICAgIH0KCiAgICAvLyBObyBuZWVkIGZvciBhbiBleHBsaWNpdCBkYXRhIGxvY2F0aW9uIGZvciAnYXJyJwogICAgZnVuY3Rpb24gZyh1aW50W10gYXJyLCBieXRlczggeCwgT3RoZXJDb250cmFjdCBvdGhlckNvbnRyYWN0KSBwdWJsaWMgewogICAgICAgIG90aGVyQ29udHJhY3QudHJhbnNmZXIoMSBldGhlcik7CgogICAgICAgIC8vIFNpbmNlIHVpbnQzMiAoNCBieXRlcykgaXMgc21hbGxlciB0aGFuIGJ5dGVzOCAoOCBieXRlcyksCiAgICAgICAgLy8gdGhlIGZpcnN0IDQgYnl0ZXMgb2YgeCB3aWxsIGJlIGxvc3QuIFRoaXMgbWlnaHQgbGVhZCB0bwogICAgICAgIC8vIHVuZXhwZWN0ZWQgYmVoYXZpb3Igc2luY2UgYnl0ZXNYIGFyZSByaWdodCBwYWRkZWQuCiAgICAgICAgdWludDMyIHkgPSB1aW50MzIoeCk7CiAgICAgICAgbXlOdW1iZXIgKz0geSArIG1zZy52YWx1ZTsKICAgIH0KfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.4.25</span><span class="p">;</span><span class="w"></span>
<span class="c1">// This will not compile after 0.5.0</span>

<span class="k">contract</span><span class="w"> </span><span class="ni">OtherContract</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="nv">x</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">f</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">y</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>x<span class="w"> </span><span class="o">=</span><span class="w"> </span>y<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="p">()</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Old</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span>OtherContract<span class="w"> </span>other<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="nv">myNumber</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Function mutability not provided, not an error.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">someInteger</span><span class="p">()</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kt">return</span><span class="w"> </span><span class="m m-Decimal">2</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Function visibility not provided, not an error.</span>
<span class="w">    </span><span class="c1">// Function mutability not provided, not an error.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">f</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">x</span><span class="p">)</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bytes</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Var is fine in this version.</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span>z<span class="w"> </span><span class="o">=</span><span class="w"> </span>someInteger<span class="p">();</span><span class="w"></span>
<span class="w">        </span>x<span class="w"> </span><span class="o">+=</span><span class="w"> </span>z<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Throw is fine in this version.</span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>x<span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m m-Decimal">100</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="kt">throw</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">bytes</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>b<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="kt">bytes</span><span class="p">(</span>x<span class="p">);</span><span class="w"></span>
<span class="w">        </span>y<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="m m-Decimal">3</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="c1">// y == -1 (wrong, should be -2)</span>
<span class="w">        </span><span class="kt">do</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span>x<span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>x<span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m m-Decimal">10</span><span class="p">)</span><span class="w"> </span><span class="kt">continue</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="c1">// &#39;Continue&#39; causes an infinite loop.</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="kt">while</span><span class="w"> </span><span class="p">(</span>x<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m m-Decimal">11</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Call returns only a Bool.</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="nv">success</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">address</span><span class="p">(</span>other<span class="p">).</span>call<span class="p">(</span><span class="s2">&quot;f&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span>success<span class="p">)</span><span class="w"></span>
<span class="w">            </span>revert<span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="kt">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="c1">// Local variables could be declared after their use.</span>
<span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="nv">y</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>b<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">// No need for an explicit data location for &#39;arr&#39;</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">g</span><span class="p">(</span><span class="kt">uint</span><span class="p">[]</span><span class="w"> </span>arr<span class="p">,</span><span class="w"> </span><span class="kt">bytes8</span><span class="w"> </span><span class="nv">x</span><span class="p">,</span><span class="w"> </span>OtherContract<span class="w"> </span>otherContract<span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>otherContract<span class="p">.</span>transfer<span class="p">(</span><span class="m m-Decimal">1</span><span class="w"> </span>ether<span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="c1">// Since uint32 (4 bytes) is smaller than bytes8 (8 bytes),</span>
<span class="w">        </span><span class="c1">// the first 4 bytes of x will be lost. This might lead to</span>
<span class="w">        </span><span class="c1">// unexpected behavior since bytesX are right padded.</span>
<span class="w">        </span><span class="kt">uint32</span><span class="w"> </span><span class="nv">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">uint32</span><span class="p">(</span>x<span class="p">);</span><span class="w"></span>
<span class="w">        </span>myNumber<span class="w"> </span><span class="o">+=</span><span class="w"> </span>y<span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">msg.value</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>New version:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5IF4wLjUuMDsKLy8gVGhpcyB3aWxsIG5vdCBjb21waWxlIGFmdGVyIDAuNi4wCgpjb250cmFjdCBPdGhlckNvbnRyYWN0IHsKICAgIHVpbnQgeDsKICAgIGZ1bmN0aW9uIGYodWludCB5KSBleHRlcm5hbCB7CiAgICAgICAgeCA9IHk7CiAgICB9CiAgICBmdW5jdGlvbigpIHBheWFibGUgZXh0ZXJuYWwge30KfQoKY29udHJhY3QgTmV3IHsKICAgIE90aGVyQ29udHJhY3Qgb3RoZXI7CiAgICB1aW50IG15TnVtYmVyOwoKICAgIC8vIEZ1bmN0aW9uIG11dGFiaWxpdHkgbXVzdCBiZSBzcGVjaWZpZWQuCiAgICBmdW5jdGlvbiBzb21lSW50ZWdlcigpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCkgeyByZXR1cm4gMjsgfQoKICAgIC8vIEZ1bmN0aW9uIHZpc2liaWxpdHkgbXVzdCBiZSBzcGVjaWZpZWQuCiAgICAvLyBGdW5jdGlvbiBtdXRhYmlsaXR5IG11c3QgYmUgc3BlY2lmaWVkLgogICAgZnVuY3Rpb24gZih1aW50IHgpIHB1YmxpYyByZXR1cm5zIChieXRlcyBtZW1vcnkpIHsKICAgICAgICAvLyBUaGUgdHlwZSBtdXN0IG5vdyBiZSBleHBsaWNpdGx5IGdpdmVuLgogICAgICAgIHVpbnQgeiA9IHNvbWVJbnRlZ2VyKCk7CiAgICAgICAgeCArPSB6OwogICAgICAgIC8vIFRocm93IGlzIG5vdyBkaXNhbGxvd2VkLgogICAgICAgIHJlcXVpcmUoeCA8PSAxMDApOwogICAgICAgIGludCB5ID0gLTMgPj4gMTsKICAgICAgICByZXF1aXJlKHkgPT0gLTIpOwogICAgICAgIGRvIHsKICAgICAgICAgICAgeCArPSAxOwogICAgICAgICAgICBpZiAoeCA+IDEwKSBjb250aW51ZTsKICAgICAgICAgICAgLy8gJ0NvbnRpbnVlJyBqdW1wcyB0byB0aGUgY29uZGl0aW9uIGJlbG93LgogICAgICAgIH0gd2hpbGUgKHggPCAxMSk7CgogICAgICAgIC8vIENhbGwgcmV0dXJucyAoYm9vbCwgYnl0ZXMpLgogICAgICAgIC8vIERhdGEgbG9jYXRpb24gbXVzdCBiZSBzcGVjaWZpZWQuCiAgICAgICAgKGJvb2wgc3VjY2VzcywgYnl0ZXMgbWVtb3J5IGRhdGEpID0gYWRkcmVzcyhvdGhlcikuY2FsbCgiZiIpOwogICAgICAgIGlmICghc3VjY2VzcykKICAgICAgICAgICAgcmV2ZXJ0KCk7CiAgICAgICAgcmV0dXJuIGRhdGE7CiAgICB9CgogICAgdXNpbmcgQWRkcmVzc01ha2VQYXlhYmxlIGZvciBhZGRyZXNzOwogICAgLy8gRGF0YSBsb2NhdGlvbiBmb3IgJ2FycicgbXVzdCBiZSBzcGVjaWZpZWQKICAgIGZ1bmN0aW9uIGcodWludFtdIG1lbW9yeSAvKiBhcnIgKi8sIGJ5dGVzOCB4LCBPdGhlckNvbnRyYWN0IG90aGVyQ29udHJhY3QsIGFkZHJlc3MgdW5rbm93bkNvbnRyYWN0KSBwdWJsaWMgcGF5YWJsZSB7CiAgICAgICAgLy8gJ290aGVyQ29udHJhY3QudHJhbnNmZXInIGlzIG5vdCBwcm92aWRlZC4KICAgICAgICAvLyBTaW5jZSB0aGUgY29kZSBvZiAnT3RoZXJDb250cmFjdCcgaXMga25vd24gYW5kIGhhcyB0aGUgZmFsbGJhY2sKICAgICAgICAvLyBmdW5jdGlvbiwgYWRkcmVzcyhvdGhlckNvbnRyYWN0KSBoYXMgdHlwZSAnYWRkcmVzcyBwYXlhYmxlJy4KICAgICAgICBhZGRyZXNzKG90aGVyQ29udHJhY3QpLnRyYW5zZmVyKDEgZXRoZXIpOwoKICAgICAgICAvLyAndW5rbm93bkNvbnRyYWN0LnRyYW5zZmVyJyBpcyBub3QgcHJvdmlkZWQuCiAgICAgICAgLy8gJ2FkZHJlc3ModW5rbm93bkNvbnRyYWN0KS50cmFuc2ZlcicgaXMgbm90IHByb3ZpZGVkCiAgICAgICAgLy8gc2luY2UgJ2FkZHJlc3ModW5rbm93bkNvbnRyYWN0KScgaXMgbm90ICdhZGRyZXNzIHBheWFibGUnLgogICAgICAgIC8vIElmIHRoZSBmdW5jdGlvbiB0YWtlcyBhbiAnYWRkcmVzcycgd2hpY2ggeW91IHdhbnQgdG8gc2VuZAogICAgICAgIC8vIGZ1bmRzIHRvLCB5b3UgY2FuIGNvbnZlcnQgaXQgdG8gJ2FkZHJlc3MgcGF5YWJsZScgdmlhICd1aW50MTYwJy4KICAgICAgICAvLyBOb3RlOiBUaGlzIGlzIG5vdCByZWNvbW1lbmRlZCBhbmQgdGhlIGV4cGxpY2l0IHR5cGUKICAgICAgICAvLyAnYWRkcmVzcyBwYXlhYmxlJyBzaG91bGQgYmUgdXNlZCB3aGVuZXZlciBwb3NzaWJsZS4KICAgICAgICAvLyBUbyBpbmNyZWFzZSBjbGFyaXR5LCB3ZSBzdWdnZXN0IHRoZSB1c2Ugb2YgYSBsaWJyYXJ5IGZvcgogICAgICAgIC8vIHRoZSBjb252ZXJzaW9uIChwcm92aWRlZCBhZnRlciB0aGUgY29udHJhY3QgaW4gdGhpcyBleGFtcGxlKS4KICAgICAgICBhZGRyZXNzIHBheWFibGUgYWRkciA9IHVua25vd25Db250cmFjdC5tYWtlUGF5YWJsZSgpOwogICAgICAgIHJlcXVpcmUoYWRkci5zZW5kKDEgZXRoZXIpKTsKCiAgICAgICAgLy8gU2luY2UgdWludDMyICg0IGJ5dGVzKSBpcyBzbWFsbGVyIHRoYW4gYnl0ZXM4ICg4IGJ5dGVzKSwKICAgICAgICAvLyB0aGUgY29udmVyc2lvbiBpcyBub3QgYWxsb3dlZC4KICAgICAgICAvLyBXZSBuZWVkIHRvIGNvbnZlcnQgdG8gYSBjb21tb24gc2l6ZSBmaXJzdDoKICAgICAgICBieXRlczQgeDQgPSBieXRlczQoeCk7IC8vIFBhZGRpbmcgaGFwcGVucyBvbiB0aGUgcmlnaHQKICAgICAgICB1aW50MzIgeSA9IHVpbnQzMih4NCk7IC8vIENvbnZlcnNpb24gaXMgY29uc2lzdGVudAogICAgICAgIC8vICdtc2cudmFsdWUnIGNhbm5vdCBiZSB1c2VkIGluIGEgJ25vbi1wYXlhYmxlJyBmdW5jdGlvbi4KICAgICAgICAvLyBXZSBuZWVkIHRvIG1ha2UgdGhlIGZ1bmN0aW9uIHBheWFibGUKICAgICAgICBteU51bWJlciArPSB5ICsgbXNnLnZhbHVlOwogICAgfQp9CgovLyBXZSBjYW4gZGVmaW5lIGEgbGlicmFyeSBmb3IgZXhwbGljaXRseSBjb252ZXJ0aW5nIGBgYWRkcmVzc2BgCi8vIHRvIGBgYWRkcmVzcyBwYXlhYmxlYGAgYXMgYSB3b3JrYXJvdW5kLgpsaWJyYXJ5IEFkZHJlc3NNYWtlUGF5YWJsZSB7CiAgICBmdW5jdGlvbiBtYWtlUGF5YWJsZShhZGRyZXNzIHgpIGludGVybmFsIHB1cmUgcmV0dXJucyAoYWRkcmVzcyBwYXlhYmxlKSB7CiAgICAgICAgcmV0dXJuIGFkZHJlc3ModWludDE2MCh4KSk7CiAgICB9Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.5.0</span><span class="p">;</span><span class="w"></span>
<span class="c1">// This will not compile after 0.6.0</span>

<span class="k">contract</span><span class="w"> </span><span class="ni">OtherContract</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="nv">x</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">f</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">y</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>x<span class="w"> </span><span class="o">=</span><span class="w"> </span>y<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="p">()</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">New</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span>OtherContract<span class="w"> </span>other<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="nv">myNumber</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Function mutability must be specified.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">someInteger</span><span class="p">()</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kt">return</span><span class="w"> </span><span class="m m-Decimal">2</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Function visibility must be specified.</span>
<span class="w">    </span><span class="c1">// Function mutability must be specified.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">f</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">x</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bytes</span><span class="w"> </span><span class="nv">memory</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// The type must now be explicitly given.</span>
<span class="w">        </span><span class="kt">uint</span><span class="w"> </span><span class="nv">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>someInteger<span class="p">();</span><span class="w"></span>
<span class="w">        </span>x<span class="w"> </span><span class="o">+=</span><span class="w"> </span>z<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Throw is now disallowed.</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>x<span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="m m-Decimal">100</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="nv">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="m m-Decimal">3</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>y<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">-</span><span class="m m-Decimal">2</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">do</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span>x<span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>x<span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m m-Decimal">10</span><span class="p">)</span><span class="w"> </span><span class="kt">continue</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="c1">// &#39;Continue&#39; jumps to the condition below.</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="kt">while</span><span class="w"> </span><span class="p">(</span>x<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m m-Decimal">11</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="c1">// Call returns (bool, bytes).</span>
<span class="w">        </span><span class="c1">// Data location must be specified.</span>
<span class="w">        </span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="nv">success</span><span class="p">,</span><span class="w"> </span><span class="kt">bytes</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>data<span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">address</span><span class="p">(</span>other<span class="p">).</span>call<span class="p">(</span><span class="s2">&quot;f&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span>success<span class="p">)</span><span class="w"></span>
<span class="w">            </span>revert<span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>data<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span>using<span class="w"> </span>AddressMakePayable<span class="w"> </span><span class="kt">for</span><span class="w"> </span><span class="kt">address</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Data location for &#39;arr&#39; must be specified</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">g</span><span class="p">(</span><span class="kt">uint</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span><span class="cm">/* arr */</span><span class="p">,</span><span class="w"> </span><span class="kt">bytes8</span><span class="w"> </span><span class="nv">x</span><span class="p">,</span><span class="w"> </span>OtherContract<span class="w"> </span>otherContract<span class="p">,</span><span class="w"> </span><span class="kt">address</span><span class="w"> </span><span class="nv">unknownContract</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// &#39;otherContract.transfer&#39; is not provided.</span>
<span class="w">        </span><span class="c1">// Since the code of &#39;OtherContract&#39; is known and has the fallback</span>
<span class="w">        </span><span class="c1">// function, address(otherContract) has type &#39;address payable&#39;.</span>
<span class="w">        </span><span class="kt">address</span><span class="p">(</span>otherContract<span class="p">).</span>transfer<span class="p">(</span><span class="m m-Decimal">1</span><span class="w"> </span>ether<span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="c1">// &#39;unknownContract.transfer&#39; is not provided.</span>
<span class="w">        </span><span class="c1">// &#39;address(unknownContract).transfer&#39; is not provided</span>
<span class="w">        </span><span class="c1">// since &#39;address(unknownContract)&#39; is not &#39;address payable&#39;.</span>
<span class="w">        </span><span class="c1">// If the function takes an &#39;address&#39; which you want to send</span>
<span class="w">        </span><span class="c1">// funds to, you can convert it to &#39;address payable&#39; via &#39;uint160&#39;.</span>
<span class="w">        </span><span class="c1">// Note: This is not recommended and the explicit type</span>
<span class="w">        </span><span class="c1">// &#39;address payable&#39; should be used whenever possible.</span>
<span class="w">        </span><span class="c1">// To increase clarity, we suggest the use of a library for</span>
<span class="w">        </span><span class="c1">// the conversion (provided after the contract in this example).</span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">payable</span><span class="w"> </span>addr<span class="w"> </span><span class="o">=</span><span class="w"> </span>unknownContract<span class="p">.</span>makePayable<span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>addr<span class="p">.</span>send<span class="p">(</span><span class="m m-Decimal">1</span><span class="w"> </span>ether<span class="p">));</span><span class="w"></span>

<span class="w">        </span><span class="c1">// Since uint32 (4 bytes) is smaller than bytes8 (8 bytes),</span>
<span class="w">        </span><span class="c1">// the conversion is not allowed.</span>
<span class="w">        </span><span class="c1">// We need to convert to a common size first:</span>
<span class="w">        </span>bytes4<span class="w"> </span>x4<span class="w"> </span><span class="o">=</span><span class="w"> </span>bytes4<span class="p">(</span>x<span class="p">);</span><span class="w"> </span><span class="c1">// Padding happens on the right</span>
<span class="w">        </span><span class="kt">uint32</span><span class="w"> </span><span class="nv">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">uint32</span><span class="p">(</span>x4<span class="p">);</span><span class="w"> </span><span class="c1">// Conversion is consistent</span>
<span class="w">        </span><span class="c1">// &#39;msg.value&#39; cannot be used in a &#39;non-payable&#39; function.</span>
<span class="w">        </span><span class="c1">// We need to make the function payable</span>
<span class="w">        </span>myNumber<span class="w"> </span><span class="o">+=</span><span class="w"> </span>y<span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">msg.value</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// We can define a library for explicitly converting ``address``</span>
<span class="c1">// to ``address payable`` as a workaround.</span>
<span class="kt">library</span><span class="w"> </span>AddressMakePayable<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">makePayable</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">x</span><span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">payable</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span><span class="kt">address</span><span class="p">(</span><span class="kt">uint160</span><span class="p">(</span>x<span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
<span id="document-060-breaking-changes"></span><section id="solidity-v0-6-0-breaking-changes">
<h2>Solidity v0.6.0 Breaking Changes<a class="headerlink" href="#solidity-v0-6-0-breaking-changes" title="Permalink to this heading">ÔÉÅ</a></h2>
<p>This section highlights the main breaking changes introduced in Solidity
version 0.6.0, along with the reasoning behind the changes and how to update
affected code.
For the full list check
<a class="reference external" href="https://github.com/ethereum/solidity/releases/tag/v0.6.0">the release changelog</a>.</p>
<section id="changes-the-compiler-might-not-warn-about">
<h3>Changes the Compiler Might not Warn About<a class="headerlink" href="#changes-the-compiler-might-not-warn-about" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>This section lists changes where the behaviour of your code might
change without the compiler telling you about it.</p>
<ul class="simple">
<li><p>The resulting type of an exponentiation is the type of the base. It used to be the smallest type
that can hold both the type of the base and the type of the exponent, as with symmetric
operations. Additionally, signed types are allowed for the base of the exponentiation.</p></li>
</ul>
</section>
<section id="explicitness-requirements">
<h3>Explicitness Requirements<a class="headerlink" href="#explicitness-requirements" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>This section lists changes where the code now needs to be more explicit,
but the semantics do not change.
For most of the topics the compiler will provide suggestions.</p>
<ul class="simple">
<li><p>Functions can now only be overridden when they are either marked with the
<code class="docutils literal notranslate"><span class="pre">virtual</span></code> keyword or defined in an interface. Functions without
implementation outside an interface have to be marked <code class="docutils literal notranslate"><span class="pre">virtual</span></code>.
When overriding a function or modifier, the new keyword <code class="docutils literal notranslate"><span class="pre">override</span></code>
must be used. When overriding a function or modifier defined in multiple
parallel bases, all bases must be listed in parentheses after the keyword
like so: <code class="docutils literal notranslate"><span class="pre">override(Base1,</span> <span class="pre">Base2)</span></code>.</p></li>
<li><p>Member-access to <code class="docutils literal notranslate"><span class="pre">length</span></code> of arrays is now always read-only, even for storage arrays. It is no
longer possible to resize storage arrays by assigning a new value to their length. Use <code class="docutils literal notranslate"><span class="pre">push()</span></code>,
<code class="docutils literal notranslate"><span class="pre">push(value)</span></code> or <code class="docutils literal notranslate"><span class="pre">pop()</span></code> instead, or assign a full array, which will of course overwrite the existing content.
The reason behind this is to prevent storage collisions of gigantic
storage arrays.</p></li>
<li><p>The new keyword <code class="docutils literal notranslate"><span class="pre">abstract</span></code> can be used to mark contracts as abstract. It has to be used
if a contract does not implement all its functions. Abstract contracts cannot be created using the <code class="docutils literal notranslate"><span class="pre">new</span></code> operator,
and it is not possible to generate bytecode for them during compilation.</p></li>
<li><p>Libraries have to implement all their functions, not only the internal ones.</p></li>
<li><p>The names of variables declared in inline assembly may no longer end in <code class="docutils literal notranslate"><span class="pre">_slot</span></code> or <code class="docutils literal notranslate"><span class="pre">_offset</span></code>.</p></li>
<li><p>Variable declarations in inline assembly may no longer shadow any declaration outside the inline assembly block.
If the name contains a dot, its prefix up to the dot may not conflict with any declaration outside the inline
assembly block.</p></li>
<li><p>State variable shadowing is now disallowed.  A derived contract can only
declare a state variable <code class="docutils literal notranslate"><span class="pre">x</span></code>, if there is no visible state variable with
the same name in any of its bases.</p></li>
</ul>
</section>
<section id="semantic-and-syntactic-changes">
<h3>Semantic and Syntactic Changes<a class="headerlink" href="#semantic-and-syntactic-changes" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>This section lists changes where you have to modify your code
and it does something else afterwards.</p>
<ul class="simple">
<li><p>Conversions from external function types to <code class="docutils literal notranslate"><span class="pre">address</span></code> are now disallowed. Instead external
function types have a member called <code class="docutils literal notranslate"><span class="pre">address</span></code>, similar to the existing <code class="docutils literal notranslate"><span class="pre">selector</span></code> member.</p></li>
<li><p>The function <code class="docutils literal notranslate"><span class="pre">push(value)</span></code> for dynamic storage arrays does not return the new length anymore (it returns nothing).</p></li>
<li><p>The unnamed function commonly referred to as ‚Äúfallback function‚Äù was split up into a new
fallback function that is defined using the <code class="docutils literal notranslate"><span class="pre">fallback</span></code> keyword and a receive ether function
defined using the <code class="docutils literal notranslate"><span class="pre">receive</span></code> keyword.</p>
<ul>
<li><p>If present, the receive ether function is called whenever the call data is empty (whether
or not ether is received). This function is implicitly <code class="docutils literal notranslate"><span class="pre">payable</span></code>.</p></li>
<li><p>The new fallback function is called when no other function matches (if the receive ether
function does not exist then this includes calls with empty call data).
You can make this function <code class="docutils literal notranslate"><span class="pre">payable</span></code> or not. If it is not <code class="docutils literal notranslate"><span class="pre">payable</span></code> then transactions
not matching any other function which send value will revert. You should only need to
implement the new fallback function if you are following an upgrade or proxy pattern.</p></li>
</ul>
</li>
</ul>
</section>
<section id="new-features">
<h3>New Features<a class="headerlink" href="#new-features" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>This section lists things that were not possible prior to Solidity 0.6.0
or were more difficult to achieve.</p>
<ul class="simple">
<li><p>The <a class="reference internal" href="index.html#try-catch"><span class="std std-ref">try/catch statement</span></a> allows you to react on failed external calls.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">struct</span></code> and <code class="docutils literal notranslate"><span class="pre">enum</span></code> types can be declared at file level.</p></li>
<li><p>Array slices can be used for calldata arrays, for example <code class="docutils literal notranslate"><span class="pre">abi.decode(msg.data[4:],</span> <span class="pre">(uint,</span> <span class="pre">uint))</span></code>
is a low-level way to decode the function call payload.</p></li>
<li><p>Natspec supports multiple return parameters in developer documentation, enforcing the same naming check as <code class="docutils literal notranslate"><span class="pre">&#64;param</span></code>.</p></li>
<li><p>Yul and Inline Assembly have a new statement called <code class="docutils literal notranslate"><span class="pre">leave</span></code> that exits the current function.</p></li>
<li><p>Conversions from <code class="docutils literal notranslate"><span class="pre">address</span></code> to <code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code> are now possible via <code class="docutils literal notranslate"><span class="pre">payable(x)</span></code>, where
<code class="docutils literal notranslate"><span class="pre">x</span></code> must be of type <code class="docutils literal notranslate"><span class="pre">address</span></code>.</p></li>
</ul>
</section>
<section id="interface-changes">
<h3>Interface Changes<a class="headerlink" href="#interface-changes" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>This section lists changes that are unrelated to the language itself, but that have an effect on the interfaces of
the compiler. These may change the way how you use the compiler on the command line, how you use its programmable
interface, or how you analyze the output produced by it.</p>
<section id="new-error-reporter">
<h4>New Error Reporter<a class="headerlink" href="#new-error-reporter" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>A new error reporter was introduced, which aims at producing more accessible error messages on the command line.
It is enabled by default, but passing <code class="docutils literal notranslate"><span class="pre">--old-reporter</span></code> falls back to the the deprecated old error reporter.</p>
</section>
<section id="metadata-hash-options">
<h4>Metadata Hash Options<a class="headerlink" href="#metadata-hash-options" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>The compiler now appends the <a class="reference external" href="https://ipfs.io/">IPFS</a> hash of the metadata file to the end of the bytecode by default
(for details, see documentation on <a class="reference internal" href="index.html#document-metadata"><span class="doc">contract metadata</span></a>). Before 0.6.0, the compiler appended the
<a class="reference external" href="https://ethersphere.github.io/swarm-home/">Swarm</a> hash by default, and in order to still support this behaviour,
the new command line option <code class="docutils literal notranslate"><span class="pre">--metadata-hash</span></code> was introduced. It allows you to select the hash to be produced and
appended, by passing either <code class="docutils literal notranslate"><span class="pre">ipfs</span></code> or <code class="docutils literal notranslate"><span class="pre">swarm</span></code> as value to the <code class="docutils literal notranslate"><span class="pre">--metadata-hash</span></code> command line option.
Passing the value <code class="docutils literal notranslate"><span class="pre">none</span></code> completely removes the hash.</p>
<p>These changes can also be used via the <a class="reference internal" href="index.html#compiler-api"><span class="std std-ref">Standard JSON Interface</span></a> and effect the metadata JSON generated by the compiler.</p>
<p>The recommended way to read the metadata is to read the last two bytes to determine the length of the CBOR encoding
and perform a proper decoding on that data block as explained in the <a class="reference internal" href="index.html#encoding-of-the-metadata-hash-in-the-bytecode"><span class="std std-ref">metadata section</span></a>.</p>
</section>
<section id="yul-optimizer">
<h4>Yul Optimizer<a class="headerlink" href="#yul-optimizer" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Together with the legacy bytecode optimizer, the <a class="reference internal" href="index.html#document-yul"><span class="doc">Yul</span></a> optimizer is now enabled by default when you call the compiler
with <code class="docutils literal notranslate"><span class="pre">--optimize</span></code>. It can be disabled by calling the compiler with <code class="docutils literal notranslate"><span class="pre">--no-optimize-yul</span></code>.
This mostly affects code that uses ABI coder v2.</p>
</section>
<section id="c-api-changes">
<h4>C API Changes<a class="headerlink" href="#c-api-changes" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>The client code that uses the C API of <code class="docutils literal notranslate"><span class="pre">libsolc</span></code> is now in control of the memory used by the compiler. To make
this change consistent, <code class="docutils literal notranslate"><span class="pre">solidity_free</span></code> was renamed to <code class="docutils literal notranslate"><span class="pre">solidity_reset</span></code>, the functions <code class="docutils literal notranslate"><span class="pre">solidity_alloc</span></code> and
<code class="docutils literal notranslate"><span class="pre">solidity_free</span></code> were added and <code class="docutils literal notranslate"><span class="pre">solidity_compile</span></code> now returns a string that must be explicitly freed via
<code class="docutils literal notranslate"><span class="pre">solidity_free()</span></code>.</p>
</section>
</section>
<section id="how-to-update-your-code">
<h3>How to update your code<a class="headerlink" href="#how-to-update-your-code" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>This section gives detailed instructions on how to update prior code for every breaking change.</p>
<ul class="simple">
<li><p>Change <code class="docutils literal notranslate"><span class="pre">address(f)</span></code> to <code class="docutils literal notranslate"><span class="pre">f.address</span></code> for <code class="docutils literal notranslate"><span class="pre">f</span></code> being of external function type.</p></li>
<li><p>Replace <code class="docutils literal notranslate"><span class="pre">function</span> <span class="pre">()</span> <span class="pre">external</span> <span class="pre">[payable]</span> <span class="pre">{</span> <span class="pre">...</span> <span class="pre">}</span></code> by either <code class="docutils literal notranslate"><span class="pre">receive()</span> <span class="pre">external</span> <span class="pre">payable</span> <span class="pre">{</span> <span class="pre">...</span> <span class="pre">}</span></code>,
<code class="docutils literal notranslate"><span class="pre">fallback()</span> <span class="pre">external</span> <span class="pre">[payable]</span> <span class="pre">{</span> <span class="pre">...</span> <span class="pre">}</span></code> or both. Prefer
using a <code class="docutils literal notranslate"><span class="pre">receive</span></code> function only, whenever possible.</p></li>
<li><p>Change <code class="docutils literal notranslate"><span class="pre">uint</span> <span class="pre">length</span> <span class="pre">=</span> <span class="pre">array.push(value)</span></code> to <code class="docutils literal notranslate"><span class="pre">array.push(value);</span></code>. The new length can be
accessed via <code class="docutils literal notranslate"><span class="pre">array.length</span></code>.</p></li>
<li><p>Change <code class="docutils literal notranslate"><span class="pre">array.length++</span></code> to <code class="docutils literal notranslate"><span class="pre">array.push()</span></code> to increase, and use <code class="docutils literal notranslate"><span class="pre">pop()</span></code> to decrease
the length of a storage array.</p></li>
<li><p>For every named return parameter in a function‚Äôs <code class="docutils literal notranslate"><span class="pre">&#64;dev</span></code> documentation define a <code class="docutils literal notranslate"><span class="pre">&#64;return</span></code>
entry which contains the parameter‚Äôs name as the first word. E.g. if you have function <code class="docutils literal notranslate"><span class="pre">f()</span></code> defined
like <code class="docutils literal notranslate"><span class="pre">function</span> <span class="pre">f()</span> <span class="pre">public</span> <span class="pre">returns</span> <span class="pre">(uint</span> <span class="pre">value)</span></code> and a <code class="docutils literal notranslate"><span class="pre">&#64;dev</span></code> annotating it, document its return
parameters like so: <code class="docutils literal notranslate"><span class="pre">&#64;return</span> <span class="pre">value</span> <span class="pre">The</span> <span class="pre">return</span> <span class="pre">value.</span></code>. You can mix named and un-named return parameters
documentation so long as the notices are in the order they appear in the tuple return type.</p></li>
<li><p>Choose unique identifiers for variable declarations in inline assembly that do not conflict
with declarations outside the inline assembly block.</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">virtual</span></code> to every non-interface function you intend to override. Add <code class="docutils literal notranslate"><span class="pre">virtual</span></code>
to all functions without implementation outside interfaces. For single inheritance, add
<code class="docutils literal notranslate"><span class="pre">override</span></code> to every overriding function. For multiple inheritance, add <code class="docutils literal notranslate"><span class="pre">override(A,</span> <span class="pre">B,</span> <span class="pre">..)</span></code>,
where you list all contracts that define the overridden function in the parentheses. When
multiple bases define the same function, the inheriting contract must override all conflicting functions.</p></li>
</ul>
</section>
</section>
<span id="document-070-breaking-changes"></span><section id="solidity-v0-7-0-breaking-changes">
<h2>Solidity v0.7.0 Breaking Changes<a class="headerlink" href="#solidity-v0-7-0-breaking-changes" title="Permalink to this heading">ÔÉÅ</a></h2>
<p>This section highlights the main breaking changes introduced in Solidity
version 0.7.0, along with the reasoning behind the changes and how to update
affected code.
For the full list check
<a class="reference external" href="https://github.com/ethereum/solidity/releases/tag/v0.7.0">the release changelog</a>.</p>
<section id="silent-changes-of-the-semantics">
<h3>Silent Changes of the Semantics<a class="headerlink" href="#silent-changes-of-the-semantics" title="Permalink to this heading">ÔÉÅ</a></h3>
<ul class="simple">
<li><p>Exponentiation and shifts of literals by non-literals (e.g. <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">&lt;&lt;</span> <span class="pre">x</span></code> or <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">**</span> <span class="pre">x</span></code>)
will always use either the type <code class="docutils literal notranslate"><span class="pre">uint256</span></code> (for non-negative literals) or
<code class="docutils literal notranslate"><span class="pre">int256</span></code> (for negative literals) to perform the operation.
Previously, the operation was performed in the type of the shift amount / the
exponent which can be misleading.</p></li>
</ul>
</section>
<section id="changes-to-the-syntax">
<h3>Changes to the Syntax<a class="headerlink" href="#changes-to-the-syntax" title="Permalink to this heading">ÔÉÅ</a></h3>
<ul class="simple">
<li><p>In external function and contract creation calls, Ether and gas is now specified using a new syntax:
<code class="docutils literal notranslate"><span class="pre">x.f{gas:</span> <span class="pre">10000,</span> <span class="pre">value:</span> <span class="pre">2</span> <span class="pre">ether}(arg1,</span> <span class="pre">arg2)</span></code>.
The old syntax ‚Äì <code class="docutils literal notranslate"><span class="pre">x.f.gas(10000).value(2</span> <span class="pre">ether)(arg1,</span> <span class="pre">arg2)</span></code> ‚Äì will cause an error.</p></li>
<li><p>The global variable <code class="docutils literal notranslate"><span class="pre">now</span></code> is deprecated, <code class="docutils literal notranslate"><span class="pre">block.timestamp</span></code> should be used instead.
The single identifier <code class="docutils literal notranslate"><span class="pre">now</span></code> is too generic for a global variable and could give the impression
that it changes during transaction processing, whereas <code class="docutils literal notranslate"><span class="pre">block.timestamp</span></code> correctly
reflects the fact that it is just a property of the block.</p></li>
<li><p>NatSpec comments on variables are only allowed for public state variables and not
for local or internal variables.</p></li>
<li><p>The token <code class="docutils literal notranslate"><span class="pre">gwei</span></code> is a keyword now (used to specify, e.g. <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">gwei</span></code> as a number)
and cannot be used as an identifier.</p></li>
<li><p>String literals now can only contain printable ASCII characters and this also includes a variety of
escape sequences, such as hexadecimal (<code class="docutils literal notranslate"><span class="pre">\xff</span></code>) and unicode escapes (<code class="docutils literal notranslate"><span class="pre">\u20ac</span></code>).</p></li>
<li><p>Unicode string literals are supported now to accommodate valid UTF-8 sequences. They are identified
with the <code class="docutils literal notranslate"><span class="pre">unicode</span></code> prefix: <code class="docutils literal notranslate"><span class="pre">unicode&quot;Hello</span> <span class="pre">üòÉ&quot;</span></code>.</p></li>
<li><p>State Mutability: The state mutability of functions can now be restricted during inheritance:
Functions with default state mutability can be overridden by <code class="docutils literal notranslate"><span class="pre">pure</span></code> and <code class="docutils literal notranslate"><span class="pre">view</span></code> functions
while <code class="docutils literal notranslate"><span class="pre">view</span></code> functions can be overridden by <code class="docutils literal notranslate"><span class="pre">pure</span></code> functions.
At the same time, public state variables are considered <code class="docutils literal notranslate"><span class="pre">view</span></code> and even <code class="docutils literal notranslate"><span class="pre">pure</span></code>
if they are constants.</p></li>
</ul>
<section id="inline-assembly">
<h4>Inline Assembly<a class="headerlink" href="#inline-assembly" title="Permalink to this heading">ÔÉÅ</a></h4>
<ul class="simple">
<li><p>Disallow <code class="docutils literal notranslate"><span class="pre">.</span></code> in user-defined function and variable names in inline assembly.
It is still valid if you use Solidity in Yul-only mode.</p></li>
<li><p>Slot and offset of storage pointer variable <code class="docutils literal notranslate"><span class="pre">x</span></code> are accessed via <code class="docutils literal notranslate"><span class="pre">x.slot</span></code>
and <code class="docutils literal notranslate"><span class="pre">x.offset</span></code> instead of <code class="docutils literal notranslate"><span class="pre">x_slot</span></code> and <code class="docutils literal notranslate"><span class="pre">x_offset</span></code>.</p></li>
</ul>
</section>
</section>
<section id="removal-of-unused-or-unsafe-features">
<h3>Removal of Unused or Unsafe Features<a class="headerlink" href="#removal-of-unused-or-unsafe-features" title="Permalink to this heading">ÔÉÅ</a></h3>
<section id="mappings-outside-storage">
<h4>Mappings outside Storage<a class="headerlink" href="#mappings-outside-storage" title="Permalink to this heading">ÔÉÅ</a></h4>
<ul class="simple">
<li><p>If a struct or array contains a mapping, it can only be used in storage.
Previously, mapping members were silently skipped in memory, which
is confusing and error-prone.</p></li>
<li><p>Assignments to structs or arrays in storage does not work if they contain
mappings.
Previously, mappings were silently skipped during the copy operation, which
is misleading and error-prone.</p></li>
</ul>
</section>
<section id="functions-and-events">
<h4>Functions and Events<a class="headerlink" href="#functions-and-events" title="Permalink to this heading">ÔÉÅ</a></h4>
<ul class="simple">
<li><p>Visibility (<code class="docutils literal notranslate"><span class="pre">public</span></code> / <code class="docutils literal notranslate"><span class="pre">internal</span></code>) is not needed for constructors anymore:
To prevent a contract from being created, it can be marked <code class="docutils literal notranslate"><span class="pre">abstract</span></code>.
This makes the visibility concept for constructors obsolete.</p></li>
<li><p>Type Checker: Disallow <code class="docutils literal notranslate"><span class="pre">virtual</span></code> for library functions:
Since libraries cannot be inherited from, library functions should not be virtual.</p></li>
<li><p>Multiple events with the same name and parameter types in the same
inheritance hierarchy are disallowed.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">using</span> <span class="pre">A</span> <span class="pre">for</span> <span class="pre">B</span></code> only affects the contract it is mentioned in.
Previously, the effect was inherited. Now, you have to repeat the <code class="docutils literal notranslate"><span class="pre">using</span></code>
statement in all derived contracts that make use of the feature.</p></li>
</ul>
</section>
<section id="expressions">
<h4>Expressions<a class="headerlink" href="#expressions" title="Permalink to this heading">ÔÉÅ</a></h4>
<ul class="simple">
<li><p>Shifts by signed types are disallowed.
Previously, shifts by negative amounts were allowed, but reverted at runtime.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">finney</span></code> and <code class="docutils literal notranslate"><span class="pre">szabo</span></code> denominations are removed.
They are rarely used and do not make the actual amount readily visible. Instead, explicit
values like <code class="docutils literal notranslate"><span class="pre">1e20</span></code> or the very common <code class="docutils literal notranslate"><span class="pre">gwei</span></code> can be used.</p></li>
</ul>
</section>
<section id="declarations">
<h4>Declarations<a class="headerlink" href="#declarations" title="Permalink to this heading">ÔÉÅ</a></h4>
<ul class="simple">
<li><p>The keyword <code class="docutils literal notranslate"><span class="pre">var</span></code> cannot be used anymore.
Previously, this keyword would parse but result in a type error and
a suggestion about which type to use. Now, it results in a parser error.</p></li>
</ul>
</section>
</section>
<section id="interface-changes">
<h3>Interface Changes<a class="headerlink" href="#interface-changes" title="Permalink to this heading">ÔÉÅ</a></h3>
<ul class="simple">
<li><p>JSON AST: Mark hex string literals with <code class="docutils literal notranslate"><span class="pre">kind:</span> <span class="pre">&quot;hexString&quot;</span></code>.</p></li>
<li><p>JSON AST: Members with value <code class="docutils literal notranslate"><span class="pre">null</span></code> are removed from JSON output.</p></li>
<li><p>NatSpec: Constructors and functions have consistent userdoc output.</p></li>
</ul>
</section>
<section id="how-to-update-your-code">
<h3>How to update your code<a class="headerlink" href="#how-to-update-your-code" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>This section gives detailed instructions on how to update prior code for every breaking change.</p>
<ul class="simple">
<li><p>Change <code class="docutils literal notranslate"><span class="pre">x.f.value(...)()</span></code> to <code class="docutils literal notranslate"><span class="pre">x.f{value:</span> <span class="pre">...}()</span></code>. Similarly <code class="docutils literal notranslate"><span class="pre">(new</span> <span class="pre">C).value(...)()</span></code> to
<code class="docutils literal notranslate"><span class="pre">new</span> <span class="pre">C{value:</span> <span class="pre">...}()</span></code> and <code class="docutils literal notranslate"><span class="pre">x.f.gas(...).value(...)()</span></code> to <code class="docutils literal notranslate"><span class="pre">x.f{gas:</span> <span class="pre">...,</span> <span class="pre">value:</span> <span class="pre">...}()</span></code>.</p></li>
<li><p>Change <code class="docutils literal notranslate"><span class="pre">now</span></code> to <code class="docutils literal notranslate"><span class="pre">block.timestamp</span></code>.</p></li>
<li><p>Change types of right operand in shift operators to unsigned types. For example change <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">&gt;&gt;</span> <span class="pre">(256</span> <span class="pre">-</span> <span class="pre">y)</span></code> to
<code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">&gt;&gt;</span> <span class="pre">uint(256</span> <span class="pre">-</span> <span class="pre">y)</span></code>.</p></li>
<li><p>Repeat the <code class="docutils literal notranslate"><span class="pre">using</span> <span class="pre">A</span> <span class="pre">for</span> <span class="pre">B</span></code> statements in all derived contracts if needed.</p></li>
<li><p>Remove the <code class="docutils literal notranslate"><span class="pre">public</span></code> keyword from every constructor.</p></li>
<li><p>Remove the <code class="docutils literal notranslate"><span class="pre">internal</span></code> keyword from every constructor and add <code class="docutils literal notranslate"><span class="pre">abstract</span></code> to the contract (if not already present).</p></li>
<li><p>Change <code class="docutils literal notranslate"><span class="pre">_slot</span></code> and <code class="docutils literal notranslate"><span class="pre">_offset</span></code> suffixes in inline assembly to <code class="docutils literal notranslate"><span class="pre">.slot</span></code> and <code class="docutils literal notranslate"><span class="pre">.offset</span></code>, respectively.</p></li>
</ul>
</section>
</section>
<span id="document-080-breaking-changes"></span><section id="solidity-v0-8-0-breaking-changes">
<h2>Solidity v0.8.0 Breaking Changes<a class="headerlink" href="#solidity-v0-8-0-breaking-changes" title="Permalink to this heading">ÔÉÅ</a></h2>
<p>This section highlights the main breaking changes introduced in Solidity
version 0.8.0.
For the full list check
<a class="reference external" href="https://github.com/ethereum/solidity/releases/tag/v0.8.0">the release changelog</a>.</p>
<section id="silent-changes-of-the-semantics">
<h3>Silent Changes of the Semantics<a class="headerlink" href="#silent-changes-of-the-semantics" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>This section lists changes where existing code changes its behaviour without
the compiler notifying you about it.</p>
<ul>
<li><p>Arithmetic operations revert on underflow and overflow. You can use <code class="docutils literal notranslate"><span class="pre">unchecked</span> <span class="pre">{</span> <span class="pre">...</span> <span class="pre">}</span></code> to use
the previous wrapping behaviour.</p>
<p>Checks for overflow are very common, so we made them the default to increase readability of code,
even if it comes at a slight increase of gas costs.</p>
</li>
<li><p>ABI coder v2 is activated by default.</p>
<p>You can choose to use the old behaviour using <code class="docutils literal notranslate"><span class="pre">pragma</span> <span class="pre">abicoder</span> <span class="pre">v1;</span></code>.
The pragma <code class="docutils literal notranslate"><span class="pre">pragma</span> <span class="pre">experimental</span> <span class="pre">ABIEncoderV2;</span></code> is still valid, but it is deprecated and has no effect.
If you want to be explicit, please use <code class="docutils literal notranslate"><span class="pre">pragma</span> <span class="pre">abicoder</span> <span class="pre">v2;</span></code> instead.</p>
<p>Note that ABI coder v2 supports more types than v1 and performs more sanity checks on the inputs.
ABI coder v2 makes some function calls more expensive and it can also make contract calls
revert that did not revert with ABI coder v1 when they contain data that does not conform to the
parameter types.</p>
</li>
<li><p>Exponentiation is right associative, i.e., the expression <code class="docutils literal notranslate"><span class="pre">a**b**c</span></code> is parsed as <code class="docutils literal notranslate"><span class="pre">a**(b**c)</span></code>.
Before 0.8.0, it was parsed as <code class="docutils literal notranslate"><span class="pre">(a**b)**c</span></code>.</p>
<p>This is the common way to parse the exponentiation operator.</p>
</li>
<li><p>Failing assertions and other internal checks like division by zero or arithmetic overflow do
not use the invalid opcode but instead the revert opcode.
More specifically, they will use error data equal to a function call to <code class="docutils literal notranslate"><span class="pre">Panic(uint256)</span></code> with an error code specific
to the circumstances.</p>
<p>This will save gas on errors while it still allows static analysis tools to distinguish
these situations from a revert on invalid input, like a failing <code class="docutils literal notranslate"><span class="pre">require</span></code>.</p>
</li>
<li><p>If a byte array in storage is accessed whose length is encoded incorrectly, a panic is caused.
A contract cannot get into this situation unless inline assembly is used to modify the raw representation of storage byte arrays.</p></li>
<li><p>If constants are used in array length expressions, previous versions of Solidity would use arbitrary precision
in all branches of the evaluation tree. Now, if constant variables are used as intermediate expressions,
their values will be properly rounded in the same way as when they are used in run-time expressions.</p></li>
<li><p>The type <code class="docutils literal notranslate"><span class="pre">byte</span></code> has been removed. It was an alias of <code class="docutils literal notranslate"><span class="pre">bytes1</span></code>.</p></li>
</ul>
</section>
<section id="new-restrictions">
<h3>New Restrictions<a class="headerlink" href="#new-restrictions" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>This section lists changes that might cause existing contracts to not compile anymore.</p>
<ul>
<li><p>There are new restrictions related to explicit conversions of literals. The previous behaviour in
the following cases was likely ambiguous:</p>
<ol class="arabic simple">
<li><p>Explicit conversions from negative literals and literals larger than <code class="docutils literal notranslate"><span class="pre">type(uint160).max</span></code> to
<code class="docutils literal notranslate"><span class="pre">address</span></code> are disallowed.</p></li>
<li><p>Explicit conversions between literals and an integer type <code class="docutils literal notranslate"><span class="pre">T</span></code> are only allowed if the literal
lies between <code class="docutils literal notranslate"><span class="pre">type(T).min</span></code> and <code class="docutils literal notranslate"><span class="pre">type(T).max</span></code>. In particular, replace usages of <code class="docutils literal notranslate"><span class="pre">uint(-1)</span></code>
with <code class="docutils literal notranslate"><span class="pre">type(uint).max</span></code>.</p></li>
<li><p>Explicit conversions between literals and enums are only allowed if the literal can
represent a value in the enum.</p></li>
<li><p>Explicit conversions between literals and <code class="docutils literal notranslate"><span class="pre">address</span></code> type (e.g. <code class="docutils literal notranslate"><span class="pre">address(literal)</span></code>) have the
type <code class="docutils literal notranslate"><span class="pre">address</span></code> instead of <code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code>. One can get a payable address type by using an
explicit conversion, i.e., <code class="docutils literal notranslate"><span class="pre">payable(literal)</span></code>.</p></li>
</ol>
</li>
<li><p><a class="reference internal" href="index.html#address-literals"><span class="std std-ref">Address literals</span></a> have the type <code class="docutils literal notranslate"><span class="pre">address</span></code> instead of <code class="docutils literal notranslate"><span class="pre">address</span>
<span class="pre">payable</span></code>. They can be converted to <code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code> by using an explicit conversion, e.g.
<code class="docutils literal notranslate"><span class="pre">payable(0xdCad3a6d3569DF655070DEd06cb7A1b2Ccd1D3AF)</span></code>.</p></li>
<li><p>There are new restrictions on explicit type conversions. The conversion is only allowed when there
is at most one change in sign, width or type-category (<code class="docutils literal notranslate"><span class="pre">int</span></code>, <code class="docutils literal notranslate"><span class="pre">address</span></code>, <code class="docutils literal notranslate"><span class="pre">bytesNN</span></code>, etc.).
To perform multiple changes, use multiple conversions.</p>
<p>Let us use the notation <code class="docutils literal notranslate"><span class="pre">T(S)</span></code> to denote the explicit conversion <code class="docutils literal notranslate"><span class="pre">T(x)</span></code>, where, <code class="docutils literal notranslate"><span class="pre">T</span></code> and
<code class="docutils literal notranslate"><span class="pre">S</span></code> are types, and <code class="docutils literal notranslate"><span class="pre">x</span></code> is any arbitrary variable of type <code class="docutils literal notranslate"><span class="pre">S</span></code>. An example of such a
disallowed conversion would be <code class="docutils literal notranslate"><span class="pre">uint16(int8)</span></code> since it changes both width (8 bits to 16 bits)
and sign (signed integer to unsigned integer). In order to do the conversion, one has to go
through an intermediate type. In the previous example, this would be <code class="docutils literal notranslate"><span class="pre">uint16(uint8(int8))</span></code> or
<code class="docutils literal notranslate"><span class="pre">uint16(int16(int8))</span></code>. Note that the two ways to convert will produce different results e.g.,
for <code class="docutils literal notranslate"><span class="pre">-1</span></code>. The following are some examples of conversions that are disallowed by this rule.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">address(uint)</span></code> and <code class="docutils literal notranslate"><span class="pre">uint(address)</span></code>: converting both type-category and width. Replace this by
<code class="docutils literal notranslate"><span class="pre">address(uint160(uint))</span></code> and <code class="docutils literal notranslate"><span class="pre">uint(uint160(address))</span></code> respectively.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">payable(uint160)</span></code>, <code class="docutils literal notranslate"><span class="pre">payable(bytes20)</span></code> and <code class="docutils literal notranslate"><span class="pre">payable(integer-literal)</span></code>: converting both
type-category and state-mutability. Replace this by <code class="docutils literal notranslate"><span class="pre">payable(address(uint160))</span></code>,
<code class="docutils literal notranslate"><span class="pre">payable(address(bytes20))</span></code> and <code class="docutils literal notranslate"><span class="pre">payable(address(integer-literal))</span></code> respectively. Note that
<code class="docutils literal notranslate"><span class="pre">payable(0)</span></code> is valid and is an exception to the rule.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">int80(bytes10)</span></code> and <code class="docutils literal notranslate"><span class="pre">bytes10(int80)</span></code>: converting both type-category and sign. Replace this by
<code class="docutils literal notranslate"><span class="pre">int80(uint80(bytes10))</span></code> and <code class="docutils literal notranslate"><span class="pre">bytes10(uint80(int80)</span></code> respectively.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Contract(uint)</span></code>: converting both type-category and width. Replace this by
<code class="docutils literal notranslate"><span class="pre">Contract(address(uint160(uint)))</span></code>.</p></li>
</ul>
<p>These conversions were disallowed to avoid ambiguity. For example, in the expression <code class="docutils literal notranslate"><span class="pre">uint16</span> <span class="pre">x</span> <span class="pre">=</span>
<span class="pre">uint16(int8(-1))</span></code>, the value of <code class="docutils literal notranslate"><span class="pre">x</span></code> would depend on whether the sign or the width conversion
was applied first.</p>
</li>
<li><p>Function call options can only be given once, i.e. <code class="docutils literal notranslate"><span class="pre">c.f{gas:</span> <span class="pre">10000}{value:</span> <span class="pre">1}()</span></code> is invalid and has to be changed to <code class="docutils literal notranslate"><span class="pre">c.f{gas:</span> <span class="pre">10000,</span> <span class="pre">value:</span> <span class="pre">1}()</span></code>.</p></li>
<li><p>The global functions <code class="docutils literal notranslate"><span class="pre">log0</span></code>, <code class="docutils literal notranslate"><span class="pre">log1</span></code>, <code class="docutils literal notranslate"><span class="pre">log2</span></code>, <code class="docutils literal notranslate"><span class="pre">log3</span></code> and <code class="docutils literal notranslate"><span class="pre">log4</span></code> have been removed.</p>
<p>These are low-level functions that were largely unused. Their behaviour can be accessed from inline assembly.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">enum</span></code> definitions cannot contain more than 256 members.</p>
<p>This will make it safe to assume that the underlying type in the ABI is always <code class="docutils literal notranslate"><span class="pre">uint8</span></code>.</p>
</li>
<li><p>Declarations with the name <code class="docutils literal notranslate"><span class="pre">this</span></code>, <code class="docutils literal notranslate"><span class="pre">super</span></code> and <code class="docutils literal notranslate"><span class="pre">_</span></code> are disallowed, with the exception of
public functions and events. The exception is to make it possible to declare interfaces of contracts
implemented in languages other than Solidity that do permit such function names.</p></li>
<li><p>Remove support for the <code class="docutils literal notranslate"><span class="pre">\b</span></code>, <code class="docutils literal notranslate"><span class="pre">\f</span></code>, and <code class="docutils literal notranslate"><span class="pre">\v</span></code> escape sequences in code.
They can still be inserted via hexadecimal escapes, e.g. <code class="docutils literal notranslate"><span class="pre">\x08</span></code>, <code class="docutils literal notranslate"><span class="pre">\x0c</span></code>, and <code class="docutils literal notranslate"><span class="pre">\x0b</span></code>, respectively.</p></li>
<li><p>The global variables <code class="docutils literal notranslate"><span class="pre">tx.origin</span></code> and <code class="docutils literal notranslate"><span class="pre">msg.sender</span></code> have the type <code class="docutils literal notranslate"><span class="pre">address</span></code> instead of
<code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code>. One can convert them into <code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code> by using an explicit
conversion, i.e., <code class="docutils literal notranslate"><span class="pre">payable(tx.origin)</span></code> or <code class="docutils literal notranslate"><span class="pre">payable(msg.sender)</span></code>.</p>
<p>This change was done since the compiler cannot determine whether or not these addresses
are payable or not, so it now requires an explicit conversion to make this requirement visible.</p>
</li>
<li><p>Explicit conversion into <code class="docutils literal notranslate"><span class="pre">address</span></code> type always returns a non-payable <code class="docutils literal notranslate"><span class="pre">address</span></code> type. In
particular, the following explicit conversions have the type <code class="docutils literal notranslate"><span class="pre">address</span></code> instead of <code class="docutils literal notranslate"><span class="pre">address</span>
<span class="pre">payable</span></code>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">address(u)</span></code> where <code class="docutils literal notranslate"><span class="pre">u</span></code> is a variable of type <code class="docutils literal notranslate"><span class="pre">uint160</span></code>. One can convert <code class="docutils literal notranslate"><span class="pre">u</span></code>
into the type <code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code> by using two explicit conversions, i.e.,
<code class="docutils literal notranslate"><span class="pre">payable(address(u))</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">address(b)</span></code> where <code class="docutils literal notranslate"><span class="pre">b</span></code> is a variable of type <code class="docutils literal notranslate"><span class="pre">bytes20</span></code>. One can convert <code class="docutils literal notranslate"><span class="pre">b</span></code>
into the type <code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code> by using two explicit conversions, i.e.,
<code class="docutils literal notranslate"><span class="pre">payable(address(b))</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">address(c)</span></code> where <code class="docutils literal notranslate"><span class="pre">c</span></code> is a contract. Previously, the return type of this
conversion depended on whether the contract can receive Ether (either by having a receive
function or a payable fallback function). The conversion <code class="docutils literal notranslate"><span class="pre">payable(c)</span></code> has the type <code class="docutils literal notranslate"><span class="pre">address</span>
<span class="pre">payable</span></code> and is only allowed when the contract <code class="docutils literal notranslate"><span class="pre">c</span></code> can receive Ether. In general, one can
always convert <code class="docutils literal notranslate"><span class="pre">c</span></code> into the type <code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code> by using the following explicit
conversion: <code class="docutils literal notranslate"><span class="pre">payable(address(c))</span></code>. Note that <code class="docutils literal notranslate"><span class="pre">address(this)</span></code> falls under the same category
as <code class="docutils literal notranslate"><span class="pre">address(c)</span></code> and the same rules apply for it.</p></li>
</ul>
</li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">chainid</span></code> builtin in inline assembly is now considered <code class="docutils literal notranslate"><span class="pre">view</span></code> instead of <code class="docutils literal notranslate"><span class="pre">pure</span></code>.</p></li>
<li><p>Unary negation cannot be used on unsigned integers anymore, only on signed integers.</p></li>
</ul>
</section>
<section id="interface-changes">
<h3>Interface Changes<a class="headerlink" href="#interface-changes" title="Permalink to this heading">ÔÉÅ</a></h3>
<ul class="simple">
<li><p>The output of <code class="docutils literal notranslate"><span class="pre">--combined-json</span></code> has changed: JSON fields <code class="docutils literal notranslate"><span class="pre">abi</span></code>, <code class="docutils literal notranslate"><span class="pre">devdoc</span></code>, <code class="docutils literal notranslate"><span class="pre">userdoc</span></code> and
<code class="docutils literal notranslate"><span class="pre">storage-layout</span></code> are sub-objects now. Before 0.8.0 they used to be serialised as strings.</p></li>
<li><p>The ‚Äúlegacy AST‚Äù has been removed (<code class="docutils literal notranslate"><span class="pre">--ast-json</span></code> on the commandline interface and <code class="docutils literal notranslate"><span class="pre">legacyAST</span></code> for standard JSON).
Use the ‚Äúcompact AST‚Äù (<code class="docutils literal notranslate"><span class="pre">--ast-compact--json</span></code> resp. <code class="docutils literal notranslate"><span class="pre">AST</span></code>) as replacement.</p></li>
<li><p>The old error reporter (<code class="docutils literal notranslate"><span class="pre">--old-reporter</span></code>) has been removed.</p></li>
</ul>
</section>
<section id="how-to-update-your-code">
<h3>How to update your code<a class="headerlink" href="#how-to-update-your-code" title="Permalink to this heading">ÔÉÅ</a></h3>
<ul class="simple">
<li><p>If you rely on wrapping arithmetic, surround each operation with <code class="docutils literal notranslate"><span class="pre">unchecked</span> <span class="pre">{</span> <span class="pre">...</span> <span class="pre">}</span></code>.</p></li>
<li><p>Optional: If you use SafeMath or a similar library, change <code class="docutils literal notranslate"><span class="pre">x.add(y)</span></code> to <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">+</span> <span class="pre">y</span></code>, <code class="docutils literal notranslate"><span class="pre">x.mul(y)</span></code> to <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">*</span> <span class="pre">y</span></code> etc.</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">pragma</span> <span class="pre">abicoder</span> <span class="pre">v1;</span></code> if you want to stay with the old ABI coder.</p></li>
<li><p>Optionally remove <code class="docutils literal notranslate"><span class="pre">pragma</span> <span class="pre">experimental</span> <span class="pre">ABIEncoderV2</span></code> or <code class="docutils literal notranslate"><span class="pre">pragma</span> <span class="pre">abicoder</span> <span class="pre">v2</span></code> since it is redundant.</p></li>
<li><p>Change <code class="docutils literal notranslate"><span class="pre">byte</span></code> to <code class="docutils literal notranslate"><span class="pre">bytes1</span></code>.</p></li>
<li><p>Add intermediate explicit type conversions if required.</p></li>
<li><p>Combine <code class="docutils literal notranslate"><span class="pre">c.f{gas:</span> <span class="pre">10000}{value:</span> <span class="pre">1}()</span></code> to <code class="docutils literal notranslate"><span class="pre">c.f{gas:</span> <span class="pre">10000,</span> <span class="pre">value:</span> <span class="pre">1}()</span></code>.</p></li>
<li><p>Change <code class="docutils literal notranslate"><span class="pre">msg.sender.transfer(x)</span></code> to <code class="docutils literal notranslate"><span class="pre">payable(msg.sender).transfer(x)</span></code> or use a stored variable of <code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code> type.</p></li>
<li><p>Change <code class="docutils literal notranslate"><span class="pre">x**y**z</span></code> to <code class="docutils literal notranslate"><span class="pre">(x**y)**z</span></code>.</p></li>
<li><p>Use inline assembly as a replacement for <code class="docutils literal notranslate"><span class="pre">log0</span></code>, ‚Ä¶, <code class="docutils literal notranslate"><span class="pre">log4</span></code>.</p></li>
<li><p>Negate unsigned integers by subtracting them from the maximum value of the type and adding 1 (e.g. <code class="docutils literal notranslate"><span class="pre">type(uint256).max</span> <span class="pre">-</span> <span class="pre">x</span> <span class="pre">+</span> <span class="pre">1</span></code>, while ensuring that <cite>x</cite> is not zero)</p></li>
</ul>
</section>
</section>
<span id="document-natspec-format"></span><section id="natspec-format">
<span id="natspec"></span><h2>NatSpec Format<a class="headerlink" href="#natspec-format" title="Permalink to this heading">ÔÉÅ</a></h2>
<p>Solidity contracts can use a special form of comments to provide rich
documentation for functions, return variables and more. This special form is
named the Ethereum Natural Language Specification Format (NatSpec).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>NatSpec was inspired by <a class="reference external" href="https://en.wikipedia.org/wiki/Doxygen">Doxygen</a>.
While it uses Doxygen-style comments and tags, there is no intention to keep
strict compatibility with Doxygen. Please carefully examine the supported tags
listed below.</p>
</div>
<p>This documentation is segmented into developer-focused messages and end-user-facing
messages. These messages may be shown to the end user (the human) at the
time that they will interact with the contract (i.e. sign a transaction).</p>
<p>It is recommended that Solidity contracts are fully annotated using NatSpec for
all public interfaces (everything in the ABI).</p>
<p>NatSpec includes the formatting for comments that the smart contract author will
use, and which are understood by the Solidity compiler. Also detailed below is
output of the Solidity compiler, which extracts these comments into a machine-readable
format.</p>
<p>NatSpec may also include annotations used by third-party tools. These are most likely
accomplished via the <code class="docutils literal notranslate"><span class="pre">&#64;custom:&lt;name&gt;</span></code> tag, and a good use case is analysis and verification
tools.</p>
<section id="documentation-example">
<span id="header-doc-example"></span><h3>Documentation Example<a class="headerlink" href="#documentation-example" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Documentation is inserted above each <code class="docutils literal notranslate"><span class="pre">contract</span></code>, <code class="docutils literal notranslate"><span class="pre">interface</span></code>, <code class="docutils literal notranslate"><span class="pre">library</span></code>,
<code class="docutils literal notranslate"><span class="pre">function</span></code>, and <code class="docutils literal notranslate"><span class="pre">event</span></code> using the Doxygen notation format.
A <code class="docutils literal notranslate"><span class="pre">public</span></code> state variable is equivalent to a <code class="docutils literal notranslate"><span class="pre">function</span></code>
for the purposes of NatSpec.</p>
<ul class="simple">
<li><p>For Solidity you may choose <code class="docutils literal notranslate"><span class="pre">///</span></code> for single or multi-line
comments, or <code class="docutils literal notranslate"><span class="pre">/**</span></code> and ending with <code class="docutils literal notranslate"><span class="pre">*/</span></code>.</p></li>
<li><p>For Vyper, use <code class="docutils literal notranslate"><span class="pre">&quot;&quot;&quot;</span></code> indented to the inner contents with bare
comments. See the <a class="reference external" href="https://vyper.readthedocs.io/en/latest/natspec.html">Vyper
documentation</a>.</p></li>
</ul>
<p>The following example shows a contract and a function using all available tags.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The Solidity compiler only interprets tags if they are external or
public. You are welcome to use similar comments for your internal and
private functions, but those will not be parsed.</p>
<p>This may change in the future.</p>
</div>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC44LjIgPCAwLjkuMDsKCi8vLyBAdGl0bGUgQSBzaW11bGF0b3IgZm9yIHRyZWVzCi8vLyBAYXV0aG9yIExhcnJ5IEEuIEdhcmRuZXIKLy8vIEBub3RpY2UgWW91IGNhbiB1c2UgdGhpcyBjb250cmFjdCBmb3Igb25seSB0aGUgbW9zdCBiYXNpYyBzaW11bGF0aW9uCi8vLyBAZGV2IEFsbCBmdW5jdGlvbiBjYWxscyBhcmUgY3VycmVudGx5IGltcGxlbWVudGVkIHdpdGhvdXQgc2lkZSBlZmZlY3RzCi8vLyBAY3VzdG9tOmV4cGVyaW1lbnRhbCBUaGlzIGlzIGFuIGV4cGVyaW1lbnRhbCBjb250cmFjdC4KY29udHJhY3QgVHJlZSB7CiAgICAvLy8gQG5vdGljZSBDYWxjdWxhdGUgdHJlZSBhZ2UgaW4geWVhcnMsIHJvdW5kZWQgdXAsIGZvciBsaXZlIHRyZWVzCiAgICAvLy8gQGRldiBUaGUgQWxleGFuZHIgTi4gVGV0ZWFyaW5nIGFsZ29yaXRobSBjb3VsZCBpbmNyZWFzZSBwcmVjaXNpb24KICAgIC8vLyBAcGFyYW0gcmluZ3MgVGhlIG51bWJlciBvZiByaW5ncyBmcm9tIGRlbmRyb2Nocm9ub2xvZ2ljYWwgc2FtcGxlCiAgICAvLy8gQHJldHVybiBBZ2UgaW4geWVhcnMsIHJvdW5kZWQgdXAgZm9yIHBhcnRpYWwgeWVhcnMKICAgIGZ1bmN0aW9uIGFnZSh1aW50MjU2IHJpbmdzKSBleHRlcm5hbCB2aXJ0dWFsIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiByaW5ncyArIDE7CiAgICB9CgogICAgLy8vIEBub3RpY2UgUmV0dXJucyB0aGUgYW1vdW50IG9mIGxlYXZlcyB0aGUgdHJlZSBoYXMuCiAgICAvLy8gQGRldiBSZXR1cm5zIG9ubHkgYSBmaXhlZCBudW1iZXIuCiAgICBmdW5jdGlvbiBsZWF2ZXMoKSBleHRlcm5hbCB2aXJ0dWFsIHB1cmUgcmV0dXJucyh1aW50MjU2KSB7CiAgICAgICAgcmV0dXJuIDI7CiAgICB9Cn0KCmNvbnRyYWN0IFBsYW50IHsKICAgIGZ1bmN0aW9uIGxlYXZlcygpIGV4dGVybmFsIHZpcnR1YWwgcHVyZSByZXR1cm5zKHVpbnQyNTYpIHsKICAgICAgICByZXR1cm4gMzsKICAgIH0KfQoKY29udHJhY3QgS3VtcXVhdFRyZWUgaXMgVHJlZSwgUGxhbnQgewogICAgZnVuY3Rpb24gYWdlKHVpbnQyNTYgcmluZ3MpIGV4dGVybmFsIG92ZXJyaWRlIHB1cmUgcmV0dXJucyAodWludDI1NikgewogICAgICAgIHJldHVybiByaW5ncyArIDI7CiAgICB9CgogICAgLy8vIFJldHVybiB0aGUgYW1vdW50IG9mIGxlYXZlcyB0aGF0IHRoaXMgc3BlY2lmaWMga2luZCBvZiB0cmVlIGhhcwogICAgLy8vIEBpbmhlcml0ZG9jIFRyZWUKICAgIGZ1bmN0aW9uIGxlYXZlcygpIGV4dGVybmFsIG92ZXJyaWRlKFRyZWUsIFBsYW50KSBwdXJlIHJldHVybnModWludDI1NikgewogICAgICAgIHJldHVybiAzOwogICAgfQp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// </span><span class="cs">SPDX-License-Identifier:</span><span class="c1"> GPL-3.0</span>
<span class="k">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.8</span><span class="p">.</span><span class="mi">2</span> <span class="o">&lt;</span> <span class="mf">0.9</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="c1">/// </span><span class="cs">@title</span><span class="c1"> A simulator for trees</span>
<span class="c1">/// </span><span class="cs">@author</span><span class="c1"> Larry A. Gardner</span>
<span class="c1">/// </span><span class="cs">@notice</span><span class="c1"> You can use this contract for only the most basic simulation</span>
<span class="c1">/// </span><span class="cs">@dev</span><span class="c1"> All function calls are currently implemented without side effects</span>
<span class="c1">/// </span><span class="cs">@custom:experimental</span><span class="c1"> This is an experimental contract.</span>
<span class="kd">contract</span> <span class="n">Tree</span> <span class="p">{</span>
    <span class="c1">/// </span><span class="cs">@notice</span><span class="c1"> Calculate tree age in years, rounded up, for live trees</span>
    <span class="c1">/// </span><span class="cs">@dev</span><span class="c1"> The Alexandr N. Tetearing algorithm could increase precision</span>
    <span class="c1">/// </span><span class="cs">@param</span><span class="c1"> rings The number of rings from dendrochronological sample</span>
    <span class="c1">/// </span><span class="cs">@return</span><span class="c1"> Age in years, rounded up for partial years</span>
    <span class="kd">function</span> <span class="n">age</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">rings</span><span class="p">)</span> <span class="k">external</span> <span class="k">virtual</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">rings</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">/// </span><span class="cs">@notice</span><span class="c1"> Returns the amount of leaves the tree has.</span>
    <span class="c1">/// </span><span class="cs">@dev</span><span class="c1"> Returns only a fixed number.</span>
    <span class="kd">function</span> <span class="n">leaves</span><span class="p">()</span> <span class="k">external</span> <span class="k">virtual</span> <span class="k">pure</span> <span class="k">returns</span><span class="p">(</span><span class="kt">uint256</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">Plant</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">leaves</span><span class="p">()</span> <span class="k">external</span> <span class="k">virtual</span> <span class="k">pure</span> <span class="k">returns</span><span class="p">(</span><span class="kt">uint256</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mi">3</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">KumquatTree</span> <span class="k">is</span> <span class="n">Tree</span><span class="p">,</span> <span class="n">Plant</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">age</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">rings</span><span class="p">)</span> <span class="k">external</span> <span class="k">override</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">rings</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">/// Return the amount of leaves that this specific kind of tree has</span>
    <span class="c1">/// </span><span class="cs">@inheritdoc</span><span class="c1"> Tree</span>
    <span class="kd">function</span> <span class="n">leaves</span><span class="p">()</span> <span class="k">external</span> <span class="k">override</span><span class="p">(</span><span class="n">Tree</span><span class="p">,</span> <span class="n">Plant</span><span class="p">)</span> <span class="k">pure</span> <span class="k">returns</span><span class="p">(</span><span class="kt">uint256</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mi">3</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="tags">
<span id="header-tags"></span><h3>Tags<a class="headerlink" href="#tags" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>All tags are optional. The following table explains the purpose of each
NatSpec tag and where it may be used. As a special case, if no tags are
used then the Solidity compiler will interpret a <code class="docutils literal notranslate"><span class="pre">///</span></code> or <code class="docutils literal notranslate"><span class="pre">/**</span></code> comment
in the same way as if it were tagged with <code class="docutils literal notranslate"><span class="pre">&#64;notice</span></code>.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 9%" />
<col style="width: 51%" />
<col style="width: 40%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Tag</p></th>
<th class="head"></th>
<th class="head"><p>Context</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&#64;title</span></code></p></td>
<td><p>A title that should describe the contract/interface</p></td>
<td><p>contract, library, interface</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&#64;author</span></code></p></td>
<td><p>The name of the author</p></td>
<td><p>contract, library, interface</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&#64;notice</span></code></p></td>
<td><p>Explain to an end user what this does</p></td>
<td><p>contract, library, interface, function, public state variable, event</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&#64;dev</span></code></p></td>
<td><p>Explain to a developer any extra details</p></td>
<td><p>contract, library, interface, function, state variable, event</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&#64;param</span></code></p></td>
<td><p>Documents a parameter just like in Doxygen (must be followed by parameter name)</p></td>
<td><p>function, event</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&#64;return</span></code></p></td>
<td><p>Documents the return variables of a contract‚Äôs function</p></td>
<td><p>function, public state variable</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&#64;inheritdoc</span></code></p></td>
<td><p>Copies all missing tags from the base function (must be followed by the contract name)</p></td>
<td><p>function, public state variable</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&#64;custom:...</span></code></p></td>
<td><p>Custom tag, semantics is application-defined</p></td>
<td><p>everywhere</p></td>
</tr>
</tbody>
</table>
<p>If your function returns multiple values, like <code class="docutils literal notranslate"><span class="pre">(int</span> <span class="pre">quotient,</span> <span class="pre">int</span> <span class="pre">remainder)</span></code>
then use multiple <code class="docutils literal notranslate"><span class="pre">&#64;return</span></code> statements in the same format as the <code class="docutils literal notranslate"><span class="pre">&#64;param</span></code> statements.</p>
<p>Custom tags start with <code class="docutils literal notranslate"><span class="pre">&#64;custom:</span></code> and must be followed by one or more lowercase letters or hyphens.
It cannot start with a hyphen however. They can be used everywhere and are part of the developer documentation.</p>
<section id="dynamic-expressions">
<span id="header-dynamic"></span><h4>Dynamic expressions<a class="headerlink" href="#dynamic-expressions" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>The Solidity compiler will pass through NatSpec documentation from your Solidity
source code to the JSON output as described in this guide. The consumer of this
JSON output, for example the end-user client software, may present this to the end-user directly or it may apply some pre-processing.</p>
<p>For example, some client software will render:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8vIEBub3RpY2UgVGhpcyBmdW5jdGlvbiB3aWxsIG11bHRpcGx5IGBhYCBieSA3"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">/// </span><span class="cs">@notice</span><span class="c1"> This function will multiply `a` by 7</span>
</pre></div>
</div>
<p>to the end-user as:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>This function will multiply 10 by 7
</pre></div>
</div>
<p>if a function is being called and the input <code class="docutils literal notranslate"><span class="pre">a</span></code> is assigned a value of 10.</p>
<p>Specifying these dynamic expressions is outside the scope of the Solidity
documentation and you may read more at
<a class="reference external" href="https://github.com/aragon/radspec">the radspec project</a>.</p>
</section>
<section id="inheritance-notes">
<span id="header-inheritance"></span><h4>Inheritance Notes<a class="headerlink" href="#inheritance-notes" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Functions without NatSpec will automatically inherit the documentation of their
base function. Exceptions to this are:</p>
<ul class="simple">
<li><p>When the parameter names are different.</p></li>
<li><p>When there is more than one base function.</p></li>
<li><p>When there is an explicit <code class="docutils literal notranslate"><span class="pre">&#64;inheritdoc</span></code> tag which specifies which contract should be used to inherit.</p></li>
</ul>
</section>
</section>
<section id="documentation-output">
<span id="header-output"></span><h3>Documentation Output<a class="headerlink" href="#documentation-output" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>When parsed by the compiler, documentation such as the one from the
above example will produce two different JSON files. One is meant to be
consumed by the end user as a notice when a function is executed and the
other to be used by the developer.</p>
<p>If the above contract is saved as <code class="docutils literal notranslate"><span class="pre">ex1.sol</span></code> then you can generate the
documentation using:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=c29sYyAtLXVzZXJkb2MgLS1kZXZkb2MgZXgxLnNvbA=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="n">solc</span> <span class="o">--</span><span class="n">userdoc</span> <span class="o">--</span><span class="n">devdoc</span> <span class="n">ex1</span><span class="p">.</span><span class="n">sol</span>
</pre></div>
</div>
<p>And the output is below.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Starting Solidity version 0.6.11 the NatSpec output also contains a <code class="docutils literal notranslate"><span class="pre">version</span></code> and a <code class="docutils literal notranslate"><span class="pre">kind</span></code> field.
Currently the <code class="docutils literal notranslate"><span class="pre">version</span></code> is set to <code class="docutils literal notranslate"><span class="pre">1</span></code> and <code class="docutils literal notranslate"><span class="pre">kind</span></code> must be one of <code class="docutils literal notranslate"><span class="pre">user</span></code> or <code class="docutils literal notranslate"><span class="pre">dev</span></code>.
In the future it is possible that new versions will be introduced, deprecating older ones.</p>
</div>
<section id="user-documentation">
<span id="header-user-doc"></span><h4>User Documentation<a class="headerlink" href="#user-documentation" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>The above documentation will produce the following user documentation
JSON file as output:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=ewogICJ2ZXJzaW9uIiA6IDEsCiAgImtpbmQiIDogInVzZXIiLAogICJtZXRob2RzIiA6CiAgewogICAgImFnZSh1aW50MjU2KSIgOgogICAgewogICAgICAibm90aWNlIiA6ICJDYWxjdWxhdGUgdHJlZSBhZ2UgaW4geWVhcnMsIHJvdW5kZWQgdXAsIGZvciBsaXZlIHRyZWVzIgogICAgfQogIH0sCiAgIm5vdGljZSIgOiAiWW91IGNhbiB1c2UgdGhpcyBjb250cmFjdCBmb3Igb25seSB0aGUgbW9zdCBiYXNpYyBzaW11bGF0aW9uIgp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s">&quot;version&quot;</span> <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="s">&quot;kind&quot;</span> <span class="o">:</span> <span class="s">&quot;user&quot;</span><span class="p">,</span>
  <span class="s">&quot;methods&quot;</span> <span class="o">:</span>
  <span class="p">{</span>
    <span class="s">&quot;age(uint256)&quot;</span> <span class="o">:</span>
    <span class="p">{</span>
      <span class="s">&quot;notice&quot;</span> <span class="o">:</span> <span class="s">&quot;Calculate tree age in years, rounded up, for live trees&quot;</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="s">&quot;notice&quot;</span> <span class="o">:</span> <span class="s">&quot;You can use this contract for only the most basic simulation&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Note that the key by which to find the methods is the function‚Äôs
canonical signature as defined in the <a class="reference internal" href="index.html#abi-function-selector"><span class="std std-ref">Contract
ABI</span></a> and not simply the function‚Äôs
name.</p>
</section>
<section id="developer-documentation">
<span id="header-developer-doc"></span><h4>Developer Documentation<a class="headerlink" href="#developer-documentation" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Apart from the user documentation file, a developer documentation JSON
file should also be produced and should look like this:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=ewogICJ2ZXJzaW9uIiA6IDEsCiAgImtpbmQiIDogImRldiIsCiAgImF1dGhvciIgOiAiTGFycnkgQS4gR2FyZG5lciIsCiAgImRldGFpbHMiIDogIkFsbCBmdW5jdGlvbiBjYWxscyBhcmUgY3VycmVudGx5IGltcGxlbWVudGVkIHdpdGhvdXQgc2lkZSBlZmZlY3RzIiwKICAiY3VzdG9tOmV4cGVyaW1lbnRhbCIgOiAiVGhpcyBpcyBhbiBleHBlcmltZW50YWwgY29udHJhY3QuIiwKICAibWV0aG9kcyIgOgogIHsKICAgICJhZ2UodWludDI1NikiIDoKICAgIHsKICAgICAgImRldGFpbHMiIDogIlRoZSBBbGV4YW5kciBOLiBUZXRlYXJpbmcgYWxnb3JpdGhtIGNvdWxkIGluY3JlYXNlIHByZWNpc2lvbiIsCiAgICAgICJwYXJhbXMiIDoKICAgICAgewogICAgICAgICJyaW5ncyIgOiAiVGhlIG51bWJlciBvZiByaW5ncyBmcm9tIGRlbmRyb2Nocm9ub2xvZ2ljYWwgc2FtcGxlIgogICAgICB9LAogICAgICAicmV0dXJuIiA6ICJhZ2UgaW4geWVhcnMsIHJvdW5kZWQgdXAgZm9yIHBhcnRpYWwgeWVhcnMiCiAgICB9CiAgfSwKICAidGl0bGUiIDogIkEgc2ltdWxhdG9yIGZvciB0cmVlcyIKfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s">&quot;version&quot;</span> <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="s">&quot;kind&quot;</span> <span class="o">:</span> <span class="s">&quot;dev&quot;</span><span class="p">,</span>
  <span class="s">&quot;author&quot;</span> <span class="o">:</span> <span class="s">&quot;Larry A. Gardner&quot;</span><span class="p">,</span>
  <span class="s">&quot;details&quot;</span> <span class="o">:</span> <span class="s">&quot;All function calls are currently implemented without side effects&quot;</span><span class="p">,</span>
  <span class="s">&quot;custom:experimental&quot;</span> <span class="o">:</span> <span class="s">&quot;This is an experimental contract.&quot;</span><span class="p">,</span>
  <span class="s">&quot;methods&quot;</span> <span class="o">:</span>
  <span class="p">{</span>
    <span class="s">&quot;age(uint256)&quot;</span> <span class="o">:</span>
    <span class="p">{</span>
      <span class="s">&quot;details&quot;</span> <span class="o">:</span> <span class="s">&quot;The Alexandr N. Tetearing algorithm could increase precision&quot;</span><span class="p">,</span>
      <span class="s">&quot;params&quot;</span> <span class="o">:</span>
      <span class="p">{</span>
        <span class="s">&quot;rings&quot;</span> <span class="o">:</span> <span class="s">&quot;The number of rings from dendrochronological sample&quot;</span>
      <span class="p">},</span>
      <span class="s">&quot;return&quot;</span> <span class="o">:</span> <span class="s">&quot;age in years, rounded up for partial years&quot;</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="s">&quot;title&quot;</span> <span class="o">:</span> <span class="s">&quot;A simulator for trees&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
</section>
<span id="document-security-considerations"></span><section id="security-considerations">
<span id="id1"></span><h2>Security Considerations<a class="headerlink" href="#security-considerations" title="Permalink to this heading">ÔÉÅ</a></h2>
<p>While it is usually quite easy to build software that works as expected,
it is much harder to check that nobody can use it in a way that was <strong>not</strong> anticipated.</p>
<p>In Solidity, this is even more important because you can use smart contracts
to handle tokens or, possibly, even more valuable things. Furthermore, every
execution of a smart contract happens in public and, in addition to that,
the source code is often available.</p>
<p>Of course you always have to consider how much is at stake:
You can compare a smart contract with a web service that is open to the
public (and thus, also to malicious actors) and perhaps even open source.
If you only store your grocery list on that web service, you might not have
to take too much care, but if you manage your bank account using that web service,
you should be more careful.</p>
<p>This section will list some pitfalls and general security recommendations but
can, of course, never be complete.  Also, keep in mind that even if your smart
contract code is bug-free, the compiler or the platform itself might have a
bug. A list of some publicly known security-relevant bugs of the compiler can
be found in the <a class="reference internal" href="index.html#known-bugs"><span class="std std-ref">list of known bugs</span></a>, which is also
machine-readable. Note that there is a bug bounty program that covers the code
generator of the Solidity compiler.</p>
<p>As always, with open source documentation, please help us extend this section
(especially, some examples would not hurt)!</p>
<p>NOTE: In addition to the list below, you can find more security recommendations and best practices
<a class="reference external" href="https://github.com/guylando/KnowledgeLists/blob/master/EthereumSmartContracts.md">in Guy Lando‚Äôs knowledge list</a> and
<a class="reference external" href="https://consensys.github.io/smart-contract-best-practices/">the Consensys GitHub repo</a>.</p>
<section id="pitfalls">
<h3>Pitfalls<a class="headerlink" href="#pitfalls" title="Permalink to this heading">ÔÉÅ</a></h3>
<section id="private-information-and-randomness">
<h4>Private Information and Randomness<a class="headerlink" href="#private-information-and-randomness" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Everything you use in a smart contract is publicly visible, even
local variables and state variables marked <code class="docutils literal notranslate"><span class="pre">private</span></code>.</p>
<p>Using random numbers in smart contracts is quite tricky if you do not want
miners to be able to cheat.</p>
</section>
<section id="re-entrancy">
<h4>Re-Entrancy<a class="headerlink" href="#re-entrancy" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Any interaction from a contract (A) with another contract (B) and any transfer
of Ether hands over control to that contract (B). This makes it possible for B
to call back into A before this interaction is completed. To give an example,
the following code contains a bug (it is just a snippet and not a
complete contract):</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC42LjAgPDAuOS4wOwoKLy8gVEhJUyBDT05UUkFDVCBDT05UQUlOUyBBIEJVRyAtIERPIE5PVCBVU0UKY29udHJhY3QgRnVuZCB7CiAgICAvLy8gQGRldiBNYXBwaW5nIG9mIGV0aGVyIHNoYXJlcyBvZiB0aGUgY29udHJhY3QuCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludCkgc2hhcmVzOwogICAgLy8vIFdpdGhkcmF3IHlvdXIgc2hhcmUuCiAgICBmdW5jdGlvbiB3aXRoZHJhdygpIHB1YmxpYyB7CiAgICAgICAgaWYgKHBheWFibGUobXNnLnNlbmRlcikuc2VuZChzaGFyZXNbbXNnLnNlbmRlcl0pKQogICAgICAgICAgICBzaGFyZXNbbXNnLnNlbmRlcl0gPSAwOwogICAgfQp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.6.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="c1">// THIS CONTRACT CONTAINS A BUG - DO NOT USE</span>
<span class="k">contract</span><span class="w"> </span><span class="ni">Fund</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">/// @dev Mapping of ether shares of the contract.</span>
<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span>shares<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="c1">/// Withdraw your share.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">withdraw</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span><span class="kt">payable</span><span class="p">(</span><span class="k">msg.sender</span><span class="p">).</span>send<span class="p">(</span>shares<span class="p">[</span><span class="k">msg.sender</span><span class="p">]))</span><span class="w"></span>
<span class="w">            </span>shares<span class="p">[</span><span class="k">msg.sender</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>The problem is not too serious here because of the limited gas as part
of <code class="docutils literal notranslate"><span class="pre">send</span></code>, but it still exposes a weakness: Ether transfer can always
include code execution, so the recipient could be a contract that calls
back into <code class="docutils literal notranslate"><span class="pre">withdraw</span></code>. This would let it get multiple refunds and
basically retrieve all the Ether in the contract. In particular, the
following contract will allow an attacker to refund multiple times
as it uses <code class="docutils literal notranslate"><span class="pre">call</span></code> which forwards all remaining gas by default:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC42LjIgPDAuOS4wOwoKLy8gVEhJUyBDT05UUkFDVCBDT05UQUlOUyBBIEJVRyAtIERPIE5PVCBVU0UKY29udHJhY3QgRnVuZCB7CiAgICAvLy8gQGRldiBNYXBwaW5nIG9mIGV0aGVyIHNoYXJlcyBvZiB0aGUgY29udHJhY3QuCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludCkgc2hhcmVzOwogICAgLy8vIFdpdGhkcmF3IHlvdXIgc2hhcmUuCiAgICBmdW5jdGlvbiB3aXRoZHJhdygpIHB1YmxpYyB7CiAgICAgICAgKGJvb2wgc3VjY2VzcywpID0gbXNnLnNlbmRlci5jYWxse3ZhbHVlOiBzaGFyZXNbbXNnLnNlbmRlcl19KCIiKTsKICAgICAgICBpZiAoc3VjY2VzcykKICAgICAgICAgICAgc2hhcmVzW21zZy5zZW5kZXJdID0gMDsKICAgIH0KfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.6.2</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="c1">// THIS CONTRACT CONTAINS A BUG - DO NOT USE</span>
<span class="k">contract</span><span class="w"> </span><span class="ni">Fund</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">/// @dev Mapping of ether shares of the contract.</span>
<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span>shares<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="c1">/// Withdraw your share.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">withdraw</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="nv">success</span><span class="p">,)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">msg.sender</span><span class="p">.</span>call<span class="p">{</span>value<span class="p">:</span><span class="w"> </span>shares<span class="p">[</span><span class="k">msg.sender</span><span class="p">]}(</span><span class="s2">&quot;&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>success<span class="p">)</span><span class="w"></span>
<span class="w">            </span>shares<span class="p">[</span><span class="k">msg.sender</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>To avoid re-entrancy, you can use the Checks-Effects-Interactions pattern as
outlined further below:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC42LjAgPDAuOS4wOwoKY29udHJhY3QgRnVuZCB7CiAgICAvLy8gQGRldiBNYXBwaW5nIG9mIGV0aGVyIHNoYXJlcyBvZiB0aGUgY29udHJhY3QuCiAgICBtYXBwaW5nKGFkZHJlc3MgPT4gdWludCkgc2hhcmVzOwogICAgLy8vIFdpdGhkcmF3IHlvdXIgc2hhcmUuCiAgICBmdW5jdGlvbiB3aXRoZHJhdygpIHB1YmxpYyB7CiAgICAgICAgdWludCBzaGFyZSA9IHNoYXJlc1ttc2cuc2VuZGVyXTsKICAgICAgICBzaGFyZXNbbXNnLnNlbmRlcl0gPSAwOwogICAgICAgIHBheWFibGUobXNnLnNlbmRlcikudHJhbnNmZXIoc2hhcmUpOwogICAgfQp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.6.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Fund</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">/// @dev Mapping of ether shares of the contract.</span>
<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span>shares<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="c1">/// Withdraw your share.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">withdraw</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="w"> </span><span class="nv">share</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>shares<span class="p">[</span><span class="k">msg.sender</span><span class="p">];</span><span class="w"></span>
<span class="w">        </span>shares<span class="p">[</span><span class="k">msg.sender</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">payable</span><span class="p">(</span><span class="k">msg.sender</span><span class="p">).</span>transfer<span class="p">(</span>share<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Note that re-entrancy is not only an effect of Ether transfer but of any
function call on another contract. Furthermore, you also have to take
multi-contract situations into account. A called contract could modify the
state of another contract you depend on.</p>
</section>
<section id="gas-limit-and-loops">
<h4>Gas Limit and Loops<a class="headerlink" href="#gas-limit-and-loops" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Loops that do not have a fixed number of iterations, for example, loops that depend on storage values, have to be used carefully:
Due to the block gas limit, transactions can only consume a certain amount of gas. Either explicitly or just due to
normal operation, the number of iterations in a loop can grow beyond the block gas limit which can cause the complete
contract to be stalled at a certain point. This may not apply to <code class="docutils literal notranslate"><span class="pre">view</span></code> functions that are only executed
to read data from the blockchain. Still, such functions may be called by other contracts as part of on-chain operations
and stall those. Please be explicit about such cases in the documentation of your contracts.</p>
</section>
<section id="sending-and-receiving-ether">
<h4>Sending and Receiving Ether<a class="headerlink" href="#sending-and-receiving-ether" title="Permalink to this heading">ÔÉÅ</a></h4>
<ul class="simple">
<li><p>Neither contracts nor ‚Äúexternal accounts‚Äù are currently able to prevent that someone sends them Ether.
Contracts can react on and reject a regular transfer, but there are ways
to move Ether without creating a message call. One way is to simply ‚Äúmine to‚Äù
the contract address and the second way is using <code class="docutils literal notranslate"><span class="pre">selfdestruct(x)</span></code>.</p></li>
<li><p>If a contract receives Ether (without a function being called),
either the <a class="reference internal" href="index.html#receive-ether-function"><span class="std std-ref">receive Ether</span></a>
or the <a class="reference internal" href="index.html#fallback-function"><span class="std std-ref">fallback</span></a> function is executed.
If it does not have a receive nor a fallback function, the Ether will be
rejected (by throwing an exception). During the execution of one of these
functions, the contract can only rely on the ‚Äúgas stipend‚Äù it is passed (2300
gas) being available to it at that time. This stipend is not enough to modify
storage (do not take this for granted though, the stipend might change with
future hard forks). To be sure that your contract can receive Ether in that
way, check the gas requirements of the receive and fallback functions
(for example in the ‚Äúdetails‚Äù section in Remix).</p></li>
<li><p>There is a way to forward more gas to the receiving contract using
<code class="docutils literal notranslate"><span class="pre">addr.call{value:</span> <span class="pre">x}(&quot;&quot;)</span></code>. This is essentially the same as <code class="docutils literal notranslate"><span class="pre">addr.transfer(x)</span></code>,
only that it forwards all remaining gas and opens up the ability for the
recipient to perform more expensive actions (and it returns a failure code
instead of automatically propagating the error). This might include calling back
into the sending contract or other state changes you might not have thought of.
So it allows for great flexibility for honest users but also for malicious actors.</p></li>
<li><p>Use the most precise units to represent the wei amount as possible, as you lose
any that is rounded due to a lack of precision.</p></li>
<li><p>If you want to send Ether using <code class="docutils literal notranslate"><span class="pre">address.transfer</span></code>, there are certain details to be aware of:</p>
<ol class="arabic simple">
<li><p>If the recipient is a contract, it causes its receive or fallback function
to be executed which can, in turn, call back the sending contract.</p></li>
<li><p>Sending Ether can fail due to the call depth going above 1024. Since the
caller is in total control of the call depth, they can force the
transfer to fail; take this possibility into account or use <code class="docutils literal notranslate"><span class="pre">send</span></code> and
make sure to always check its return value. Better yet, write your
contract using a pattern where the recipient can withdraw Ether instead.</p></li>
<li><p>Sending Ether can also fail because the execution of the recipient
contract requires more than the allotted amount of gas (explicitly by
using <a class="reference internal" href="index.html#assert-and-require"><span class="std std-ref">require</span></a>, <a class="reference internal" href="index.html#assert-and-require"><span class="std std-ref">assert</span></a>,
<a class="reference internal" href="index.html#assert-and-require"><span class="std std-ref">revert</span></a> or because the
operation is too expensive) - it ‚Äúruns out of gas‚Äù (OOG).  If you
use <code class="docutils literal notranslate"><span class="pre">transfer</span></code> or <code class="docutils literal notranslate"><span class="pre">send</span></code> with a return value check, this might
provide a means for the recipient to block progress in the sending
contract. Again, the best practice here is to use a <a class="reference internal" href="index.html#withdrawal-pattern"><span class="std std-ref">‚Äúwithdraw‚Äù
pattern instead of a ‚Äúsend‚Äù pattern</span></a>.</p></li>
</ol>
</li>
</ul>
</section>
<section id="call-stack-depth">
<h4>Call Stack Depth<a class="headerlink" href="#call-stack-depth" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>External function calls can fail any time because they exceed the maximum
call stack size limit of 1024. In such situations, Solidity throws an exception.
Malicious actors might be able to force the call stack to a high value
before they interact with your contract. Note that, since <a class="reference external" href="https://eips.ethereum.org/EIPS/eip-608">Tangerine Whistle</a> hardfork, the <a class="reference external" href="https://eips.ethereum.org/EIPS/eip-150">63/64 rule</a> makes call stack depth attack impractical. Also note that the call stack and the expression stack are unrelated, even though both have a size limit of 1024 stack slots.</p>
<p>Note that <code class="docutils literal notranslate"><span class="pre">.send()</span></code> does <strong>not</strong> throw an exception if the call stack is
depleted but rather returns <code class="docutils literal notranslate"><span class="pre">false</span></code> in that case. The low-level functions
<code class="docutils literal notranslate"><span class="pre">.call()</span></code>, <code class="docutils literal notranslate"><span class="pre">.delegatecall()</span></code> and <code class="docutils literal notranslate"><span class="pre">.staticcall()</span></code> behave in the same way.</p>
</section>
<section id="authorized-proxies">
<h4>Authorized Proxies<a class="headerlink" href="#authorized-proxies" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>If your contract can act as a proxy, i.e. if it can call arbitrary contracts
with user-supplied data, then the user can essentially assume the identity
of the proxy contract. Even if you have other protective measures in place,
it is best to build your contract system such that the proxy does not have
any permissions (not even for itself). If needed, you can accomplish that
using a second proxy:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5IF4wLjguMDsKY29udHJhY3QgUHJveHlXaXRoTW9yZUZ1bmN0aW9uYWxpdHkgewogICAgUGVybWlzc2lvbmxlc3NQcm94eSBwcm94eTsKCiAgICBmdW5jdGlvbiBjYWxsT3RoZXIoYWRkcmVzcyBhZGRyLCBieXRlcyBtZW1vcnkgcGF5bG9hZCkgcHVibGljCiAgICAgICAgICAgIHJldHVybnMgKGJvb2wsIGJ5dGVzIG1lbW9yeSkgewogICAgICAgIHJldHVybiBwcm94eS5jYWxsT3RoZXIoYWRkciwgcGF5bG9hZCk7CiAgICB9CiAgICAvLyBPdGhlciBmdW5jdGlvbnMgYW5kIG90aGVyIGZ1bmN0aW9uYWxpdHkKfQoKLy8gVGhpcyBpcyB0aGUgZnVsbCBjb250cmFjdCwgaXQgaGFzIG5vIG90aGVyIGZ1bmN0aW9uYWxpdHkgYW5kCi8vIHJlcXVpcmVzIG5vIHByaXZpbGVnZXMgdG8gd29yay4KY29udHJhY3QgUGVybWlzc2lvbmxlc3NQcm94eSB7CiAgICBmdW5jdGlvbiBjYWxsT3RoZXIoYWRkcmVzcyBhZGRyLCBieXRlcyBtZW1vcnkgcGF5bG9hZCkgcHVibGljCiAgICAgICAgICAgIHJldHVybnMgKGJvb2wsIGJ5dGVzIG1lbW9yeSkgewogICAgICAgIHJldHVybiBhZGRyLmNhbGwocGF5bG9hZCk7CiAgICB9Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.8.0</span><span class="p">;</span><span class="w"></span>
<span class="k">contract</span><span class="w"> </span><span class="ni">ProxyWithMoreFunctionality</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span>PermissionlessProxy<span class="w"> </span>proxy<span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">callOther</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">addr</span><span class="p">,</span><span class="w"> </span><span class="kt">bytes</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>payload<span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"></span>
<span class="w">            </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="kt">bytes</span><span class="w"> </span><span class="nv">memory</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>proxy<span class="p">.</span>callOther<span class="p">(</span>addr<span class="p">,</span><span class="w"> </span>payload<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Other functions and other functionality</span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// This is the full contract, it has no other functionality and</span>
<span class="c1">// requires no privileges to work.</span>
<span class="k">contract</span><span class="w"> </span><span class="ni">PermissionlessProxy</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">callOther</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">addr</span><span class="p">,</span><span class="w"> </span><span class="kt">bytes</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>payload<span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"></span>
<span class="w">            </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="kt">bytes</span><span class="w"> </span><span class="nv">memory</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>addr<span class="p">.</span>call<span class="p">(</span>payload<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="tx-origin">
<h4>tx.origin<a class="headerlink" href="#tx-origin" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Never use tx.origin for authorization. Let‚Äôs say you have a wallet contract like this:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC43LjAgPDAuOS4wOwovLyBUSElTIENPTlRSQUNUIENPTlRBSU5TIEEgQlVHIC0gRE8gTk9UIFVTRQpjb250cmFjdCBUeFVzZXJXYWxsZXQgewogICAgYWRkcmVzcyBvd25lcjsKCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgICBvd25lciA9IG1zZy5zZW5kZXI7CiAgICB9CgogICAgZnVuY3Rpb24gdHJhbnNmZXJUbyhhZGRyZXNzIHBheWFibGUgZGVzdCwgdWludCBhbW91bnQpIHB1YmxpYyB7CiAgICAgICAgLy8gVEhFIEJVRyBJUyBSSUdIVCBIRVJFLCB5b3UgbXVzdCB1c2UgbXNnLnNlbmRlciBpbnN0ZWFkIG9mIHR4Lm9yaWdpbgogICAgICAgIHJlcXVpcmUodHgub3JpZ2luID09IG93bmVyKTsKICAgICAgICBkZXN0LnRyYW5zZmVyKGFtb3VudCk7CiAgICB9Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.7.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>
<span class="c1">// THIS CONTRACT CONTAINS A BUG - DO NOT USE</span>
<span class="k">contract</span><span class="w"> </span><span class="ni">TxUserWallet</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">owner</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kt">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>owner<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">msg.sender</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">transferTo</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">payable</span><span class="w"> </span>dest<span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">amount</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// THE BUG IS RIGHT HERE, you must use msg.sender instead of tx.origin</span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span><span class="k">tx.origin</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>owner<span class="p">);</span><span class="w"></span>
<span class="w">        </span>dest<span class="p">.</span>transfer<span class="p">(</span>amount<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Now someone tricks you into sending Ether to the address of this attack wallet:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC43LjAgPDAuOS4wOwppbnRlcmZhY2UgVHhVc2VyV2FsbGV0IHsKICAgIGZ1bmN0aW9uIHRyYW5zZmVyVG8oYWRkcmVzcyBwYXlhYmxlIGRlc3QsIHVpbnQgYW1vdW50KSBleHRlcm5hbDsKfQoKY29udHJhY3QgVHhBdHRhY2tXYWxsZXQgewogICAgYWRkcmVzcyBwYXlhYmxlIG93bmVyOwoKICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgIG93bmVyID0gcGF5YWJsZShtc2cuc2VuZGVyKTsKICAgIH0KCiAgICByZWNlaXZlKCkgZXh0ZXJuYWwgcGF5YWJsZSB7CiAgICAgICAgVHhVc2VyV2FsbGV0KG1zZy5zZW5kZXIpLnRyYW5zZmVyVG8ob3duZXIsIG1zZy5zZW5kZXIuYmFsYW5jZSk7CiAgICB9Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.7.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>
interface<span class="w"> </span>TxUserWallet<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">transferTo</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">payable</span><span class="w"> </span>dest<span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">amount</span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">TxAttackWallet</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">payable</span><span class="w"> </span>owner<span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kt">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>owner<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">payable</span><span class="p">(</span><span class="k">msg.sender</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span>receive<span class="p">()</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>TxUserWallet<span class="p">(</span><span class="k">msg.sender</span><span class="p">).</span>transferTo<span class="p">(</span>owner<span class="p">,</span><span class="w"> </span><span class="k">msg.sender</span><span class="p">.</span>balance<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>If your wallet had checked <code class="docutils literal notranslate"><span class="pre">msg.sender</span></code> for authorization, it would get the address of the attack wallet, instead of the owner address. But by checking <code class="docutils literal notranslate"><span class="pre">tx.origin</span></code>, it gets the original address that kicked off the transaction, which is still the owner address. The attack wallet instantly drains all your funds.</p>
</section>
<section id="two-s-complement-underflows-overflows">
<span id="underflow-overflow"></span><h4>Two‚Äôs Complement / Underflows / Overflows<a class="headerlink" href="#two-s-complement-underflows-overflows" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>As in many programming languages, Solidity‚Äôs integer types are not actually integers.
They resemble integers when the values are small, but cannot represent arbitrarily large numbers.</p>
<p>The following code causes an overflow because the result of the addition is too large
to be stored in the type <code class="docutils literal notranslate"><span class="pre">uint8</span></code>:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=dWludDggeCA9IDI1NTsKdWludDggeSA9IDE7CnJldHVybiB4ICsgeTs="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">uint8</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">255</span><span class="p">;</span><span class="w"></span>
<span class="kt">uint8</span><span class="w"> </span><span class="nv">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">;</span><span class="w"></span>
<span class="kt">return</span><span class="w"> </span>x<span class="w"> </span><span class="o">+</span><span class="w"> </span>y<span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>Solidity has two modes in which it deals with these overflows: Checked and Unchecked or ‚Äúwrapping‚Äù mode.</p>
<p>The default checked mode will detect overflows and cause a failing assertion. You can disable this check
using <code class="docutils literal notranslate"><span class="pre">unchecked</span> <span class="pre">{</span> <span class="pre">...</span> <span class="pre">}</span></code>, causing the overflow to be silently ignored. The above code would return
<code class="docutils literal notranslate"><span class="pre">0</span></code> if wrapped in <code class="docutils literal notranslate"><span class="pre">unchecked</span> <span class="pre">{</span> <span class="pre">...</span> <span class="pre">}</span></code>.</p>
<p>Even in checked mode, do not assume you are protected from overflow bugs.
In this mode, overflows will always revert. If it is not possible to avoid the
overflow, this can lead to a smart contract being stuck in a certain state.</p>
<p>In general, read about the limits of two‚Äôs complement representation, which even has some
more special edge cases for signed numbers.</p>
<p>Try to use <code class="docutils literal notranslate"><span class="pre">require</span></code> to limit the size of inputs to a reasonable range and use the
<a class="reference internal" href="index.html#smt-checker"><span class="std std-ref">SMT checker</span></a> to find potential overflows.</p>
</section>
<section id="clearing-mappings">
<span id="id2"></span><h4>Clearing Mappings<a class="headerlink" href="#clearing-mappings" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>The Solidity type <code class="docutils literal notranslate"><span class="pre">mapping</span></code> (see <a class="reference internal" href="index.html#mapping-types"><span class="std std-ref">Mapping Types</span></a>) is a storage-only
key-value data structure that does not keep track of the keys that were
assigned a non-zero value.  Because of that, cleaning a mapping without extra
information about the written keys is not possible.
If a <code class="docutils literal notranslate"><span class="pre">mapping</span></code> is used as the base type of a dynamic storage array, deleting
or popping the array will have no effect over the <code class="docutils literal notranslate"><span class="pre">mapping</span></code> elements.  The
same happens, for example, if a <code class="docutils literal notranslate"><span class="pre">mapping</span></code> is used as the type of a member
field of a <code class="docutils literal notranslate"><span class="pre">struct</span></code> that is the base type of a dynamic storage array.  The
<code class="docutils literal notranslate"><span class="pre">mapping</span></code> is also ignored in assignments of structs or arrays containing a
<code class="docutils literal notranslate"><span class="pre">mapping</span></code>.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC42LjAgPDAuOS4wOwoKY29udHJhY3QgTWFwIHsKICAgIG1hcHBpbmcgKHVpbnQgPT4gdWludClbXSBhcnJheTsKCiAgICBmdW5jdGlvbiBhbGxvY2F0ZSh1aW50IG5ld01hcHMpIHB1YmxpYyB7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgbmV3TWFwczsgaSsrKQogICAgICAgICAgICBhcnJheS5wdXNoKCk7CiAgICB9CgogICAgZnVuY3Rpb24gd3JpdGVNYXAodWludCBtYXAsIHVpbnQga2V5LCB1aW50IHZhbHVlKSBwdWJsaWMgewogICAgICAgIGFycmF5W21hcF1ba2V5XSA9IHZhbHVlOwogICAgfQoKICAgIGZ1bmN0aW9uIHJlYWRNYXAodWludCBtYXAsIHVpbnQga2V5KSBwdWJsaWMgdmlldyByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIGFycmF5W21hcF1ba2V5XTsKICAgIH0KCiAgICBmdW5jdGlvbiBlcmFzZU1hcHMoKSBwdWJsaWMgewogICAgICAgIGRlbGV0ZSBhcnJheTsKICAgIH0KfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.6.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Map</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">mapping</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">uint</span><span class="p">)[]</span><span class="w"> </span>array<span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">allocate</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">newMaps</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">for</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span><span class="w"> </span>i<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>newMaps<span class="p">;</span><span class="w"> </span>i<span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span>array<span class="p">.</span>push<span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">writeMap</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">map</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">key</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>array<span class="p">[</span>map<span class="p">][</span>key<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>value<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">readMap</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">map</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">key</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>array<span class="p">[</span>map<span class="p">][</span>key<span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">eraseMaps</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>delete<span class="w"> </span>array<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Consider the example above and the following sequence of calls: <code class="docutils literal notranslate"><span class="pre">allocate(10)</span></code>,
<code class="docutils literal notranslate"><span class="pre">writeMap(4,</span> <span class="pre">128,</span> <span class="pre">256)</span></code>.
At this point, calling <code class="docutils literal notranslate"><span class="pre">readMap(4,</span> <span class="pre">128)</span></code> returns 256.
If we call <code class="docutils literal notranslate"><span class="pre">eraseMaps</span></code>, the length of state variable <code class="docutils literal notranslate"><span class="pre">array</span></code> is zeroed, but
since its <code class="docutils literal notranslate"><span class="pre">mapping</span></code> elements cannot be zeroed, their information stays alive
in the contract‚Äôs storage.
After deleting <code class="docutils literal notranslate"><span class="pre">array</span></code>, calling <code class="docutils literal notranslate"><span class="pre">allocate(5)</span></code> allows us to access
<code class="docutils literal notranslate"><span class="pre">array[4]</span></code> again, and calling <code class="docutils literal notranslate"><span class="pre">readMap(4,</span> <span class="pre">128)</span></code> returns 256 even without
another call to <code class="docutils literal notranslate"><span class="pre">writeMap</span></code>.</p>
<p>If your <code class="docutils literal notranslate"><span class="pre">mapping</span></code> information must be deleted, consider using a library similar to
<a class="reference external" href="https://github.com/ethereum/dapp-bin/blob/master/library/iterable_mapping.sol">iterable mapping</a>,
allowing you to traverse the keys and delete their values in the appropriate <code class="docutils literal notranslate"><span class="pre">mapping</span></code>.</p>
</section>
<section id="minor-details">
<h4>Minor Details<a class="headerlink" href="#minor-details" title="Permalink to this heading">ÔÉÅ</a></h4>
<ul class="simple">
<li><p>Types that do not occupy the full 32 bytes might contain ‚Äúdirty higher order bits‚Äù.
This is especially important if you access <code class="docutils literal notranslate"><span class="pre">msg.data</span></code> - it poses a malleability risk:
You can craft transactions that call a function <code class="docutils literal notranslate"><span class="pre">f(uint8</span> <span class="pre">x)</span></code> with a raw byte argument
of <code class="docutils literal notranslate"><span class="pre">0xff000001</span></code> and with <code class="docutils literal notranslate"><span class="pre">0x00000001</span></code>. Both are fed to the contract and both will
look like the number <code class="docutils literal notranslate"><span class="pre">1</span></code> as far as <code class="docutils literal notranslate"><span class="pre">x</span></code> is concerned, but <code class="docutils literal notranslate"><span class="pre">msg.data</span></code> will
be different, so if you use <code class="docutils literal notranslate"><span class="pre">keccak256(msg.data)</span></code> for anything, you will get different results.</p></li>
</ul>
</section>
</section>
<section id="recommendations">
<h3>Recommendations<a class="headerlink" href="#recommendations" title="Permalink to this heading">ÔÉÅ</a></h3>
<section id="take-warnings-seriously">
<h4>Take Warnings Seriously<a class="headerlink" href="#take-warnings-seriously" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>If the compiler warns you about something, you should change it.
Even if you do not think that this particular warning has security
implications, there might be another issue buried beneath it.
Any compiler warning we issue can be silenced by slight changes to the
code.</p>
<p>Always use the latest version of the compiler to be notified about all recently
introduced warnings.</p>
<p>Messages of type <code class="docutils literal notranslate"><span class="pre">info</span></code> issued by the compiler are not dangerous, and simply
represent extra suggestions and optional information that the compiler thinks
might be useful to the user.</p>
</section>
<section id="restrict-the-amount-of-ether">
<h4>Restrict the Amount of Ether<a class="headerlink" href="#restrict-the-amount-of-ether" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Restrict the amount of Ether (or other tokens) that can be stored in a smart
contract. If your source code, the compiler or the platform has a bug, these
funds may be lost. If you want to limit your loss, limit the amount of Ether.</p>
</section>
<section id="keep-it-small-and-modular">
<h4>Keep it Small and Modular<a class="headerlink" href="#keep-it-small-and-modular" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Keep your contracts small and easily understandable. Single out unrelated
functionality in other contracts or into libraries. General recommendations
about source code quality of course apply: Limit the amount of local variables,
the length of functions and so on. Document your functions so that others
can see what your intention was and whether it is different than what the code does.</p>
</section>
<section id="use-the-checks-effects-interactions-pattern">
<h4>Use the Checks-Effects-Interactions Pattern<a class="headerlink" href="#use-the-checks-effects-interactions-pattern" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Most functions will first perform some checks (who called the function,
are the arguments in range, did they send enough Ether, does the person
have tokens, etc.). These checks should be done first.</p>
<p>As the second step, if all checks passed, effects to the state variables
of the current contract should be made. Interaction with other contracts
should be the very last step in any function.</p>
<p>Early contracts delayed some effects and waited for external function
calls to return in a non-error state. This is often a serious mistake
because of the re-entrancy problem explained above.</p>
<p>Note that, also, calls to known contracts might in turn cause calls to
unknown contracts, so it is probably better to just always apply this pattern.</p>
</section>
<section id="include-a-fail-safe-mode">
<h4>Include a Fail-Safe Mode<a class="headerlink" href="#include-a-fail-safe-mode" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>While making your system fully decentralised will remove any intermediary,
it might be a good idea, especially for new code, to include some kind
of fail-safe mechanism:</p>
<p>You can add a function in your smart contract that performs some
self-checks like ‚ÄúHas any Ether leaked?‚Äù,
‚ÄúIs the sum of the tokens equal to the balance of the contract?‚Äù or similar things.
Keep in mind that you cannot use too much gas for that, so help through off-chain
computations might be needed there.</p>
<p>If the self-check fails, the contract automatically switches into some kind
of ‚Äúfailsafe‚Äù mode, which, for example, disables most of the features, hands over
control to a fixed and trusted third party or just converts the contract into
a simple ‚Äúgive me back my money‚Äù contract.</p>
</section>
<section id="ask-for-peer-review">
<h4>Ask for Peer Review<a class="headerlink" href="#ask-for-peer-review" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>The more people examine a piece of code, the more issues are found.
Asking people to review your code also helps as a cross-check to find out whether your code
is easy to understand - a very important criterion for good smart contracts.</p>
</section>
</section>
</section>
<span id="document-smtchecker"></span><section id="smtchecker-and-formal-verification">
<span id="formal-verification"></span><h2>SMTChecker and Formal Verification<a class="headerlink" href="#smtchecker-and-formal-verification" title="Permalink to this heading">ÔÉÅ</a></h2>
<p>Using formal verification it is possible to perform an automated mathematical
proof that your source code fulfills a certain formal specification.
The specification is still formal (just as the source code), but usually much
simpler.</p>
<p>Note that formal verification itself can only help you understand the
difference between what you did (the specification) and how you did it
(the actual implementation). You still need to check whether the specification
is what you wanted and that you did not miss any unintended effects of it.</p>
<p>Solidity implements a formal verification approach based on
<a class="reference external" href="https://en.wikipedia.org/wiki/Satisfiability_modulo_theories">SMT (Satisfiability Modulo Theories)</a> and
<a class="reference external" href="https://en.wikipedia.org/wiki/Horn-satisfiability">Horn</a> solving.
The SMTChecker module automatically tries to prove that the code satisfies the
specification given by <code class="docutils literal notranslate"><span class="pre">require</span></code> and <code class="docutils literal notranslate"><span class="pre">assert</span></code> statements. That is, it considers
<code class="docutils literal notranslate"><span class="pre">require</span></code> statements as assumptions and tries to prove that the conditions
inside <code class="docutils literal notranslate"><span class="pre">assert</span></code> statements are always true.  If an assertion failure is
found, a counterexample may be given to the user showing how the assertion can
be violated. If no warning is given by the SMTChecker for a property,
it means that the property is safe.</p>
<p>The other verification targets that the SMTChecker checks at compile time are:</p>
<ul class="simple">
<li><p>Arithmetic underflow and overflow.</p></li>
<li><p>Division by zero.</p></li>
<li><p>Trivial conditions and unreachable code.</p></li>
<li><p>Popping an empty array.</p></li>
<li><p>Out of bounds index access.</p></li>
<li><p>Insufficient funds for a transfer.</p></li>
</ul>
<p>All the targets above are automatically checked by default if all engines are
enabled, except underflow and overflow for Solidity &gt;=0.8.7.</p>
<p>The potential warnings that the SMTChecker reports are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;failing</span>&#160; <span class="pre">property&gt;</span> <span class="pre">happens</span> <span class="pre">here.</span></code>. This means that the SMTChecker proved that a certain property fails. A counterexample may be given, however in complex situations it may also not show a counterexample. This result may also be a false positive in certain cases, when the SMT encoding adds abstractions for Solidity code that is either hard or impossible to express.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;failing</span> <span class="pre">property&gt;</span> <span class="pre">might</span> <span class="pre">happen</span> <span class="pre">here</span></code>. This means that the solver could not prove either case within the given timeout. Since the result is unknown, the SMTChecker reports the potential failure for soundness. This may be solved by increasing the query timeout, but the problem might also simply be too hard for the engine to solve.</p></li>
</ul>
<p>To enable the SMTChecker, you must select <a class="reference internal" href="#smtchecker-engines"><span class="std std-ref">which engine should run</span></a>,
where the default is no engine. Selecting the engine enables the SMTChecker on all files.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Prior to Solidity 0.8.4, the default way to enable the SMTChecker was via
<code class="docutils literal notranslate"><span class="pre">pragma</span> <span class="pre">experimental</span> <span class="pre">SMTChecker;</span></code> and only the contracts containing the
pragma would be analyzed. That pragma has been deprecated, and although it
still enables the SMTChecker for backwards compatibility, it will be removed
in Solidity 0.9.0. Note also that now using the pragma even in a single file
enables the SMTChecker for all files.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The lack of warnings for a verification target represents an undisputed
mathematical proof of correctness, assuming no bugs in the SMTChecker and
the underlying solver. Keep in mind that these problems are
<em>very hard</em> and sometimes <em>impossible</em> to solve automatically in the
general case.  Therefore, several properties might not be solved or might
lead to false positives for large contracts. Every proven property should
be seen as an important achievement. For advanced users, see <a class="reference internal" href="#smtchecker-options"><span class="std std-ref">SMTChecker Tuning</span></a>
to learn a few options that might help proving more complex
properties.</p>
</div>
<section id="tutorial">
<h3>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this heading">ÔÉÅ</a></h3>
<section id="overflow">
<h4>Overflow<a class="headerlink" href="#overflow" title="Permalink to this heading">ÔÉÅ</a></h4>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC44LjA7Cgpjb250cmFjdCBPdmVyZmxvdyB7CiAgICB1aW50IGltbXV0YWJsZSB4OwogICAgdWludCBpbW11dGFibGUgeTsKCiAgICBmdW5jdGlvbiBhZGQodWludCB4XywgdWludCB5XykgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIHhfICsgeV87CiAgICB9CgogICAgY29uc3RydWN0b3IodWludCB4XywgdWludCB5XykgewogICAgICAgICh4LCB5KSA9ICh4XywgeV8pOwogICAgfQoKICAgIGZ1bmN0aW9uIHN0YXRlQWRkKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgICAgIHJldHVybiBhZGQoeCwgeSk7CiAgICB9Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// </span><span class="cs">SPDX-License-Identifier:</span><span class="c1"> GPL-3.0</span>
<span class="k">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.8</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">Overflow</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="kr">immutable</span> <span class="n">x</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="kr">immutable</span> <span class="n">y</span><span class="p">;</span>

    <span class="kd">function</span> <span class="n">add</span><span class="p">(</span><span class="kt">uint</span> <span class="n">x_</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">y_</span><span class="p">)</span> <span class="k">internal</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">x_</span> <span class="o">+</span> <span class="n">y_</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">constructor</span><span class="p">(</span><span class="kt">uint</span> <span class="n">x_</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">y_</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_</span><span class="p">,</span> <span class="n">y_</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">stateAdd</span><span class="p">()</span> <span class="k">public</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The contract above shows an overflow check example.
The SMTChecker does not check underflow and overflow by default for Solidity &gt;=0.8.7,
so we need to use the command line option <code class="docutils literal notranslate"><span class="pre">--model-checker-targets</span> <span class="pre">&quot;underflow,overflow&quot;</span></code>
or the JSON option <code class="docutils literal notranslate"><span class="pre">settings.modelChecker.targets</span> <span class="pre">=</span> <span class="pre">[&quot;underflow&quot;,</span> <span class="pre">&quot;overflow&quot;]</span></code>.
See <a class="reference internal" href="#smtchecker-targets"><span class="std std-ref">this section for targets configuration</span></a>.
Here, it reports the following:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Warning: CHC: Overflow (resulting value larger than 2**256 - 1) happens here.
Counterexample:
x = 1, y = 115792089237316195423570985008687907853269984665640564039457584007913129639935
 = 0

Transaction trace:
Overflow.constructor(1, 115792089237316195423570985008687907853269984665640564039457584007913129639935)
State: x = 1, y = 115792089237316195423570985008687907853269984665640564039457584007913129639935
Overflow.stateAdd()
    Overflow.add(1, 115792089237316195423570985008687907853269984665640564039457584007913129639935) -- internal call
 --&gt; o.sol:9:20:
  |
9 |             return x_ + y_;
  |                    ^^^^^^^
</pre></div>
</div>
<p>If we add <code class="docutils literal notranslate"><span class="pre">require</span></code> statements that filter out overflow cases,
the SMTChecker proves that no overflow is reachable (by not reporting warnings):</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC44LjA7Cgpjb250cmFjdCBPdmVyZmxvdyB7CiAgICB1aW50IGltbXV0YWJsZSB4OwogICAgdWludCBpbW11dGFibGUgeTsKCiAgICBmdW5jdGlvbiBhZGQodWludCB4XywgdWludCB5XykgaW50ZXJuYWwgcHVyZSByZXR1cm5zICh1aW50KSB7CiAgICAgICAgcmV0dXJuIHhfICsgeV87CiAgICB9CgogICAgY29uc3RydWN0b3IodWludCB4XywgdWludCB5XykgewogICAgICAgICh4LCB5KSA9ICh4XywgeV8pOwogICAgfQoKICAgIGZ1bmN0aW9uIHN0YXRlQWRkKCkgcHVibGljIHZpZXcgcmV0dXJucyAodWludCkgewogICAgICAgIHJlcXVpcmUoeCA8IHR5cGUodWludDEyOCkubWF4KTsKICAgICAgICByZXF1aXJlKHkgPCB0eXBlKHVpbnQxMjgpLm1heCk7CiAgICAgICAgcmV0dXJuIGFkZCh4LCB5KTsKICAgIH0KfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// </span><span class="cs">SPDX-License-Identifier:</span><span class="c1"> GPL-3.0</span>
<span class="k">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.8</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">Overflow</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="kr">immutable</span> <span class="n">x</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="kr">immutable</span> <span class="n">y</span><span class="p">;</span>

    <span class="kd">function</span> <span class="n">add</span><span class="p">(</span><span class="kt">uint</span> <span class="n">x_</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">y_</span><span class="p">)</span> <span class="k">internal</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">x_</span> <span class="o">+</span> <span class="n">y_</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">constructor</span><span class="p">(</span><span class="kt">uint</span> <span class="n">x_</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">y_</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_</span><span class="p">,</span> <span class="n">y_</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">stateAdd</span><span class="p">()</span> <span class="k">public</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="k">type(uint128).max);</span>
<span class="k">        require(y &lt; type(uint128).max</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="assert">
<h4>Assert<a class="headerlink" href="#assert" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>An assertion represents an invariant in your code: a property that must be true
<em>for all transactions, including all input and storage values</em>, otherwise there is a bug.</p>
<p>The code below defines a function <code class="docutils literal notranslate"><span class="pre">f</span></code> that guarantees no overflow.
Function <code class="docutils literal notranslate"><span class="pre">inv</span></code> defines the specification that <code class="docutils literal notranslate"><span class="pre">f</span></code> is monotonically increasing:
for every possible pair <code class="docutils literal notranslate"><span class="pre">(a,</span> <span class="pre">b)</span></code>, if <code class="docutils literal notranslate"><span class="pre">b</span> <span class="pre">&gt;</span> <span class="pre">a</span></code> then <code class="docutils literal notranslate"><span class="pre">f(b)</span> <span class="pre">&gt;</span> <span class="pre">f(a)</span></code>.
Since <code class="docutils literal notranslate"><span class="pre">f</span></code> is indeed monotonically increasing, the SMTChecker proves that our
property is correct. You are encouraged to play with the property and the function
definition to see what results come out!</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC44LjA7Cgpjb250cmFjdCBNb25vdG9uaWMgewogICAgZnVuY3Rpb24gZih1aW50IHgpIGludGVybmFsIHB1cmUgcmV0dXJucyAodWludCkgewogICAgICAgIHJlcXVpcmUoeCA8IHR5cGUodWludDEyOCkubWF4KTsKICAgICAgICByZXR1cm4geCAqIDQyOwogICAgfQoKICAgIGZ1bmN0aW9uIGludih1aW50IGEsIHVpbnQgYikgcHVibGljIHB1cmUgewogICAgICAgIHJlcXVpcmUoYiA+IGEpOwogICAgICAgIGFzc2VydChmKGIpID4gZihhKSk7CiAgICB9Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// </span><span class="cs">SPDX-License-Identifier:</span><span class="c1"> GPL-3.0</span>
<span class="k">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.8</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">Monotonic</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">f</span><span class="p">(</span><span class="kt">uint</span> <span class="n">x</span><span class="p">)</span> <span class="k">internal</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="k">type(uint128).max</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">42</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">inv</span><span class="p">(</span><span class="kt">uint</span> <span class="n">a</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">b</span><span class="p">)</span> <span class="k">public</span> <span class="k">pure</span> <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span><span class="n">b</span> <span class="o">&gt;</span> <span class="n">a</span><span class="p">);</span>
        <span class="nf">assert</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">f</span><span class="p">(</span><span class="n">a</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We can also add assertions inside loops to verify more complicated properties.
The following code searches for the maximum element of an unrestricted array of
numbers, and asserts the property that the found element must be greater or
equal every element in the array.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC44LjA7Cgpjb250cmFjdCBNYXggewogICAgZnVuY3Rpb24gbWF4KHVpbnRbXSBtZW1vcnkgYSkgcHVibGljIHB1cmUgcmV0dXJucyAodWludCkgewogICAgICAgIHVpbnQgbSA9IDA7CiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgYS5sZW5ndGg7ICsraSkKICAgICAgICAgICAgaWYgKGFbaV0gPiBtKQogICAgICAgICAgICAgICAgbSA9IGFbaV07CgogICAgICAgIGZvciAodWludCBpID0gMDsgaSA8IGEubGVuZ3RoOyArK2kpCiAgICAgICAgICAgIGFzc2VydChtID49IGFbaV0pOwoKICAgICAgICByZXR1cm4gbTsKICAgIH0KfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// </span><span class="cs">SPDX-License-Identifier:</span><span class="c1"> GPL-3.0</span>
<span class="k">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.8</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">Max</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">max</span><span class="p">(</span><span class="kt">uint</span><span class="p">[]</span> <span class="k">memory</span> <span class="n">a</span><span class="p">)</span> <span class="k">public</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">uint</span> <span class="n">m</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">a</span><span class="p">.</span><span class="n">length</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">m</span><span class="p">)</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>

        <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">a</span><span class="p">.</span><span class="n">length</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
            <span class="nf">assert</span><span class="p">(</span><span class="n">m</span> <span class="o">&gt;=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>

        <span class="k">return</span> <span class="n">m</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Note that in this example the SMTChecker will automatically try to prove three properties:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">++i</span></code> in the first loop does not overflow.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">++i</span></code> in the second loop does not overflow.</p></li>
<li><p>The assertion is always true.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The properties involve loops, which makes it <em>much much</em> harder than the previous
examples, so beware of loops!</p>
</div>
<p>All the properties are correctly proven safe. Feel free to change the
properties and/or add restrictions on the array to see different results.
For example, changing the code to</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC44LjA7Cgpjb250cmFjdCBNYXggewogICAgZnVuY3Rpb24gbWF4KHVpbnRbXSBtZW1vcnkgYSkgcHVibGljIHB1cmUgcmV0dXJucyAodWludCkgewogICAgICAgIHJlcXVpcmUoYS5sZW5ndGggPj0gNSk7CiAgICAgICAgdWludCBtID0gMDsKICAgICAgICBmb3IgKHVpbnQgaSA9IDA7IGkgPCBhLmxlbmd0aDsgKytpKQogICAgICAgICAgICBpZiAoYVtpXSA+IG0pCiAgICAgICAgICAgICAgICBtID0gYVtpXTsKCiAgICAgICAgZm9yICh1aW50IGkgPSAwOyBpIDwgYS5sZW5ndGg7ICsraSkKICAgICAgICAgICAgYXNzZXJ0KG0gPiBhW2ldKTsKCiAgICAgICAgcmV0dXJuIG07CiAgICB9Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// </span><span class="cs">SPDX-License-Identifier:</span><span class="c1"> GPL-3.0</span>
<span class="k">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.8</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">Max</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">max</span><span class="p">(</span><span class="kt">uint</span><span class="p">[]</span> <span class="k">memory</span> <span class="n">a</span><span class="p">)</span> <span class="k">public</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">length</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">);</span>
        <span class="kt">uint</span> <span class="n">m</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">a</span><span class="p">.</span><span class="n">length</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">m</span><span class="p">)</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>

        <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">a</span><span class="p">.</span><span class="n">length</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
            <span class="nf">assert</span><span class="p">(</span><span class="n">m</span> <span class="o">&gt;</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>

        <span class="k">return</span> <span class="n">m</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>gives us:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Warning: CHC: Assertion violation happens here.
Counterexample:

a = [0, 0, 0, 0, 0]
 = 0

Transaction trace:
Test.constructor()
Test.max([0, 0, 0, 0, 0])
  --&gt; max.sol:14:4:
   |
14 |            assert(m &gt; a[i]);
</pre></div>
</div>
</section>
<section id="state-properties">
<h4>State Properties<a class="headerlink" href="#state-properties" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>So far the examples only demonstrated the use of the SMTChecker over pure code,
proving properties about specific operations or algorithms.
A common type of properties in smart contracts are properties that involve the
state of the contract. Multiple transactions might be needed to make an assertion
fail for such a property.</p>
<p>As an example, consider a 2D grid where both axis have coordinates in the range (-2^128, 2^128 - 1).
Let us place a robot at position (0, 0). The robot can only move diagonally, one step at a time,
and cannot move outside the grid. The robot‚Äôs state machine can be represented by the smart contract
below.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC44LjA7Cgpjb250cmFjdCBSb2JvdCB7CiAgICBpbnQgeCA9IDA7CiAgICBpbnQgeSA9IDA7CgogICAgbW9kaWZpZXIgd2FsbCB7CiAgICAgICAgcmVxdWlyZSh4ID4gdHlwZShpbnQxMjgpLm1pbiAmJiB4IDwgdHlwZShpbnQxMjgpLm1heCk7CiAgICAgICAgcmVxdWlyZSh5ID4gdHlwZShpbnQxMjgpLm1pbiAmJiB5IDwgdHlwZShpbnQxMjgpLm1heCk7CiAgICAgICAgXzsKICAgIH0KCiAgICBmdW5jdGlvbiBtb3ZlTGVmdFVwKCkgd2FsbCBwdWJsaWMgewogICAgICAgIC0teDsKICAgICAgICArK3k7CiAgICB9CgogICAgZnVuY3Rpb24gbW92ZUxlZnREb3duKCkgd2FsbCBwdWJsaWMgewogICAgICAgIC0teDsKICAgICAgICAtLXk7CiAgICB9CgogICAgZnVuY3Rpb24gbW92ZVJpZ2h0VXAoKSB3YWxsIHB1YmxpYyB7CiAgICAgICAgKyt4OwogICAgICAgICsreTsKICAgIH0KCiAgICBmdW5jdGlvbiBtb3ZlUmlnaHREb3duKCkgd2FsbCBwdWJsaWMgewogICAgICAgICsreDsKICAgICAgICAtLXk7CiAgICB9CgogICAgZnVuY3Rpb24gaW52KCkgcHVibGljIHZpZXcgewogICAgICAgIGFzc2VydCgoeCArIHkpICUgMiA9PSAwKTsKICAgIH0KfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// </span><span class="cs">SPDX-License-Identifier:</span><span class="c1"> GPL-3.0</span>
<span class="k">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.8</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">Robot</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="kd">modifier</span> <span class="n">wall</span> <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="k">type(int128).min &amp;&amp; x &lt; type(int128).max);</span>
<span class="k">        require(y &gt; type(int128).min &amp;&amp; y &lt; type(int128).max</span><span class="p">);</span>
        <span class="k">_</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">moveLeftUp</span><span class="p">()</span> <span class="n">wall</span> <span class="k">public</span> <span class="p">{</span>
        <span class="o">--</span><span class="n">x</span><span class="p">;</span>
        <span class="o">++</span><span class="n">y</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">moveLeftDown</span><span class="p">()</span> <span class="n">wall</span> <span class="k">public</span> <span class="p">{</span>
        <span class="o">--</span><span class="n">x</span><span class="p">;</span>
        <span class="o">--</span><span class="n">y</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">moveRightUp</span><span class="p">()</span> <span class="n">wall</span> <span class="k">public</span> <span class="p">{</span>
        <span class="o">++</span><span class="n">x</span><span class="p">;</span>
        <span class="o">++</span><span class="n">y</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">moveRightDown</span><span class="p">()</span> <span class="n">wall</span> <span class="k">public</span> <span class="p">{</span>
        <span class="o">++</span><span class="n">x</span><span class="p">;</span>
        <span class="o">--</span><span class="n">y</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">inv</span><span class="p">()</span> <span class="k">public</span> <span class="k">view</span> <span class="p">{</span>
        <span class="nf">assert</span><span class="p">((</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Function <code class="docutils literal notranslate"><span class="pre">inv</span></code> represents an invariant of the state machine that <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">+</span> <span class="pre">y</span></code>
must be even.
The SMTChecker manages to prove that regardless how many commands we give the
robot, even if infinitely many, the invariant can <em>never</em> fail. The interested
reader may want to prove that fact manually as well.  Hint: this invariant is
inductive.</p>
<p>We can also trick the SMTChecker into giving us a path to a certain position we
think might be reachable.  We can add the property that (2, 4) is <em>not</em>
reachable, by adding the following function.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=ZnVuY3Rpb24gcmVhY2hfMl80KCkgcHVibGljIHZpZXcgewogICAgYXNzZXJ0KCEoeCA9PSAyICYmIHkgPT0gNCkpOwp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="n">reach_2_4</span><span class="p">()</span> <span class="k">public</span> <span class="k">view</span> <span class="p">{</span>
    <span class="nf">assert</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">&amp;&amp;</span> <span class="n">y</span> <span class="o">==</span> <span class="mi">4</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This property is false, and while proving that the property is false,
the SMTChecker tells us exactly <em>how</em> to reach (2, 4):</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Warning: CHC: Assertion violation happens here.
Counterexample:
x = 2, y = 4

Transaction trace:
Robot.constructor()
State: x = 0, y = 0
Robot.moveLeftUp()
State: x = (- 1), y = 1
Robot.moveRightUp()
State: x = 0, y = 2
Robot.moveRightUp()
State: x = 1, y = 3
Robot.moveRightUp()
State: x = 2, y = 4
Robot.reach_2_4()
  --&gt; r.sol:35:4:
   |
35 |            assert(!(x == 2 &amp;&amp; y == 4));
   |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
</pre></div>
</div>
<p>Note that the path above is not necessarily deterministic, as there are
other paths that could reach (2, 4). The choice of which path is shown
might change depending on the used solver, its version, or just randomly.</p>
</section>
<section id="external-calls-and-reentrancy">
<h4>External Calls and Reentrancy<a class="headerlink" href="#external-calls-and-reentrancy" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Every external call is treated as a call to unknown code by the SMTChecker.
The reasoning behind that is that even if the code of the called contract is
available at compile time, there is no guarantee that the deployed contract
will indeed be the same as the contract where the interface came from at
compile time.</p>
<p>In some cases, it is possible to automatically infer properties over state
variables that are still true even if the externally called code can do
anything, including reenter the caller contract.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC44LjA7CgppbnRlcmZhY2UgVW5rbm93biB7CiAgICBmdW5jdGlvbiBydW4oKSBleHRlcm5hbDsKfQoKY29udHJhY3QgTXV0ZXggewogICAgdWludCB4OwogICAgYm9vbCBsb2NrOwoKICAgIFVua25vd24gaW1tdXRhYmxlIHVua25vd247CgogICAgY29uc3RydWN0b3IoVW5rbm93biB1KSB7CiAgICAgICAgcmVxdWlyZShhZGRyZXNzKHUpICE9IGFkZHJlc3MoMCkpOwogICAgICAgIHVua25vd24gPSB1OwogICAgfQoKICAgIG1vZGlmaWVyIG11dGV4IHsKICAgICAgICByZXF1aXJlKCFsb2NrKTsKICAgICAgICBsb2NrID0gdHJ1ZTsKICAgICAgICBfOwogICAgICAgIGxvY2sgPSBmYWxzZTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZXQodWludCB4XykgbXV0ZXggcHVibGljIHsKICAgICAgICB4ID0geF87CiAgICB9CgogICAgZnVuY3Rpb24gcnVuKCkgbXV0ZXggcHVibGljIHsKICAgICAgICB1aW50IHhQcmUgPSB4OwogICAgICAgIHVua25vd24ucnVuKCk7CiAgICAgICAgYXNzZXJ0KHhQcmUgPT0geCk7CiAgICB9Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// </span><span class="cs">SPDX-License-Identifier:</span><span class="c1"> GPL-3.0</span>
<span class="k">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.8</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">interface</span> <span class="n">Unknown</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">run</span><span class="p">()</span> <span class="k">external</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">Mutex</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="n">x</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">lock</span><span class="p">;</span>

    <span class="n">Unknown</span> <span class="kr">immutable</span> <span class="n">unknown</span><span class="p">;</span>

    <span class="kd">constructor</span><span class="p">(</span><span class="n">Unknown</span> <span class="n">u</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">!=</span> <span class="kt">address</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
        <span class="n">unknown</span> <span class="o">=</span> <span class="n">u</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">modifier</span> <span class="n">mutex</span> <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span><span class="o">!</span><span class="n">lock</span><span class="p">);</span>
        <span class="n">lock</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="k">_</span><span class="p">;</span>
        <span class="n">lock</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">set</span><span class="p">(</span><span class="kt">uint</span> <span class="n">x_</span><span class="p">)</span> <span class="n">mutex</span> <span class="k">public</span> <span class="p">{</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x_</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">run</span><span class="p">()</span> <span class="n">mutex</span> <span class="k">public</span> <span class="p">{</span>
        <span class="kt">uint</span> <span class="n">xPre</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
        <span class="n">unknown</span><span class="p">.</span><span class="n">run</span><span class="p">();</span>
        <span class="nf">assert</span><span class="p">(</span><span class="n">xPre</span> <span class="o">==</span> <span class="n">x</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The example above shows a contract that uses a mutex flag to forbid reentrancy.
The solver is able to infer that when <code class="docutils literal notranslate"><span class="pre">unknown.run()</span></code> is called, the contract
is already ‚Äúlocked‚Äù, so it would not be possible to change the value of <code class="docutils literal notranslate"><span class="pre">x</span></code>,
regardless of what the unknown called code does.</p>
<p>If we ‚Äúforget‚Äù to use the <code class="docutils literal notranslate"><span class="pre">mutex</span></code> modifier on function <code class="docutils literal notranslate"><span class="pre">set</span></code>, the
SMTChecker is able to synthesize the behaviour of the externally called code so
that the assertion fails:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Warning: CHC: Assertion violation happens here.
Counterexample:
x = 1, lock = true, unknown = 1

Transaction trace:
Mutex.constructor(1)
State: x = 0, lock = false, unknown = 1
Mutex.run()
    unknown.run() -- untrusted external call, synthesized as:
        Mutex.set(1) -- reentrant call
  --&gt; m.sol:32:3:
   |
32 |                assert(xPre == x);
   |                ^^^^^^^^^^^^^^^^^
</pre></div>
</div>
</section>
</section>
<section id="smtchecker-options-and-tuning">
<span id="smtchecker-options"></span><h3>SMTChecker Options and Tuning<a class="headerlink" href="#smtchecker-options-and-tuning" title="Permalink to this heading">ÔÉÅ</a></h3>
<section id="timeout">
<h4>Timeout<a class="headerlink" href="#timeout" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>The SMTChecker uses a hardcoded resource limit (<code class="docutils literal notranslate"><span class="pre">rlimit</span></code>) chosen per solver,
which is not precisely related to time. We chose the <code class="docutils literal notranslate"><span class="pre">rlimit</span></code> option as the default
because it gives more determinism guarantees than time inside the solver.</p>
<p>This options translates roughly to ‚Äúa few seconds timeout‚Äù per query. Of course many properties
are very complex and need a lot of time to be solved, where determinism does not matter.
If the SMTChecker does not manage to solve the contract properties with the default <code class="docutils literal notranslate"><span class="pre">rlimit</span></code>,
a timeout can be given in milliseconds via the CLI option <code class="docutils literal notranslate"><span class="pre">--model-checker-timeout</span> <span class="pre">&lt;time&gt;</span></code> or
the JSON option <code class="docutils literal notranslate"><span class="pre">settings.modelChecker.timeout=&lt;time&gt;</span></code>, where 0 means no timeout.</p>
</section>
<section id="verification-targets">
<span id="smtchecker-targets"></span><h4>Verification Targets<a class="headerlink" href="#verification-targets" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>The types of verification targets created by the SMTChecker can also be
customized via the CLI option <code class="docutils literal notranslate"><span class="pre">--model-checker-target</span> <span class="pre">&lt;targets&gt;</span></code> or the JSON
option <code class="docutils literal notranslate"><span class="pre">settings.modelChecker.targets=&lt;targets&gt;</span></code>.
In the CLI case, <code class="docutils literal notranslate"><span class="pre">&lt;targets&gt;</span></code> is a no-space-comma-separated list of one or
more verification targets, and an array of one or more targets as strings in
the JSON input.
The keywords that represent the targets are:</p>
<ul class="simple">
<li><p>Assertions: <code class="docutils literal notranslate"><span class="pre">assert</span></code>.</p></li>
<li><p>Arithmetic underflow: <code class="docutils literal notranslate"><span class="pre">underflow</span></code>.</p></li>
<li><p>Arithmetic overflow: <code class="docutils literal notranslate"><span class="pre">overflow</span></code>.</p></li>
<li><p>Division by zero: <code class="docutils literal notranslate"><span class="pre">divByZero</span></code>.</p></li>
<li><p>Trivial conditions and unreachable code: <code class="docutils literal notranslate"><span class="pre">constantCondition</span></code>.</p></li>
<li><p>Popping an empty array: <code class="docutils literal notranslate"><span class="pre">popEmptyArray</span></code>.</p></li>
<li><p>Out of bounds array/fixed bytes index access: <code class="docutils literal notranslate"><span class="pre">outOfBounds</span></code>.</p></li>
<li><p>Insufficient funds for a transfer: <code class="docutils literal notranslate"><span class="pre">balance</span></code>.</p></li>
<li><p>All of the above: <code class="docutils literal notranslate"><span class="pre">default</span></code> (CLI only).</p></li>
</ul>
<p>A common subset of targets might be, for example:
<code class="docutils literal notranslate"><span class="pre">--model-checker-targets</span> <span class="pre">assert,overflow</span></code>.</p>
<p>All targets are checked by default, except underflow and overflow for Solidity &gt;=0.8.7.</p>
<p>There is no precise heuristic on how and when to split verification targets,
but it can be useful especially when dealing with large contracts.</p>
</section>
<section id="unproved-targets">
<h4>Unproved Targets<a class="headerlink" href="#unproved-targets" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>If there are any unproved targets, the SMTChecker issues one warning stating
how many unproved targets there are. If the user wishes to see all the specific
unproved targets, the CLI option <code class="docutils literal notranslate"><span class="pre">--model-checker-show-unproved</span></code> and
the JSON option <code class="docutils literal notranslate"><span class="pre">settings.modelChecker.showUnproved</span> <span class="pre">=</span> <span class="pre">true</span></code> can be used.</p>
</section>
<section id="verified-contracts">
<h4>Verified Contracts<a class="headerlink" href="#verified-contracts" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>By default all the deployable contracts in the given sources are analyzed separately as
the one that will be deployed. This means that if a contract has many direct
and indirect inheritance parents, all of them will be analyzed on their own,
even though only the most derived will be accessed directly on the blockchain.
This causes an unnecessary burden on the SMTChecker and the solver.  To aid
cases like this, users can specify which contracts should be analyzed as the
deployed one. The parent contracts are of course still analyzed, but only in
the context of the most derived contract, reducing the complexity of the
encoding and generated queries. Note that abstract contracts are by default
not analyzed as the most derived by the SMTChecker.</p>
<p>The chosen contracts can be given via a comma-separated list (whitespace is not
allowed) of &lt;source&gt;:&lt;contract&gt; pairs in the CLI:
<code class="docutils literal notranslate"><span class="pre">--model-checker-contracts</span> <span class="pre">&quot;&lt;source1.sol:contract1&gt;,&lt;source2.sol:contract2&gt;,&lt;source2.sol:contract3&gt;&quot;</span></code>,
and via the object <code class="docutils literal notranslate"><span class="pre">settings.modelChecker.contracts</span></code> in the <a class="reference internal" href="index.html#compiler-api"><span class="std std-ref">JSON input</span></a>,
which has the following form:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;contracts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;source1.sol&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;contract1&quot;</span><span class="p">],</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;source2.sol&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;contract2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;contract3&quot;</span><span class="p">]</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="reported-inferred-inductive-invariants">
<h4>Reported Inferred Inductive Invariants<a class="headerlink" href="#reported-inferred-inductive-invariants" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>For properties that were proved safe with the CHC engine,
the SMTChecker can retrieve inductive invariants that were inferred by the Horn
solver as part of the proof.
Currently two types of invariants can be reported to the user:</p>
<ul class="simple">
<li><p>Contract Invariants: these are properties over the contract‚Äôs state variables
that are true before and after every possible transaction that the contract may ever run. For example, <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">&gt;=</span> <span class="pre">y</span></code>, where <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> are a contract‚Äôs state variables.</p></li>
<li><p>Reentrancy Properties: they represent the behavior of the contract
in the presence of external calls to unknown code. These properties can express a relation
between the value of the state variables before and after the external call, where the external call is free to do anything, including making reentrant calls to the analyzed contract. Primed variables represent the state variables‚Äô values after said external call. Example: <code class="docutils literal notranslate"><span class="pre">lock</span> <span class="pre">-&gt;</span> <span class="pre">x</span> <span class="pre">=</span> <span class="pre">x'</span></code>.</p></li>
</ul>
<p>The user can choose the type of invariants to be reported using the CLI option <code class="docutils literal notranslate"><span class="pre">--model-checker-invariants</span> <span class="pre">&quot;contract,reentrancy&quot;</span></code> or as an array in the field <code class="docutils literal notranslate"><span class="pre">settings.modelChecker.invariants</span></code> in the <a class="reference internal" href="index.html#compiler-api"><span class="std std-ref">JSON input</span></a>.
By default the SMTChecker does not report invariants.</p>
</section>
<section id="division-and-modulo-with-slack-variables">
<h4>Division and Modulo With Slack Variables<a class="headerlink" href="#division-and-modulo-with-slack-variables" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Spacer, the default Horn solver used by the SMTChecker, often dislikes division
and modulo operations inside Horn rules. Because of that, by default the
Solidity division and modulo operations are encoded using the constraint
<code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">=</span> <span class="pre">b</span> <span class="pre">*</span> <span class="pre">d</span> <span class="pre">+</span> <span class="pre">m</span></code> where <code class="docutils literal notranslate"><span class="pre">d</span> <span class="pre">=</span> <span class="pre">a</span> <span class="pre">/</span> <span class="pre">b</span></code> and <code class="docutils literal notranslate"><span class="pre">m</span> <span class="pre">=</span> <span class="pre">a</span> <span class="pre">%</span> <span class="pre">b</span></code>.
However, other solvers, such as Eldarica, prefer the syntactically precise operations.
The command line flag <code class="docutils literal notranslate"><span class="pre">--model-checker-div-mod-no-slacks</span></code> and the JSON option
<code class="docutils literal notranslate"><span class="pre">settings.modelChecker.divModNoSlacks</span></code> can be used to toggle the encoding
depending on the used solver preferences.</p>
</section>
<section id="natspec-function-abstraction">
<h4>Natspec Function Abstraction<a class="headerlink" href="#natspec-function-abstraction" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Certain functions including common math methods such as <code class="docutils literal notranslate"><span class="pre">pow</span></code>
and <code class="docutils literal notranslate"><span class="pre">sqrt</span></code> may be too complex to be analyzed in a fully automated way.
These functions can be annotated with Natspec tags that indicate to the
SMTChecker that these functions should be abstracted. This means that the
body of the function is not used, and when called, the function will:</p>
<ul class="simple">
<li><p>Return a nondeterministic value, and either keep the state variables unchanged if the abstracted function is view/pure, or also set the state variables to nondeterministic values otherwise. This can be used via the annotation <code class="docutils literal notranslate"><span class="pre">///</span> <span class="pre">&#64;custom:smtchecker</span> <span class="pre">abstract-function-nondet</span></code>.</p></li>
<li><p>Act as an uninterpreted function. This means that the semantics of the function (given by the body) are ignored, and the only property this function has is that given the same input it guarantees the same output. This is currently under development and will be available via the annotation <code class="docutils literal notranslate"><span class="pre">///</span> <span class="pre">&#64;custom:smtchecker</span> <span class="pre">abstract-function-uf</span></code>.</p></li>
</ul>
</section>
<section id="model-checking-engines">
<span id="smtchecker-engines"></span><h4>Model Checking Engines<a class="headerlink" href="#model-checking-engines" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>The SMTChecker module implements two different reasoning engines, a Bounded
Model Checker (BMC) and a system of Constrained Horn Clauses (CHC).  Both
engines are currently under development, and have different characteristics.
The engines are independent and every property warning states from which engine
it came. Note that all the examples above with counterexamples were
reported by CHC, the more powerful engine.</p>
<p>By default both engines are used, where CHC runs first, and every property that
was not proven is passed over to BMC. You can choose a specific engine via the CLI
option <code class="docutils literal notranslate"><span class="pre">--model-checker-engine</span> <span class="pre">{all,bmc,chc,none}</span></code> or the JSON option
<code class="docutils literal notranslate"><span class="pre">settings.modelChecker.engine={all,bmc,chc,none}</span></code>.</p>
<section id="bounded-model-checker-bmc">
<h5>Bounded Model Checker (BMC)<a class="headerlink" href="#bounded-model-checker-bmc" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>The BMC engine analyzes functions in isolation, that is, it does not take the
overall behavior of the contract over multiple transactions into account when
analyzing each function.  Loops are also ignored in this engine at the moment.
Internal function calls are inlined as long as they are not recursive, directly
or indirectly. External function calls are inlined if possible. Knowledge
that is potentially affected by reentrancy is erased.</p>
<p>The characteristics above make BMC prone to reporting false positives,
but it is also lightweight and should be able to quickly find small local bugs.</p>
</section>
<section id="constrained-horn-clauses-chc">
<h5>Constrained Horn Clauses (CHC)<a class="headerlink" href="#constrained-horn-clauses-chc" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>A contract‚Äôs Control Flow Graph (CFG) is modelled as a system of
Horn clauses, where the life cycle of the contract is represented by a loop
that can visit every public/external function non-deterministically. This way,
the behavior of the entire contract over an unbounded number of transactions
is taken into account when analyzing any function. Loops are fully supported
by this engine. Internal function calls are supported, and external function
calls assume the called code is unknown and can do anything.</p>
<p>The CHC engine is much more powerful than BMC in terms of what it can prove,
and might require more computing resources.</p>
</section>
</section>
<section id="smt-and-horn-solvers">
<h4>SMT and Horn solvers<a class="headerlink" href="#smt-and-horn-solvers" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>The two engines detailed above use automated theorem provers as their logical
backends.  BMC uses an SMT solver, whereas CHC uses a Horn solver. Often the
same tool can act as both, as seen in <a class="reference external" href="https://github.com/Z3Prover/z3">z3</a>,
which is primarily an SMT solver and makes <a class="reference external" href="https://spacer.bitbucket.io/">Spacer</a> available as a Horn solver, and <a class="reference external" href="https://github.com/uuverifiers/eldarica">Eldarica</a> which does both.</p>
<p>The user can choose which solvers should be used, if available, via the CLI
option <code class="docutils literal notranslate"><span class="pre">--model-checker-solvers</span> <span class="pre">{all,cvc4,smtlib2,z3}</span></code> or the JSON option
<code class="docutils literal notranslate"><span class="pre">settings.modelChecker.solvers=[smtlib2,z3]</span></code>, where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cvc4</span></code> is only available if the <code class="docutils literal notranslate"><span class="pre">solc</span></code> binary is compiled with it. Only BMC uses <code class="docutils literal notranslate"><span class="pre">cvc4</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">smtlib2</span></code> outputs SMT/Horn queries in the <a class="reference external" href="http://smtlib.cs.uiowa.edu/">smtlib2</a> format.
These can be used together with the compiler‚Äôs <a class="reference external" href="https://github.com/ethereum/solc-js">callback mechanism</a> so that
any solver binary from the system can be employed to synchronously return the results of the queries to the compiler.
This is currently the only way to use Eldarica, for example, since it does not have a C++ API.
This can be used by both BMC and CHC depending on which solvers are called.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">z3</span></code> is available</p>
<ul>
<li><p>if <code class="docutils literal notranslate"><span class="pre">solc</span></code> is compiled with it;</p></li>
<li><p>if a dynamic <code class="docutils literal notranslate"><span class="pre">z3</span></code> library of version 4.8.x is installed in a Linux system (from Solidity 0.7.6);</p></li>
<li><p>statically in <code class="docutils literal notranslate"><span class="pre">soljson.js</span></code> (from Solidity 0.6.9), that is, the Javascript binary of the compiler.</p></li>
</ul>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>z3 version 4.8.16 broke ABI compatibility with previous versions and cannot
be used with solc &lt;=0.8.13. If you are using z3 &gt;=4.8.16 please use solc
&gt;=0.8.14.</p>
</div>
<p>Since both BMC and CHC use <code class="docutils literal notranslate"><span class="pre">z3</span></code>, and <code class="docutils literal notranslate"><span class="pre">z3</span></code> is available in a greater variety
of environments, including in the browser, most users will almost never need to be
concerned about this option. More advanced users might apply this option to try
alternative solvers on more complex problems.</p>
<p>Please note that certain combinations of chosen engine and solver will lead to
the SMTChecker doing nothing, for example choosing CHC and <code class="docutils literal notranslate"><span class="pre">cvc4</span></code>.</p>
</section>
</section>
<section id="abstraction-and-false-positives">
<h3>Abstraction and False Positives<a class="headerlink" href="#abstraction-and-false-positives" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>The SMTChecker implements abstractions in an incomplete and sound way: If a bug
is reported, it might be a false positive introduced by abstractions (due to
erasing knowledge or using a non-precise type). If it determines that a
verification target is safe, it is indeed safe, that is, there are no false
negatives (unless there is a bug in the SMTChecker).</p>
<p>If a target cannot be proven you can try to help the solver by using the tuning
options in the previous section.
If you are sure of a false positive, adding <code class="docutils literal notranslate"><span class="pre">require</span></code> statements in the code
with more information may also give some more power to the solver.</p>
<section id="smt-encoding-and-types">
<h4>SMT Encoding and Types<a class="headerlink" href="#smt-encoding-and-types" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>The SMTChecker encoding tries to be as precise as possible, mapping Solidity types
and expressions to their closest <a class="reference external" href="http://smtlib.cs.uiowa.edu/">SMT-LIB</a>
representation, as shown in the table below.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 27%" />
<col style="width: 38%" />
<col style="width: 35%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Solidity type</p></th>
<th class="head"><p>SMT sort</p></th>
<th class="head"><p>Theories</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Boolean</p></td>
<td><p>Bool</p></td>
<td><p>Bool</p></td>
</tr>
<tr class="row-odd"><td><p>intN, uintN, address,
bytesN, enum, contract</p></td>
<td><p>Integer</p></td>
<td><p>LIA, NIA</p></td>
</tr>
<tr class="row-even"><td><p>array, mapping, bytes,
string</p></td>
<td><p>Tuple
(Array elements, Integer length)</p></td>
<td><p>Datatypes, Arrays, LIA</p></td>
</tr>
<tr class="row-odd"><td><p>struct</p></td>
<td><p>Tuple</p></td>
<td><p>Datatypes</p></td>
</tr>
<tr class="row-even"><td><p>other types</p></td>
<td><p>Integer</p></td>
<td><p>LIA</p></td>
</tr>
</tbody>
</table>
<p>Types that are not yet supported are abstracted by a single 256-bit unsigned
integer, where their unsupported operations are ignored.</p>
<p>For more details on how the SMT encoding works internally, see the paper
<a class="reference external" href="https://github.com/leonardoalt/text/blob/master/solidity_isola_2018/main.pdf">SMT-based Verification of Solidity Smart Contracts</a>.</p>
</section>
<section id="function-calls">
<h4>Function Calls<a class="headerlink" href="#function-calls" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>In the BMC engine, function calls to the same contract (or base contracts) are
inlined when possible, that is, when their implementation is available.  Calls
to functions in other contracts are not inlined even if their code is
available, since we cannot guarantee that the actual deployed code is the same.</p>
<p>The CHC engine creates nonlinear Horn clauses that use summaries of the called
functions to support internal function calls. External function calls are treated
as calls to unknown code, including potential reentrant calls.</p>
<p>Complex pure functions are abstracted by an uninterpreted function (UF) over
the arguments.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 48%" />
<col style="width: 52%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Functions</p></th>
<th class="head"><p>BMC/CHC behavior</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">assert</span></code></p></td>
<td><p>Verification target.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">require</span></code></p></td>
<td><p>Assumption.</p></td>
</tr>
<tr class="row-even"><td><p>internal call</p></td>
<td><p>BMC: Inline function call.
CHC: Function summaries.</p></td>
</tr>
<tr class="row-odd"><td><p>external call to known code</p></td>
<td><p>BMC: Inline function call or
erase knowledge about state variables
and local storage references.
CHC: Assume called code is unknown.
Try to infer invariants that hold
after the call returns.</p></td>
</tr>
<tr class="row-even"><td><p>Storage array push/pop</p></td>
<td><p>Supported precisely.
Checks whether it is popping an
empty array.</p></td>
</tr>
<tr class="row-odd"><td><p>ABI functions</p></td>
<td><p>Abstracted with UF.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">addmod</span></code>, <code class="docutils literal notranslate"><span class="pre">mulmod</span></code></p></td>
<td><p>Supported precisely.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">gasleft</span></code>, <code class="docutils literal notranslate"><span class="pre">blockhash</span></code>,
<code class="docutils literal notranslate"><span class="pre">keccak256</span></code>, <code class="docutils literal notranslate"><span class="pre">ecrecover</span></code>
<code class="docutils literal notranslate"><span class="pre">ripemd160</span></code></p></td>
<td><p>Abstracted with UF.</p></td>
</tr>
<tr class="row-even"><td><p>pure functions without
implementation (external or
complex)</p></td>
<td><p>Abstracted with UF</p></td>
</tr>
<tr class="row-odd"><td><p>external functions without
implementation</p></td>
<td><p>BMC: Erase state knowledge and assume
result is nondeterminisc.
CHC: Nondeterministic summary.
Try to infer invariants that hold
after the call returns.</p></td>
</tr>
<tr class="row-even"><td><p>transfer</p></td>
<td><p>BMC: Checks whether the contract‚Äôs
balance is sufficient.
CHC: does not yet perform the check.</p></td>
</tr>
<tr class="row-odd"><td><p>others</p></td>
<td><p>Currently unsupported</p></td>
</tr>
</tbody>
</table>
<p>Using abstraction means loss of precise knowledge, but in many cases it does
not mean loss of proving power.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC44LjA7Cgpjb250cmFjdCBSZWNvdmVyCnsKICAgIGZ1bmN0aW9uIGYoCiAgICAgICAgYnl0ZXMzMiBoYXNoLAogICAgICAgIHVpbnQ4IHYxLCB1aW50OCB2MiwKICAgICAgICBieXRlczMyIHIxLCBieXRlczMyIHIyLAogICAgICAgIGJ5dGVzMzIgczEsIGJ5dGVzMzIgczIKICAgICkgcHVibGljIHB1cmUgcmV0dXJucyAoYWRkcmVzcykgewogICAgICAgIGFkZHJlc3MgYTEgPSBlY3JlY292ZXIoaGFzaCwgdjEsIHIxLCBzMSk7CiAgICAgICAgcmVxdWlyZSh2MSA9PSB2Mik7CiAgICAgICAgcmVxdWlyZShyMSA9PSByMik7CiAgICAgICAgcmVxdWlyZShzMSA9PSBzMik7CiAgICAgICAgYWRkcmVzcyBhMiA9IGVjcmVjb3ZlcihoYXNoLCB2MiwgcjIsIHMyKTsKICAgICAgICBhc3NlcnQoYTEgPT0gYTIpOwogICAgICAgIHJldHVybiBhMTsKICAgIH0KfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.8.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Recover</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">f</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">hash</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint8</span><span class="w"> </span><span class="nv">v1</span><span class="p">,</span><span class="w"> </span><span class="kt">uint8</span><span class="w"> </span><span class="nv">v2</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">r1</span><span class="p">,</span><span class="w"> </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">r2</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">s1</span><span class="p">,</span><span class="w"> </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">s2</span><span class="w"></span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">address</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">a1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>ecrecover<span class="p">(</span><span class="kt">hash</span><span class="p">,</span><span class="w"> </span>v1<span class="p">,</span><span class="w"> </span>r1<span class="p">,</span><span class="w"> </span>s1<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>v1<span class="w"> </span><span class="o">==</span><span class="w"> </span>v2<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>r1<span class="w"> </span><span class="o">==</span><span class="w"> </span>r2<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span>s1<span class="w"> </span><span class="o">==</span><span class="w"> </span>s2<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">a2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>ecrecover<span class="p">(</span><span class="kt">hash</span><span class="p">,</span><span class="w"> </span>v2<span class="p">,</span><span class="w"> </span>r2<span class="p">,</span><span class="w"> </span>s2<span class="p">);</span><span class="w"></span>
<span class="w">        </span>assert<span class="p">(</span>a1<span class="w"> </span><span class="o">==</span><span class="w"> </span>a2<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>a1<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>In the example above, the SMTChecker is not expressive enough to actually
compute <code class="docutils literal notranslate"><span class="pre">ecrecover</span></code>, but by modelling the function calls as uninterpreted
functions we know that the return value is the same when called on equivalent
parameters. This is enough to prove that the assertion above is always true.</p>
<p>Abstracting a function call with an UF can be done for functions known to be
deterministic, and can be easily done for pure functions.  It is however
difficult to do this with general external functions, since they might depend
on state variables.</p>
</section>
<section id="reference-types-and-aliasing">
<h4>Reference Types and Aliasing<a class="headerlink" href="#reference-types-and-aliasing" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Solidity implements aliasing for reference types with the same <a class="reference internal" href="index.html#data-location"><span class="std std-ref">data
location</span></a>.
That means one variable may be modified through a reference to the same data
area.
The SMTChecker does not keep track of which references refer to the same data.
This implies that whenever a local reference or state variable of reference
type is assigned, all knowledge regarding variables of the same type and data
location is erased.
If the type is nested, the knowledge removal also includes all the prefix base
types.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC44LjA7Cgpjb250cmFjdCBBbGlhc2luZwp7CiAgICB1aW50W10gYXJyYXkxOwogICAgdWludFtdW10gYXJyYXkyOwogICAgZnVuY3Rpb24gZigKICAgICAgICB1aW50W10gbWVtb3J5IGEsCiAgICAgICAgdWludFtdIG1lbW9yeSBiLAogICAgICAgIHVpbnRbXVtdIG1lbW9yeSBjLAogICAgICAgIHVpbnRbXSBzdG9yYWdlIGQKICAgICkgaW50ZXJuYWwgewogICAgICAgIGFycmF5MVswXSA9IDQyOwogICAgICAgIGFbMF0gPSAyOwogICAgICAgIGNbMF1bMF0gPSAyOwogICAgICAgIGJbMF0gPSAxOwogICAgICAgIC8vIEVyYXNpbmcga25vd2xlZGdlIGFib3V0IG1lbW9yeSByZWZlcmVuY2VzIHNob3VsZCBub3QKICAgICAgICAvLyBlcmFzZSBrbm93bGVkZ2UgYWJvdXQgc3RhdGUgdmFyaWFibGVzLgogICAgICAgIGFzc2VydChhcnJheTFbMF0gPT0gNDIpOwogICAgICAgIC8vIEhvd2V2ZXIsIGFuIGFzc2lnbm1lbnQgdG8gYSBzdG9yYWdlIHJlZmVyZW5jZSB3aWxsIGVyYXNlCiAgICAgICAgLy8gc3RvcmFnZSBrbm93bGVkZ2UgYWNjb3JkaW5nbHkuCiAgICAgICAgZFswXSA9IDI7CiAgICAgICAgLy8gRmFpbHMgYXMgZmFsc2UgcG9zaXRpdmUgYmVjYXVzZSBvZiB0aGUgYXNzaWdubWVudCBhYm92ZS4KICAgICAgICBhc3NlcnQoYXJyYXkxWzBdID09IDQyKTsKICAgICAgICAvLyBGYWlscyBiZWNhdXNlIGBhID09IGJgIGlzIHBvc3NpYmxlLgogICAgICAgIGFzc2VydChhWzBdID09IDIpOwogICAgICAgIC8vIEZhaWxzIGJlY2F1c2UgYGNbaV0gPT0gYmAgaXMgcG9zc2libGUuCiAgICAgICAgYXNzZXJ0KGNbMF1bMF0gPT0gMik7CiAgICAgICAgYXNzZXJ0KGRbMF0gPT0gMik7CiAgICAgICAgYXNzZXJ0KGJbMF0gPT0gMSk7CiAgICB9CiAgICBmdW5jdGlvbiBnKAogICAgICAgIHVpbnRbXSBtZW1vcnkgYSwKICAgICAgICB1aW50W10gbWVtb3J5IGIsCiAgICAgICAgdWludFtdW10gbWVtb3J5IGMsCiAgICAgICAgdWludCB4CiAgICApIHB1YmxpYyB7CiAgICAgICAgZihhLCBiLCBjLCBhcnJheTJbeF0pOwogICAgfQp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.8.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Aliasing</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="p">[]</span><span class="w"> </span>array1<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="p">[][]</span><span class="w"> </span>array2<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">f</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>a<span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>b<span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="p">[][]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>c<span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="p">[]</span><span class="w"> </span>storage<span class="w"> </span>d<span class="w"></span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>array1<span class="p">[</span><span class="m m-Decimal">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">42</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span>a<span class="p">[</span><span class="m m-Decimal">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">2</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span>c<span class="p">[</span><span class="m m-Decimal">0</span><span class="p">][</span><span class="m m-Decimal">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">2</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span>b<span class="p">[</span><span class="m m-Decimal">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Erasing knowledge about memory references should not</span>
<span class="w">        </span><span class="c1">// erase knowledge about state variables.</span>
<span class="w">        </span>assert<span class="p">(</span>array1<span class="p">[</span><span class="m m-Decimal">0</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m m-Decimal">42</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// However, an assignment to a storage reference will erase</span>
<span class="w">        </span><span class="c1">// storage knowledge accordingly.</span>
<span class="w">        </span>d<span class="p">[</span><span class="m m-Decimal">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">2</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Fails as false positive because of the assignment above.</span>
<span class="w">        </span>assert<span class="p">(</span>array1<span class="p">[</span><span class="m m-Decimal">0</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m m-Decimal">42</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Fails because `a == b` is possible.</span>
<span class="w">        </span>assert<span class="p">(</span>a<span class="p">[</span><span class="m m-Decimal">0</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m m-Decimal">2</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Fails because `c[i] == b` is possible.</span>
<span class="w">        </span>assert<span class="p">(</span>c<span class="p">[</span><span class="m m-Decimal">0</span><span class="p">][</span><span class="m m-Decimal">0</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m m-Decimal">2</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span>assert<span class="p">(</span>d<span class="p">[</span><span class="m m-Decimal">0</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m m-Decimal">2</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span>assert<span class="p">(</span>b<span class="p">[</span><span class="m m-Decimal">0</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">g</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>a<span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>b<span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="p">[][]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>c<span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="w"> </span><span class="nv">x</span><span class="w"></span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>f<span class="p">(</span>a<span class="p">,</span><span class="w"> </span>b<span class="p">,</span><span class="w"> </span>c<span class="p">,</span><span class="w"> </span>array2<span class="p">[</span>x<span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>After the assignment to <code class="docutils literal notranslate"><span class="pre">b[0]</span></code>, we need to clear knowledge about <code class="docutils literal notranslate"><span class="pre">a</span></code> since
it has the same type (<code class="docutils literal notranslate"><span class="pre">uint[]</span></code>) and data location (memory).  We also need to
clear knowledge about <code class="docutils literal notranslate"><span class="pre">c</span></code>, since its base type is also a <code class="docutils literal notranslate"><span class="pre">uint[]</span></code> located
in memory. This implies that some <code class="docutils literal notranslate"><span class="pre">c[i]</span></code> could refer to the same data as
<code class="docutils literal notranslate"><span class="pre">b</span></code> or <code class="docutils literal notranslate"><span class="pre">a</span></code>.</p>
<p>Notice that we do not clear knowledge about <code class="docutils literal notranslate"><span class="pre">array</span></code> and <code class="docutils literal notranslate"><span class="pre">d</span></code> because they
are located in storage, even though they also have type <code class="docutils literal notranslate"><span class="pre">uint[]</span></code>.  However,
if <code class="docutils literal notranslate"><span class="pre">d</span></code> was assigned, we would need to clear knowledge about <code class="docutils literal notranslate"><span class="pre">array</span></code> and
vice-versa.</p>
</section>
<section id="contract-balance">
<h4>Contract Balance<a class="headerlink" href="#contract-balance" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>A contract may be deployed with funds sent to it, if <code class="docutils literal notranslate"><span class="pre">msg.value</span></code> &gt; 0 in the
deployment transaction.
However, the contract‚Äôs address may already have funds before deployment,
which are kept by the contract.
Therefore, the SMTChecker assumes that <code class="docutils literal notranslate"><span class="pre">address(this).balance</span> <span class="pre">&gt;=</span> <span class="pre">msg.value</span></code>
in the constructor in order to be consistent with the EVM rules.
The contract‚Äôs balance may also increase without triggering any calls to the
contract, if</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">selfdestruct</span></code> is executed by another contract with the analyzed contract
as the target of the remaining funds,</p></li>
<li><p>the contract is the coinbase (i.e., <code class="docutils literal notranslate"><span class="pre">block.coinbase</span></code>) of some block.</p></li>
</ul>
<p>To model this properly, the SMTChecker assumes that at every new transaction
the contract‚Äôs balance may grow by at least <code class="docutils literal notranslate"><span class="pre">msg.value</span></code>.</p>
</section>
</section>
<section id="real-world-assumptions">
<h3>Real World Assumptions<a class="headerlink" href="#real-world-assumptions" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Some scenarios can be expressed in Solidity and the EVM, but are expected to
never occur in practice.
One of such cases is the length of a dynamic storage array overflowing during a
push: If the <code class="docutils literal notranslate"><span class="pre">push</span></code> operation is applied to an array of length 2^256 - 1, its
length silently overflows.
However, this is unlikely to happen in practice, since the operations required
to grow the array to that point would take billions of years to execute.
Another similar assumption taken by the SMTChecker is that an address‚Äô balance
can never overflow.</p>
<p>A similar idea was presented in <a class="reference external" href="https://eips.ethereum.org/EIPS/eip-1985">EIP-1985</a>.</p>
</section>
</section>
<span id="document-resources"></span><section id="resources">
<h2>Resources<a class="headerlink" href="#resources" title="Permalink to this heading">ÔÉÅ</a></h2>
<section id="general-resources">
<h3>General Resources<a class="headerlink" href="#general-resources" title="Permalink to this heading">ÔÉÅ</a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://ethereum.org/en/developers/">Ethereum.org Developer Portal</a></p></li>
<li><p><a class="reference external" href="https://ethereum.stackexchange.com/">Ethereum StackExchange</a></p></li>
<li><p><a class="reference external" href="https://soliditylang.org/">Solidity Portal</a></p></li>
<li><p><a class="reference external" href="https://github.com/ethereum/solidity/blob/develop/Changelog.md">Solidity Changelog</a></p></li>
<li><p><a class="reference external" href="https://github.com/ethereum/solidity/">Solidity Source Code on GitHub</a></p></li>
<li><p><a class="reference external" href="index.html#ethereum_solidity:gitter.im">Solidity Language Users Chat</a></p></li>
<li><p><a class="reference external" href="index.html#ethereum_solidity-dev:gitter.im">Solidity Compiler Developers Chat</a></p></li>
<li><p><a class="reference external" href="https://github.com/bkrem/awesome-solidity">Awesome Solidity</a></p></li>
<li><p><a class="reference external" href="https://solidity-by-example.org/">Solidity by Example</a></p></li>
<li><p><a class="reference external" href="https://github.com/solidity-docs">Solidity Documentation Community Translations</a></p></li>
</ul>
</section>
<section id="integrated-ethereum-development-environments">
<h3>Integrated (Ethereum) Development Environments<a class="headerlink" href="#integrated-ethereum-development-environments" title="Permalink to this heading">ÔÉÅ</a></h3>
<blockquote>
<div><ul class="simple">
<li><dl class="simple">
<dt><a class="reference external" href="https://eth-brownie.readthedocs.io/en/stable/">Brownie</a></dt><dd><p>Python-based development and testing framework for smart contracts targeting the Ethereum Virtual Machine.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><a class="reference external" href="https://dapp.tools/">Dapp</a></dt><dd><p>Tool for building, testing and deploying smart contracts from the command line.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><a class="reference external" href="https://framework.embarklabs.io/">Embark</a></dt><dd><p>Developer platform for building and deploying decentralized applications.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><a class="reference external" href="https://github.com/gakonst/foundry">Foundry</a></dt><dd><p>Fast, portable and modular toolkit for Ethereum application development written in Rust.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><a class="reference external" href="https://hardhat.org/">Hardhat</a></dt><dd><p>Ethereum development environment with local Ethereum network, debugging features and plugin ecosystem.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><a class="reference external" href="https://remix.ethereum.org/">Remix</a></dt><dd><p>Browser-based IDE with integrated compiler and Solidity runtime environment without server-side components.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><a class="reference external" href="https://www.trufflesuite.com/truffle">Truffle</a></dt><dd><p>Ethereum development framework.</p>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</section>
<section id="editor-integrations">
<h3>Editor Integrations<a class="headerlink" href="#editor-integrations" title="Permalink to this heading">ÔÉÅ</a></h3>
<ul>
<li><p>Atom</p>
<blockquote>
<div><ul class="simple">
<li><dl class="simple">
<dt><a class="reference external" href="https://github.com/0mkara/etheratom">Etheratom</a></dt><dd><p>Plugin for the Atom editor that features syntax highlighting, compilation and a runtime environment (Backend node &amp; VM compatible).</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><a class="reference external" href="https://atom.io/packages/linter-solidity">Atom Solidity Linter</a></dt><dd><p>Plugin for the Atom editor that provides Solidity linting.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><a class="reference external" href="https://atom.io/packages/linter-solium">Atom Solium Linter</a></dt><dd><p>Configurable Solidity linter for Atom using Solium (now Ethlint) as a base.</p>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</li>
<li><p>Emacs</p>
<blockquote>
<div><ul class="simple">
<li><dl class="simple">
<dt><a class="reference external" href="https://github.com/ethereum/emacs-solidity/">Emacs Solidity</a></dt><dd><p>Plugin for the Emacs editor providing syntax highlighting and compilation error reporting.</p>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</li>
<li><p>IntelliJ</p>
<blockquote>
<div><ul class="simple">
<li><dl class="simple">
<dt><a class="reference external" href="https://plugins.jetbrains.com/plugin/9475-intellij-solidity">IntelliJ IDEA plugin</a></dt><dd><p>Solidity plugin for IntelliJ IDEA (and all other JetBrains IDEs)</p>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</li>
<li><p>Sublime</p>
<blockquote>
<div><ul class="simple">
<li><dl class="simple">
<dt><a class="reference external" href="https://packagecontrol.io/packages/Ethereum/">Package for SublimeText - Solidity language syntax</a></dt><dd><p>Solidity syntax highlighting for SublimeText editor.</p>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</li>
<li><p>Vim</p>
<blockquote>
<div><ul class="simple">
<li><dl class="simple">
<dt><a class="reference external" href="https://github.com/tomlion/vim-solidity/">Vim Solidity</a></dt><dd><p>Plugin for the Vim editor providing syntax highlighting.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><a class="reference external" href="https://github.com/vim-syntastic/syntastic">Vim Syntastic</a></dt><dd><p>Plugin for the Vim editor providing compile checking.</p>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</li>
<li><p>Visual Studio Code</p>
<blockquote>
<div><ul class="simple">
<li><dl class="simple">
<dt><a class="reference external" href="https://juan.blanco.ws/solidity-contracts-in-visual-studio-code/">Visual Studio Code extension</a></dt><dd><p>Solidity plugin for Microsoft Visual Studio Code that includes syntax highlighting and the Solidity compiler.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><a class="reference external" href="https://marketplace.visualstudio.com/items?itemName=tintinweb.solidity-visual-auditor">Solidity Visual Auditor extension</a></dt><dd><p>Adds security centric syntax and semantic highlighting to Visual Studio Code.</p>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
<section id="solidity-tools">
<h3>Solidity Tools<a class="headerlink" href="#solidity-tools" title="Permalink to this heading">ÔÉÅ</a></h3>
<ul class="simple">
<li><dl class="simple">
<dt><a class="reference external" href="https://gist.github.com/chriseth/8f533d133fa0c15b0d6eaf3ec502c82b">ABI to Solidity interface converter</a></dt><dd><p>A script for generating contract interfaces from the ABI of a smart contract.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><a class="reference external" href="https://github.com/gnidan/abi-to-sol">abi-to-sol</a></dt><dd><p>Tool to generate Solidity interface source from a given ABI JSON.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><a class="reference external" href="https://github.com/DigixGlobal/doxity">Doxity</a></dt><dd><p>Documentation Generator for Solidity.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><a class="reference external" href="https://github.com/duaraghav8/Ethlint">Ethlint</a></dt><dd><p>Linter to identify and fix style and security issues in Solidity.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><a class="reference external" href="https://github.com/Arachnid/evmdis">evmdis</a></dt><dd><p>EVM Disassembler that performs static analysis on the bytecode to provide a higher level of abstraction than raw EVM operations.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><a class="reference external" href="https://github.com/ethereum/evmlab/">EVM Lab</a></dt><dd><p>Rich tool package to interact with the EVM. Includes a VM, Etherchain API, and a trace-viewer with gas cost display.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><a class="reference external" href="https://github.com/dapphub/dapptools/tree/master/src/hevm#readme">hevm</a></dt><dd><p>EVM debugger and symbolic execution engine.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><a class="reference external" href="https://github.com/clemlak/leafleth">leafleth</a></dt><dd><p>A documentation generator for Solidity smart-contracts.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><a class="reference external" href="https://piet.slock.it/">PIET</a></dt><dd><p>A tool to develop, audit and use Solidity smart contracts through a simple graphical interface.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><a class="reference external" href="https://github.com/scaffold-eth/scaffold-eth">Scaffold-ETH</a></dt><dd><p>Forkable Ethereum development stack focused on fast product iterations.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><a class="reference external" href="https://www.npmjs.com/package/sol2uml">sol2uml</a></dt><dd><p>Unified Modeling Language (UML) class diagram generator for Solidity contracts.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><a class="reference external" href="https://github.com/crytic/solc-select">solc-select</a></dt><dd><p>A script to quickly switch between Solidity compiler versions.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><a class="reference external" href="https://github.com/prettier-solidity/prettier-plugin-solidity">Solidity prettier plugin</a></dt><dd><p>A Prettier Plugin for Solidity.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><a class="reference external" href="https://github.com/raineorshine/solidity-repl">Solidity REPL</a></dt><dd><p>Try Solidity instantly with a command-line Solidity console.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><a class="reference external" href="https://github.com/raineorshine/solgraph">solgraph</a></dt><dd><p>Visualize Solidity control flow and highlight potential security vulnerabilities.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><a class="reference external" href="https://github.com/protofire/solhint">Solhint</a></dt><dd><p>Solidity linter that provides security, style guide and best practice rules for smart contract validation.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><a class="reference external" href="https://sourcify.dev/">Sourcify</a></dt><dd><p>Decentralized automated contract verification service and public repository of contract metadata.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><a class="reference external" href="https://github.com/ConsenSys/surya/">S≈´rya</a></dt><dd><p>Utility tool for smart contract systems, offering a number of visual outputs and information about the contracts‚Äô structure. Also supports querying the function call graph.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><a class="reference external" href="https://github.com/agroce/universalmutator">Universal Mutator</a></dt><dd><p>A tool for mutation generation, with configurable rules and support for Solidity and Vyper.</p>
</dd>
</dl>
</li>
</ul>
</section>
<section id="third-party-solidity-parsers-and-grammars">
<h3>Third-Party Solidity Parsers and Grammars<a class="headerlink" href="#third-party-solidity-parsers-and-grammars" title="Permalink to this heading">ÔÉÅ</a></h3>
<ul class="simple">
<li><dl class="simple">
<dt><a class="reference external" href="https://github.com/solidity-parser/parser">Solidity Parser for JavaScript</a></dt><dd><p>A Solidity parser for JS built on top of a robust ANTLR4 grammar.</p>
</dd>
</dl>
</li>
</ul>
</section>
</section>
<span id="document-path-resolution"></span><section id="import-path-resolution">
<span id="path-resolution"></span><h2>Import Path Resolution<a class="headerlink" href="#import-path-resolution" title="Permalink to this heading">ÔÉÅ</a></h2>
<p>In order to be able to support reproducible builds on all platforms, the Solidity compiler has to
abstract away the details of the filesystem where source files are stored.
Paths used in imports must work the same way everywhere while the command-line interface must be
able to work with platform-specific paths to provide good user experience.
This section aims to explain in detail how Solidity reconciles these requirements.</p>
<section id="virtual-filesystem">
<span id="index-0"></span><span id="id1"></span><h3>Virtual Filesystem<a class="headerlink" href="#virtual-filesystem" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>The compiler maintains an internal database (<em>virtual filesystem</em> or <em>VFS</em> for short) where each
source unit is assigned a unique <em>source unit name</em> which is an opaque and unstructured identifier.
When you use the <a class="reference internal" href="index.html#import"><span class="std std-ref">import statement</span></a>, you specify an <em>import path</em> that references a
source unit name.</p>
<section id="import-callback">
<span id="index-1"></span><span id="id2"></span><h4>Import Callback<a class="headerlink" href="#import-callback" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>The VFS is initially populated only with files the compiler has received as input.
Additional files can be loaded during compilation using an <em>import callback</em>, which is different
depending on the type of compiler you use (see below).
If the compiler does not find any source unit name matching the import path in the VFS, it invokes
the callback, which is responsible for obtaining the source code to be placed under that name.
An import callback is free to interpret source unit names in an arbitrary way, not just as paths.
If there is no callback available when one is needed or if it fails to locate the source code,
compilation fails.</p>
<p>The command-line compiler provides the <em>Host Filesystem Loader</em> - a rudimentary callback
that interprets a source unit name as a path in the local filesystem.
The <a class="reference external" href="https://github.com/ethereum/solc-js">JavaScript interface</a> does not provide any by default,
but one can be provided by the user.
This mechanism can be used to obtain source code from locations other then the local filesystem
(which may not even be accessible, e.g. when the compiler is running in a browser).
For example the <a class="reference external" href="https://remix.ethereum.org/">Remix IDE</a> provides a versatile callback that
lets you <a class="reference external" href="https://remix-ide.readthedocs.io/en/latest/import.html">import files from HTTP, IPFS and Swarm URLs or refer directly to packages in NPM registry</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Host Filesystem Loader‚Äôs file lookup is platform-dependent.
For example backslashes in a source unit name can be interpreted as directory separators or not
and the lookup can be case-sensitive or not, depending on the underlying platform.</p>
<p>For portability it is recommended to avoid using import paths that will work correctly only
with a specific import callback or only on one platform.
For example you should always use forward slashes since they work as path separators also on
platforms that support backslashes.</p>
</div>
</section>
<section id="initial-content-of-the-virtual-filesystem">
<h4>Initial Content of the Virtual Filesystem<a class="headerlink" href="#initial-content-of-the-virtual-filesystem" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>The initial content of the VFS depends on how you invoke the compiler:</p>
<ol class="arabic">
<li><p><strong>solc / command-line interface</strong></p>
<p>When you compile a file using the command-line interface of the compiler, you provide one or
more paths to files containing Solidity code:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>solc contract.sol /usr/local/dapp-bin/token.sol
</pre></div>
</div>
<p>The source unit name of a file loaded this way is constructed by converting its path to a
canonical form and, if possible, making it relative to either the base path or one of the
include paths.
See <a class="reference internal" href="#cli-path-normalization-and-stripping"><span class="std std-ref">CLI Path Normalization and Stripping</span></a> for
a detailed description of this process.</p>
</li>
<li id="index-2"><p><strong>Standard JSON</strong></p>
<p>When using the <a class="reference internal" href="index.html#compiler-api"><span class="std std-ref">Standard JSON</span></a> API (via either the <a class="reference external" href="https://github.com/ethereum/solc-js">JavaScript interface</a> or the <code class="docutils literal notranslate"><span class="pre">--standard-json</span></code> command-line option)
you provide input in JSON format, containing, among other things, the content of all your source
files:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;language&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Solidity&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;sources&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;contract.sol&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;import \&quot;./util.sol\&quot;;\ncontract C {}&quot;</span><span class="w"></span>
<span class="w">        </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;util.sol&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;library Util {}&quot;</span><span class="w"></span>
<span class="w">        </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;/usr/local/dapp-bin/token.sol&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;contract Token {}&quot;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;settings&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;outputSelection&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;*&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;*&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;evm.bytecode&quot;</span><span class="p">]}}}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">sources</span></code> dictionary becomes the initial content of the virtual filesystem and its keys
are used as source unit names.</p>
</li>
<li id="initial-vfs-content-standard-json-with-import-callback"><p><strong>Standard JSON (via import callback)</strong></p>
<p>With Standard JSON it is also possible to tell the compiler to use the import callback to obtain
the source code:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;language&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Solidity&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;sources&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;/usr/local/dapp-bin/token.sol&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="nt">&quot;urls&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">                </span><span class="s2">&quot;/projects/mytoken.sol&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="s2">&quot;https://example.com/projects/mytoken.sol&quot;</span><span class="w"></span>
<span class="w">            </span><span class="p">]</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;settings&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;outputSelection&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;*&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;*&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;evm.bytecode&quot;</span><span class="p">]}}}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>If an import callback is available, the compiler will give it the strings specified in
<code class="docutils literal notranslate"><span class="pre">urls</span></code> one by one, until one is loaded successfully or the end of the list is reached.</p>
<p>The source unit names are determined the same way as when using <code class="docutils literal notranslate"><span class="pre">content</span></code> - they are keys of
the <code class="docutils literal notranslate"><span class="pre">sources</span></code> dictionary and the content of <code class="docutils literal notranslate"><span class="pre">urls</span></code> does not affect them in any way.</p>
</li>
<li id="index-3"><p><strong>Standard input</strong></p>
<p>On the command line it is also possible to provide the source by sending it to compiler‚Äôs
standard input:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s1">&#39;import &quot;./util.sol&quot;; contract C {}&#39;</span> <span class="p">|</span> solc -
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">-</span></code> used as one of the arguments instructs the compiler to place the content of the standard
input in the virtual filesystem under a special source unit name: <code class="docutils literal notranslate"><span class="pre">&lt;stdin&gt;</span></code>.</p>
</li>
</ol>
<p>Once the VFS is initialized, additional files can still be added to it only through the import
callback.</p>
</section>
</section>
<section id="imports">
<span id="index-4"></span><h3>Imports<a class="headerlink" href="#imports" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>The import statement specifies an <em>import path</em>.
Based on how the import path is specified, we can divide imports into two categories:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#direct-imports"><span class="std std-ref">Direct imports</span></a>, where you specify the full source unit name directly.</p></li>
<li><p><a class="reference internal" href="#relative-imports"><span class="std std-ref">Relative imports</span></a>, where you specify a path starting with <code class="docutils literal notranslate"><span class="pre">./</span></code> or <code class="docutils literal notranslate"><span class="pre">../</span></code>
to be combined with the source unit name of the importing file.</p></li>
</ul>
<div class="literal-block-wrapper docutils container" id="id9">
<div class="code-block-caption"><span class="caption-text">contracts/contract.sol</span><a class="headerlink" href="#id9" title="Permalink to this code">ÔÉÅ</a></div>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=aW1wb3J0ICIuL21hdGgvbWF0aC5zb2wiOwppbXBvcnQgImNvbnRyYWN0cy90b2tlbnMvdG9rZW4uc29sIjs="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">import</span><span class="w"> </span><span class="s2">&quot;./math/math.sol&quot;</span><span class="p">;</span><span class="w"></span>
<span class="kt">import</span><span class="w"> </span><span class="s2">&quot;contracts/tokens/token.sol&quot;</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</div>
<p>In the above <code class="docutils literal notranslate"><span class="pre">./math/math.sol</span></code> and <code class="docutils literal notranslate"><span class="pre">contracts/tokens/token.sol</span></code> are import paths while the
source unit names they translate to are <code class="docutils literal notranslate"><span class="pre">contracts/math/math.sol</span></code> and <code class="docutils literal notranslate"><span class="pre">contracts/tokens/token.sol</span></code>
respectively.</p>
<section id="direct-imports">
<span id="index-5"></span><span id="id4"></span><h4>Direct Imports<a class="headerlink" href="#direct-imports" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>An import that does not start with <code class="docutils literal notranslate"><span class="pre">./</span></code> or <code class="docutils literal notranslate"><span class="pre">../</span></code> is a <em>direct import</em>.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=aW1wb3J0ICIvcHJvamVjdC9saWIvdXRpbC5zb2wiOyAgICAgICAgIC8vIHNvdXJjZSB1bml0IG5hbWU6IC9wcm9qZWN0L2xpYi91dGlsLnNvbAppbXBvcnQgImxpYi91dGlsLnNvbCI7ICAgICAgICAgICAgICAgICAgLy8gc291cmNlIHVuaXQgbmFtZTogbGliL3V0aWwuc29sCmltcG9ydCAiQG9wZW56ZXBwZWxpbi9hZGRyZXNzLnNvbCI7ICAgICAvLyBzb3VyY2UgdW5pdCBuYW1lOiBAb3BlbnplcHBlbGluL2FkZHJlc3Muc29sCmltcG9ydCAiaHR0cHM6Ly9leGFtcGxlLmNvbS90b2tlbi5zb2wiOyAvLyBzb3VyY2UgdW5pdCBuYW1lOiBodHRwczovL2V4YW1wbGUuY29tL3Rva2VuLnNvbA=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">import</span><span class="w"> </span><span class="s2">&quot;/project/lib/util.sol&quot;</span><span class="p">;</span><span class="w">         </span><span class="c1">// source unit name: /project/lib/util.sol</span>
<span class="kt">import</span><span class="w"> </span><span class="s2">&quot;lib/util.sol&quot;</span><span class="p">;</span><span class="w">                  </span><span class="c1">// source unit name: lib/util.sol</span>
<span class="kt">import</span><span class="w"> </span><span class="s2">&quot;@openzeppelin/address.sol&quot;</span><span class="p">;</span><span class="w">     </span><span class="c1">// source unit name: @openzeppelin/address.sol</span>
<span class="kt">import</span><span class="w"> </span><span class="s2">&quot;https://example.com/token.sol&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// source unit name: https://example.com/token.sol</span>
</pre></div>
</div>
<p>After applying any <a class="reference internal" href="#import-remapping"><span class="std std-ref">import remappings</span></a> the import path simply becomes the
source unit name.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A source unit name is just an identifier and even if its value happens to look like a path, it
is not subject to the normalization rules you would typically expect in a shell.
Any <code class="docutils literal notranslate"><span class="pre">/./</span></code> or <code class="docutils literal notranslate"><span class="pre">/../</span></code> seguments or sequences of multiple slashes remain a part of it.
When the source is provided via Standard JSON interface it is entirely possible to associate
different content with source unit names that would refer to the same file on disk.</p>
</div>
<p>When the source is not available in the virtual filesystem, the compiler passes the source unit name
to the import callback.
The Host Filesystem Loader will attempt to use it as a path and look up the file on disk.
At this point the platform-specific normalization rules kick in and names that were considered
different in the VFS may actually result in the same file being loaded.
For example <code class="docutils literal notranslate"><span class="pre">/project/lib/math.sol</span></code> and <code class="docutils literal notranslate"><span class="pre">/project/lib/../lib///math.sol</span></code> are considered
completely different in the VFS even though they refer to the same file on disk.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Even if an import callback ends up loading source code for two different source unit names from
the same file on disk, the compiler will still see them as separate source units.
It is the source unit name that matters, not the physical location of the code.</p>
</div>
</section>
<section id="relative-imports">
<span id="index-6"></span><span id="id5"></span><h4>Relative Imports<a class="headerlink" href="#relative-imports" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>An import starting with <code class="docutils literal notranslate"><span class="pre">./</span></code> or <code class="docutils literal notranslate"><span class="pre">../</span></code> is a <em>relative import</em>.
Such imports specify a path relative to the source unit name of the importing source unit:</p>
<div class="literal-block-wrapper docutils container" id="id10">
<div class="code-block-caption"><span class="caption-text">/project/lib/math.sol</span><a class="headerlink" href="#id10" title="Permalink to this code">ÔÉÅ</a></div>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=aW1wb3J0ICIuL3V0aWwuc29sIiBhcyB1dGlsOyAgICAvLyBzb3VyY2UgdW5pdCBuYW1lOiAvcHJvamVjdC9saWIvdXRpbC5zb2wKaW1wb3J0ICIuLi90b2tlbi5zb2wiIGFzIHRva2VuOyAvLyBzb3VyY2UgdW5pdCBuYW1lOiAvcHJvamVjdC90b2tlbi5zb2w="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">import</span><span class="w"> </span><span class="s2">&quot;./util.sol&quot;</span><span class="w"> </span>as<span class="w"> </span>util<span class="p">;</span><span class="w">    </span><span class="c1">// source unit name: /project/lib/util.sol</span>
<span class="kt">import</span><span class="w"> </span><span class="s2">&quot;../token.sol&quot;</span><span class="w"> </span>as<span class="w"> </span>token<span class="p">;</span><span class="w"> </span><span class="c1">// source unit name: /project/token.sol</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id11">
<div class="code-block-caption"><span class="caption-text">lib/math.sol</span><a class="headerlink" href="#id11" title="Permalink to this code">ÔÉÅ</a></div>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=aW1wb3J0ICIuL3V0aWwuc29sIiBhcyB1dGlsOyAgICAvLyBzb3VyY2UgdW5pdCBuYW1lOiBsaWIvdXRpbC5zb2wKaW1wb3J0ICIuLi90b2tlbi5zb2wiIGFzIHRva2VuOyAvLyBzb3VyY2UgdW5pdCBuYW1lOiB0b2tlbi5zb2w="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">import</span><span class="w"> </span><span class="s2">&quot;./util.sol&quot;</span><span class="w"> </span>as<span class="w"> </span>util<span class="p">;</span><span class="w">    </span><span class="c1">// source unit name: lib/util.sol</span>
<span class="kt">import</span><span class="w"> </span><span class="s2">&quot;../token.sol&quot;</span><span class="w"> </span>as<span class="w"> </span>token<span class="p">;</span><span class="w"> </span><span class="c1">// source unit name: token.sol</span>
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Relative imports <strong>always</strong> start with <code class="docutils literal notranslate"><span class="pre">./</span></code> or <code class="docutils literal notranslate"><span class="pre">../</span></code> so <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">&quot;util.sol&quot;</span></code>, unlike
<code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">&quot;./util.sol&quot;</span></code>, is a direct import.
While both paths would be considered relative in the host filesystem, <code class="docutils literal notranslate"><span class="pre">util.sol</span></code> is actually
absolute in the VFS.</p>
</div>
<p>Let us define a <em>path segment</em> as any non-empty part of the path that does not contain a separator
and is bounded by two path separators.
A separator is a forward slash or the beginning/end of the string.
For example in <code class="docutils literal notranslate"><span class="pre">./abc/..//</span></code> there are three path segments: <code class="docutils literal notranslate"><span class="pre">.</span></code>, <code class="docutils literal notranslate"><span class="pre">abc</span></code> and <code class="docutils literal notranslate"><span class="pre">..</span></code>.</p>
<p>The compiler computes a source unit name from the import path in the following way:</p>
<ol class="arabic">
<li><p>First a prefix is computed</p>
<blockquote>
<div><ul class="simple">
<li><p>Prefix is initialized with the source unit name of the importing source unit.</p></li>
<li><p>The last path segment with preceding slashes is removed from the prefix.</p></li>
<li><p>Then, the leading part of the normalized import path, consisting only of <code class="docutils literal notranslate"><span class="pre">/</span></code> and <code class="docutils literal notranslate"><span class="pre">.</span></code>
characters is considered.
For every <code class="docutils literal notranslate"><span class="pre">..</span></code> segment found in this part the last path segment with preceding slashes is
removed from the prefix.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Then the prefix is prepended to the normalized import path.
If the prefix is non-empty, a single slash is inserted between it and the import path.</p></li>
</ol>
<p>The removal of the last path segment with preceding slashes is understood to
work as follows:</p>
<ol class="arabic simple">
<li><p>Everything past the last slash is removed (i.e. <code class="docutils literal notranslate"><span class="pre">a/b//c.sol</span></code> becomes <code class="docutils literal notranslate"><span class="pre">a/b//</span></code>).</p></li>
<li><p>All trailing slashes are removed (i.e. <code class="docutils literal notranslate"><span class="pre">a/b//</span></code> becomes <code class="docutils literal notranslate"><span class="pre">a/b</span></code>).</p></li>
</ol>
<p>The normalization rules are the same as for UNIX paths, namely:</p>
<ul class="simple">
<li><p>All the internal <code class="docutils literal notranslate"><span class="pre">.</span></code> segments are removed.</p></li>
<li><p>Every internal <code class="docutils literal notranslate"><span class="pre">..</span></code> segment backtracks one level up in the hierarchy.</p></li>
<li><p>Multiple slashes are squashed into a single one.</p></li>
</ul>
<p>Note that normalization is performed only on the import path.
The source unit name of the importing module that is used for the prefix remains unnormalized.
This ensures that the <code class="docutils literal notranslate"><span class="pre">protocol://</span></code> part does not turn into <code class="docutils literal notranslate"><span class="pre">protocol:/</span></code> if the importing file
is identified with a URL.</p>
<p>If your import paths are already normalized, you can expect the above algorithm to produce very
intuitive results.
Here are some examples of what you can expect if they are not:</p>
<div class="literal-block-wrapper docutils container" id="id12">
<div class="code-block-caption"><span class="caption-text">lib/src/../contract.sol</span><a class="headerlink" href="#id12" title="Permalink to this code">ÔÉÅ</a></div>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=aW1wb3J0ICIuL3V0aWwvLi91dGlsLnNvbCI7ICAgICAgICAgLy8gc291cmNlIHVuaXQgbmFtZTogbGliL3NyYy8uLi91dGlsL3V0aWwuc29sCmltcG9ydCAiLi91dGlsLy91dGlsLnNvbCI7ICAgICAgICAgIC8vIHNvdXJjZSB1bml0IG5hbWU6IGxpYi9zcmMvLi4vdXRpbC91dGlsLnNvbAppbXBvcnQgIi4uL3V0aWwvLi4vYXJyYXkvdXRpbC5zb2wiOyAvLyBzb3VyY2UgdW5pdCBuYW1lOiBsaWIvc3JjL2FycmF5L3V0aWwuc29sCmltcG9ydCAiLi4vLi4vLi8uLi91dGlsLnNvbCI7ICAgICAgIC8vIHNvdXJjZSB1bml0IG5hbWU6IHV0aWwuc29sCmltcG9ydCAiLi4vLi4vLi4vLi8uLi91dGlsLnNvbCI7ICAgIC8vIHNvdXJjZSB1bml0IG5hbWU6IHV0aWwuc29s"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">import</span><span class="w"> </span><span class="s2">&quot;./util/./util.sol&quot;</span><span class="p">;</span><span class="w">         </span><span class="c1">// source unit name: lib/src/../util/util.sol</span>
<span class="kt">import</span><span class="w"> </span><span class="s2">&quot;./util//util.sol&quot;</span><span class="p">;</span><span class="w">          </span><span class="c1">// source unit name: lib/src/../util/util.sol</span>
<span class="kt">import</span><span class="w"> </span><span class="s2">&quot;../util/../array/util.sol&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// source unit name: lib/src/array/util.sol</span>
<span class="kt">import</span><span class="w"> </span><span class="s2">&quot;../.././../util.sol&quot;</span><span class="p">;</span><span class="w">       </span><span class="c1">// source unit name: util.sol</span>
<span class="kt">import</span><span class="w"> </span><span class="s2">&quot;../../.././../util.sol&quot;</span><span class="p">;</span><span class="w">    </span><span class="c1">// source unit name: util.sol</span>
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The use of relative imports containing leading <code class="docutils literal notranslate"><span class="pre">..</span></code> segments is not recommended.
The same effect can be achieved in a more reliable way by using direct imports with
<a class="reference internal" href="#base-and-include-paths"><span class="std std-ref">base path and include paths</span></a>.</p>
</div>
</section>
</section>
<section id="base-path-and-include-paths">
<span id="base-and-include-paths"></span><span id="index-7"></span><h3>Base Path and Include Paths<a class="headerlink" href="#base-path-and-include-paths" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>The base path and include paths represent directories that the Host Filesystem Loader will load files from.
When a source unit name is passed to the loader, it prepends the base path to it and performs a
filesystem lookup.
If the lookup does not succeed, the same is done with all directories on the include path list.</p>
<p>It is recommended to set the base path to the root directory of your project and use include paths to
specify additional locations that may contain libraries your project depends on.
This lets you import from these libraries in a uniform way, no matter where they are located in the
filesystem relative to your project.
For example, if you use npm to install packages and your contract imports
<code class="docutils literal notranslate"><span class="pre">&#64;openzeppelin/contracts/utils/Strings.sol</span></code>, you can use these options to tell the compiler that
the library can be found in one of the npm package directories:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>solc contract.sol <span class="se">\</span>
    --base-path . <span class="se">\</span>
    --include-path node_modules/ <span class="se">\</span>
    --include-path /usr/local/lib/node_modules/
</pre></div>
</div>
<p>Your contract will compile (with the same exact metadata) no matter whether you install the library
in the local or global package directory or even directly under your project root.</p>
<p>By default the base path is empty, which leaves the source unit name unchanged.
When the source unit name is a relative path, this results in the file being looked up in the
directory the compiler has been invoked from.
It is also the only value that results in absolute paths in source unit names being actually
interpreted as absolute paths on disk.
If the base path itself is relative, it is interpreted as relative to the current working directory
of the compiler.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Include paths cannot have empty values and must be used together with a non-empty base path.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Include paths and base path can overlap as long as it does not make import resolution ambiguous.
For example, you can specify a directory inside base path as an include directory or have an
include directory that is a subdirectory of another include directory.
The compiler will only issue an error if the source unit name passed to the Host Filesystem
Loader represents an existing path when combined with multiple include paths or an include path
and base path.</p>
</div>
<section id="cli-path-normalization-and-stripping">
<span id="id6"></span><h4>CLI Path Normalization and Stripping<a class="headerlink" href="#cli-path-normalization-and-stripping" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>On the command line the compiler behaves just as you would expect from any other program:
it accepts paths in a format native to the platform and relative paths are relative to the current
working directory.
The source unit names assigned to files whose paths are specified on the command line, however,
should not change just because the project is being compiled on a different platform or because the
compiler happens to have been invoked from a different directory.
To achieve this, paths to source files coming from the command line must be converted to a canonical
form, and, if possible, made relative to the base path or one of the include paths.</p>
<p>The normalization rules are as follows:</p>
<ul class="simple">
<li><p>If a path is relative, it is made absolute by prepending the current working directory to it.</p></li>
<li><p>Internal <code class="docutils literal notranslate"><span class="pre">.</span></code> and <code class="docutils literal notranslate"><span class="pre">..</span></code> segments are collapsed.</p></li>
<li><p>Platform-specific path separators are replaced with forward slashes.</p></li>
<li><p>Sequences of multiple consecutive path separators are squashed into a single separator (unless
they are the leading slashes of an <a class="reference external" href="https://en.wikipedia.org/wiki/Path_(computing)#UNC">UNC path</a>).</p></li>
<li><p>If the path includes a root name (e.g. a drive letter on Windows) and the root is the same as the
root of the current working directory, the root is replaced with <code class="docutils literal notranslate"><span class="pre">/</span></code>.</p></li>
<li><p>Symbolic links in the path are <strong>not</strong> resolved.</p>
<ul>
<li><p>The only exception is the path to the current working directory prepended to relative paths in
the process of making them absolute.
On some platforms the working directory is reported always with symbolic links resolved so for
consistency the compiler resolves them everywhere.</p></li>
</ul>
</li>
<li><p>The original case of the path is preserved even if the filesystem is case-insensitive but
<a class="reference external" href="https://en.wikipedia.org/wiki/Case_preservation">case-preserving</a> and the actual case on
disk is different.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There are situations where paths cannot be made platform-independent.
For example on Windows the compiler can avoid using drive letters by referring to the root
directory of the current drive as <code class="docutils literal notranslate"><span class="pre">/</span></code> but drive letters are still necessary for paths leading
to other drives.
You can avoid such situations by ensuring that all the files are available within a single
directory tree on the same drive.</p>
</div>
<p>After normalization the compiler attempts to make the source file path relative.
It tries the base path first and then the include paths in the order they were given.
If the base path is empty or not specified, it is treated as if it was equal to the path to the
current working directory (with all symbolic links resolved).
The result is accepted only if the normalized directory path is the exact prefix of the normalized
file path.
Otherwise the file path remains absolute.
This makes the conversion unambiguous and ensures that the relative path does not start with <code class="docutils literal notranslate"><span class="pre">../</span></code>.
The resulting file path becomes the source unit name.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The relative path produced by stripping must remain unique within the base path and include paths.
For example the compiler will issue an error for the following command if both
<code class="docutils literal notranslate"><span class="pre">/project/contract.sol</span></code> and <code class="docutils literal notranslate"><span class="pre">/lib/contract.sol</span></code> exist:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>solc /project/contract.sol --base-path /project --include-path /lib
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Prior to version 0.8.8, CLI path stripping was not performed and the only normalization applied
was the conversion of path separators.
When working with older versions of the compiler it is recommended to invoke the compiler from
the base path and to only use relative paths on the command line.</p>
</div>
</section>
</section>
<section id="allowed-paths">
<span id="index-8"></span><span id="id7"></span><h3>Allowed Paths<a class="headerlink" href="#allowed-paths" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>As a security measure, the Host Filesystem Loader will refuse to load files from outside of a few
locations that are considered safe by default:</p>
<ul class="simple">
<li><p>Outside of Standard JSON mode:</p>
<ul>
<li><p>The directories containing input files listed on the command line.</p></li>
<li><p>The directories used as <a class="reference internal" href="#import-remapping"><span class="std std-ref">remapping</span></a> targets.
If the target is not a directory (i.e does not end with <code class="docutils literal notranslate"><span class="pre">/</span></code>, <code class="docutils literal notranslate"><span class="pre">/.</span></code> or <code class="docutils literal notranslate"><span class="pre">/..</span></code>) the directory
containing the target is used instead.</p></li>
<li><p>Base path and include paths.</p></li>
</ul>
</li>
<li><p>In Standard JSON mode:</p>
<ul>
<li><p>Base path and include paths.</p></li>
</ul>
</li>
</ul>
<p>Additional directories can be whitelisted using the <code class="docutils literal notranslate"><span class="pre">--allow-paths</span></code> option.
The option accepts a comma-separated list of paths:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> /home/user/project/
solc token/contract.sol <span class="se">\</span>
    lib/util.sol<span class="o">=</span>libs/util.sol <span class="se">\</span>
    --base-path<span class="o">=</span>token/ <span class="se">\</span>
    --include-path<span class="o">=</span>/lib/ <span class="se">\</span>
    --allow-paths<span class="o">=</span>../utils/,/tmp/libraries
</pre></div>
</div>
<p>When the compiler is invoked with the command shown above, the Host Filesystem Loader will allow
importing files from the following directories:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">/home/user/project/token/</span></code> (because <code class="docutils literal notranslate"><span class="pre">token/</span></code> contains the input file and also because it is
the base path),</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/lib/</span></code> (because <code class="docutils literal notranslate"><span class="pre">/lib/</span></code> is one of the include paths),</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/home/user/project/libs/</span></code> (because <code class="docutils literal notranslate"><span class="pre">libs/</span></code> is a directory containing a remapping target),</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/home/user/utils/</span></code> (because of <code class="docutils literal notranslate"><span class="pre">../utils/</span></code> passed to <code class="docutils literal notranslate"><span class="pre">--allow-paths</span></code>),</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/tmp/libraries/</span></code> (because of <code class="docutils literal notranslate"><span class="pre">/tmp/libraries</span></code> passed to <code class="docutils literal notranslate"><span class="pre">--allow-paths</span></code>),</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The working directory of the compiler is one of the paths allowed by default only if it
happens to be the base path (or the base path is not specified or has an empty value).</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The compiler does not check if allowed paths actually exist and whether they are directories.
Non-existent or empty paths are simply ignored.
If an allowed path matches a file rather than a directory, the file is considered whitelisted, too.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Allowed paths are case-sensitive even if the filesystem is not.
The case must exactly match the one used in your imports.
For example <code class="docutils literal notranslate"><span class="pre">--allow-paths</span> <span class="pre">tokens</span></code> will not match <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">&quot;Tokens/IERC20.sol&quot;</span></code>.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Files and directories only reachable through symbolic links from allowed directories are not
automatically whitelisted.
For example if <code class="docutils literal notranslate"><span class="pre">token/contract.sol</span></code> in the example above was actually a symlink pointing at
<code class="docutils literal notranslate"><span class="pre">/etc/passwd</span></code> the compiler would refuse to load it unless <code class="docutils literal notranslate"><span class="pre">/etc/</span></code> was one of the allowed
paths too.</p>
</div>
</section>
<section id="import-remapping">
<span id="index-9"></span><span id="id8"></span><h3>Import Remapping<a class="headerlink" href="#import-remapping" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Import remapping allows you to redirect imports to a different location in the virtual filesystem.
The mechanism works by changing the translation between import paths and source unit names.
For example you can set up a remapping so that any import from the virtual directory
<code class="docutils literal notranslate"><span class="pre">github.com/ethereum/dapp-bin/library/</span></code> would be seen as an import from <code class="docutils literal notranslate"><span class="pre">dapp-bin/library/</span></code> instead.</p>
<p>You can limit the scope of a remapping by specifying a <em>context</em>.
This allows creating remappings that apply only to imports located in a specific library or a specific file.
Without a context a remapping is applied to every matching import in all the files in the virtual
filesystem.</p>
<p>Import remappings have the form of <code class="docutils literal notranslate"><span class="pre">context:prefix=target</span></code>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">context</span></code> must match the beginning of the source unit name of the file containing the import.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">prefix</span></code> must match the beginning of the source unit name resulting from the import.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">target</span></code> is the value the prefix is replaced with.</p></li>
</ul>
<p>For example, if you clone <a class="reference external" href="https://github.com/ethereum/dapp-bin/">https://github.com/ethereum/dapp-bin/</a> locally to <code class="docutils literal notranslate"><span class="pre">/project/dapp-bin</span></code>
and run the compiler with:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>solc github.com/ethereum/dapp-bin/<span class="o">=</span>dapp-bin/ --base-path /project source.sol
</pre></div>
</div>
<p>you can use the following in your source file:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=aW1wb3J0ICJnaXRodWIuY29tL2V0aGVyZXVtL2RhcHAtYmluL2xpYnJhcnkvbWF0aC5zb2wiOyAvLyBzb3VyY2UgdW5pdCBuYW1lOiBkYXBwLWJpbi9saWJyYXJ5L21hdGguc29s"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">import</span><span class="w"> </span><span class="s2">&quot;github.com/ethereum/dapp-bin/library/math.sol&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// source unit name: dapp-bin/library/math.sol</span>
</pre></div>
</div>
<p>The compiler will look for the file in the VFS under <code class="docutils literal notranslate"><span class="pre">dapp-bin/library/math.sol</span></code>.
If the file is not available there, the source unit name will be passed to the Host Filesystem
Loader, which will then look in <code class="docutils literal notranslate"><span class="pre">/project/dapp-bin/library/iterable_mapping.sol</span></code>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Information about remappings is stored in contract metadata.
Since the binary produced by the compiler has a hash of the metadata embedded in it, any
modification to the remappings will result in different bytecode.</p>
<p>For this reason you should be careful not to include any local information in remapping targets.
For example if your library is located in <code class="docutils literal notranslate"><span class="pre">/home/user/packages/mymath/math.sol</span></code>, a remapping
like <code class="docutils literal notranslate"><span class="pre">&#64;math/=/home/user/packages/mymath/</span></code> would result in your home directory being included in
the metadata.
To be able to reproduce the same bytecode with such a remapping on a different machine, you
would need to recreate parts of your local directory structure in the VFS and (if you rely on
Host Filesystem Loader) also in the host filesystem.</p>
<p>To avoid having your local directory structure embedded in the metadata, it is recommended to
designate the directories containing libraries as <em>include paths</em> instead.
For example, in the example above <code class="docutils literal notranslate"><span class="pre">--include-path</span> <span class="pre">/home/user/packages/</span></code> would let you use
imports starting with <code class="docutils literal notranslate"><span class="pre">mymath/</span></code>.
Unlike remapping, the option on its own will not make <code class="docutils literal notranslate"><span class="pre">mymath</span></code> appear as <code class="docutils literal notranslate"><span class="pre">&#64;math</span></code> but this
can be achieved by creating a symbolic link or renaming the package subdirectory.</p>
</div>
<p>As a more complex example, suppose you rely on a module that uses an old version of dapp-bin that
you checked out to <code class="docutils literal notranslate"><span class="pre">/project/dapp-bin_old</span></code>, then you can run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>solc module1:github.com/ethereum/dapp-bin/<span class="o">=</span>dapp-bin/ <span class="se">\</span>
     module2:github.com/ethereum/dapp-bin/<span class="o">=</span>dapp-bin_old/ <span class="se">\</span>
     --base-path /project <span class="se">\</span>
     source.sol
</pre></div>
</div>
<p>This means that all imports in <code class="docutils literal notranslate"><span class="pre">module2</span></code> point to the old version but imports in <code class="docutils literal notranslate"><span class="pre">module1</span></code>
point to the new version.</p>
<p>Here are the detailed rules governing the behaviour of remappings:</p>
<ol class="arabic">
<li><p><strong>Remappings only affect the translation between import paths and source unit names.</strong></p>
<p>Source unit names added to the VFS in any other way cannot be remapped.
For example the paths you specify on the command-line and the ones in <code class="docutils literal notranslate"><span class="pre">sources.urls</span></code> in
Standard JSON are not affected.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>solc /project/<span class="o">=</span>/contracts/ /project/contract.sol <span class="c1"># source unit name: /project/contract.sol</span>
</pre></div>
</div>
<p>In the example above the compiler will load the source code from <code class="docutils literal notranslate"><span class="pre">/project/contract.sol</span></code> and
place it under that exact source unit name in the VFS, not under <code class="docutils literal notranslate"><span class="pre">/contract/contract.sol</span></code>.</p>
</li>
<li><p><strong>Context and prefix must match source unit names, not import paths.</strong></p>
<ul>
<li><p>This means that you cannot remap <code class="docutils literal notranslate"><span class="pre">./</span></code> or <code class="docutils literal notranslate"><span class="pre">../</span></code> directly since they are replaced during
the translation to source unit name but you can remap the part of the name they are replaced
with:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>solc ./<span class="o">=</span>a/ /project/<span class="o">=</span>b/ /project/contract.sol <span class="c1"># source unit name: /project/contract.sol</span>
</pre></div>
</div>
<div class="literal-block-wrapper docutils container" id="id13">
<div class="code-block-caption"><span class="caption-text">/project/contract.sol</span><a class="headerlink" href="#id13" title="Permalink to this code">ÔÉÅ</a></div>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=aW1wb3J0ICIuL3V0aWwuc29sIiBhcyB1dGlsOyAvLyBzb3VyY2UgdW5pdCBuYW1lOiBiL3V0aWwuc29s"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">import</span><span class="w"> </span><span class="s2">&quot;./util.sol&quot;</span><span class="w"> </span>as<span class="w"> </span>util<span class="p">;</span><span class="w"> </span><span class="c1">// source unit name: b/util.sol</span>
</pre></div>
</div>
</div>
</li>
<li><p>You cannot remap base path or any other part of the path that is only added internally by an
import callback:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>solc /project/<span class="o">=</span>/contracts/ /project/contract.sol --base-path /project <span class="c1"># source unit name: contract.sol</span>
</pre></div>
</div>
<div class="literal-block-wrapper docutils container" id="id14">
<div class="code-block-caption"><span class="caption-text">/project/contract.sol</span><a class="headerlink" href="#id14" title="Permalink to this code">ÔÉÅ</a></div>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=aW1wb3J0ICJ1dGlsLnNvbCIgYXMgdXRpbDsgLy8gc291cmNlIHVuaXQgbmFtZTogdXRpbC5zb2w="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">import</span><span class="w"> </span><span class="s2">&quot;util.sol&quot;</span><span class="w"> </span>as<span class="w"> </span>util<span class="p">;</span><span class="w"> </span><span class="c1">// source unit name: util.sol</span>
</pre></div>
</div>
</div>
</li>
</ul>
</li>
<li><p><strong>Target is inserted directly into the source unit name and does not necessarily have to be a valid path.</strong></p>
<ul>
<li><p>It can be anything as long as the import callback can handle it.
In case of the Host Filesystem Loader this includes also relative paths.
When using the JavaScript interface you can even use URLs and abstract identifiers if
your callback can handle them.</p></li>
<li><p>Remapping happens after relative imports have already been resolved into source unit names.
This means that targets starting with <code class="docutils literal notranslate"><span class="pre">./</span></code> and <code class="docutils literal notranslate"><span class="pre">../</span></code> have no special meaning and are
relative to the base path rather than to the location of the source file.</p></li>
<li><p>Remapping targets are not normalized so <code class="docutils literal notranslate"><span class="pre">&#64;root/=./a/b//</span></code> will remap <code class="docutils literal notranslate"><span class="pre">&#64;root/contract.sol</span></code>
to <code class="docutils literal notranslate"><span class="pre">./a/b//contract.sol</span></code> and not <code class="docutils literal notranslate"><span class="pre">a/b/contract.sol</span></code>.</p></li>
<li><p>If the target does not end with a slash, the compiler will not add one automatically:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>solc /project/<span class="o">=</span>/contracts /project/contract.sol <span class="c1"># source unit name: /project/contract.sol</span>
</pre></div>
</div>
<div class="literal-block-wrapper docutils container" id="id15">
<div class="code-block-caption"><span class="caption-text">/project/contract.sol</span><a class="headerlink" href="#id15" title="Permalink to this code">ÔÉÅ</a></div>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=aW1wb3J0ICIvcHJvamVjdC91dGlsLnNvbCIgYXMgdXRpbDsgLy8gc291cmNlIHVuaXQgbmFtZTogL2NvbnRyYWN0c3V0aWwuc29s"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">import</span><span class="w"> </span><span class="s2">&quot;/project/util.sol&quot;</span><span class="w"> </span>as<span class="w"> </span>util<span class="p">;</span><span class="w"> </span><span class="c1">// source unit name: /contractsutil.sol</span>
</pre></div>
</div>
</div>
</li>
</ul>
</li>
<li><p><strong>Context and prefix are patterns and matches must be exact.</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">a//b=c</span></code> will not match <code class="docutils literal notranslate"><span class="pre">a/b</span></code>.</p></li>
<li><p>source unit names are not normalized so <code class="docutils literal notranslate"><span class="pre">a/b=c</span></code> will not match <code class="docutils literal notranslate"><span class="pre">a//b</span></code> either.</p></li>
<li><p>Parts of file and directory names can match as well.
<code class="docutils literal notranslate"><span class="pre">/newProject/con:/new=old</span></code> will match <code class="docutils literal notranslate"><span class="pre">/newProject/contract.sol</span></code> and remap it to
<code class="docutils literal notranslate"><span class="pre">oldProject/contract.sol</span></code>.</p></li>
</ul>
</li>
<li><p><strong>At most one remapping is applied to a single import.</strong></p>
<ul class="simple">
<li><p>If multiple remappings match the same source unit name, the one with the longest matching
prefix is chosen.</p></li>
<li><p>If prefixes are identical, the one specified last wins.</p></li>
<li><p>Remappings do not work on other remappings. For example <code class="docutils literal notranslate"><span class="pre">a=b</span> <span class="pre">b=c</span> <span class="pre">c=d</span></code> will not result in <code class="docutils literal notranslate"><span class="pre">a</span></code>
being remapped to <code class="docutils literal notranslate"><span class="pre">d</span></code>.</p></li>
</ul>
</li>
<li><p><strong>Prefix cannot be empty but context and target are optional.</strong></p>
<ul class="simple">
<li><p>If <code class="docutils literal notranslate"><span class="pre">target</span></code> is the empty string, <code class="docutils literal notranslate"><span class="pre">prefix</span></code> is simply removed from import paths.</p></li>
<li><p>Empty <code class="docutils literal notranslate"><span class="pre">context</span></code> means that the remapping applies to all imports in all source units.</p></li>
</ul>
</li>
</ol>
</section>
<section id="using-urls-in-imports">
<span id="index-10"></span><h3>Using URLs in imports<a class="headerlink" href="#using-urls-in-imports" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Most URL prefixes such as <code class="docutils literal notranslate"><span class="pre">https://</span></code> or <code class="docutils literal notranslate"><span class="pre">data://</span></code> have no special meaning in import paths.
The only exception is <code class="docutils literal notranslate"><span class="pre">file://</span></code> which is stripped from source unit names by the Host Filesystem
Loader.</p>
<p>When compiling locally you can use import remapping to replace the protocol and domain part with a
local path:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>solc :https://github.com/ethereum/dapp-bin<span class="o">=</span>/usr/local/dapp-bin contract.sol
</pre></div>
</div>
<p>Note the leading <code class="docutils literal notranslate"><span class="pre">:</span></code>, which is necessary when the remapping context is empty.
Otherwise the <code class="docutils literal notranslate"><span class="pre">https:</span></code> part would be interpreted by the compiler as the context.</p>
</section>
</section>
<span id="document-yul"></span><section id="yul">
<span id="id1"></span><h2>Yul<a class="headerlink" href="#yul" title="Permalink to this heading">ÔÉÅ</a></h2>
<p id="index-0">Yul (previously also called JULIA or IULIA) is an intermediate language that can be
compiled to bytecode for different backends.</p>
<p>Support for EVM 1.0, EVM 1.5 and Ewasm is planned, and it is designed to
be a usable common denominator of all three
platforms. It can already be used in stand-alone mode and
for ‚Äúinline assembly‚Äù inside Solidity
and there is an experimental implementation of the Solidity compiler
that uses Yul as an intermediate language. Yul is a good target for
high-level optimisation stages that can benefit all target platforms equally.</p>
<section id="motivation-and-high-level-description">
<h3>Motivation and High-level Description<a class="headerlink" href="#motivation-and-high-level-description" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>The design of Yul tries to achieve several goals:</p>
<ol class="arabic simple">
<li><p>Programs written in Yul should be readable, even if the code is generated by a compiler from Solidity or another high-level language.</p></li>
<li><p>Control flow should be easy to understand to help in manual inspection, formal verification and optimization.</p></li>
<li><p>The translation from Yul to bytecode should be as straightforward as possible.</p></li>
<li><p>Yul should be suitable for whole-program optimization.</p></li>
</ol>
<p>In order to achieve the first and second goal, Yul provides high-level constructs
like <code class="docutils literal notranslate"><span class="pre">for</span></code> loops, <code class="docutils literal notranslate"><span class="pre">if</span></code> and <code class="docutils literal notranslate"><span class="pre">switch</span></code> statements and function calls. These should
be sufficient for adequately representing the control flow for assembly programs.
Therefore, no explicit statements for <code class="docutils literal notranslate"><span class="pre">SWAP</span></code>, <code class="docutils literal notranslate"><span class="pre">DUP</span></code>, <code class="docutils literal notranslate"><span class="pre">JUMPDEST</span></code>, <code class="docutils literal notranslate"><span class="pre">JUMP</span></code> and <code class="docutils literal notranslate"><span class="pre">JUMPI</span></code>
are provided, because the first two obfuscate the data flow
and the last two obfuscate control flow. Furthermore, functional statements of
the form <code class="docutils literal notranslate"><span class="pre">mul(add(x,</span> <span class="pre">y),</span> <span class="pre">7)</span></code> are preferred over pure opcode statements like
<code class="docutils literal notranslate"><span class="pre">7</span> <span class="pre">y</span> <span class="pre">x</span> <span class="pre">add</span> <span class="pre">mul</span></code> because in the first form, it is much easier to see which
operand is used for which opcode.</p>
<p>Even though it was designed for stack machines, Yul does not expose the complexity of the stack itself.
The programmer or auditor should not have to worry about the stack.</p>
<p>The third goal is achieved by compiling the
higher level constructs to bytecode in a very regular way.
The only non-local operation performed
by the assembler is name lookup of user-defined identifiers (functions, variables, ‚Ä¶)
and cleanup of local variables from the stack.</p>
<p>To avoid confusions between concepts like values and references,
Yul is statically typed. At the same time, there is a default type
(usually the integer word of the target machine) that can always
be omitted to help readability.</p>
<p>To keep the language simple and flexible, Yul does not have
any built-in operations, functions or types in its pure form.
These are added together with their semantics when specifying a dialect of Yul,
which allows specializing Yul to the requirements of different
target platforms and feature sets.</p>
<p>Currently, there is only one specified dialect of Yul. This dialect uses
the EVM opcodes as builtin functions
(see below) and defines only the type <code class="docutils literal notranslate"><span class="pre">u256</span></code>, which is the native 256-bit
type of the EVM. Because of that, we will not provide types in the examples below.</p>
</section>
<section id="simple-example">
<h3>Simple Example<a class="headerlink" href="#simple-example" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>The following example program is written in the EVM dialect and computes exponentiation.
It can be compiled using <code class="docutils literal notranslate"><span class="pre">solc</span> <span class="pre">--strict-assembly</span></code>. The builtin functions
<code class="docutils literal notranslate"><span class="pre">mul</span></code> and <code class="docutils literal notranslate"><span class="pre">div</span></code> compute product and division, respectively.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=yul&amp;version=0.8.15&amp;code=ewogICAgZnVuY3Rpb24gcG93ZXIoYmFzZSwgZXhwb25lbnQpIC0+IHJlc3VsdAogICAgewogICAgICAgIHN3aXRjaCBleHBvbmVudAogICAgICAgIGNhc2UgMCB7IHJlc3VsdCA6PSAxIH0KICAgICAgICBjYXNlIDEgeyByZXN1bHQgOj0gYmFzZSB9CiAgICAgICAgZGVmYXVsdAogICAgICAgIHsKICAgICAgICAgICAgcmVzdWx0IDo9IHBvd2VyKG11bChiYXNlLCBiYXNlKSwgZGl2KGV4cG9uZW50LCAyKSkKICAgICAgICAgICAgc3dpdGNoIG1vZChleHBvbmVudCwgMikKICAgICAgICAgICAgICAgIGNhc2UgMSB7IHJlc3VsdCA6PSBtdWwoYmFzZSwgcmVzdWx0KSB9CiAgICAgICAgfQogICAgfQp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-yul notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="k">function</span> <span class="n">power</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">exponent</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">result</span>
    <span class="p">{</span>
        <span class="k">switch</span> <span class="n">exponent</span>
        <span class="k">case</span> <span class="mi">0</span> <span class="p">{</span> <span class="n">result</span> <span class="o">:=</span> <span class="mi">1</span> <span class="p">}</span>
        <span class="k">case</span> <span class="mi">1</span> <span class="p">{</span> <span class="n">result</span> <span class="o">:=</span> <span class="n">base</span> <span class="p">}</span>
        <span class="k">default</span>
        <span class="p">{</span>
            <span class="n">result</span> <span class="o">:=</span> <span class="n">power</span><span class="p">(</span><span class="nf">mul</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">base</span><span class="p">),</span> <span class="nf">div</span><span class="p">(</span><span class="n">exponent</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
            <span class="k">switch</span> <span class="nf">mod</span><span class="p">(</span><span class="n">exponent</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                <span class="k">case</span> <span class="mi">1</span> <span class="p">{</span> <span class="n">result</span> <span class="o">:=</span> <span class="nf">mul</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span> <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>It is also possible to implement the same function using a for-loop
instead of with recursion. Here, <code class="docutils literal notranslate"><span class="pre">lt(a,</span> <span class="pre">b)</span></code> computes whether <code class="docutils literal notranslate"><span class="pre">a</span></code> is less than <code class="docutils literal notranslate"><span class="pre">b</span></code>.
less-than comparison.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=yul&amp;version=0.8.15&amp;code=ewogICAgZnVuY3Rpb24gcG93ZXIoYmFzZSwgZXhwb25lbnQpIC0+IHJlc3VsdAogICAgewogICAgICAgIHJlc3VsdCA6PSAxCiAgICAgICAgZm9yIHsgbGV0IGkgOj0gMCB9IGx0KGksIGV4cG9uZW50KSB7IGkgOj0gYWRkKGksIDEpIH0KICAgICAgICB7CiAgICAgICAgICAgIHJlc3VsdCA6PSBtdWwocmVzdWx0LCBiYXNlKQogICAgICAgIH0KICAgIH0KfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-yul notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="k">function</span> <span class="n">power</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">exponent</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">result</span>
    <span class="p">{</span>
        <span class="n">result</span> <span class="o">:=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="p">{</span> <span class="ow">let</span> <span class="nv">i</span> <span class="o">:=</span> <span class="mi">0</span> <span class="p">}</span> <span class="nf">lt</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">exponent</span><span class="p">)</span> <span class="p">{</span> <span class="n">i</span> <span class="o">:=</span> <span class="nf">add</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="p">}</span>
        <span class="p">{</span>
            <span class="n">result</span> <span class="o">:=</span> <span class="nf">mul</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">base</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>At the <a class="reference internal" href="#erc20yul"><span class="std std-ref">end of the section</span></a>, a complete implementation of
the ERC-20 standard can be found.</p>
</section>
<section id="stand-alone-usage">
<h3>Stand-Alone Usage<a class="headerlink" href="#stand-alone-usage" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>You can use Yul in its stand-alone form in the EVM dialect using the Solidity compiler.
This will use the <a class="reference internal" href="#yul-object"><span class="std std-ref">Yul object notation</span></a> so that it is possible to refer
to code as data to deploy contracts. This Yul mode is available for the commandline compiler
(use <code class="docutils literal notranslate"><span class="pre">--strict-assembly</span></code>) and for the <a class="reference internal" href="index.html#compiler-api"><span class="std std-ref">standard-json interface</span></a>:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;language&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Yul&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;sources&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;input.yul&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{ sstore(0, 1) }&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;settings&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;outputSelection&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;*&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;*&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">],</span><span class="w"> </span><span class="nt">&quot;&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;optimizer&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;details&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;yul&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Yul is in active development and bytecode generation is only fully implemented for the EVM dialect of Yul
with EVM 1.0 as target.</p>
</div>
</section>
<section id="informal-description-of-yul">
<h3>Informal Description of Yul<a class="headerlink" href="#informal-description-of-yul" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>In the following, we will talk about each individual aspect
of the Yul language. In examples, we will use the default EVM dialect.</p>
<section id="syntax">
<h4>Syntax<a class="headerlink" href="#syntax" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Yul parses comments, literals and identifiers in the same way as Solidity,
so you can e.g. use <code class="docutils literal notranslate"><span class="pre">//</span></code> and <code class="docutils literal notranslate"><span class="pre">/*</span> <span class="pre">*/</span></code> to denote comments.
There is one exception: Identifiers in Yul can contain dots: <code class="docutils literal notranslate"><span class="pre">.</span></code>.</p>
<p>Yul can specify ‚Äúobjects‚Äù that consist of code, data and sub-objects.
Please see <a class="reference internal" href="#yul-object"><span class="std std-ref">Yul Objects</span></a> below for details on that.
In this section, we are only concerned with the code part of such an object.
This code part always consists of a curly-braces
delimited block. Most tools support specifying just a code block
where an object is expected.</p>
<p>Inside a code block, the following elements can be used
(see the later sections for more details):</p>
<ul class="simple">
<li><p>literals, i.e. <code class="docutils literal notranslate"><span class="pre">0x123</span></code>, <code class="docutils literal notranslate"><span class="pre">42</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;abc&quot;</span></code> (strings up to 32 characters)</p></li>
<li><p>calls to builtin functions, e.g. <code class="docutils literal notranslate"><span class="pre">add(1,</span> <span class="pre">mload(0))</span></code></p></li>
<li><p>variable declarations, e.g. <code class="docutils literal notranslate"><span class="pre">let</span> <span class="pre">x</span> <span class="pre">:=</span> <span class="pre">7</span></code>, <code class="docutils literal notranslate"><span class="pre">let</span> <span class="pre">x</span> <span class="pre">:=</span> <span class="pre">add(y,</span> <span class="pre">3)</span></code> or <code class="docutils literal notranslate"><span class="pre">let</span> <span class="pre">x</span></code> (initial value of 0 is assigned)</p></li>
<li><p>identifiers (variables), e.g. <code class="docutils literal notranslate"><span class="pre">add(3,</span> <span class="pre">x)</span></code></p></li>
<li><p>assignments, e.g. <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">:=</span> <span class="pre">add(y,</span> <span class="pre">3)</span></code></p></li>
<li><p>blocks where local variables are scoped inside, e.g. <code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">let</span> <span class="pre">x</span> <span class="pre">:=</span> <span class="pre">3</span> <span class="pre">{</span> <span class="pre">let</span> <span class="pre">y</span> <span class="pre">:=</span> <span class="pre">add(x,</span> <span class="pre">1)</span> <span class="pre">}</span> <span class="pre">}</span></code></p></li>
<li><p>if statements, e.g. <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">lt(a,</span> <span class="pre">b)</span> <span class="pre">{</span> <span class="pre">sstore(0,</span> <span class="pre">1)</span> <span class="pre">}</span></code></p></li>
<li><p>switch statements, e.g. <code class="docutils literal notranslate"><span class="pre">switch</span> <span class="pre">mload(0)</span> <span class="pre">case</span> <span class="pre">0</span> <span class="pre">{</span> <span class="pre">revert()</span> <span class="pre">}</span> <span class="pre">default</span> <span class="pre">{</span> <span class="pre">mstore(0,</span> <span class="pre">1)</span> <span class="pre">}</span></code></p></li>
<li><p>for loops, e.g. <code class="docutils literal notranslate"><span class="pre">for</span> <span class="pre">{</span> <span class="pre">let</span> <span class="pre">i</span> <span class="pre">:=</span> <span class="pre">0}</span> <span class="pre">lt(i,</span> <span class="pre">10)</span> <span class="pre">{</span> <span class="pre">i</span> <span class="pre">:=</span> <span class="pre">add(i,</span> <span class="pre">1)</span> <span class="pre">}</span> <span class="pre">{</span> <span class="pre">mstore(i,</span> <span class="pre">7)</span> <span class="pre">}</span></code></p></li>
<li><p>function definitions, e.g. <code class="docutils literal notranslate"><span class="pre">function</span> <span class="pre">f(a,</span> <span class="pre">b)</span> <span class="pre">-&gt;</span> <span class="pre">c</span> <span class="pre">{</span> <span class="pre">c</span> <span class="pre">:=</span> <span class="pre">add(a,</span> <span class="pre">b)</span> <span class="pre">}</span></code></p></li>
</ul>
<p>Multiple syntactical elements can follow each other simply separated by
whitespace, i.e. there is no terminating <code class="docutils literal notranslate"><span class="pre">;</span></code> or newline required.</p>
</section>
<section id="literals">
<h4>Literals<a class="headerlink" href="#literals" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>As literals, you can use:</p>
<ul class="simple">
<li><p>Integer constants in decimal or hexadecimal notation.</p></li>
<li><p>ASCII strings (e.g. <code class="docutils literal notranslate"><span class="pre">&quot;abc&quot;</span></code>), which may contain hex escapes <code class="docutils literal notranslate"><span class="pre">\xNN</span></code> and Unicode escapes <code class="docutils literal notranslate"><span class="pre">\uNNNN</span></code> where <code class="docutils literal notranslate"><span class="pre">N</span></code> are hexadecimal digits.</p></li>
<li><p>Hex strings (e.g. <code class="docutils literal notranslate"><span class="pre">hex&quot;616263&quot;</span></code>).</p></li>
</ul>
<p>In the EVM dialect of Yul, literals represent 256-bit words as follows:</p>
<ul class="simple">
<li><p>Decimal or hexadecimal constants must be less than <code class="docutils literal notranslate"><span class="pre">2**256</span></code>.
They represent the 256-bit word with that value as an unsigned integer in big endian encoding.</p></li>
<li><p>An ASCII string is first viewed as a byte sequence, by viewing
a non-escape ASCII character as a single byte whose value is the ASCII code,
an escape <code class="docutils literal notranslate"><span class="pre">\xNN</span></code> as single byte with that value, and
an escape <code class="docutils literal notranslate"><span class="pre">\uNNNN</span></code> as the UTF-8 sequence of bytes for that code point.
The byte sequence must not exceed 32 bytes.
The byte sequence is padded with zeros on the right to reach 32 bytes in length;
in other words, the string is stored left-aligned.
The padded byte sequence represents a 256-bit word whose most significant 8 bits are the ones from the first byte,
i.e. the bytes are interpreted in big endian form.</p></li>
<li><p>A hex string is first viewed as a byte sequence, by viewing
each pair of contiguous hex digits as a byte.
The byte sequence must not exceed 32 bytes (i.e. 64 hex digits), and is treated as above.</p></li>
</ul>
<p>When compiling for the EVM, this will be translated into an
appropriate <code class="docutils literal notranslate"><span class="pre">PUSHi</span></code> instruction. In the following example,
<code class="docutils literal notranslate"><span class="pre">3</span></code> and <code class="docutils literal notranslate"><span class="pre">2</span></code> are added resulting in 5 and then the
bitwise <code class="docutils literal notranslate"><span class="pre">and</span></code> with the string ‚Äúabc‚Äù is computed.
The final value is assigned to a local variable called <code class="docutils literal notranslate"><span class="pre">x</span></code>.</p>
<p>The 32-byte limit above does not apply to string literals passed to builtin functions that require
literal arguments (e.g. <code class="docutils literal notranslate"><span class="pre">setimmutable</span></code> or <code class="docutils literal notranslate"><span class="pre">loadimmutable</span></code>). Those strings never end up in the
generated bytecode.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=yul&amp;version=0.8.15&amp;code=bGV0IHggOj0gYW5kKCJhYmMiLCBhZGQoMywgMikp"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-yul notranslate"><div class="highlight"><pre><span></span><span class="ow">let</span> <span class="nv">x</span> <span class="o">:=</span> <span class="nf">and</span><span class="p">(</span><span class="s">&quot;abc&quot;</span><span class="p">,</span> <span class="nf">add</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
<p>Unless it is the default type, the type of a literal
has to be specified after a colon:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=yul&amp;version=0.8.15&amp;code=Ly8gVGhpcyB3aWxsIG5vdCBjb21waWxlICh1MzIgYW5kIHUyNTYgdHlwZSBub3QgaW1wbGVtZW50ZWQgeWV0KQpsZXQgeCA6PSBhbmQoImFiYyI6dTMyLCBhZGQoMzp1MjU2LCAyOnUyNTYpKQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-yul notranslate"><div class="highlight"><pre><span></span><span class="c1">// This will not compile (u32 and u256 type not implemented yet)</span>
<span class="ow">let</span> <span class="nv">x</span> <span class="o">:=</span> <span class="nf">and</span><span class="p">(</span><span class="s">&quot;abc&quot;</span><span class="p">:</span><span class="n">u32</span><span class="p">,</span> <span class="nf">add</span><span class="p">(</span><span class="mi">3</span><span class="p">:</span><span class="n">u256</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="n">u256</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="function-calls">
<h4>Function Calls<a class="headerlink" href="#function-calls" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Both built-in and user-defined functions (see below) can be called
in the same way as shown in the previous example.
If the function returns a single value, it can be directly used
inside an expression again. If it returns multiple values,
they have to be assigned to local variables.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=yul&amp;version=0.8.15&amp;code=ZnVuY3Rpb24gZih4LCB5KSAtPiBhLCBiIHsgLyogLi4uICovIH0KbXN0b3JlKDB4ODAsIGFkZChtbG9hZCgweDgwKSwgMykpCi8vIEhlcmUsIHRoZSB1c2VyLWRlZmluZWQgZnVuY3Rpb24gYGZgIHJldHVybnMgdHdvIHZhbHVlcy4KbGV0IHgsIHkgOj0gZigxLCBtbG9hZCgwKSk="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-yul notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">}</span>
<span class="nf">mstore</span><span class="p">(</span><span class="mh">0x80</span><span class="p">,</span> <span class="nf">add</span><span class="p">(</span><span class="nf">mload</span><span class="p">(</span><span class="mh">0x80</span><span class="p">),</span> <span class="mi">3</span><span class="p">))</span>
<span class="c1">// Here, the user-defined function `f` returns two values.</span>
<span class="ow">let</span> <span class="nv">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">:=</span> <span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nf">mload</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
<p>For built-in functions of the EVM, functional expressions
can be directly translated to a stream of opcodes:
You just read the expression from right to left to obtain the
opcodes. In the case of the first line in the example, this
is <code class="docutils literal notranslate"><span class="pre">PUSH1</span> <span class="pre">3</span> <span class="pre">PUSH1</span> <span class="pre">0x80</span> <span class="pre">MLOAD</span> <span class="pre">ADD</span> <span class="pre">PUSH1</span> <span class="pre">0x80</span> <span class="pre">MSTORE</span></code>.</p>
<p>For calls to user-defined functions, the arguments are also
put on the stack from right to left and this is the order
in which argument lists are evaluated. The return values,
though, are expected on the stack from left to right,
i.e. in this example, <code class="docutils literal notranslate"><span class="pre">y</span></code> is on top of the stack and <code class="docutils literal notranslate"><span class="pre">x</span></code>
is below it.</p>
</section>
<section id="variable-declarations">
<h4>Variable Declarations<a class="headerlink" href="#variable-declarations" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>You can use the <code class="docutils literal notranslate"><span class="pre">let</span></code> keyword to declare variables.
A variable is only visible inside the
<code class="docutils literal notranslate"><span class="pre">{...}</span></code>-block it was defined in. When compiling to the EVM,
a new stack slot is created that is reserved
for the variable and automatically removed again when the end of the block
is reached. You can provide an initial value for the variable.
If you do not provide a value, the variable will be initialized to zero.</p>
<p>Since variables are stored on the stack, they do not directly
influence memory or storage, but they can be used as pointers
to memory or storage locations in the built-in functions
<code class="docutils literal notranslate"><span class="pre">mstore</span></code>, <code class="docutils literal notranslate"><span class="pre">mload</span></code>, <code class="docutils literal notranslate"><span class="pre">sstore</span></code> and <code class="docutils literal notranslate"><span class="pre">sload</span></code>.
Future dialects might introduce specific types for such pointers.</p>
<p>When a variable is referenced, its current value is copied.
For the EVM, this translates to a <code class="docutils literal notranslate"><span class="pre">DUP</span></code> instruction.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=yul&amp;version=0.8.15&amp;code=ewogICAgbGV0IHplcm8gOj0gMAogICAgbGV0IHYgOj0gY2FsbGRhdGFsb2FkKHplcm8pCiAgICB7CiAgICAgICAgbGV0IHkgOj0gYWRkKHNsb2FkKHYpLCAxKQogICAgICAgIHYgOj0geQogICAgfSAvLyB5IGlzICJkZWFsbG9jYXRlZCIgaGVyZQogICAgc3N0b3JlKHYsIHplcm8pCn0gLy8gdiBhbmQgemVybyBhcmUgImRlYWxsb2NhdGVkIiBoZXJl"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-yul notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="ow">let</span> <span class="nv">zero</span> <span class="o">:=</span> <span class="mi">0</span>
    <span class="ow">let</span> <span class="nv">v</span> <span class="o">:=</span> <span class="nf">calldataload</span><span class="p">(</span><span class="n">zero</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="ow">let</span> <span class="nv">y</span> <span class="o">:=</span> <span class="nf">add</span><span class="p">(</span><span class="nf">sload</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">:=</span> <span class="n">y</span>
    <span class="p">}</span> <span class="c1">// y is &quot;deallocated&quot; here</span>
    <span class="nf">sstore</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">zero</span><span class="p">)</span>
<span class="p">}</span> <span class="c1">// v and zero are &quot;deallocated&quot; here</span>
</pre></div>
</div>
<p>If the declared variable should have a type different from the default type,
you denote that following a colon. You can also declare multiple
variables in one statement when you assign from a function call
that returns multiple values.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=yul&amp;version=0.8.15&amp;code=Ly8gVGhpcyB3aWxsIG5vdCBjb21waWxlICh1MzIgYW5kIHUyNTYgdHlwZSBub3QgaW1wbGVtZW50ZWQgeWV0KQp7CiAgICBsZXQgemVybzp1MzIgOj0gMDp1MzIKICAgIGxldCB2OnUyNTYsIHQ6dTMyIDo9IGYoKQogICAgbGV0IHgsIHkgOj0gZygpCn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-yul notranslate"><div class="highlight"><pre><span></span><span class="c1">// This will not compile (u32 and u256 type not implemented yet)</span>
<span class="p">{</span>
    <span class="ow">let</span> <span class="nv">zero</span><span class="p">:</span><span class="n">u32</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">:</span><span class="n">u32</span>
    <span class="ow">let</span> <span class="nv">v</span><span class="p">:</span><span class="n">u256</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span><span class="n">u32</span> <span class="o">:=</span> <span class="n">f</span><span class="p">()</span>
    <span class="ow">let</span> <span class="nv">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">:=</span> <span class="n">g</span><span class="p">()</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Depending on the optimiser settings, the compiler can free the stack slots
already after the variable has been used for
the last time, even though it is still in scope.</p>
</section>
<section id="assignments">
<h4>Assignments<a class="headerlink" href="#assignments" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Variables can be assigned to after their definition using the
<code class="docutils literal notranslate"><span class="pre">:=</span></code> operator. It is possible to assign multiple
variables at the same time. For this, the number and types of the
values have to match.
If you want to assign the values returned from a function that has
multiple return parameters, you have to provide multiple variables.
The same variable may not occur multiple times on the left-hand side of
an assignment, e.g. <code class="docutils literal notranslate"><span class="pre">x,</span> <span class="pre">x</span> <span class="pre">:=</span> <span class="pre">f()</span></code> is invalid.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=yul&amp;version=0.8.15&amp;code=bGV0IHYgOj0gMAovLyByZS1hc3NpZ24gdgp2IDo9IDIKbGV0IHQgOj0gYWRkKHYsIDIpCmZ1bmN0aW9uIGYoKSAtPiBhLCBiIHsgfQovLyBhc3NpZ24gbXVsdGlwbGUgdmFsdWVzCnYsIHQgOj0gZigp"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-yul notranslate"><div class="highlight"><pre><span></span><span class="ow">let</span> <span class="nv">v</span> <span class="o">:=</span> <span class="mi">0</span>
<span class="c1">// re-assign v</span>
<span class="n">v</span> <span class="o">:=</span> <span class="mi">2</span>
<span class="ow">let</span> <span class="nv">t</span> <span class="o">:=</span> <span class="nf">add</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="k">function</span> <span class="n">f</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="p">{</span> <span class="p">}</span>
<span class="c1">// assign multiple values</span>
<span class="n">v</span><span class="p">,</span> <span class="n">t</span> <span class="o">:=</span> <span class="n">f</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="if">
<h4>If<a class="headerlink" href="#if" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>The if statement can be used for conditionally executing code.
No ‚Äúelse‚Äù block can be defined. Consider using ‚Äúswitch‚Äù instead (see below) if
you need multiple alternatives.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=yul&amp;version=0.8.15&amp;code=aWYgbHQoY2FsbGRhdGFzaXplKCksIDQpIHsgcmV2ZXJ0KDAsIDApIH0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-yul notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="nf">lt</span><span class="p">(</span><span class="nf">calldatasize</span><span class="p">(),</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span> <span class="nf">revert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
</pre></div>
</div>
<p>The curly braces for the body are required.</p>
</section>
<section id="switch">
<h4>Switch<a class="headerlink" href="#switch" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>You can use a switch statement as an extended version of the if statement.
It takes the value of an expression and compares it to several literal constants.
The branch corresponding to the matching constant is taken.
Contrary to other programming languages, for safety reasons, control flow does
not continue from one case to the next. There can be a fallback or default
case called <code class="docutils literal notranslate"><span class="pre">default</span></code> which is taken if none of the literal constants matches.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=yul&amp;version=0.8.15&amp;code=ewogICAgbGV0IHggOj0gMAogICAgc3dpdGNoIGNhbGxkYXRhbG9hZCg0KQogICAgY2FzZSAwIHsKICAgICAgICB4IDo9IGNhbGxkYXRhbG9hZCgweDI0KQogICAgfQogICAgZGVmYXVsdCB7CiAgICAgICAgeCA6PSBjYWxsZGF0YWxvYWQoMHg0NCkKICAgIH0KICAgIHNzdG9yZSgwLCBkaXYoeCwgMikpCn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-yul notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="ow">let</span> <span class="nv">x</span> <span class="o">:=</span> <span class="mi">0</span>
    <span class="k">switch</span> <span class="nf">calldataload</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="k">case</span> <span class="mi">0</span> <span class="p">{</span>
        <span class="n">x</span> <span class="o">:=</span> <span class="nf">calldataload</span><span class="p">(</span><span class="mh">0x24</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">default</span> <span class="p">{</span>
        <span class="n">x</span> <span class="o">:=</span> <span class="nf">calldataload</span><span class="p">(</span><span class="mh">0x44</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nf">sstore</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nf">div</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The list of cases is not enclosed by curly braces, but the body of a
case does require them.</p>
</section>
<section id="loops">
<h4>Loops<a class="headerlink" href="#loops" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Yul supports for-loops which consist of
a header containing an initializing part, a condition, a post-iteration
part and a body. The condition has to be an expression, while
the other three are blocks. If the initializing part
declares any variables at the top level, the scope of these variables extends to all other
parts of the loop.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">break</span></code> and <code class="docutils literal notranslate"><span class="pre">continue</span></code> statements can be used in the body to exit the loop
or skip to the post-part, respectively.</p>
<p>The following example computes the sum of an area in memory.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=yul&amp;version=0.8.15&amp;code=ewogICAgbGV0IHggOj0gMAogICAgZm9yIHsgbGV0IGkgOj0gMCB9IGx0KGksIDB4MTAwKSB7IGkgOj0gYWRkKGksIDB4MjApIH0gewogICAgICAgIHggOj0gYWRkKHgsIG1sb2FkKGkpKQogICAgfQp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-yul notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="ow">let</span> <span class="nv">x</span> <span class="o">:=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="p">{</span> <span class="ow">let</span> <span class="nv">i</span> <span class="o">:=</span> <span class="mi">0</span> <span class="p">}</span> <span class="nf">lt</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mh">0x100</span><span class="p">)</span> <span class="p">{</span> <span class="n">i</span> <span class="o">:=</span> <span class="nf">add</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">)</span> <span class="p">}</span> <span class="p">{</span>
        <span class="n">x</span> <span class="o">:=</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nf">mload</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For loops can also be used as a replacement for while loops:
Simply leave the initialization and post-iteration parts empty.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=yul&amp;version=0.8.15&amp;code=ewogICAgbGV0IHggOj0gMAogICAgbGV0IGkgOj0gMAogICAgZm9yIHsgfSBsdChpLCAweDEwMCkgeyB9IHsgICAgIC8vIHdoaWxlKGkgPCAweDEwMCkKICAgICAgICB4IDo9IGFkZCh4LCBtbG9hZChpKSkKICAgICAgICBpIDo9IGFkZChpLCAweDIwKQogICAgfQp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-yul notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="ow">let</span> <span class="nv">x</span> <span class="o">:=</span> <span class="mi">0</span>
    <span class="ow">let</span> <span class="nv">i</span> <span class="o">:=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="p">{</span> <span class="p">}</span> <span class="nf">lt</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mh">0x100</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span> <span class="p">{</span>     <span class="c1">// while(i &lt; 0x100)</span>
        <span class="n">x</span> <span class="o">:=</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nf">mload</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="n">i</span> <span class="o">:=</span> <span class="nf">add</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="function-declarations">
<h4>Function Declarations<a class="headerlink" href="#function-declarations" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Yul allows the definition of functions. These should not be confused with functions
in Solidity since they are never part of an external interface of a contract and
are part of a namespace separate from the one for Solidity functions.</p>
<p>For the EVM, Yul functions take their
arguments (and a return PC) from the stack and also put the results onto the
stack. User-defined functions and built-in functions are called in exactly the same way.</p>
<p>Functions can be defined anywhere and are visible in the block they are
declared in. Inside a function, you cannot access local variables
defined outside of that function.</p>
<p>Functions declare parameters and return variables, similar to Solidity.
To return a value, you assign it to the return variable(s).</p>
<p>If you call a function that returns multiple values, you have to assign
them to multiple variables using <code class="docutils literal notranslate"><span class="pre">a,</span> <span class="pre">b</span> <span class="pre">:=</span> <span class="pre">f(x)</span></code> or <code class="docutils literal notranslate"><span class="pre">let</span> <span class="pre">a,</span> <span class="pre">b</span> <span class="pre">:=</span> <span class="pre">f(x)</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">leave</span></code> statement can be used to exit the current function. It
works like the <code class="docutils literal notranslate"><span class="pre">return</span></code> statement in other languages just that it does
not take a value to return, it just exits the functions and the function
will return whatever values are currently assigned to the return variable(s).</p>
<p>Note that the EVM dialect has a built-in function called <code class="docutils literal notranslate"><span class="pre">return</span></code> that
quits the full execution context (internal message call) and not just
the current yul function.</p>
<p>The following example implements the power function by square-and-multiply.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=yul&amp;version=0.8.15&amp;code=ewogICAgZnVuY3Rpb24gcG93ZXIoYmFzZSwgZXhwb25lbnQpIC0+IHJlc3VsdCB7CiAgICAgICAgc3dpdGNoIGV4cG9uZW50CiAgICAgICAgY2FzZSAwIHsgcmVzdWx0IDo9IDEgfQogICAgICAgIGNhc2UgMSB7IHJlc3VsdCA6PSBiYXNlIH0KICAgICAgICBkZWZhdWx0IHsKICAgICAgICAgICAgcmVzdWx0IDo9IHBvd2VyKG11bChiYXNlLCBiYXNlKSwgZGl2KGV4cG9uZW50LCAyKSkKICAgICAgICAgICAgc3dpdGNoIG1vZChleHBvbmVudCwgMikKICAgICAgICAgICAgICAgIGNhc2UgMSB7IHJlc3VsdCA6PSBtdWwoYmFzZSwgcmVzdWx0KSB9CiAgICAgICAgfQogICAgfQp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-yul notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="k">function</span> <span class="n">power</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">exponent</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">result</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="n">exponent</span>
        <span class="k">case</span> <span class="mi">0</span> <span class="p">{</span> <span class="n">result</span> <span class="o">:=</span> <span class="mi">1</span> <span class="p">}</span>
        <span class="k">case</span> <span class="mi">1</span> <span class="p">{</span> <span class="n">result</span> <span class="o">:=</span> <span class="n">base</span> <span class="p">}</span>
        <span class="k">default</span> <span class="p">{</span>
            <span class="n">result</span> <span class="o">:=</span> <span class="n">power</span><span class="p">(</span><span class="nf">mul</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">base</span><span class="p">),</span> <span class="nf">div</span><span class="p">(</span><span class="n">exponent</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
            <span class="k">switch</span> <span class="nf">mod</span><span class="p">(</span><span class="n">exponent</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                <span class="k">case</span> <span class="mi">1</span> <span class="p">{</span> <span class="n">result</span> <span class="o">:=</span> <span class="nf">mul</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span> <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="specification-of-yul">
<h3>Specification of Yul<a class="headerlink" href="#specification-of-yul" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>This chapter describes Yul code formally. Yul code is usually placed inside Yul objects,
which are explained in their own chapter.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Block = &#39;{&#39; Statement* &#39;}&#39;
Statement =
    Block |
    FunctionDefinition |
    VariableDeclaration |
    Assignment |
    If |
    Expression |
    Switch |
    ForLoop |
    BreakContinue |
    Leave
FunctionDefinition =
    &#39;function&#39; Identifier &#39;(&#39; TypedIdentifierList? &#39;)&#39;
    ( &#39;-&gt;&#39; TypedIdentifierList )? Block
VariableDeclaration =
    &#39;let&#39; TypedIdentifierList ( &#39;:=&#39; Expression )?
Assignment =
    IdentifierList &#39;:=&#39; Expression
Expression =
    FunctionCall | Identifier | Literal
If =
    &#39;if&#39; Expression Block
Switch =
    &#39;switch&#39; Expression ( Case+ Default? | Default )
Case =
    &#39;case&#39; Literal Block
Default =
    &#39;default&#39; Block
ForLoop =
    &#39;for&#39; Block Expression Block Block
BreakContinue =
    &#39;break&#39; | &#39;continue&#39;
Leave = &#39;leave&#39;
FunctionCall =
    Identifier &#39;(&#39; ( Expression ( &#39;,&#39; Expression )* )? &#39;)&#39;
Identifier = [a-zA-Z_$] [a-zA-Z_$0-9.]*
IdentifierList = Identifier ( &#39;,&#39; Identifier)*
TypeName = Identifier
TypedIdentifierList = Identifier ( &#39;:&#39; TypeName )? ( &#39;,&#39; Identifier ( &#39;:&#39; TypeName )? )*
Literal =
    (NumberLiteral | StringLiteral | TrueLiteral | FalseLiteral) ( &#39;:&#39; TypeName )?
NumberLiteral = HexNumber | DecimalNumber
StringLiteral = &#39;&quot;&#39; ([^&quot;\r\n\\] | &#39;\\&#39; .)* &#39;&quot;&#39;
TrueLiteral = &#39;true&#39;
FalseLiteral = &#39;false&#39;
HexNumber = &#39;0x&#39; [0-9a-fA-F]+
DecimalNumber = [0-9]+
</pre></div>
</div>
<section id="restrictions-on-the-grammar">
<h4>Restrictions on the Grammar<a class="headerlink" href="#restrictions-on-the-grammar" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Apart from those directly imposed by the grammar, the following
restrictions apply:</p>
<p>Switches must have at least one case (including the default case).
All case values need to have the same type and distinct values.
If all possible values of the expression type are covered, a default case is
not allowed (i.e. a switch with a <code class="docutils literal notranslate"><span class="pre">bool</span></code> expression that has both a
true and a false case do not allow a default case).</p>
<p>Every expression evaluates to zero or more values. Identifiers and Literals
evaluate to exactly
one value and function calls evaluate to a number of values equal to the
number of return variables of the function called.</p>
<p>In variable declarations and assignments, the right-hand-side expression
(if present) has to evaluate to a number of values equal to the number of
variables on the left-hand-side.
This is the only situation where an expression evaluating
to more than one value is allowed.
The same variable name cannot occur more than once in the left-hand-side of
an assignment or variable declaration.</p>
<p>Expressions that are also statements (i.e. at the block level) have to
evaluate to zero values.</p>
<p>In all other situations, expressions have to evaluate to exactly one value.</p>
<p>A <code class="docutils literal notranslate"><span class="pre">continue</span></code> or <code class="docutils literal notranslate"><span class="pre">break</span></code> statement can only be used inside the body of a for-loop, as follows.
Consider the innermost loop that contains the statement.
The loop and the statement must be in the same function, or both must be at the top level.
The statement must be in the loop‚Äôs body block;
it cannot be in the loop‚Äôs initialization block or update block.
It is worth emphasizing that this restriction applies just
to the innermost loop that contains the <code class="docutils literal notranslate"><span class="pre">continue</span></code> or <code class="docutils literal notranslate"><span class="pre">break</span></code> statement:
this innermost loop, and therefore the <code class="docutils literal notranslate"><span class="pre">continue</span></code> or <code class="docutils literal notranslate"><span class="pre">break</span></code> statement,
may appear anywhere in an outer loop, possibly in an outer loop‚Äôs initialization block or update block.
For example, the following is legal,
because the <code class="docutils literal notranslate"><span class="pre">break</span></code> occurs in the body block of the inner loop,
despite also occurring in the update block of the outer loop:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=yul&amp;version=0.8.15&amp;code=Zm9yIHt9IHRydWUgeyBmb3Ige30gdHJ1ZSB7fSB7IGJyZWFrIH0gfQp7Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-yul notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">{}</span> <span class="n">true</span> <span class="p">{</span> <span class="k">for</span> <span class="p">{}</span> <span class="n">true</span> <span class="p">{}</span> <span class="p">{</span> <span class="n">break</span> <span class="p">}</span> <span class="p">}</span>
<span class="p">{</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The condition part of the for-loop has to evaluate to exactly one value.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">leave</span></code> statement can only be used inside a function.</p>
<p>Functions cannot be defined anywhere inside for loop init blocks.</p>
<p>Literals cannot be larger than their type. The largest type defined is 256-bit wide.</p>
<p>During assignments and function calls, the types of the respective values have to match.
There is no implicit type conversion. Type conversion in general can only be achieved
if the dialect provides an appropriate built-in function that takes a value of one
type and returns a value of a different type.</p>
</section>
<section id="scoping-rules">
<h4>Scoping Rules<a class="headerlink" href="#scoping-rules" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Scopes in Yul are tied to Blocks (exceptions are functions and the for loop
as explained below) and all declarations
(<code class="docutils literal notranslate"><span class="pre">FunctionDefinition</span></code>, <code class="docutils literal notranslate"><span class="pre">VariableDeclaration</span></code>)
introduce new identifiers into these scopes.</p>
<p>Identifiers are visible in
the block they are defined in (including all sub-nodes and sub-blocks):
Functions are visible in the whole block (even before their definitions) while
variables are only visible starting from the statement after the <code class="docutils literal notranslate"><span class="pre">VariableDeclaration</span></code>.</p>
<p>In particular,
variables cannot be referenced in the right hand side of their own variable
declaration.
Functions can be referenced already before their declaration (if they are visible).</p>
<p>As an exception to the general scoping rule, the scope of the ‚Äúinit‚Äù part of the for-loop
(the first block) extends across all other parts of the for loop.
This means that variables (and functions) declared in the init part (but not inside a
block inside the init part) are visible in all other parts of the for-loop.</p>
<p>Identifiers declared in the other parts of the for loop respect the regular
syntactical scoping rules.</p>
<p>This means a for-loop of the form <code class="docutils literal notranslate"><span class="pre">for</span> <span class="pre">{</span> <span class="pre">I...</span> <span class="pre">}</span> <span class="pre">C</span> <span class="pre">{</span> <span class="pre">P...</span> <span class="pre">}</span> <span class="pre">{</span> <span class="pre">B...</span> <span class="pre">}</span></code> is equivalent
to <code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">I...</span> <span class="pre">for</span> <span class="pre">{}</span> <span class="pre">C</span> <span class="pre">{</span> <span class="pre">P...</span> <span class="pre">}</span> <span class="pre">{</span> <span class="pre">B...</span> <span class="pre">}</span> <span class="pre">}</span></code>.</p>
<p>The parameters and return parameters of functions are visible in the
function body and their names have to be distinct.</p>
<p>Inside functions, it is not possible to reference a variable that was declared
outside of that function.</p>
<p>Shadowing is disallowed, i.e. you cannot declare an identifier at a point
where another identifier with the same name is also visible, even if it is
not possible to reference it because it was declared outside the current function.</p>
</section>
<section id="formal-specification">
<h4>Formal Specification<a class="headerlink" href="#formal-specification" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>We formally specify Yul by providing an evaluation function E overloaded
on the various nodes of the AST. As builtin functions can have side effects,
E takes two state objects and the AST node and returns two new
state objects and a variable number of other values.
The two state objects are the global state object
(which in the context of the EVM is the memory, storage and state of the
blockchain) and the local state object (the state of local variables, i.e. a
segment of the stack in the EVM).</p>
<p>If the AST node is a statement, E returns the two state objects and a ‚Äúmode‚Äù,
which is used for the <code class="docutils literal notranslate"><span class="pre">break</span></code>, <code class="docutils literal notranslate"><span class="pre">continue</span></code> and <code class="docutils literal notranslate"><span class="pre">leave</span></code> statements.
If the AST node is an expression, E returns the two state objects and
as many values as the expression evaluates to.</p>
<p>The exact nature of the global state is unspecified for this high level
description. The local state <code class="docutils literal notranslate"><span class="pre">L</span></code> is a mapping of identifiers <code class="docutils literal notranslate"><span class="pre">i</span></code> to values <code class="docutils literal notranslate"><span class="pre">v</span></code>,
denoted as <code class="docutils literal notranslate"><span class="pre">L[i]</span> <span class="pre">=</span> <span class="pre">v</span></code>.</p>
<p>For an identifier <code class="docutils literal notranslate"><span class="pre">v</span></code>, let <code class="docutils literal notranslate"><span class="pre">$v</span></code> be the name of the identifier.</p>
<p>We will use a destructuring notation for the AST nodes.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>E(G, L, &lt;{St1, ..., Stn}&gt;: Block) =
    let G1, L1, mode = E(G, L, St1, ..., Stn)
    let L2 be a restriction of L1 to the identifiers of L
    G1, L2, mode
E(G, L, St1, ..., Stn: Statement) =
    if n is zero:
        G, L, regular
    else:
        let G1, L1, mode = E(G, L, St1)
        if mode is regular then
            E(G1, L1, St2, ..., Stn)
        otherwise
            G1, L1, mode
E(G, L, FunctionDefinition) =
    G, L, regular
E(G, L, &lt;let var_1, ..., var_n := rhs&gt;: VariableDeclaration) =
    E(G, L, &lt;var_1, ..., var_n := rhs&gt;: Assignment)
E(G, L, &lt;let var_1, ..., var_n&gt;: VariableDeclaration) =
    let L1 be a copy of L where L1[$var_i] = 0 for i = 1, ..., n
    G, L1, regular
E(G, L, &lt;var_1, ..., var_n := rhs&gt;: Assignment) =
    let G1, L1, v1, ..., vn = E(G, L, rhs)
    let L2 be a copy of L1 where L2[$var_i] = vi for i = 1, ..., n
    G, L2, regular
E(G, L, &lt;for { i1, ..., in } condition post body&gt;: ForLoop) =
    if n &gt;= 1:
        let G1, L, mode = E(G, L, i1, ..., in)
        // mode has to be regular or leave due to the syntactic restrictions
        if mode is leave then
            G1, L1 restricted to variables of L, leave
        otherwise
            let G2, L2, mode = E(G1, L1, for {} condition post body)
            G2, L2 restricted to variables of L, mode
    else:
        let G1, L1, v = E(G, L, condition)
        if v is false:
            G1, L1, regular
        else:
            let G2, L2, mode = E(G1, L, body)
            if mode is break:
                G2, L2, regular
            otherwise if mode is leave:
                G2, L2, leave
            else:
                G3, L3, mode = E(G2, L2, post)
                if mode is leave:
                    G2, L3, leave
                otherwise
                    E(G3, L3, for {} condition post body)
E(G, L, break: BreakContinue) =
    G, L, break
E(G, L, continue: BreakContinue) =
    G, L, continue
E(G, L, leave: Leave) =
    G, L, leave
E(G, L, &lt;if condition body&gt;: If) =
    let G0, L0, v = E(G, L, condition)
    if v is true:
        E(G0, L0, body)
    else:
        G0, L0, regular
E(G, L, &lt;switch condition case l1:t1 st1 ... case ln:tn stn&gt;: Switch) =
    E(G, L, switch condition case l1:t1 st1 ... case ln:tn stn default {})
E(G, L, &lt;switch condition case l1:t1 st1 ... case ln:tn stn default st&#39;&gt;: Switch) =
    let G0, L0, v = E(G, L, condition)
    // i = 1 .. n
    // Evaluate literals, context doesn&#39;t matter
    let _, _, v1 = E(G0, L0, l1)
    ...
    let _, _, vn = E(G0, L0, ln)
    if there exists smallest i such that vi = v:
        E(G0, L0, sti)
    else:
        E(G0, L0, st&#39;)

E(G, L, &lt;name&gt;: Identifier) =
    G, L, L[$name]
E(G, L, &lt;fname(arg1, ..., argn)&gt;: FunctionCall) =
    G1, L1, vn = E(G, L, argn)
    ...
    G(n-1), L(n-1), v2 = E(G(n-2), L(n-2), arg2)
    Gn, Ln, v1 = E(G(n-1), L(n-1), arg1)
    Let &lt;function fname (param1, ..., paramn) -&gt; ret1, ..., retm block&gt;
    be the function of name $fname visible at the point of the call.
    Let L&#39; be a new local state such that
    L&#39;[$parami] = vi and L&#39;[$reti] = 0 for all i.
    Let G&#39;&#39;, L&#39;&#39;, mode = E(Gn, L&#39;, block)
    G&#39;&#39;, Ln, L&#39;&#39;[$ret1], ..., L&#39;&#39;[$retm]
E(G, L, l: StringLiteral) = G, L, str(l),
    where str is the string evaluation function,
    which for the EVM dialect is defined in the section &#39;Literals&#39; above
E(G, L, n: HexNumber) = G, L, hex(n)
    where hex is the hexadecimal evaluation function,
    which turns a sequence of hexadecimal digits into their big endian value
E(G, L, n: DecimalNumber) = G, L, dec(n),
    where dec is the decimal evaluation function,
    which turns a sequence of decimal digits into their big endian value
</pre></div>
</div>
</section>
<section id="evm-dialect">
<span id="opcodes"></span><h4>EVM Dialect<a class="headerlink" href="#evm-dialect" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>The default dialect of Yul currently is the EVM dialect for the currently selected version of the EVM.
with a version of the EVM. The only type available in this dialect
is <code class="docutils literal notranslate"><span class="pre">u256</span></code>, the 256-bit native type of the Ethereum Virtual Machine.
Since it is the default type of this dialect, it can be omitted.</p>
<p>The following table lists all builtin functions
(depending on the EVM version) and provides a short description of the
semantics of the function / opcode.
This document does not want to be a full description of the Ethereum virtual machine.
Please refer to a different document if you are interested in the precise semantics.</p>
<p>Opcodes marked with <code class="docutils literal notranslate"><span class="pre">-</span></code> do not return a result and all others return exactly one value.
Opcodes marked with <code class="docutils literal notranslate"><span class="pre">F</span></code>, <code class="docutils literal notranslate"><span class="pre">H</span></code>, <code class="docutils literal notranslate"><span class="pre">B</span></code>, <code class="docutils literal notranslate"><span class="pre">C</span></code>, <code class="docutils literal notranslate"><span class="pre">I</span></code> and <code class="docutils literal notranslate"><span class="pre">L</span></code> are present since Frontier, Homestead,
Byzantium, Constantinople, Istanbul or London respectively.</p>
<p>In the following, <code class="docutils literal notranslate"><span class="pre">mem[a...b)</span></code> signifies the bytes of memory starting at position <code class="docutils literal notranslate"><span class="pre">a</span></code> up to
but not including position <code class="docutils literal notranslate"><span class="pre">b</span></code> and <code class="docutils literal notranslate"><span class="pre">storage[p]</span></code> signifies the storage contents at slot <code class="docutils literal notranslate"><span class="pre">p</span></code>.</p>
<p>Since Yul manages local variables and control-flow,
opcodes that interfere with these features are not available. This includes
the <code class="docutils literal notranslate"><span class="pre">dup</span></code> and <code class="docutils literal notranslate"><span class="pre">swap</span></code> instructions as well as <code class="docutils literal notranslate"><span class="pre">jump</span></code> instructions, labels and the <code class="docutils literal notranslate"><span class="pre">push</span></code> instructions.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 26%" />
<col style="width: 5%" />
<col style="width: 3%" />
<col style="width: 66%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Instruction</p></th>
<th class="head"></th>
<th class="head"></th>
<th class="head"><p>Explanation</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>stop()</p></td>
<td><p><cite>-</cite></p></td>
<td><p>F</p></td>
<td><p>stop execution, identical to return(0, 0)</p></td>
</tr>
<tr class="row-odd"><td><p>add(x, y)</p></td>
<td></td>
<td><p>F</p></td>
<td><p>x + y</p></td>
</tr>
<tr class="row-even"><td><p>sub(x, y)</p></td>
<td></td>
<td><p>F</p></td>
<td><p>x - y</p></td>
</tr>
<tr class="row-odd"><td><p>mul(x, y)</p></td>
<td></td>
<td><p>F</p></td>
<td><p>x * y</p></td>
</tr>
<tr class="row-even"><td><p>div(x, y)</p></td>
<td></td>
<td><p>F</p></td>
<td><p>x / y or 0 if y == 0</p></td>
</tr>
<tr class="row-odd"><td><p>sdiv(x, y)</p></td>
<td></td>
<td><p>F</p></td>
<td><p>x / y, for signed numbers in two‚Äôs complement, 0 if y == 0</p></td>
</tr>
<tr class="row-even"><td><p>mod(x, y)</p></td>
<td></td>
<td><p>F</p></td>
<td><p>x % y, 0 if y == 0</p></td>
</tr>
<tr class="row-odd"><td><p>smod(x, y)</p></td>
<td></td>
<td><p>F</p></td>
<td><p>x % y, for signed numbers in two‚Äôs complement, 0 if y == 0</p></td>
</tr>
<tr class="row-even"><td><p>exp(x, y)</p></td>
<td></td>
<td><p>F</p></td>
<td><p>x to the power of y</p></td>
</tr>
<tr class="row-odd"><td><p>not(x)</p></td>
<td></td>
<td><p>F</p></td>
<td><p>bitwise ‚Äúnot‚Äù of x (every bit of x is negated)</p></td>
</tr>
<tr class="row-even"><td><p>lt(x, y)</p></td>
<td></td>
<td><p>F</p></td>
<td><p>1 if x &lt; y, 0 otherwise</p></td>
</tr>
<tr class="row-odd"><td><p>gt(x, y)</p></td>
<td></td>
<td><p>F</p></td>
<td><p>1 if x &gt; y, 0 otherwise</p></td>
</tr>
<tr class="row-even"><td><p>slt(x, y)</p></td>
<td></td>
<td><p>F</p></td>
<td><p>1 if x &lt; y, 0 otherwise, for signed numbers in two‚Äôs complement</p></td>
</tr>
<tr class="row-odd"><td><p>sgt(x, y)</p></td>
<td></td>
<td><p>F</p></td>
<td><p>1 if x &gt; y, 0 otherwise, for signed numbers in two‚Äôs complement</p></td>
</tr>
<tr class="row-even"><td><p>eq(x, y)</p></td>
<td></td>
<td><p>F</p></td>
<td><p>1 if x == y, 0 otherwise</p></td>
</tr>
<tr class="row-odd"><td><p>iszero(x)</p></td>
<td></td>
<td><p>F</p></td>
<td><p>1 if x == 0, 0 otherwise</p></td>
</tr>
<tr class="row-even"><td><p>and(x, y)</p></td>
<td></td>
<td><p>F</p></td>
<td><p>bitwise ‚Äúand‚Äù of x and y</p></td>
</tr>
<tr class="row-odd"><td><p>or(x, y)</p></td>
<td></td>
<td><p>F</p></td>
<td><p>bitwise ‚Äúor‚Äù of x and y</p></td>
</tr>
<tr class="row-even"><td><p>xor(x, y)</p></td>
<td></td>
<td><p>F</p></td>
<td><p>bitwise ‚Äúxor‚Äù of x and y</p></td>
</tr>
<tr class="row-odd"><td><p>byte(n, x)</p></td>
<td></td>
<td><p>F</p></td>
<td><p>nth byte of x, where the most significant byte is the 0th byte</p></td>
</tr>
<tr class="row-even"><td><p>shl(x, y)</p></td>
<td></td>
<td><p>C</p></td>
<td><p>logical shift left y by x bits</p></td>
</tr>
<tr class="row-odd"><td><p>shr(x, y)</p></td>
<td></td>
<td><p>C</p></td>
<td><p>logical shift right y by x bits</p></td>
</tr>
<tr class="row-even"><td><p>sar(x, y)</p></td>
<td></td>
<td><p>C</p></td>
<td><p>signed arithmetic shift right y by x bits</p></td>
</tr>
<tr class="row-odd"><td><p>addmod(x, y, m)</p></td>
<td></td>
<td><p>F</p></td>
<td><p>(x + y) % m with arbitrary precision arithmetic, 0 if m == 0</p></td>
</tr>
<tr class="row-even"><td><p>mulmod(x, y, m)</p></td>
<td></td>
<td><p>F</p></td>
<td><p>(x * y) % m with arbitrary precision arithmetic, 0 if m == 0</p></td>
</tr>
<tr class="row-odd"><td><p>signextend(i, x)</p></td>
<td></td>
<td><p>F</p></td>
<td><p>sign extend from (i*8+7)th bit counting from least significant</p></td>
</tr>
<tr class="row-even"><td><p>keccak256(p, n)</p></td>
<td></td>
<td><p>F</p></td>
<td><p>keccak(mem[p‚Ä¶(p+n)))</p></td>
</tr>
<tr class="row-odd"><td><p>pc()</p></td>
<td></td>
<td><p>F</p></td>
<td><p>current position in code</p></td>
</tr>
<tr class="row-even"><td><p>pop(x)</p></td>
<td><p><cite>-</cite></p></td>
<td><p>F</p></td>
<td><p>discard value x</p></td>
</tr>
<tr class="row-odd"><td><p>mload(p)</p></td>
<td></td>
<td><p>F</p></td>
<td><p>mem[p‚Ä¶(p+32))</p></td>
</tr>
<tr class="row-even"><td><p>mstore(p, v)</p></td>
<td><p><cite>-</cite></p></td>
<td><p>F</p></td>
<td><p>mem[p‚Ä¶(p+32)) := v</p></td>
</tr>
<tr class="row-odd"><td><p>mstore8(p, v)</p></td>
<td><p><cite>-</cite></p></td>
<td><p>F</p></td>
<td><p>mem[p] := v &amp; 0xff (only modifies a single byte)</p></td>
</tr>
<tr class="row-even"><td><p>sload(p)</p></td>
<td></td>
<td><p>F</p></td>
<td><p>storage[p]</p></td>
</tr>
<tr class="row-odd"><td><p>sstore(p, v)</p></td>
<td><p><cite>-</cite></p></td>
<td><p>F</p></td>
<td><p>storage[p] := v</p></td>
</tr>
<tr class="row-even"><td><p>msize()</p></td>
<td></td>
<td><p>F</p></td>
<td><p>size of memory, i.e. largest accessed memory index</p></td>
</tr>
<tr class="row-odd"><td><p>gas()</p></td>
<td></td>
<td><p>F</p></td>
<td><p>gas still available to execution</p></td>
</tr>
<tr class="row-even"><td><p>address()</p></td>
<td></td>
<td><p>F</p></td>
<td><p>address of the current contract / execution context</p></td>
</tr>
<tr class="row-odd"><td><p>balance(a)</p></td>
<td></td>
<td><p>F</p></td>
<td><p>wei balance at address a</p></td>
</tr>
<tr class="row-even"><td><p>selfbalance()</p></td>
<td></td>
<td><p>I</p></td>
<td><p>equivalent to balance(address()), but cheaper</p></td>
</tr>
<tr class="row-odd"><td><p>caller()</p></td>
<td></td>
<td><p>F</p></td>
<td><p>call sender (excluding <code class="docutils literal notranslate"><span class="pre">delegatecall</span></code>)</p></td>
</tr>
<tr class="row-even"><td><p>callvalue()</p></td>
<td></td>
<td><p>F</p></td>
<td><p>wei sent together with the current call</p></td>
</tr>
<tr class="row-odd"><td><p>calldataload(p)</p></td>
<td></td>
<td><p>F</p></td>
<td><p>call data starting from position p (32 bytes)</p></td>
</tr>
<tr class="row-even"><td><p>calldatasize()</p></td>
<td></td>
<td><p>F</p></td>
<td><p>size of call data in bytes</p></td>
</tr>
<tr class="row-odd"><td><p>calldatacopy(t, f, s)</p></td>
<td><p><cite>-</cite></p></td>
<td><p>F</p></td>
<td><p>copy s bytes from calldata at position f to mem at position t</p></td>
</tr>
<tr class="row-even"><td><p>codesize()</p></td>
<td></td>
<td><p>F</p></td>
<td><p>size of the code of the current contract / execution context</p></td>
</tr>
<tr class="row-odd"><td><p>codecopy(t, f, s)</p></td>
<td><p><cite>-</cite></p></td>
<td><p>F</p></td>
<td><p>copy s bytes from code at position f to mem at position t</p></td>
</tr>
<tr class="row-even"><td><p>extcodesize(a)</p></td>
<td></td>
<td><p>F</p></td>
<td><p>size of the code at address a</p></td>
</tr>
<tr class="row-odd"><td><p>extcodecopy(a, t, f, s)</p></td>
<td><p><cite>-</cite></p></td>
<td><p>F</p></td>
<td><p>like codecopy(t, f, s) but take code at address a</p></td>
</tr>
<tr class="row-even"><td><p>returndatasize()</p></td>
<td></td>
<td><p>B</p></td>
<td><p>size of the last returndata</p></td>
</tr>
<tr class="row-odd"><td><p>returndatacopy(t, f, s)</p></td>
<td><p><cite>-</cite></p></td>
<td><p>B</p></td>
<td><p>copy s bytes from returndata at position f to mem at position t</p></td>
</tr>
<tr class="row-even"><td><p>extcodehash(a)</p></td>
<td></td>
<td><p>C</p></td>
<td><p>code hash of address a</p></td>
</tr>
<tr class="row-odd"><td><p>create(v, p, n)</p></td>
<td></td>
<td><p>F</p></td>
<td><p>create new contract with code mem[p‚Ä¶(p+n)) and send v wei
and return the new address; returns 0 on error</p></td>
</tr>
<tr class="row-even"><td><p>create2(v, p, n, s)</p></td>
<td></td>
<td><p>C</p></td>
<td><p>create new contract with code mem[p‚Ä¶(p+n)) at address
keccak256(0xff . this . s . keccak256(mem[p‚Ä¶(p+n)))
and send v wei and return the new address, where <code class="docutils literal notranslate"><span class="pre">0xff</span></code> is a
1 byte value, <code class="docutils literal notranslate"><span class="pre">this</span></code> is the current contract‚Äôs address
as a 20 byte value and <code class="docutils literal notranslate"><span class="pre">s</span></code> is a big-endian 256-bit value;
returns 0 on error</p></td>
</tr>
<tr class="row-odd"><td><p>call(g, a, v, in,
insize, out, outsize)</p></td>
<td></td>
<td><p>F</p></td>
<td><p>call contract at address a with input mem[in‚Ä¶(in+insize))
providing g gas and v wei and output area
mem[out‚Ä¶(out+outsize)) returning 0 on error (eg. out of gas)
and 1 on success
<a class="reference internal" href="#yul-call-return-area"><span class="std std-ref">See more</span></a></p></td>
</tr>
<tr class="row-even"><td><p>callcode(g, a, v, in,
insize, out, outsize)</p></td>
<td></td>
<td><p>F</p></td>
<td><p>identical to <code class="docutils literal notranslate"><span class="pre">call</span></code> but only use the code from a and stay
in the context of the current contract otherwise
<a class="reference internal" href="#yul-call-return-area"><span class="std std-ref">See more</span></a></p></td>
</tr>
<tr class="row-odd"><td><p>delegatecall(g, a, in,
insize, out, outsize)</p></td>
<td></td>
<td><p>H</p></td>
<td><p>identical to <code class="docutils literal notranslate"><span class="pre">callcode</span></code> but also keep <code class="docutils literal notranslate"><span class="pre">caller</span></code>
and <code class="docutils literal notranslate"><span class="pre">callvalue</span></code>
<a class="reference internal" href="#yul-call-return-area"><span class="std std-ref">See more</span></a></p></td>
</tr>
<tr class="row-even"><td><p>staticcall(g, a, in,
insize, out, outsize)</p></td>
<td></td>
<td><p>B</p></td>
<td><p>identical to <code class="docutils literal notranslate"><span class="pre">call(g,</span> <span class="pre">a,</span> <span class="pre">0,</span> <span class="pre">in,</span> <span class="pre">insize,</span> <span class="pre">out,</span> <span class="pre">outsize)</span></code> but do
not allow state modifications
<a class="reference internal" href="#yul-call-return-area"><span class="std std-ref">See more</span></a></p></td>
</tr>
<tr class="row-odd"><td><p>return(p, s)</p></td>
<td><p><cite>-</cite></p></td>
<td><p>F</p></td>
<td><p>end execution, return data mem[p‚Ä¶(p+s))</p></td>
</tr>
<tr class="row-even"><td><p>revert(p, s)</p></td>
<td><p><cite>-</cite></p></td>
<td><p>B</p></td>
<td><p>end execution, revert state changes, return data mem[p‚Ä¶(p+s))</p></td>
</tr>
<tr class="row-odd"><td><p>selfdestruct(a)</p></td>
<td><p><cite>-</cite></p></td>
<td><p>F</p></td>
<td><p>end execution, destroy current contract and send funds to a</p></td>
</tr>
<tr class="row-even"><td><p>invalid()</p></td>
<td><p><cite>-</cite></p></td>
<td><p>F</p></td>
<td><p>end execution with invalid instruction</p></td>
</tr>
<tr class="row-odd"><td><p>log0(p, s)</p></td>
<td><p><cite>-</cite></p></td>
<td><p>F</p></td>
<td><p>log without topics and data mem[p‚Ä¶(p+s))</p></td>
</tr>
<tr class="row-even"><td><p>log1(p, s, t1)</p></td>
<td><p><cite>-</cite></p></td>
<td><p>F</p></td>
<td><p>log with topic t1 and data mem[p‚Ä¶(p+s))</p></td>
</tr>
<tr class="row-odd"><td><p>log2(p, s, t1, t2)</p></td>
<td><p><cite>-</cite></p></td>
<td><p>F</p></td>
<td><p>log with topics t1, t2 and data mem[p‚Ä¶(p+s))</p></td>
</tr>
<tr class="row-even"><td><p>log3(p, s, t1, t2, t3)</p></td>
<td><p><cite>-</cite></p></td>
<td><p>F</p></td>
<td><p>log with topics t1, t2, t3 and data mem[p‚Ä¶(p+s))</p></td>
</tr>
<tr class="row-odd"><td><p>log4(p, s, t1, t2, t3,
t4)</p></td>
<td><p><cite>-</cite></p></td>
<td><p>F</p></td>
<td><p>log with topics t1, t2, t3, t4 and data mem[p‚Ä¶(p+s))</p></td>
</tr>
<tr class="row-even"><td><p>chainid()</p></td>
<td></td>
<td><p>I</p></td>
<td><p>ID of the executing chain (EIP-1344)</p></td>
</tr>
<tr class="row-odd"><td><p>basefee()</p></td>
<td></td>
<td><p>L</p></td>
<td><p>current block‚Äôs base fee (EIP-3198 and EIP-1559)</p></td>
</tr>
<tr class="row-even"><td><p>origin()</p></td>
<td></td>
<td><p>F</p></td>
<td><p>transaction sender</p></td>
</tr>
<tr class="row-odd"><td><p>gasprice()</p></td>
<td></td>
<td><p>F</p></td>
<td><p>gas price of the transaction</p></td>
</tr>
<tr class="row-even"><td><p>blockhash(b)</p></td>
<td></td>
<td><p>F</p></td>
<td><p>hash of block nr b - only for last 256 blocks excluding current</p></td>
</tr>
<tr class="row-odd"><td><p>coinbase()</p></td>
<td></td>
<td><p>F</p></td>
<td><p>current mining beneficiary</p></td>
</tr>
<tr class="row-even"><td><p>timestamp()</p></td>
<td></td>
<td><p>F</p></td>
<td><p>timestamp of the current block in seconds since the epoch</p></td>
</tr>
<tr class="row-odd"><td><p>number()</p></td>
<td></td>
<td><p>F</p></td>
<td><p>current block number</p></td>
</tr>
<tr class="row-even"><td><p>difficulty()</p></td>
<td></td>
<td><p>F</p></td>
<td><p>difficulty of the current block</p></td>
</tr>
<tr class="row-odd"><td><p>gaslimit()</p></td>
<td></td>
<td><p>F</p></td>
<td><p>block gas limit of the current block</p></td>
</tr>
</tbody>
</table>
<div class="admonition note" id="yul-call-return-area">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">call*</span></code> instructions use the <code class="docutils literal notranslate"><span class="pre">out</span></code> and <code class="docutils literal notranslate"><span class="pre">outsize</span></code> parameters to define an area in memory where
the return or failure data is placed. This area is written to depending on how many bytes the called contract returns.
If it returns more data, only the first <code class="docutils literal notranslate"><span class="pre">outsize</span></code> bytes are written. You can access the rest of the data
using the <code class="docutils literal notranslate"><span class="pre">returndatacopy</span></code> opcode. If it returns less data, then the remaining bytes are not touched at all.
You need to use the <code class="docutils literal notranslate"><span class="pre">returndatasize</span></code> opcode to check which part of this memory area contains the return data.
The remaining bytes will retain their values as of before the call.</p>
</div>
<p>In some internal dialects, there are additional functions:</p>
<section id="datasize-dataoffset-datacopy">
<h5>datasize, dataoffset, datacopy<a class="headerlink" href="#datasize-dataoffset-datacopy" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>The functions <code class="docutils literal notranslate"><span class="pre">datasize(x)</span></code>, <code class="docutils literal notranslate"><span class="pre">dataoffset(x)</span></code> and <code class="docutils literal notranslate"><span class="pre">datacopy(t,</span> <span class="pre">f,</span> <span class="pre">l)</span></code>
are used to access other parts of a Yul object.</p>
<p><code class="docutils literal notranslate"><span class="pre">datasize</span></code> and <code class="docutils literal notranslate"><span class="pre">dataoffset</span></code> can only take string literals (the names of other objects)
as arguments and return the size and offset in the data area, respectively.
For the EVM, the <code class="docutils literal notranslate"><span class="pre">datacopy</span></code> function is equivalent to <code class="docutils literal notranslate"><span class="pre">codecopy</span></code>.</p>
</section>
<section id="setimmutable-loadimmutable">
<h5>setimmutable, loadimmutable<a class="headerlink" href="#setimmutable-loadimmutable" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>The functions <code class="docutils literal notranslate"><span class="pre">setimmutable(offset,</span> <span class="pre">&quot;name&quot;,</span> <span class="pre">value)</span></code> and <code class="docutils literal notranslate"><span class="pre">loadimmutable(&quot;name&quot;)</span></code> are
used for the immutable mechanism in Solidity and do not nicely map to pure Yul.
The call to <code class="docutils literal notranslate"><span class="pre">setimmutable(offset,</span> <span class="pre">&quot;name&quot;,</span> <span class="pre">value)</span></code> assumes that the runtime code of the contract
containing the given named immutable was copied to memory at offset <code class="docutils literal notranslate"><span class="pre">offset</span></code> and will write <code class="docutils literal notranslate"><span class="pre">value</span></code> to all
positions in memory (relative to <code class="docutils literal notranslate"><span class="pre">offset</span></code>) that contain the placeholder that was generated for calls
to <code class="docutils literal notranslate"><span class="pre">loadimmutable(&quot;name&quot;)</span></code> in the runtime code.</p>
</section>
<section id="linkersymbol">
<h5>linkersymbol<a class="headerlink" href="#linkersymbol" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>The function <code class="docutils literal notranslate"><span class="pre">linkersymbol(&quot;library_id&quot;)</span></code> is a placeholder for an address literal to be substituted
by the linker.
Its first and only argument must be a string literal and uniquely represents the address to be inserted.
Identifiers can be arbitrary but when the compiler produces Yul code from Solidity sources,
it uses a library name qualified with the name of the source unit that defines that library.
To link the code with a particular library address, the same identifier must be provided to the
<code class="docutils literal notranslate"><span class="pre">--libraries</span></code> option on the command line.</p>
<p>For example this code</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=yul&amp;version=0.8.15&amp;code=bGV0IGEgOj0gbGlua2Vyc3ltYm9sKCJmaWxlLnNvbDpNYXRoIik="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-yul notranslate"><div class="highlight"><pre><span></span><span class="ow">let</span> <span class="nv">a</span> <span class="o">:=</span> <span class="n">linkersymbol</span><span class="p">(</span><span class="s">&quot;file.sol:Math&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>is equivalent to</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=yul&amp;version=0.8.15&amp;code=bGV0IGEgOj0gMHgxMjM0NTY3ODkwMTIzNDU2Nzg5MDEyMzQ1Njc4OTAxMjM0NTY3ODkw"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-yul notranslate"><div class="highlight"><pre><span></span><span class="ow">let</span> <span class="nv">a</span> <span class="o">:=</span> <span class="mh">0x1234567890123456789012345678901234567890</span>
</pre></div>
</div>
<p>when the linker is invoked with <code class="docutils literal notranslate"><span class="pre">--libraries</span> <span class="pre">&quot;file.sol:Math=0x1234567890123456789012345678901234567890</span></code>
option.</p>
<p>See <a class="reference internal" href="index.html#commandline-compiler"><span class="std std-ref">Using the Commandline Compiler</span></a> for details about the Solidity linker.</p>
</section>
<section id="memoryguard">
<h5>memoryguard<a class="headerlink" href="#memoryguard" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>This function is available in the EVM dialect with objects. The caller of
<code class="docutils literal notranslate"><span class="pre">let</span> <span class="pre">ptr</span> <span class="pre">:=</span> <span class="pre">memoryguard(size)</span></code> (where <code class="docutils literal notranslate"><span class="pre">size</span></code> has to be a literal number)
promises that they only use memory in either the range <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">size)</span></code> or the
unbounded range starting at <code class="docutils literal notranslate"><span class="pre">ptr</span></code>.</p>
<p>Since the presence of a <code class="docutils literal notranslate"><span class="pre">memoryguard</span></code> call indicates that all memory access
adheres to this restriction, it allows the optimizer to perform additional
optimization steps, for example the stack limit evader, which attempts to move
stack variables that would otherwise be unreachable to memory.</p>
<p>The Yul optimizer promises to only use the memory range <code class="docutils literal notranslate"><span class="pre">[size,</span> <span class="pre">ptr)</span></code> for its purposes.
If the optimizer does not need to reserve any memory, it holds that <code class="docutils literal notranslate"><span class="pre">ptr</span> <span class="pre">==</span> <span class="pre">size</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">memoryguard</span></code> can be called multiple times, but needs to have the same literal as argument
within one Yul subobject. If at least one <code class="docutils literal notranslate"><span class="pre">memoryguard</span></code> call is found in a subobject,
the additional optimiser steps will be run on it.</p>
</section>
<section id="verbatim">
<span id="yul-verbatim"></span><h5>verbatim<a class="headerlink" href="#verbatim" title="Permalink to this heading">ÔÉÅ</a></h5>
<p>The set of <code class="docutils literal notranslate"><span class="pre">verbatim...</span></code> builtin functions lets you create bytecode for opcodes
that are not known to the Yul compiler. It also allows you to create
bytecode sequences that will not be modified by the optimizer.</p>
<p>The functions are <code class="docutils literal notranslate"><span class="pre">verbatim_&lt;n&gt;i_&lt;m&gt;o(&quot;&lt;data&gt;&quot;,</span> <span class="pre">...)</span></code>, where</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">n</span></code> is a decimal between 0 and 99 that specifies the number of input stack slots / variables</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">m</span></code> is a decimal between 0 and 99 that specifies the number of output stack slots / variables</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">data</span></code> is a string literal that contains the sequence of bytes</p></li>
</ul>
<p>If you for example want to define a function that multiplies the input
by two, without the optimizer touching the constant two, you can use</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=yul&amp;version=0.8.15&amp;code=bGV0IHggOj0gY2FsbGRhdGFsb2FkKDApCmxldCBkb3VibGUgOj0gdmVyYmF0aW1fMWlfMW8oaGV4IjYwMDIwMiIsIHgp"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-yul notranslate"><div class="highlight"><pre><span></span><span class="ow">let</span> <span class="nv">x</span> <span class="o">:=</span> <span class="nf">calldataload</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="ow">let</span> <span class="nv">double</span> <span class="o">:=</span> <span class="n">verbatim_1i_1o</span><span class="p">(</span><span class="s">hex&quot;600202&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
<p>This code will result in a <code class="docutils literal notranslate"><span class="pre">dup1</span></code> opcode to retrieve <code class="docutils literal notranslate"><span class="pre">x</span></code>
(the optimizer might directly re-use result of the
<code class="docutils literal notranslate"><span class="pre">calldataload</span></code> opcode, though)
directly followed by <code class="docutils literal notranslate"><span class="pre">600202</span></code>. The code is assumed to
consume the copied value of <code class="docutils literal notranslate"><span class="pre">x</span></code> and produce the result
on the top of the stack. The compiler then generates code
to allocate a stack slot for <code class="docutils literal notranslate"><span class="pre">double</span></code> and store the result there.</p>
<p>As with all opcodes, the arguments are arranged on the stack
with the leftmost argument on the top, while the return values
are assumed to be laid out such that the rightmost variable is
at the top of the stack.</p>
<p>Since <code class="docutils literal notranslate"><span class="pre">verbatim</span></code> can be used to generate arbitrary opcodes
or even opcodes unknown to the Solidity compiler, care has to be taken
when using <code class="docutils literal notranslate"><span class="pre">verbatim</span></code> together with the optimizer. Even when the
optimizer is switched off, the code generator has to determine
the stack layout, which means that e.g. using <code class="docutils literal notranslate"><span class="pre">verbatim</span></code> to modify
the stack height can lead to undefined behaviour.</p>
<p>The following is a non-exhaustive list of restrictions on
verbatim bytecode that are not checked by
the compiler. Violations of these restrictions can result in
undefined behaviour.</p>
<ul class="simple">
<li><p>Control-flow should not jump into or out of verbatim blocks,
but it can jump within the same verbatim block.</p></li>
<li><p>Stack contents apart from the input and output parameters
should not be accessed.</p></li>
<li><p>The stack height difference should be exactly <code class="docutils literal notranslate"><span class="pre">m</span> <span class="pre">-</span> <span class="pre">n</span></code>
(output slots minus input slots).</p></li>
<li><p>Verbatim bytecode cannot make any assumptions about the
surrounding bytecode. All required parameters have to be
passed in as stack variables.</p></li>
</ul>
<p>The optimizer does not analyze verbatim bytecode and always
assumes that it modifies all aspects of state and thus can only
do very few optimizations across <code class="docutils literal notranslate"><span class="pre">verbatim</span></code> function calls.</p>
<p>The optimizer treats verbatim bytecode as an opaque block of code.
It will not split it but might move, duplicate
or combine it with identical verbatim bytecode blocks.
If a verbatim bytecode block is unreachable by the control-flow,
it can be removed.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>During discussions about whether or not EVM improvements
might break existing smart contracts, features inside <code class="docutils literal notranslate"><span class="pre">verbatim</span></code>
cannot receive the same consideration as those used by the Solidity
compiler itself.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To avoid confusion, all identifiers starting with the string <code class="docutils literal notranslate"><span class="pre">verbatim</span></code> are reserved
and cannot be used for user-defined identifiers.</p>
</div>
</section>
</section>
</section>
<section id="specification-of-yul-object">
<span id="yul-object"></span><h3>Specification of Yul Object<a class="headerlink" href="#specification-of-yul-object" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Yul objects are used to group named code and data sections.
The functions <code class="docutils literal notranslate"><span class="pre">datasize</span></code>, <code class="docutils literal notranslate"><span class="pre">dataoffset</span></code> and <code class="docutils literal notranslate"><span class="pre">datacopy</span></code>
can be used to access these sections from within code.
Hex strings can be used to specify data in hex encoding,
regular strings in native encoding. For code,
<code class="docutils literal notranslate"><span class="pre">datacopy</span></code> will access its assembled binary representation.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Object = &#39;object&#39; StringLiteral &#39;{&#39; Code ( Object | Data )* &#39;}&#39;
Code = &#39;code&#39; Block
Data = &#39;data&#39; StringLiteral ( HexLiteral | StringLiteral )
HexLiteral = &#39;hex&#39; (&#39;&quot;&#39; ([0-9a-fA-F]{2})* &#39;&quot;&#39; | &#39;\&#39;&#39; ([0-9a-fA-F]{2})* &#39;\&#39;&#39;)
StringLiteral = &#39;&quot;&#39; ([^&quot;\r\n\\] | &#39;\\&#39; .)* &#39;&quot;&#39;
</pre></div>
</div>
<p>Above, <code class="docutils literal notranslate"><span class="pre">Block</span></code> refers to <code class="docutils literal notranslate"><span class="pre">Block</span></code> in the Yul code grammar explained in the previous chapter.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>An object with a name that ends in <code class="docutils literal notranslate"><span class="pre">_deployed</span></code> is treated as deployed code by the Yul optimizer.
The only consequence of this is a different gas cost heuristic in the optimizer.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Data objects or sub-objects whose names contain a <code class="docutils literal notranslate"><span class="pre">.</span></code> can be defined
but it is not possible to access them through <code class="docutils literal notranslate"><span class="pre">datasize</span></code>,
<code class="docutils literal notranslate"><span class="pre">dataoffset</span></code> or <code class="docutils literal notranslate"><span class="pre">datacopy</span></code> because <code class="docutils literal notranslate"><span class="pre">.</span></code> is used as a separator
to access objects inside another object.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The data object called <code class="docutils literal notranslate"><span class="pre">&quot;.metadata&quot;</span></code> has a special meaning:
It cannot be accessed from code and is always appended to the very end of the
bytecode, regardless of its position in the object.</p>
<p>Other data objects with special significance might be added in the
future, but their names will always start with a <code class="docutils literal notranslate"><span class="pre">.</span></code>.</p>
</div>
<p>An example Yul Object is shown below:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=yul&amp;version=0.8.15&amp;code=Ly8gQSBjb250cmFjdCBjb25zaXN0cyBvZiBhIHNpbmdsZSBvYmplY3Qgd2l0aCBzdWItb2JqZWN0cyByZXByZXNlbnRpbmcKLy8gdGhlIGNvZGUgdG8gYmUgZGVwbG95ZWQgb3Igb3RoZXIgY29udHJhY3RzIGl0IGNhbiBjcmVhdGUuCi8vIFRoZSBzaW5nbGUgImNvZGUiIG5vZGUgaXMgdGhlIGV4ZWN1dGFibGUgY29kZSBvZiB0aGUgb2JqZWN0LgovLyBFdmVyeSAob3RoZXIpIG5hbWVkIG9iamVjdCBvciBkYXRhIHNlY3Rpb24gaXMgc2VyaWFsaXplZCBhbmQKLy8gbWFkZSBhY2Nlc3NpYmxlIHRvIHRoZSBzcGVjaWFsIGJ1aWx0LWluIGZ1bmN0aW9ucyBkYXRhY29weSAvIGRhdGFvZmZzZXQgLyBkYXRhc2l6ZQovLyBUaGUgY3VycmVudCBvYmplY3QsIHN1Yi1vYmplY3RzIGFuZCBkYXRhIGl0ZW1zIGluc2lkZSB0aGUgY3VycmVudCBvYmplY3QKLy8gYXJlIGluIHNjb3BlLgpvYmplY3QgIkNvbnRyYWN0MSIgewogICAgLy8gVGhpcyBpcyB0aGUgY29uc3RydWN0b3IgY29kZSBvZiB0aGUgY29udHJhY3QuCiAgICBjb2RlIHsKICAgICAgICBmdW5jdGlvbiBhbGxvY2F0ZShzaXplKSAtPiBwdHIgewogICAgICAgICAgICBwdHIgOj0gbWxvYWQoMHg0MCkKICAgICAgICAgICAgaWYgaXN6ZXJvKHB0cikgeyBwdHIgOj0gMHg2MCB9CiAgICAgICAgICAgIG1zdG9yZSgweDQwLCBhZGQocHRyLCBzaXplKSkKICAgICAgICB9CgogICAgICAgIC8vIGZpcnN0IGNyZWF0ZSAiQ29udHJhY3QyIgogICAgICAgIGxldCBzaXplIDo9IGRhdGFzaXplKCJDb250cmFjdDIiKQogICAgICAgIGxldCBvZmZzZXQgOj0gYWxsb2NhdGUoc2l6ZSkKICAgICAgICAvLyBUaGlzIHdpbGwgdHVybiBpbnRvIGNvZGVjb3B5IGZvciBFVk0KICAgICAgICBkYXRhY29weShvZmZzZXQsIGRhdGFvZmZzZXQoIkNvbnRyYWN0MiIpLCBzaXplKQogICAgICAgIC8vIGNvbnN0cnVjdG9yIHBhcmFtZXRlciBpcyBhIHNpbmdsZSBudW1iZXIgMHgxMjM0CiAgICAgICAgbXN0b3JlKGFkZChvZmZzZXQsIHNpemUpLCAweDEyMzQpCiAgICAgICAgcG9wKGNyZWF0ZShvZmZzZXQsIGFkZChzaXplLCAzMiksIDApKQoKICAgICAgICAvLyBub3cgcmV0dXJuIHRoZSBydW50aW1lIG9iamVjdCAodGhlIGN1cnJlbnRseQogICAgICAgIC8vIGV4ZWN1dGluZyBjb2RlIGlzIHRoZSBjb25zdHJ1Y3RvciBjb2RlKQogICAgICAgIHNpemUgOj0gZGF0YXNpemUoIkNvbnRyYWN0MV9kZXBsb3llZCIpCiAgICAgICAgb2Zmc2V0IDo9IGFsbG9jYXRlKHNpemUpCiAgICAgICAgLy8gVGhpcyB3aWxsIHR1cm4gaW50byBhIG1lbW9yeS0+bWVtb3J5IGNvcHkgZm9yIEV3YXNtIGFuZAogICAgICAgIC8vIGEgY29kZWNvcHkgZm9yIEVWTQogICAgICAgIGRhdGFjb3B5KG9mZnNldCwgZGF0YW9mZnNldCgiQ29udHJhY3QxX2RlcGxveWVkIiksIHNpemUpCiAgICAgICAgcmV0dXJuKG9mZnNldCwgc2l6ZSkKICAgIH0KCiAgICBkYXRhICJUYWJsZTIiIGhleCI0MTIzIgoKICAgIG9iamVjdCAiQ29udHJhY3QxX2RlcGxveWVkIiB7CiAgICAgICAgY29kZSB7CiAgICAgICAgICAgIGZ1bmN0aW9uIGFsbG9jYXRlKHNpemUpIC0+IHB0ciB7CiAgICAgICAgICAgICAgICBwdHIgOj0gbWxvYWQoMHg0MCkKICAgICAgICAgICAgICAgIGlmIGlzemVybyhwdHIpIHsgcHRyIDo9IDB4NjAgfQogICAgICAgICAgICAgICAgbXN0b3JlKDB4NDAsIGFkZChwdHIsIHNpemUpKQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBydW50aW1lIGNvZGUKCiAgICAgICAgICAgIG1zdG9yZSgwLCAiSGVsbG8sIFdvcmxkISIpCiAgICAgICAgICAgIHJldHVybigwLCAweDIwKQogICAgICAgIH0KICAgIH0KCiAgICAvLyBFbWJlZGRlZCBvYmplY3QuIFVzZSBjYXNlIGlzIHRoYXQgdGhlIG91dHNpZGUgaXMgYSBmYWN0b3J5IGNvbnRyYWN0LAogICAgLy8gYW5kIENvbnRyYWN0MiBpcyB0aGUgY29kZSB0byBiZSBjcmVhdGVkIGJ5IHRoZSBmYWN0b3J5CiAgICBvYmplY3QgIkNvbnRyYWN0MiIgewogICAgICAgIGNvZGUgewogICAgICAgICAgICAvLyBjb2RlIGhlcmUgLi4uCiAgICAgICAgfQoKICAgICAgICBvYmplY3QgIkNvbnRyYWN0Ml9kZXBsb3llZCIgewogICAgICAgICAgICBjb2RlIHsKICAgICAgICAgICAgICAgIC8vIGNvZGUgaGVyZSAuLi4KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZGF0YSAiVGFibGUxIiBoZXgiNDEyMyIKICAgIH0KfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-yul notranslate"><div class="highlight"><pre><span></span><span class="c1">// A contract consists of a single object with sub-objects representing</span>
<span class="c1">// the code to be deployed or other contracts it can create.</span>
<span class="c1">// The single &quot;code&quot; node is the executable code of the object.</span>
<span class="c1">// Every (other) named object or data section is serialized and</span>
<span class="c1">// made accessible to the special built-in functions datacopy / dataoffset / datasize</span>
<span class="c1">// The current object, sub-objects and data items inside the current object</span>
<span class="c1">// are in scope.</span>
<span class="k">object</span> <span class="s">&quot;Contract1&quot;</span> <span class="p">{</span>
    <span class="c1">// This is the constructor code of the contract.</span>
    <span class="k">code</span> <span class="p">{</span>
        <span class="k">function</span> <span class="n">allocate</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ptr</span> <span class="p">{</span>
            <span class="n">ptr</span> <span class="o">:=</span> <span class="nf">mload</span><span class="p">(</span><span class="mh">0x40</span><span class="p">)</span>
            <span class="k">if</span> <span class="nf">iszero</span><span class="p">(</span><span class="n">ptr</span><span class="p">)</span> <span class="p">{</span> <span class="n">ptr</span> <span class="o">:=</span> <span class="mh">0x60</span> <span class="p">}</span>
            <span class="nf">mstore</span><span class="p">(</span><span class="mh">0x40</span><span class="p">,</span> <span class="nf">add</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span> <span class="n">size</span><span class="p">))</span>
        <span class="p">}</span>

        <span class="c1">// first create &quot;Contract2&quot;</span>
        <span class="ow">let</span> <span class="nv">size</span> <span class="o">:=</span> <span class="k k-Function">datasize</span><span class="p">(</span><span class="s">&quot;Contract2&quot;</span><span class="p">)</span>
        <span class="ow">let</span> <span class="nv">offset</span> <span class="o">:=</span> <span class="n">allocate</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="c1">// This will turn into codecopy for EVM</span>
        <span class="k k-Function">datacopy</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="k k-Function">dataoffset</span><span class="p">(</span><span class="s">&quot;Contract2&quot;</span><span class="p">),</span> <span class="n">size</span><span class="p">)</span>
        <span class="c1">// constructor parameter is a single number 0x1234</span>
        <span class="nf">mstore</span><span class="p">(</span><span class="nf">add</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">size</span><span class="p">),</span> <span class="mh">0x1234</span><span class="p">)</span>
        <span class="nf">pop</span><span class="p">(</span><span class="nf">create</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="nf">add</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span> <span class="mi">0</span><span class="p">))</span>

        <span class="c1">// now return the runtime object (the currently</span>
        <span class="c1">// executing code is the constructor code)</span>
        <span class="n">size</span> <span class="o">:=</span> <span class="k k-Function">datasize</span><span class="p">(</span><span class="s">&quot;Contract1_deployed&quot;</span><span class="p">)</span>
        <span class="n">offset</span> <span class="o">:=</span> <span class="n">allocate</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="c1">// This will turn into a memory-&gt;memory copy for Ewasm and</span>
        <span class="c1">// a codecopy for EVM</span>
        <span class="k k-Function">datacopy</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="k k-Function">dataoffset</span><span class="p">(</span><span class="s">&quot;Contract1_deployed&quot;</span><span class="p">),</span> <span class="n">size</span><span class="p">)</span>
        <span class="nf">return</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">data</span> <span class="s">&quot;Table2&quot;</span> <span class="s">hex&quot;4123&quot;</span>

    <span class="k">object</span> <span class="s">&quot;Contract1_deployed&quot;</span> <span class="p">{</span>
        <span class="k">code</span> <span class="p">{</span>
            <span class="k">function</span> <span class="n">allocate</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ptr</span> <span class="p">{</span>
                <span class="n">ptr</span> <span class="o">:=</span> <span class="nf">mload</span><span class="p">(</span><span class="mh">0x40</span><span class="p">)</span>
                <span class="k">if</span> <span class="nf">iszero</span><span class="p">(</span><span class="n">ptr</span><span class="p">)</span> <span class="p">{</span> <span class="n">ptr</span> <span class="o">:=</span> <span class="mh">0x60</span> <span class="p">}</span>
                <span class="nf">mstore</span><span class="p">(</span><span class="mh">0x40</span><span class="p">,</span> <span class="nf">add</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span> <span class="n">size</span><span class="p">))</span>
            <span class="p">}</span>

            <span class="c1">// runtime code</span>

            <span class="nf">mstore</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Hello, World!&quot;</span><span class="p">)</span>
            <span class="nf">return</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// Embedded object. Use case is that the outside is a factory contract,</span>
    <span class="c1">// and Contract2 is the code to be created by the factory</span>
    <span class="k">object</span> <span class="s">&quot;Contract2&quot;</span> <span class="p">{</span>
        <span class="k">code</span> <span class="p">{</span>
            <span class="c1">// code here ...</span>
        <span class="p">}</span>

        <span class="k">object</span> <span class="s">&quot;Contract2_deployed&quot;</span> <span class="p">{</span>
            <span class="k">code</span> <span class="p">{</span>
                <span class="c1">// code here ...</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">data</span> <span class="s">&quot;Table1&quot;</span> <span class="s">hex&quot;4123&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="yul-optimizer">
<h3>Yul Optimizer<a class="headerlink" href="#yul-optimizer" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>The Yul optimizer operates on Yul code and uses the same language for input, output and
intermediate states. This allows for easy debugging and verification of the optimizer.</p>
<p>Please refer to the general <a class="reference internal" href="index.html#optimizer"><span class="std std-ref">optimizer documentation</span></a>
for more details about the different optimization stages and how to use the optimizer.</p>
<p>If you want to use Solidity in stand-alone Yul mode, you activate the optimizer using <code class="docutils literal notranslate"><span class="pre">--optimize</span></code>
and optionally specify the <a class="reference internal" href="index.html#optimizer-parameter-runs"><span class="std std-ref">expected number of contract executions</span></a> with
<code class="docutils literal notranslate"><span class="pre">--optimize-runs</span></code>:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>solc --strict-assembly --optimize --optimize-runs <span class="m">200</span>
</pre></div>
</div>
<p>In Solidity mode, the Yul optimizer is activated together with the regular optimizer.</p>
<section id="optimization-step-sequence">
<span id="id2"></span><h4>Optimization Step Sequence<a class="headerlink" href="#optimization-step-sequence" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>By default the Yul optimizer applies its predefined sequence of optimization steps to the generated assembly.
You can override this sequence and supply your own using the <code class="docutils literal notranslate"><span class="pre">--yul-optimizations</span></code> option:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>solc --optimize --ir-optimized --yul-optimizations <span class="s1">&#39;dhfoD[xarrscLMcCTU]uljmul&#39;</span>
</pre></div>
</div>
<p>The order of steps is significant and affects the quality of the output.
Moreover, applying a step may uncover new optimization opportunities for others that were already
applied so repeating steps is often beneficial.
By enclosing part of the sequence in square brackets (<code class="docutils literal notranslate"><span class="pre">[]</span></code>) you tell the optimizer to repeatedly
apply that part until it no longer improves the size of the resulting assembly.
You can use brackets multiple times in a single sequence but they cannot be nested.</p>
<p>The following optimization steps are available:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 19%" />
<col style="width: 81%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Abbreviation</p></th>
<th class="head"><p>Full name</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">f</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">BlockFlattener</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">l</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">CircularReferencesPruner</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">c</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">CommonSubexpressionEliminator</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">C</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ConditionalSimplifier</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">U</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ConditionalUnsimplifier</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">n</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ControlFlowSimplifier</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">D</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">DeadCodeEliminator</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">v</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">EquivalentFunctionCombiner</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">e</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ExpressionInliner</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">j</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ExpressionJoiner</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">s</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ExpressionSimplifier</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">x</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ExpressionSplitter</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">I</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ForLoopConditionIntoBody</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">O</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ForLoopConditionOutOfBody</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">o</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ForLoopInitRewriter</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">i</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">FullInliner</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">g</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">FunctionGrouper</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">h</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">FunctionHoister</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">F</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">FunctionSpecializer</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">T</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">LiteralRematerialiser</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">L</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">LoadResolver</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">M</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">LoopInvariantCodeMotion</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">r</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">RedundantAssignEliminator</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">R</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ReasoningBasedSimplifier</span></code> - highly experimental</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">m</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Rematerialiser</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">V</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">SSAReverser</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">a</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">SSATransform</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">t</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">StructuralSimplifier</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">u</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">UnusedPruner</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">p</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">UnusedFunctionParameterPruner</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">d</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">VarDeclInitializer</span></code></p></td>
</tr>
</tbody>
</table>
<p>Some steps depend on properties ensured by <code class="docutils literal notranslate"><span class="pre">BlockFlattener</span></code>, <code class="docutils literal notranslate"><span class="pre">FunctionGrouper</span></code>, <code class="docutils literal notranslate"><span class="pre">ForLoopInitRewriter</span></code>.
For this reason the Yul optimizer always applies them before applying any steps supplied by the user.</p>
<p>The ReasoningBasedSimplifier is an optimizer step that is currently not enabled
in the default set of steps. It uses an SMT solver to simplify arithmetic expressions
and boolean conditions. It has not received thorough testing or validation yet and can produce
non-reproducible results, so please use with care!</p>
</section>
</section>
<section id="complete-erc20-example">
<span id="erc20yul"></span><h3>Complete ERC20 Example<a class="headerlink" href="#complete-erc20-example" title="Permalink to this heading">ÔÉÅ</a></h3>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=yul&amp;version=0.8.15&amp;code=b2JqZWN0ICJUb2tlbiIgewogICAgY29kZSB7CiAgICAgICAgLy8gU3RvcmUgdGhlIGNyZWF0b3IgaW4gc2xvdCB6ZXJvLgogICAgICAgIHNzdG9yZSgwLCBjYWxsZXIoKSkKCiAgICAgICAgLy8gRGVwbG95IHRoZSBjb250cmFjdAogICAgICAgIGRhdGFjb3B5KDAsIGRhdGFvZmZzZXQoInJ1bnRpbWUiKSwgZGF0YXNpemUoInJ1bnRpbWUiKSkKICAgICAgICByZXR1cm4oMCwgZGF0YXNpemUoInJ1bnRpbWUiKSkKICAgIH0KICAgIG9iamVjdCAicnVudGltZSIgewogICAgICAgIGNvZGUgewogICAgICAgICAgICAvLyBQcm90ZWN0aW9uIGFnYWluc3Qgc2VuZGluZyBFdGhlcgogICAgICAgICAgICByZXF1aXJlKGlzemVybyhjYWxsdmFsdWUoKSkpCgogICAgICAgICAgICAvLyBEaXNwYXRjaGVyCiAgICAgICAgICAgIHN3aXRjaCBzZWxlY3RvcigpCiAgICAgICAgICAgIGNhc2UgMHg3MGEwODIzMSAvKiAiYmFsYW5jZU9mKGFkZHJlc3MpIiAqLyB7CiAgICAgICAgICAgICAgICByZXR1cm5VaW50KGJhbGFuY2VPZihkZWNvZGVBc0FkZHJlc3MoMCkpKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgMHgxODE2MGRkZCAvKiAidG90YWxTdXBwbHkoKSIgKi8gewogICAgICAgICAgICAgICAgcmV0dXJuVWludCh0b3RhbFN1cHBseSgpKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgMHhhOTA1OWNiYiAvKiAidHJhbnNmZXIoYWRkcmVzcyx1aW50MjU2KSIgKi8gewogICAgICAgICAgICAgICAgdHJhbnNmZXIoZGVjb2RlQXNBZGRyZXNzKDApLCBkZWNvZGVBc1VpbnQoMSkpCiAgICAgICAgICAgICAgICByZXR1cm5UcnVlKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlIDB4MjNiODcyZGQgLyogInRyYW5zZmVyRnJvbShhZGRyZXNzLGFkZHJlc3MsdWludDI1NikiICovIHsKICAgICAgICAgICAgICAgIHRyYW5zZmVyRnJvbShkZWNvZGVBc0FkZHJlc3MoMCksIGRlY29kZUFzQWRkcmVzcygxKSwgZGVjb2RlQXNVaW50KDIpKQogICAgICAgICAgICAgICAgcmV0dXJuVHJ1ZSgpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAweDA5NWVhN2IzIC8qICJhcHByb3ZlKGFkZHJlc3MsdWludDI1NikiICovIHsKICAgICAgICAgICAgICAgIGFwcHJvdmUoZGVjb2RlQXNBZGRyZXNzKDApLCBkZWNvZGVBc1VpbnQoMSkpCiAgICAgICAgICAgICAgICByZXR1cm5UcnVlKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlIDB4ZGQ2MmVkM2UgLyogImFsbG93YW5jZShhZGRyZXNzLGFkZHJlc3MpIiAqLyB7CiAgICAgICAgICAgICAgICByZXR1cm5VaW50KGFsbG93YW5jZShkZWNvZGVBc0FkZHJlc3MoMCksIGRlY29kZUFzQWRkcmVzcygxKSkpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAweDQwYzEwZjE5IC8qICJtaW50KGFkZHJlc3MsdWludDI1NikiICovIHsKICAgICAgICAgICAgICAgIG1pbnQoZGVjb2RlQXNBZGRyZXNzKDApLCBkZWNvZGVBc1VpbnQoMSkpCiAgICAgICAgICAgICAgICByZXR1cm5UcnVlKCkKICAgICAgICAgICAgfQogICAgICAgICAgICBkZWZhdWx0IHsKICAgICAgICAgICAgICAgIHJldmVydCgwLCAwKQogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBtaW50KGFjY291bnQsIGFtb3VudCkgewogICAgICAgICAgICAgICAgcmVxdWlyZShjYWxsZWRCeU93bmVyKCkpCgogICAgICAgICAgICAgICAgbWludFRva2VucyhhbW91bnQpCiAgICAgICAgICAgICAgICBhZGRUb0JhbGFuY2UoYWNjb3VudCwgYW1vdW50KQogICAgICAgICAgICAgICAgZW1pdFRyYW5zZmVyKDAsIGFjY291bnQsIGFtb3VudCkKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiB0cmFuc2Zlcih0bywgYW1vdW50KSB7CiAgICAgICAgICAgICAgICBleGVjdXRlVHJhbnNmZXIoY2FsbGVyKCksIHRvLCBhbW91bnQpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gYXBwcm92ZShzcGVuZGVyLCBhbW91bnQpIHsKICAgICAgICAgICAgICAgIHJldmVydElmWmVyb0FkZHJlc3Moc3BlbmRlcikKICAgICAgICAgICAgICAgIHNldEFsbG93YW5jZShjYWxsZXIoKSwgc3BlbmRlciwgYW1vdW50KQogICAgICAgICAgICAgICAgZW1pdEFwcHJvdmFsKGNhbGxlcigpLCBzcGVuZGVyLCBhbW91bnQpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gdHJhbnNmZXJGcm9tKGZyb20sIHRvLCBhbW91bnQpIHsKICAgICAgICAgICAgICAgIGRlY3JlYXNlQWxsb3dhbmNlQnkoZnJvbSwgY2FsbGVyKCksIGFtb3VudCkKICAgICAgICAgICAgICAgIGV4ZWN1dGVUcmFuc2Zlcihmcm9tLCB0bywgYW1vdW50KQogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBleGVjdXRlVHJhbnNmZXIoZnJvbSwgdG8sIGFtb3VudCkgewogICAgICAgICAgICAgICAgcmV2ZXJ0SWZaZXJvQWRkcmVzcyh0bykKICAgICAgICAgICAgICAgIGRlZHVjdEZyb21CYWxhbmNlKGZyb20sIGFtb3VudCkKICAgICAgICAgICAgICAgIGFkZFRvQmFsYW5jZSh0bywgYW1vdW50KQogICAgICAgICAgICAgICAgZW1pdFRyYW5zZmVyKGZyb20sIHRvLCBhbW91bnQpCiAgICAgICAgICAgIH0KCgogICAgICAgICAgICAvKiAtLS0tLS0tLS0tIGNhbGxkYXRhIGRlY29kaW5nIGZ1bmN0aW9ucyAtLS0tLS0tLS0tLSAqLwogICAgICAgICAgICBmdW5jdGlvbiBzZWxlY3RvcigpIC0+IHMgewogICAgICAgICAgICAgICAgcyA6PSBkaXYoY2FsbGRhdGFsb2FkKDApLCAweDEwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMCkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gZGVjb2RlQXNBZGRyZXNzKG9mZnNldCkgLT4gdiB7CiAgICAgICAgICAgICAgICB2IDo9IGRlY29kZUFzVWludChvZmZzZXQpCiAgICAgICAgICAgICAgICBpZiBpc3plcm8oaXN6ZXJvKGFuZCh2LCBub3QoMHhmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmKSkpKSB7CiAgICAgICAgICAgICAgICAgICAgcmV2ZXJ0KDAsIDApCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gZGVjb2RlQXNVaW50KG9mZnNldCkgLT4gdiB7CiAgICAgICAgICAgICAgICBsZXQgcG9zIDo9IGFkZCg0LCBtdWwob2Zmc2V0LCAweDIwKSkKICAgICAgICAgICAgICAgIGlmIGx0KGNhbGxkYXRhc2l6ZSgpLCBhZGQocG9zLCAweDIwKSkgewogICAgICAgICAgICAgICAgICAgIHJldmVydCgwLCAwKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdiA6PSBjYWxsZGF0YWxvYWQocG9zKQogICAgICAgICAgICB9CiAgICAgICAgICAgIC8qIC0tLS0tLS0tLS0gY2FsbGRhdGEgZW5jb2RpbmcgZnVuY3Rpb25zIC0tLS0tLS0tLS0gKi8KICAgICAgICAgICAgZnVuY3Rpb24gcmV0dXJuVWludCh2KSB7CiAgICAgICAgICAgICAgICBtc3RvcmUoMCwgdikKICAgICAgICAgICAgICAgIHJldHVybigwLCAweDIwKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHJldHVyblRydWUoKSB7CiAgICAgICAgICAgICAgICByZXR1cm5VaW50KDEpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8qIC0tLS0tLS0tIGV2ZW50cyAtLS0tLS0tLS0tICovCiAgICAgICAgICAgIGZ1bmN0aW9uIGVtaXRUcmFuc2Zlcihmcm9tLCB0bywgYW1vdW50KSB7CiAgICAgICAgICAgICAgICBsZXQgc2lnbmF0dXJlSGFzaCA6PSAweGRkZjI1MmFkMWJlMmM4OWI2OWMyYjA2OGZjMzc4ZGFhOTUyYmE3ZjE2M2M0YTExNjI4ZjU1YTRkZjUyM2IzZWYKICAgICAgICAgICAgICAgIGVtaXRFdmVudChzaWduYXR1cmVIYXNoLCBmcm9tLCB0bywgYW1vdW50KQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGVtaXRBcHByb3ZhbChmcm9tLCBzcGVuZGVyLCBhbW91bnQpIHsKICAgICAgICAgICAgICAgIGxldCBzaWduYXR1cmVIYXNoIDo9IDB4OGM1YmUxZTVlYmVjN2Q1YmQxNGY3MTQyN2QxZTg0ZjNkZDAzMTRjMGY3YjIyOTFlNWIyMDBhYzhjN2MzYjkyNQogICAgICAgICAgICAgICAgZW1pdEV2ZW50KHNpZ25hdHVyZUhhc2gsIGZyb20sIHNwZW5kZXIsIGFtb3VudCkKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBlbWl0RXZlbnQoc2lnbmF0dXJlSGFzaCwgaW5kZXhlZDEsIGluZGV4ZWQyLCBub25JbmRleGVkKSB7CiAgICAgICAgICAgICAgICBtc3RvcmUoMCwgbm9uSW5kZXhlZCkKICAgICAgICAgICAgICAgIGxvZzMoMCwgMHgyMCwgc2lnbmF0dXJlSGFzaCwgaW5kZXhlZDEsIGluZGV4ZWQyKQogICAgICAgICAgICB9CgogICAgICAgICAgICAvKiAtLS0tLS0tLSBzdG9yYWdlIGxheW91dCAtLS0tLS0tLS0tICovCiAgICAgICAgICAgIGZ1bmN0aW9uIG93bmVyUG9zKCkgLT4gcCB7IHAgOj0gMCB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHRvdGFsU3VwcGx5UG9zKCkgLT4gcCB7IHAgOj0gMSB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGFjY291bnRUb1N0b3JhZ2VPZmZzZXQoYWNjb3VudCkgLT4gb2Zmc2V0IHsKICAgICAgICAgICAgICAgIG9mZnNldCA6PSBhZGQoMHgxMDAwLCBhY2NvdW50KQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGFsbG93YW5jZVN0b3JhZ2VPZmZzZXQoYWNjb3VudCwgc3BlbmRlcikgLT4gb2Zmc2V0IHsKICAgICAgICAgICAgICAgIG9mZnNldCA6PSBhY2NvdW50VG9TdG9yYWdlT2Zmc2V0KGFjY291bnQpCiAgICAgICAgICAgICAgICBtc3RvcmUoMCwgb2Zmc2V0KQogICAgICAgICAgICAgICAgbXN0b3JlKDB4MjAsIHNwZW5kZXIpCiAgICAgICAgICAgICAgICBvZmZzZXQgOj0ga2VjY2FrMjU2KDAsIDB4NDApCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8qIC0tLS0tLS0tIHN0b3JhZ2UgYWNjZXNzIC0tLS0tLS0tLS0gKi8KICAgICAgICAgICAgZnVuY3Rpb24gb3duZXIoKSAtPiBvIHsKICAgICAgICAgICAgICAgIG8gOj0gc2xvYWQob3duZXJQb3MoKSkKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiB0b3RhbFN1cHBseSgpIC0+IHN1cHBseSB7CiAgICAgICAgICAgICAgICBzdXBwbHkgOj0gc2xvYWQodG90YWxTdXBwbHlQb3MoKSkKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBtaW50VG9rZW5zKGFtb3VudCkgewogICAgICAgICAgICAgICAgc3N0b3JlKHRvdGFsU3VwcGx5UG9zKCksIHNhZmVBZGQodG90YWxTdXBwbHkoKSwgYW1vdW50KSkKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBiYWxhbmNlT2YoYWNjb3VudCkgLT4gYmFsIHsKICAgICAgICAgICAgICAgIGJhbCA6PSBzbG9hZChhY2NvdW50VG9TdG9yYWdlT2Zmc2V0KGFjY291bnQpKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGFkZFRvQmFsYW5jZShhY2NvdW50LCBhbW91bnQpIHsKICAgICAgICAgICAgICAgIGxldCBvZmZzZXQgOj0gYWNjb3VudFRvU3RvcmFnZU9mZnNldChhY2NvdW50KQogICAgICAgICAgICAgICAgc3N0b3JlKG9mZnNldCwgc2FmZUFkZChzbG9hZChvZmZzZXQpLCBhbW91bnQpKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGRlZHVjdEZyb21CYWxhbmNlKGFjY291bnQsIGFtb3VudCkgewogICAgICAgICAgICAgICAgbGV0IG9mZnNldCA6PSBhY2NvdW50VG9TdG9yYWdlT2Zmc2V0KGFjY291bnQpCiAgICAgICAgICAgICAgICBsZXQgYmFsIDo9IHNsb2FkKG9mZnNldCkKICAgICAgICAgICAgICAgIHJlcXVpcmUobHRlKGFtb3VudCwgYmFsKSkKICAgICAgICAgICAgICAgIHNzdG9yZShvZmZzZXQsIHN1YihiYWwsIGFtb3VudCkpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gYWxsb3dhbmNlKGFjY291bnQsIHNwZW5kZXIpIC0+IGFtb3VudCB7CiAgICAgICAgICAgICAgICBhbW91bnQgOj0gc2xvYWQoYWxsb3dhbmNlU3RvcmFnZU9mZnNldChhY2NvdW50LCBzcGVuZGVyKSkKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBzZXRBbGxvd2FuY2UoYWNjb3VudCwgc3BlbmRlciwgYW1vdW50KSB7CiAgICAgICAgICAgICAgICBzc3RvcmUoYWxsb3dhbmNlU3RvcmFnZU9mZnNldChhY2NvdW50LCBzcGVuZGVyKSwgYW1vdW50KQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGRlY3JlYXNlQWxsb3dhbmNlQnkoYWNjb3VudCwgc3BlbmRlciwgYW1vdW50KSB7CiAgICAgICAgICAgICAgICBsZXQgb2Zmc2V0IDo9IGFsbG93YW5jZVN0b3JhZ2VPZmZzZXQoYWNjb3VudCwgc3BlbmRlcikKICAgICAgICAgICAgICAgIGxldCBjdXJyZW50QWxsb3dhbmNlIDo9IHNsb2FkKG9mZnNldCkKICAgICAgICAgICAgICAgIHJlcXVpcmUobHRlKGFtb3VudCwgY3VycmVudEFsbG93YW5jZSkpCiAgICAgICAgICAgICAgICBzc3RvcmUob2Zmc2V0LCBzdWIoY3VycmVudEFsbG93YW5jZSwgYW1vdW50KSkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLyogLS0tLS0tLS0tLSB1dGlsaXR5IGZ1bmN0aW9ucyAtLS0tLS0tLS0tICovCiAgICAgICAgICAgIGZ1bmN0aW9uIGx0ZShhLCBiKSAtPiByIHsKICAgICAgICAgICAgICAgIHIgOj0gaXN6ZXJvKGd0KGEsIGIpKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGd0ZShhLCBiKSAtPiByIHsKICAgICAgICAgICAgICAgIHIgOj0gaXN6ZXJvKGx0KGEsIGIpKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHNhZmVBZGQoYSwgYikgLT4gciB7CiAgICAgICAgICAgICAgICByIDo9IGFkZChhLCBiKQogICAgICAgICAgICAgICAgaWYgb3IobHQociwgYSksIGx0KHIsIGIpKSB7IHJldmVydCgwLCAwKSB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gY2FsbGVkQnlPd25lcigpIC0+IGNibyB7CiAgICAgICAgICAgICAgICBjYm8gOj0gZXEob3duZXIoKSwgY2FsbGVyKCkpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gcmV2ZXJ0SWZaZXJvQWRkcmVzcyhhZGRyKSB7CiAgICAgICAgICAgICAgICByZXF1aXJlKGFkZHIpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gcmVxdWlyZShjb25kaXRpb24pIHsKICAgICAgICAgICAgICAgIGlmIGlzemVybyhjb25kaXRpb24pIHsgcmV2ZXJ0KDAsIDApIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-yul notranslate"><div class="highlight"><pre><span></span><span class="k">object</span> <span class="s">&quot;Token&quot;</span> <span class="p">{</span>
    <span class="k">code</span> <span class="p">{</span>
        <span class="c1">// Store the creator in slot zero.</span>
        <span class="nf">sstore</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nf">caller</span><span class="p">())</span>

        <span class="c1">// Deploy the contract</span>
        <span class="k k-Function">datacopy</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="k k-Function">dataoffset</span><span class="p">(</span><span class="s">&quot;runtime&quot;</span><span class="p">),</span> <span class="k k-Function">datasize</span><span class="p">(</span><span class="s">&quot;runtime&quot;</span><span class="p">))</span>
        <span class="nf">return</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="k k-Function">datasize</span><span class="p">(</span><span class="s">&quot;runtime&quot;</span><span class="p">))</span>
    <span class="p">}</span>
    <span class="k">object</span> <span class="s">&quot;runtime&quot;</span> <span class="p">{</span>
        <span class="k">code</span> <span class="p">{</span>
            <span class="c1">// Protection against sending Ether</span>
            <span class="n">require</span><span class="p">(</span><span class="nf">iszero</span><span class="p">(</span><span class="nf">callvalue</span><span class="p">()))</span>

            <span class="c1">// Dispatcher</span>
            <span class="k">switch</span> <span class="n">selector</span><span class="p">()</span>
            <span class="k">case</span> <span class="mh">0x70a08231</span> <span class="cm">/* &quot;balanceOf(address)&quot; */</span> <span class="p">{</span>
                <span class="n">returnUint</span><span class="p">(</span><span class="n">balanceOf</span><span class="p">(</span><span class="n">decodeAsAddress</span><span class="p">(</span><span class="mi">0</span><span class="p">)))</span>
            <span class="p">}</span>
            <span class="k">case</span> <span class="mh">0x18160ddd</span> <span class="cm">/* &quot;totalSupply()&quot; */</span> <span class="p">{</span>
                <span class="n">returnUint</span><span class="p">(</span><span class="n">totalSupply</span><span class="p">())</span>
            <span class="p">}</span>
            <span class="k">case</span> <span class="mh">0xa9059cbb</span> <span class="cm">/* &quot;transfer(address,uint256)&quot; */</span> <span class="p">{</span>
                <span class="n">transfer</span><span class="p">(</span><span class="n">decodeAsAddress</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">decodeAsUint</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                <span class="n">returnTrue</span><span class="p">()</span>
            <span class="p">}</span>
            <span class="k">case</span> <span class="mh">0x23b872dd</span> <span class="cm">/* &quot;transferFrom(address,address,uint256)&quot; */</span> <span class="p">{</span>
                <span class="n">transferFrom</span><span class="p">(</span><span class="n">decodeAsAddress</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">decodeAsAddress</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">decodeAsUint</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
                <span class="n">returnTrue</span><span class="p">()</span>
            <span class="p">}</span>
            <span class="k">case</span> <span class="mh">0x095ea7b3</span> <span class="cm">/* &quot;approve(address,uint256)&quot; */</span> <span class="p">{</span>
                <span class="n">approve</span><span class="p">(</span><span class="n">decodeAsAddress</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">decodeAsUint</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                <span class="n">returnTrue</span><span class="p">()</span>
            <span class="p">}</span>
            <span class="k">case</span> <span class="mh">0xdd62ed3e</span> <span class="cm">/* &quot;allowance(address,address)&quot; */</span> <span class="p">{</span>
                <span class="n">returnUint</span><span class="p">(</span><span class="n">allowance</span><span class="p">(</span><span class="n">decodeAsAddress</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">decodeAsAddress</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span>
            <span class="p">}</span>
            <span class="k">case</span> <span class="mh">0x40c10f19</span> <span class="cm">/* &quot;mint(address,uint256)&quot; */</span> <span class="p">{</span>
                <span class="n">mint</span><span class="p">(</span><span class="n">decodeAsAddress</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">decodeAsUint</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                <span class="n">returnTrue</span><span class="p">()</span>
            <span class="p">}</span>
            <span class="k">default</span> <span class="p">{</span>
                <span class="nf">revert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="p">}</span>

            <span class="k">function</span> <span class="n">mint</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">require</span><span class="p">(</span><span class="n">calledByOwner</span><span class="p">())</span>

                <span class="n">mintTokens</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>
                <span class="n">addToBalance</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span>
                <span class="n">emitTransfer</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="k">function</span> <span class="n">transfer</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">executeTransfer</span><span class="p">(</span><span class="nf">caller</span><span class="p">(),</span> <span class="n">to</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="k">function</span> <span class="n">approve</span><span class="p">(</span><span class="n">spender</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">revertIfZeroAddress</span><span class="p">(</span><span class="n">spender</span><span class="p">)</span>
                <span class="n">setAllowance</span><span class="p">(</span><span class="nf">caller</span><span class="p">(),</span> <span class="n">spender</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span>
                <span class="n">emitApproval</span><span class="p">(</span><span class="nf">caller</span><span class="p">(),</span> <span class="n">spender</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="k">function</span> <span class="n">transferFrom</span><span class="p">(</span><span class="n">from</span><span class="p">,</span> <span class="n">to</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">decreaseAllowanceBy</span><span class="p">(</span><span class="n">from</span><span class="p">,</span> <span class="nf">caller</span><span class="p">(),</span> <span class="n">amount</span><span class="p">)</span>
                <span class="n">executeTransfer</span><span class="p">(</span><span class="n">from</span><span class="p">,</span> <span class="n">to</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span>
            <span class="p">}</span>

            <span class="k">function</span> <span class="n">executeTransfer</span><span class="p">(</span><span class="n">from</span><span class="p">,</span> <span class="n">to</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">revertIfZeroAddress</span><span class="p">(</span><span class="n">to</span><span class="p">)</span>
                <span class="n">deductFromBalance</span><span class="p">(</span><span class="n">from</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span>
                <span class="n">addToBalance</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span>
                <span class="n">emitTransfer</span><span class="p">(</span><span class="n">from</span><span class="p">,</span> <span class="n">to</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span>
            <span class="p">}</span>


            <span class="cm">/* ---------- calldata decoding functions ----------- */</span>
            <span class="k">function</span> <span class="n">selector</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">s</span> <span class="p">{</span>
                <span class="n">s</span> <span class="o">:=</span> <span class="nf">div</span><span class="p">(</span><span class="nf">calldataload</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="mh">0x100000000000000000000000000000000000000000000000000000000</span><span class="p">)</span>
            <span class="p">}</span>

            <span class="k">function</span> <span class="n">decodeAsAddress</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">v</span> <span class="p">{</span>
                <span class="n">v</span> <span class="o">:=</span> <span class="n">decodeAsUint</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span>
                <span class="k">if</span> <span class="nf">iszero</span><span class="p">(</span><span class="nf">iszero</span><span class="p">(</span><span class="nf">and</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nf">not</span><span class="p">(</span><span class="mh">0xffffffffffffffffffffffffffffffffffffffff</span><span class="p">))))</span> <span class="p">{</span>
                    <span class="nf">revert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">function</span> <span class="n">decodeAsUint</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">v</span> <span class="p">{</span>
                <span class="ow">let</span> <span class="nv">pos</span> <span class="o">:=</span> <span class="nf">add</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="nf">mul</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">))</span>
                <span class="k">if</span> <span class="nf">lt</span><span class="p">(</span><span class="nf">calldatasize</span><span class="p">(),</span> <span class="nf">add</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nf">revert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="p">}</span>
                <span class="n">v</span> <span class="o">:=</span> <span class="nf">calldataload</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="cm">/* ---------- calldata encoding functions ---------- */</span>
            <span class="k">function</span> <span class="n">returnUint</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="p">{</span>
                <span class="nf">mstore</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
                <span class="nf">return</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="k">function</span> <span class="n">returnTrue</span><span class="p">()</span> <span class="p">{</span>
                <span class="n">returnUint</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="p">}</span>

            <span class="cm">/* -------- events ---------- */</span>
            <span class="k">function</span> <span class="n">emitTransfer</span><span class="p">(</span><span class="n">from</span><span class="p">,</span> <span class="n">to</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span> <span class="p">{</span>
                <span class="ow">let</span> <span class="nv">signatureHash</span> <span class="o">:=</span> <span class="mh">0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef</span>
                <span class="n">emitEvent</span><span class="p">(</span><span class="n">signatureHash</span><span class="p">,</span> <span class="n">from</span><span class="p">,</span> <span class="n">to</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="k">function</span> <span class="n">emitApproval</span><span class="p">(</span><span class="n">from</span><span class="p">,</span> <span class="n">spender</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span> <span class="p">{</span>
                <span class="ow">let</span> <span class="nv">signatureHash</span> <span class="o">:=</span> <span class="mh">0x8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925</span>
                <span class="n">emitEvent</span><span class="p">(</span><span class="n">signatureHash</span><span class="p">,</span> <span class="n">from</span><span class="p">,</span> <span class="n">spender</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="k">function</span> <span class="n">emitEvent</span><span class="p">(</span><span class="n">signatureHash</span><span class="p">,</span> <span class="n">indexed1</span><span class="p">,</span> <span class="n">indexed2</span><span class="p">,</span> <span class="n">nonIndexed</span><span class="p">)</span> <span class="p">{</span>
                <span class="nf">mstore</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nonIndexed</span><span class="p">)</span>
                <span class="nf">log3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="n">signatureHash</span><span class="p">,</span> <span class="n">indexed1</span><span class="p">,</span> <span class="n">indexed2</span><span class="p">)</span>
            <span class="p">}</span>

            <span class="cm">/* -------- storage layout ---------- */</span>
            <span class="k">function</span> <span class="n">ownerPos</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">p</span> <span class="p">{</span> <span class="n">p</span> <span class="o">:=</span> <span class="mi">0</span> <span class="p">}</span>
            <span class="k">function</span> <span class="n">totalSupplyPos</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">p</span> <span class="p">{</span> <span class="n">p</span> <span class="o">:=</span> <span class="mi">1</span> <span class="p">}</span>
            <span class="k">function</span> <span class="n">accountToStorageOffset</span><span class="p">(</span><span class="n">account</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">offset</span> <span class="p">{</span>
                <span class="n">offset</span> <span class="o">:=</span> <span class="nf">add</span><span class="p">(</span><span class="mh">0x1000</span><span class="p">,</span> <span class="n">account</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="k">function</span> <span class="n">allowanceStorageOffset</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">spender</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">offset</span> <span class="p">{</span>
                <span class="n">offset</span> <span class="o">:=</span> <span class="n">accountToStorageOffset</span><span class="p">(</span><span class="n">account</span><span class="p">)</span>
                <span class="nf">mstore</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
                <span class="nf">mstore</span><span class="p">(</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">spender</span><span class="p">)</span>
                <span class="n">offset</span> <span class="o">:=</span> <span class="nf">keccak256</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">)</span>
            <span class="p">}</span>

            <span class="cm">/* -------- storage access ---------- */</span>
            <span class="k">function</span> <span class="n">owner</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">o</span> <span class="p">{</span>
                <span class="n">o</span> <span class="o">:=</span> <span class="nf">sload</span><span class="p">(</span><span class="n">ownerPos</span><span class="p">())</span>
            <span class="p">}</span>
            <span class="k">function</span> <span class="n">totalSupply</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">supply</span> <span class="p">{</span>
                <span class="n">supply</span> <span class="o">:=</span> <span class="nf">sload</span><span class="p">(</span><span class="n">totalSupplyPos</span><span class="p">())</span>
            <span class="p">}</span>
            <span class="k">function</span> <span class="n">mintTokens</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span> <span class="p">{</span>
                <span class="nf">sstore</span><span class="p">(</span><span class="n">totalSupplyPos</span><span class="p">(),</span> <span class="n">safeAdd</span><span class="p">(</span><span class="n">totalSupply</span><span class="p">(),</span> <span class="n">amount</span><span class="p">))</span>
            <span class="p">}</span>
            <span class="k">function</span> <span class="n">balanceOf</span><span class="p">(</span><span class="n">account</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">bal</span> <span class="p">{</span>
                <span class="n">bal</span> <span class="o">:=</span> <span class="nf">sload</span><span class="p">(</span><span class="n">accountToStorageOffset</span><span class="p">(</span><span class="n">account</span><span class="p">))</span>
            <span class="p">}</span>
            <span class="k">function</span> <span class="n">addToBalance</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span> <span class="p">{</span>
                <span class="ow">let</span> <span class="nv">offset</span> <span class="o">:=</span> <span class="n">accountToStorageOffset</span><span class="p">(</span><span class="n">account</span><span class="p">)</span>
                <span class="nf">sstore</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">safeAdd</span><span class="p">(</span><span class="nf">sload</span><span class="p">(</span><span class="n">offset</span><span class="p">),</span> <span class="n">amount</span><span class="p">))</span>
            <span class="p">}</span>
            <span class="k">function</span> <span class="n">deductFromBalance</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span> <span class="p">{</span>
                <span class="ow">let</span> <span class="nv">offset</span> <span class="o">:=</span> <span class="n">accountToStorageOffset</span><span class="p">(</span><span class="n">account</span><span class="p">)</span>
                <span class="ow">let</span> <span class="nv">bal</span> <span class="o">:=</span> <span class="nf">sload</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span>
                <span class="n">require</span><span class="p">(</span><span class="n">lte</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="n">bal</span><span class="p">))</span>
                <span class="nf">sstore</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="nf">sub</span><span class="p">(</span><span class="n">bal</span><span class="p">,</span> <span class="n">amount</span><span class="p">))</span>
            <span class="p">}</span>
            <span class="k">function</span> <span class="n">allowance</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">spender</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">amount</span> <span class="p">{</span>
                <span class="n">amount</span> <span class="o">:=</span> <span class="nf">sload</span><span class="p">(</span><span class="n">allowanceStorageOffset</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">spender</span><span class="p">))</span>
            <span class="p">}</span>
            <span class="k">function</span> <span class="n">setAllowance</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">spender</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span> <span class="p">{</span>
                <span class="nf">sstore</span><span class="p">(</span><span class="n">allowanceStorageOffset</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">spender</span><span class="p">),</span> <span class="n">amount</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="k">function</span> <span class="n">decreaseAllowanceBy</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">spender</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span> <span class="p">{</span>
                <span class="ow">let</span> <span class="nv">offset</span> <span class="o">:=</span> <span class="n">allowanceStorageOffset</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">spender</span><span class="p">)</span>
                <span class="ow">let</span> <span class="nv">currentAllowance</span> <span class="o">:=</span> <span class="nf">sload</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span>
                <span class="n">require</span><span class="p">(</span><span class="n">lte</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="n">currentAllowance</span><span class="p">))</span>
                <span class="nf">sstore</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="nf">sub</span><span class="p">(</span><span class="n">currentAllowance</span><span class="p">,</span> <span class="n">amount</span><span class="p">))</span>
            <span class="p">}</span>

            <span class="cm">/* ---------- utility functions ---------- */</span>
            <span class="k">function</span> <span class="n">lte</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r</span> <span class="p">{</span>
                <span class="n">r</span> <span class="o">:=</span> <span class="nf">iszero</span><span class="p">(</span><span class="nf">gt</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
            <span class="p">}</span>
            <span class="k">function</span> <span class="n">gte</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r</span> <span class="p">{</span>
                <span class="n">r</span> <span class="o">:=</span> <span class="nf">iszero</span><span class="p">(</span><span class="nf">lt</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
            <span class="p">}</span>
            <span class="k">function</span> <span class="n">safeAdd</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">r</span> <span class="p">{</span>
                <span class="n">r</span> <span class="o">:=</span> <span class="nf">add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
                <span class="k">if</span> <span class="nf">or</span><span class="p">(</span><span class="nf">lt</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">a</span><span class="p">),</span> <span class="nf">lt</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span> <span class="p">{</span> <span class="nf">revert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">function</span> <span class="n">calledByOwner</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">cbo</span> <span class="p">{</span>
                <span class="n">cbo</span> <span class="o">:=</span> <span class="nf">eq</span><span class="p">(</span><span class="n">owner</span><span class="p">(),</span> <span class="nf">caller</span><span class="p">())</span>
            <span class="p">}</span>
            <span class="k">function</span> <span class="n">revertIfZeroAddress</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">require</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="k">function</span> <span class="n">require</span><span class="p">(</span><span class="n">condition</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="nf">iszero</span><span class="p">(</span><span class="n">condition</span><span class="p">)</span> <span class="p">{</span> <span class="nf">revert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<span id="document-style-guide"></span><section id="style-guide">
<span id="index-0"></span><h2>Style Guide<a class="headerlink" href="#style-guide" title="Permalink to this heading">ÔÉÅ</a></h2>
<section id="introduction">
<h3>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>This guide is intended to provide coding conventions for writing Solidity code.
This guide should be thought of as an evolving document that will change over
time as useful conventions are found and old conventions are rendered obsolete.</p>
<p>Many projects will implement their own style guides.  In the event of
conflicts, project specific style guides take precedence.</p>
<p>The structure and many of the recommendations within this style guide were
taken from python‚Äôs
<a class="reference external" href="https://www.python.org/dev/peps/pep-0008/">pep8 style guide</a>.</p>
<p>The goal of this guide is <em>not</em> to be the right way or the best way to write
Solidity code.  The goal of this guide is <em>consistency</em>.  A quote from python‚Äôs
<a class="reference external" href="https://www.python.org/dev/peps/pep-0008/#a-foolish-consistency-is-the-hobgoblin-of-little-minds">pep8</a>
captures this concept well.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A style guide is about consistency. Consistency with this style guide is important. Consistency within a project is more important. Consistency within one module or function is most important.</p>
<p>But most importantly: <strong>know when to be inconsistent</strong> ‚Äì sometimes the style guide just doesn‚Äôt apply. When in doubt, use your best judgment. Look at other examples and decide what looks best. And don‚Äôt hesitate to ask!</p>
</div>
</section>
<section id="code-layout">
<h3>Code Layout<a class="headerlink" href="#code-layout" title="Permalink to this heading">ÔÉÅ</a></h3>
<section id="indentation">
<h4>Indentation<a class="headerlink" href="#indentation" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Use 4 spaces per indentation level.</p>
</section>
<section id="tabs-or-spaces">
<h4>Tabs or Spaces<a class="headerlink" href="#tabs-or-spaces" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Spaces are the preferred indentation method.</p>
<p>Mixing tabs and spaces should be avoided.</p>
</section>
<section id="blank-lines">
<h4>Blank Lines<a class="headerlink" href="#blank-lines" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Surround top level declarations in Solidity source with two blank lines.</p>
<p>Yes:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC40LjAgPDAuOS4wOwoKY29udHJhY3QgQSB7CiAgICAvLyAuLi4KfQoKCmNvbnRyYWN0IEIgewogICAgLy8gLi4uCn0KCgpjb250cmFjdCBDIHsKICAgIC8vIC4uLgp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.4.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">A</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">}</span><span class="w"></span>


<span class="k">contract</span><span class="w"> </span><span class="ni">B</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">}</span><span class="w"></span>


<span class="k">contract</span><span class="w"> </span><span class="ni">C</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>No:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC40LjAgPDAuOS4wOwoKY29udHJhY3QgQSB7CiAgICAvLyAuLi4KfQpjb250cmFjdCBCIHsKICAgIC8vIC4uLgp9Cgpjb250cmFjdCBDIHsKICAgIC8vIC4uLgp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.4.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">A</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">}</span><span class="w"></span>
<span class="k">contract</span><span class="w"> </span><span class="ni">B</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">}</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">C</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Within a contract surround function declarations with a single blank line.</p>
<p>Blank lines may be omitted between groups of related one-liners (such as stub functions for an abstract contract)</p>
<p>Yes:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC42LjAgPDAuOS4wOwoKYWJzdHJhY3QgY29udHJhY3QgQSB7CiAgICBmdW5jdGlvbiBzcGFtKCkgcHVibGljIHZpcnR1YWwgcHVyZTsKICAgIGZ1bmN0aW9uIGhhbSgpIHB1YmxpYyB2aXJ0dWFsIHB1cmU7Cn0KCgpjb250cmFjdCBCIGlzIEEgewogICAgZnVuY3Rpb24gc3BhbSgpIHB1YmxpYyBwdXJlIG92ZXJyaWRlIHsKICAgICAgICAvLyAuLi4KICAgIH0KCiAgICBmdW5jdGlvbiBoYW0oKSBwdWJsaWMgcHVyZSBvdmVycmlkZSB7CiAgICAgICAgLy8gLi4uCiAgICB9Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.6.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

abstract<span class="w"> </span><span class="k">contract</span><span class="w"> </span><span class="ni">A</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">spam</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>virtual<span class="w"> </span>pure<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">ham</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>virtual<span class="w"> </span>pure<span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>


<span class="k">contract</span><span class="w"> </span><span class="ni">B</span><span class="w"> </span><span class="kt">is</span><span class="w"> </span>A<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">spam</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>pure<span class="w"> </span>override<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// ...</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">ham</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>pure<span class="w"> </span>override<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// ...</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>No:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC42LjAgPDAuOS4wOwoKYWJzdHJhY3QgY29udHJhY3QgQSB7CiAgICBmdW5jdGlvbiBzcGFtKCkgdmlydHVhbCBwdXJlIHB1YmxpYzsKICAgIGZ1bmN0aW9uIGhhbSgpIHB1YmxpYyB2aXJ0dWFsIHB1cmU7Cn0KCgpjb250cmFjdCBCIGlzIEEgewogICAgZnVuY3Rpb24gc3BhbSgpIHB1YmxpYyBwdXJlIG92ZXJyaWRlIHsKICAgICAgICAvLyAuLi4KICAgIH0KICAgIGZ1bmN0aW9uIGhhbSgpIHB1YmxpYyBwdXJlIG92ZXJyaWRlIHsKICAgICAgICAvLyAuLi4KICAgIH0KfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.6.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

abstract<span class="w"> </span><span class="k">contract</span><span class="w"> </span><span class="ni">A</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">spam</span><span class="p">()</span><span class="w"> </span>virtual<span class="w"> </span>pure<span class="w"> </span><span class="kt">public</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">ham</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>virtual<span class="w"> </span>pure<span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>


<span class="k">contract</span><span class="w"> </span><span class="ni">B</span><span class="w"> </span><span class="kt">is</span><span class="w"> </span>A<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">spam</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>pure<span class="w"> </span>override<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// ...</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">ham</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>pure<span class="w"> </span>override<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// ...</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="maximum-line-length">
<span id="id1"></span><h4>Maximum Line Length<a class="headerlink" href="#maximum-line-length" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Keeping lines under the <a class="reference external" href="https://www.python.org/dev/peps/pep-0008/#maximum-line-length">PEP 8 recommendation</a> to a maximum of 79 (or 99)
characters helps readers easily parse the code.</p>
<p>Wrapped lines should conform to the following guidelines.</p>
<ol class="arabic simple">
<li><p>The first argument should not be attached to the opening parenthesis.</p></li>
<li><p>One, and only one, indent should be used.</p></li>
<li><p>Each argument should fall on its own line.</p></li>
<li><p>The terminating element, <code class="code docutils literal notranslate"><span class="pre">);</span></code>, should be placed on the final line by itself.</p></li>
</ol>
<p>Function Calls</p>
<p>Yes:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=dGhpc0Z1bmN0aW9uQ2FsbElzUmVhbGx5TG9uZygKICAgIGxvbmdBcmd1bWVudDEsCiAgICBsb25nQXJndW1lbnQyLAogICAgbG9uZ0FyZ3VtZW50MwopOw=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span>thisFunctionCallIsReallyLong<span class="p">(</span><span class="w"></span>
<span class="w">    </span>longArgument1<span class="p">,</span><span class="w"></span>
<span class="w">    </span>longArgument2<span class="p">,</span><span class="w"></span>
<span class="w">    </span>longArgument3<span class="w"></span>
<span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>No:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=dGhpc0Z1bmN0aW9uQ2FsbElzUmVhbGx5TG9uZyhsb25nQXJndW1lbnQxLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb25nQXJndW1lbnQyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb25nQXJndW1lbnQzCik7Cgp0aGlzRnVuY3Rpb25DYWxsSXNSZWFsbHlMb25nKGxvbmdBcmd1bWVudDEsCiAgICBsb25nQXJndW1lbnQyLAogICAgbG9uZ0FyZ3VtZW50MwopOwoKdGhpc0Z1bmN0aW9uQ2FsbElzUmVhbGx5TG9uZygKICAgIGxvbmdBcmd1bWVudDEsIGxvbmdBcmd1bWVudDIsCiAgICBsb25nQXJndW1lbnQzCik7Cgp0aGlzRnVuY3Rpb25DYWxsSXNSZWFsbHlMb25nKApsb25nQXJndW1lbnQxLApsb25nQXJndW1lbnQyLApsb25nQXJndW1lbnQzCik7Cgp0aGlzRnVuY3Rpb25DYWxsSXNSZWFsbHlMb25nKAogICAgbG9uZ0FyZ3VtZW50MSwKICAgIGxvbmdBcmd1bWVudDIsCiAgICBsb25nQXJndW1lbnQzKTs="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span>thisFunctionCallIsReallyLong<span class="p">(</span>longArgument1<span class="p">,</span><span class="w"></span>
<span class="w">                              </span>longArgument2<span class="p">,</span><span class="w"></span>
<span class="w">                              </span>longArgument3<span class="w"></span>
<span class="p">);</span><span class="w"></span>

thisFunctionCallIsReallyLong<span class="p">(</span>longArgument1<span class="p">,</span><span class="w"></span>
<span class="w">    </span>longArgument2<span class="p">,</span><span class="w"></span>
<span class="w">    </span>longArgument3<span class="w"></span>
<span class="p">);</span><span class="w"></span>

thisFunctionCallIsReallyLong<span class="p">(</span><span class="w"></span>
<span class="w">    </span>longArgument1<span class="p">,</span><span class="w"> </span>longArgument2<span class="p">,</span><span class="w"></span>
<span class="w">    </span>longArgument3<span class="w"></span>
<span class="p">);</span><span class="w"></span>

thisFunctionCallIsReallyLong<span class="p">(</span><span class="w"></span>
longArgument1<span class="p">,</span><span class="w"></span>
longArgument2<span class="p">,</span><span class="w"></span>
longArgument3<span class="w"></span>
<span class="p">);</span><span class="w"></span>

thisFunctionCallIsReallyLong<span class="p">(</span><span class="w"></span>
<span class="w">    </span>longArgument1<span class="p">,</span><span class="w"></span>
<span class="w">    </span>longArgument2<span class="p">,</span><span class="w"></span>
<span class="w">    </span>longArgument3<span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>Assignment Statements</p>
<p>Yes:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=dGhpc0lzQUxvbmdOZXN0ZWRNYXBwaW5nW2JlaW5nXVtzZXRdW3RvU29tZVZhbHVlXSA9IHNvbWVGdW5jdGlvbigKICAgIGFyZ3VtZW50MSwKICAgIGFyZ3VtZW50MiwKICAgIGFyZ3VtZW50MywKICAgIGFyZ3VtZW50NAopOw=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span>thisIsALongNestedMapping<span class="p">[</span>being<span class="p">][</span>set<span class="p">][</span>toSomeValue<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>someFunction<span class="p">(</span><span class="w"></span>
<span class="w">    </span>argument1<span class="p">,</span><span class="w"></span>
<span class="w">    </span>argument2<span class="p">,</span><span class="w"></span>
<span class="w">    </span>argument3<span class="p">,</span><span class="w"></span>
<span class="w">    </span>argument4<span class="w"></span>
<span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>No:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=dGhpc0lzQUxvbmdOZXN0ZWRNYXBwaW5nW2JlaW5nXVtzZXRdW3RvU29tZVZhbHVlXSA9IHNvbWVGdW5jdGlvbihhcmd1bWVudDEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmd1bWVudDIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmd1bWVudDMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmd1bWVudDQpOw=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span>thisIsALongNestedMapping<span class="p">[</span>being<span class="p">][</span>set<span class="p">][</span>toSomeValue<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>someFunction<span class="p">(</span>argument1<span class="p">,</span><span class="w"></span>
<span class="w">                                                                   </span>argument2<span class="p">,</span><span class="w"></span>
<span class="w">                                                                   </span>argument3<span class="p">,</span><span class="w"></span>
<span class="w">                                                                   </span>argument4<span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>Event Definitions and Event Emitters</p>
<p>Yes:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=ZXZlbnQgTG9uZ0FuZExvdHNPZkFyZ3MoCiAgICBhZGRyZXNzIHNlbmRlciwKICAgIGFkZHJlc3MgcmVjaXBpZW50LAogICAgdWludDI1NiBwdWJsaWNLZXksCiAgICB1aW50MjU2IGFtb3VudCwKICAgIGJ5dGVzMzJbXSBvcHRpb25zCik7CgpMb25nQW5kTG90c09mQXJncygKICAgIHNlbmRlciwKICAgIHJlY2lwaWVudCwKICAgIHB1YmxpY0tleSwKICAgIGFtb3VudCwKICAgIG9wdGlvbnMKKTs="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">event</span><span class="w"> </span><span class="nv">LongAndLotsOfArgs</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">sender</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">recipient</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">publicKey</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amount</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="kt">bytes32</span><span class="p">[]</span><span class="w"> </span>options<span class="w"></span>
<span class="p">);</span><span class="w"></span>

LongAndLotsOfArgs<span class="p">(</span><span class="w"></span>
<span class="w">    </span>sender<span class="p">,</span><span class="w"></span>
<span class="w">    </span>recipient<span class="p">,</span><span class="w"></span>
<span class="w">    </span>publicKey<span class="p">,</span><span class="w"></span>
<span class="w">    </span>amount<span class="p">,</span><span class="w"></span>
<span class="w">    </span>options<span class="w"></span>
<span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>No:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=ZXZlbnQgTG9uZ0FuZExvdHNPZkFyZ3MoYWRkcmVzcyBzZW5kZXIsCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZHJlc3MgcmVjaXBpZW50LAogICAgICAgICAgICAgICAgICAgICAgICB1aW50MjU2IHB1YmxpY0tleSwKICAgICAgICAgICAgICAgICAgICAgICAgdWludDI1NiBhbW91bnQsCiAgICAgICAgICAgICAgICAgICAgICAgIGJ5dGVzMzJbXSBvcHRpb25zKTsKCkxvbmdBbmRMb3RzT2ZBcmdzKHNlbmRlciwKICAgICAgICAgICAgICAgICAgcmVjaXBpZW50LAogICAgICAgICAgICAgICAgICBwdWJsaWNLZXksCiAgICAgICAgICAgICAgICAgIGFtb3VudCwKICAgICAgICAgICAgICAgICAgb3B0aW9ucyk7"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">event</span><span class="w"> </span><span class="nv">LongAndLotsOfArgs</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">sender</span><span class="p">,</span><span class="w"></span>
<span class="w">                        </span><span class="kt">address</span><span class="w"> </span><span class="nv">recipient</span><span class="p">,</span><span class="w"></span>
<span class="w">                        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">publicKey</span><span class="p">,</span><span class="w"></span>
<span class="w">                        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amount</span><span class="p">,</span><span class="w"></span>
<span class="w">                        </span><span class="kt">bytes32</span><span class="p">[]</span><span class="w"> </span>options<span class="p">);</span><span class="w"></span>

LongAndLotsOfArgs<span class="p">(</span>sender<span class="p">,</span><span class="w"></span>
<span class="w">                  </span>recipient<span class="p">,</span><span class="w"></span>
<span class="w">                  </span>publicKey<span class="p">,</span><span class="w"></span>
<span class="w">                  </span>amount<span class="p">,</span><span class="w"></span>
<span class="w">                  </span>options<span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="source-file-encoding">
<h4>Source File Encoding<a class="headerlink" href="#source-file-encoding" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>UTF-8 or ASCII encoding is preferred.</p>
</section>
<section id="imports">
<h4>Imports<a class="headerlink" href="#imports" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Import statements should always be placed at the top of the file.</p>
<p>Yes:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC40LjAgPDAuOS4wOwoKaW1wb3J0ICIuL093bmVkLnNvbCI7Cgpjb250cmFjdCBBIHsKICAgIC8vIC4uLgp9CgoKY29udHJhY3QgQiBpcyBPd25lZCB7CiAgICAvLyAuLi4KfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.4.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="kt">import</span><span class="w"> </span><span class="s2">&quot;./Owned.sol&quot;</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">A</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">}</span><span class="w"></span>


<span class="k">contract</span><span class="w"> </span><span class="ni">B</span><span class="w"> </span><span class="kt">is</span><span class="w"> </span>Owned<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>No:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC40LjAgPDAuOS4wOwoKY29udHJhY3QgQSB7CiAgICAvLyAuLi4KfQoKCmltcG9ydCAiLi9Pd25lZC5zb2wiOwoKCmNvbnRyYWN0IEIgaXMgT3duZWQgewogICAgLy8gLi4uCn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.4.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">A</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">}</span><span class="w"></span>


<span class="kt">import</span><span class="w"> </span><span class="s2">&quot;./Owned.sol&quot;</span><span class="p">;</span><span class="w"></span>


<span class="k">contract</span><span class="w"> </span><span class="ni">B</span><span class="w"> </span><span class="kt">is</span><span class="w"> </span>Owned<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="order-of-functions">
<h4>Order of Functions<a class="headerlink" href="#order-of-functions" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Ordering helps readers identify which functions they can call and to find the constructor and fallback definitions easier.</p>
<p>Functions should be grouped according to their visibility and ordered:</p>
<ul class="simple">
<li><p>constructor</p></li>
<li><p>receive function (if exists)</p></li>
<li><p>fallback function (if exists)</p></li>
<li><p>external</p></li>
<li><p>public</p></li>
<li><p>internal</p></li>
<li><p>private</p></li>
</ul>
<p>Within a grouping, place the <code class="docutils literal notranslate"><span class="pre">view</span></code> and <code class="docutils literal notranslate"><span class="pre">pure</span></code> functions last.</p>
<p>Yes:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC43LjAgPDAuOS4wOwpjb250cmFjdCBBIHsKICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgIC8vIC4uLgogICAgfQoKICAgIHJlY2VpdmUoKSBleHRlcm5hbCBwYXlhYmxlIHsKICAgICAgICAvLyAuLi4KICAgIH0KCiAgICBmYWxsYmFjaygpIGV4dGVybmFsIHsKICAgICAgICAvLyAuLi4KICAgIH0KCiAgICAvLyBFeHRlcm5hbCBmdW5jdGlvbnMKICAgIC8vIC4uLgoKICAgIC8vIEV4dGVybmFsIGZ1bmN0aW9ucyB0aGF0IGFyZSB2aWV3CiAgICAvLyAuLi4KCiAgICAvLyBFeHRlcm5hbCBmdW5jdGlvbnMgdGhhdCBhcmUgcHVyZQogICAgLy8gLi4uCgogICAgLy8gUHVibGljIGZ1bmN0aW9ucwogICAgLy8gLi4uCgogICAgLy8gSW50ZXJuYWwgZnVuY3Rpb25zCiAgICAvLyAuLi4KCiAgICAvLyBQcml2YXRlIGZ1bmN0aW9ucwogICAgLy8gLi4uCn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.7.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>
<span class="k">contract</span><span class="w"> </span><span class="ni">A</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// ...</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span>receive<span class="p">()</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// ...</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span>fallback<span class="p">()</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// ...</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">// External functions</span>
<span class="w">    </span><span class="c1">// ...</span>

<span class="w">    </span><span class="c1">// External functions that are view</span>
<span class="w">    </span><span class="c1">// ...</span>

<span class="w">    </span><span class="c1">// External functions that are pure</span>
<span class="w">    </span><span class="c1">// ...</span>

<span class="w">    </span><span class="c1">// Public functions</span>
<span class="w">    </span><span class="c1">// ...</span>

<span class="w">    </span><span class="c1">// Internal functions</span>
<span class="w">    </span><span class="c1">// ...</span>

<span class="w">    </span><span class="c1">// Private functions</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>No:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC43LjAgPDAuOS4wOwpjb250cmFjdCBBIHsKCiAgICAvLyBFeHRlcm5hbCBmdW5jdGlvbnMKICAgIC8vIC4uLgoKICAgIGZhbGxiYWNrKCkgZXh0ZXJuYWwgewogICAgICAgIC8vIC4uLgogICAgfQogICAgcmVjZWl2ZSgpIGV4dGVybmFsIHBheWFibGUgewogICAgICAgIC8vIC4uLgogICAgfQoKICAgIC8vIFByaXZhdGUgZnVuY3Rpb25zCiAgICAvLyAuLi4KCiAgICAvLyBQdWJsaWMgZnVuY3Rpb25zCiAgICAvLyAuLi4KCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgICAvLyAuLi4KICAgIH0KCiAgICAvLyBJbnRlcm5hbCBmdW5jdGlvbnMKICAgIC8vIC4uLgp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.7.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>
<span class="k">contract</span><span class="w"> </span><span class="ni">A</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">    </span><span class="c1">// External functions</span>
<span class="w">    </span><span class="c1">// ...</span>

<span class="w">    </span>fallback<span class="p">()</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// ...</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span>receive<span class="p">()</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// ...</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Private functions</span>
<span class="w">    </span><span class="c1">// ...</span>

<span class="w">    </span><span class="c1">// Public functions</span>
<span class="w">    </span><span class="c1">// ...</span>

<span class="w">    </span><span class="kt">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// ...</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Internal functions</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="whitespace-in-expressions">
<h4>Whitespace in Expressions<a class="headerlink" href="#whitespace-in-expressions" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Avoid extraneous whitespace in the following  situations:</p>
<p>Immediately inside parenthesis, brackets or braces, with the exception of single line function declarations.</p>
<p>Yes:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=c3BhbShoYW1bMV0sIENvaW4oe25hbWU6ICJoYW0ifSkpOw=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span>spam<span class="p">(</span>ham<span class="p">[</span><span class="m m-Decimal">1</span><span class="p">],</span><span class="w"> </span>Coin<span class="p">({</span>name<span class="p">:</span><span class="w"> </span><span class="s2">&quot;ham&quot;</span><span class="p">}));</span><span class="w"></span>
</pre></div>
</div>
<p>No:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=c3BhbSggaGFtWyAxIF0sIENvaW4oIHsgbmFtZTogImhhbSIgfSApICk7"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span>spam<span class="p">(</span><span class="w"> </span>ham<span class="p">[</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="w"> </span><span class="p">],</span><span class="w"> </span>Coin<span class="p">(</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>name<span class="p">:</span><span class="w"> </span><span class="s2">&quot;ham&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>Exception:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=ZnVuY3Rpb24gc2luZ2xlTGluZSgpIHB1YmxpYyB7IHNwYW0oKTsgfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">function</span><span class="w"> </span><span class="nv">singleLine</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>spam<span class="p">();</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Immediately before a comma, semicolon:</p>
<p>Yes:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=ZnVuY3Rpb24gc3BhbSh1aW50IGksIENvaW4gY29pbikgcHVibGljOw=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">function</span><span class="w"> </span><span class="nv">spam</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">i</span><span class="p">,</span><span class="w"> </span>Coin<span class="w"> </span>coin<span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>No:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=ZnVuY3Rpb24gc3BhbSh1aW50IGkgLCBDb2luIGNvaW4pIHB1YmxpYyA7"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">function</span><span class="w"> </span><span class="nv">spam</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="p">,</span><span class="w"> </span>Coin<span class="w"> </span>coin<span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>More than one space around an assignment or other operator to align with another:</p>
<p>Yes:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=eCA9IDE7CnkgPSAyOwpsb25nVmFyaWFibGUgPSAzOw=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span>x<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">;</span><span class="w"></span>
y<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">2</span><span class="p">;</span><span class="w"></span>
longVariable<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">3</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>No:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=eCAgICAgICAgICAgID0gMTsKeSAgICAgICAgICAgID0gMjsKbG9uZ1ZhcmlhYmxlID0gMzs="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span>x<span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">;</span><span class="w"></span>
y<span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">2</span><span class="p">;</span><span class="w"></span>
longVariable<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">3</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>Don‚Äôt include a whitespace in the receive and fallback functions:</p>
<p>Yes:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=cmVjZWl2ZSgpIGV4dGVybmFsIHBheWFibGUgewogICAgLi4uCn0KCmZhbGxiYWNrKCkgZXh0ZXJuYWwgewogICAgLi4uCn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span>receive<span class="p">()</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">...</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

fallback<span class="p">()</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">...</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>No:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=cmVjZWl2ZSAoKSBleHRlcm5hbCBwYXlhYmxlIHsKICAgIC4uLgp9CgpmYWxsYmFjayAoKSBleHRlcm5hbCB7CiAgICAuLi4KfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span>receive<span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">...</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

fallback<span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">...</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="control-structures">
<h4>Control Structures<a class="headerlink" href="#control-structures" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>The braces denoting the body of a contract, library, functions and structs
should:</p>
<ul class="simple">
<li><p>open on the same line as the declaration</p></li>
<li><p>close on their own line at the same indentation level as the beginning of the
declaration.</p></li>
<li><p>The opening brace should be preceded by a single space.</p></li>
</ul>
<p>Yes:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC40LjAgPDAuOS4wOwoKY29udHJhY3QgQ29pbiB7CiAgICBzdHJ1Y3QgQmFuayB7CiAgICAgICAgYWRkcmVzcyBvd25lcjsKICAgICAgICB1aW50IGJhbGFuY2U7CiAgICB9Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.4.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Coin</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">struct</span><span class="w"> </span><span class="nv">Bank</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">owner</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="w"> </span><span class="nv">balance</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>No:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC40LjAgPDAuOS4wOwoKY29udHJhY3QgQ29pbgp7CiAgICBzdHJ1Y3QgQmFuayB7CiAgICAgICAgYWRkcmVzcyBvd25lcjsKICAgICAgICB1aW50IGJhbGFuY2U7CiAgICB9Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.4.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Coin</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">struct</span><span class="w"> </span><span class="nv">Bank</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">owner</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="w"> </span><span class="nv">balance</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>The same recommendations apply to the control structures <code class="docutils literal notranslate"><span class="pre">if</span></code>, <code class="docutils literal notranslate"><span class="pre">else</span></code>, <code class="docutils literal notranslate"><span class="pre">while</span></code>,
and <code class="docutils literal notranslate"><span class="pre">for</span></code>.</p>
<p>Additionally there should be a single space between the control structures
<code class="docutils literal notranslate"><span class="pre">if</span></code>, <code class="docutils literal notranslate"><span class="pre">while</span></code>, and <code class="docutils literal notranslate"><span class="pre">for</span></code> and the parenthetic block representing the
conditional, as well as a single space between the conditional parenthetic
block and the opening brace.</p>
<p>Yes:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=aWYgKC4uLikgewogICAgLi4uCn0KCmZvciAoLi4uKSB7CiAgICAuLi4KfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">if</span><span class="w"> </span><span class="p">(...)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">...</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">for</span><span class="w"> </span><span class="p">(...)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">...</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>No:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=aWYgKC4uLikKewogICAgLi4uCn0KCndoaWxlKC4uLil7Cn0KCmZvciAoLi4uKSB7CiAgICAuLi47fQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">if</span><span class="w"> </span><span class="p">(...)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">...</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">while</span><span class="p">(...){</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">for</span><span class="w"> </span><span class="p">(...)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">...;}</span><span class="w"></span>
</pre></div>
</div>
<p>For control structures whose body contains a single statement, omitting the
braces is ok <em>if</em> the statement is contained on a single line.</p>
<p>Yes:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=aWYgKHggPCAxMCkKICAgIHggKz0gMTs="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>x<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m m-Decimal">10</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>x<span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>No:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=aWYgKHggPCAxMCkKICAgIHNvbWVBcnJheS5wdXNoKENvaW4oewogICAgICAgIG5hbWU6ICdzcGFtJywKICAgICAgICB2YWx1ZTogNDIKICAgIH0pKTs="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>x<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m m-Decimal">10</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>someArray<span class="p">.</span>push<span class="p">(</span>Coin<span class="p">({</span><span class="w"></span>
<span class="w">        </span>name<span class="p">:</span><span class="w"> </span><span class="s1">&#39;spam&#39;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span>value<span class="p">:</span><span class="w"> </span><span class="m m-Decimal">42</span><span class="w"></span>
<span class="w">    </span><span class="p">}));</span><span class="w"></span>
</pre></div>
</div>
<p>For <code class="docutils literal notranslate"><span class="pre">if</span></code> blocks which have an <code class="docutils literal notranslate"><span class="pre">else</span></code> or <code class="docutils literal notranslate"><span class="pre">else</span> <span class="pre">if</span></code> clause, the <code class="docutils literal notranslate"><span class="pre">else</span></code> should be
placed on the same line as the <code class="docutils literal notranslate"><span class="pre">if</span></code>‚Äôs closing brace. This is an exception compared
to the rules of other block-like structures.</p>
<p>Yes:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=aWYgKHggPCAzKSB7CiAgICB4ICs9IDE7Cn0gZWxzZSBpZiAoeCA+IDcpIHsKICAgIHggLT0gMTsKfSBlbHNlIHsKICAgIHggPSA1Owp9CgoKaWYgKHggPCAzKQogICAgeCArPSAxOwplbHNlCiAgICB4IC09IDE7"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>x<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m m-Decimal">3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span>x<span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"> </span><span class="kt">else</span><span class="w"> </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>x<span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m m-Decimal">7</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span>x<span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"> </span><span class="kt">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span>x<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">5</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>


<span class="kt">if</span><span class="w"> </span><span class="p">(</span>x<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m m-Decimal">3</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>x<span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">;</span><span class="w"></span>
<span class="kt">else</span><span class="w"></span>
<span class="w">    </span>x<span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>No:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=aWYgKHggPCAzKSB7CiAgICB4ICs9IDE7Cn0KZWxzZSB7CiAgICB4IC09IDE7Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>x<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m m-Decimal">3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span>x<span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="kt">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span>x<span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="function-declaration">
<h4>Function Declaration<a class="headerlink" href="#function-declaration" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>For short function declarations, it is recommended for the opening brace of the
function body to be kept on the same line as the function declaration.</p>
<p>The closing brace should be at the same indentation level as the function
declaration.</p>
<p>The opening brace should be preceded by a single space.</p>
<p>Yes:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=ZnVuY3Rpb24gaW5jcmVtZW50KHVpbnQgeCkgcHVibGljIHB1cmUgcmV0dXJucyAodWludCkgewogICAgcmV0dXJuIHggKyAxOwp9CgpmdW5jdGlvbiBpbmNyZW1lbnQodWludCB4KSBwdWJsaWMgcHVyZSBvbmx5T3duZXIgcmV0dXJucyAodWludCkgewogICAgcmV0dXJuIHggKyAxOwp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">function</span><span class="w"> </span><span class="nv">increment</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">x</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">return</span><span class="w"> </span>x<span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">function</span><span class="w"> </span><span class="nv">increment</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">x</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>pure<span class="w"> </span>onlyOwner<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">return</span><span class="w"> </span>x<span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>No:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=ZnVuY3Rpb24gaW5jcmVtZW50KHVpbnQgeCkgcHVibGljIHB1cmUgcmV0dXJucyAodWludCkKewogICAgcmV0dXJuIHggKyAxOwp9CgpmdW5jdGlvbiBpbmNyZW1lbnQodWludCB4KSBwdWJsaWMgcHVyZSByZXR1cm5zICh1aW50KXsKICAgIHJldHVybiB4ICsgMTsKfQoKZnVuY3Rpb24gaW5jcmVtZW50KHVpbnQgeCkgcHVibGljIHB1cmUgcmV0dXJucyAodWludCkgewogICAgcmV0dXJuIHggKyAxOwogICAgfQoKZnVuY3Rpb24gaW5jcmVtZW50KHVpbnQgeCkgcHVibGljIHB1cmUgcmV0dXJucyAodWludCkgewogICAgcmV0dXJuIHggKyAxO30="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">function</span><span class="w"> </span><span class="nv">increment</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">x</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">return</span><span class="w"> </span>x<span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">function</span><span class="w"> </span><span class="nv">increment</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">x</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="p">){</span><span class="w"></span>
<span class="w">    </span><span class="kt">return</span><span class="w"> </span>x<span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">function</span><span class="w"> </span><span class="nv">increment</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">x</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">return</span><span class="w"> </span>x<span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="kt">function</span><span class="w"> </span><span class="nv">increment</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">x</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">return</span><span class="w"> </span>x<span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">;}</span><span class="w"></span>
</pre></div>
</div>
<p>The modifier order for a function should be:</p>
<ol class="arabic simple">
<li><p>Visibility</p></li>
<li><p>Mutability</p></li>
<li><p>Virtual</p></li>
<li><p>Override</p></li>
<li><p>Custom modifiers</p></li>
</ol>
<p>Yes:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=ZnVuY3Rpb24gYmFsYW5jZSh1aW50IGZyb20pIHB1YmxpYyB2aWV3IG92ZXJyaWRlIHJldHVybnMgKHVpbnQpICB7CiAgICByZXR1cm4gYmFsYW5jZU9mW2Zyb21dOwp9CgpmdW5jdGlvbiBzaHV0ZG93bigpIHB1YmxpYyBvbmx5T3duZXIgewogICAgc2VsZmRlc3RydWN0KG93bmVyKTsKfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">function</span><span class="w"> </span><span class="nv">balance</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">from</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>view<span class="w"> </span>override<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span><span class="w">  </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">return</span><span class="w"> </span>balanceOf<span class="p">[</span>from<span class="p">];</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">function</span><span class="w"> </span><span class="nv">shutdown</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>onlyOwner<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span>selfdestruct<span class="p">(</span>owner<span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>No:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=ZnVuY3Rpb24gYmFsYW5jZSh1aW50IGZyb20pIHB1YmxpYyBvdmVycmlkZSB2aWV3IHJldHVybnMgKHVpbnQpICB7CiAgICByZXR1cm4gYmFsYW5jZU9mW2Zyb21dOwp9CgpmdW5jdGlvbiBzaHV0ZG93bigpIG9ubHlPd25lciBwdWJsaWMgewogICAgc2VsZmRlc3RydWN0KG93bmVyKTsKfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">function</span><span class="w"> </span><span class="nv">balance</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">from</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>override<span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span><span class="w">  </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">return</span><span class="w"> </span>balanceOf<span class="p">[</span>from<span class="p">];</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">function</span><span class="w"> </span><span class="nv">shutdown</span><span class="p">()</span><span class="w"> </span>onlyOwner<span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span>selfdestruct<span class="p">(</span>owner<span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>For long function declarations, it is recommended to drop each argument onto
its own line at the same indentation level as the function body.  The closing
parenthesis and opening bracket should be placed on their own line as well at
the same indentation level as the function declaration.</p>
<p>Yes:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=ZnVuY3Rpb24gdGhpc0Z1bmN0aW9uSGFzTG90c09mQXJndW1lbnRzKAogICAgYWRkcmVzcyBhLAogICAgYWRkcmVzcyBiLAogICAgYWRkcmVzcyBjLAogICAgYWRkcmVzcyBkLAogICAgYWRkcmVzcyBlLAogICAgYWRkcmVzcyBmCikKICAgIHB1YmxpYwp7CiAgICBkb1NvbWV0aGluZygpOwp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">function</span><span class="w"> </span><span class="nv">thisFunctionHasLotsOfArguments</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">a</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">b</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">c</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">d</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">e</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">f</span><span class="w"></span>
<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="kt">public</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span>doSomething<span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>No:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=ZnVuY3Rpb24gdGhpc0Z1bmN0aW9uSGFzTG90c09mQXJndW1lbnRzKGFkZHJlc3MgYSwgYWRkcmVzcyBiLCBhZGRyZXNzIGMsCiAgICBhZGRyZXNzIGQsIGFkZHJlc3MgZSwgYWRkcmVzcyBmKSBwdWJsaWMgewogICAgZG9Tb21ldGhpbmcoKTsKfQoKZnVuY3Rpb24gdGhpc0Z1bmN0aW9uSGFzTG90c09mQXJndW1lbnRzKGFkZHJlc3MgYSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZHJlc3MgYiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZHJlc3MgYywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZHJlc3MgZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZHJlc3MgZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZHJlc3MgZikgcHVibGljIHsKICAgIGRvU29tZXRoaW5nKCk7Cn0KCmZ1bmN0aW9uIHRoaXNGdW5jdGlvbkhhc0xvdHNPZkFyZ3VtZW50cygKICAgIGFkZHJlc3MgYSwKICAgIGFkZHJlc3MgYiwKICAgIGFkZHJlc3MgYywKICAgIGFkZHJlc3MgZCwKICAgIGFkZHJlc3MgZSwKICAgIGFkZHJlc3MgZikgcHVibGljIHsKICAgIGRvU29tZXRoaW5nKCk7Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">function</span><span class="w"> </span><span class="nv">thisFunctionHasLotsOfArguments</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">a</span><span class="p">,</span><span class="w"> </span><span class="kt">address</span><span class="w"> </span><span class="nv">b</span><span class="p">,</span><span class="w"> </span><span class="kt">address</span><span class="w"> </span><span class="nv">c</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">d</span><span class="p">,</span><span class="w"> </span><span class="kt">address</span><span class="w"> </span><span class="nv">e</span><span class="p">,</span><span class="w"> </span><span class="kt">address</span><span class="w"> </span><span class="nv">f</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span>doSomething<span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">function</span><span class="w"> </span><span class="nv">thisFunctionHasLotsOfArguments</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">a</span><span class="p">,</span><span class="w"></span>
<span class="w">                                        </span><span class="kt">address</span><span class="w"> </span><span class="nv">b</span><span class="p">,</span><span class="w"></span>
<span class="w">                                        </span><span class="kt">address</span><span class="w"> </span><span class="nv">c</span><span class="p">,</span><span class="w"></span>
<span class="w">                                        </span><span class="kt">address</span><span class="w"> </span><span class="nv">d</span><span class="p">,</span><span class="w"></span>
<span class="w">                                        </span><span class="kt">address</span><span class="w"> </span><span class="nv">e</span><span class="p">,</span><span class="w"></span>
<span class="w">                                        </span><span class="kt">address</span><span class="w"> </span><span class="nv">f</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span>doSomething<span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">function</span><span class="w"> </span><span class="nv">thisFunctionHasLotsOfArguments</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">a</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">b</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">c</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">d</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">e</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">f</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span>doSomething<span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>If a long function declaration has modifiers, then each modifier should be
dropped to its own line.</p>
<p>Yes:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=ZnVuY3Rpb24gdGhpc0Z1bmN0aW9uTmFtZUlzUmVhbGx5TG9uZyhhZGRyZXNzIHgsIGFkZHJlc3MgeSwgYWRkcmVzcyB6KQogICAgcHVibGljCiAgICBvbmx5T3duZXIKICAgIHByaWNlZAogICAgcmV0dXJucyAoYWRkcmVzcykKewogICAgZG9Tb21ldGhpbmcoKTsKfQoKZnVuY3Rpb24gdGhpc0Z1bmN0aW9uTmFtZUlzUmVhbGx5TG9uZygKICAgIGFkZHJlc3MgeCwKICAgIGFkZHJlc3MgeSwKICAgIGFkZHJlc3MgegopCiAgICBwdWJsaWMKICAgIG9ubHlPd25lcgogICAgcHJpY2VkCiAgICByZXR1cm5zIChhZGRyZXNzKQp7CiAgICBkb1NvbWV0aGluZygpOwp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">function</span><span class="w"> </span><span class="nv">thisFunctionNameIsReallyLong</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">x</span><span class="p">,</span><span class="w"> </span><span class="kt">address</span><span class="w"> </span><span class="nv">y</span><span class="p">,</span><span class="w"> </span><span class="kt">address</span><span class="w"> </span><span class="nv">z</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="kt">public</span><span class="w"></span>
<span class="w">    </span>onlyOwner<span class="w"></span>
<span class="w">    </span>priced<span class="w"></span>
<span class="w">    </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">address</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span>doSomething<span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">function</span><span class="w"> </span><span class="nv">thisFunctionNameIsReallyLong</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">x</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">y</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">z</span><span class="w"></span>
<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="kt">public</span><span class="w"></span>
<span class="w">    </span>onlyOwner<span class="w"></span>
<span class="w">    </span>priced<span class="w"></span>
<span class="w">    </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">address</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span>doSomething<span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>No:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=ZnVuY3Rpb24gdGhpc0Z1bmN0aW9uTmFtZUlzUmVhbGx5TG9uZyhhZGRyZXNzIHgsIGFkZHJlc3MgeSwgYWRkcmVzcyB6KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1YmxpYwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9ubHlPd25lcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaWNlZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybnMgKGFkZHJlc3MpIHsKICAgIGRvU29tZXRoaW5nKCk7Cn0KCmZ1bmN0aW9uIHRoaXNGdW5jdGlvbk5hbWVJc1JlYWxseUxvbmcoYWRkcmVzcyB4LCBhZGRyZXNzIHksIGFkZHJlc3MgeikKICAgIHB1YmxpYyBvbmx5T3duZXIgcHJpY2VkIHJldHVybnMgKGFkZHJlc3MpCnsKICAgIGRvU29tZXRoaW5nKCk7Cn0KCmZ1bmN0aW9uIHRoaXNGdW5jdGlvbk5hbWVJc1JlYWxseUxvbmcoYWRkcmVzcyB4LCBhZGRyZXNzIHksIGFkZHJlc3MgeikKICAgIHB1YmxpYwogICAgb25seU93bmVyCiAgICBwcmljZWQKICAgIHJldHVybnMgKGFkZHJlc3MpIHsKICAgIGRvU29tZXRoaW5nKCk7Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">function</span><span class="w"> </span><span class="nv">thisFunctionNameIsReallyLong</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">x</span><span class="p">,</span><span class="w"> </span><span class="kt">address</span><span class="w"> </span><span class="nv">y</span><span class="p">,</span><span class="w"> </span><span class="kt">address</span><span class="w"> </span><span class="nv">z</span><span class="p">)</span><span class="w"></span>
<span class="w">                                      </span><span class="kt">public</span><span class="w"></span>
<span class="w">                                      </span>onlyOwner<span class="w"></span>
<span class="w">                                      </span>priced<span class="w"></span>
<span class="w">                                      </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">address</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span>doSomething<span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">function</span><span class="w"> </span><span class="nv">thisFunctionNameIsReallyLong</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">x</span><span class="p">,</span><span class="w"> </span><span class="kt">address</span><span class="w"> </span><span class="nv">y</span><span class="p">,</span><span class="w"> </span><span class="kt">address</span><span class="w"> </span><span class="nv">z</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="kt">public</span><span class="w"> </span>onlyOwner<span class="w"> </span>priced<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">address</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span>doSomething<span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">function</span><span class="w"> </span><span class="nv">thisFunctionNameIsReallyLong</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">x</span><span class="p">,</span><span class="w"> </span><span class="kt">address</span><span class="w"> </span><span class="nv">y</span><span class="p">,</span><span class="w"> </span><span class="kt">address</span><span class="w"> </span><span class="nv">z</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="kt">public</span><span class="w"></span>
<span class="w">    </span>onlyOwner<span class="w"></span>
<span class="w">    </span>priced<span class="w"></span>
<span class="w">    </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">address</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span>doSomething<span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Multiline output parameters and return statements should follow the same style recommended for wrapping long lines found in the <a class="reference internal" href="#maximum-line-length"><span class="std std-ref">Maximum Line Length</span></a> section.</p>
<p>Yes:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=ZnVuY3Rpb24gdGhpc0Z1bmN0aW9uTmFtZUlzUmVhbGx5TG9uZygKICAgIGFkZHJlc3MgYSwKICAgIGFkZHJlc3MgYiwKICAgIGFkZHJlc3MgYwopCiAgICBwdWJsaWMKICAgIHJldHVybnMgKAogICAgICAgIGFkZHJlc3Mgc29tZUFkZHJlc3NOYW1lLAogICAgICAgIHVpbnQyNTYgTG9uZ0FyZ3VtZW50LAogICAgICAgIHVpbnQyNTYgQXJndW1lbnQKICAgICkKewogICAgZG9Tb21ldGhpbmcoKQoKICAgIHJldHVybiAoCiAgICAgICAgdmVyeUxvbmdSZXR1cm5BcmcxLAogICAgICAgIHZlcnlMb25nUmV0dXJuQXJnMiwKICAgICAgICB2ZXJ5TG9uZ1JldHVybkFyZzMKICAgICk7Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">function</span><span class="w"> </span><span class="nv">thisFunctionNameIsReallyLong</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">a</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">b</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">c</span><span class="w"></span>
<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="kt">public</span><span class="w"></span>
<span class="w">    </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">someAddressName</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">LongArgument</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">Argument</span><span class="w"></span>
<span class="w">    </span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span>doSomething<span class="p">()</span><span class="w"></span>

<span class="w">    </span><span class="kt">return</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">        </span>veryLongReturnArg1<span class="p">,</span><span class="w"></span>
<span class="w">        </span>veryLongReturnArg2<span class="p">,</span><span class="w"></span>
<span class="w">        </span>veryLongReturnArg3<span class="w"></span>
<span class="w">    </span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>No:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=ZnVuY3Rpb24gdGhpc0Z1bmN0aW9uTmFtZUlzUmVhbGx5TG9uZygKICAgIGFkZHJlc3MgYSwKICAgIGFkZHJlc3MgYiwKICAgIGFkZHJlc3MgYwopCiAgICBwdWJsaWMKICAgIHJldHVybnMgKGFkZHJlc3Mgc29tZUFkZHJlc3NOYW1lLAogICAgICAgICAgICAgdWludDI1NiBMb25nQXJndW1lbnQsCiAgICAgICAgICAgICB1aW50MjU2IEFyZ3VtZW50KQp7CiAgICBkb1NvbWV0aGluZygpCgogICAgcmV0dXJuICh2ZXJ5TG9uZ1JldHVybkFyZzEsCiAgICAgICAgICAgIHZlcnlMb25nUmV0dXJuQXJnMSwKICAgICAgICAgICAgdmVyeUxvbmdSZXR1cm5BcmcxKTsKfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">function</span><span class="w"> </span><span class="nv">thisFunctionNameIsReallyLong</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">a</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">b</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">c</span><span class="w"></span>
<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="kt">public</span><span class="w"></span>
<span class="w">    </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">someAddressName</span><span class="p">,</span><span class="w"></span>
<span class="w">             </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">LongArgument</span><span class="p">,</span><span class="w"></span>
<span class="w">             </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">Argument</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span>doSomething<span class="p">()</span><span class="w"></span>

<span class="w">    </span><span class="kt">return</span><span class="w"> </span><span class="p">(</span>veryLongReturnArg1<span class="p">,</span><span class="w"></span>
<span class="w">            </span>veryLongReturnArg1<span class="p">,</span><span class="w"></span>
<span class="w">            </span>veryLongReturnArg1<span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>For constructor functions on inherited contracts whose bases require arguments,
it is recommended to drop the base constructors onto new lines in the same
manner as modifiers if the function declaration is long or hard to read.</p>
<p>Yes:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC43LjAgPDAuOS4wOwovLyBCYXNlIGNvbnRyYWN0cyBqdXN0IHRvIG1ha2UgdGhpcyBjb21waWxlCmNvbnRyYWN0IEIgewogICAgY29uc3RydWN0b3IodWludCkgewogICAgfQp9CgoKY29udHJhY3QgQyB7CiAgICBjb25zdHJ1Y3Rvcih1aW50LCB1aW50KSB7CiAgICB9Cn0KCgpjb250cmFjdCBEIHsKICAgIGNvbnN0cnVjdG9yKHVpbnQpIHsKICAgIH0KfQoKCmNvbnRyYWN0IEEgaXMgQiwgQywgRCB7CiAgICB1aW50IHg7CgogICAgY29uc3RydWN0b3IodWludCBwYXJhbTEsIHVpbnQgcGFyYW0yLCB1aW50IHBhcmFtMywgdWludCBwYXJhbTQsIHVpbnQgcGFyYW01KQogICAgICAgIEIocGFyYW0xKQogICAgICAgIEMocGFyYW0yLCBwYXJhbTMpCiAgICAgICAgRChwYXJhbTQpCiAgICB7CiAgICAgICAgLy8gZG8gc29tZXRoaW5nIHdpdGggcGFyYW01CiAgICAgICAgeCA9IHBhcmFtNTsKICAgIH0KfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.7.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>
<span class="c1">// Base contracts just to make this compile</span>
<span class="k">contract</span><span class="w"> </span><span class="ni">B</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">constructor</span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>


<span class="k">contract</span><span class="w"> </span><span class="ni">C</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">constructor</span><span class="p">(</span><span class="kt">uint</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>


<span class="k">contract</span><span class="w"> </span><span class="ni">D</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">constructor</span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>


<span class="k">contract</span><span class="w"> </span><span class="ni">A</span><span class="w"> </span><span class="kt">is</span><span class="w"> </span>B<span class="p">,</span><span class="w"> </span>C<span class="p">,</span><span class="w"> </span>D<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="nv">x</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kt">constructor</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">param1</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">param2</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">param3</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">param4</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">param5</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span>B<span class="p">(</span>param1<span class="p">)</span><span class="w"></span>
<span class="w">        </span>C<span class="p">(</span>param2<span class="p">,</span><span class="w"> </span>param3<span class="p">)</span><span class="w"></span>
<span class="w">        </span>D<span class="p">(</span>param4<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// do something with param5</span>
<span class="w">        </span>x<span class="w"> </span><span class="o">=</span><span class="w"> </span>param5<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>No:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC43LjAgPDAuOS4wOwoKLy8gQmFzZSBjb250cmFjdHMganVzdCB0byBtYWtlIHRoaXMgY29tcGlsZQpjb250cmFjdCBCIHsKICAgIGNvbnN0cnVjdG9yKHVpbnQpIHsKICAgIH0KfQoKCmNvbnRyYWN0IEMgewogICAgY29uc3RydWN0b3IodWludCwgdWludCkgewogICAgfQp9CgoKY29udHJhY3QgRCB7CiAgICBjb25zdHJ1Y3Rvcih1aW50KSB7CiAgICB9Cn0KCgpjb250cmFjdCBBIGlzIEIsIEMsIEQgewogICAgdWludCB4OwoKICAgIGNvbnN0cnVjdG9yKHVpbnQgcGFyYW0xLCB1aW50IHBhcmFtMiwgdWludCBwYXJhbTMsIHVpbnQgcGFyYW00LCB1aW50IHBhcmFtNSkKICAgIEIocGFyYW0xKQogICAgQyhwYXJhbTIsIHBhcmFtMykKICAgIEQocGFyYW00KSB7CiAgICAgICAgeCA9IHBhcmFtNTsKICAgIH0KfQoKCmNvbnRyYWN0IFggaXMgQiwgQywgRCB7CiAgICB1aW50IHg7CgogICAgY29uc3RydWN0b3IodWludCBwYXJhbTEsIHVpbnQgcGFyYW0yLCB1aW50IHBhcmFtMywgdWludCBwYXJhbTQsIHVpbnQgcGFyYW01KQogICAgICAgIEIocGFyYW0xKQogICAgICAgIEMocGFyYW0yLCBwYXJhbTMpCiAgICAgICAgRChwYXJhbTQpIHsKICAgICAgICAgICAgeCA9IHBhcmFtNTsKICAgICAgICB9Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.7.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="c1">// Base contracts just to make this compile</span>
<span class="k">contract</span><span class="w"> </span><span class="ni">B</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">constructor</span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>


<span class="k">contract</span><span class="w"> </span><span class="ni">C</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">constructor</span><span class="p">(</span><span class="kt">uint</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>


<span class="k">contract</span><span class="w"> </span><span class="ni">D</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">constructor</span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>


<span class="k">contract</span><span class="w"> </span><span class="ni">A</span><span class="w"> </span><span class="kt">is</span><span class="w"> </span>B<span class="p">,</span><span class="w"> </span>C<span class="p">,</span><span class="w"> </span>D<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="nv">x</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kt">constructor</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">param1</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">param2</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">param3</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">param4</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">param5</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span>B<span class="p">(</span>param1<span class="p">)</span><span class="w"></span>
<span class="w">    </span>C<span class="p">(</span>param2<span class="p">,</span><span class="w"> </span>param3<span class="p">)</span><span class="w"></span>
<span class="w">    </span>D<span class="p">(</span>param4<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>x<span class="w"> </span><span class="o">=</span><span class="w"> </span>param5<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>


<span class="k">contract</span><span class="w"> </span><span class="ni">X</span><span class="w"> </span><span class="kt">is</span><span class="w"> </span>B<span class="p">,</span><span class="w"> </span>C<span class="p">,</span><span class="w"> </span>D<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="nv">x</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kt">constructor</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">param1</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">param2</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">param3</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">param4</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nv">param5</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span>B<span class="p">(</span>param1<span class="p">)</span><span class="w"></span>
<span class="w">        </span>C<span class="p">(</span>param2<span class="p">,</span><span class="w"> </span>param3<span class="p">)</span><span class="w"></span>
<span class="w">        </span>D<span class="p">(</span>param4<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span>x<span class="w"> </span><span class="o">=</span><span class="w"> </span>param5<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>When declaring short functions with a single statement, it is permissible to do it on a single line.</p>
<p>Permissible:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=ZnVuY3Rpb24gc2hvcnRGdW5jdGlvbigpIHB1YmxpYyB7IGRvU29tZXRoaW5nKCk7IH0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">function</span><span class="w"> </span><span class="nv">shortFunction</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>doSomething<span class="p">();</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>These guidelines for function declarations are intended to improve readability.
Authors should use their best judgment as this guide does not try to cover all
possible permutations for function declarations.</p>
</section>
<section id="mappings">
<h4>Mappings<a class="headerlink" href="#mappings" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>In variable declarations, do not separate the keyword <code class="docutils literal notranslate"><span class="pre">mapping</span></code> from its
type by a space. Do not separate any nested <code class="docutils literal notranslate"><span class="pre">mapping</span></code> keyword from its type by
whitespace.</p>
<p>Yes:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=bWFwcGluZyh1aW50ID0+IHVpbnQpIG1hcDsKbWFwcGluZyhhZGRyZXNzID0+IGJvb2wpIHJlZ2lzdGVyZWRBZGRyZXNzZXM7Cm1hcHBpbmcodWludCA9PiBtYXBwaW5nKGJvb2wgPT4gRGF0YVtdKSkgcHVibGljIGRhdGE7Cm1hcHBpbmcodWludCA9PiBtYXBwaW5nKHVpbnQgPT4gcykpIGRhdGE7"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">mapping</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span>map<span class="p">;</span><span class="w"></span>
<span class="kt">mapping</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span>registeredAddresses<span class="p">;</span><span class="w"></span>
<span class="kt">mapping</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span>Data<span class="p">[]))</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>data<span class="p">;</span><span class="w"></span>
<span class="kt">mapping</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span>s<span class="p">))</span><span class="w"> </span>data<span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>No:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=bWFwcGluZyAodWludCA9PiB1aW50KSBtYXA7Cm1hcHBpbmcoIGFkZHJlc3MgPT4gYm9vbCApIHJlZ2lzdGVyZWRBZGRyZXNzZXM7Cm1hcHBpbmcgKHVpbnQgPT4gbWFwcGluZyAoYm9vbCA9PiBEYXRhW10pKSBwdWJsaWMgZGF0YTsKbWFwcGluZyh1aW50ID0+IG1hcHBpbmcgKHVpbnQgPT4gcykpIGRhdGE7"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">mapping</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span>map<span class="p">;</span><span class="w"></span>
<span class="kt">mapping</span><span class="p">(</span><span class="w"> </span><span class="kt">address</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">)</span><span class="w"> </span>registeredAddresses<span class="p">;</span><span class="w"></span>
<span class="kt">mapping</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">mapping</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span>Data<span class="p">[]))</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>data<span class="p">;</span><span class="w"></span>
<span class="kt">mapping</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">mapping</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span>s<span class="p">))</span><span class="w"> </span>data<span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="variable-declarations">
<h4>Variable Declarations<a class="headerlink" href="#variable-declarations" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Declarations of array variables should not have a space between the type and
the brackets.</p>
<p>Yes:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=dWludFtdIHg7"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">uint</span><span class="p">[]</span><span class="w"> </span>x<span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>No:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=dWludCBbXSB4Ow=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">uint</span><span class="w"> </span><span class="p">[]</span><span class="w"> </span>x<span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="other-recommendations">
<h4>Other Recommendations<a class="headerlink" href="#other-recommendations" title="Permalink to this heading">ÔÉÅ</a></h4>
<ul class="simple">
<li><p>Strings should be quoted with double-quotes instead of single-quotes.</p></li>
</ul>
<p>Yes:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=c3RyID0gImZvbyI7CnN0ciA9ICJIYW1sZXQgc2F5cywgJ1RvIGJlIG9yIG5vdCB0byBiZS4uLiciOw=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span>str<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;foo&quot;</span><span class="p">;</span><span class="w"></span>
str<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Hamlet says, &#39;To be or not to be...&#39;&quot;</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>No:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=c3RyID0gJ2Jhcic7CnN0ciA9ICciQmUgeW91cnNlbGY7IGV2ZXJ5b25lIGVsc2UgaXMgYWxyZWFkeSB0YWtlbi4iIC1Pc2NhciBXaWxkZSc7"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span>str<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;bar&#39;</span><span class="p">;</span><span class="w"></span>
str<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&quot;Be yourself; everyone else is already taken.&quot; -Oscar Wilde&#39;</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><p>Surround operators with a single space on either side.</p></li>
</ul>
<p>Yes:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=eCA9IDM7CnggPSAxMDAgLyAxMDsKeCArPSAzICsgNDsKeCB8PSB5ICYmIHo7"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span>x<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">3</span><span class="p">;</span><span class="w"></span>
x<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">100</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m m-Decimal">10</span><span class="p">;</span><span class="w"></span>
x<span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="m m-Decimal">3</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m m-Decimal">4</span><span class="p">;</span><span class="w"></span>
x<span class="w"> </span><span class="err">|</span><span class="o">=</span><span class="w"> </span>y<span class="w"> </span><span class="err">&amp;&amp;</span><span class="w"> </span>z<span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>No:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=eD0zOwp4ID0gMTAwLzEwOwp4ICs9IDMrNDsKeCB8PSB5JiZ6Ow=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span>x<span class="o">=</span><span class="m m-Decimal">3</span><span class="p">;</span><span class="w"></span>
x<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">100</span><span class="o">/</span><span class="m m-Decimal">10</span><span class="p">;</span><span class="w"></span>
x<span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="m m-Decimal">3</span><span class="o">+</span><span class="m m-Decimal">4</span><span class="p">;</span><span class="w"></span>
x<span class="w"> </span><span class="err">|</span><span class="o">=</span><span class="w"> </span>y<span class="err">&amp;&amp;</span>z<span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><p>Operators with a higher priority than others can exclude surrounding
whitespace in order to denote precedence.  This is meant to allow for
improved readability for complex statements. You should always use the same
amount of whitespace on either side of an operator:</p></li>
</ul>
<p>Yes:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=eCA9IDIqKjMgKyA1Owp4ID0gMip5ICsgMyp6Owp4ID0gKGErYikgKiAoYS1iKTs="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span>x<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">2</span><span class="o">**</span><span class="m m-Decimal">3</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m m-Decimal">5</span><span class="p">;</span><span class="w"></span>
x<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">2</span><span class="o">*</span>y<span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m m-Decimal">3</span><span class="o">*</span>z<span class="p">;</span><span class="w"></span>
x<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span>a<span class="o">+</span>b<span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span>a<span class="o">-</span>b<span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>No:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=eCA9IDIqKiAzICsgNTsKeCA9IHkrejsKeCArPTE7"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span>x<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">2</span><span class="o">**</span><span class="w"> </span><span class="m m-Decimal">3</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m m-Decimal">5</span><span class="p">;</span><span class="w"></span>
x<span class="w"> </span><span class="o">=</span><span class="w"> </span>y<span class="o">+</span>z<span class="p">;</span><span class="w"></span>
x<span class="w"> </span><span class="o">+=</span><span class="m m-Decimal">1</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
<section id="order-of-layout">
<h3>Order of Layout<a class="headerlink" href="#order-of-layout" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Layout contract elements in the following order:</p>
<ol class="arabic simple">
<li><p>Pragma statements</p></li>
<li><p>Import statements</p></li>
<li><p>Interfaces</p></li>
<li><p>Libraries</p></li>
<li><p>Contracts</p></li>
</ol>
<p>Inside each contract, library or interface, use the following order:</p>
<ol class="arabic simple">
<li><p>Type declarations</p></li>
<li><p>State variables</p></li>
<li><p>Events</p></li>
<li><p>Modifiers</p></li>
<li><p>Functions</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It might be clearer to declare types close to their use in events or state
variables.</p>
</div>
</section>
<section id="naming-conventions">
<h3>Naming Conventions<a class="headerlink" href="#naming-conventions" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Naming conventions are powerful when adopted and used broadly.  The use of
different conventions can convey significant <em>meta</em> information that would
otherwise not be immediately available.</p>
<p>The naming recommendations given here are intended to improve the readability,
and thus they are not rules, but rather guidelines to try and help convey the
most information through the names of things.</p>
<p>Lastly, consistency within a codebase should always supersede any conventions
outlined in this document.</p>
<section id="naming-styles">
<h4>Naming Styles<a class="headerlink" href="#naming-styles" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>To avoid confusion, the following names will be used to refer to different
naming styles.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">b</span></code> (single lowercase letter)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">B</span></code> (single uppercase letter)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lowercase</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">UPPERCASE</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">UPPER_CASE_WITH_UNDERSCORES</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CapitalizedWords</span></code> (or CapWords)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mixedCase</span></code> (differs from CapitalizedWords by initial lowercase character!)</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When using initialisms in CapWords, capitalize all the letters of the initialisms. Thus HTTPServerError is better than HttpServerError. When using initialisms in mixedCase, capitalize all the letters of the initialisms, except keep the first one lower case if it is the beginning of the name. Thus xmlHTTPRequest is better than XMLHTTPRequest.</p>
</div>
</section>
<section id="names-to-avoid">
<h4>Names to Avoid<a class="headerlink" href="#names-to-avoid" title="Permalink to this heading">ÔÉÅ</a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">l</span></code> - Lowercase letter el</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">O</span></code> - Uppercase letter oh</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">I</span></code> - Uppercase letter eye</p></li>
</ul>
<p>Never use any of these for single letter variable names.  They are often
indistinguishable from the numerals one and zero.</p>
</section>
<section id="contract-and-library-names">
<h4>Contract and Library Names<a class="headerlink" href="#contract-and-library-names" title="Permalink to this heading">ÔÉÅ</a></h4>
<ul class="simple">
<li><p>Contracts and libraries should be named using the CapWords style. Examples: <code class="docutils literal notranslate"><span class="pre">SimpleToken</span></code>, <code class="docutils literal notranslate"><span class="pre">SmartBank</span></code>, <code class="docutils literal notranslate"><span class="pre">CertificateHashRepository</span></code>, <code class="docutils literal notranslate"><span class="pre">Player</span></code>, <code class="docutils literal notranslate"><span class="pre">Congress</span></code>, <code class="docutils literal notranslate"><span class="pre">Owned</span></code>.</p></li>
<li><p>Contract and library names should also match their filenames.</p></li>
<li><p>If a contract file includes multiple contracts and/or libraries, then the filename should match the <em>core contract</em>. This is not recommended however if it can be avoided.</p></li>
</ul>
<p>As shown in the example below, if the contract name is <code class="docutils literal notranslate"><span class="pre">Congress</span></code> and the library name is <code class="docutils literal notranslate"><span class="pre">Owned</span></code>, then their associated filenames should be <code class="docutils literal notranslate"><span class="pre">Congress.sol</span></code> and <code class="docutils literal notranslate"><span class="pre">Owned.sol</span></code>.</p>
<p>Yes:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC43LjAgPDAuOS4wOwoKLy8gT3duZWQuc29sCmNvbnRyYWN0IE93bmVkIHsKICAgIGFkZHJlc3MgcHVibGljIG93bmVyOwoKICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICAgICAgXzsKICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBvd25lciA9IG5ld093bmVyOwogICAgfQp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.7.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="c1">// Owned.sol</span>
<span class="k">contract</span><span class="w"> </span><span class="ni">Owned</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="k">public </span><span class="nv">owner</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kt">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>owner<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">msg.sender</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">modifier</span><span class="w"> </span>onlyOwner<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span><span class="k">msg.sender</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>owner<span class="p">);</span><span class="w"></span>
<span class="w">        </span>_<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">transferOwnership</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">newOwner</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>onlyOwner<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>owner<span class="w"> </span><span class="o">=</span><span class="w"> </span>newOwner<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>and in <code class="docutils literal notranslate"><span class="pre">Congress.sol</span></code>:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC40LjAgPDAuOS4wOwoKaW1wb3J0ICIuL093bmVkLnNvbCI7CgoKY29udHJhY3QgQ29uZ3Jlc3MgaXMgT3duZWQsIFRva2VuUmVjaXBpZW50IHsKICAgIC8vLi4uCn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.4.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="kt">import</span><span class="w"> </span><span class="s2">&quot;./Owned.sol&quot;</span><span class="p">;</span><span class="w"></span>


<span class="k">contract</span><span class="w"> </span><span class="ni">Congress</span><span class="w"> </span><span class="kt">is</span><span class="w"> </span>Owned<span class="p">,</span><span class="w"> </span>TokenRecipient<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">//...</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>No:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC43LjAgPDAuOS4wOwoKLy8gb3duZWQuc29sCmNvbnRyYWN0IG93bmVkIHsKICAgIGFkZHJlc3MgcHVibGljIG93bmVyOwoKICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgIG93bmVyID0gbXNnLnNlbmRlcjsKICAgIH0KCiAgICBtb2RpZmllciBvbmx5T3duZXIgewogICAgICAgIHJlcXVpcmUobXNnLnNlbmRlciA9PSBvd25lcik7CiAgICAgICAgXzsKICAgIH0KCiAgICBmdW5jdGlvbiB0cmFuc2Zlck93bmVyc2hpcChhZGRyZXNzIG5ld093bmVyKSBwdWJsaWMgb25seU93bmVyIHsKICAgICAgICBvd25lciA9IG5ld093bmVyOwogICAgfQp9"><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.7.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="c1">// owned.sol</span>
<span class="k">contract</span><span class="w"> </span><span class="ni">owned</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="k">public </span><span class="nv">owner</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kt">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>owner<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">msg.sender</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">modifier</span><span class="w"> </span>onlyOwner<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">require</span><span class="p">(</span><span class="k">msg.sender</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>owner<span class="p">);</span><span class="w"></span>
<span class="w">        </span>_<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">transferOwnership</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">newOwner</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>onlyOwner<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>owner<span class="w"> </span><span class="o">=</span><span class="w"> </span>newOwner<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>and in <code class="docutils literal notranslate"><span class="pre">Congress.sol</span></code>:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5IF4wLjcuMDsKCgppbXBvcnQgIi4vb3duZWQuc29sIjsKCgpjb250cmFjdCBDb25ncmVzcyBpcyBvd25lZCwgdG9rZW5SZWNpcGllbnQgewogICAgLy8uLi4KfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.7.0</span><span class="p">;</span><span class="w"></span>


<span class="kt">import</span><span class="w"> </span><span class="s2">&quot;./owned.sol&quot;</span><span class="p">;</span><span class="w"></span>


<span class="k">contract</span><span class="w"> </span><span class="ni">Congress</span><span class="w"> </span><span class="kt">is</span><span class="w"> </span>owned<span class="p">,</span><span class="w"> </span>tokenRecipient<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">//...</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="struct-names">
<h4>Struct Names<a class="headerlink" href="#struct-names" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Structs should be named using the CapWords style. Examples: <code class="docutils literal notranslate"><span class="pre">MyCoin</span></code>, <code class="docutils literal notranslate"><span class="pre">Position</span></code>, <code class="docutils literal notranslate"><span class="pre">PositionXY</span></code>.</p>
</section>
<section id="event-names">
<h4>Event Names<a class="headerlink" href="#event-names" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Events should be named using the CapWords style. Examples: <code class="docutils literal notranslate"><span class="pre">Deposit</span></code>, <code class="docutils literal notranslate"><span class="pre">Transfer</span></code>, <code class="docutils literal notranslate"><span class="pre">Approval</span></code>, <code class="docutils literal notranslate"><span class="pre">BeforeTransfer</span></code>, <code class="docutils literal notranslate"><span class="pre">AfterTransfer</span></code>.</p>
</section>
<section id="function-names">
<h4>Function Names<a class="headerlink" href="#function-names" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Functions should use mixedCase. Examples: <code class="docutils literal notranslate"><span class="pre">getBalance</span></code>, <code class="docutils literal notranslate"><span class="pre">transfer</span></code>, <code class="docutils literal notranslate"><span class="pre">verifyOwner</span></code>, <code class="docutils literal notranslate"><span class="pre">addMember</span></code>, <code class="docutils literal notranslate"><span class="pre">changeOwner</span></code>.</p>
</section>
<section id="function-argument-names">
<h4>Function Argument Names<a class="headerlink" href="#function-argument-names" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Function arguments should use mixedCase. Examples: <code class="docutils literal notranslate"><span class="pre">initialSupply</span></code>, <code class="docutils literal notranslate"><span class="pre">account</span></code>, <code class="docutils literal notranslate"><span class="pre">recipientAddress</span></code>, <code class="docutils literal notranslate"><span class="pre">senderAddress</span></code>, <code class="docutils literal notranslate"><span class="pre">newOwner</span></code>.</p>
<p>When writing library functions that operate on a custom struct, the struct
should be the first argument and should always be named <code class="docutils literal notranslate"><span class="pre">self</span></code>.</p>
</section>
<section id="local-and-state-variable-names">
<h4>Local and State Variable Names<a class="headerlink" href="#local-and-state-variable-names" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Use mixedCase. Examples: <code class="docutils literal notranslate"><span class="pre">totalSupply</span></code>, <code class="docutils literal notranslate"><span class="pre">remainingSupply</span></code>, <code class="docutils literal notranslate"><span class="pre">balancesOf</span></code>, <code class="docutils literal notranslate"><span class="pre">creatorAddress</span></code>, <code class="docutils literal notranslate"><span class="pre">isPreSale</span></code>, <code class="docutils literal notranslate"><span class="pre">tokenExchangeRate</span></code>.</p>
</section>
<section id="constants">
<h4>Constants<a class="headerlink" href="#constants" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Constants should be named with all capital letters with underscores separating
words. Examples: <code class="docutils literal notranslate"><span class="pre">MAX_BLOCKS</span></code>, <code class="docutils literal notranslate"><span class="pre">TOKEN_NAME</span></code>, <code class="docutils literal notranslate"><span class="pre">TOKEN_TICKER</span></code>, <code class="docutils literal notranslate"><span class="pre">CONTRACT_VERSION</span></code>.</p>
</section>
<section id="modifier-names">
<h4>Modifier Names<a class="headerlink" href="#modifier-names" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Use mixedCase. Examples: <code class="docutils literal notranslate"><span class="pre">onlyBy</span></code>, <code class="docutils literal notranslate"><span class="pre">onlyAfter</span></code>, <code class="docutils literal notranslate"><span class="pre">onlyDuringThePreSale</span></code>.</p>
</section>
<section id="enums">
<h4>Enums<a class="headerlink" href="#enums" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Enums, in the style of simple type declarations, should be named using the CapWords style. Examples: <code class="docutils literal notranslate"><span class="pre">TokenGroup</span></code>, <code class="docutils literal notranslate"><span class="pre">Frame</span></code>, <code class="docutils literal notranslate"><span class="pre">HashStyle</span></code>, <code class="docutils literal notranslate"><span class="pre">CharacterLocation</span></code>.</p>
</section>
<section id="avoiding-naming-collisions">
<h4>Avoiding Naming Collisions<a class="headerlink" href="#avoiding-naming-collisions" title="Permalink to this heading">ÔÉÅ</a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">singleTrailingUnderscore_</span></code></p></li>
</ul>
<p>This convention is suggested when the desired name collides with that of a
built-in or otherwise reserved name.</p>
</section>
</section>
<section id="natspec">
<span id="style-guide-natspec"></span><h3>NatSpec<a class="headerlink" href="#natspec" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Solidity contracts can also contain NatSpec comments. They are written with a
triple slash (<code class="docutils literal notranslate"><span class="pre">///</span></code>) or a double asterisk block (<code class="docutils literal notranslate"><span class="pre">/**</span> <span class="pre">...</span> <span class="pre">*/</span></code>) and
they should be used directly above function declarations or statements.</p>
<p>For example, the contract from <a class="reference internal" href="index.html#simple-smart-contract"><span class="std std-ref">a simple smart contract</span></a> with the comments
added looks like the one below:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5ID49MC40LjE2IDwwLjkuMDsKCi8vLyBAYXV0aG9yIFRoZSBTb2xpZGl0eSBUZWFtCi8vLyBAdGl0bGUgQSBzaW1wbGUgc3RvcmFnZSBleGFtcGxlCmNvbnRyYWN0IFNpbXBsZVN0b3JhZ2UgewogICAgdWludCBzdG9yZWREYXRhOwoKICAgIC8vLyBTdG9yZSBgeGAuCiAgICAvLy8gQHBhcmFtIHggdGhlIG5ldyB2YWx1ZSB0byBzdG9yZQogICAgLy8vIEBkZXYgc3RvcmVzIHRoZSBudW1iZXIgaW4gdGhlIHN0YXRlIHZhcmlhYmxlIGBzdG9yZWREYXRhYAogICAgZnVuY3Rpb24gc2V0KHVpbnQgeCkgcHVibGljIHsKICAgICAgICBzdG9yZWREYXRhID0geDsKICAgIH0KCiAgICAvLy8gUmV0dXJuIHRoZSBzdG9yZWQgdmFsdWUuCiAgICAvLy8gQGRldiByZXRyaWV2ZXMgdGhlIHZhbHVlIG9mIHRoZSBzdGF0ZSB2YXJpYWJsZSBgc3RvcmVkRGF0YWAKICAgIC8vLyBAcmV0dXJuIHRoZSBzdG9yZWQgdmFsdWUKICAgIGZ1bmN0aW9uIGdldCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKHVpbnQpIHsKICAgICAgICByZXR1cm4gc3RvcmVkRGF0YTsKICAgIH0KfQ=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.4.16</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="c1">/// @author The Solidity Team</span>
<span class="c1">/// @title A simple storage example</span>
<span class="k">contract</span><span class="w"> </span><span class="ni">SimpleStorage</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="nv">storedData</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// Store `x`.</span>
<span class="w">    </span><span class="c1">/// @param x the new value to store</span>
<span class="w">    </span><span class="c1">/// @dev stores the number in the state variable `storedData`</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">set</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">x</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>storedData<span class="w"> </span><span class="o">=</span><span class="w"> </span>x<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// Return the stored value.</span>
<span class="w">    </span><span class="c1">/// @dev retrieves the value of the state variable `storedData`</span>
<span class="w">    </span><span class="c1">/// @return the stored value</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">get</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span>storedData<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>It is recommended that Solidity contracts are fully annotated using <a class="reference internal" href="index.html#natspec"><span class="std std-ref">NatSpec</span></a> for all public interfaces (everything in the ABI).</p>
<p>Please see the section about <a class="reference internal" href="index.html#natspec"><span class="std std-ref">NatSpec</span></a> for a detailed explanation.</p>
</section>
</section>
<span id="document-common-patterns"></span><section id="common-patterns">
<h2>Common Patterns<a class="headerlink" href="#common-patterns" title="Permalink to this heading">ÔÉÅ</a></h2>
<section id="withdrawal-from-contracts">
<span id="withdrawal-pattern"></span><span id="index-0"></span><h3>Withdrawal from Contracts<a class="headerlink" href="#withdrawal-from-contracts" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>The recommended method of sending funds after an effect
is using the withdrawal pattern. Although the most intuitive
method of sending Ether, as a result of an effect, is a
direct <code class="docutils literal notranslate"><span class="pre">transfer</span></code> call, this is not recommended as it
introduces a potential security risk. You may read
more about this on the <a class="reference internal" href="index.html#security-considerations"><span class="std std-ref">Security Considerations</span></a> page.</p>
<p>The following is an example of the withdrawal pattern in practice in
a contract where the goal is to send the most money to the
contract in order to become the ‚Äúrichest‚Äù, inspired by
<a class="reference external" href="https://www.kingoftheether.com/">King of the Ether</a>.</p>
<p>In the following contract, if you are no longer the richest,
you receive the funds of the person who is now the richest.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5IF4wLjguNDsKCmNvbnRyYWN0IFdpdGhkcmF3YWxDb250cmFjdCB7CiAgICBhZGRyZXNzIHB1YmxpYyByaWNoZXN0OwogICAgdWludCBwdWJsaWMgbW9zdFNlbnQ7CgogICAgbWFwcGluZyAoYWRkcmVzcyA9PiB1aW50KSBwZW5kaW5nV2l0aGRyYXdhbHM7CgogICAgLy8vIFRoZSBhbW91bnQgb2YgRXRoZXIgc2VudCB3YXMgbm90IGhpZ2hlciB0aGFuCiAgICAvLy8gdGhlIGN1cnJlbnRseSBoaWdoZXN0IGFtb3VudC4KICAgIGVycm9yIE5vdEVub3VnaEV0aGVyKCk7CgogICAgY29uc3RydWN0b3IoKSBwYXlhYmxlIHsKICAgICAgICByaWNoZXN0ID0gbXNnLnNlbmRlcjsKICAgICAgICBtb3N0U2VudCA9IG1zZy52YWx1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBiZWNvbWVSaWNoZXN0KCkgcHVibGljIHBheWFibGUgewogICAgICAgIGlmIChtc2cudmFsdWUgPD0gbW9zdFNlbnQpIHJldmVydCBOb3RFbm91Z2hFdGhlcigpOwogICAgICAgIHBlbmRpbmdXaXRoZHJhd2Fsc1tyaWNoZXN0XSArPSBtc2cudmFsdWU7CiAgICAgICAgcmljaGVzdCA9IG1zZy5zZW5kZXI7CiAgICAgICAgbW9zdFNlbnQgPSBtc2cudmFsdWU7CiAgICB9CgogICAgZnVuY3Rpb24gd2l0aGRyYXcoKSBwdWJsaWMgewogICAgICAgIHVpbnQgYW1vdW50ID0gcGVuZGluZ1dpdGhkcmF3YWxzW21zZy5zZW5kZXJdOwogICAgICAgIC8vIFJlbWVtYmVyIHRvIHplcm8gdGhlIHBlbmRpbmcgcmVmdW5kIGJlZm9yZQogICAgICAgIC8vIHNlbmRpbmcgdG8gcHJldmVudCByZS1lbnRyYW5jeSBhdHRhY2tzCiAgICAgICAgcGVuZGluZ1dpdGhkcmF3YWxzW21zZy5zZW5kZXJdID0gMDsKICAgICAgICBwYXlhYmxlKG1zZy5zZW5kZXIpLnRyYW5zZmVyKGFtb3VudCk7CiAgICB9Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.8.4</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">WithdrawalContract</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="k">public </span><span class="nv">richest</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="k">public </span><span class="nv">mostSent</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kt">mapping</span><span class="w"> </span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span>pendingWithdrawals<span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// The amount of Ether sent was not higher than</span>
<span class="w">    </span><span class="c1">/// the currently highest amount.</span>
<span class="w">    </span>error<span class="w"> </span>NotEnoughEther<span class="p">();</span><span class="w"></span>

<span class="w">    </span><span class="kt">constructor</span><span class="p">()</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>richest<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">msg.sender</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span>mostSent<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">msg.value</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">becomeRichest</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span><span class="k">msg.value</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span>mostSent<span class="p">)</span><span class="w"> </span>revert<span class="w"> </span>NotEnoughEther<span class="p">();</span><span class="w"></span>
<span class="w">        </span>pendingWithdrawals<span class="p">[</span>richest<span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">msg.value</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span>richest<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">msg.sender</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span>mostSent<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">msg.value</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">withdraw</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint</span><span class="w"> </span><span class="nv">amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>pendingWithdrawals<span class="p">[</span><span class="k">msg.sender</span><span class="p">];</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Remember to zero the pending refund before</span>
<span class="w">        </span><span class="c1">// sending to prevent re-entrancy attacks</span>
<span class="w">        </span>pendingWithdrawals<span class="p">[</span><span class="k">msg.sender</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">payable</span><span class="p">(</span><span class="k">msg.sender</span><span class="p">).</span>transfer<span class="p">(</span>amount<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>This is as opposed to the more intuitive sending pattern:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5IF4wLjguNDsKCmNvbnRyYWN0IFNlbmRDb250cmFjdCB7CiAgICBhZGRyZXNzIHBheWFibGUgcHVibGljIHJpY2hlc3Q7CiAgICB1aW50IHB1YmxpYyBtb3N0U2VudDsKCiAgICAvLy8gVGhlIGFtb3VudCBvZiBFdGhlciBzZW50IHdhcyBub3QgaGlnaGVyIHRoYW4KICAgIC8vLyB0aGUgY3VycmVudGx5IGhpZ2hlc3QgYW1vdW50LgogICAgZXJyb3IgTm90RW5vdWdoRXRoZXIoKTsKCiAgICBjb25zdHJ1Y3RvcigpIHBheWFibGUgewogICAgICAgIHJpY2hlc3QgPSBwYXlhYmxlKG1zZy5zZW5kZXIpOwogICAgICAgIG1vc3RTZW50ID0gbXNnLnZhbHVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGJlY29tZVJpY2hlc3QoKSBwdWJsaWMgcGF5YWJsZSB7CiAgICAgICAgaWYgKG1zZy52YWx1ZSA8PSBtb3N0U2VudCkgcmV2ZXJ0IE5vdEVub3VnaEV0aGVyKCk7CiAgICAgICAgLy8gVGhpcyBsaW5lIGNhbiBjYXVzZSBwcm9ibGVtcyAoZXhwbGFpbmVkIGJlbG93KS4KICAgICAgICByaWNoZXN0LnRyYW5zZmVyKG1zZy52YWx1ZSk7CiAgICAgICAgcmljaGVzdCA9IHBheWFibGUobXNnLnNlbmRlcik7CiAgICAgICAgbW9zdFNlbnQgPSBtc2cudmFsdWU7CiAgICB9Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.8.4</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">SendContract</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="nv">payable</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>richest<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="k">public </span><span class="nv">mostSent</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// The amount of Ether sent was not higher than</span>
<span class="w">    </span><span class="c1">/// the currently highest amount.</span>
<span class="w">    </span>error<span class="w"> </span>NotEnoughEther<span class="p">();</span><span class="w"></span>

<span class="w">    </span><span class="kt">constructor</span><span class="p">()</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>richest<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">payable</span><span class="p">(</span><span class="k">msg.sender</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span>mostSent<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">msg.value</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">becomeRichest</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span><span class="k">msg.value</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span>mostSent<span class="p">)</span><span class="w"> </span>revert<span class="w"> </span>NotEnoughEther<span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="c1">// This line can cause problems (explained below).</span>
<span class="w">        </span>richest<span class="p">.</span>transfer<span class="p">(</span><span class="k">msg.value</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span>richest<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">payable</span><span class="p">(</span><span class="k">msg.sender</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span>mostSent<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">msg.value</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Notice that, in this example, an attacker could trap the
contract into an unusable state by causing <code class="docutils literal notranslate"><span class="pre">richest</span></code> to be
the address of a contract that has a receive or fallback function
which fails (e.g. by using <code class="docutils literal notranslate"><span class="pre">revert()</span></code> or by just
consuming more than the 2300 gas stipend transferred to them). That way,
whenever <code class="docutils literal notranslate"><span class="pre">transfer</span></code> is called to deliver funds to the
‚Äúpoisoned‚Äù contract, it will fail and thus also <code class="docutils literal notranslate"><span class="pre">becomeRichest</span></code>
will fail, with the contract being stuck forever.</p>
<p>In contrast, if you use the ‚Äúwithdraw‚Äù pattern from the first example,
the attacker can only cause his or her own withdraw to fail and not the
rest of the contract‚Äôs workings.</p>
</section>
<section id="restricting-access">
<span id="index-1"></span><h3>Restricting Access<a class="headerlink" href="#restricting-access" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Restricting access is a common pattern for contracts.
Note that you can never restrict any human or computer
from reading the content of your transactions or
your contract‚Äôs state. You can make it a bit harder
by using encryption, but if your contract is supposed
to read the data, so will everyone else.</p>
<p>You can restrict read access to your contract‚Äôs state
by <strong>other contracts</strong>. That is actually the default
unless you declare your state variables <code class="docutils literal notranslate"><span class="pre">public</span></code>.</p>
<p>Furthermore, you can restrict who can make modifications
to your contract‚Äôs state or call your contract‚Äôs
functions and this is what this section is about.</p>
<p id="index-2">The use of <strong>function modifiers</strong> makes these
restrictions highly readable.</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5IF4wLjguNDsKCmNvbnRyYWN0IEFjY2Vzc1Jlc3RyaWN0aW9uIHsKICAgIC8vIFRoZXNlIHdpbGwgYmUgYXNzaWduZWQgYXQgdGhlIGNvbnN0cnVjdGlvbgogICAgLy8gcGhhc2UsIHdoZXJlIGBtc2cuc2VuZGVyYCBpcyB0aGUgYWNjb3VudAogICAgLy8gY3JlYXRpbmcgdGhpcyBjb250cmFjdC4KICAgIGFkZHJlc3MgcHVibGljIG93bmVyID0gbXNnLnNlbmRlcjsKICAgIHVpbnQgcHVibGljIGNyZWF0aW9uVGltZSA9IGJsb2NrLnRpbWVzdGFtcDsKCiAgICAvLyBOb3cgZm9sbG93cyBhIGxpc3Qgb2YgZXJyb3JzIHRoYXQKICAgIC8vIHRoaXMgY29udHJhY3QgY2FuIGdlbmVyYXRlIHRvZ2V0aGVyCiAgICAvLyB3aXRoIGEgdGV4dHVhbCBleHBsYW5hdGlvbiBpbiBzcGVjaWFsCiAgICAvLyBjb21tZW50cy4KCiAgICAvLy8gU2VuZGVyIG5vdCBhdXRob3JpemVkIGZvciB0aGlzCiAgICAvLy8gb3BlcmF0aW9uLgogICAgZXJyb3IgVW5hdXRob3JpemVkKCk7CgogICAgLy8vIEZ1bmN0aW9uIGNhbGxlZCB0b28gZWFybHkuCiAgICBlcnJvciBUb29FYXJseSgpOwoKICAgIC8vLyBOb3QgZW5vdWdoIEV0aGVyIHNlbnQgd2l0aCBmdW5jdGlvbiBjYWxsLgogICAgZXJyb3IgTm90RW5vdWdoRXRoZXIoKTsKCiAgICAvLyBNb2RpZmllcnMgY2FuIGJlIHVzZWQgdG8gY2hhbmdlCiAgICAvLyB0aGUgYm9keSBvZiBhIGZ1bmN0aW9uLgogICAgLy8gSWYgdGhpcyBtb2RpZmllciBpcyB1c2VkLCBpdCB3aWxsCiAgICAvLyBwcmVwZW5kIGEgY2hlY2sgdGhhdCBvbmx5IHBhc3NlcwogICAgLy8gaWYgdGhlIGZ1bmN0aW9uIGlzIGNhbGxlZCBmcm9tCiAgICAvLyBhIGNlcnRhaW4gYWRkcmVzcy4KICAgIG1vZGlmaWVyIG9ubHlCeShhZGRyZXNzIGFjY291bnQpCiAgICB7CiAgICAgICAgaWYgKG1zZy5zZW5kZXIgIT0gYWNjb3VudCkKICAgICAgICAgICAgcmV2ZXJ0IFVuYXV0aG9yaXplZCgpOwogICAgICAgIC8vIERvIG5vdCBmb3JnZXQgdGhlICJfOyIhIEl0IHdpbGwKICAgICAgICAvLyBiZSByZXBsYWNlZCBieSB0aGUgYWN0dWFsIGZ1bmN0aW9uCiAgICAgICAgLy8gYm9keSB3aGVuIHRoZSBtb2RpZmllciBpcyB1c2VkLgogICAgICAgIF87CiAgICB9CgogICAgLy8vIE1ha2UgYG5ld093bmVyYCB0aGUgbmV3IG93bmVyIG9mIHRoaXMKICAgIC8vLyBjb250cmFjdC4KICAgIGZ1bmN0aW9uIGNoYW5nZU93bmVyKGFkZHJlc3MgbmV3T3duZXIpCiAgICAgICAgcHVibGljCiAgICAgICAgb25seUJ5KG93bmVyKQogICAgewogICAgICAgIG93bmVyID0gbmV3T3duZXI7CiAgICB9CgogICAgbW9kaWZpZXIgb25seUFmdGVyKHVpbnQgdGltZSkgewogICAgICAgIGlmIChibG9jay50aW1lc3RhbXAgPCB0aW1lKQogICAgICAgICAgICByZXZlcnQgVG9vRWFybHkoKTsKICAgICAgICBfOwogICAgfQoKICAgIC8vLyBFcmFzZSBvd25lcnNoaXAgaW5mb3JtYXRpb24uCiAgICAvLy8gTWF5IG9ubHkgYmUgY2FsbGVkIDYgd2Vla3MgYWZ0ZXIKICAgIC8vLyB0aGUgY29udHJhY3QgaGFzIGJlZW4gY3JlYXRlZC4KICAgIGZ1bmN0aW9uIGRpc293bigpCiAgICAgICAgcHVibGljCiAgICAgICAgb25seUJ5KG93bmVyKQogICAgICAgIG9ubHlBZnRlcihjcmVhdGlvblRpbWUgKyA2IHdlZWtzKQogICAgewogICAgICAgIGRlbGV0ZSBvd25lcjsKICAgIH0KCiAgICAvLyBUaGlzIG1vZGlmaWVyIHJlcXVpcmVzIGEgY2VydGFpbgogICAgLy8gZmVlIGJlaW5nIGFzc29jaWF0ZWQgd2l0aCBhIGZ1bmN0aW9uIGNhbGwuCiAgICAvLyBJZiB0aGUgY2FsbGVyIHNlbnQgdG9vIG11Y2gsIGhlIG9yIHNoZSBpcwogICAgLy8gcmVmdW5kZWQsIGJ1dCBvbmx5IGFmdGVyIHRoZSBmdW5jdGlvbiBib2R5LgogICAgLy8gVGhpcyB3YXMgZGFuZ2Vyb3VzIGJlZm9yZSBTb2xpZGl0eSB2ZXJzaW9uIDAuNC4wLAogICAgLy8gd2hlcmUgaXQgd2FzIHBvc3NpYmxlIHRvIHNraXAgdGhlIHBhcnQgYWZ0ZXIgYF87YC4KICAgIG1vZGlmaWVyIGNvc3RzKHVpbnQgYW1vdW50KSB7CiAgICAgICAgaWYgKG1zZy52YWx1ZSA8IGFtb3VudCkKICAgICAgICAgICAgcmV2ZXJ0IE5vdEVub3VnaEV0aGVyKCk7CgogICAgICAgIF87CiAgICAgICAgaWYgKG1zZy52YWx1ZSA+IGFtb3VudCkKICAgICAgICAgICAgcGF5YWJsZShtc2cuc2VuZGVyKS50cmFuc2Zlcihtc2cudmFsdWUgLSBhbW91bnQpOwogICAgfQoKICAgIGZ1bmN0aW9uIGZvcmNlT3duZXJDaGFuZ2UoYWRkcmVzcyBuZXdPd25lcikKICAgICAgICBwdWJsaWMKICAgICAgICBwYXlhYmxlCiAgICAgICAgY29zdHMoMjAwIGV0aGVyKQogICAgewogICAgICAgIG93bmVyID0gbmV3T3duZXI7CiAgICAgICAgLy8ganVzdCBzb21lIGV4YW1wbGUgY29uZGl0aW9uCiAgICAgICAgaWYgKHVpbnQxNjAob3duZXIpICYgMCA9PSAxKQogICAgICAgICAgICAvLyBUaGlzIGRpZCBub3QgcmVmdW5kIGZvciBTb2xpZGl0eQogICAgICAgICAgICAvLyBiZWZvcmUgdmVyc2lvbiAwLjQuMC4KICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIC8vIHJlZnVuZCBvdmVycGFpZCBmZWVzCiAgICB9Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.8.4</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">AccessRestriction</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// These will be assigned at the construction</span>
<span class="w">    </span><span class="c1">// phase, where `msg.sender` is the account</span>
<span class="w">    </span><span class="c1">// creating this contract.</span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="k">public </span><span class="nv">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">msg.sender</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="k">public </span><span class="nv">creationTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">block.timestamp</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Now follows a list of errors that</span>
<span class="w">    </span><span class="c1">// this contract can generate together</span>
<span class="w">    </span><span class="c1">// with a textual explanation in special</span>
<span class="w">    </span><span class="c1">// comments.</span>

<span class="w">    </span><span class="c1">/// Sender not authorized for this</span>
<span class="w">    </span><span class="c1">/// operation.</span>
<span class="w">    </span>error<span class="w"> </span>Unauthorized<span class="p">();</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// Function called too early.</span>
<span class="w">    </span>error<span class="w"> </span>TooEarly<span class="p">();</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// Not enough Ether sent with function call.</span>
<span class="w">    </span>error<span class="w"> </span>NotEnoughEther<span class="p">();</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Modifiers can be used to change</span>
<span class="w">    </span><span class="c1">// the body of a function.</span>
<span class="w">    </span><span class="c1">// If this modifier is used, it will</span>
<span class="w">    </span><span class="c1">// prepend a check that only passes</span>
<span class="w">    </span><span class="c1">// if the function is called from</span>
<span class="w">    </span><span class="c1">// a certain address.</span>
<span class="w">    </span><span class="kt">modifier</span><span class="w"> </span>onlyBy<span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">account</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span><span class="k">msg.sender</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span>account<span class="p">)</span><span class="w"></span>
<span class="w">            </span>revert<span class="w"> </span>Unauthorized<span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Do not forget the &quot;_;&quot;! It will</span>
<span class="w">        </span><span class="c1">// be replaced by the actual function</span>
<span class="w">        </span><span class="c1">// body when the modifier is used.</span>
<span class="w">        </span>_<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// Make `newOwner` the new owner of this</span>
<span class="w">    </span><span class="c1">/// contract.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">changeOwner</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">newOwner</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="kt">public</span><span class="w"></span>
<span class="w">        </span>onlyBy<span class="p">(</span>owner<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>owner<span class="w"> </span><span class="o">=</span><span class="w"> </span>newOwner<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">modifier</span><span class="w"> </span>onlyAfter<span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">time</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span><span class="k">block.timestamp</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>time<span class="p">)</span><span class="w"></span>
<span class="w">            </span>revert<span class="w"> </span>TooEarly<span class="p">();</span><span class="w"></span>
<span class="w">        </span>_<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">/// Erase ownership information.</span>
<span class="w">    </span><span class="c1">/// May only be called 6 weeks after</span>
<span class="w">    </span><span class="c1">/// the contract has been created.</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">disown</span><span class="p">()</span><span class="w"></span>
<span class="w">        </span><span class="kt">public</span><span class="w"></span>
<span class="w">        </span>onlyBy<span class="p">(</span>owner<span class="p">)</span><span class="w"></span>
<span class="w">        </span>onlyAfter<span class="p">(</span>creationTime<span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m m-Decimal">6</span><span class="w"> </span>weeks<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>delete<span class="w"> </span>owner<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">// This modifier requires a certain</span>
<span class="w">    </span><span class="c1">// fee being associated with a function call.</span>
<span class="w">    </span><span class="c1">// If the caller sent too much, he or she is</span>
<span class="w">    </span><span class="c1">// refunded, but only after the function body.</span>
<span class="w">    </span><span class="c1">// This was dangerous before Solidity version 0.4.0,</span>
<span class="w">    </span><span class="c1">// where it was possible to skip the part after `_;`.</span>
<span class="w">    </span><span class="kt">modifier</span><span class="w"> </span>costs<span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="nv">amount</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span><span class="k">msg.value</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>amount<span class="p">)</span><span class="w"></span>
<span class="w">            </span>revert<span class="w"> </span>NotEnoughEther<span class="p">();</span><span class="w"></span>

<span class="w">        </span>_<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span><span class="k">msg.value</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span>amount<span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="kt">payable</span><span class="p">(</span><span class="k">msg.sender</span><span class="p">).</span>transfer<span class="p">(</span><span class="k">msg.value</span><span class="w"> </span><span class="o">-</span><span class="w"> </span>amount<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">forceOwnerChange</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">newOwner</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="kt">public</span><span class="w"></span>
<span class="w">        </span><span class="kt">payable</span><span class="w"></span>
<span class="w">        </span>costs<span class="p">(</span><span class="m m-Decimal">200</span><span class="w"> </span>ether<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>owner<span class="w"> </span><span class="o">=</span><span class="w"> </span>newOwner<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="c1">// just some example condition</span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span><span class="kt">uint160</span><span class="p">(</span>owner<span class="p">)</span><span class="w"> </span><span class="err">&amp;</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="c1">// This did not refund for Solidity</span>
<span class="w">            </span><span class="c1">// before version 0.4.0.</span>
<span class="w">            </span><span class="kt">return</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="c1">// refund overpaid fees</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>A more specialised way in which access to function
calls can be restricted will be discussed
in the next example.</p>
</section>
<section id="state-machine">
<span id="index-3"></span><h3>State Machine<a class="headerlink" href="#state-machine" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Contracts often act as a state machine, which means
that they have certain <strong>stages</strong> in which they behave
differently or in which different functions can
be called. A function call often ends a stage
and transitions the contract into the next stage
(especially if the contract models <strong>interaction</strong>).
It is also common that some stages are automatically
reached at a certain point in <strong>time</strong>.</p>
<p>An example for this is a blind auction contract which
starts in the stage ‚Äúaccepting blinded bids‚Äù, then
transitions to ‚Äúrevealing bids‚Äù which is ended by
‚Äúdetermine auction outcome‚Äù.</p>
<p id="index-4">Function modifiers can be used in this situation
to model the states and guard against
incorrect usage of the contract.</p>
<section id="example">
<h4>Example<a class="headerlink" href="#example" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>In the following example,
the modifier <code class="docutils literal notranslate"><span class="pre">atStage</span></code> ensures that the function can
only be called at a certain stage.</p>
<p>Automatic timed transitions
are handled by the modifier <code class="docutils literal notranslate"><span class="pre">timedTransitions</span></code>, which
should be used for all functions.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>Modifier Order Matters</strong>.
If atStage is combined
with timedTransitions, make sure that you mention
it after the latter, so that the new stage is
taken into account.</p>
</div>
<p>Finally, the modifier <code class="docutils literal notranslate"><span class="pre">transitionNext</span></code> can be used
to automatically go to the next stage when the
function finishes.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>Modifier May be Skipped</strong>.
This only applies to Solidity before version 0.4.0:
Since modifiers are applied by simply replacing
code and not by using a function call,
the code in the transitionNext modifier
can be skipped if the function itself uses
return. If you want to do that, make sure
to call nextStage manually from those functions.
Starting with version 0.4.0, modifier code
will run even if the function explicitly returns.</p>
</div>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0zLjAKcHJhZ21hIHNvbGlkaXR5IF4wLjguNDsKCmNvbnRyYWN0IFN0YXRlTWFjaGluZSB7CiAgICBlbnVtIFN0YWdlcyB7CiAgICAgICAgQWNjZXB0aW5nQmxpbmRlZEJpZHMsCiAgICAgICAgUmV2ZWFsQmlkcywKICAgICAgICBBbm90aGVyU3RhZ2UsCiAgICAgICAgQXJlV2VEb25lWWV0LAogICAgICAgIEZpbmlzaGVkCiAgICB9CiAgICAvLy8gRnVuY3Rpb24gY2Fubm90IGJlIGNhbGxlZCBhdCB0aGlzIHRpbWUuCiAgICBlcnJvciBGdW5jdGlvbkludmFsaWRBdFRoaXNTdGFnZSgpOwoKICAgIC8vIFRoaXMgaXMgdGhlIGN1cnJlbnQgc3RhZ2UuCiAgICBTdGFnZXMgcHVibGljIHN0YWdlID0gU3RhZ2VzLkFjY2VwdGluZ0JsaW5kZWRCaWRzOwoKICAgIHVpbnQgcHVibGljIGNyZWF0aW9uVGltZSA9IGJsb2NrLnRpbWVzdGFtcDsKCiAgICBtb2RpZmllciBhdFN0YWdlKFN0YWdlcyBzdGFnZV8pIHsKICAgICAgICBpZiAoc3RhZ2UgIT0gc3RhZ2VfKQogICAgICAgICAgICByZXZlcnQgRnVuY3Rpb25JbnZhbGlkQXRUaGlzU3RhZ2UoKTsKICAgICAgICBfOwogICAgfQoKICAgIGZ1bmN0aW9uIG5leHRTdGFnZSgpIGludGVybmFsIHsKICAgICAgICBzdGFnZSA9IFN0YWdlcyh1aW50KHN0YWdlKSArIDEpOwogICAgfQoKICAgIC8vIFBlcmZvcm0gdGltZWQgdHJhbnNpdGlvbnMuIEJlIHN1cmUgdG8gbWVudGlvbgogICAgLy8gdGhpcyBtb2RpZmllciBmaXJzdCwgb3RoZXJ3aXNlIHRoZSBndWFyZHMKICAgIC8vIHdpbGwgbm90IHRha2UgdGhlIG5ldyBzdGFnZSBpbnRvIGFjY291bnQuCiAgICBtb2RpZmllciB0aW1lZFRyYW5zaXRpb25zKCkgewogICAgICAgIGlmIChzdGFnZSA9PSBTdGFnZXMuQWNjZXB0aW5nQmxpbmRlZEJpZHMgJiYKICAgICAgICAgICAgICAgICAgICBibG9jay50aW1lc3RhbXAgPj0gY3JlYXRpb25UaW1lICsgMTAgZGF5cykKICAgICAgICAgICAgbmV4dFN0YWdlKCk7CiAgICAgICAgaWYgKHN0YWdlID09IFN0YWdlcy5SZXZlYWxCaWRzICYmCiAgICAgICAgICAgICAgICBibG9jay50aW1lc3RhbXAgPj0gY3JlYXRpb25UaW1lICsgMTIgZGF5cykKICAgICAgICAgICAgbmV4dFN0YWdlKCk7CiAgICAgICAgLy8gVGhlIG90aGVyIHN0YWdlcyB0cmFuc2l0aW9uIGJ5IHRyYW5zYWN0aW9uCiAgICAgICAgXzsKICAgIH0KCiAgICAvLyBPcmRlciBvZiB0aGUgbW9kaWZpZXJzIG1hdHRlcnMgaGVyZSEKICAgIGZ1bmN0aW9uIGJpZCgpCiAgICAgICAgcHVibGljCiAgICAgICAgcGF5YWJsZQogICAgICAgIHRpbWVkVHJhbnNpdGlvbnMKICAgICAgICBhdFN0YWdlKFN0YWdlcy5BY2NlcHRpbmdCbGluZGVkQmlkcykKICAgIHsKICAgICAgICAvLyBXZSB3aWxsIG5vdCBpbXBsZW1lbnQgdGhhdCBoZXJlCiAgICB9CgogICAgZnVuY3Rpb24gcmV2ZWFsKCkKICAgICAgICBwdWJsaWMKICAgICAgICB0aW1lZFRyYW5zaXRpb25zCiAgICAgICAgYXRTdGFnZShTdGFnZXMuUmV2ZWFsQmlkcykKICAgIHsKICAgIH0KCiAgICAvLyBUaGlzIG1vZGlmaWVyIGdvZXMgdG8gdGhlIG5leHQgc3RhZ2UKICAgIC8vIGFmdGVyIHRoZSBmdW5jdGlvbiBpcyBkb25lLgogICAgbW9kaWZpZXIgdHJhbnNpdGlvbk5leHQoKQogICAgewogICAgICAgIF87CiAgICAgICAgbmV4dFN0YWdlKCk7CiAgICB9CgogICAgZnVuY3Rpb24gZygpCiAgICAgICAgcHVibGljCiAgICAgICAgdGltZWRUcmFuc2l0aW9ucwogICAgICAgIGF0U3RhZ2UoU3RhZ2VzLkFub3RoZXJTdGFnZSkKICAgICAgICB0cmFuc2l0aW9uTmV4dAogICAgewogICAgfQoKICAgIGZ1bmN0aW9uIGgoKQogICAgICAgIHB1YmxpYwogICAgICAgIHRpbWVkVHJhbnNpdGlvbnMKICAgICAgICBhdFN0YWdlKFN0YWdlcy5BcmVXZURvbmVZZXQpCiAgICAgICAgdHJhbnNpdGlvbk5leHQKICAgIHsKICAgIH0KCiAgICBmdW5jdGlvbiBpKCkKICAgICAgICBwdWJsaWMKICAgICAgICB0aW1lZFRyYW5zaXRpb25zCiAgICAgICAgYXRTdGFnZShTdGFnZXMuRmluaXNoZWQpCiAgICB7CiAgICB9Cn0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: GPL-3.0</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.8.4</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">StateMachine</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">enum</span><span class="w"> </span><span class="nv">Stages</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>AcceptingBlindedBids<span class="p">,</span><span class="w"></span>
<span class="w">        </span>RevealBids<span class="p">,</span><span class="w"></span>
<span class="w">        </span>AnotherStage<span class="p">,</span><span class="w"></span>
<span class="w">        </span>AreWeDoneYet<span class="p">,</span><span class="w"></span>
<span class="w">        </span>Finished<span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="c1">/// Function cannot be called at this time.</span>
<span class="w">    </span>error<span class="w"> </span>FunctionInvalidAtThisStage<span class="p">();</span><span class="w"></span>

<span class="w">    </span><span class="c1">// This is the current stage.</span>
<span class="w">    </span>Stages<span class="w"> </span><span class="kt">public</span><span class="w"> </span>stage<span class="w"> </span><span class="o">=</span><span class="w"> </span>Stages<span class="p">.</span>AcceptingBlindedBids<span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="k">public </span><span class="nv">creationTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">block.timestamp</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kt">modifier</span><span class="w"> </span>atStage<span class="p">(</span>Stages<span class="w"> </span>stage_<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>stage<span class="w"> </span><span class="o">!=</span><span class="w"> </span>stage_<span class="p">)</span><span class="w"></span>
<span class="w">            </span>revert<span class="w"> </span>FunctionInvalidAtThisStage<span class="p">();</span><span class="w"></span>
<span class="w">        </span>_<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">nextStage</span><span class="p">()</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>stage<span class="w"> </span><span class="o">=</span><span class="w"> </span>Stages<span class="p">(</span><span class="kt">uint</span><span class="p">(</span>stage<span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Perform timed transitions. Be sure to mention</span>
<span class="w">    </span><span class="c1">// this modifier first, otherwise the guards</span>
<span class="w">    </span><span class="c1">// will not take the new stage into account.</span>
<span class="w">    </span><span class="kt">modifier</span><span class="w"> </span>timedTransitions<span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>stage<span class="w"> </span><span class="o">==</span><span class="w"> </span>Stages<span class="p">.</span>AcceptingBlindedBids<span class="w"> </span><span class="err">&amp;&amp;</span><span class="w"></span>
<span class="w">                    </span><span class="k">block.timestamp</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span>creationTime<span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m m-Decimal">10</span><span class="w"> </span>days<span class="p">)</span><span class="w"></span>
<span class="w">            </span>nextStage<span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>stage<span class="w"> </span><span class="o">==</span><span class="w"> </span>Stages<span class="p">.</span>RevealBids<span class="w"> </span><span class="err">&amp;&amp;</span><span class="w"></span>
<span class="w">                </span><span class="k">block.timestamp</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span>creationTime<span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m m-Decimal">12</span><span class="w"> </span>days<span class="p">)</span><span class="w"></span>
<span class="w">            </span>nextStage<span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="c1">// The other stages transition by transaction</span>
<span class="w">        </span>_<span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Order of the modifiers matters here!</span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">bid</span><span class="p">()</span><span class="w"></span>
<span class="w">        </span><span class="kt">public</span><span class="w"></span>
<span class="w">        </span><span class="kt">payable</span><span class="w"></span>
<span class="w">        </span>timedTransitions<span class="w"></span>
<span class="w">        </span>atStage<span class="p">(</span>Stages<span class="p">.</span>AcceptingBlindedBids<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// We will not implement that here</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">reveal</span><span class="p">()</span><span class="w"></span>
<span class="w">        </span><span class="kt">public</span><span class="w"></span>
<span class="w">        </span>timedTransitions<span class="w"></span>
<span class="w">        </span>atStage<span class="p">(</span>Stages<span class="p">.</span>RevealBids<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">// This modifier goes to the next stage</span>
<span class="w">    </span><span class="c1">// after the function is done.</span>
<span class="w">    </span><span class="kt">modifier</span><span class="w"> </span>transitionNext<span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>_<span class="p">;</span><span class="w"></span>
<span class="w">        </span>nextStage<span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">g</span><span class="p">()</span><span class="w"></span>
<span class="w">        </span><span class="kt">public</span><span class="w"></span>
<span class="w">        </span>timedTransitions<span class="w"></span>
<span class="w">        </span>atStage<span class="p">(</span>Stages<span class="p">.</span>AnotherStage<span class="p">)</span><span class="w"></span>
<span class="w">        </span>transitionNext<span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">h</span><span class="p">()</span><span class="w"></span>
<span class="w">        </span><span class="kt">public</span><span class="w"></span>
<span class="w">        </span>timedTransitions<span class="w"></span>
<span class="w">        </span>atStage<span class="p">(</span>Stages<span class="p">.</span>AreWeDoneYet<span class="p">)</span><span class="w"></span>
<span class="w">        </span>transitionNext<span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">i</span><span class="p">()</span><span class="w"></span>
<span class="w">        </span><span class="kt">public</span><span class="w"></span>
<span class="w">        </span>timedTransitions<span class="w"></span>
<span class="w">        </span>atStage<span class="p">(</span>Stages<span class="p">.</span>Finished<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
</section>
<span id="document-bugs"></span><section id="list-of-known-bugs">
<span id="known-bugs"></span><span id="index-0"></span><h2>List of Known Bugs<a class="headerlink" href="#list-of-known-bugs" title="Permalink to this heading">ÔÉÅ</a></h2>
<p>Below, you can find a JSON-formatted list of some of the known security-relevant bugs in the
Solidity compiler. The file itself is hosted in the <a class="reference external" href="https://github.com/ethereum/solidity/blob/develop/docs/bugs.json">Github repository</a>.
The list stretches back as far as version 0.3.0, bugs known to be present only
in versions preceding that are not listed.</p>
<p>There is another file called <a class="reference external" href="https://github.com/ethereum/solidity/blob/develop/docs/bugs_by_version.json">bugs_by_version.json</a>,
which can be used to check which bugs affect a specific version of the compiler.</p>
<p>Contract source verification tools and also other tools interacting with
contracts should consult this list according to the following criteria:</p>
<ul class="simple">
<li><p>It is mildly suspicious if a contract was compiled with a nightly
compiler version instead of a released version. This list does not keep
track of unreleased or nightly versions.</p></li>
<li><p>It is also mildly suspicious if a contract was compiled with a version that was
not the most recent at the time the contract was created. For contracts
created from other contracts, you have to follow the creation chain
back to a transaction and use the date of that transaction as creation date.</p></li>
<li><p>It is highly suspicious if a contract was compiled with a compiler that
contains a known bug and the contract was created at a time where a newer
compiler version containing a fix was already released.</p></li>
</ul>
<p>The JSON file of known bugs below is an array of objects, one for each bug,
with the following keys:</p>
<dl class="simple">
<dt>uid</dt><dd><p>Unique identifier given to the bug in the form of <code class="docutils literal notranslate"><span class="pre">SOL-&lt;year&gt;-&lt;number&gt;</span></code>.
It is possible that multiple entries exists with the same uid. This means
multiple version ranges are affected by the same bug.</p>
</dd>
<dt>name</dt><dd><p>Unique name given to the bug</p>
</dd>
<dt>summary</dt><dd><p>Short description of the bug</p>
</dd>
<dt>description</dt><dd><p>Detailed description of the bug</p>
</dd>
<dt>link</dt><dd><p>URL of a website with more detailed information, optional</p>
</dd>
<dt>introduced</dt><dd><p>The first published compiler version that contained the bug, optional</p>
</dd>
<dt>fixed</dt><dd><p>The first published compiler version that did not contain the bug anymore</p>
</dd>
<dt>publish</dt><dd><p>The date at which the bug became known publicly, optional</p>
</dd>
<dt>severity</dt><dd><p>Severity of the bug: very low, low, medium, high. Takes into account
discoverability in contract tests, likelihood of occurrence and
potential damage by exploits.</p>
</dd>
<dt>conditions</dt><dd><p>Conditions that have to be met to trigger the bug. The following
keys can be used:
<code class="docutils literal notranslate"><span class="pre">optimizer</span></code>, Boolean value which
means that the optimizer has to be switched on to enable the bug.
<code class="docutils literal notranslate"><span class="pre">evmVersion</span></code>, a string that indicates which EVM version compiler
settings trigger the bug. The string can contain comparison
operators. For example, <code class="docutils literal notranslate"><span class="pre">&quot;&gt;=constantinople&quot;</span></code> means that the bug
is present when the EVM version is set to <code class="docutils literal notranslate"><span class="pre">constantinople</span></code> or
later.
If no conditions are given, assume that the bug is present.</p>
</dd>
<dt>check</dt><dd><p>This field contains different checks that report whether the smart contract
contains the bug or not. The first type of check are Javascript regular
expressions that are to be matched against the source code (‚Äúsource-regex‚Äù)
if the bug is present.  If there is no match, then the bug is very likely
not present. If there is a match, the bug might be present.  For improved
accuracy, the checks should be applied to the source code after stripping
comments.
The second type of check are patterns to be checked on the compact AST of
the Solidity program (‚Äúast-compact-json-path‚Äù). The specified search query
is a <a class="reference external" href="https://github.com/json-path/JsonPath">JsonPath</a> expression.
If at least one path of the Solidity AST matches the query, the bug is
likely present.</p>
</dd>
</dl>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;uid&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SOL-2022-5&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;DirtyBytesArrayToStorage&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;summary&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Copying ``bytes`` arrays from memory or calldata to storage may result in dirty storage values.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Copying ``bytes`` arrays from memory or calldata to storage is done in chunks of 32 bytes even if the length is not a multiple of 32. Thereby, extra bytes past the end of the array may be copied from calldata or memory to storage. These dirty bytes may then become observable after a ``.push()`` without arguments to the bytes array in storage, i.e. such a push will not result in a zero value at the end of the array as expected. This bug only affects the legacy code generation pipeline, the new code generation pipeline via IR is not affected.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;link&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;https://blog.soliditylang.org/2022/06/15/dirty-bytes-array-to-storage-bug/&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;introduced&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.0.1&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;fixed&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.8.15&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;severity&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;low&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;uid&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SOL-2022-4&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;InlineAssemblyMemorySideEffects&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;summary&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;The Yul optimizer may incorrectly remove memory writes from inline assembly blocks, that do not access solidity variables.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;The Yul optimizer considers all memory writes in the outermost Yul block that are never read from as unused and removes them. This is valid when that Yul block is the entire Yul program, which is always the case for the Yul code generated by the new via-IR pipeline. Inline assembly blocks are never optimized in isolation when using that pipeline. Instead they are optimized as a part of the whole Yul input. However, the legacy code generation pipeline (which is still the default) runs the Yul optimizer individually on an inline assembly block if the block does not refer to any local variables defined in the surrounding Solidity code. Consequently, memory writes in such inline assembly blocks are removed as well, if the written memory is never read from in the same assembly block, even if the written memory is accessed later, for example by a subsequent inline assembly block.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;link&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;https://blog.soliditylang.org/2022/06/15/inline-assembly-memory-side-effects-bug/&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;introduced&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.8.13&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;fixed&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.8.15&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;severity&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;medium&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;conditions&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="s2">&quot;yulOptimizer&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;uid&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SOL-2022-3&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;DataLocationChangeInInternalOverride&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;summary&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;It was possible to change the data location of the parameters or return variables from ``calldata`` to ``memory`` and vice-versa while overriding internal and public functions. This caused invalid code to be generated when calling such a function internally through virtual function calls.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;When calling external functions, it is irrelevant if the data location of the parameters is ``calldata`` or ``memory``, the encoding of the data does not change. Because of that, changing the data location when overriding external functions is allowed. The compiler incorrectly also allowed a change in the data location for overriding public and internal functions. Since public functions can be called internally as well as externally, this causes invalid code to be generated when such an incorrectly overridden function is called internally through the base contract. The caller provides a memory pointer, but the called function interprets it as a calldata pointer or vice-versa.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;link&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;https://blog.soliditylang.org/2022/05/17/data-location-inheritance-bug/&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;introduced&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.6.9&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;fixed&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.8.14&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;severity&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;very low&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;uid&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SOL-2022-2&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;NestedCallataArrayAbiReencodingSizeValidation&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;summary&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;ABI-reencoding of nested dynamic calldata arrays did not always perform proper size checks against the size of calldata and could read beyond ``calldatasize()``.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Calldata validation for nested dynamic types is deferred until the first access to the nested values. Such an access may for example be a copy to memory or an index or member access to the outer type. While in most such accesses calldata validation correctly checks that the data area of the nested array is completely contained in the passed calldata (i.e. in the range [0, calldatasize()]), this check may not be performed, when ABI encoding such nested types again directly from calldata. For instance, this can happen, if a value in calldata with a nested dynamic array is passed to an external call, used in ``abi.encode`` or emitted as event. In such cases, if the data area of the nested array extends beyond ``calldatasize()``, ABI encoding it did not revert, but continued reading values from beyond ``calldatasize()`` (i.e. zero values).&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;link&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;https://blog.soliditylang.org/2022/05/17/calldata-reencode-size-check-bug/&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;introduced&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.5.8&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;fixed&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.8.14&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;severity&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;very low&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;uid&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SOL-2022-1&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;AbiEncodeCallLiteralAsFixedBytesBug&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;summary&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Literals used for a fixed length bytes parameter in ``abi.encodeCall`` were encoded incorrectly.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;For the encoding, the compiler only considered the types of the expressions in the second argument of ``abi.encodeCall`` itself, but not the parameter types of the function given as first argument. In almost all cases the abi encoding of the type of the expression matches the abi encoding of the parameter type of the given function. This is because the type checker ensures the expression is implicitly convertible to the respective parameter type. However this is not true for number literals used for fixed bytes types shorter than 32 bytes, nor for string literals used for any fixed bytes type. Number literals were encoded as numbers instead of being shifted to become left-aligned. String literals were encoded as dynamically sized memory strings instead of being converted to a left-aligned bytes value.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;link&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;https://blog.soliditylang.org/2022/03/16/encodecall-bug/&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;introduced&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.8.11&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;fixed&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.8.13&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;severity&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;very low&quot;</span><span class="w"></span>

<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;uid&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SOL-2021-4&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;UserDefinedValueTypesBug&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;summary&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;User defined value types with underlying type shorter than 32 bytes used incorrect storage layout and wasted storage&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;The compiler did not correctly compute the storage layout of user defined value types based on types that are shorter than 32 bytes. It would always use a full storage slot for these types, even if the underlying type was shorter. This was wasteful and might have problems with tooling or contract upgrades.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;link&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;https://blog.soliditylang.org/2021/09/29/user-defined-value-types-bug/&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;introduced&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.8.8&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;fixed&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.8.9&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;severity&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;very low&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;uid&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SOL-2021-3&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SignedImmutables&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;summary&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Immutable variables of signed integer type shorter than 256 bits can lead to values with invalid higher order bits if inline assembly is used.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;When immutable variables of signed integer type shorter than 256 bits are read, their higher order bits were unconditionally set to zero. The correct operation would be to sign-extend the value, i.e. set the higher order bits to one if the sign bit is one. This sign-extension is performed by Solidity just prior to when it matters, i.e. when a value is stored in memory, when it is compared or when a division is performed. Because of that, to our knowledge, the only way to access the value in its unclean state is by reading it through inline assembly.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;link&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;https://blog.soliditylang.org/2021/09/29/signed-immutables-bug/&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;introduced&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.6.5&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;fixed&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.8.9&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;severity&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;very low&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;uid&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SOL-2021-2&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;ABIDecodeTwoDimensionalArrayMemory&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;summary&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;If used on memory byte arrays, result of the function ``abi.decode`` can depend on the contents of memory outside of the actual byte array that is decoded.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;The ABI specification uses pointers to data areas for everything that is dynamically-sized. When decoding data from memory (instead of calldata), the ABI decoder did not properly validate some of these pointers. More specifically, it was possible to use large values for the pointers inside arrays such that computing the offset resulted in an undetected overflow. This could lead to these pointers targeting areas in memory outside of the actual area to be decoded. This way, it was possible for ``abi.decode`` to return different values for the same encoded byte array.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;link&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;https://blog.soliditylang.org/2021/04/21/decoding-from-memory-bug/&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;introduced&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.4.16&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;fixed&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.8.4&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;conditions&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="s2">&quot;ABIEncoderV2&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"></span>
<span class="w">        </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;severity&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;very low&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;uid&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SOL-2021-1&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;KeccakCaching&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;summary&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;The bytecode optimizer incorrectly re-used previously evaluated Keccak-256 hashes. You are unlikely to be affected if you do not compute Keccak-256 hashes in inline assembly.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Solidity&#39;s bytecode optimizer has a step that can compute Keccak-256 hashes, if the contents of the memory are known during compilation time. This step also has a mechanism to determine that two Keccak-256 hashes are equal even if the values in memory are not known during compile time. This mechanism had a bug where Keccak-256 of the same memory content, but different sizes were considered equal. More specifically, ``keccak256(mpos1, length1)`` and ``keccak256(mpos2, length2)`` in some cases were considered equal if ``length1`` and ``length2``, when rounded up to nearest multiple of 32 were the same, and when the memory contents at ``mpos1`` and ``mpos2`` can be deduced to be equal. You maybe affected if you compute multiple Keccak-256 hashes of the same content, but with different lengths inside inline assembly. You are unaffected if your code uses ``keccak256`` with a length that is not a compile-time constant or if it is always a multiple of 32.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;link&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;https://blog.soliditylang.org/2021/03/23/keccak-optimizer-bug/&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;fixed&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.8.3&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;conditions&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="s2">&quot;optimizer&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"></span>
<span class="w">        </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;severity&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;medium&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;uid&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SOL-2020-11&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;EmptyByteArrayCopy&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;summary&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Copying an empty byte array (or string) from memory or calldata to storage can result in data corruption if the target array&#39;s length is increased subsequently without storing new data.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;The routine that copies byte arrays from memory or calldata to storage stores unrelated data from after the source array in the storage slot if the source array is empty. If the storage array&#39;s length is subsequently increased either by using ``.push()`` or by assigning to its ``.length`` attribute (only before 0.6.0), the newly created byte array elements will not be zero-initialized, but contain the unrelated data. You are not affected if you do not assign to ``.length`` and do not use ``.push()`` on byte arrays, or only use ``.push(&lt;arg&gt;)`` or manually initialize the new elements.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;link&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;https://blog.soliditylang.org/2020/10/19/empty-byte-array-copy-bug/&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;fixed&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.7.4&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;severity&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;medium&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;uid&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SOL-2020-10&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;DynamicArrayCleanup&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;summary&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;When assigning a dynamically-sized array with types of size at most 16 bytes in storage causing the assigned array to shrink, some parts of deleted slots were not zeroed out.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Consider a dynamically-sized array in storage whose base-type is small enough such that multiple values can be packed into a single slot, such as `uint128[]`. Let us define its length to be `l`. When this array gets assigned from another array with a smaller length, say `m`, the slots between elements `m` and `l` have to be cleaned by zeroing them out. However, this cleaning was not performed properly. Specifically, after the slot corresponding to `m`, only the first packed value was cleaned up. If this array gets resized to a length larger than `m`, the indices corresponding to the unclean parts of the slot contained the original value, instead of 0. The resizing here is performed by assigning to the array `length`, by a `push()` or via inline assembly. You are not affected if you are only using `.push(&lt;arg&gt;)` or if you assign a value (even zero) to the new elements after increasing the length of the array.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;link&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;https://blog.soliditylang.org/2020/10/07/solidity-dynamic-array-cleanup-bug/&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;fixed&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.7.3&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;severity&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;medium&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;uid&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SOL-2020-9&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;FreeFunctionRedefinition&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;summary&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;The compiler does not flag an error when two or more free functions with the same name and parameter types are defined in a source unit or when an imported free function alias shadows another free function with a different name but identical parameter types.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;In contrast to functions defined inside contracts, free functions with identical names and parameter types did not create an error. Both definition of free functions with identical name and parameter types and an imported free function with an alias that shadows another function with a different name but identical parameter types were permitted due to which a call to either the multiply defined free function or the imported free function alias within a contract led to the execution of that free function which was defined first within the source unit. Subsequently defined identical free function definitions were silently ignored and their code generation was skipped.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;introduced&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.7.1&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;fixed&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.7.2&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;severity&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;low&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;uid&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SOL-2020-8&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;UsingForCalldata&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;summary&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Function calls to internal library functions with calldata parameters called via ``using for`` can result in invalid data being read.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Function calls to internal library functions using the ``using for`` mechanism copied all calldata parameters to memory first and passed them on like that, regardless of whether it was an internal or an external call. Due to that, the called function would receive a memory pointer that is interpreted as a calldata pointer. Since dynamically sized arrays are passed using two stack slots for calldata, but only one for memory, this can lead to stack corruption. An affected library call will consider the JUMPDEST to which it is supposed to return as part of its arguments and will instead jump out to whatever was on the stack before the call.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;introduced&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.6.9&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;fixed&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.6.10&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;severity&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;very low&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;uid&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SOL-2020-7&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;MissingEscapingInFormatting&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;summary&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;String literals containing double backslash characters passed directly to external or encoding function calls can lead to a different string being used when ABIEncoderV2 is enabled.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;When ABIEncoderV2 is enabled, string literals passed directly to encoding functions or external function calls are stored as strings in the intemediate code. Characters outside the printable range are handled correctly, but backslashes are not escaped in this procedure. This leads to double backslashes being reduced to single backslashes and consequently re-interpreted as escapes potentially resulting in a different string being encoded.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;introduced&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.5.14&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;fixed&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.6.8&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;severity&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;very low&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;conditions&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="s2">&quot;ABIEncoderV2&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;uid&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SOL-2020-6&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;ArraySliceDynamicallyEncodedBaseType&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;summary&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Accessing array slices of arrays with dynamically encoded base types (e.g. multi-dimensional arrays) can result in invalid data being read.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;For arrays with dynamically sized base types, index range accesses that use a start expression that is non-zero will result in invalid array slices. Any index access to such array slices will result in data being read from incorrect calldata offsets. Array slices are only supported for dynamic calldata types and all problematic type require ABIEncoderV2 to be enabled.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;introduced&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.6.0&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;fixed&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.6.8&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;severity&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;very low&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;conditions&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="s2">&quot;ABIEncoderV2&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;uid&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SOL-2020-5&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;ImplicitConstructorCallvalueCheck&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;summary&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;The creation code of a contract that does not define a constructor but has a base that does define a constructor did not revert for calls with non-zero value.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Starting from Solidity 0.4.5 the creation code of contracts without explicit payable constructor is supposed to contain a callvalue check that results in contract creation reverting, if non-zero value is passed. However, this check was missing in case no explicit constructor was defined in a contract at all, but the contract has a base that does define a constructor. In these cases it is possible to send value in a contract creation transaction or using inline assembly without revert, even though the creation code is supposed to be non-payable.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;introduced&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.4.5&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;fixed&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.6.8&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;severity&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;very low&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;uid&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SOL-2020-4&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;TupleAssignmentMultiStackSlotComponents&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;summary&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Tuple assignments with components that occupy several stack slots, i.e. nested tuples, pointers to external functions or references to dynamically sized calldata arrays, can result in invalid values.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Tuple assignments did not correctly account for tuple components that occupy multiple stack slots in case the number of stack slots differs between left-hand-side and right-hand-side. This can either happen in the presence of nested tuples or if the right-hand-side contains external function pointers or references to dynamic calldata arrays, while the left-hand-side contains an omission.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;introduced&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.1.6&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;fixed&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.6.6&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;severity&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;very low&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;uid&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SOL-2020-3&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;MemoryArrayCreationOverflow&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;summary&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;The creation of very large memory arrays can result in overlapping memory regions and thus memory corruption.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;No runtime overflow checks were performed for the length of memory arrays during creation. In cases for which the memory size of an array in bytes, i.e. the array length times 32, is larger than 2^256-1, the memory allocation will overflow, potentially resulting in overlapping memory areas. The length of the array is still stored correctly, so copying or iterating over such an array will result in out-of-gas.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;link&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;https://blog.soliditylang.org/2020/04/06/memory-creation-overflow-bug/&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;introduced&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.2.0&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;fixed&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.6.5&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;severity&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;low&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;uid&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SOL-2020-1&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;YulOptimizerRedundantAssignmentBreakContinue&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;summary&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;The Yul optimizer can remove essential assignments to variables declared inside for loops when Yul&#39;s continue or break statement is used. You are unlikely to be affected if you do not use inline assembly with for loops and continue and break statements.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;The Yul optimizer has a stage that removes assignments to variables that are overwritten again or are not used in all following control-flow branches. This logic incorrectly removes such assignments to variables declared inside a for loop if they can be removed in a control-flow branch that ends with ``break`` or ``continue`` even though they cannot be removed in other control-flow branches. Variables declared outside of the respective for loop are not affected.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;introduced&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.6.0&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;fixed&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.6.1&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;severity&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;medium&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;conditions&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="s2">&quot;yulOptimizer&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;uid&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SOL-2020-2&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;privateCanBeOverridden&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;summary&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Private methods can be overridden by inheriting contracts.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;While private methods of base contracts are not visible and cannot be called directly from the derived contract, it is still possible to declare a function of the same name and type and thus change the behaviour of the base contract&#39;s function.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;introduced&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.3.0&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;fixed&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.5.17&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;severity&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;low&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;uid&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SOL-2020-1&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;YulOptimizerRedundantAssignmentBreakContinue0.5&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;summary&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;The Yul optimizer can remove essential assignments to variables declared inside for loops when Yul&#39;s continue or break statement is used. You are unlikely to be affected if you do not use inline assembly with for loops and continue and break statements.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;The Yul optimizer has a stage that removes assignments to variables that are overwritten again or are not used in all following control-flow branches. This logic incorrectly removes such assignments to variables declared inside a for loop if they can be removed in a control-flow branch that ends with ``break`` or ``continue`` even though they cannot be removed in other control-flow branches. Variables declared outside of the respective for loop are not affected.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;introduced&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.5.8&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;fixed&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.5.16&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;severity&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;low&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;conditions&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="s2">&quot;yulOptimizer&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;uid&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SOL-2019-10&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;ABIEncoderV2LoopYulOptimizer&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;summary&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;If both the experimental ABIEncoderV2 and the experimental Yul optimizer are activated, one component of the Yul optimizer may reuse data in memory that has been changed in the meantime.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;The Yul optimizer incorrectly replaces ``mload`` and ``sload`` calls with values that have been previously written to the load location (and potentially changed in the meantime) if all of the following conditions are met: (1) there is a matching ``mstore`` or ``sstore`` call before; (2) the contents of memory or storage is only changed in a function that is called (directly or indirectly) in between the first store and the load call; (3) called function contains a for loop where the same memory location is changed in the condition or the post or body block. When used in Solidity mode, this can only happen if the experimental ABIEncoderV2 is activated and the experimental Yul optimizer has been activated manually in addition to the regular optimizer in the compiler settings.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;introduced&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.5.14&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;fixed&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.5.15&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;severity&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;low&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;conditions&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="s2">&quot;ABIEncoderV2&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="s2">&quot;optimizer&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="s2">&quot;yulOptimizer&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;uid&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SOL-2019-9&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;ABIEncoderV2CalldataStructsWithStaticallySizedAndDynamicallyEncodedMembers&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;summary&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Reading from calldata structs that contain dynamically encoded, but statically-sized members can result in incorrect values.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;When a calldata struct contains a dynamically encoded, but statically-sized member, the offsets for all subsequent struct members are calculated incorrectly. All reads from such members will result in invalid values. Only calldata structs are affected, i.e. this occurs in external functions with such structs as argument. Using affected structs in storage or memory or as arguments to public functions on the other hand works correctly.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;introduced&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.5.6&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;fixed&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.5.11&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;severity&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;low&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;conditions&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="s2">&quot;ABIEncoderV2&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;uid&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SOL-2019-8&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SignedArrayStorageCopy&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;summary&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Assigning an array of signed integers to a storage array of different type can lead to data corruption in that array.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;In two&#39;s complement, negative integers have their higher order bits set. In order to fit into a shared storage slot, these have to be set to zero. When a conversion is done at the same time, the bits to set to zero were incorrectly determined from the source and not the target type. This means that such copy operations can lead to incorrect values being stored.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;link&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;https://blog.soliditylang.org/2019/06/25/solidity-storage-array-bugs/&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;introduced&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.4.7&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;fixed&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.5.10&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;severity&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;low/medium&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;uid&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SOL-2019-7&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;ABIEncoderV2StorageArrayWithMultiSlotElement&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;summary&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Storage arrays containing structs or other statically-sized arrays are not read properly when directly encoded in external function calls or in abi.encode*.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;When storage arrays whose elements occupy more than a single storage slot are directly encoded in external function calls or using abi.encode*, their elements are read in an overlapping manner, i.e. the element pointer is not properly advanced between reads. This is not a problem when the storage data is first copied to a memory variable or if the storage array only contains value types or dynamically-sized arrays.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;link&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;https://blog.soliditylang.org/2019/06/25/solidity-storage-array-bugs/&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;introduced&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.4.16&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;fixed&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.5.10&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;severity&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;low&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;conditions&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="s2">&quot;ABIEncoderV2&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;uid&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SOL-2019-6&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;DynamicConstructorArgumentsClippedABIV2&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;summary&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;A contract&#39;s constructor that takes structs or arrays that contain dynamically-sized arrays reverts or decodes to invalid data.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;During construction of a contract, constructor parameters are copied from the code section to memory for decoding. The amount of bytes to copy was calculated incorrectly in case all parameters are statically-sized but contain dynamically-sized arrays as struct members or inner arrays. Such types are only available if ABIEncoderV2 is activated.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;introduced&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.4.16&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;fixed&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.5.9&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;severity&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;very low&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;conditions&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="s2">&quot;ABIEncoderV2&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;uid&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SOL-2019-5&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;UninitializedFunctionPointerInConstructor&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;summary&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Calling uninitialized internal function pointers created in the constructor does not always revert and can cause unexpected behaviour.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Uninitialized internal function pointers point to a special piece of code that causes a revert when called. Jump target positions are different during construction and after deployment, but the code for setting this special jump target only considered the situation after deployment.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;introduced&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.5.0&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;fixed&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.5.8&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;severity&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;very low&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;uid&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SOL-2019-5&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;UninitializedFunctionPointerInConstructor_0.4.x&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;summary&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Calling uninitialized internal function pointers created in the constructor does not always revert and can cause unexpected behaviour.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Uninitialized internal function pointers point to a special piece of code that causes a revert when called. Jump target positions are different during construction and after deployment, but the code for setting this special jump target only considered the situation after deployment.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;introduced&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.4.5&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;fixed&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.4.26&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;severity&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;very low&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;uid&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SOL-2019-4&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;IncorrectEventSignatureInLibraries&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;summary&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Contract types used in events in libraries cause an incorrect event signature hash&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Instead of using the type `address` in the hashed signature, the actual contract name was used, leading to a wrong hash in the logs.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;introduced&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.5.0&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;fixed&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.5.8&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;severity&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;very low&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;uid&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SOL-2019-4&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;IncorrectEventSignatureInLibraries_0.4.x&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;summary&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Contract types used in events in libraries cause an incorrect event signature hash&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Instead of using the type `address` in the hashed signature, the actual contract name was used, leading to a wrong hash in the logs.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;introduced&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.3.0&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;fixed&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.4.26&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;severity&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;very low&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;uid&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SOL-2019-3&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;ABIEncoderV2PackedStorage&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;summary&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Storage structs and arrays with types shorter than 32 bytes can cause data corruption if encoded directly from storage using the experimental ABIEncoderV2.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Elements of structs and arrays that are shorter than 32 bytes are not properly decoded from storage when encoded directly (i.e. not via a memory type) using ABIEncoderV2. This can cause corruption in the values themselves but can also overwrite other parts of the encoded data.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;link&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;https://blog.soliditylang.org/2019/03/26/solidity-optimizer-and-abiencoderv2-bug/&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;introduced&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.5.0&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;fixed&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.5.7&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;severity&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;low&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;conditions&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="s2">&quot;ABIEncoderV2&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;uid&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SOL-2019-3&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;ABIEncoderV2PackedStorage_0.4.x&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;summary&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Storage structs and arrays with types shorter than 32 bytes can cause data corruption if encoded directly from storage using the experimental ABIEncoderV2.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Elements of structs and arrays that are shorter than 32 bytes are not properly decoded from storage when encoded directly (i.e. not via a memory type) using ABIEncoderV2. This can cause corruption in the values themselves but can also overwrite other parts of the encoded data.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;link&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;https://blog.soliditylang.org/2019/03/26/solidity-optimizer-and-abiencoderv2-bug/&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;introduced&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.4.19&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;fixed&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.4.26&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;severity&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;low&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;conditions&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="s2">&quot;ABIEncoderV2&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;uid&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SOL-2019-2&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;IncorrectByteInstructionOptimization&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;summary&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;The optimizer incorrectly handles byte opcodes whose second argument is 31 or a constant expression that evaluates to 31. This can result in unexpected values.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;The optimizer incorrectly handles byte opcodes that use the constant 31 as second argument. This can happen when performing index access on bytesNN types with a compile-time constant value (not index) of 31 or when using the byte opcode in inline assembly.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;link&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;https://blog.soliditylang.org/2019/03/26/solidity-optimizer-and-abiencoderv2-bug/&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;introduced&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.5.5&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;fixed&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.5.7&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;severity&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;very low&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;conditions&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="s2">&quot;optimizer&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;uid&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SOL-2019-1&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;DoubleShiftSizeOverflow&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;summary&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Double bitwise shifts by large constants whose sum overflows 256 bits can result in unexpected values.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Nested logical shift operations whose total shift size is 2**256 or more are incorrectly optimized. This only applies to shifts by numbers of bits that are compile-time constant expressions.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;link&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;https://blog.soliditylang.org/2019/03/26/solidity-optimizer-and-abiencoderv2-bug/&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;introduced&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.5.5&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;fixed&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.5.6&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;severity&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;low&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;conditions&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="s2">&quot;optimizer&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="s2">&quot;evmVersion&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;&gt;=constantinople&quot;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;uid&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SOL-2018-4&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;ExpExponentCleanup&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;summary&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Using the ** operator with an exponent of type shorter than 256 bits can result in unexpected values.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Higher order bits in the exponent are not properly cleaned before the EXP opcode is applied if the type of the exponent expression is smaller than 256 bits and not smaller than the type of the base. In that case, the result might be larger than expected if the exponent is assumed to lie within the value range of the type. Literal numbers as exponents are unaffected as are exponents or bases of type uint256.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;link&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;https://blog.soliditylang.org/2018/09/13/solidity-bugfix-release/&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;fixed&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.4.25&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;severity&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;medium/high&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;check&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;regex-source&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;[^/]\\*\\* *[^/0-9 ]&quot;</span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;uid&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SOL-2018-3&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;EventStructWrongData&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;summary&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Using structs in events logged wrong data.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;If a struct is used in an event, the address of the struct is logged instead of the actual data.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;link&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;https://blog.soliditylang.org/2018/09/13/solidity-bugfix-release/&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;introduced&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.4.17&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;fixed&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.4.25&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;severity&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;very low&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;check&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;ast-compact-json-path&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;$..[?(@.nodeType === &#39;EventDefinition&#39;)]..[?(@.nodeType === &#39;UserDefinedTypeName&#39; &amp;&amp; @.typeDescriptions.typeString.startsWith(&#39;struct&#39;))]&quot;</span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;uid&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SOL-2018-2&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;NestedArrayFunctionCallDecoder&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;summary&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Calling functions that return multi-dimensional fixed-size arrays can result in memory corruption.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;If Solidity code calls a function that returns a multi-dimensional fixed-size array, array elements are incorrectly interpreted as memory pointers and thus can cause memory corruption if the return values are accessed. Calling functions with multi-dimensional fixed-size arrays is unaffected as is returning fixed-size arrays from function calls. The regular expression only checks if such functions are present, not if they are called, which is required for the contract to be affected.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;link&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;https://blog.soliditylang.org/2018/09/13/solidity-bugfix-release/&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;introduced&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.1.4&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;fixed&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.4.22&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;severity&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;medium&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;check&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;regex-source&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;returns[^;{]*\\[\\s*[^\\] \\t\\r\\n\\v\\f][^\\]]*\\]\\s*\\[\\s*[^\\] \\t\\r\\n\\v\\f][^\\]]*\\][^{;]*[;{]&quot;</span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;uid&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SOL-2018-1&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;OneOfTwoConstructorsSkipped&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;summary&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;If a contract has both a new-style constructor (using the constructor keyword) and an old-style constructor (a function with the same name as the contract) at the same time, one of them will be ignored.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;If a contract has both a new-style constructor (using the constructor keyword) and an old-style constructor (a function with the same name as the contract) at the same time, one of them will be ignored. There will be a compiler warning about the old-style constructor, so contracts only using new-style constructors are fine.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;introduced&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.4.22&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;fixed&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.4.23&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;severity&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;very low&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;uid&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SOL-2017-5&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;ZeroFunctionSelector&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;summary&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;It is possible to craft the name of a function such that it is executed instead of the fallback function in very specific circumstances.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;If a function has a selector consisting only of zeros, is payable and part of a contract that does not have a fallback function and at most five external functions in total, this function is called instead of the fallback function if Ether is sent to the contract without data.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;fixed&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.4.18&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;severity&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;very low&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;uid&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SOL-2017-4&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;DelegateCallReturnValue&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;summary&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;The low-level .delegatecall() does not return the execution outcome, but converts the value returned by the functioned called to a boolean instead.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;The return value of the low-level .delegatecall() function is taken from a position in memory, where the call data or the return data resides. This value is interpreted as a boolean and put onto the stack. This means if the called function returns at least 32 zero bytes, .delegatecall() returns false even if the call was successful.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;introduced&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.3.0&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;fixed&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.4.15&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;severity&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;low&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;uid&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SOL-2017-3&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;ECRecoverMalformedInput&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;summary&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;The ecrecover() builtin can return garbage for malformed input.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;The ecrecover precompile does not properly signal failure for malformed input (especially in the &#39;v&#39; argument) and thus the Solidity function can return data that was previously present in the return area in memory.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;fixed&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.4.14&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;severity&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;medium&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;uid&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SOL-2017-2&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SkipEmptyStringLiteral&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;summary&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;If \&quot;\&quot; is used in a function call, the following function arguments will not be correctly passed to the function.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;If the empty string literal \&quot;\&quot; is used as an argument in a function call, it is skipped by the encoder. This has the effect that the encoding of all arguments following this is shifted left by 32 bytes and thus the function call data is corrupted.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;fixed&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.4.12&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;severity&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;low&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;uid&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SOL-2017-1&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;ConstantOptimizerSubtraction&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;summary&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;In some situations, the optimizer replaces certain numbers in the code with routines that compute different numbers.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;The optimizer tries to represent any number in the bytecode by routines that compute them with less gas. For some special numbers, an incorrect routine is generated. This could allow an attacker to e.g. trick victims about a specific amount of ether, or function calls to call different functions (or none at all).&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;link&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;https://blog.soliditylang.org/2017/05/03/solidity-optimizer-bug/&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;fixed&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.4.11&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;severity&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;low&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;conditions&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="s2">&quot;optimizer&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;uid&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SOL-2016-11&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;IdentityPrecompileReturnIgnored&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;summary&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Failure of the identity precompile was ignored.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Calls to the identity contract, which is used for copying memory, ignored its return value. On the public chain, calls to the identity precompile can be made in a way that they never fail, but this might be different on private chains.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;severity&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;low&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;fixed&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.4.7&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;uid&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SOL-2016-10&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;OptimizerStateKnowledgeNotResetForJumpdest&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;summary&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;The optimizer did not properly reset its internal state at jump destinations, which could lead to data corruption.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;The optimizer performs symbolic execution at certain stages. At jump destinations, multiple code paths join and thus it has to compute a common state from the incoming edges. Computing this common state was simplified to just use the empty state, but this implementation was not done properly. This bug can cause data corruption.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;severity&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;medium&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;introduced&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.4.5&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;fixed&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.4.6&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;conditions&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="s2">&quot;optimizer&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;uid&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SOL-2016-9&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;HighOrderByteCleanStorage&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;summary&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;For short types, the high order bytes were not cleaned properly and could overwrite existing data.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Types shorter than 32 bytes are packed together into the same 32 byte storage slot, but storage writes always write 32 bytes. For some types, the higher order bytes were not cleaned properly, which made it sometimes possible to overwrite a variable in storage when writing to another one.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;link&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;https://blog.soliditylang.org/2016/11/01/security-alert-solidity-variables-can-overwritten-storage/&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;severity&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;high&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;introduced&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.1.6&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;fixed&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.4.4&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;uid&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SOL-2016-8&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;OptimizerStaleKnowledgeAboutSHA3&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;summary&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;The optimizer did not properly reset its knowledge about SHA3 operations resulting in some hashes (also used for storage variable positions) not being calculated correctly.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;The optimizer performs symbolic execution in order to save re-evaluating expressions whose value is already known. This knowledge was not properly reset across control flow paths and thus the optimizer sometimes thought that the result of a SHA3 operation is already present on the stack. This could result in data corruption by accessing the wrong storage slot.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;severity&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;medium&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;fixed&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.4.3&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;conditions&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="s2">&quot;optimizer&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;uid&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SOL-2016-7&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;LibrariesNotCallableFromPayableFunctions&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;summary&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Library functions threw an exception when called from a call that received Ether.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Library functions are protected against sending them Ether through a call. Since the DELEGATECALL opcode forwards the information about how much Ether was sent with a call, the library function incorrectly assumed that Ether was sent to the library and threw an exception.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;severity&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;low&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;introduced&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.4.0&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;fixed&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.4.2&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;uid&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SOL-2016-6&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SendFailsForZeroEther&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;summary&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;The send function did not provide enough gas to the recipient if no Ether was sent with it.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;The recipient of an Ether transfer automatically receives a certain amount of gas from the EVM to handle the transfer. In the case of a zero-transfer, this gas is not provided which causes the recipient to throw an exception.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;severity&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;low&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;fixed&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.4.0&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;uid&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SOL-2016-5&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;DynamicAllocationInfiniteLoop&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;summary&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Dynamic allocation of an empty memory array caused an infinite loop and thus an exception.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Memory arrays can be created provided a length. If this length is zero, code was generated that did not terminate and thus consumed all gas.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;severity&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;low&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;fixed&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.3.6&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;uid&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SOL-2016-4&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;OptimizerClearStateOnCodePathJoin&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;summary&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;The optimizer did not properly reset its internal state at jump destinations, which could lead to data corruption.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;The optimizer performs symbolic execution at certain stages. At jump destinations, multiple code paths join and thus it has to compute a common state from the incoming edges. Computing this common state was not done correctly. This bug can cause data corruption, but it is probably quite hard to use for targeted attacks.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;severity&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;low&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;fixed&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.3.6&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;conditions&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="s2">&quot;optimizer&quot;</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;uid&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SOL-2016-3&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;CleanBytesHigherOrderBits&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;summary&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;The higher order bits of short bytesNN types were not cleaned before comparison.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Two variables of type bytesNN were considered different if their higher order bits, which are not part of the actual value, were different. An attacker might use this to reach seemingly unreachable code paths by providing incorrectly formatted input data.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;severity&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;medium/high&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;fixed&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.3.3&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;uid&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SOL-2016-2&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;ArrayAccessCleanHigherOrderBits&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;summary&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Access to array elements for arrays of types with less than 32 bytes did not correctly clean the higher order bits, causing corruption in other array elements.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Multiple elements of an array of values that are shorter than 17 bytes are packed into the same storage slot. Writing to a single element of such an array did not properly clean the higher order bytes and thus could lead to data corruption.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;severity&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;medium/high&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;fixed&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.3.1&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;uid&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SOL-2016-1&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;AncientCompiler&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;summary&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;This compiler version is ancient and might contain several undocumented or undiscovered bugs.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;description&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;The list of bugs is only kept for compiler versions starting from 0.3.0, so older versions might contain undocumented bugs.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;severity&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;high&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="s2">&quot;fixed&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;0.3.0&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">]</span><span class="w"></span>
</pre></div>
</div>
</section>
<span id="document-contributing"></span><section id="contributing">
<h2>Contributing<a class="headerlink" href="#contributing" title="Permalink to this heading">ÔÉÅ</a></h2>
<p>Help is always welcome and there are plenty of options how you can contribute to Solidity.</p>
<p>In particular, we appreciate support in the following areas:</p>
<ul class="simple">
<li><p>Reporting issues.</p></li>
<li><p>Fixing and responding to <a class="reference external" href="https://github.com/ethereum/solidity/issues">Solidity‚Äôs GitHub issues</a>, especially those tagged as
<a class="reference external" href="https://github.com/ethereum/solidity/labels/good%20first%20issue">‚Äúgood first issue‚Äù</a> which are
meant as introductory issues for external contributors.</p></li>
<li><p>Improving the documentation.</p></li>
<li><p>Translating the documentation into more languages.</p></li>
<li><p>Responding to questions from other users on <a class="reference external" href="https://ethereum.stackexchange.com">StackExchange</a> and the <a class="reference external" href="https://gitter.im/ethereum/solidity">Solidity Gitter Chat</a>.</p></li>
<li><p>Getting involved in the language design process by proposing language changes or new features in the <a class="reference external" href="https://forum.soliditylang.org/">Solidity forum</a> and providing feedback.</p></li>
</ul>
<p>To get started, you can try <a class="reference internal" href="index.html#building-from-source"><span class="std std-ref">Building from Source</span></a> in order to familiarize
yourself with the components of Solidity and the build process. Also, it may be
useful to become well-versed at writing smart-contracts in Solidity.</p>
<p>Please note that this project is released with a <a class="reference external" href="https://raw.githubusercontent.com/ethereum/solidity/develop/CODE_OF_CONDUCT.md">Contributor Code of Conduct</a>. By participating in this project - in the issues, pull requests, or Gitter channels - you agree to abide by its terms.</p>
<section id="team-calls">
<h3>Team Calls<a class="headerlink" href="#team-calls" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>If you have issues or pull requests to discuss, or are interested in hearing what
the team and contributors are working on, you can join our public team calls:</p>
<ul class="simple">
<li><p>Mondays at 3pm CET/CEST.</p></li>
<li><p>Wednesdays at 2pm CET/CEST.</p></li>
</ul>
<p>Both calls take place on <a class="reference external" href="https://meet.ethereum.org/solidity">Jitsi</a>.</p>
</section>
<section id="how-to-report-issues">
<h3>How to Report Issues<a class="headerlink" href="#how-to-report-issues" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>To report an issue, please use the
<a class="reference external" href="https://github.com/ethereum/solidity/issues">GitHub issues tracker</a>. When
reporting issues, please mention the following details:</p>
<ul class="simple">
<li><p>Solidity version.</p></li>
<li><p>Source code (if applicable).</p></li>
<li><p>Operating system.</p></li>
<li><p>Steps to reproduce the issue.</p></li>
<li><p>Actual vs. expected behaviour.</p></li>
</ul>
<p>Reducing the source code that caused the issue to a bare minimum is always
very helpful and sometimes even clarifies a misunderstanding.</p>
</section>
<section id="workflow-for-pull-requests">
<h3>Workflow for Pull Requests<a class="headerlink" href="#workflow-for-pull-requests" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>In order to contribute, please fork off of the <code class="docutils literal notranslate"><span class="pre">develop</span></code> branch and make your
changes there. Your commit messages should detail <em>why</em> you made your change
in addition to <em>what</em> you did (unless it is a tiny change).</p>
<p>If you need to pull in any changes from <code class="docutils literal notranslate"><span class="pre">develop</span></code> after making your fork (for
example, to resolve potential merge conflicts), please avoid using <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">merge</span></code>
and instead, <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">rebase</span></code> your branch. This will help us review your change
more easily.</p>
<p>Additionally, if you are writing a new feature, please ensure you add appropriate
test cases under <code class="docutils literal notranslate"><span class="pre">test/</span></code> (see below).</p>
<p>However, if you are making a larger change, please consult with the <a class="reference external" href="https://gitter.im/ethereum/solidity-dev">Solidity Development Gitter channel</a> (different from the one mentioned above, this one is
focused on compiler and language development instead of language usage) first.</p>
<p>New features and bugfixes should be added to the <code class="docutils literal notranslate"><span class="pre">Changelog.md</span></code> file: please
follow the style of previous entries, when applicable.</p>
<p>Finally, please make sure you respect the <a class="reference external" href="https://github.com/ethereum/solidity/blob/develop/CODING_STYLE.md">coding style</a>
for this project. Also, even though we do CI testing, please test your code and
ensure that it builds locally before submitting a pull request.</p>
<p>Thank you for your help!</p>
</section>
<section id="running-the-compiler-tests">
<h3>Running the Compiler Tests<a class="headerlink" href="#running-the-compiler-tests" title="Permalink to this heading">ÔÉÅ</a></h3>
<section id="prerequisites">
<h4>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>For running all compiler tests you may want to optionally install a few
dependencies (<a class="reference external" href="https://github.com/ethereum/evmone/releases">evmone</a>,
<a class="reference external" href="https://github.com/Z3Prover/z3">libz3</a>, and
<a class="reference external" href="https://github.com/ewasm/hera">libhera</a>).</p>
<p>On macOS some of the testing scripts expect GNU coreutils to be installed.
This can be easiest accomplished using Homebrew: <code class="docutils literal notranslate"><span class="pre">brew</span> <span class="pre">install</span> <span class="pre">coreutils</span></code>.</p>
<p>On Windows systems make sure that you have a privilege to create symlinks,
otherwise several tests may fail.
Administrators should have that privilege, but you may also
<a class="reference external" href="https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/create-symbolic-links#policy-management">grant it to other users</a>
or
<a class="reference external" href="https://docs.microsoft.com/en-us/windows/apps/get-started/enable-your-device-for-development">enable Developer Mode</a>.</p>
</section>
<section id="running-the-tests">
<h4>Running the Tests<a class="headerlink" href="#running-the-tests" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Solidity includes different types of tests, most of them bundled into the
<a class="reference external" href="https://www.boost.org/doc/libs/release/libs/test/doc/html/index.html">Boost C++ Test Framework</a> application <code class="docutils literal notranslate"><span class="pre">soltest</span></code>.
Running <code class="docutils literal notranslate"><span class="pre">build/test/soltest</span></code> or its wrapper <code class="docutils literal notranslate"><span class="pre">scripts/soltest.sh</span></code> is sufficient for most changes.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">./scripts/tests.sh</span></code> script executes most Solidity tests automatically,
including those bundled into the <a class="reference external" href="https://www.boost.org/doc/libs/release/libs/test/doc/html/index.html">Boost C++ Test Framework</a>
application <code class="docutils literal notranslate"><span class="pre">soltest</span></code> (or its wrapper <code class="docutils literal notranslate"><span class="pre">scripts/soltest.sh</span></code>), as well as command line tests and
compilation tests.</p>
<p>The test system automatically tries to discover the location of
the <a class="reference external" href="https://github.com/ethereum/evmone/releases">evmone</a> for running the semantic tests.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">evmone</span></code> library must be located in the <code class="docutils literal notranslate"><span class="pre">deps</span></code> or <code class="docutils literal notranslate"><span class="pre">deps/lib</span></code> directory relative to the
current working directory, to its parent or its parent‚Äôs parent. Alternatively an explicit location
for the <code class="docutils literal notranslate"><span class="pre">evmone</span></code> shared object can be specified via the <code class="docutils literal notranslate"><span class="pre">ETH_EVMONE</span></code> environment variable.</p>
<p><code class="docutils literal notranslate"><span class="pre">evmone</span></code> is needed mainly for running semantic and gas tests.
If you do not have it installed, you can skip these tests by passing the <code class="docutils literal notranslate"><span class="pre">--no-semantic-tests</span></code>
flag to <code class="docutils literal notranslate"><span class="pre">scripts/soltest.sh</span></code>.</p>
<p>Running Ewasm tests is disabled by default and can be explicitly enabled
via <code class="docutils literal notranslate"><span class="pre">./scripts/soltest.sh</span> <span class="pre">--ewasm</span></code> and requires <a class="reference external" href="https://github.com/ewasm/hera">hera</a>
to be found by <code class="docutils literal notranslate"><span class="pre">soltest</span></code>.
The mechanism for locating the <code class="docutils literal notranslate"><span class="pre">hera</span></code> library is the same as for <code class="docutils literal notranslate"><span class="pre">evmone</span></code>, except that the
variable for specifying an explicit location is called <code class="docutils literal notranslate"><span class="pre">ETH_HERA</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">evmone</span></code> and <code class="docutils literal notranslate"><span class="pre">hera</span></code> libraries should both end with the file name
extension <code class="docutils literal notranslate"><span class="pre">.so</span></code> on Linux, <code class="docutils literal notranslate"><span class="pre">.dll</span></code> on Windows systems and <code class="docutils literal notranslate"><span class="pre">.dylib</span></code> on macOS.</p>
<p>For running SMT tests, the <code class="docutils literal notranslate"><span class="pre">libz3</span></code> library must be installed and locatable
by <code class="docutils literal notranslate"><span class="pre">cmake</span></code> during compiler configure stage.</p>
<p>If the <code class="docutils literal notranslate"><span class="pre">libz3</span></code> library is not installed on your system, you should disable the
SMT tests by exporting <code class="docutils literal notranslate"><span class="pre">SMT_FLAGS=--no-smt</span></code> before running <code class="docutils literal notranslate"><span class="pre">./scripts/tests.sh</span></code> or
running <code class="docutils literal notranslate"><span class="pre">./scripts/soltest.sh</span> <span class="pre">--no-smt</span></code>.
These tests are <code class="docutils literal notranslate"><span class="pre">libsolidity/smtCheckerTests</span></code> and <code class="docutils literal notranslate"><span class="pre">libsolidity/smtCheckerTestsJSON</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To get a list of all unit tests run by Soltest, run <code class="docutils literal notranslate"><span class="pre">./build/test/soltest</span> <span class="pre">--list_content=HRF</span></code>.</p>
</div>
<p>For quicker results you can run a subset of, or specific tests.</p>
<p>To run a subset of tests, you can use filters:
<code class="docutils literal notranslate"><span class="pre">./scripts/soltest.sh</span> <span class="pre">-t</span> <span class="pre">TestSuite/TestName</span></code>,
where <code class="docutils literal notranslate"><span class="pre">TestName</span></code> can be a wildcard <code class="docutils literal notranslate"><span class="pre">*</span></code>.</p>
<p>Or, for example, to run all the tests for the yul disambiguator:
<code class="docutils literal notranslate"><span class="pre">./scripts/soltest.sh</span> <span class="pre">-t</span> <span class="pre">&quot;yulOptimizerTests/disambiguator/*&quot;</span> <span class="pre">--no-smt</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">./build/test/soltest</span> <span class="pre">--help</span></code> has extensive help on all of the options available.</p>
<p>See especially:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.boost.org/doc/libs/release/libs/test/doc/html/boost_test/utf_reference/rt_param_reference/show_progress.html">show_progress (-p)</a> to show test completion,</p></li>
<li><p><a class="reference external" href="https://www.boost.org/doc/libs/release/libs/test/doc/html/boost_test/utf_reference/rt_param_reference/run_test.html">run_test (-t)</a> to run specific tests cases, and</p></li>
<li><p><a class="reference external" href="https://www.boost.org/doc/libs/release/libs/test/doc/html/boost_test/utf_reference/rt_param_reference/report_level.html">report-level (-r)</a> give a more detailed report.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Those working in a Windows environment wanting to run the above basic sets
without libz3. Using Git Bash, you use: <code class="docutils literal notranslate"><span class="pre">./build/test/Release/soltest.exe</span> <span class="pre">--</span> <span class="pre">--no-smt</span></code>.
If you are running this in plain Command Prompt, use <code class="docutils literal notranslate"><span class="pre">.\build\test\Release\soltest.exe</span> <span class="pre">--</span> <span class="pre">--no-smt</span></code>.</p>
</div>
<p>If you want to debug using GDB, make sure you build differently than the ‚Äúusual‚Äù.
For example, you could run the following command in your <code class="docutils literal notranslate"><span class="pre">build</span></code> folder:
.. code-block:: bash</p>
<blockquote>
<div><p>cmake -DCMAKE_BUILD_TYPE=Debug ..
make</p>
</div></blockquote>
<p>This creates symbols so that when you debug a test using the <code class="docutils literal notranslate"><span class="pre">--debug</span></code> flag,
you have access to functions and variables in which you can break or print with.</p>
<p>The CI runs additional tests (including <code class="docutils literal notranslate"><span class="pre">solc-js</span></code> and testing third party Solidity
frameworks) that require compiling the Emscripten target.</p>
</section>
<section id="writing-and-running-syntax-tests">
<h4>Writing and Running Syntax Tests<a class="headerlink" href="#writing-and-running-syntax-tests" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Syntax tests check that the compiler generates the correct error messages for invalid code
and properly accepts valid code.
They are stored in individual files inside the <code class="docutils literal notranslate"><span class="pre">tests/libsolidity/syntaxTests</span></code> folder.
These files must contain annotations, stating the expected result(s) of the respective test.
The test suite compiles and checks them against the given expectations.</p>
<p>For example: <code class="docutils literal notranslate"><span class="pre">./test/libsolidity/syntaxTests/double_stateVariable_declaration.sol</span></code></p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Y29udHJhY3QgdGVzdCB7CiAgICB1aW50MjU2IHZhcmlhYmxlOwogICAgdWludDEyOCB2YXJpYWJsZTsKfQovLyAtLS0tCi8vIERlY2xhcmF0aW9uRXJyb3I6ICgzNi01Mik6IElkZW50aWZpZXIgYWxyZWFkeSBkZWNsYXJlZC4="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="k">contract</span><span class="w"> </span><span class="ni">test</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">variable</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint128</span><span class="w"> </span><span class="nv">variable</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="c1">// ----</span>
<span class="c1">// DeclarationError: (36-52): Identifier already declared.</span>
</pre></div>
</div>
<p>A syntax test must contain at least the contract under test itself, followed by the separator <code class="docutils literal notranslate"><span class="pre">//</span> <span class="pre">----</span></code>. The comments that follow the separator are used to describe the
expected compiler errors or warnings. The number range denotes the location in the source where the error occurred.
If you want the contract to compile without any errors or warning you can leave
out the separator and the comments that follow it.</p>
<p>In the above example, the state variable <code class="docutils literal notranslate"><span class="pre">variable</span></code> was declared twice, which is not allowed. This results in a <code class="docutils literal notranslate"><span class="pre">DeclarationError</span></code> stating that the identifier was already declared.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">isoltest</span></code> tool is used for these tests and you can find it under <code class="docutils literal notranslate"><span class="pre">./build/test/tools/</span></code>. It is an interactive tool which allows
editing of failing contracts using your preferred text editor. Let‚Äôs try to break this test by removing the second declaration of <code class="docutils literal notranslate"><span class="pre">variable</span></code>:</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Y29udHJhY3QgdGVzdCB7CiAgICB1aW50MjU2IHZhcmlhYmxlOwp9Ci8vIC0tLS0KLy8gRGVjbGFyYXRpb25FcnJvcjogKDM2LTUyKTogSWRlbnRpZmllciBhbHJlYWR5IGRlY2xhcmVkLg=="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="k">contract</span><span class="w"> </span><span class="ni">test</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">variable</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="c1">// ----</span>
<span class="c1">// DeclarationError: (36-52): Identifier already declared.</span>
</pre></div>
</div>
<p>Running <code class="docutils literal notranslate"><span class="pre">./build/test/tools/isoltest</span></code> again results in a test failure:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>syntaxTests/double_stateVariable_declaration.sol: FAIL
    Contract:
        contract test {
            uint256 variable;
        }

    Expected result:
        DeclarationError: (36-52): Identifier already declared.
    Obtained result:
        Success
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">isoltest</span></code> prints the expected result next to the obtained result, and also
provides a way to edit, update or skip the current contract file, or quit the application.</p>
<p>It offers several options for failing tests:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">edit</span></code>: <code class="docutils literal notranslate"><span class="pre">isoltest</span></code> tries to open the contract in an editor so you can adjust it. It either uses the editor given on the command line (as <code class="docutils literal notranslate"><span class="pre">isoltest</span> <span class="pre">--editor</span> <span class="pre">/path/to/editor</span></code>), in the environment variable <code class="docutils literal notranslate"><span class="pre">EDITOR</span></code> or just <code class="docutils literal notranslate"><span class="pre">/usr/bin/editor</span></code> (in that order).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">update</span></code>: Updates the expectations for contract under test. This updates the annotations by removing unmet expectations and adding missing expectations. The test is then run again.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">skip</span></code>: Skips the execution of this particular test.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">quit</span></code>: Quits <code class="docutils literal notranslate"><span class="pre">isoltest</span></code>.</p></li>
</ul>
<p>All of these options apply to the current contract, except <code class="docutils literal notranslate"><span class="pre">quit</span></code> which stops the entire testing process.</p>
<p>Automatically updating the test above changes it to</p>
<p class="remix-link-container"><a class="remix-link reference external" href="https://remix.ethereum.org/?language=solidity&amp;version=0.8.15&amp;code=Y29udHJhY3QgdGVzdCB7CiAgICB1aW50MjU2IHZhcmlhYmxlOwp9Ci8vIC0tLS0="><span class="link-icon"></span><span class="link-text">open in Remix</span></a></p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="k">contract</span><span class="w"> </span><span class="ni">test</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">variable</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="c1">// ----</span>
</pre></div>
</div>
<p>and re-run the test. It now passes again:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Re-running test case...
syntaxTests/double_stateVariable_declaration.sol: OK
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Choose a name for the contract file that explains what it tests, e.g. <code class="docutils literal notranslate"><span class="pre">double_variable_declaration.sol</span></code>.
Do not put more than one contract into a single file, unless you are testing inheritance or cross-contract calls.
Each file should test one aspect of your new feature.</p>
</div>
</section>
</section>
<section id="running-the-fuzzer-via-afl">
<h3>Running the Fuzzer via AFL<a class="headerlink" href="#running-the-fuzzer-via-afl" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>Fuzzing is a technique that runs programs on more or less random inputs to find exceptional execution
states (segmentation faults, exceptions, etc). Modern fuzzers are clever and run a directed search
inside the input. We have a specialized binary called <code class="docutils literal notranslate"><span class="pre">solfuzzer</span></code> which takes source code as input
and fails whenever it encounters an internal compiler error, segmentation fault or similar, but
does not fail if e.g., the code contains an error. This way, fuzzing tools can find internal problems in the compiler.</p>
<p>We mainly use <a class="reference external" href="https://lcamtuf.coredump.cx/afl/">AFL</a> for fuzzing. You need to download and
install the AFL packages from your repositories (afl, afl-clang) or build them manually.
Next, build Solidity (or just the <code class="docutils literal notranslate"><span class="pre">solfuzzer</span></code> binary) with AFL as your compiler:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> build
<span class="c1"># if needed</span>
make clean
cmake .. -DCMAKE_C_COMPILER<span class="o">=</span>path/to/afl-gcc -DCMAKE_CXX_COMPILER<span class="o">=</span>path/to/afl-g++
make solfuzzer
</pre></div>
</div>
<p>At this stage you should be able to see a message similar to the following:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Scanning dependencies of target solfuzzer
[ 98%] Building CXX object test/tools/CMakeFiles/solfuzzer.dir/fuzzer.cpp.o
afl-cc 2.52b by &lt;lcamtuf@google.com&gt;
afl-as 2.52b by &lt;lcamtuf@google.com&gt;
[+] Instrumented 1949 locations (64-bit, non-hardened mode, ratio 100%).
[100%] Linking CXX executable solfuzzer
</pre></div>
</div>
<p>If the instrumentation messages did not appear, try switching the cmake flags pointing to AFL‚Äôs clang binaries:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># if previously failed</span>
make clean
cmake .. -DCMAKE_C_COMPILER<span class="o">=</span>path/to/afl-clang -DCMAKE_CXX_COMPILER<span class="o">=</span>path/to/afl-clang++
make solfuzzer
</pre></div>
</div>
<p>Otherwise, upon execution the fuzzer halts with an error saying binary is not instrumented:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>afl-fuzz 2.52b by &lt;lcamtuf@google.com&gt;
... (truncated messages)
[*] Validating target binary...

[-] Looks like the target binary is not instrumented! The fuzzer depends on
    compile-time instrumentation to isolate interesting test cases while
    mutating the input data. For more information, and for tips on how to
    instrument binaries, please see /usr/share/doc/afl-doc/docs/README.

    When source code is not available, you may be able to leverage QEMU
    mode support. Consult the README for tips on how to enable this.
    (It is also possible to use afl-fuzz as a traditional, &quot;dumb&quot; fuzzer.
    For that, you can use the -n option - but expect much worse results.)

[-] PROGRAM ABORT : No instrumentation detected
         Location : check_binary(), afl-fuzz.c:6920
</pre></div>
</div>
<p>Next, you need some example source files. This makes it much easier for the fuzzer
to find errors. You can either copy some files from the syntax tests or extract test files
from the documentation or the other tests:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir /tmp/test_cases
<span class="nb">cd</span> /tmp/test_cases
<span class="c1"># extract from tests:</span>
path/to/solidity/scripts/isolate_tests.py path/to/solidity/test/libsolidity/SolidityEndToEndTest.cpp
<span class="c1"># extract from documentation:</span>
path/to/solidity/scripts/isolate_tests.py path/to/solidity/docs
</pre></div>
</div>
<p>The AFL documentation states that the corpus (the initial input files) should not be
too large. The files themselves should not be larger than 1 kB and there should be
at most one input file per functionality, so better start with a small number of.
There is also a tool called <code class="docutils literal notranslate"><span class="pre">afl-cmin</span></code> that can trim input files
that result in similar behaviour of the binary.</p>
<p>Now run the fuzzer (the <code class="docutils literal notranslate"><span class="pre">-m</span></code> extends the size of memory to 60 MB):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>afl-fuzz -m <span class="m">60</span> -i /tmp/test_cases -o /tmp/fuzzer_reports -- /path/to/solfuzzer
</pre></div>
</div>
<p>The fuzzer creates source files that lead to failures in <code class="docutils literal notranslate"><span class="pre">/tmp/fuzzer_reports</span></code>.
Often it finds many similar source files that produce the same error. You can
use the tool <code class="docutils literal notranslate"><span class="pre">scripts/uniqueErrors.sh</span></code> to filter out the unique errors.</p>
</section>
<section id="whiskers">
<h3>Whiskers<a class="headerlink" href="#whiskers" title="Permalink to this heading">ÔÉÅ</a></h3>
<p><em>Whiskers</em> is a string templating system similar to <a class="reference external" href="https://mustache.github.io">Mustache</a>. It is used by the
compiler in various places to aid readability, and thus maintainability and verifiability, of the code.</p>
<p>The syntax comes with a substantial difference to Mustache. The template markers <code class="docutils literal notranslate"><span class="pre">{{</span></code> and <code class="docutils literal notranslate"><span class="pre">}}</span></code> are
replaced by <code class="docutils literal notranslate"><span class="pre">&lt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> in order to aid parsing and avoid conflicts with <a class="reference internal" href="index.html#yul"><span class="std std-ref">Yul</span></a>
(The symbols <code class="docutils literal notranslate"><span class="pre">&lt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> are invalid in inline assembly, while <code class="docutils literal notranslate"><span class="pre">{</span></code> and <code class="docutils literal notranslate"><span class="pre">}</span></code> are used to delimit blocks).
Another limitation is that lists are only resolved one depth and they do not recurse. This may change in the future.</p>
<p>A rough specification is the following:</p>
<p>Any occurrence of <code class="docutils literal notranslate"><span class="pre">&lt;name&gt;</span></code> is replaced by the string-value of the supplied variable <code class="docutils literal notranslate"><span class="pre">name</span></code> without any
escaping and without iterated replacements. An area can be delimited by <code class="docutils literal notranslate"><span class="pre">&lt;#name&gt;...&lt;/name&gt;</span></code>. It is replaced
by as many concatenations of its contents as there were sets of variables supplied to the template system,
each time replacing any <code class="docutils literal notranslate"><span class="pre">&lt;inner&gt;</span></code> items by their respective value. Top-level variables can also be used
inside such areas.</p>
<p>There are also conditionals of the form <code class="docutils literal notranslate"><span class="pre">&lt;?name&gt;...&lt;!name&gt;...&lt;/name&gt;</span></code>, where template replacements
continue recursively either in the first or the second segment depending on the value of the boolean
parameter <code class="docutils literal notranslate"><span class="pre">name</span></code>. If <code class="docutils literal notranslate"><span class="pre">&lt;?+name&gt;...&lt;!+name&gt;...&lt;/+name&gt;</span></code> is used, then the check is whether
the string parameter <code class="docutils literal notranslate"><span class="pre">name</span></code> is non-empty.</p>
</section>
<section id="documentation-style-guide">
<span id="documentation-style"></span><h3>Documentation Style Guide<a class="headerlink" href="#documentation-style-guide" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>In the following section you find style recommendations specifically focusing on documentation
contributions to Solidity.</p>
<section id="english-language">
<h4>English Language<a class="headerlink" href="#english-language" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Use English, with British English spelling preferred, unless using project or brand names. Try to reduce the usage of
local slang and references, making your language as clear to all readers as possible. Below are some references to help:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/Simplified_Technical_English">Simplified technical English</a></p></li>
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/International_English">International English</a></p></li>
<li><p><a class="reference external" href="https://en.oxforddictionaries.com/spelling/british-and-spelling">British English spelling</a></p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>While the official Solidity documentation is written in English, there are community contributed <a class="reference internal" href="index.html#translations"><span class="std std-ref">Translations</span></a>
in other languages available. Please refer to the <a class="reference external" href="https://github.com/solidity-docs/translation-guide">translation guide</a>
for information on how to contribute to the community translations.</p>
</div>
</section>
<section id="title-case-for-headings">
<h4>Title Case for Headings<a class="headerlink" href="#title-case-for-headings" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Use <a class="reference external" href="https://titlecase.com">title case</a> for headings. This means capitalise all principal words in
titles, but not articles, conjunctions, and prepositions unless they start the
title.</p>
<p>For example, the following are all correct:</p>
<ul class="simple">
<li><p>Title Case for Headings.</p></li>
<li><p>For Headings Use Title Case.</p></li>
<li><p>Local and State Variable Names.</p></li>
<li><p>Order of Layout.</p></li>
</ul>
</section>
<section id="expand-contractions">
<h4>Expand Contractions<a class="headerlink" href="#expand-contractions" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Use expanded contractions for words, for example:</p>
<ul class="simple">
<li><p>‚ÄúDo not‚Äù instead of ‚ÄúDon‚Äôt‚Äù.</p></li>
<li><p>‚ÄúCan not‚Äù instead of ‚ÄúCan‚Äôt‚Äù.</p></li>
</ul>
</section>
<section id="active-and-passive-voice">
<h4>Active and Passive Voice<a class="headerlink" href="#active-and-passive-voice" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Active voice is typically recommended for tutorial style documentation as it
helps the reader understand who or what is performing a task. However, as the
Solidity documentation is a mixture of tutorials and reference content, passive
voice is sometimes more applicable.</p>
<p>As a summary:</p>
<ul class="simple">
<li><p>Use passive voice for technical reference, for example language definition and internals of the Ethereum VM.</p></li>
<li><p>Use active voice when describing recommendations on how to apply an aspect of Solidity.</p></li>
</ul>
<p>For example, the below is in passive voice as it specifies an aspect of Solidity:</p>
<blockquote>
<div><p>Functions can be declared <code class="docutils literal notranslate"><span class="pre">pure</span></code> in which case they promise not to read
from or modify the state.</p>
</div></blockquote>
<p>For example, the below is in active voice as it discusses an application of Solidity:</p>
<blockquote>
<div><p>When invoking the compiler, you can specify how to discover the first element
of a path, and also path prefix remappings.</p>
</div></blockquote>
</section>
<section id="common-terms">
<h4>Common Terms<a class="headerlink" href="#common-terms" title="Permalink to this heading">ÔÉÅ</a></h4>
<ul class="simple">
<li><p>‚ÄúFunction parameters‚Äù and ‚Äúreturn variables‚Äù, not input and output parameters.</p></li>
</ul>
</section>
<section id="code-examples">
<h4>Code Examples<a class="headerlink" href="#code-examples" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>A CI process tests all code block formatted code examples that begin with <code class="docutils literal notranslate"><span class="pre">pragma</span> <span class="pre">solidity</span></code>, <code class="docutils literal notranslate"><span class="pre">contract</span></code>, <code class="docutils literal notranslate"><span class="pre">library</span></code>
or <code class="docutils literal notranslate"><span class="pre">interface</span></code> using the <code class="docutils literal notranslate"><span class="pre">./test/cmdlineTests.sh</span></code> script when you create a PR. If you are adding new code examples,
ensure they work and pass tests before creating the PR.</p>
<p>Ensure that all code examples begin with a <code class="docutils literal notranslate"><span class="pre">pragma</span></code> version that spans the largest where the contract code is valid.
For example <code class="docutils literal notranslate"><span class="pre">pragma</span> <span class="pre">solidity</span> <span class="pre">&gt;=0.4.0</span> <span class="pre">&lt;0.9.0;</span></code>.</p>
</section>
<section id="running-documentation-tests">
<h4>Running Documentation Tests<a class="headerlink" href="#running-documentation-tests" title="Permalink to this heading">ÔÉÅ</a></h4>
<p>Make sure your contributions pass our documentation tests by running <code class="docutils literal notranslate"><span class="pre">./docs/docs.sh</span></code> that installs dependencies
needed for documentation and checks for any problems such as broken links or syntax issues.</p>
</section>
</section>
<section id="solidity-language-design">
<h3>Solidity Language Design<a class="headerlink" href="#solidity-language-design" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>To actively get involved in the language design process and share your ideas concerning the future of Solidity,
please join the <a class="reference external" href="https://forum.soliditylang.org/">Solidity forum</a>.</p>
<p>The Solidity forum serves as the place to propose and discuss new language features and their implementation in
the early stages of ideation or modifications of existing features.</p>
<p>As soon as proposals get more tangible, their
implementation will also be discussed in the <a class="reference external" href="https://github.com/ethereum/solidity">Solidity GitHub repository</a>
in the form of issues.</p>
<p>In addition to the forum and issue discussions, we regularly host language design discussion calls in which selected
topics, issues or feature implementations are debated in detail. The invitation to those calls is shared via the forum.</p>
<p>We are also sharing feedback surveys and other content that is relevant to language design in the forum.</p>
<p>If you want to know where the team is standing in terms or implementing new features, you can follow the implementation status in the <a class="reference external" href="https://github.com/ethereum/solidity/projects/43">Solidity Github project</a>.
Issues in the design backlog need further specification and will either be discussed in a language design call or in a regular team call. You can
see the upcoming changes for the next breaking release by changing from the default branch (<cite>develop</cite>) to the <a class="reference external" href="https://github.com/ethereum/solidity/tree/breaking">breaking branch</a>.</p>
<p>For ad-hoc cases and questions you can reach out to us via the <a class="reference external" href="https://gitter.im/ethereum/solidity-dev">Solidity-dev Gitter channel</a>, a
dedicated chatroom for conversations around the Solidity compiler and language development.</p>
<p>We are happy to hear your thoughts on how we can improve the language design process to be even more collaborative and transparent.</p>
</section>
</section>
<span id="document-brand-guide"></span><section id="solidity-brand-guide">
<h2>Solidity Brand Guide<a class="headerlink" href="#solidity-brand-guide" title="Permalink to this heading">ÔÉÅ</a></h2>
<p>This brand guide features information on Solidity‚Äôs brand policy and
logo usage guidelines.</p>
<section id="the-solidity-brand">
<h3>The Solidity Brand<a class="headerlink" href="#the-solidity-brand" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>The Solidity programming language is an open-source, community project
governed by a core team. The core team is sponsored by the <a class="reference external" href="https://ethereum.foundation/">Ethereum
Foundation</a>.</p>
<p>This document aims to provide information about how to best use the
Solidity brand name and logo.</p>
<p>We encourage you to read this document carefully before using the
brand name or the logo. Your cooperation is highly appreciated!</p>
</section>
<section id="solidity-brand-name">
<h3>Solidity Brand Name<a class="headerlink" href="#solidity-brand-name" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>‚ÄúSolidity‚Äù should be used to refer to the Solidity programming language
solely.</p>
<p>Please do not use ‚ÄúSolidity‚Äù:</p>
<ul class="simple">
<li><p>To refer to any other programming language.</p></li>
<li><p>In a way that is misleading or may imply association of unrelated
modules, tools, documentation, or other resources with the Solidity
programming language.</p></li>
<li><p>In ways that confuse the community as to whether the Solidity
programming language is open-source and free to use.</p></li>
</ul>
</section>
<section id="solidity-logo-license">
<h3>Solidity Logo License<a class="headerlink" href="#solidity-logo-license" title="Permalink to this heading">ÔÉÅ</a></h3>
<a class="reference internal image-reference" href="https://i.creativecommons.org/l/by/4.0/88x31.png"><img alt="Creative Commons License" src="https://i.creativecommons.org/l/by/4.0/88x31.png" style="width: 88px;" /></a>
<p>The Solidity logo is distributed and licensed under a <a class="reference external" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons
Attribution 4.0 International License</a>.</p>
<p>This is the most permissive Creative Commons license and allows reuse
and modifications for any purpose.</p>
<p>You are free to:</p>
<ul class="simple">
<li><p><strong>Share</strong> ‚Äî Copy and redistribute the material in any medium or format.</p></li>
<li><p><strong>Adapt</strong> ‚Äî Remix, transform, and build upon the material for any
purpose, even commercially.</p></li>
</ul>
<p>Under the following terms:</p>
<ul class="simple">
<li><p><strong>Attribution</strong> ‚Äî You must give appropriate credit, provide a link to
the license, and indicate if changes were made. You may do so in any
reasonable manner, but not in any way that suggests that the Solidity
core team endorses you or your use.</p></li>
</ul>
<p>When using the Solidity logo, please respect the Solidity logo guidelines.</p>
</section>
<section id="solidity-logo-guidelines">
<h3>Solidity Logo Guidelines<a class="headerlink" href="#solidity-logo-guidelines" title="Permalink to this heading">ÔÉÅ</a></h3>
<a class="reference internal image-reference" href="_images/logo.svg"><img alt="_images/logo.svg" src="_images/logo.svg" width="256" /></a>
<p><em>(Right click on the logo to download it.)</em></p>
<p>Please do not:</p>
<ul class="simple">
<li><p>Change the ratio of the logo (do not stretch it or cut it).</p></li>
<li><p>Change the colors of the logo, unless it is absolutely necessary.</p></li>
</ul>
</section>
<section id="credits">
<h3>Credits<a class="headerlink" href="#credits" title="Permalink to this heading">ÔÉÅ</a></h3>
<p>This document was, in parts, derived from the <a class="reference external" href="https://www.python.org/psf/trademarks/">Python Software
Foundation Trademark Usage Policy</a>
and the <a class="reference external" href="https://www.rust-lang.org/policies/media-guide">Rust Media Guide</a>.</p>
</section>
</section>
<span id="document-language-influences"></span><section id="language-influences">
<h2>Language Influences<a class="headerlink" href="#language-influences" title="Permalink to this heading">ÔÉÅ</a></h2>
<p>Solidity is a <a class="reference external" href="https://en.wikipedia.org/wiki/List_of_programming_languages_by_type#Curly-bracket_languages">curly-bracket language</a>
that has been influenced and inspired by several well-known programming languages.</p>
<p>Solidity is most profoundly influenced by C++, but also borrowed concepts from languages like
Python, JavaScript, and others.</p>
<p>The influence from C++ can be seen in the syntax for variable declarations, for loops, the concept
of overloading functions, implicit and explicit type conversions and many other details.</p>
<p>In the early days of the language, Solidity used to be partly influenced by JavaScript.
This was due to function-level scoping of variables and the use of the keyword <code class="docutils literal notranslate"><span class="pre">var</span></code>.
The JavaScript influence was reduced starting from version 0.4.0.
Now, the main remaining similarity to JavaScript is that functions are defined using the keyword
<code class="docutils literal notranslate"><span class="pre">function</span></code>. Solidity also supports import syntax and semantics that
are similar to those available in JavaScript. Besides those points, Solidity looks like
most other curly-bracket languages and has no major JavaScript influence anymore.</p>
<p>Another influence to Solidity was Python. Solidity‚Äôs modifiers were added trying to model
Python‚Äôs decorators with a much more restricted functionality. Furthermore, multiple inheritance, C3 linearization,
and the <code class="docutils literal notranslate"><span class="pre">super</span></code> keyword are taken from Python as well as the general assignment and copy semantics of value
and reference types.</p>
</section>
</div>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016-2021, Ethereum.
      <span class="commit">Revision <code>e14f2714</code>.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
    <p>
        <a href="#">Credits and attribution</a>.
    </p>


</footer>
        </div>
      </div>
    </section>
  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book fa-element"> RTD </span>

    <span class="fa fa-element">
    <input class="container_toggle" type="checkbox" id="switch" name="mode">
    <label for="switch"></label>
    </span>

    <span class="fa fa-v fa-element"> v: v0.8.15 <span class="fa fa-caret-down"></span></span>

    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Downloads</dt> 
        </dl>
        <dl>
            <dt>Versions</dt> 
            <dd><a href="/en/latest/">latest</a></dd>
            
            <dd><a href="/en/stable/">stable</a></dd>
            
            <dd><a href="/en/v0.8.15/">v0.8.15</a></dd>
            
            <dd><a href="/en/v0.8.14/">v0.8.14</a></dd>
            
            <dd><a href="/en/v0.8.13/">v0.8.13</a></dd>
            
            <dd><a href="/en/v0.8.12/">v0.8.12</a></dd>
            
            <dd><a href="/en/v0.8.11/">v0.8.11</a></dd>
            
            <dd><a href="/en/v0.8.10/">v0.8.10</a></dd>
            
            <dd><a href="/en/v0.8.9/">v0.8.9</a></dd>
            
            <dd><a href="/en/v0.8.8/">v0.8.8</a></dd>
            
            <dd><a href="/en/v0.8.7/">v0.8.7</a></dd>
            
            <dd><a href="/en/v0.8.6/">v0.8.6</a></dd>
            
            <dd><a href="/en/v0.8.5/">v0.8.5</a></dd>
            
            <dd><a href="/en/v0.8.4/">v0.8.4</a></dd>
            
            <dd><a href="/en/v0.8.3/">v0.8.3</a></dd>
            
            <dd><a href="/en/v0.8.2/">v0.8.2</a></dd>
            
            <dd><a href="/en/v0.8.1/">v0.8.1</a></dd>
            
            <dd><a href="/en/v0.8.0/">v0.8.0</a></dd>
            
            <dd><a href="/en/v0.7.6/">v0.7.6</a></dd>
            
            <dd><a href="/en/v0.7.5/">v0.7.5</a></dd>
            
            <dd><a href="/en/v0.7.4/">v0.7.4</a></dd>
            
            <dd><a href="/en/v0.7.3/">v0.7.3</a></dd>
            
            <dd><a href="/en/v0.7.2/">v0.7.2</a></dd>
            
            <dd><a href="/en/v0.7.1/">v0.7.1</a></dd>
            
            <dd><a href="/en/v0.7.0/">v0.7.0</a></dd>
            
            <dd><a href="/en/v0.6.12/">v0.6.12</a></dd>
            
            <dd><a href="/en/v0.6.11/">v0.6.11</a></dd>
            
            <dd><a href="/en/v0.6.10/">v0.6.10</a></dd>
            
            <dd><a href="/en/v0.6.9/">v0.6.9</a></dd>
            
            <dd><a href="/en/v0.6.8/">v0.6.8</a></dd>
            
            <dd><a href="/en/v0.6.7/">v0.6.7</a></dd>
            
            <dd><a href="/en/v0.6.6/">v0.6.6</a></dd>
            
            <dd><a href="/en/v0.6.5/">v0.6.5</a></dd>
            
            <dd><a href="/en/v0.6.4/">v0.6.4</a></dd>
            
            <dd><a href="/en/v0.6.3/">v0.6.3</a></dd>
            
            <dd><a href="/en/v0.6.2/">v0.6.2</a></dd>
            
            <dd><a href="/en/v0.6.1/">v0.6.1</a></dd>
            
            <dd><a href="/en/v0.6.0/">v0.6.0</a></dd>
            
            <dd><a href="/en/v0.5.17/">v0.5.17</a></dd>
            
            <dd><a href="/en/v0.5.16/">v0.5.16</a></dd>
            
            <dd><a href="/en/v0.5.15/">v0.5.15</a></dd>
            
            <dd><a href="/en/v0.5.14/">v0.5.14</a></dd>
            
            <dd><a href="/en/v0.5.13/">v0.5.13</a></dd>
            
            <dd><a href="/en/v0.5.12/">v0.5.12</a></dd>
            
            <dd><a href="/en/v0.5.11/">v0.5.11</a></dd>
            
            <dd><a href="/en/v0.5.10/">v0.5.10</a></dd>
            
            <dd><a href="/en/v0.5.9/">v0.5.9</a></dd>
            
            <dd><a href="/en/v0.5.8/">v0.5.8</a></dd>
            
            <dd><a href="/en/v0.5.7/">v0.5.7</a></dd>
            
            <dd><a href="/en/v0.5.6/">v0.5.6</a></dd>
            
            <dd><a href="/en/v0.5.5/">v0.5.5</a></dd>
            
            <dd><a href="/en/v0.5.4/">v0.5.4</a></dd>
            
            <dd><a href="/en/v0.5.3/">v0.5.3</a></dd>
            
            <dd><a href="/en/v0.5.2/">v0.5.2</a></dd>
            
            <dd><a href="/en/v0.5.1/">v0.5.1</a></dd>
            
            <dd><a href="/en/v0.5.0/">v0.5.0</a></dd>
            
            <dd><a href="/en/v0.4.26/">v0.4.26</a></dd>
            
            <dd><a href="/en/v0.4.25/">v0.4.25</a></dd>
            
            <dd><a href="/en/v0.4.24/">v0.4.24</a></dd>
            
            <dd><a href="/en/v0.4.23/">v0.4.23</a></dd>
            
            <dd><a href="/en/v0.4.22/">v0.4.22</a></dd>
            
            <dd><a href="/en/v0.4.21/">v0.4.21</a></dd>
            
            <dd><a href="/en/v0.4.20/">v0.4.20</a></dd>
            
            <dd><a href="/en/v0.4.19/">v0.4.19</a></dd>
            
            <dd><a href="/en/v0.4.18/">v0.4.18</a></dd>
            
            <dd><a href="/en/v0.4.17/">v0.4.17</a></dd>
            
            <dd><a href="/en/v0.4.16/">v0.4.16</a></dd>
            
            <dd><a href="/en/v0.4.15/">v0.4.15</a></dd>
            
            <dd><a href="/en/v0.4.14/">v0.4.14</a></dd>
            
            <dd><a href="/en/v0.4.13/">v0.4.13</a></dd>
            
            <dd><a href="/en/v0.4.12/">v0.4.12</a></dd>
            
            <dd><a href="/en/v0.4.11/">v0.4.11</a></dd>
            
            <dd><a href="/en/v0.4.10/">v0.4.10</a></dd>
            
            <dd><a href="/en/v0.4.9/">v0.4.9</a></dd>
            
            <dd><a href="/en/v0.4.8/">v0.4.8</a></dd>
            
            <dd><a href="/en/v0.4.7/">v0.4.7</a></dd>
            
            <dd><a href="/en/v0.4.6/">v0.4.6</a></dd>
            
            <dd><a href="/en/v0.4.5/">v0.4.5</a></dd>
            
            <dd><a href="/en/v0.4.4/">v0.4.4</a></dd>
            
            <dd><a href="/en/v0.4.3/">v0.4.3</a></dd>
            
            <dd><a href="/en/v0.4.2/">v0.4.2</a></dd>
            
            <dd><a href="/en/v0.4.1/">v0.4.1</a></dd>
            
            <dd><a href="/en/v0.4.0/">v0.4.0</a></dd>
            
            <dd><a href="/en/v0.3.6/">v0.3.6</a></dd>
            
            <dd><a href="/en/v0.3.5/">v0.3.5</a></dd>
            
            <dd><a href="/en/v0.3.4/">v0.3.4</a></dd>
            
            <dd><a href="/en/v0.3.3/">v0.3.3</a></dd>
            
            <dd><a href="/en/v0.3.2/">v0.3.2</a></dd>
            
            <dd><a href="/en/v0.3.1/">v0.3.1</a></dd>
            
            <dd><a href="/en/v0.3.0/">v0.3.0</a></dd>
            
            <dd><a href="/en/v0.2.2/">v0.2.2</a></dd>
            
            <dd><a href="/en/v0.2.1/">v0.2.1</a></dd>
            
            <dd><a href="/en/v0.2.0/">v0.2.0</a></dd>
            
            <dd><a href="/en/v0.1.7/">v0.1.7</a></dd>
            
            <dd><a href="/en/v0.1.6/">v0.1.6</a></dd>
            
            <dd><a href="/en/v0.1.5/">v0.1.5</a></dd>
            
            <dd><a href="/en/v0.1.4/">v0.1.4</a></dd>
            
            <dd><a href="/en/v0.1.3/">v0.1.3</a></dd>
            
            <dd><a href="/en/v0.1.2/">v0.1.2</a></dd>
            
            <dd><a href="/en/develop/">develop</a></dd>
            
            <dd><a href="/en/breaking/">breaking</a></dd>
            
        </dl>
        <dl>
            
            <dt>On Read the Docs</dt>
            <dd>
                <a href="//readthedocs.org/projects/solidity/?fromdocs=solidity">Project Home</a>
            </dd>
            <dd>
                <a href="//readthedocs.org/builds/solidity/?fromdocs=solidity">Builds</a>
            </dd>
        </dl>
    </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>